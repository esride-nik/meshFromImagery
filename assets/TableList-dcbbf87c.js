import{V as C,h4 as j,h5 as Z,h6 as q,dZ as G,bA as J,cb as u,h3 as y,kf as F,a5 as o,a6 as l,a9 as M,bg as Q,eU as W,cd as X,h7 as Y}from"./index-b516d057.js";import{e as N,O as ee,n as m,i as $}from"./jsxFactory-92036771.js";import{e as v}from"./globalCss-94006b67.js";import{t as T}from"./accessibleHandler-e91101b2.js";import{e as te}from"./vmEvent-d773b6c5.js";import{a as ie,i as se}from"./layerListUtils-a0f5e0ab.js";import{S as ne}from"./sortable.esm-0d19b1d3.js";import"./uuid-709b6c67.js";var k;const oe=C.ofType({key:"type",defaultKeyValue:"button",base:j,typeMap:{button:Z,toggle:q,slider:ie}}),z=C.ofType(oe),U="layer",ae="esri.widgets.TableList.ListItem";let g=k=class extends G(J){constructor(e){super(e),this.actionsSections=new z,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null}initialize(){if(this.addHandles(u(()=>this.layer,e=>this._watchLayerProperties(e),y)),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}get error(){var e;return(e=this.layer)==null?void 0:e.loadError}get publishing(){var i;const{layer:e,checkPublishStatusEnabled:t}=this;return(t&&e&&"publishingInfo"in e&&((i=e.publishingInfo)==null?void 0:i.status)==="publishing")??!1}get title(){var t;const e=F(this,"layer.layer");return(!e||e&&F(this,"layer.layer.loaded")?(t=this.layer)==null?void 0:t.title:null)??""}set title(e){this._overrideIfSome("title",e)}clone(){return new k({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,title:this.title})}_watchLayerProperties(e){this.removeHandles(U),e&&this.addHandles(u(()=>e.listMode,()=>this._watchLayerProperties(e)),U)}};o([l({type:z})],g.prototype,"actionsSections",void 0),o([l()],g.prototype,"actionsOpen",void 0),o([l()],g.prototype,"checkPublishStatusEnabled",void 0),o([l({readOnly:!0})],g.prototype,"error",null),o([l()],g.prototype,"hidden",void 0),o([l()],g.prototype,"layer",void 0),o([l()],g.prototype,"listItemCreatedFunction",void 0),o([l({readOnly:!0})],g.prototype,"publishing",null),o([l()],g.prototype,"title",null),g=k=o([M(ae)],g);const O=g,S={map:"map",tables:"tables",layerListMode:"layer-list-mode"},le="hide",B=C.ofType(O);let b=class extends Q.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.tableItems=new B,this.map=null}initialize(){this.addHandles([u(()=>{var e;return[this.map,(e=this.map)==null?void 0:e.loaded]},()=>this._mapHandles(),y),u(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],S.map)}destroy(){this.map=null,this.tableItems.removeAll()}get state(){var t;const e=(t=this.map)==null?void 0:t.loadStatus;return typeof e=="string"?e==="loaded"?"ready":e==="loading"?"loading":"disabled":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}_mapHandles(){const{map:e}=this;this.removeHandles(S.tables),this._compileList(),e&&this.addHandles(u(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.allTables)==null?void 0:i.toArray()},()=>this._compileList(),y),S.tables)}_removeAllItems(){this.tableItems.removeAll()}_getViewableTables(e){if(e)return e.filter(t=>se(t)!==le)}_watchTablesListMode(e){this.removeHandles(S.layerListMode),e&&e.forEach(t=>{this.addHandles(u(()=>t.listMode,()=>this._compileList()),S.layerListMode)})}_compileList(){var i;const e=(i=this.map)==null?void 0:i.tables;this._watchTablesListMode(e);const t=this._getViewableTables(e);t!=null&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{tableItems:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s}=this;e.forEach(n=>{t.find(a=>a.layer===n)||t.add(new O({checkPublishStatusEnabled:s,layer:n,listItemCreatedFunction:i}))})}_removeItems(e){const{tableItems:t}=this;t.forEach(i=>{if(!i)return;(e==null?void 0:e.find(n=>i.layer===n))||t.remove(i)})}_sortItems(e){const{tableItems:t}=this;t.sort((i,s)=>{const n=e.indexOf(i.layer),a=e.indexOf(s.layer);return n>a?-1:n<a?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}};o([l()],b.prototype,"checkPublishStatusEnabled",void 0),o([l()],b.prototype,"listItemCreatedFunction",void 0),o([l({type:B,readOnly:!0})],b.prototype,"tableItems",void 0),o([l()],b.prototype,"map",void 0),o([l({readOnly:!0})],b.prototype,"state",null),b=o([M("esri.widgets.TableList.TableListViewModel")],b);const D=b;function E(e,t){var s;const i=(s=e.layer)==null?void 0:s.uid;return i!=null?t.find(n=>{var a;return((a=n.layer)==null?void 0:a.uid)===i}):null}function V(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const re=C.ofType(O),ce="root-tables",R="data-layer-uid",de="layerUid",c="esri-table-list",r={base:c,widgetIcon:$.table,noItems:`${c}__no-items`,list:`${c}__list`,listRoot:`${c}__list--root`,item:`${c}__item`,itemChosen:`${c}__item--chosen`,itemMessage:`${c}__item--has-message`,itemSelectable:`${c}__item--selectable`,itemContainer:`${c}__item-container`,actionsMenu:`${c}__item-actions-menu`,actionsMenuItem:`${c}__item-actions-menu-item`,actionsMenuItemActive:`${c}__item-actions-menu-item--active`,actions:`${c}__item-actions`,actionsList:`${c}__item-actions-list`,action:`${c}__item-action`,actionIcon:`${c}__item-action-icon`,actionImage:`${c}__item-action-image`,actionTitle:`${c}__item-action-title`,actionToggle:`${c}__action-toggle`,actionToggleOn:`${c}__action-toggle--on`,message:`${c}__item-message`,title:`${c}__item-title`,publishing:`${c}__publishing`},_={actions:"actions",actionSection:"action-section",items:"items"};function he(e){const{actionsOpen:t}=e;t&&(e.actionsOpen=!1)}const K={statusIndicators:!0,errors:!1};let d=class extends ee{constructor(e,t){super(e,t),this._sortable=null,this._sortableNode=null,this._focusSortUid=null,this.visibleItems=null,this.iconClass=r.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new re,this.viewModel=new D,this.visibleElements={...K}}initialize(){this._setVisibleItems(this.tableItems),this.addHandles([u(()=>this.visibleElements,()=>this._itemsChanged()),X(()=>this.viewModel.tableItems,"change",()=>this._itemsChanged()),u(()=>this.selectionEnabled,()=>this._toggleSorting(),y)])}destroy(){this._destroySortable()}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get tableItems(){return this.viewModel.tableItems}castVisibleElements(e){return{...K,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){var s;const{visibleItems:e}=this,t=(s=this.viewModel)==null?void 0:s.state,i={[v.hidden]:t==="loading",[v.disabled]:t==="disabled"};return m("div",{class:this.classes(r.base,v.widget,v.panel,i)},e!=null&&e.length?this._renderList():this._renderNoItems())}_renderNoItems(){return m("div",{class:r.noItems},this.messages.noItemsToDisplay)}_renderList(){const{visibleItems:e,messages:t,selectionEnabled:i}=this;return m("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"aria-label":t.widgetLabel,bind:this,class:this.classes(r.list,r.listRoot),"data-node-ref":"_sortableNode",role:i?"listbox":void 0},e==null?void 0:e.map(s=>this._renderItem(s)).toArray())}_renderItem(e){var p;const{id:t,selectionEnabled:i,selectedItems:s}=this,n=`${`${t}_${e.uid}`}__title`,a=this._hasMessage(e),h={[r.itemMessage]:!!a,[r.itemSelectable]:i};if(i){const I={[R]:(p=e.layer)==null?void 0:p.uid};return m("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":n,"aria-selected":E(e,s)?"true":"false",bind:this,class:this.classes(r.item,h),"data-item":e,key:`item-with-selection-${e.uid}`,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,role:"option",tabIndex:0,...I},this._renderItemContent(e,n))}return m("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":n,bind:this,class:this.classes(r.item,h),key:`item-no-selection-${e.uid}`},this._renderItemContent(e,n))}_renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[r.actionsMenuItemActive]:e.actionsOpen};return m("div",{"aria-controls":t,"aria-label":i.options,bind:this,class:this.classes(r.actionsMenuItem,s),"data-item":e,key:"actions-menu-toggle",onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,role:"button",tabIndex:0,title:i.options},m("span",{"aria-hidden":"true",class:$.handleHorizontal}))}_renderActionsMenu(e,t,i,s){const n=i===1&&this._getSingleActionButton(t),a=n?this._renderAction({item:e,action:n,singleAction:!0}):null,h=!n&&i?this._renderActionsMenuIcon(e,s):null;return h||n?m("div",{class:r.actionsMenu,key:"actions-menu"},a,h):null}_renderItemMessage(e){return e.error?m("div",{class:r.message,key:"esri-table-list__error",role:"alert"},m("span",{"aria-hidden":"true",class:$.noticeTriangle}),this.messages.tableError):null}_renderItemStatus(e){const{visibleElements:t}=this;if(!t.statusIndicators)return null;const{publishing:i}=e;return m("span",{class:this.classes({[r.publishing]:i}),key:"layer-item-status"})}_renderItemContent(e,t){const{id:i}=this,s=`${`${i}_${e.uid}`}_actions`,n=this._filterActions(e.actionsSections),a=this._countActions(n);return[m("div",{class:r.itemContainer,key:"list-item-container"},this._renderTitle(e,t),this._renderItemStatus(e),this._renderActionsMenu(e,n,a,s)),this._renderItemMessage(e),a?this._renderActionsSections(e,n,s):null]}_renderTitle(e,t){const{messages:i}=this,s=e.title||i.untitledTable;return m("span",{class:r.title,id:t,key:"layer-title-container"},s)}_renderActionsSections(e,t,i){const s=t.toArray().map((n,a)=>m("ul",{class:r.actionsList,key:`${e}-action-section-${a}`},this._renderActionSection(e,n)));return m("div",{"aria-expanded":e.actionsOpen?"true":"false",class:r.actions,hidden:!e.actionsOpen||null,id:i,key:"actions-section",role:"group"},s)}_renderActionSection(e,t){return(t&&t.toArray()).map(i=>this._renderAction({item:e,action:i}))}_renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n=e.type!=="button"||e.image||i?i:$.defaultAction,a={[r.actionImage]:!t&&!!s["background-image"],[$.loadingIndicator]:t,[v.rotating]:t};return n&&!t&&(a[n]=!0),m("span",{"aria-hidden":"true",class:this.classes(r.actionIcon,a),key:"action-icon",styles:s})}_renderActionTitle(e,t){return t?null:m("span",{class:r.actionTitle,key:"action-title"},e)}_renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:a,title:h}=i,p={[r.actionsMenuItem]:s&&i.type==="button",[r.action]:n||!s&&i.type!=="toggle",[r.actionToggle]:!n&&i.type==="toggle",[r.actionToggleOn]:!n&&i.type==="toggle"&&i.value,[v.disabledElement]:a},I=[this._renderActionIcon(i),this._renderActionTitle(h,s)];return s?m("div",{"aria-label":h,bind:this,classes:p,"data-action":i,"data-item":t,key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:h??void 0},I):m("li",{"aria-label":h,bind:this,classes:p,"data-action":i,"data-item":t,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:h??void 0},I)}_hasMessage(e){return!!e.error}_filterActions(e){return e.map(t=>t.filter(i=>i.visible))}_setVisibleItems(e){this.visibleItems=e==null?void 0:e.filter(t=>!t.hidden&&(this.visibleElements.errors||!t.error))}_destroySortable(){const{_sortable:e}=this;e&&e.destroy(),this._sortable=null}_toggleSorting(){const{_sortable:e,_sortableNode:t,selectionEnabled:i}=this;if(t)if(e)e.option("disabled",!i);else{const s=ne.create(t,{dataIdAttr:R,group:ce,fallbackTolerance:4,disabled:!i,onSort:()=>this._sortTablesToItems(s.toArray()),chosenClass:r.itemChosen});this._sortable=s}}_sortNodeCreated(e){this._sortableNode=e,this._toggleSorting()}_sortTablesToItems(e){var i;const t=(i=this.map)==null?void 0:i.tables;t&&t.sort((s,n)=>{const a=e.indexOf(s.uid),h=e.indexOf(n.uid);return a>h?-1:a<h?1:0})}_getSingleActionButton(e){return e.reduce(t=>t).filter(t=>t&&t.type==="button").at(0)}_focusListItem(e){var s;const{_focusSortUid:t}=this;if(!e||!t)return;((s=w(e).layer)==null?void 0:s.uid)===t&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e){const t=()=>this.scheduleRender();this.addHandles(e.on("change",t),_.actionSection),e.forEach(i=>this._renderOnActionChanges(i))}_renderOnActionChanges(e){const t=()=>this.scheduleRender();e.type!=="toggle"?e.type!=="slider"?this.addHandles(u(()=>[e.className,e.image,e.id,e.title,e.visible],t,y),_.actions):this.addHandles(u(()=>[e.className,e.id,e.title,e.visible,e.value,e.displayValueEnabled,e.max,e.min,e.step],t,y),_.actions):this.addHandles(u(()=>[e.className,e.image,e.id,e.title,e.visible,e.value],t,y),_.actions)}_renderOnItemChanges(e){const t=()=>this.scheduleRender();this.addHandles([u(()=>[e.actionsOpen,e.title,e.error,e.publishing],t,y),u(()=>[e.hidden,e.error],()=>this._setVisibleItems(this.tableItems)),e.actionsSections.on("change",t)],_.items),e.actionsSections.forEach(i=>this._watchActionSectionChanges(i))}_itemsChanged(){const{tableItems:e}=this.viewModel;this._setVisibleItems(e),this.removeHandles(_.actionSection),this.removeHandles(_.actions),this.removeHandles(_.items),e.forEach(t=>this._renderOnItemChanges(t)),this.scheduleRender()}_countActions(e){return e.reduce((t,i)=>t+i.length,0)}_getIconImageStyles(e){const t=e.declaredClass==="esri.support.Action.ActionButton"||e.declaredClass==="esri.support.Action.ActionToggle"?e.image:null;return{"background-image":t?`url("${t}")`:void 0}}_selectionKeydown(e){var L,H,P,x;const t=["ArrowDown","ArrowUp"],i=Y(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget["data-item"],{_sortable:n,selectedItems:a}=this;if(!n)return;const h=E(s,a),p=n.toArray(),I=e.target,f=p.indexOf(I.dataset[de]);if(f!==-1){if(i==="ArrowDown"){const A=f+1;if(A>=p.length)return;h?(V(p,f,A),n.sort(p),this._sortTablesToItems(n.toArray()),this._focusSortUid=(L=s.layer)==null?void 0:L.uid):(this._focusSortUid=(H=s.layer)==null?void 0:H.uid,this.scheduleRender())}if(i==="ArrowUp"){const A=f-1;if(A<=-1)return;h?(V(p,f,A),n.sort(p),this._sortTablesToItems(n.toArray()),this._focusSortUid=(P=s.layer)==null?void 0:P.uid):(this._focusSortUid=(x=s.layer)==null?void 0:x.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=w(e.currentTarget),{actionsOpen:i}=t,s=!i;s&&this.tableItems.forEach(n=>he(n)),t.actionsOpen=s,e.stopPropagation()}_triggerAction(e){const t=e.currentTarget,i=me(t),s=w(t);i.type==="toggle"&&(i.value=!i.value),this.triggerAction(i,s),e.stopPropagation()}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=t&&(e.metaKey||e.ctrlKey),n=w(e.currentTarget),a=E(n,i),{length:h}=i;if(!s)return h&&!(a&&h===1)?(i.removeAll(),void i.add(n)):void(a?i.remove(a):i.add(n));a?i.remove(a):i.add(n)}get test(){return{visibleItems:this.visibleItems}}};function me(e){return e["data-action"]}function w(e){return e["data-item"]}o([l()],d.prototype,"visibleItems",void 0),o([l()],d.prototype,"iconClass",void 0),o([l()],d.prototype,"icon",void 0),o([l()],d.prototype,"label",null),o([l()],d.prototype,"listItemCreatedFunction",null),o([l()],d.prototype,"map",null),o([l(),N("esri/widgets/TableList/t9n/TableList")],d.prototype,"messages",void 0),o([l(),N("esri/t9n/common")],d.prototype,"messagesCommon",void 0),o([l()],d.prototype,"multipleSelectionEnabled",void 0),o([l()],d.prototype,"selectionEnabled",void 0),o([l()],d.prototype,"selectedItems",void 0),o([l({readOnly:!0})],d.prototype,"tableItems",null),o([te("trigger-action"),l({type:D})],d.prototype,"viewModel",void 0),o([l()],d.prototype,"visibleElements",void 0),o([W("visibleElements")],d.prototype,"castVisibleElements",null),o([T()],d.prototype,"_toggleActionsOpen",null),o([T()],d.prototype,"_triggerAction",null),o([T()],d.prototype,"_toggleSelection",null),d=o([M("esri.widgets.TableList")],d);const fe=d;export{fe as default};

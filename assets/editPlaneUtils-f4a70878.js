import{E as Wt,D as Qt,or as Ct,X as Zt,lG as jt,C as qt,kQ as Yt,bs as Rt,bh as lt,da as Jt,aW as I,os as Xt,ez as Bt,B as kt,f6 as ot,fn as Kt,fk as te,fv as ee,ot as ie,ou as oe,g9 as q,ah as dt,id as yt,fu as ne,fD as re,f9 as ae,ic as se,a5 as r,a6 as l,a9 as V,bA as le,bg as pe,eL as ce,cb as gt,dr as ft,b9 as H,ds as ue,eH as he,ao as mt,dN as de,db as ye,d2 as ge,ov as vt,gL as xt,d1 as wt,ow as _t,jM as E,gx as N,gn as $t,ox as fe,oy as me,gg as ve,gp as K,gr as Ot}from"./index-b516d057.js";import{t as W}from"./memoize-3e55df82.js";import{o as Y,c as nt,s as Pt,a as w,i as J,f as pt,e as St,k as F,l as xe}from"./unitFormatUtils-67047561.js";import{c as we}from"./elevationInfoUtils-be36d866.js";import{g as _e}from"./SketchViewModel-fedf7932.js";import{simplify as $e,distance as Oe}from"./geometryEngine-656a968c.js";import{g as m,F as bt}from"./surfaceCoordinateSystems-1cfad4a3.js";import{e as tt}from"./helpMessageUtils-1ce96584.js";import{l as be}from"./InteractiveToolBase-ddd44c70.js";import{g as rt,h as Me}from"./snappingUtils-93e84fbe.js";import{c as Ut,p as Et}from"./SketchTooltipOptions-cc43c059.js";import{t as at}from"./projectVectorToVector-56c29b20.js";import{k as Te,S as Ie}from"./coordinateSystem-38339d17.js";import{q as Ve,T as ze,d as Ge}from"./SnappingManager-aa70fdd4.js";import{t as Ce}from"./projectVectorToPoint-fbaf5599.js";import{o as Mt}from"./projectVectorToWGS84ComparableLonLat-5675a9f4.js";import{b as Re,R as ke,z as Pe}from"./geodesicUtils-822c19ca.js";import{i as Dt}from"./measurementUtils-3881da59.js";import{s as A,u as Se,p as Ue,d as Ee,a as et}from"./automaticLengthMeasurementUtils-412e2f10.js";import{s as De}from"./Cyclical-4c223a04.js";import{n as Le}from"./uuid-709b6c67.js";import{o as Tt}from"./automaticAreaMeasurementUtils-7a3ffffd.js";import{J as X,W as Fe}from"./boundedPlane-1da2f094.js";import{t as Ae,a as He,s as Ne,c as We}from"./EditGeometryOperations-c2e73f2d.js";function P(t,e){const i=new kt({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(i.z=t[2]),i}function Qe(t,e){return new Wt({points:t,spatialReference:e})}function It(t,e,i){const o=new Qt({paths:t,spatialReference:e});return i&&Ct(o),o}function S(t,e,i,o=!0){const s=Zt(t);s.forEach(a=>{const u=a[0],p=a[a.length-1];jt(u,p)&&a.length!==1||a.push(a[0])});let n=new qt({rings:s,spatialReference:e});return n.rings.forEach(a=>{Yt(a)||a.reverse()}),i&&Ct(n),o&&n.isSelfIntersecting&&Rt(e)&&(n=$e(n)),n}function Vt(t,e,i){const o=e.mapToLocalMultiple(t),s=[],n={x:o[0].x,y:o[0].y},a={x:o[1].x,y:o[1].y},u=Math.round(a.x-n.x),p=Math.round(a.y-n.y),h=Math.max(Math.abs(u),Math.abs(p));if(i){const y={x:n.x+h,y:n.y+h},g={x:n.x-h,y:n.y-h};s.push(m(y.x,g.y),m(g.x,g.y),m(g.x,y.y),m(y.x,y.y))}else{const y={x:u>0?n.x+h:n.x-h,y:p>0?n.y+h:n.y-h};s.push(m(n.x,n.y),m(y.x,n.y),m(y.x,y.y),m(n.x,y.y))}return Lt(S([s.map(y=>e.localToMap(y)).filter(lt)],e.spatialReference,e.doUnnormalization,!0),s,e)}function Ze(t,e,i){let o=e.mapToLocalMultiple(t);if(o.length===1){const p=o[0];o=[m(p.x-48,p.y+48),m(p.x+48,p.y-48),m(p.x+48,p.y-48),m(p.x-48,p.y+48)]}const s=[],n={x:o[0].x,y:o[0].y},a={x:o[1].x,y:o[1].y};if(i){const u=Math.round(a.x-n.x),p=Math.round(a.y-n.y);s.push(m(n.x-u,n.y-p),m(a.x,n.y-p),m(a.x,a.y),m(n.x-u,a.y))}else s.push(m(n.x,n.y),m(a.x,n.y),m(a.x,a.y),m(n.x,a.y));return Lt(S([s.map(u=>e.localToMap(u)).filter(lt)],e.spatialReference,e.doUnnormalization,!0),s,e)}function Lt(t,e,i){const o=Q(e[3],e[2],i),s=Q(e[1],e[2],i),n=Q(e[0],e[1],i),a=Q(e[0],e[3],i);return{geometry:t,midpoints:o!=null&&s!=null&&n!=null&&a!=null?{top:o,right:s,bottom:n,left:a}:null}}function Q(t,e,i){D[0]=t.x,D[1]=t.y,D[2]=0,L[0]=e.x,L[1]=e.y,L[2]=0,Jt(D,D,L,.5),Z.x=D[0],Z.y=L[1],Z.z=L[2];const o=i.localToMap(Z);return o!=null?P(o,i.spatialReference):null}const Z=m(0,0,0),D=I(),L=I();function zt(t,e,i,o){const s=e.mapToLocalMultiple(t);let n=null,a=null;if(i)n=s[0],a=s[1];else{const f=s[0],x=s[1],_=Math.round(x.x-f.x),U=Math.round(x.y-f.y),O=Math.max(Math.abs(_),Math.abs(U));n=m(_>0?f.x+O/2:f.x-O/2,U>0?f.y+O/2:f.y-O/2),a=m(Math.abs(_)>Math.abs(U)?n.x-O/2:n.x,Math.abs(_)>Math.abs(U)?n.y:n.y-O/2)}const u=e.localToMap(n),p=e.localToMap(a);if(u==null||p==null)return null;e.doUnnormalization&&Xt([[u,p]],e.spatialReference);const h=P(u,e.spatialReference),y=P(p,e.spatialReference),g=Bt(e.spatialReference);let c=0;if(Rt(e.spatialReference))c=g*Oe(h,y,null);else{const f=n.x-a.x,x=n.y-a.y;c=g*Math.sqrt(f*f+x*x)*(o||1)}const C=new _e({center:h,radius:c,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:S(C.rings,C.spatialReference,!1),center:h,edge:y}}function je(t,e,i){const o=e.mapToLocalMultiple(t),s=o[0],n=o[1],a=Math.round(n.x-s.x),u=Math.round(n.y-s.y),p=m(i?s.x:s.x+a/2,i?s.y:s.y+u/2),h=i?a:a/2,y=i?u:u/2,g=60,c=[],C=2*Math.PI/g;function f(z){const Ht=Math.cos(z),Nt=Math.sin(z);return m(h*Ht+p.x,y*Nt+p.y)}for(let z=0;z<g;z++)c.push(f(z*C));c.push(c[0]);const{spatialReference:x,doUnnormalization:_}=e,U=S([c.map(z=>e.localToMap(z)).filter(lt)],x,_,!1),O=e.localToMap(f(Math.PI/2)),ct=e.localToMap(f(0)),ut=e.localToMap(f(-Math.PI/2)),ht=e.localToMap(f(Math.PI));return{geometry:U,midpoints:O!=null&&ct!=null&&ut!=null&&ht!=null?{top:P(O,x),right:P(ct,x),bottom:P(ut,x),left:P(ht,x)}:null}}const qe=(()=>{const t=I(),e=I(),i=I();return(o,s)=>{if(ot(e,o.x,o.y,o.z??0),ot(i,s.x,s.y,s.z??0),Kt(e,i))return null;if(!Mt(e,o.spatialReference,e)||!Mt(i,s.spatialReference,i)){te(t,i,e),t[2]=0,ee(t,t);let a=ie(oe,t);return t[0]<0&&(a=2*Math.PI-a),Y(a,"radians","geographic")}const{azimuth:n}=Re(Je,e,i);return n!=null?Y(n,"degrees","geographic"):void 0}})(),Ye=(()=>{const t=I(),e=I();return({x:i,y:o,z:s,spatialReference:n},a,u)=>{const p=s??0;ot(t,i,o,p);const h=nt(q(u.value,u.unit,"degrees"),u.rotationType,"geographic");if(!at(t,n,t,dt.WGS84)){const y=nt(h,"geographic","arithmetic"),g=q(y,"degrees","radians");return new kt({x:i+a*Math.cos(g),y:o+a*Math.sin(g),z:p,spatialReference:n})}return Pe(e,t,h,a),e[2]=p,Ce(e,dt.WGS84,n)}})(),Je=new ke;function Xe(t,e,i,o){if(!e)return;const{spatialReference:s}=t;if(!yt(s))return;const n=Dt(s),a=yt(n);if(!a)return;const u=rt(t,i,o),p=ei;if(!at(u,s,p,n))return;const h=Pt(e,a);if((i==null?void 0:i.type)==="3d"&&i.viewingMode==="local")p[0]+=h;else{const g=Te(n),c=Ie(g,p,ne.X,ii);re(p,p,c,h)}if(!at(p,n,p,s))return;const y=ae(u,p);return new Ve(u,y)}function Be(t,e,i,o){if(!e)return;const s=rt(t,i,o),n=Ye(t,1,e);if(!n)return;const a=rt(n,i,o);return new ze(s,a)}function Ke(t,e,i,o){if(t==null)return;const s=Dt(e),n=se(s);return n?new Ge(Pt(t,n)):void 0}function ti(t){let e;for(const i of t)i&&(e=(e==null?void 0:e.intersect(i))??i);return e}const ei=I(),ii=I();let v=class extends le{constructor(e){super(e),this.committed=null,this.disabled=!1,this.hidden=!1,this.id=Le(),this.inputValue=null,this.readOnly=!1}get dirty(){return this.inputValue!=null}get locked(){return this.committed!=null}lock(e){this.inputValue=null,this.committed=e??this.actual}unlock(){this.committed=null,this.inputValue=null}};r([l()],v.prototype,"actual",void 0),r([l()],v.prototype,"committed",void 0),r([l()],v.prototype,"createQuantity",void 0),r([l()],v.prototype,"disabled",void 0),r([l()],v.prototype,"hidden",void 0),r([l()],v.prototype,"format",void 0),r([l()],v.prototype,"id",void 0),r([l()],v.prototype,"inputValue",void 0),r([l()],v.prototype,"readOnly",void 0),r([l()],v.prototype,"suffix",void 0),r([l()],v.prototype,"title",void 0),r([l()],v.prototype,"toInputUnits",void 0),r([l()],v.prototype,"dirty",null),r([l()],v.prototype,"locked",null),v=r([V("esri.views.interactive.tooltip.fields.TooltipField")],v);let j=class extends v{constructor(e){super(e),this.mode="absolute-height"}normalizeCtorArgs(e){const i=o=>o.inputUnitInfos.verticalLength.unit;return{actual:w,createQuantity:(o,s)=>J(o,i(s)),toInputUnits:(o,s)=>pt(o,i(s)),format:(o,s)=>s.formatters.verticalLength(o),suffix:o=>o.inputUnitInfos.verticalLength.abbreviation,title:o=>o.messages.sketch.elevation,...e}}};r([l()],j.prototype,"mode",void 0),j=r([V("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],j);const Ft=t=>{const e=i=>i.inputUnitInfos.orientation.unit;return new v({actual:St,createQuantity:(i,o)=>Y(i,e(o),"geographic"),toInputUnits:({value:i,unit:o,rotationType:s},n)=>{const p=nt(q(i,o,"degrees"),s,"geographic"),h=De.normalize(p,0,!0),y=e(n),g=q(h,"degrees",y);return Y(g,y,"geographic")},format:(i,o)=>o.formatters.angle(i),suffix:i=>i.inputUnitInfos.orientation.abbreviation,title:i=>i.messages.sketch.orientation,...t})},st=t=>{const e=i=>i.inputUnitInfos.length.unit;return new v({actual:w,createQuantity:(i,o)=>J(i,e(o)),toInputUnits:(i,o)=>pt(i,e(o)),format:(i,o)=>o.formatters.length(i),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.distance,...t})},B=t=>new j(t),oi=t=>{const e=i=>i.inputUnitInfos.area.unit;return new v({actual:F,createQuantity:(i,o)=>xe(i,e(o)),toInputUnits:(i,o)=>pt(i,e(o)),format:(i,o)=>o.formatters.area(i),suffix:i=>i.inputUnitInfos.area.abbreviation,title:i=>i.messages.sketch.area,...t})};let R=class extends A{constructor(e){super(e),this.type="draw-point",this.elevation=B()}get allFields(){return[this.elevation]}};r([l()],R.prototype,"type",void 0),r([l()],R.prototype,"elevation",void 0),r([l()],R.prototype,"allFields",null),r([l()],R.prototype,"helpMessage",void 0),R=r([V("esri.views.interactive.tooltip.DrawPointTooltipInfo")],R);let $=class extends A{constructor(t){super(t),this.type="draw-polyline",this.orientation=Ft(),this.distance=st({title:e=>e.messages.sketch.distance}),this.elevation=B(),this.totalLength=st({format:(e,i)=>i.formatters.totalLength(e),title:e=>e.messages.sketch.totalLength,readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.totalLength]}};r([l()],$.prototype,"type",void 0),r([l()],$.prototype,"orientation",void 0),r([l()],$.prototype,"distance",void 0),r([l()],$.prototype,"elevation",void 0),r([l()],$.prototype,"totalLength",void 0),r([l()],$.prototype,"allFields",null),r([l()],$.prototype,"helpMessage",void 0),$=r([V("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],$);let M=class extends A{constructor(t){super(t),this.type="draw-polygon",this.orientation=Ft(),this.distance=st({title:e=>e.messages.sketch.distance}),this.elevation=B(),this.area=oi({readOnly:!0})}get allFields(){return[this.orientation,this.distance,this.elevation,this.area]}};r([l()],M.prototype,"type",void 0),r([l()],M.prototype,"distance",void 0),r([l()],M.prototype,"elevation",void 0),r([l()],M.prototype,"area",void 0),r([l()],M.prototype,"allFields",null),r([l()],M.prototype,"helpMessage",void 0),M=r([V("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],M);let k=class extends A{constructor(e){super(e),this.type="draw-mesh",this.elevation=B()}get allFields(){return[this.elevation]}};r([l()],k.prototype,"type",void 0),r([l()],k.prototype,"elevation",void 0),r([l()],k.prototype,"allFields",null),r([l()],k.prototype,"helpMessage",void 0),k=r([V("esri.views.interactive.tooltip.DrawMeshTooltipInfo")],k);let G=class extends A{constructor(e){super(e),this.type="draw-rectangle",this.xSize=w,this.ySize=w,this.area=F}get allFields(){return[]}};r([l()],G.prototype,"type",void 0),r([l()],G.prototype,"xSize",void 0),r([l()],G.prototype,"ySize",void 0),r([l()],G.prototype,"area",void 0),r([l()],G.prototype,"allFields",null),G=r([V("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],G);let T=class extends A{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=F}get allFields(){return[]}};r([l()],T.prototype,"type",void 0),r([l()],T.prototype,"radius",void 0),r([l()],T.prototype,"xSize",void 0),r([l()],T.prototype,"ySize",void 0),r([l()],T.prototype,"area",void 0),r([l()],T.prototype,"allFields",null),T=r([V("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],T);class ni{constructor(){this.regularVertices=null,this.activeVertex=null,this.full=null,this.outline=null,this.circle=null,this.rectangle=null}}let d=class extends pe.EventedMixin(be){constructor(t){super(t),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new Ut,this.geometryToPlace=null,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new Et,this._getPointConstraint=W(e=>e),this._getPolylineOrPolygonConstraint=W((e,i,o)=>ti([e,i,o])),this._getDistanceConstraint=W(Xe),this._getOrientationConstraint=W(Be),this._getElevationConstraint=W(Ke)}initialize(){this.internalGraphicsLayer=new ce({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation();const t=this.tooltipOptions,e=this.view.type;this.tooltipInfos={point:new R({tooltipOptions:t,viewType:e}),polyline:new $({tooltipOptions:t,viewType:e}),polygon:new M({tooltipOptions:t,viewType:e}),mesh:new k({tooltipOptions:t,viewType:e}),rectangle:new G({tooltipOptions:t}),circle:new T({tooltipOptions:t})},this.addHandles([this.drawOperation.on("vertex-add",i=>this.onVertexAdd(i)),this.drawOperation.on("vertex-remove",i=>this.onVertexRemove(i)),this.drawOperation.on("vertex-update",i=>this.onVertexUpdate(i)),this.drawOperation.on("cursor-update",i=>this.onCursorUpdate(i)),this.drawOperation.on("complete",i=>this.onComplete(i)),gt(()=>this.cursor,i=>{this.drawOperation.cursor=i},ft),gt(()=>this.tooltipOptions.enabled,i=>{this.tooltip=i?new Se({view:this.view,info:this._tooltipInfo}):H(this.tooltip)},ft),ue(()=>this._updateTooltipInfo())]),this.finishToolCreation()}destroy(){this.drawOperation=H(this.drawOperation),this.tooltip=H(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=H(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return J(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){const e=this._tooltipInfo;if(t.type==="key-down"&&t.key===Me.enterInputMode&&e!=null&&e.editableFields.length>0&&this.tooltipOptions.inputEnabled)return e.enterInputMode(),void t.stopPropagation();this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_destroyAllVisualisations(){this.removeHandles(b.outline),this.removeHandles(b.regularVertices),this.removeHandles(b.activeVertex),this.removeHandles(it)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(this._graphic,t),this._graphic;const e=this._graphic=new he({...this.graphicProperties,symbol:this.graphicSymbol});return this.updateGraphicGeometry(e,t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(mt(()=>{this.internalGraphicsLayer.remove(e),H(e),this._graphic===e&&(this._graphic=null)}),it),e}updateGraphicGeometry(t,e){t.geometry=e}_getCreateOperationGeometry(t={operationComplete:!1}){var C;const{drawOperation:e}=this;if(e==null||e.numVertices===0)return null;const{coordinateHelper:i,view:o}=e,s=e.stagedVertex,n=e.committedVertices,a=n.slice(),u=s!=null;u&&a.push(i.pointToArray(s));const p=u?i.pointToArray(s):n.splice(-1)[0],h=a.length,y=o.spatialReference,g=o.type==="3d"&&o.viewingMode==="global",c=new ni;switch(this.geometryType){case"point":case"mesh":c.regularVertices=n,c.activeVertex=p,c.full=i.arrayToPoint(a[0]);break;case"multipoint":c.regularVertices=n,c.activeVertex=p,h>0&&(c.full=Qe(a,y));break;case"polyline":c.regularVertices=n,c.activeVertex=p,h>0&&(c.full=It([a],y,g));break;case"polygon":c.regularVertices=n,c.activeVertex=p,h>0&&(c.full=S([a],y,g,!0));break;case"circle":if(h>0){const f=bt(o,a[0]);if(h===1&&t.operationComplete){const x=a[0],_=f.makeMapPoint(x[0]+Gt*o.resolution,x[1]);c.circle=zt([x,_],f,!0),c.full=c.circle!=null?c.circle.geometry:null}else h===2&&(this.forceUniformSize?(c.circle=zt(a,f,this.centered),c.full=c.circle!=null?c.circle.geometry:null):(c.rectangle=je(a,f,this.centered),c.full=c.rectangle.geometry))}break;case"rectangle":if(h>0){const f=bt(o,a[0]);if(h===1&&t.operationComplete){const x=a[0],_=f.makeMapPoint(x[0]+Gt*o.resolution,x[1]);c.rectangle=Vt([x,_],f,!0),c.full=c.rectangle.geometry}else h===2&&(c.rectangle=this.forceUniformSize?Vt(a,f,this.centered):Ze(a,f,this.centered),c.full=c.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":c.outline=h>1?It([a],y,g):null;break;case"polygon":c.outline=h>1?S([a],y,g):null;break;case"circle":case"rectangle":c.outline=((C=c.full)==null?void 0:C.type)==="polygon"?S(c.full.rings,y,g):null}return c}initializeGraphic(t){return mt()}onComplete(t){this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(t){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-add",t)}onVertexRemove(t){this._updateGraphic(),this._clearConstraints(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),b.outline):this.removeHandles(b.outline),t.regularVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.regularVertices),b.regularVertices):this.removeHandles(b.regularVertices),t.activeVertex!=null?this.addHandles(this.onActiveVertexChanged(t.activeVertex),b.activeVertex):this.removeHandles(b.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(it)):this._destroyAllVisualisations()}get _tooltipInfo(){var n;const{drawOperation:t,graphic:e,view:i}=this;if(!t)return null;const o=this.tooltipInfos,s=(n=e==null?void 0:e.geometry)==null?void 0:n.type;switch(this.geometryType){case"point":return i.type==="2d"&&this.defaultZ===0?null:s==="point"?o.point:null;case"polyline":return s==="polyline"?o.polyline:null;case"polygon":return s==="polygon"?o.polygon:null;case"rectangle":return s==="polygon"?o.rectangle:null;case"circle":return s==="polygon"?o.circle:null;case"mesh":return s==="mesh"?o.mesh:null;default:return null}}_updateTooltipInfo(){const{_tooltipInfo:t,tooltip:e}=this;if(t&&e){switch(t.type){case"draw-point":this._updateDrawPointTooltipInfo(t);break;case"draw-polyline":this._updateDrawPolylineTooltipInfo(t);break;case"draw-polygon":this._updateDrawPolygonTooltipInfo(t);break;case"draw-rectangle":this._updateDrawRectangleTooltipInfo(t);break;case"draw-circle":this._updateDrawCircleTooltipInfo(t);break;case"draw-mesh":this.updateDrawMeshTooltipInfo(t)}e.info=t}}_updateDrawPointTooltipInfo(t){const{drawOperation:e,graphic:i,view:o,tooltipOptions:s}=this,{elevationInfo:n,stagedVertex:a}=e;if(t.tooltipOptions=s,t.viewType=o.type,t.helpMessage=tt("point",i==null?void 0:i.geometry),this.updateElevation(t.elevation),!a)return void(e.constraint=void 0);const u=e.coordinateHelper.spatialReference;e.constraint=this._getPointConstraint(this._getElevationConstraint(t.elevation.committed,u,o,n))}_updateDrawPolylineTooltipInfo(t){const e=this._createOperationGeometry,i=e!=null?e.full:null;if((i==null?void 0:i.type)!=="polyline")return;const{drawOperation:o,tooltipOptions:s,view:n}=this,{lastVertex:a,stagedVertex:u}=o;this._updatePolylineOrPolygonCommon(t,u);const p=Ue(i,this._elevationMode);t.totalLength.actual=p??w,t.totalLength.hidden=length==null||!a,t.tooltipOptions=s,t.viewType=n.type,t.helpMessage=tt("polyline",i),this.updateElevation(t.elevation)}_updateDrawPolygonTooltipInfo(t){const e=this._createOperationGeometry,i=e!=null?e.full:null;if((i==null?void 0:i.type)!=="polygon")return;const{drawOperation:o,tooltipOptions:s,view:n}=this,{lastVertex:a}=o;let u=o.stagedVertex;(i==null?void 0:i.type)==="polygon"&&a&&!u&&(u=i.getPoint(0,i.rings[0].length-1)),this._updatePolylineOrPolygonCommon(t,u);const p=Tt(i,this._elevationMode);t.area.actual=p??F,t.area.hidden=p==null&&!a,t.tooltipOptions=s,t.viewType=n.type,t.helpMessage=tt("polygon",i),this.updateElevation(t.elevation)}_updatePolylineOrPolygonCommon(t,e){const{view:i,drawOperation:o}=this,{elevationInfo:s,lastVertex:n}=o;if(!n||!e)return t.distance.hidden=!0,t.orientation.hidden=!0,void(o.constraint=void 0);const a=Ee(n,e,this._elevationMode);t.distance.actual=a??w,t.distance.hidden=!1;const u=qe(n,e);t.orientation.actual=u??St,t.orientation.hidden=!1;const p=o.coordinateHelper.spatialReference;o.constraint=this._getPolylineOrPolygonConstraint(this._getDistanceConstraint(n,t.distance.committed,i,s),this._getOrientationConstraint(n,t.orientation.committed,i,s),this._getElevationConstraint(t.elevation.committed,p,i,s))}updateDrawMeshTooltipInfo(t){}_updateDrawRectangleTooltipInfo(t){t.tooltipOptions=this.tooltipOptions,t.xSize=this._xSize??w,t.ySize=this._ySize??w,t.area=this._fullGeometryArea??F}_updateDrawCircleTooltipInfo(t){const{forceUniformSize:e}=this;t.tooltipOptions=this.tooltipOptions,t.radius=e?this._circleRadius??w:null,t.xSize=e?null:this._xSize??w,t.ySize=e?null:this._ySize??w,t.area=this._fullGeometryArea??F}get _circleRadius(){var e;const t=this._createOperationGeometry;return((e=t==null?void 0:t.circle)==null?void 0:e.center)!=null&&t.circle.edge!=null?et(t.circle.center,t.circle.edge,this._elevationMode):null}get _xSize(){var e,i;const t=(i=(e=this._createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:i.midpoints;return t!=null?et(t.left,t.right,this._elevationMode):null}get _ySize(){var e,i;const t=(i=(e=this._createOperationGeometry)==null?void 0:e.rectangle)==null?void 0:i.midpoints;return t!=null?et(t.top,t.bottom,this._elevationMode):null}get _fullGeometryArea(){var e;const t=(e=this._createOperationGeometry)==null?void 0:e.full;return(t==null?void 0:t.type)!=="polygon"?null:Tt(t,this._elevationMode)}updateElevation(t){t.actual=this._vertexTooltipElevation}get _vertexTooltipElevation(){const{tooltipOptions:t,view:e,drawOperation:i}=this;if(i==null)return this._defaultElevation;const o=i.stagedVertex??i.lastVertex;if(o==null||e.type==="2d")return this._defaultElevation;const s={mode:t.elevation.mode,offset:0},n=(we(e,o,i.elevationInfo,s)??0)*de(o.spatialReference);return J(n,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}_clearConstraints(){for(const[,t]of Object.entries(this.tooltipInfos))t.unlockAllFields()}};r([l()],d.prototype,"_createOperationGeometry",void 0),r([l()],d.prototype,"_defaultElevation",null),r([l({value:!0})],d.prototype,"centered",null),r([l()],d.prototype,"cursor",null),r([l({nonNullable:!0})],d.prototype,"defaultZ",void 0),r([l()],d.prototype,"drawOperation",void 0),r([l({value:!0})],d.prototype,"enabled",null),r([l({value:!0})],d.prototype,"forceUniformSize",null),r([l({constructOnly:!0})],d.prototype,"geometryType",void 0),r([l()],d.prototype,"graphic",null),r([l({constructOnly:!0})],d.prototype,"graphicProperties",void 0),r([l()],d.prototype,"graphicSymbol",null),r([l({constructOnly:!0})],d.prototype,"hasZ",void 0),r([l({constructOnly:!0,type:Ut})],d.prototype,"labelOptions",void 0),r([l({constructOnly:!0})],d.prototype,"geometryToPlace",void 0),r([l({constructOnly:!0})],d.prototype,"mode",void 0),r([l()],d.prototype,"snappingManager",void 0),r([l()],d.prototype,"snapToScene",void 0),r([l()],d.prototype,"tooltip",void 0),r([l()],d.prototype,"tooltipInfos",void 0),r([l({constructOnly:!0,type:Et})],d.prototype,"tooltipOptions",void 0),r([l({readOnly:!0})],d.prototype,"type",void 0),r([l({readOnly:!0})],d.prototype,"updating",null),r([l({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),r([l()],d.prototype,"_tooltipInfo",null),r([l()],d.prototype,"_circleRadius",null),r([l()],d.prototype,"_xSize",null),r([l()],d.prototype,"_ySize",null),r([l()],d.prototype,"_fullGeometryArea",null),r([l()],d.prototype,"_vertexTooltipElevation",null),r([l()],d.prototype,"_elevationMode",null),d=r([V("esri.views.draw.DrawGraphicTool")],d);const it="create-operation-graphic",b={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Ei(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Gt=48;function Di(t,e){return At(t,e,!1)}function Li(t,e){return At(t,e,!0)}function At(t,e,i){if(t instanceof Ae){if(t.operation instanceof He)return ri(t.operation,e,i),!0;if(t.operation instanceof Ne)return ai(t.operation,e,i),!0;if(t.operation instanceof We)return si(t.operation,e,i),!0}return!1}function ri(t,e,i=!1){const o=i?-1:1,s=ye(o*t.dx,o*t.dy,o*t.dz);ge(e.origin,e.origin,s),X(e)}function ai(t,e,i=!1){const o=i?-t.angle:t.angle;vt(e.basis1,e.basis1,xt,o),vt(e.basis2,e.basis2,xt,o),X(e)}function si(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;wt(e.basis1,e.basis1,o),wt(e.basis2,e.basis2,s),_t(e.origin,e.origin,t.origin,t.axis1,o),_t(e.origin,e.origin,t.origin,t.axis2,s),X(e)}function Fi(t,e,i,o){o||(o=Fe());const s=E(N.get(),t[1],-t[0]),n=E(N.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=E(N.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=N.get();e.components.forEach(y=>y.vertices.forEach(g=>{const c=g.pos;E(u,$t(t,c),$t(s,c)),fe(n,n,u),me(a,a,u)}));const p=1e-6,h=E(N.get(),a[0]-n[0]<p?i/2:0,a[1]-n[1]<p?i/2:0);return ve(n,n,h),K(a,a,h),Ot(o.basis1,t,(a[0]-n[0])/2),Ot(o.basis2,s,(a[1]-n[1])/2),E(o.origin,n[0]*t[0]+n[1]*s[0],n[0]*t[1]+n[1]*s[1]),K(o.origin,o.origin,o.basis1),K(o.origin,o.origin,o.basis2),X(o),o}export{d as K,Di as V,Ei as X,B as g,Fi as l,Li as x};

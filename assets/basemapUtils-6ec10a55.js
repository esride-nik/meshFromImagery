import{s,R as c}from"./Basemap-8d62c69e.js";import{an as T,b9 as q,m as y,ba as x,bb as U,bc as M,V as h,bd as k,be as A,bf as C}from"./index-b516d057.js";const p=T.getLogger("esri.support.basemapUtils");function D(){return{}}function W(e){for(const n in e){const a=e[n];q(a),delete e[n]}}function G(e,n){let a;if(typeof e=="string"){const t=e in s,r=!t&&e.includes("/");if(!t&&!r){const l=Object.entries(s).filter(([i,u])=>y.apiKey&&!u.classic||!y.apiKey&&(u.classic||u.is3d)).map(([i])=>`"${i}"`).sort().join(", ");return p.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`),null}n&&(a=n[e]),a||(a=t?c.fromId(e):new c({style:{id:e}}),n&&(n[e]=a))}else a=x(c,e);return a!=null&&a.destroyed&&(p.warn("The provided basemap is already destroyed",{basemap:a}),a=null),a}function _(e){var n;return((n=e.portalItem)==null?void 0:n.type)==="Web Scene"}function $(e){var n,a;return!!((a=(n=e==null?void 0:e.portalItem)==null?void 0:n.tags)!=null&&a.some(t=>t.toLowerCase()==="beta"))}function z(e,n){var a,t,r,l;return((t=(a=e.basemap)==null?void 0:a.referenceLayers)==null?void 0:t.some(i=>i.uid===n))||((l=(r=e.basemap)==null?void 0:r.baseLayers)==null?void 0:l.some(i=>i.uid===n))}function F(e,n=null){const a=G(e);if(!a)return null;const t=a.clone();return n&&(t.baseLayers=b(t.baseLayers,n.baseLayers),t.referenceLayers=b(t.referenceLayers,n.referenceLayers)),t}function K(e){let n=null;const a=o(e),t=!(a!=null&&a.baseLayers.length);for(const r in s){const l=R(a,g(s[r]),{mustMatchReferences:t});if(l==="equal"){n=r;break}l==="base-layers-equal"&&(n=r)}return n}function H(e,n){var a,t;return e===n||((a=e==null?void 0:e.portalItem)==null?void 0:a.id)!=null&&e.portalItem.id===((t=n==null?void 0:n.portalItem)==null?void 0:t.id)?!0:R(o(e),o(n),{mustMatchReferences:!0})==="equal"}function b(e,n){const a=new h;return e.forEach(t=>{const r=n.find(l=>l.type!=="scene"&&I(f(t),f(l)))||t;a.includes(r)?a.push(t):a.push(r)}),a}function J(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(V))}function V(e){if(d(e.url))return!0;if(e.type==="vector-tile")for(const n in e.sourceNameToSource){const a=e.sourceNameToSource[n];if(d(a==null?void 0:a.sourceUrl))return!0}return!1}function P(e,n){var l;if(n==null||e==null)return{spatialReference:null,updating:!1};if(n.loadStatus==="not-loaded")return n.load(),{spatialReference:null,updating:!0};if(n.spatialReference)return{spatialReference:n.spatialReference,updating:!1};if(n.baseLayers.length===0)return{spatialReference:null,updating:!1};const a=n.baseLayers.at(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const t=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?(l=a.tileInfo)==null?void 0:l.spatialReference:a.spatialReference]).filter(Boolean),r=e.spatialReference;return r?{spatialReference:t.find(i=>r.equals(i))??t[0]??null,updating:!1}:{spatialReference:t[0],updating:!1}}const j=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function d(e){if(!e)return!1;const n=new U(M(e));return!!n.authority&&j.test(n.authority)}function o(e){return e?!e.loaded&&e.resourceInfo?g(e.resourceInfo.data):{baseLayers:m(e.baseLayers),referenceLayers:m(e.referenceLayers)}:null}function m(e){return(h.isCollection(e)?e.toArray():e).map(f)}function f(e){var n,a;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:w("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(n=e.sublayers)==null?void 0:n.map(t=>({id:t.id,visible:t.visible})),activeLayerId:e.type==="wmts"?(a=e.activeLayer)==null?void 0:a.id:void 0}}function L(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function g(e){return e?{baseLayers:v((e.baseMapLayers??[]).filter(n=>!L(n))),referenceLayers:v((e.baseMapLayers??[]).filter(n=>L(n)))}:null}function v(e){return e.map(n=>N(n))}function N(e){let n;switch(e.layerType){case"VectorTileLayer":n="vector-tile";break;case"ArcGISTiledMapServiceLayer":n="tile";break;case"ArcGISSceneServiceLayer":n="scene";break;default:n="unknown"}return{type:n,effect:e.effect,url:w(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function R(e,n,a){return e!=null!=(n!=null)?"not-equal":!e||!n?"equal":S(e.baseLayers,n.baseLayers)?S(e.referenceLayers,n.referenceLayers)?"equal":a.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function S(e,n){if(e.length!==n.length)return!1;for(let a=0;a<e.length;a++)if(!I(e[a],n[a]))return!1;return!0}function I(e,n){if(e.type!==n.type||e.url!==n.url||e.minScale!==n.minScale||e.maxScale!==n.maxScale||e.visible!==n.visible||e.opacity!==n.opacity||!k(e.effect,n.effect))return!1;if(e.activeLayerId!=null||n.activeLayerId!=null)return e.activeLayerId===n.activeLayerId;if(e.sublayers!=null||n.sublayers!=null){if(e.sublayers==null||n.sublayers==null||e.sublayers.length!==n.sublayers.length)return!1;for(let a=0;a<e.sublayers.length;a++){const t=e.sublayers.at(a),r=n.sublayers.at(a);if((t==null?void 0:t.id)!==(r==null?void 0:r.id)||(t==null?void 0:t.visible)!==(r==null?void 0:r.visible))return!1}}return!0}function w(e){return e?A(e).replace(/^\s*https?:/i,"").toLowerCase():""}function Q(e){if(!e)return null;const{thumbnailUrl:n}=e;if(n)return n;const a=K(e);return a?s[a].thumbnailUrl:C(e.baseLayers,B)}function B(e){var n;return"portalItem"in e?(n=e.portalItem)==null?void 0:n.thumbnailUrl:void 0}export{$ as L,Q as O,H as R,z as S,P as U,G as b,_ as d,V as j,W as m,F as v,J as w,D as y};

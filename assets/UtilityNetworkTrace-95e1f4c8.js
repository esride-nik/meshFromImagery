import{ah as P,di as O,eJ as de,D as pe,eH as le,dU as J,eL as ae,kq as j,bg as ge,an as me,s as Z,cc as W,B as _e,w as ye,V as we,a5 as h,a6 as u,a9 as oe,km as ne,lu as ce,j as fe,cb as B,_ as m}from"./index-b516d057.js";import{e as x,O as ve,n as a,r as be,S as Ae,i as Te}from"./jsxFactory-92036771.js";import{e as D}from"./globalCss-94006b67.js";import{e as Re}from"./vmEvent-d773b6c5.js";import Se from"./FeatureLayer-c4c5819f.js";import{d as Fe,n as K,f as ke}from"./UtilityNetwork-8891cbdb.js";import{t as Ie}from"./utils-969a0551.js";import{trace as Ce}from"./trace-2db83606.js";import{u as Ee,a as Q}from"./TraceParameters-7784f5d1.js";import{geodesicBuffer as X,buffer as Y,convexHull as H,geodesicArea as Me,planarArea as Ge,cut as ee,planarLength as E}from"./geometryEngine-656a968c.js";import"./uuid-709b6c67.js";import"./jsonUtils-52514725.js";import"./DictionaryLoader-e327eff9.js";import"./Version-1f969b2a.js";import"./FieldsIndex-e8db657f.js";import"./UnknownTimeZone-a05df022.js";import"./HeatmapColorStop-3fff4333.js";import"./heatmapUtils-7f42325f.js";import"./FeatureLayerBase-0746b503.js";import"./HeightModelInfo-b816d32b.js";import"./featureLayerUtils-16361d1f.js";import"./featureQueryAll-40af0622.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./AttachmentQuery-bede5a71.js";import"./RelationshipQuery-2c9e4485.js";import"./LayerFloorInfo-4234db4d.js";import"./serviceCapabilitiesUtils-42d4d20c.js";import"./editsZScale-e45bb69c.js";import"./queryZScale-d7a48772.js";import"./APIKeyMixin-bfb00271.js";import"./EditBusLayer-caf9fed8.js";import"./FeatureEffectLayer-1948d1a0.js";import"./FeatureEffect-c80bb16d.js";import"./FeatureFilter-55dd341e.js";import"./FeatureReductionLayer-443167bc.js";import"./clusterUtils-50a66940.js";import"./MD5-715f37cd.js";import"./FeatureReductionSelection-d84c375a.js";import"./LabelClass-c3c309a8.js";import"./labelUtils-b29175f3.js";import"./defaults-4faa92e6.js";import"./defaultsJSON-59981e75.js";import"./OrderedLayer-32293fe1.js";import"./FeatureTemplate-d1d1c7be.js";import"./FeatureType-f30c4b8b.js";import"./fieldProperties-8c831c84.js";import"./labelingInfo-aae625ac.js";import"./versionUtils-5892620e.js";import"./styleUtils-a3d96bf6.js";import"./TopFeaturesQuery-6d0bf5f5.js";import"./geometryEngineBase-dfbd3a67.js";import"./hydrated-40effdd0.js";function V(e){return e.type==="polygon"||e.type==="polyline"}function Ne(e){return e.hasOwnProperty("points")}function Le(e){return Ne(e)&&e.points.length===2}class he{createBuffer(t,s,i,r){if(Array.isArray(t)){if(t.length>0){const o=P.fromJSON(t[0].spatialReference);return o.isWGS84||o.isWebMercator?X(t,s,i):Y(t,s,i,r)}return}const l=P.fromJSON(t.spatialReference);return l.isWGS84||l.isWebMercator?X(t,s[0],i):Y(t,s[0],i)}createConvexHull(t){if(Array.isArray(t)){if(t.length===1&&Le(t[0])){const i=H(t[0]);if(V(i))return i}return H(t,!0).filter(V)}const s=H(t);if(V(s))return s}calculateArea(t,s){const i=new P({wkid:t.spatialReference.wkid});return i.isWGS84||i.isWebMercator?parseFloat(Me(t,s).toFixed(2)):parseFloat(Ge(t,s).toFixed(2))}mergeAggregatedToGeometries(t){const s=[],{line:i,multipoint:r,polygon:l}=t;return i&&s.push(i),r&&s.push(r),l&&s.push(l),s}getPercentageAlong(t,s,i){let r=t;const l=this._createPolyline(t.paths,i.wkid);if(s.type==="point"){const n=s.x-5,c=s.x+5,p=[[n,s.y-5],[c,s.y+5]];r=this._createPolyline(p,s.spatialReference.wkid),r=O(r,i);const g=ee(l,r);if(g.length>0){const f=E(l,"feet");let _;return _=g[0].paths[0][0][0]===l.paths[0][0][0]?E(g[0],"feet"):E(g[1],"feet"),[_/f]}return[.5]}r=O(s,i);const o=ee(l,r);if(o.length>0){const n=E(l,"feet");return[E(o[0],"feet")/n]}return[.5]}async projectGeometry(t,s){return await de(),O(t,s)}_createPolyline(t,s){return new pe({hasZ:!1,hasM:!0,paths:t,spatialReference:{wkid:s}})}}const Pe=[227,27,21,.6],Oe=[21,244,21,.6],L=12,z=[{color:[255,0,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff0000"},{color:[255,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ff00ff"},{color:[217,188,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#D9BCFF"},{color:[0,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#00ff00"},{color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#ffff00"},{color:[0,0,255,.6],haloOpacity:.9,fillOpacity:.2,hex:"#0000ff"},{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},{color:[0,0,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#000000"}];class Be{constructor(){this.highlightColor=[...z]}addCustomColor(t){this.highlightColor=[...z],this.highlightColor.some(s=>s.hex.toLowerCase()===t.hex.toLowerCase())||this.highlightColor.push(t)}getFlagGraphic(t,s,i,r){const l=s==="starting-point"?Oe:Pe;if(t.type==="polygon"){const o=t;o.centroid&&(t=o.centroid)}return r?this.makeGraphic(t,l,i==null?void 0:i.attributes,null,r):this.makeGraphic(t,l,i==null?void 0:i.attributes)}makeGraphic(t,s,i,r,l){let o,n=t;switch(t.type){case"multipoint":o={type:"simple-marker",color:s,size:L,outline:{color:s,width:0}},r&&(n=t);break;case"point":o=l||{type:"simple-marker",color:s,size:L,outline:{color:s,width:0}},r&&(n=t);break;case"polyline":o={type:"simple-line",color:s,width:L},r&&(n=t);break;case"polygon":o={type:"simple-fill",color:s,outline:{color:s,width:L}},r&&(n=t)}return new le({geometry:n,symbol:o,attributes:i??null})}}const S=`utility-network-trace-result-area-${Date.now()}`;function M(e){return e.type==="graphics"}class xe{constructor(){this.traceInformation={},this._geometryHandler=new he}addResultAreaToMap(t,s){const i=this.createGraphicLayer(s);i&&M(i)&&i.add(t)}changeResultAreaColor(t,s,i){const r=this._findGraphicsByTraceId(t,i);r&&r.forEach(l=>{const o=new J({color:s.color,style:"solid",outline:{color:s.color,width:1}});l.symbol=o})}createBuffer(t,s,i,r){return this._geometryHandler.createBuffer(t,s,i,r)}createConvexHull(t,s,i){const r=this._geometryHandler.createConvexHull(t);return s>0&&r?this.createBuffer(r,[s],i,!1):r}createResultAreaGraphic(t,s,i,r,l,o){var p;const n=new J({color:o.color,style:"solid",outline:{color:o.color,width:1}}),c=[];for(const g in s)c.push({fieldName:g,label:g==="areaStatistic"?r.attributeStrings[g]+" ("+((p=l.units[i])==null?void 0:p.abbr)+")":r.attributeStrings[g],value:s[g]});return new le({geometry:t,symbol:n,attributes:s,popupTemplate:{title:s.traceName,content:[{type:"fields",fieldInfos:c}]}})}removeResultArea(t,s){const i=s.findLayerById(S);if(i&&M(i)){const r=this._findGraphicsByTraceId(t,s);return r&&i.removeMany(r),r}return null}removeAllResultAreaGraphics(t){if(t){const s=t.findLayerById(S);s&&M(s)&&s.removeAll()}}createGraphicLayer(t,s){const i=t.findLayerById(S);if(i&&M(i))return i;const r=new ae({title:s??S,listMode:"hide",id:S});return t.add(r),r}_findGraphicsByTraceId(t,s){const i=s.findLayerById(S);if(i&&M(i)){const r=i.graphics.filter(l=>l.attributes.traceId===t);return r.length>0?r.toArray():null}return null}}function te(e){return e.type==="feature"}function $(e,t){return e.url.includes(t)}function se(e,t){var s;return(((s=e.dataElement)==null?void 0:s.domainNetworks)||[]).some(i=>i.subnetworkLayerId===t.layerId)}class De{getValidUtilityNetworkLayers(t,s){const i=[];return t==null||t.allLayers.forEach(r=>{r.type==="group"?i.push(...r.layers.filter(j).filter(l=>te(l)&&s.isUtilityLayer(l)&&!se(s,l)).filter(l=>$(l,s.featureServiceUrl)).toArray()):r.type==="subtype-group"?i.push(...r.sublayers.filter(l=>$(l,s.featureServiceUrl)).toArray()):j(r)&&te(r)&&s.isUtilityLayer(r)&&!se(s,r)&&$(r,s.featureServiceUrl)&&i.push(r)}),i}}const He=()=>ne("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace"),Ve=()=>ne("esri/core/t9n/Units"),G=`utility-network-trace-flags-${Date.now()}`,N=`utility-network-trace-results-${Date.now()}`;function $e(e){return e instanceof ce}function Ue(e){return e.layer.type==="feature"||e.layer.type==="subtype-group"}function je(e){return"layer"in e}function We(e){return e.layerViews!==void 0}function ze(e){return e.type==="graphics"}async function qe(e){var i;const t=new Se({url:e.networkSystemLayers.dirtyAreasLayerUrl});await t.load();const s=t.version;if(Number(s)<=11.1){const r=new fe({url:new URL(e.layerUrl).origin+"/portal"});await r.load();const l=(i=r==null?void 0:r.user)==null?void 0:i.username;return!!l&&Ie(r,l,"utilityNetwork")}return!0}let w=class extends ge.EventedAccessor{constructor(e){super(e),this._activeProgress=!1,this._clickHandler=null,this._flags=[],this._geometryHandler=null,this._highlightHandler=[],this._resultAreaHandler=null,this._utilityHelper=new De,this._traces=[],this._watchHandler=null,this._validUNLayers=[],this._traceTimeout=6e5,this.graphicHandler=null,this.defaultGraphicColor={color:[255,255,0,.6],haloOpacity:.9,fillOpacity:.2,hex:"#FFFF00"},this.enableResultArea=!1,this.flags=[],this.gdbVersion="sde.DEFAULT",this.messages=null,this.messagesUnits=null,this.defaultResultAreaProperties={type:"convexhull",distance:10,unit:"meters",areaUnit:"square-meters",color:{color:[255,165,0,.5],haloOpacity:.9,fillOpacity:.2,hex:"#ffa500"},show:!1},this.selectedTraces=[],this.selectOnComplete=!0,this.showGraphicsOnComplete=!0,this.showSelectionAttributes=!0,this.traceResults=[],this.utilityNetwork=null}initialize(){this._geometryHandler=new he,this.graphicHandler=new Be,this._resultAreaHandler=new xe,(async()=>{const[e,t]=await Promise.all([He(),Ve()]);this.set({messages:e,messagesUnits:t})})()}destroy(){this.view=null}get resultAreaProperties(){return this.defaultResultAreaProperties}set resultAreaProperties(e){this._set("resultAreaProperties",{...this.defaultResultAreaProperties,...e}),this.graphicHandler.addCustomColor(this.resultAreaProperties.color),this.traceResults.forEach(t=>{t.resultArea={...this.defaultResultAreaProperties,...e};const s=t.resultArea.show;this.removeResultAreaFromMap(t),s&&this.enableResultArea&&this.addResultAreaToMap(t)})}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"loading"}get view(){return this._get("view")}set view(e){e&&e.type!=="2d"&&me.getLogger(this).error(new Z("view:invalid-view","SceneView is not supported",{view:e})),this._set("view",e)}addFlagByHit(e,t){const s=i=>{var r;(r=this.view)!=null&&r.popup&&(this.view.popupEnabled=i)};return new Promise((i,r)=>{var l,o;s(!1),(l=this._clickHandler)==null||l.remove(),this.emit("add-flag",{type:e}),this._clickHandler=(o=this.view)==null?void 0:o.on("click",n=>{this.queryFlagByHitTest(n,e,t).then(c=>{var p;s(!0),(p=this._clickHandler)==null||p.remove(),this.emit("add-flag-complete",{type:e,symbol:t}),i(c)}).catch(c=>{var p;s(!0),(p=this._clickHandler)==null||p.remove(),this.emit("add-flag-error",{type:e,symbol:t}),r(c)})})})}async addFlagsOnLoad(){return new Promise(e=>{const t=[];this._watchHandler=W(()=>this.view!=null&&!this.view.updating,async()=>{if(this._flags.length>0)e(t);else{const s=this.flags.map(async i=>{if(i.mapPoint){const r=new _e({x:i.mapPoint.x,y:i.mapPoint.y,spatialReference:i.mapPoint.spatialReference.wkid}),l={screenPoint:this.view.toScreen(r),mapPoint:r};await this.queryFlagByHitTest(l,i.type)||(i.type==="barrier"?t.push("barrier"):t.push("starting-point"))}});await Promise.all(s),e(t)}},{initial:!0})})}addResultAreaToMap(e){var t,s,i;if(e.resultArea.show=!0,((t=e.results)==null?void 0:t.aggregatedGeometry)!==null){const r=this._geometryHandler.mergeAggregatedToGeometries((s=e.results)==null?void 0:s.aggregatedGeometry);if(r.length>0){const l=Array(r.length).fill((i=e.resultArea)==null?void 0:i.distance);this.createResultAreaGeometries(e,r,l)}}else{const r=this._groupResultsByNetworkSource(e.results.elements),l=[];for(const o in r)l.push(this.queryFeaturesById(r[o]));Promise.all(l).then(o=>{var p;const n=[];for(const g of o)for(const f of g)for(const _ of f.featureSet.features)n.push(_.geometry);const c=Array(n.length).fill((p=e.resultArea)==null?void 0:p.distance);this.createResultAreaGeometries(e,n,c)}).catch(o=>{console.log(o)})}}async addResultGraphicToView(e,t){var r;const{view:s}=this,{results:i}=e;if(s&&i){for(const l in i.aggregatedGeometry)if("line,multipoint,polygon".includes(l)){const o=l,n=i.aggregatedGeometry[o];if(n!=null){n.spatialReference=this.utilityNetwork.spatialReference,e.graphicEnabled=!0;const c=await this._geometryHandler.projectGeometry(n,s.spatialReference),p={globalid:e.trace.globalId};if(c!==null){const g=this.graphicHandler.makeGraphic(c,t.color,p,s.spatialReference);(r=this._getGraphicLayer(N))==null||r.add(g)}}}}}addTerminal(e,t){const s=[...this._flags];s.forEach(i=>{var r,l;i.globalId===t.globalId&&((r=t.selectedTerminals)!=null&&r.includes(parseInt(e,10))||((l=i.selectedTerminals)==null||l.push(parseInt(e,10))))}),this._flags=s}async callTrace(){const e=this._traces.filter(t=>t.selected);return e.length>0&&(this.traceResults.length>0&&this.traceResults.forEach(t=>{this.removeResultGraphicFromView(t)}),this.traceResults=[],this.removeSelection(),await Promise.all(e.map(async(t,s)=>{const i=t,r=new Ee({gdbVersion:this.gdbVersion,moment:null,traceType:i.traceType,traceLocations:this._flags,namedTraceConfigurationGlobalId:i.globalId,traceConfiguration:null,outSpatialReference:null,resultTypes:null});await this.executeTrace(i,this.utilityNetwork.networkServiceUrl,r).then(l=>{if(l.hasOwnProperty("results")){const o={...l};if(o.results!==null){o.resultArea={...this.resultAreaProperties};const n=[...o.results.elements];o.results.elements.length=0;const c=new Map;for(const g of n)c.has(g.globalId)||(c.set(g.globalId,!0),o.results.elements.push(g));const p=[...this.traceResults];p.splice(s,0,o),this.traceResults=p,o.results!==null&&(this.selectOnComplete&&this.mergeSelection(!0,o.trace),this.showGraphicsOnComplete&&this.addResultGraphicToView(o,o.graphicColor),this.enableResultArea&&o.resultArea.show&&this.addResultAreaToMap(o))}else{const n=[...this.traceResults];n.splice(s,0,l),this.traceResults=n}this._activeProgress=!1}else{this._activeProgress=!1;const o=[...this.traceResults];o.splice(s,0,l),this.traceResults=o}}).catch(l=>{throw this._activeProgress=!1,l})})),!0)}changeResultAreaColor(e,t){var s;e.resultArea&&(e.resultArea.color=t,(s=this._resultAreaHandler)==null||s.changeResultAreaColor(e.trace.globalId,t,this.view.map))}changeResultGraphicColor(e,t){const s=[...this.traceResults];s.length>0&&s.forEach(i=>{i.trace.globalId===t.trace.globalId&&(i.graphicColor=e,i.graphicEnabled=!0)}),this.traceResults=s,this.removeResultGraphicFromView(t),this.addResultGraphicToView(t,e)}changeFlagSymbol(e,t){this._flags.length>0&&this._flags.forEach(s=>{s.type===e&&t&&s.mapGraphic&&(s.mapGraphic.symbol=t)})}checkCanTrace(){const e={status:!0,issues:[]};let t=!1;const s=this._flags.some(l=>l.type==="starting-point"),i=this._flags.filter(l=>l.allTerminals!==null);i.length>0&&(t=i.some(l=>l.selectedTerminals.length<=0));let r=[];return s?(r=this._traces.filter(l=>l.selected),r.length<=0?(e.status=!1,e.issues=["noTrace"],t&&(e.status=!1,e.issues=["noTrace","noTerminalSelected"])):t&&(e.status=!1,e.issues=["noTerminalSelected"])):(r=this._traces.filter(l=>l.selected===!0),r.length>0?(e.status=!1,e.issues=["noStart"],t&&(e.status=!1,e.issues=["noStart","noTerminalSelected"])):(e.status=!1,e.issues=["noStart","noTrace"],t&&(e.status=!1,e.issues=["noStart","noTrace","noTerminalSelected"]))),e}checkSelectionExist(){let e=!1;return this._highlightHandler.some(t=>{t&&(e=!0)}),e}clearResult(e){if(!this.view)return;let t=this.traceResults;if(t.length>0){const s=t.filter(i=>i.trace.globalId===e.globalId);s.length>0&&(this.removeResultGraphicFromView(s[0]),this.removeResultAreaFromMap(s[0])),t=t.filter(i=>i.trace.globalId!==e.globalId)}this.traceResults=t,t.length===0?(this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]})):this.mergeSelection(!1,e)}createResultAreaGeometries(e,t,s){var r,l,o,n,c,p,g,f,_,T,F,k,I,C;if(!this.view||!this.resultAreaProperties)return;let i;if(((r=this.resultAreaProperties)==null?void 0:r.type)==="convexhull"?i=(n=this._resultAreaHandler)==null?void 0:n.createConvexHull(t,(l=e.resultArea)==null?void 0:l.distance,(o=e.resultArea)==null?void 0:o.unit):t&&(i=(p=this._resultAreaHandler)==null?void 0:p.createBuffer(t,s,(c=e.resultArea)==null?void 0:c.unit,!0)),i&&Array.isArray(i)){if(i.length>0)for(const R of i){const y=this.getResultAreaAttributes(e,R),A=(_=this._resultAreaHandler)==null?void 0:_.createResultAreaGraphic(R,y,(g=e.resultArea)==null?void 0:g.areaUnit,this.messages,this.messagesUnits,(f=e.resultArea)==null?void 0:f.color);A&&((T=this._resultAreaHandler)==null||T.addResultAreaToMap(A,this.view.map),this.emit("add-result-area",{graphic:A}))}}else{const R=this.getResultAreaAttributes(e,i),y=(I=this._resultAreaHandler)==null?void 0:I.createResultAreaGraphic(i,R,(F=e.resultArea)==null?void 0:F.areaUnit,this.messages,this.messagesUnits,(k=e.resultArea)==null?void 0:k.color);y&&((C=this._resultAreaHandler)==null||C.addResultAreaToMap(y,this.view.map),this.emit("add-result-area",{graphic:y}))}}executeTrace(e,t,s){const i=this._processFlags(s.traceLocations);return s.traceLocations=i,Ce(t,s,{timeout:this._traceTimeout}).then(r=>({trace:e,results:r,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:"success",date:new Date})).catch(r=>({trace:e,results:null,selectionEnabled:!1,graphicEnabled:!1,graphicColor:this.defaultGraphicColor,status:r.message,date:new Date}))}getResultAreaAttributes(e,t){var l,o,n;const{messages:s}=this,i=[],r=[];return this._flags.forEach(c=>{var g,f,_,T;const p=((g=c.displayValue)==null?void 0:g.field)+":"+((f=c.displayValue)==null?void 0:f.value)+";"+s.attributeStrings.globalid+":"+c.globalId+";"+s.attributeStrings.terminalid+":"+c.terminalId+";"+s.attributeStrings.x+":"+((_=c.mapPoint)==null?void 0:_.x)+";"+s.attributeStrings.y+":"+((T=c.mapPoint)==null?void 0:T.y);c.type==="starting-point"?i.push(p):r.push(p)}),{traceId:e.trace.globalId,traceName:e.trace.title,traceDescription:e.trace.description??"",startingPoints:i.toString(),barriers:r.toString(),version:this.gdbVersion,username:ye.credentials[0].userId,date:e.date,elementCount:(l=e.results)==null?void 0:l.elements.length,functionResult:JSON.stringify((o=e.results)==null?void 0:o.globalFunctionResults),areaStatistic:t?this._geometryHandler.calculateArea(t,(n=e.resultArea)==null?void 0:n.areaUnit):0}}getValidSources(){var s;let e=[];const t=((s=this.utilityNetwork.dataElement)==null?void 0:s.domainNetworks)??[];for(const i of t)e=e.concat(i.junctionSources),e=e.concat(i.edgeSources);return e}async loadUtilityNetwork(){var i;const{view:e}=this;if(!e)return null;if(await e.when(),this.utilityNetwork){if(this.utilityNetwork.loaded||await this.utilityNetwork.load(),this.utilityNetwork instanceof Fe){try{await e.map.loadAll(),this._loadUNSupportItems()}catch{this._loadUNSupportItems()}return this.utilityNetwork}return null}const t=e.map,s=(i=t.utilityNetworks)==null?void 0:i.at(0);if(s){if(await s.load(),this.utilityNetwork=s,!await qe(s))throw new Z("utility-network:no-user-type-extension","User type extension not found");try{await t.loadAll(),this._loadUNSupportItems()}catch{}finally{this._loadUNSupportItems()}return s}return null}manageFilterBarrier(e,t){const s=[...this._flags];s.forEach(i=>{i.globalId===t.globalId&&t.type==="barrier"&&i.id===t.id&&(i.isFilterBarrier=e)}),this._flags=s}mergeSelection(e,t){let s=[];const i=[...this.traceResults],r=t.globalId;i.forEach(l=>{var o,n;r===l.trace.globalId&&(l.selectionEnabled=e),l.selectionEnabled&&((o=l.results)==null?void 0:o.elements)!==null&&(s=[...s,...((n=l.results)==null?void 0:n.elements)??[]])}),this.selectResults([...new Set(s)])}async queryFeaturesById(e){var o;const{view:t}=this;if(!t)return null;const s=K(this.utilityNetwork,e),i={layerUrl:s[0].layerUrl,objectIds:s[0].objectIds,outFields:["*"]},r=((o=t.map)==null?void 0:o.allTables.toArray().filter(n=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===s[0].layerUrl}).filter(j))??[];this._getUniqueMapLayerViews(t).filter(({layer:n})=>{var c;return((c=n==null?void 0:n.parsedUrl)==null?void 0:c.path)===s[0].layerUrl}).forEach(({layer:n})=>{n.type!=="feature"&&n.type!=="subtype-group"||r.push(n)});const l=(await Promise.all(r.map(async n=>{const c={layers:new we([n]),layerInfos:[i],returnGeometry:!0,outSpatialReference:t.spatialReference},[p]=await ke(c,!1);return p}))).filter(({featureSet:n})=>n.features.length>0);return l.length>0?l:null}queryFlagByHitTest(e,t,s){return this._lookupFlagByHit(e).then(i=>{const{view:r}=this;if(!r)return!1;if(i.length>0){const l=[...this._flags],o=s;return i.forEach(n=>{var g,f;const c=n.graphic,p=c.attributes.hasOwnProperty("GLOBALID")?c.attributes.GLOBALID:c.attributes.globalid;if(l.filter(_=>_.globalId===p).length<=0){const _=this.graphicHandler.getFlagGraphic(c.mapPoint,t,c,o);(g=this._getGraphicLayer(G))==null||g.add(_),l.push({...c,type:t,globalId:c.attributes.globalid||c.attributes.GLOBALID,details:c,mapGraphic:_,id:l.length+1})}else if(c.percentAlong!==null){const _=this.graphicHandler.getFlagGraphic(c.mapPoint,t,c,o);(f=this._getGraphicLayer(G))==null||f.add(_),l.push({...c,type:t,globalId:c.attributes.globalid||c.attributes.GLOBALID,details:c,mapGraphic:_,id:l.length+1})}}),this._flags=l,!0}return!1})}removeResultGraphicFromView(e){var r;const{view:t}=this;if(!t)return;const s=(r=this._getGraphicLayer(N))==null?void 0:r.graphics;e.graphicEnabled=!1;const i=s==null?void 0:s.filter(l=>l.attributes[l.attributes.hasOwnProperty("GLOBALID")?"GLOBALID":"globalid"]===e.trace.globalId);i==null||i.forEach(l=>{var o;(o=this._getGraphicLayer(N))==null||o.remove(l)})}removeFlag(e){const t=this._flags.filter(s=>{if(s.id!==e.id)return s});this._removeGraphic(e),this._flags=t}removeAllResultAreaGraphics(){var e;(e=this._resultAreaHandler)==null||e.removeAllResultAreaGraphics(this.view.map)}removeResultAreaFromMap(e){var s,i;e.resultArea.show=!1;const t=(i=this._resultAreaHandler)==null?void 0:i.removeResultArea(e.trace.globalId,(s=this.view)==null?void 0:s.map);t&&this.emit("remove-result-area",{graphic:t})}removeSelection(){this._highlightHandler.forEach(e=>{e&&e.remove()}),this._highlightHandler=[]}removeTerminal(e,t){const s=[...this._flags];s.forEach(i=>{var r,l;if(i.globalId===t.globalId&&((r=t.selectedTerminals)!=null&&r.includes(parseInt(e,10)))){const o=t.selectedTerminals.indexOf(parseInt(e,10));(l=i.selectedTerminals)==null||l.splice(o,1)}}),this._flags=s}removeFlagsOnLoadWatcher(){this._watchHandler&&this._watchHandler!==null&&this._watchHandler.remove()}reset(){var t,s;this._flags=[],this.traceResults=[];const e=[...this._traces];e.forEach(i=>{i.selected=!1}),this._traces=e,this.view&&((t=this._getGraphicLayer(N))==null||t.removeAll(),(s=this._getGraphicLayer(G))==null||s.removeAll(),this.removeAllResultAreaGraphics(),this.removeSelection(),this.emit("clear-selection",{resultSet:[]}))}selectFeaturesById(e){const{view:t}=this;if(!t)return;const s=K(this.utilityNetwork,e);this._getUniqueMapLayerViews(t).forEach(i=>{var r,l;je(i)&&((l=(r=i.layer)==null?void 0:r.parsedUrl)==null?void 0:l.path)===s[0].layerUrl&&Ue(i)&&this._highlightHandler.push(i.highlight(s[0].objectIds))})}selectResults(e){if(e.length>0){this.removeSelection();const t=this._groupResultsByNetworkSource(e),s=[];for(const i in t)this.selectFeaturesById(t[i]),s.push(this.queryFeaturesById(t[i]));Promise.all(s).then(i=>{this.emit("select-features",{resultSet:i})})}else this.removeSelection(),this.emit("clear-selection",{resultSet:[]})}selectTraces(e,t){const s=[...this._traces];s.forEach(i=>{t===i.globalId&&(i.selected=e)}),this._traces=s}selectTracesOnLoad(){this.utilityNetwork.hasOwnProperty("sharedNamedTraceConfigurations")&&(this._traces=[...this.utilityNetwork.sharedNamedTraceConfigurations],this._traces.forEach(e=>{e.selected=!1,this.selectedTraces.includes(e.globalId)&&(e.selected=!0)}))}zoomToAsset(e){var t;(t=this.view)==null||t.goTo(e).catch(s=>console.error(s))}_loadUNSupportItems(){var s;const{map:e}=this.view,{messages:t}=this;this._populateOutfields(),this._createGraphicLayer(G),this._createGraphicLayer(N),(s=this._resultAreaHandler)==null||s.createGraphicLayer(e,t==null?void 0:t.alertsStrings.genericResultHeader),this._validUNLayers=this._utilityHelper.getValidUtilityNetworkLayers(e,this.utilityNetwork)}_getUniqueMapLayerViews(e){const t=[];return e.layerViews.filter(({layer:{type:s}})=>s==="feature"||s==="group"||s==="subtype-group").toArray().forEach(s=>{switch(s.layer.type){case"group":if(We(s))for(const i of s.layerViews)t.push(i);break;case"subtype-group":t.push(s);break;default:t.some(i=>i.layer.id===s.layer.id)||t.push(s)}}),t}_processFlags(e){const t=[];return e.forEach(s=>{if(s.selectedTerminals!==null&&s.selectedTerminals.length>0)s.selectedTerminals.forEach(i=>{const r=new Q({globalId:s.globalId,percentAlong:s.percentAlong,terminalId:i,type:s.type,isFilterBarrier:s.isFilterBarrier});t.push(r)});else{const i=new Q({globalId:s.globalId,percentAlong:s.percentAlong,terminalId:null,type:s.type,isFilterBarrier:s.isFilterBarrier});t.push(i)}}),t}_getDisplayField(e){var t;return((t=e==null?void 0:e.layer)==null?void 0:t.type)==="subtype-sublayer"?this._getDisplayFieldBySublayer(e):this._getDisplayFieldByFeatureLayer(e)}_getDisplayFieldBySublayer(e){let t="",s="";const i=e.layer;t=this._checkParentForData(i,"displayField");for(const r in e.attributes){const l=r.toLowerCase();l===(t==null?void 0:t.toLowerCase())?(s=e.attributes[r],l==="assetgroup"||l==="assettype"?s=this._checkSubtype(i,i.subtypeCode):(s=this._checkDomain(i.fields,r,s),typeof s=="string"&&(s=this._defaultDisplayField(s,i)))):(s=this._checkDomain(i.fields,r,s),typeof s=="string"&&(s=this._defaultDisplayField(s,i)))}return{field:t,value:s.toString()}}_getDisplayFieldByFeatureLayer(e){var r,l;const t=e.layer;let s=t.displayField,i="";for(const o in e.attributes){const n=o.toLowerCase();if(n===(s==null?void 0:s.toLowerCase()))if(i=e.attributes[o],n==="assetgroup"||n==="assettype"){let c=e.attributes[t.typeIdField.toUpperCase()];c||(c=e.attributes[t.typeIdField.toLowerCase()]),s=t.typeIdField,i=this._checkSubtype(t,c),s===""&&(t.templates&&t.templates.length>0?(s=(r=t.templates[0])==null?void 0:r.name,i=(l=t.templates[0])==null?void 0:l.name):(s=t.displayField,i=e.attributes[o]))}else i=this._checkDomain(t.fields,o,i),typeof i=="string"&&(i=this._defaultDisplayField(i,t));else i=this._checkDomain(t.fields,o,i),typeof i=="string"&&(i=this._defaultDisplayField(i,t))}return{field:s,value:i?i.toString():""}}_checkSubtype(e,t){let s=t;if(e.type==="subtype-sublayer"){const i=this._checkParentForData(e,"subtypes");(i==null?void 0:i.length)>0&&i.forEach(r=>{r.code===t&&(s=r.name)})}else if(e.types!=null&&e.types.length>0){const i=e.types.filter(r=>r.id===t);i.length>0&&(s=i[0].name)}return s}_checkDomain(e,t,s){var l;let i=s;const r=e.filter(o=>o.name.toLowerCase()===t.toLowerCase());if(r.length>0&&$e(r[0].domain)&&((l=r[0].domain)!=null&&l.codedValues)){const o=r[0].domain.codedValues.filter(({code:n})=>n===s);o.length>0&&(i=o[0].name)}return i}_checkParentForData(e,t){var s;return((s=e.parent)==null?void 0:s[t])??null}_defaultDisplayField(e,t){var s;return e.trim()?e:t.templates&&((s=t.templates)==null?void 0:s.length)>0?t.templates[0].name:t.title}_groupBy(e,t){return e.reduce((s,i)=>((s[i[t]]=s[i[t]]||[]).push(i),s),{})}_groupResultsByNetworkSource(e){return e.length>0?this._groupBy(e,"networkSourceId"):[]}_lookupFlagByHit(e){return this.view.hitTest(e.screenPoint,{include:this._validUNLayers}).then(t=>{var i;const s=[];if(t.results.length>0){const r=t.results.find(l=>l.layer!==null);if(((i=r.graphic)==null?void 0:i.geometry)!=null){if(r.graphic.geometry.type==="polyline"){const l=this._geometryHandler.getPercentageAlong(r.graphic.geometry,e.mapPoint,r.graphic.geometry.spatialReference),o=this._getDisplayField(r.graphic);r.graphic.terminalId=null,r.graphic.isFilterBarrier=!1,r.graphic.allTerminals=null,r.graphic.selectedTerminals=null,r.graphic.percentAlong=l,r.graphic.displayValue=o,r.graphic.mapPoint=r.mapPoint,s.push(r)}else if((r.graphic.geometry.type==="point"||r.graphic.geometry.type==="polygon")&&this.utilityNetwork!==null){const l=this.utilityNetwork.getTerminalConfiguration(r.graphic),o=this._getDisplayField(r.graphic);r.graphic.terminalId=l?l.terminals[0].id||null:1,r.graphic.isFilterBarrier=!1,r.graphic.allTerminals=l??null,r.graphic.selectedTerminals=[l?l.terminals[0].id||null:1],r.graphic.percentAlong=null,r.graphic.displayValue=o,r.graphic.mapPoint=r.mapPoint,s.push(r)}}}return s})}async _populateOutfields(){var s;const e=(s=this.view)==null?void 0:s.map,t=this.getValidSources();e==null||e.layers.forEach(i=>{i.type==="group"?i.layers.forEach(r=>{t.some(l=>l.layerId===r.layerId)&&r.fields.some(l=>l.name.toLowerCase()==="assetgroup")&&(r.outFields=["assetgroup","assettype","globalid","objectid"])}):t.some(r=>r.layerId===i.layerId)&&i.fields.some(r=>r.name.toLowerCase()==="assetgroup")&&(i.outFields=["assetgroup","assettype","globalid","objectid"])})}_removeGraphic(e){var t;(t=this._getGraphicLayer(G))==null||t.remove(e.mapGraphic)}_createGraphicLayer(e){const{map:t}=this.view;if(!t.findLayerById(e)){const s=new ae({title:e,listMode:"hide",id:e});t.add(s)}}_getGraphicLayer(e){const{map:t}=this.view;if(t){const s=t.findLayerById(e);if(s&&ze(s))return s}return null}};h([u()],w.prototype,"_activeProgress",void 0),h([u()],w.prototype,"_flags",void 0),h([u()],w.prototype,"_traces",void 0),h([u()],w.prototype,"defaultGraphicColor",void 0),h([u()],w.prototype,"enableResultArea",void 0),h([u()],w.prototype,"flags",void 0),h([u()],w.prototype,"gdbVersion",void 0),h([u()],w.prototype,"messages",void 0),h([u()],w.prototype,"messagesUnits",void 0),h([u()],w.prototype,"resultAreaProperties",null),h([u()],w.prototype,"selectedTraces",void 0),h([u()],w.prototype,"selectOnComplete",void 0),h([u()],w.prototype,"showGraphicsOnComplete",void 0),h([u()],w.prototype,"showSelectionAttributes",void 0),h([u({readOnly:!0})],w.prototype,"state",null),h([u()],w.prototype,"traceResults",void 0),h([u()],w.prototype,"utilityNetwork",void 0),h([u({value:null})],w.prototype,"view",null),w=h([oe("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceViewModel")],w);const ue=w,b="esri-utility-trace-network",v={base:b,widgetIcon:Te.polyline,loaderContainer:`${b}__loader-container`,loader:`${b}__loader`,fadeIn:`${b}--fade-in`,addButtonContainer:`${b}__add-button-container`,noticeContainer:`${b}__notice-container`,listContainer:`${b}__list-container`,resultsContainer:`${b}__results-container`,flow:`${b}__flow`,numberInput:`${b}__number-input`,clearPrompt:`${b}__reset-prompt`,promptDivider:`${b}__divider`,paddingTop:`${b}__padTop`},Je="esri.widgets.UtilityNetworkTrace";function Ze(e){return{height:e+"px"}}function Ke(e){return{width:e+"px"}}function Qe(){return{width:"75%"}}function ie(){return{textAlign:"center",padding:"1rem"}}function Xe(){return{width:"100%"}}function U(){return{height:"100%"}}function re(e){return{display:"flex",flexDirection:e}}function Ye(e){return e instanceof ce}const et={noExtension:-2147208474};let d=class extends ve{constructor(e,t){super(e,t),this._tracesExists=!0,this._selectToolActive=!1,this._activeTrace=null,this._activeSwatch="",this._traceHeaderForFlow="",this._assetGroupHeader="",this._assetTypeHeader="",this._traceResultsFunctions=[],this._traceResultsAssetGroup=[],this._traceResultsAssetType=[],this._traceResultsIndividual=[],this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this._activeTab="input",this._flagViewType="starting-point",this._alertRemoveModal=!1,this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoStartAssetFound=!1,this._warningNoBarrierAssetFound=!1,this._warningNoTerminal=!1,this._confirmReset=!1,this._showResultOptions=!1,this._resultObjectIdField="objectid",this._resultDisplayField="objectid",this._resultSortField="objectid",this._resultSortOrder="desc",this._swatchNode=null,this._individualResultNode=null,this._symbolStartFlag=null,this._symbolBarrier=null,this._watchHandler=null,this._loadUNError=!0,this._errorMessage="",this.disabled=!0,this.iconClass=v.widgetIcon,this.inputSettings=[],this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new ue,this._afterComponentCreate=this._afterComponentCreate.bind(this)}initialize(){this._utilityNetworkTraceInitialized(),this.addHandles(B(()=>{var e;return(e=this.viewModel)==null?void 0:e.resultAreaProperties},()=>this.scheduleRender()))}get defaultGraphicColor(){return this.viewModel.defaultGraphicColor}set defaultGraphicColor(e){this.viewModel.defaultGraphicColor=e}get flags(){return this.viewModel.flags}set flags(e){this.viewModel.flags=e}get gdbVersion(){return this.viewModel.gdbVersion}set gdbVersion(e){this.viewModel.gdbVersion=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get resultAreaProperties(){return this.viewModel.resultAreaProperties}set resultAreaProperties(e){this.viewModel.resultAreaProperties=e}get selectedTraces(){return this.viewModel.selectedTraces}set selectedTraces(e){this.viewModel.selectedTraces=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get showGraphicsOnComplete(){return this.viewModel.showGraphicsOnComplete}set showGraphicsOnComplete(e){this.viewModel.showGraphicsOnComplete=e}get enableResultArea(){return this.viewModel.enableResultArea}set enableResultArea(e){this.viewModel.enableResultArea=e}get showSelectionAttributes(){return this.viewModel.showSelectionAttributes}set showSelectionAttributes(e){this.viewModel.showSelectionAttributes=e}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(e){this.viewModel.utilityNetwork=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}async checkCanTrace(){this._confirmReset=!1;const e=this.viewModel.checkCanTrace();e.status?(this._warningNoFlag=!1,this._warningNoTraceSelected=!1,this._warningNoTraceSelected=!1,this._warningNoTerminal=!1,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1,this.switchTab("result"),this.viewModel._activeProgress=!0,this.viewModel.removeAllResultAreaGraphics(),await this.viewModel.callTrace(),this.viewModel._activeProgress=!1):e.issues.forEach(t=>{switch(t){case"noStart":this._warningNoFlag=!0;break;case"noTerminalSelected":this._warningNoTerminal=!0;break;default:this._warningNoTraceSelected=!0}})}confirmReset(){this._confirmReset=!0}render(){const{state:e}=this.viewModel;this._mixCustomStrings(),this._overrideFlagSymbol();const t=e==="loading"?this._renderLoading():this._renderUtilityNetworkTrace();return a("div",{class:this.classes(v.base,D.widget,D.panel,{[D.widgetDisabled]:this.disabled}),styles:U()},t)}loadDependencies(){return be({action:()=>m(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),"action-group":()=>m(()=>import("./calcite-action-group-5d605434.js"),["assets/calcite-action-group-5d605434.js","assets/action-group-9d8d0307.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/action-79a6733c.js","assets/interactive-39956fb6.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"]),"action-pad":()=>m(()=>import("./calcite-action-pad-be9169a2.js"),["assets/calcite-action-pad-be9169a2.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/ExpandToggle-3c0498ea.js","assets/action-group-9d8d0307.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/action-79a6733c.js","assets/interactive-39956fb6.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"]),block:()=>m(()=>import("./calcite-block-0b12426c.js"),["assets/calcite-block-0b12426c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/interactive-39956fb6.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/Heading-2d7d203c.js","assets/loadable-7d42c3de.js","assets/openCloseComponent-3fbda1cf.js","assets/action-79a6733c.js","assets/guid-2347ca41.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/FloatingArrow-9e5c8eb0.js","assets/handle-d29406b2.js","assets/scrim-41a5f26e.js"]),"block-section":()=>m(()=>import("./calcite-block-section-fee737f3.js"),["assets/calcite-block-section-fee737f3.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/key-c2c83cc7.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/icon-c122f720.js","assets/label-fe92b4f9.js","assets/label2-0071fcd4.js","assets/switch-bf0dca96.js","assets/form-60623048.js","assets/interactive-39956fb6.js"]),button:()=>m(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),checkbox:()=>m(()=>import("./calcite-checkbox-fef8d84f.js"),["assets/calcite-checkbox-fef8d84f.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),"color-picker-swatch":()=>m(()=>import("./calcite-color-picker-swatch-744eea16.js"),["assets/calcite-color-picker-swatch-744eea16.js","assets/color-picker-swatch-ebbf0614.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js"]),combobox:()=>m(()=>import("./calcite-combobox-7d2cf661.js"),["assets/calcite-combobox-7d2cf661.js","assets/combobox-234207ac.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/floating-ui-a6c9d5df.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/openCloseComponent-3fbda1cf.js","assets/t9n-622f279b.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/chip-9ebcd4a3.js","assets/conditionalSlot-11b5e54d.js","assets/icon-c122f720.js"]),"combobox-item":()=>m(()=>import("./calcite-combobox-item-961b0328.js"),["assets/calcite-combobox-item-961b0328.js","assets/combobox-item-3b86c430.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),flow:()=>m(()=>import("./calcite-flow-e546f579.js"),["assets/calcite-flow-e546f579.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js"]),"flow-item":()=>m(()=>import("./calcite-flow-item-6dd63b22.js"),["assets/calcite-flow-item-6dd63b22.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/panel-4decad7b.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/action-79a6733c.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js","assets/scrim-41a5f26e.js"]),icon:()=>m(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),"input-number":()=>m(()=>import("./calcite-input-number-0916b1b5.js"),["assets/calcite-input-number-0916b1b5.js","assets/input-number-9c00b0ee.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/progress-2100df13.js"]),label:()=>m(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),list:()=>m(()=>import("./calcite-list-2b87684c.js"),["assets/calcite-list-2b87684c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/observers-9c654f26.js","assets/utils3-c1eb0197.js","assets/loadable-7d42c3de.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/input-9795a695.js","assets/form-60623048.js","assets/label2-0071fcd4.js","assets/component-7281ffa6.js","assets/progress-2100df13.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js","assets/scrim-41a5f26e.js"]),"list-item":()=>m(()=>import("./calcite-list-item-acd56289.js"),["assets/calcite-list-item-acd56289.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/utils3-c1eb0197.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/action-79a6733c.js","assets/guid-2347ca41.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/handle-d29406b2.js"]),loader:()=>m(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"]),notice:()=>m(()=>import("./calcite-notice-ae448cb5.js"),["assets/calcite-notice-ae448cb5.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/openCloseComponent-3fbda1cf.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),option:()=>m(()=>import("./calcite-option-7b8b2690.js"),["assets/calcite-option-7b8b2690.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),panel:()=>m(()=>import("./calcite-panel-e7a1d066.js"),["assets/calcite-panel-e7a1d066.js","assets/panel-4decad7b.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/observers-9c654f26.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/key-c2c83cc7.js","assets/action-79a6733c.js","assets/locale-2cb18332.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js","assets/scrim-41a5f26e.js"]),popover:()=>m(()=>import("./calcite-popover-c20a56ef.js"),["assets/calcite-popover-c20a56ef.js","assets/popover-33772892.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/FloatingArrow-9e5c8eb0.js","assets/component-7281ffa6.js","assets/action-79a6733c.js","assets/interactive-39956fb6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),scrim:()=>m(()=>import("./calcite-scrim-5ea722f7.js"),["assets/calcite-scrim-5ea722f7.js","assets/scrim-41a5f26e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),select:()=>m(()=>import("./calcite-select-84c557c7.js"),["assets/calcite-select-84c557c7.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),tab:()=>m(()=>import("./calcite-tab-98662777.js"),["assets/calcite-tab-98662777.js","assets/tab-eb1be4ce.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"]),"tab-nav":()=>m(()=>import("./calcite-tab-nav-dc1fb4c3.js"),["assets/calcite-tab-nav-dc1fb4c3.js","assets/tab-nav-0cd87cbd.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),"tab-title":()=>m(()=>import("./calcite-tab-title-c592fc2e.js"),["assets/calcite-tab-title-c592fc2e.js","assets/tab-title-34da98ef.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/observers-9c654f26.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),tabs:()=>m(()=>import("./calcite-tabs-edb8bed0.js"),["assets/calcite-tabs-edb8bed0.js","assets/tabs-87ec1ac7.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),tooltip:()=>m(()=>import("./calcite-tooltip-5cb74da1.js"),["assets/calcite-tooltip-5cb74da1.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"])})}switchTab(e){this._activeTab=e}switchToFunctions(e,t){this._traceResultsFunctions=e,this._showTraceResultFunctions=t}switchToAssetGroup(e,t,s){this._traceHeaderForFlow=t,this._traceResultsAssetGroup=e,this._showTraceResultAssetGroup=s}switchToAssetType(e,t,s){this._assetGroupHeader=t,this._traceResultsAssetType=e,this._showTraceResultAssetType=s}switchToIndividualRecords(e,t,s){this._assetTypeHeader=t,this._traceResultsIndividual=e,this._showIndividualRecords=s}_renderLoading(){return a("div",{class:v.loaderContainer,key:"loader"},a("div",{class:v.loader}))}_renderUtilityNetworkTrace(){const{messages:e,messagesCommon:t}=this;let s=a("calcite-tabs",{layout:"center",position:"top",styles:Xe()},a("calcite-tab-nav",{slot:"title-group"},a("calcite-tab-title",{onclick:()=>{this.switchTab("input")},selected:this._activeTab==="input"},e.inputsStrings.headerTabInputs),a("calcite-tab-title",{onclick:()=>{this.switchTab("result")},selected:this._activeTab==="result"},e.resultsStrings.headerTabResults)),a("calcite-tab",{selected:this._activeTab==="input"},this._renderInputPanel()),a("calcite-tab",{selected:this._activeTab==="result"},this.viewModel._activeProgress?a("calcite-loader",{label:e.alertsStrings.traceExecuting,text:e.alertsStrings.traceExecuting,type:"indeterminate"}):this.viewModel.traceResults.length>0?this._renderResultPanel():this._renderWarningMessage("noTraceExecuted",!1),this._confirmReset?a("calcite-scrim",{key:"prompt"},a("div",{class:v.clearPrompt},a("h3",{slot:"header"},e.resultsStrings.startOverButton),a("div",{slot:"content"},e.resultsStrings.startOverValidation),a("div",{class:v.promptDivider}),a("div",{styles:re("row")},a("calcite-button",{appearance:"outline",onclick:()=>{this._confirmReset=!1},slot:"secondary",width:"full"},t.cancel),a("calcite-button",{onclick:()=>{this._confirmReset=!1,this.viewModel.reset(),this.switchTab("input")},slot:"primary",width:"full"},t.form.ok)))):null));return this._tracesExists||(s=a("calcite-panel",null,this._renderWarningMessage("noTraceConfig",!1))),this._loadUNError||(s=a("calcite-panel",null,this._renderWarningMessage("loadUNError",!1,this._errorMessage))),s}_renderInputPanel(){const{messages:e}=this;return a("calcite-flow",{class:v.flow},a("calcite-flow-item",null,this._warningNoFlag?this._renderWarningMessage("flag",!0):null,this._warningNoTerminal?this._renderWarningMessage("noTerminal",!0):null,this._warningNoTraceSelected?this._renderWarningMessage("trace",!0):null,this._renderTraceSelectorContainer(),this._renderStartFlagsContainer(),this._renderBarriersFlagsContainer(),this._warningNoFlag&&this._warningNoTraceSelected?a("div",{styles:Ze(10)}):null,a("calcite-button",{kind:"brand",onclick:()=>{this.checkCanTrace()},scale:"m",slot:"footer",width:"full"},e.tracingStrings.runTrace)),this._selectToolActive?this._renderActiveTool():null)}_renderResultPanel(){return a("calcite-flow",{styles:U()},this._renderTraceResults(),this._showTraceResultFunctions?this._renderTraceResultFunctions():null,this._showTraceResultAssetGroup?this._renderTraceResultByAssetGroup():null,this._showTraceResultAssetType?this._renderTraceResultByAssetType():null,this._showIndividualRecords?this._renderTraceResultIndividual():null,this._showIndividualRecords?this._renderTraceResultIndividualPopover():null)}_renderStartFlagsContainer(){const{messages:e}=this,t=[];let s=[];s=this.viewModel._flags.filter(r=>r.type==="starting-point"),s.forEach(r=>{r.displayValue&&t.push(this._renderFlagRow(r,"start"))});let i=null;return this._symbolStartFlag&&(i=this._getSymbolIcon(this._symbolStartFlag)),a("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerStartingPoint+" ("+s.length+")",open:!0},a("div",{slot:"icon"},i||a("calcite-icon",{icon:"pin",scale:"s"})),a("div",null,e.inputsStrings.startingPointHint),a("div",{class:v.listContainer},t),this._warningNoStartAssetFound?this._renderWarningMessage("noStartAsset",!0):null,a("div",{class:v.addButtonContainer},a("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="starting-point",this._selectToolActive=!0,this._warningNoStartAssetFound=!1,this.viewModel.addFlagByHit("starting-point",this._symbolStartFlag).then(r=>{this._changeCursor("default"),r?this._warningNoFlag=!1:this._warningNoStartAssetFound=!0,this._selectToolActive=!1})},round:!0,scale:"m"})))}_renderBarriersFlagsContainer(){const{messages:e}=this,t=[];let s=[];s=this.viewModel._flags.filter(r=>r.type==="barrier"),s.forEach(r=>{r.displayValue&&t.push(this._renderFlagRow(r,"barrier"))});let i=null;return this._symbolBarrier&&(i=this._getSymbolIcon(this._symbolBarrier)),a("calcite-block",{collapsible:!0,heading:e.inputsStrings.headerBarrier+" ("+s.length+")",open:!1},a("div",{slot:"icon"},i||a("calcite-icon",{icon:"x-circle-f",scale:"s"})),a("div",null,e.inputsStrings.barrierPointHint),a("div",{class:v.listContainer},t),this._warningNoBarrierAssetFound?this._renderWarningMessage("noBarrierAsset",!0):null,a("div",{class:v.addButtonContainer},a("calcite-button",{alignment:"center",appearance:"outline",href:"",iconStart:"plus",kind:"brand",label:e.inputsStrings.addPointOption,onclick:()=>{this._changeCursor("crosshair"),this._flagViewType="barrier",this._selectToolActive=!0,this._warningNoBarrierAssetFound=!1,this.viewModel.addFlagByHit("barrier",this._symbolBarrier).then(r=>{this._changeCursor("default"),r||(this._warningNoBarrierAssetFound=!0),this._selectToolActive=!1})},round:!0,scale:"m"})))}_renderFlagRow(e,t){var o;const{messages:s,messagesCommon:i}=this,r=[];let l=!1;return e.allTerminals!=null&&e.allTerminals.terminals.length>0&&(l=!0,e.allTerminals.terminals.forEach(n=>{var p;let c=!1;(p=e==null?void 0:e.selectedTerminals)!=null&&p.includes(n.id)&&(c=!0),r.push(a("calcite-combobox-item",{key:n.name,selected:c,textLabel:n.name,value:n.id}))})),a("calcite-block",{collapsible:e.allTerminals!==null||e.type==="barrier",heading:((o=e.displayValue)==null?void 0:o.value)??"",key:"pop"+e.globalId+e.type+e.id+t},a("calcite-action",{icon:"trash",label:i.remove,onclick:()=>{this.viewModel.removeFlag(e)},scale:"s",slot:"header-menu-actions",text:i.remove,textEnabled:!0}),a("calcite-action",{icon:"zoom-to-object",label:s.globalStrings.zoomToFeature,onclick:()=>{this.viewModel.zoomToAsset(e.details.geometry)},scale:"s",slot:"header-menu-actions",text:s.globalStrings.zoomToFeature,textEnabled:!0}),e.type==="barrier"?a("calcite-label",{layout:"inline",scale:"s"},a("calcite-checkbox",{checked:e.isFilterBarrier,onclick:()=>{this.viewModel.manageFilterBarrier(!e.isFilterBarrier,e)},scale:"s"}),s.inputsStrings.barrierFilter):null,l?a("calcite-combobox",{label:s.globalStrings.selectTerminalPlaceholder,maxItems:0,placeholder:s.globalStrings.selectTerminalPlaceholder,scale:"s",selectionMode:"multiple",onCalciteComboboxChange:n=>{n.target.selectedItems.length>0?(e.selectedTerminals=[],n.target.selectedItems.forEach(c=>{this.viewModel.addTerminal(c.value,e)})):e.selectedTerminals=[]},onCalciteComboboxChipClose:n=>{n.preventDefault(),this.viewModel.removeTerminal(n.target.value,e)}},r):null)}_renderActiveTool(){const{messages:e}=this;let t=null;return this._flagViewType==="starting-point"?this._symbolStartFlag&&(t=this._getSymbolIcon(this._symbolStartFlag)):this._symbolBarrier&&(t=this._getSymbolIcon(this._symbolBarrier)),a("calcite-flow-item",{heading:e.inputsStrings.addPointOption,onCalciteFlowItemBack:()=>{var s;this.viewModel._clickHandler&&(this.viewModel._clickHandler.remove(),(s=this.view)!=null&&s.popup&&(this.view.popupEnabled=!0)),this._selectToolActive=!1}},a("calcite-block",{collapsible:!1,heading:"",open:!0},a("div",{styles:ie()},t||a("calcite-icon",{icon:this._flagViewType==="starting-point"?"pin-plus":"x-circle-f",scale:"m"})),a("div",{styles:ie()},e.inputsStrings.addPointHint)))}_renderTraceSelectorContainer(){const{messages:e}=this,t=[];let s=e.tracingStrings.traceOperation,i=0;return this.viewModel._traces.length>0&&this.viewModel._traces.forEach(r=>{t.push(a("calcite-combobox-item",{key:r.globalId,selected:r.selected,textLabel:r.title,value:r.globalId,onCalciteComboboxItemChange:l=>{const o=l.target;this.viewModel.selectTraces(o.selected,o.value),this.viewModel._traces.length>0&&(this._warningNoTraceSelected=!1)}})),r.selected&&i++}),s+=` (${i})`,a("calcite-block",{collapsible:!0,heading:s,open:!0},a("calcite-icon",{icon:"utility-network-trace",scale:"s",slot:"icon"}),a("calcite-combobox",{label:e.inputsStrings.selectTraces,maxItems:0,overlayPositioning:"fixed",placeholder:e.inputsStrings.selectTraces,scale:"s",selectionMode:"multiple"},t))}_renderStartOverContainer(){const{messages:e}=this;return a("calcite-button",{kind:"brand",onclick:()=>{this.confirmReset()},scale:"m",slot:"footer",width:"full"},e.resultsStrings.startOverButton)}_renderWarningMessage(e,t,s){const{messages:i}=this;let r=i.alertsStrings.NoRunAlertHeader,l=i.alertsStrings.noResultsInfo;switch(e){case"flag":r=i.alertsStrings.startingPointAlertHeader,l=i.alertsStrings.startingPointAlert;break;case"noTerminal":r=i.alertsStrings.noTerminalDefinedHeader,l=i.alertsStrings.noTerminalDefined;break;case"trace":r=i.alertsStrings.selectTraceAlertHeader,l=i.alertsStrings.selectTraceAlert;break;case"noTraceExecuted":r=i.alertsStrings.NoRunAlertHeader,l=i.alertsStrings.noResultsInfo;break;case"noBarrierAsset":case"noStartAsset":r=i.alertsStrings.noAssetsFoundHeader,l=i.alertsStrings.noAssetFound;break;case"noTraceConfig":r="",l=i.alertsStrings.noTraceSupported;break;default:r=i.alertsStrings.genericErrorHeader,l=s||""}return a("div",{class:v.noticeContainer,key:e},a("calcite-notice",{closable:t,icon:!0,key:e,kind:"danger",open:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{switch(e){case"flag":this._warningNoFlag=!1;break;case"noTerminal":this._warningNoTerminal=!1;break;case"trace":this._warningNoTraceSelected=!1;break;case"noStartAsset":this._warningNoStartAssetFound=!1;break;case"noBarrierAsset":this._warningNoBarrierAssetFound=!1}}},a("div",{slot:"title"},r),a("div",{slot:"message"},l)))}_renderRemoveTraceContainer(e){const{messages:t}=this;return a("calcite-action",{icon:"trash",label:t.globalStrings.clearResults,onclick:()=>{this._alertRemoveModal=!0,this._activeTrace=e.trace},scale:"s",slot:"header-menu-actions",text:t.globalStrings.clearResults,textEnabled:!0})}_renderHighlightColorPicker(e,t,s){const{messages:i}=this,{graphicHandler:r}=this.viewModel,l=[],o=new RegExp(`^${e.hex}$`,"i"),n=r.highlightColor.length>z.length?5:4;for(const c of r.highlightColor)l.push(a("calcite-action",{active:o.test(c.hex),key:c.hex,label:i.resultsStrings.graphicColor,onclick:()=>{s==="aggregate"?this.viewModel.changeResultGraphicColor(c,t):this.viewModel.changeResultAreaColor(t,c)},scale:"s",text:i.resultsStrings.graphicColor},a("calcite-color-picker-swatch",{active:o.test(c.hex),color:c.hex,scale:"s"})));return a("calcite-action-pad",{expandDisabled:!0,layout:"grid",position:"start"},a("calcite-action-group",{columns:n,layout:"grid"},l))}_renderTraceResults(){const{messages:e,messagesCommon:t}=this,{selectFeatures:s}=e.resultsStrings,i=this.viewModel.traceResults,r=[];return i.forEach((l,o)=>{var T,F,k,I,C,R;let n=[],c=[],p=!1,g=!1,f=!1,_="";l.results!==null&&l.results.hasOwnProperty("elements")?(l.results.aggregatedGeometry!==null&&(g=!0),l.results.globalFunctionResults!==null&&l.results.globalFunctionResults.length>0&&(c=l.results.globalFunctionResults,c.length>0&&(f=!0)),l.results.elements&&l.results.elements.length>0&&(n=l.results.elements,n.length>0&&(p=!0)),(g||p)&&(_=(F=this.messagesUnits.units[(T=l.resultArea)==null?void 0:T.unit])==null?void 0:F.abbr),r.push(a("calcite-block",{collapsible:!0,description:l.trace.description??"",heading:l.trace.title,key:`${l.trace.title}${o}`,open:!0},this._renderRemoveTraceContainer(l),a("calcite-list",null,f?a("calcite-list-item",{label:e.resultsStrings.functionHeader+" ("+c.length+")",onCalciteListItemSelect:()=>{this.switchToFunctions(c,!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):null,p&&this.viewModel.showSelectionAttributes?a("calcite-list-item",{key:this.id,label:e.resultsStrings.viewFeatures+" ("+n.length+")",onCalciteListItemSelect:()=>{this.switchToAssetGroup(this._groupResultsByAssetGroup(l),l.trace.title+" ("+n.length+")",!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"})):this.viewModel.showSelectionAttributes?a("calcite-label",{layout:"inline",scale:"s"},e.resultsStrings.noSelectionResults):null),p?a("div",{class:v.paddingTop},a("calcite-label",{layout:"inline",onclick:y=>{y.preventDefault(),y.stopPropagation(),this.viewModel.mergeSelection(!l.selectionEnabled,l.trace)},scale:"s"},a("calcite-checkbox",{checked:l.selectionEnabled,onclick:y=>{y.preventDefault(),y.stopPropagation(),this.viewModel.mergeSelection(!l.selectionEnabled,l.trace)},scale:"m"}),this.viewModel.showSelectionAttributes?s:`${s} (${n.length})`)):null,g?a("calcite-block-section",{key:`aggregate-${l.trace.title}-${o}`,open:l.graphicEnabled,text:e.resultsStrings.highlightTrace,toggleDisplay:"switch",onCalciteBlockSectionToggle:y=>{y.target.open?this.viewModel.changeResultGraphicColor(l.graphicColor,l):this.viewModel.removeResultGraphicFromView(l)}},a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:y=>{const A=y.target;this._swatchNode=A,this._activeSwatch="aggGeom_"+o}},a("calcite-color-picker-swatch",{color:l.graphicColor.hex,scale:"s",slot:"actions-end"})))):null,this.enableResultArea&&(g||p)?a("calcite-block-section",{key:`area-${l.trace.title}-${o}`,open:(k=l.resultArea)==null?void 0:k.show,text:e.resultsStrings.resultAreaHeader,toggleDisplay:"switch",onCalciteBlockSectionToggle:y=>{y.target.open?this.viewModel.addResultAreaToMap(l):this.viewModel.removeResultAreaFromMap(l)}},a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.graphicColor,onclick:y=>{const A=y.target;this._swatchNode=A,this._activeSwatch="resultArea_"+o}},a("calcite-color-picker-swatch",{color:(I=l.resultArea)==null?void 0:I.color.hex,scale:"s",slot:"actions-end"}))),a("calcite-list",{selectionMode:"none"},a("calcite-list-item",{label:e.resultsStrings.resultAreaBuffer},a("calcite-input-number",{afterCreate:this._afterComponentCreate,class:v.numberInput,max:999999,maxLength:999999,min:0,scale:"s",slot:"actions-end",suffixText:_,value:(C=l.resultArea)==null?void 0:C.distance.toString(),onCalciteInputNumberChange:y=>{var q;if(!((q=this.view)!=null&&q.popup))return;this.view.popup.visible&&this.view.closePopup();const A=y.target;l.resultArea.distance>=0?(l.resultArea.distance=parseInt(A.value,10),this.viewModel.removeResultAreaFromMap(l),this.viewModel.addResultAreaToMap(l)):(l.resultArea.distance=0,this.viewModel.removeResultAreaFromMap(l),this.viewModel.addResultAreaToMap(l))}})))):null,a("calcite-popover",{autoClose:!0,closable:!0,label:e.resultsStrings.graphicColor,offsetDistance:0,offsetSkidding:0,open:this._activeSwatch==="aggGeom_"+o||this._activeSwatch==="resultArea_"+o,placement:"auto-start",referenceElement:this._swatchNode,scale:"s",onCalcitePopoverClose:()=>{this._swatchNode=null,this._activeSwatch=null}},this._renderHighlightColorPicker(this._activeSwatch==="resultArea_"+o?(R=l.resultArea)==null?void 0:R.color:l.graphicColor,l,this._activeSwatch==="resultArea_"+o?"resultArea":"aggregate"))))):r.push(a("calcite-block",{collapsible:!1,heading:l.trace.title,key:"error-"+o,open:!0},this._renderRemoveTraceContainer(l),this._renderWarningMessage("noController",!1,l.status)))}),a("calcite-flow-item",{key:"traceResults",styles:U()},r,this._renderStartOverContainer(),this._alertRemoveModal?a("calcite-scrim",{key:"prompt"},a("div",{class:v.clearPrompt},a("h3",{slot:"header"},e.globalStrings.clearResults),a("div",{slot:"content"},e.alertsStrings.clearResultsAlert),a("div",{class:v.promptDivider}),a("div",{styles:re("row")},a("calcite-button",{appearance:"outline",onclick:()=>{this._alertRemoveModal=!1},slot:"secondary",width:"full"},t.cancel),a("calcite-button",{onclick:()=>{this._activeTrace&&this.viewModel.clearResult(this._activeTrace),this._alertRemoveModal=!1,this.viewModel.traceResults.length===0?this.switchTab("input"):(this._activeTrace=this.viewModel.traceResults[0].trace,this._showTraceResultFunctions=!1,this._showTraceResultAssetGroup=!1,this._showTraceResultAssetType=!1,this._showIndividualRecords=!1)},slot:"primary",width:"full"},t.form.ok)))):null)}_renderTraceResultFunctions(){const{messages:e}=this,t=this._traceResultsFunctions,s=[];return t.forEach(i=>{s.push(this._renderResultRowFunctions(i))}),a("calcite-flow-item",{heading:e.resultsStrings.functionHeader,key:"functionResultMultiple",onCalciteFlowItemBack:()=>{this.switchToFunctions([],!1)}},s,this._renderStartOverContainer())}_renderTraceResultByAssetGroup(){const e=this._traceResultsAssetGroup,t=[];for(const s in e){const i=e[s];for(const r in i)t.push(this._renderResultRowAssetGroup(i[r]))}return a("calcite-flow-item",{heading:this._traceHeaderForFlow,key:"assetGroupResultMultiple",onCalciteFlowItemBack:()=>{this.switchToAssetGroup([],"",!1)}},a("calcite-list",null,t),this._renderStartOverContainer())}_renderTraceResultByAssetType(){const e=this._traceResultsAssetType,t=[];for(const s in e)e[s].length>0&&t.push(this._renderResultRowAssetType(e[s]));return a("calcite-flow-item",{heading:this._assetGroupHeader,key:"assetTypeResult",onCalciteFlowItemBack:()=>{this.switchToAssetType([],"",!1)}},a("calcite-list",{selectionMode:"none"},t),this._renderStartOverContainer())}_renderTraceResultIndividual(){var i;const{messages:e}=this,t=this._traceResultsIndividual;t.sort(this._compare(this._resultSortField,this._resultSortOrder));const s=[];return t.length>0&&((((i=t[0].details)==null?void 0:i.fields.some(({name:r})=>r.toLowerCase()===this._resultDisplayField.toLocaleLowerCase()))??!1)||(this._resultDisplayField=this._resultObjectIdField,this._resultSortField=this._resultObjectIdField),t.forEach(r=>{r!=null&&r.details&&s.push(this._renderResultRowIndividual(r))}),s.length===0&&s.push(a("calcite-list-item",{label:e.resultsStrings.noFeaturesInMap}))),a("calcite-flow-item",{heading:this._assetTypeHeader,key:"individualResult",onCalciteFlowItemBack:()=>{this._showResultOptions=!1,this.switchToIndividualRecords([],"",!1)}},a("calcite-action",{afterCreate:Ae,bind:this,"data-node-ref":"_individualResultNode",icon:"gear",id:"field_options"+this.id,label:e.resultsStrings.displayAttribute,onclick:()=>{this._showResultOptions=!0},scale:"m",slot:"header-actions-end",text:e.resultsStrings.displayAttribute}),a("calcite-list",{selectionMode:"none"},s),this._renderStartOverContainer())}_renderTraceResultIndividualPopover(){const{messages:e}=this,t=this._traceResultsIndividual,s=[],i=[];return t.length>0&&(t[0].details?t[0].details.fields.forEach(({name:r,alias:l})=>{s.push(a("calcite-option",{key:`display-${r}`,label:l??r,selected:r===this._resultDisplayField,value:r})),i.push(a("calcite-option",{key:`sort-${r}`,label:l??r,selected:r===this._resultSortField,value:r}))}):(s.push(a("calcite-option",{key:`display-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})),i.push(a("calcite-option",{key:`sort-${this._resultDisplayField}`,label:this._resultDisplayField,value:this._resultDisplayField})))),a("calcite-popover",{autoClose:!0,label:e.resultsStrings.displayAttribute,offsetDistance:0,offsetSkidding:0,open:this._showResultOptions,overlayPositioning:"fixed",placement:"left-start",referenceElement:this._individualResultNode,styles:this.domNode!==null?Ke(.75*this.domNode.clientWidth):Qe()},a("calcite-block",{heading:"",open:!0},a("calcite-label",{scale:"s"},e.resultsStrings.displayAttribute,a("calcite-select",{label:e.resultsStrings.displayAttribute,scale:"s",onCalciteSelectChange:r=>{const l=r.target;this._resultDisplayField=l.selectedOption.value,this._showResultOptions=!1}},s)),a("calcite-label",{scale:"s"},e.resultsStrings.sortBy,a("calcite-select",{label:e.resultsStrings.sortBy,scale:"s",onCalciteSelectChange:r=>{const l=r.target;this._resultSortField=l.selectedOption.value,t.sort(this._compare(this._resultSortField,this._resultSortOrder)),this._traceResultsIndividual=t,this._showResultOptions=!1}},i))))}_renderResultRowFunctions(e){return a("calcite-block",{collapsible:!1,heading:e.networkAttributeName+" "+e.functionType+" = "+e.result})}_renderResultRowAssetGroup(e){const t=this._getAssetGroupName(e[0]);return a("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.switchToAssetType(this._groupResultsByAssetType(e),t+" ("+e.length+")",!0)}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowAssetType(e){const t=this._getAssetTypeName(e[0]);return a("calcite-list-item",{label:t+" ("+e.length+")",onCalciteListItemSelect:()=>{this.viewModel.queryFeaturesById(e).then(s=>{if(s!=null&&s.length){this._resultObjectIdField=s[0].layer.objectIdField,this._resultDisplayField==="objectid"&&(this._resultDisplayField=s[0].layer.objectIdField),this._resultSortField==="objectid"&&(this._resultSortField=s[0].layer.objectIdField);const i=this._appendAttributes(e,s,"objectId");this.switchToIndividualRecords(i,t+" ("+e.length+")",!0)}else this.switchToIndividualRecords(e,t+" ("+e.length+")",!0)})}},a("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderResultRowIndividual(e){var n,c,p;const{messages:t}=this,s=`display-${e.objectId}-nso`,{nonSpatialObject:i,zoomToFeature:r}=t.globalStrings;let l="",o=null;if(o=(n=e==null?void 0:e.details)==null?void 0:n.fields.find(({name:g})=>g===this._resultDisplayField),(o==null?void 0:o.type)==="date")l=new Date(e.details.attributes[this._resultDisplayField]).toDateString();else if(this._resultDisplayField.toLowerCase()==="assetgroup")l=this._getAssetGroupName(e);else if(this._resultDisplayField.toLowerCase()==="assettype")l=this._getAssetTypeName(e);else if(o!=null&&o.domain&&Ye(o.domain)){const g=o.domain.codedValues.find(({code:f})=>f===e.details.attributes[this._resultDisplayField]);l=g==null?void 0:g.name}else l=((c=e.details)==null?void 0:c.attributes[this._resultDisplayField])??e.objectId;return l&&l!==""&&l!==null?typeof l=="string"&&(l.trim()||(l=t.resultsStrings.noValue)):l=t.resultsStrings.noValue,((p=e==null?void 0:e.details)==null?void 0:p.geometry)!==null?a("calcite-list-item",{label:l,onCalciteListItemSelect:()=>{this.viewModel.zoomToAsset(e.details.geometry)}},a("calcite-icon",{icon:"zoom-to-object",scale:"s",slot:"content-end",textLabel:r})):a("calcite-list-item",{label:l},a("calcite-icon",{icon:"table",id:s,scale:"s",slot:"content-end",textLabel:i}),a("calcite-tooltip",{label:i,referenceElement:s},a("span",null,i)))}_afterComponentCreate(e){"value"in e&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"})}_mixCustomStrings(){const{messages:e}=this;this.inputSettings.length>0&&this.inputSettings.forEach(t=>{t.type==="starting-point"&&(e.inputsStrings.headerStartingPoint=t.label,e.inputsStrings.startingPointHint=t.description),t.type==="barrier"&&(e.inputsStrings.headerBarrier=t.label,e.inputsStrings.barrierPointHint=t.description)})}_overrideFlagSymbol(){this.inputSettings.length>0&&this.inputSettings.forEach(e=>{e.type==="starting-point"?this._symbolStartFlag=e.symbol:this._symbolBarrier=e.symbol,this.viewModel.changeFlagSymbol(e.type,e.symbol)})}_utilityNetworkTraceInitialized(){return this.viewModel.loadUtilityNetwork().then(e=>{var t;if(e)return this.viewModel.selectTracesOnLoad(),this._registerWatchers(),this.viewModel._traces.length<=0&&(this._tracesExists=!1),this.viewModel.flags.length>0&&this._processFlagOnLoad(),(t=this.view)==null?void 0:t.when().then(()=>{this._watchViewState()});this._tracesExists=!1,this.disabled=!1}).catch(e=>{const{messages:t}=this;this._loadUNError=!1,e.name==="utility-network:no-user-type-extension"||e.details.raw.extendedCode===et.noExtension?this._errorMessage=t.alertsStrings.noUserExtension:this._errorMessage=e.message,this.disabled=!1})}_processFlagOnLoad(){var e;return(e=this.view)==null?void 0:e.when().then(()=>{this._watchHandler=W(()=>{var t;return!((t=this.view)!=null&&t.updating)},async()=>{this._warningNoFlag=!1,this._warningNoBarrierAssetFound=!1,this._warningNoStartAssetFound=!1;const t=await this.viewModel.addFlagsOnLoad();this.viewModel.removeFlagsOnLoadWatcher(),t.includes("barrier")&&(this._warningNoBarrierAssetFound=!0),t.includes("starting-point")&&(this._warningNoStartAssetFound=!0),this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()})})}_registerWatchers(){this.addHandles([B(()=>this.selectedTraces,()=>{this.viewModel.selectTracesOnLoad(),this.scheduleRender()}),B(()=>this.defaultGraphicColor,()=>{this.viewModel.traceResults.length>0&&this.viewModel.traceResults.forEach(e=>{this.viewModel.changeResultGraphicColor(this.viewModel.defaultGraphicColor,e)}),this.scheduleRender()})])}_groupResultsByAssetGroup(e){var r;const t=[],s=(r=e.results)==null?void 0:r.elements,i=this._groupBy(s??[],"networkSourceId");for(const l in i)t.push(this._groupBy(i[l],"assetGroupCode"));return t}_groupResultsByAssetType(e){return this._groupBy(e,"assetTypeCode")}_appendAttributes(e,t,s){const i=[];return e.forEach(r=>{t.forEach(l=>{l.featureSet.features.forEach(o=>{r[s]===o.attributes[this._resultObjectIdField]&&(r.details=o,r.details.fields=l.featureSet.fields,i.push(r))})})}),i}_getAssetGroupName(e){let t=e.assetGroupCode.toString();const s=e.assetGroupCode,i=this.viewModel.getValidSources().find(r=>r.sourceId===e.networkSourceId);if(i){const r=i.assetGroups.find(l=>l.assetGroupCode===s);r&&(t=r.assetGroupName)}return t}_getAssetTypeName(e){let t=e.assetTypeCode.toString();const s=e.assetGroupCode,i=this.viewModel.getValidSources().find(r=>r.sourceId===e.networkSourceId);if(i){const r=i.assetGroups.find(l=>l.assetGroupCode===s);if(r){const l=r.assetTypes.find(o=>o.assetTypeCode===e.assetTypeCode);l&&(t=l.assetTypeName)}}return t}_compare(e,t){return(s,i)=>{var n,c;let r=0,l=((n=s.details)==null?void 0:n.attributes[e])??s.objectId,o=((c=i.details)==null?void 0:c.attributes[e])??i.objectId;return isNaN(l)&&(l=l.toLowerCase()),isNaN(o)&&(o=o.toLowerCase()),t==="desc"?l>o?r=1:l<o&&(r=-1):l<o?r=1:l>o&&(r=-1),r}}_groupBy(e,t){return e.reduce((s,i)=>((s[i[t]]=s[i[t]]||[]).push(i),s),{})}_getSymbolIcon(e){return e.type==="picture-marker"?a("img",{height:e.height,src:e.url??void 0,width:e.width}):null}_watchViewState(){this._watchHandler=W(()=>{var e;return!((e=this.view)!=null&&e.updating)},()=>{this.disabled=!1,this._watchHandler!==null&&this._watchHandler.remove()},{initial:!0})}_changeCursor(e="default"){var s,i;const t=(i=(s=this.view)==null?void 0:s.container)==null?void 0:i.style;t&&(t.cursor=e)}};h([u()],d.prototype,"_tracesExists",void 0),h([u()],d.prototype,"_selectToolActive",void 0),h([u()],d.prototype,"_activeTrace",void 0),h([u()],d.prototype,"_activeSwatch",void 0),h([u()],d.prototype,"_traceHeaderForFlow",void 0),h([u()],d.prototype,"_assetGroupHeader",void 0),h([u()],d.prototype,"_assetTypeHeader",void 0),h([u()],d.prototype,"_traceResultsFunctions",void 0),h([u()],d.prototype,"_traceResultsAssetGroup",void 0),h([u()],d.prototype,"_traceResultsAssetType",void 0),h([u()],d.prototype,"_traceResultsIndividual",void 0),h([u()],d.prototype,"_showTraceResultFunctions",void 0),h([u()],d.prototype,"_showTraceResultAssetGroup",void 0),h([u()],d.prototype,"_showTraceResultAssetType",void 0),h([u()],d.prototype,"_showIndividualRecords",void 0),h([u()],d.prototype,"_activeTab",void 0),h([u()],d.prototype,"_alertRemoveModal",void 0),h([u()],d.prototype,"_warningNoFlag",void 0),h([u()],d.prototype,"_warningNoTraceSelected",void 0),h([u()],d.prototype,"_confirmReset",void 0),h([u()],d.prototype,"_swatchNode",void 0),h([u()],d.prototype,"_errorMessage",void 0),h([u()],d.prototype,"defaultGraphicColor",null),h([u()],d.prototype,"disabled",void 0),h([u()],d.prototype,"flags",null),h([u()],d.prototype,"gdbVersion",null),h([u()],d.prototype,"iconClass",void 0),h([u()],d.prototype,"inputSettings",void 0),h([u()],d.prototype,"label",null),h([u(),x("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")],d.prototype,"messages",void 0),h([u(),x("esri/t9n/common")],d.prototype,"messagesCommon",void 0),h([u(),x("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0),h([u()],d.prototype,"resultAreaProperties",null),h([u()],d.prototype,"selectedTraces",null),h([u()],d.prototype,"selectOnComplete",null),h([u()],d.prototype,"showGraphicsOnComplete",null),h([u()],d.prototype,"enableResultArea",null),h([u()],d.prototype,"showSelectionAttributes",null),h([u()],d.prototype,"utilityNetwork",null),h([u()],d.prototype,"view",null),h([Re(["add-flag","add-flag-complete","add-flag-error","select-features","clear-selection","add-result-area","remove-result-area"]),u({type:ue})],d.prototype,"viewModel",void 0),d=h([oe(Je)],d);const ts=d;export{ts as default};

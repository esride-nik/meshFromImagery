import{a5 as e,a6 as i,a9 as w,gl as y,dm as I,al as E,an as M,_ as u,kn as _}from"./index-b516d057.js";import{e as f,O,r as C,n as c,i as k}from"./jsxFactory-92036771.js";import{e as h}from"./globalCss-94006b67.js";import{t as P}from"./accessibleHandler-e91101b2.js";import{e as $}from"./vmEvent-d773b6c5.js";import{b as L}from"./GeolocationPositioning-dfe01ae0.js";import"./uuid-709b6c67.js";import"./geolocationUtils-4a35382f.js";import"./project-1bd91657.js";import"./GoTo-4d856ce0.js";const S=15e3,F="esri.widgets.Track.TrackViewModel";let a=class extends L{constructor(o){super(o),this._watchId=void 0,this._trackStartingTimeoutId=void 0,this._settingPosition=null,this._trackController=null,this.positionFilterFunction=null}destroy(){this._stopTracking()}get state(){return this._geolocationUsable?this.view&&!this.view.ready?"disabled":this._settingPosition||this._trackStartingTimeoutId!==void 0?"waiting":this.tracking?"tracking":"ready":"feature-unsupported"}get tracking(){return this._watchId!==void 0}start(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._startTracking()}stop(){this.state!=="disabled"&&this.state!=="feature-unsupported"&&this._stopTracking()}_stopWatchingPosition(){this._watchId!==void 0&&(navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0)}_stopTracking(){this._abortTrack(),this._clearWaitingTimer(),this._stopWatchingPosition(),this._clearGraphic()}_startTracking(){this._stopTracking();const o=I(async s=>{this._abortTrack();const n=new AbortController;this._trackController=n;const{timestamp:l,coords:d}=s,T={timestamp:l,coords:{...d}};try{if(typeof this.positionFilterFunction=="function"&&!this.positionFilterFunction.call(null,{position:T})||(await this.updatePosition(s,n),this._trackController!==n))return;this._clearWaitingTimer(),this._addGraphic(),this.emit("track",{position:s}),this._trackController=null}catch(p){if(E(p))return;throw this._trackController=null,this._emitError(p),this._clearWaitingTimer(),p}},0);this._watchId=navigator.geolocation.watchPosition(s=>{this._settingPosition=o(s).catch(y)},this._handleWatchPositionError.bind(this),this.geolocationOptions??void 0),this._trackStartingTimeoutId=setTimeout(()=>{this._trackStartingTimeoutId=void 0},S)}_handleWatchPositionError(o){o.code===o.PERMISSION_DENIED&&this._stopTracking(),this._emitError(o)}_abortTrack(){var o;(o=this._trackController)==null||o.abort(),this._trackController=null}_clearWaitingTimer(){clearTimeout(this._trackStartingTimeoutId),this._trackStartingTimeoutId=void 0,this._settingPosition=null}_emitError(o){this.emit("track-error",{error:o})}};e([i()],a.prototype,"_watchId",void 0),e([i()],a.prototype,"_trackStartingTimeoutId",void 0),e([i()],a.prototype,"_settingPosition",void 0),e([i()],a.prototype,"positionFilterFunction",void 0),e([i({readOnly:!0})],a.prototype,"state",null),e([i({readOnly:!0})],a.prototype,"tracking",null),e([i()],a.prototype,"start",null),e([i()],a.prototype,"stop",null),a=e([w(F)],a);const m=a,g={base:"esri-track",widgetIcon:k.tracking},W="compass-north-circle",b="esri.widgets.Track",v=M.getLogger(b);let r=class extends O{constructor(t,o){super(t,o),this.iconClass=g.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new m}loadDependencies(){return C({icon:()=>u(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),loader:()=>u(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"])})}get geolocationOptions(){return this.viewModel.geolocationOptions}set geolocationOptions(t){this.viewModel.geolocationOptions=t}get goToLocationEnabled(){return this.viewModel.goToLocationEnabled}set goToLocationEnabled(t){this.viewModel.goToLocationEnabled=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get graphic(){return this.viewModel.graphic}set graphic(t){this.viewModel.graphic=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get rotationEnabled(){return this.viewModel.rotationEnabled}set rotationEnabled(t){this.viewModel.rotationEnabled=t}get scale(){return this.viewModel.scale}set scale(t){this.viewModel.scale=t}get tracking(){return this.viewModel.tracking}get useHeadingEnabled(){return _(v,"useHeadingEnabled",{replacement:"rotationEnabled",version:"4.27",warnOnce:!0}),this.viewModel.rotationEnabled}set useHeadingEnabled(t){_(v,"useHeadingEnabled",{replacement:"rotationEnabled",version:"4.27",warnOnce:!0}),this.viewModel.rotationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}start(){this.viewModel.start()}stop(){this.viewModel.stop()}render(){var d;const t=(d=this.viewModel)==null?void 0:d.state,o={[h.disabled]:t==="disabled",[h.hidden]:t==="feature-unsupported"},s=t==="tracking",{messages:n}=this,l=(s?n==null?void 0:n.stopTracking:n==null?void 0:n.startTracking)??"";return c("div",{"aria-label":l,bind:this,class:this.classes(g.base,h.widget,h.widgetButton,o),hidden:t==="feature-unsupported",onclick:this._toggleTracking,onkeydown:this._toggleTracking,role:"button",tabIndex:0,title:l},this._renderIcon(),c("span",{class:k.fontFallbackText},l))}_renderIcon(){const{icon:t,iconClass:o,viewModel:s}=this;switch(s==null?void 0:s.state){case"waiting":return c("calcite-loader",{inline:!0,key:"loader",label:"",scale:"s",type:"indeterminate"});case"tracking":return this._renderCalciteIcon("pause");default:return t?this._renderCalciteIcon(t):o&&o!==g.widgetIcon?this._renderLegacyIcon(o):this._renderCalciteIcon(W)}}_renderCalciteIcon(t){return c("calcite-icon",{icon:t,key:"icon",scale:"s"})}_renderLegacyIcon(t){return c("span",{"aria-hidden":"true",class:t,key:"legacy-icon"})}_toggleTracking(){const t=this.viewModel;t&&t.state!=="feature-unsupported"&&t.state!=="disabled"&&(t.state!=="tracking"&&t.state!=="waiting"?this.viewModel.start():this.viewModel.stop())}};e([i()],r.prototype,"geolocationOptions",null),e([i()],r.prototype,"goToLocationEnabled",null),e([i()],r.prototype,"goToOverride",null),e([i()],r.prototype,"graphic",null),e([i()],r.prototype,"iconClass",void 0),e([i()],r.prototype,"icon",void 0),e([i()],r.prototype,"label",null),e([i(),f("esri/widgets/Track/t9n/Track")],r.prototype,"messages",void 0),e([i()],r.prototype,"rotationEnabled",null),e([i()],r.prototype,"scale",null),e([i({readOnly:!0})],r.prototype,"tracking",null),e([i()],r.prototype,"useHeadingEnabled",null),e([i()],r.prototype,"view",null),e([i({type:m}),$(["track","track-error"])],r.prototype,"viewModel",void 0),e([P()],r.prototype,"_toggleTracking",null),r=e([w(b)],r);const q=r;export{q as default};

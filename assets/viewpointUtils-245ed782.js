import{d as ne,l as Ce}from"./Viewpoint-f83262d0.js";import{B as x,f_ as D,ng as Xn,d8 as O,d4 as an,d1 as R,fk as le,d2 as B,fz as Ee,fe as C,fa as L,aW as d,fv as te,fC as k,fM as H,fd as Ye,nh as Yn,fO as b,lb as Vn,fq as ue,gv as fe,M as De,db as ye,fx as Oe,ft as Qn,ni as et,gG as nt,fN as He,ah as J,gW as tt,an as at,f1 as it,di as we,nj as rt,y as $,aU as ot,bj as st,s as Fe,cv as rn,nk as ct,nl as lt,nm as ut,mr as ft,hh as mt,eH as dt,f9 as on,E as pt,et as Ge,x as Ve,em as gt,f6 as w,jf as ht,nn as yt,jL as wt,jK as xt,no as vt,np as Mt,nq as Rt,fJ as bt}from"./index-b516d057.js";import{i as Ie,o as $t,s as sn}from"./Cyclical-4c223a04.js";import{n as me}from"./projectPointToVectorWithEngine-f608a34a.js";import{t as F}from"./projectVectorToPoint-fbaf5599.js";import{t as W}from"./projectVectorToVector-56c29b20.js";import{b as Tt}from"./frustum-f9d53cdf.js";import{u as St}from"./scaleUtils-72744379.js";import{b as zt}from"./Intersector-fa865806.js";import{l as Ue}from"./ViewingMode-5d7d590b.js";import{l as Ct,s as Gt}from"./earthUtils-ef4b5643.js";import{a as xe}from"./ElevationProvider-abb53936.js";import{r as At}from"./spatialReferenceSupport-5aeb751c.js";async function cn(e,n,t,i){const a=F(e,n,t);if(a!=null)return a;const r=new x({x:e[0],y:e[1],z:e[2],spatialReference:n,hasZ:!0});return D(r,t,i)}function qa(e,n,t,i){return e.renderCoordsHelper.fromRenderCoords(n.eye,de,i)!=null&&Xn(t,de)}function Pt(e,n){return e.elevationProvider?e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function K(e,n,t,i){const a=e.state.camera.clone();n&&t&&i&&(a.eye=n,a.center=t,a.up=i),Et(e,a.ray,P)||O(P,a.center);const r=e.state.constraints,o=r.minimumPoiDistance;if(an(a.eye,P)<o){const s=r.collision.enabled;O(_,a.viewForward),R(_,_,o),s?a.eye=le(de,P,_):B(P,a.eye,_);const c=e.renderCoordsHelper,l=c.getAltitude(a.eye),u=r.collision.elevationMargin;s&&l<u&&(le(_,P,a.eye),a.eye=c.setAltitude(de,u,a.eye),B(P,a.eye,_))}return a.center=P,a}function Qe(e,n,t){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=Pt(e,n),a=e.stateManager.constraintsManager.nearFarHeuristic,{far:r}=a.compute(n,t,e.renderDataExtent,i,Ot),o=r*r;return an(n,t)>o}function Et(e,n,t){let i=en[e.viewingMode];i||(i=zt(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,en[e.viewingMode]=i);const{isGlobal:a}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(n,i,t)||Qe(e,n.origin,t))||!(!e.renderCoordsHelper.intersectManifold(n,0,t)||Qe(e,n.origin,t))||!!a&&Dt(n,t,Ee(e.spatialReference).radius)}function Dt(e,n,t){const i=C(e.origin,e.origin)-t*t,a=i>0?Math.sqrt(i)/3:1;return R(n,e.direction,a/L(e.direction)),B(n,n,e.origin),!0}const en={},de=d(),P=d(),_=d(),Ot={near:0,far:0},Ht=d(),re=d();function ln(){return{direction:d(),up:d()}}function un(e,n,t,i,a){let r=te(Ht,e),o=C(r,i);const s=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(C(n,i)),o<.99?(O(r,n),s&&R(r,r,-1)):r=null);let c=0;if(r){R(re,i,C(i,r)),le(r,r,re);const u=C(r,a)/(L(r)*L(a));k(re,r,a),c=(C(re,i)>0?1:-1)*H(Ye(u))}const l=H(Ye(-C(i,e)/L(e)));return t?(t.heading=c,t.tilt=l,t):{heading:c,tilt:l}}const fn=ye(0,1,0),mn=ye(0,0,1),Y=Oe(),S=d(),z=d();function dn(e,n,t,i=ln()){const{direction:a,up:r}=i;return Yn(Y,-b(n)),Vn(Y,Y,b(t)),ue(a,mn,Y),R(a,a,-1),ue(r,fn,Y),i}function Ft(e,n,t,i){return un(n,t,i,mn,fn)}function It(e,n,t,i){const a=dn(e,t,i),r=d();return R(r,a.direction,-n),B(r,r,e),{up:a.up,eye:r,heading:t,tilt:i}}function Ut(e){return H(e)}function _t(e){return b(e)}function pn(e,n,t,i,a){const r=e.renderSpatialReference,o=e.map&&e.spatialReference||n.spatialReference;return fe(n,S,r),fe(n,z,r),S[0]-=t/2,z[0]+=t/2,S[1]-=i/2,z[1]+=i/2,W(S,r,S,o),W(z,r,z,o),a?(a.xmin=S[0],a.ymin=S[1],a.xmax=z[0],a.ymax=z[1],a.spatialReference=o):a=new De(S[0],S[1],z[0],z[1],o),a}const jt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Ft,eyeForCenterWithHeadingTilt:It,eyeTiltToLookAtTilt:_t,headingTiltToDirectionUp:dn,lookAtTiltToEyeTilt:Ut,toExtent:pn},Symbol.toStringTag,{value:"Module"})),gn=ye(0,0,1),hn=te(d(),ye(1,1,1)),Lt=new Ie(-180,180),V=Oe(),E=d(),q=d();function yn(e,n,t,i=ln()){k(E,e,gn),C(E,E)===0&&k(E,e,hn),Qn(V,-b(n),e),et(V,V,-b(t),E);const{up:a,direction:r}=i;return k(a,E,e),te(a,a),ue(a,a,V),te(r,e),nt(r,r),ue(r,r,V),i}function kt(e,n,t,i){const a=E,r=q;return te(a,e),k(q,a,gn),C(q,q)===0&&k(q,a,hn),k(r,q,a),un(n,t,i,a,r)}function qt(e,n,t,i){const a={eye:d(),up:null,tilt:i,heading:t},r=E;r[0]=e[0],r[1]=e[2],r[2]=-e[1];const o=n,s=b(t),c=b(i),l=Math.sin(s),u=Math.cos(s),g=Math.sin(c),f=Math.cos(c),h=L(r);let p;if(Math.abs(c)<1e-8)p=o+h;else{const Xe=h/g,Kn=He(o/Xe),Nn=Math.PI-c-Kn;p=Xe*Math.sin(Nn)}const T=f*o,A=o*o*(g*g),I=u*u*A,U=p-T,y=U*U,X=I*(I+y-r[1]*r[1]);if(X<0)return R(a.eye,r,p/h),a.tilt=0,oe(a,e);const Be=Math.sqrt(X),We=r[1]*U,Je=I+y;let Ke;if(Ke=u>0?-Be+We:Be+We,Math.abs(Je)<1e-8)return h<1e-8?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=o):R(a.eye,r,p/h),a.tilt=0,Te(a.eye),oe(a,e);a.eye[1]=Ke/Je;const Wn=l*l*A,Re=g*o,Jn=u*Re*a.eye[1],Ne=a.eye[1]*a.eye[1],ie=1-Ne,be=Math.sqrt(ie),$e=I*Ne+Wn-2*Jn*be*U+ie*y;return Math.abs($e)<1e-8?(R(a.eye,r,p/h),a.tilt=0,Te(a.eye),oe(a,e)):(a.eye[0]=(ie*(p*r[0]-T*r[0])-Re*be*(r[0]*a.eye[1]*u+r[2]*l))/$e,a.eye[2]=(ie*(p*r[2]-T*r[2])-Re*be*(r[2]*a.eye[1]*u-r[0]*l))/$e,R(a.eye,a.eye,p),Te(a.eye),oe(a,e))}function Te(e){const n=e[1];e[1]=-e[2],e[2]=n}function oe(e,n){const t=yn(n,e.heading,e.tilt);return e.up=t.up,e}function Zt(e,n,t){const i=L(n),a=Math.sqrt(t*t+i*i-2*t*i*Math.cos(Math.PI-e)),r=He(t/(a/Math.sin(e)));return H(e-r)}function Bt(e,n,t){const i=b(e),a=L(n);return He(t/(a/Math.sin(i)))+i}function wn(e,n,t,i,a){let r,o,s,c;const l=n.latitude,u=Ee(e.spatialReference).radius,g=n.longitude,f=Ct(l,t,u)/2;r=g-f,o=g+f;const h=b(l),p=(1+Math.sin(h))/(1-Math.sin(h)),T=(p+1)*Math.tan(i/u/2),A=T*T;function I(y){const X=Math.PI/2;return(y=$t.normalize(y,-X))>X&&(y=Math.PI-y),y}if(s=1.5*Math.PI-2*Math.atan(.5*(T+Math.sqrt(4*p+A))),c=s+i/u,s=I(s),c=I(c),c<s){const y=c;c=s,s=y}if(s=Math.max(H(s),-90),c=Math.min(H(c),90),o=Lt.monotonic(r,o),o-r>180){const y=(o-r-180)/2;r+=y,o-=y}const U=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:J.WGS84;return a?(a.xmin=r,a.ymin=s,a.xmax=o,a.ymax=c,a.spatialReference=U):a=new De(r,s,o,c,U),e.spatialReference&&e.spatialReference.isWebMercator&&tt(a,!1,a),a}const Wt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:kt,eyeForCenterWithHeadingTilt:qt,eyeTiltToLookAtTilt:Bt,headingTiltToDirectionUp:yn,lookAtTiltToEyeTilt:Zt,toExtent:wn},Symbol.toStringTag,{value:"Module"})),xn=at.getLogger("esri.views.3d.support.cameraUtils"),vn=39.37,Mn=96,Ae=1,Jt=8,Kt=5,Rn=1,nn=d(),Nt={heading:0,tilt:0},ee=d(),Xt=new Ie(-20037508342788905e-9,20037508342788905e-9),Yt=new Ie(-180,180);var v;function G(e){return e.spatialReference??J.WGS84}function N(e){return e.viewingMode==="global"?Wt:jt}function Za(e,n,t,i,a){return N(e).headingTiltToDirectionUp(n,t,i,a)}function Vt(e,n){if(n==null)return null;const t=e.renderSpatialReference,i=N(e).headingTiltToDirectionUp,a=d();if(!fe(n.position,a,t))return null;const r=i(a,n.heading,n.tilt);R(r.direction,r.direction,e.state.camera.distance),B(r.direction,r.direction,a);const o=K(e,a,r.direction,r.up);return o.fov=b(n.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(v||(v={}));const Z=d();function ve(e,n,t){const i=e.renderSpatialReference,a=je(e,n.eye,n.viewForward,n.up,Nt);let r=G(e);return W(n.eye,i,Z,r)||(r=J.WGS84,W(n.eye,i,Z,r)),t==null?new ne(new x(Z,r),a.heading,a.tilt,H(n.fov)):(t.position.x=Z[0],t.position.y=Z[1],t.position.z=Z[2],t.position.spatialReference=r,t.heading=a.heading,t.tilt=a.tilt,t.fov=H(n.fov),t)}function _e(e,n,t){const i=e.state.camera,a=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Ue.Global&&t!=null&&(n*=Math.cos(b(t))),n/=e.renderCoordsHelper.unitInMeters,a/(Mn*vn/n)/Math.tan(i.fovX/2)}function ae(e,n,t){const i=e.state.camera,a=n*Math.tan(i.fovX/2),r=i.width/2/i.pixelRatio;let o=Mn*vn/(r/a);return e.renderCoordsHelper.viewingMode===Ue.Global&&t!=null&&(o/=Math.cos(b(t))),o*e.renderCoordsHelper.unitInMeters}async function bn(e,n,t,i,a,r){return $n(e,n,_e(e,t,n.latitude),i,a,r)}function Qt(e,n,t,i,a,r){return Un(e,Sn(e,i.heading,i.tilt,n,t,a),i.fov,r)}async function $n(e,n,t,i,a,r){const o=await zn(e,i.heading,i.tilt,n,t,a,r);return $(r),_n(e,o,i.fov,r)}function je(e,n,t,i,a){return N(e).directionToHeadingTilt(n,t,i,a)}function Tn(e,n){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(n,ee,e.spatialReference)&&e.elevationProvider&&(xe(e.elevationProvider,ee)??0)>ee[2]-Rn)}async function ea(e,n,t){if(Tn(e,n))return!0;const{elevationProvider:i,spatialReference:a,renderCoordsHelper:r}=e;if(i==null||!r.fromRenderCoords(n,ee,a))return!1;const[o,s,c]=ee,l=await i.queryElevation(o,s,c,a,"ground",t)??0;return $(t),l>c-Rn}async function na(e,n,t){const i=d();if(n==null)return O(i,e.state.camera.center);if(n instanceof x){const{renderSpatialReference:a,basemapTerrain:r,elevationProvider:o}=e,s=n.spatialReference;if(await me(n,i,a,0,{signal:t}),$(t),n.z==null&&r!=null&&o!=null){const c=await o.queryElevation(n.x,n.y,n.z??0,s,"ground",t);$(t),c!=null&&e.renderCoordsHelper.setAltitude(i,c)}return i}return O(i,n)}function ta(e,n){const t=d();if(n==null)return O(t,e.state.camera.center);if(n instanceof x){if(!fe(n,t,e.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:a}=e;if(n.z==null&&i!=null&&a!=null){const r=xe(a,n);r!=null&&e.renderCoordsHelper.setAltitude(t,r)}return t}return O(t,n)}function Sn(e,n,t,i,a,r){return Cn(e,n,t,i instanceof x?i:null,ta(e,i),a,r)}async function zn(e,n,t,i,a,r,o){const s=i instanceof x?i:null,c=await na(e,i,o);return $(o),Gn(e,n,t,s,c,a,r,o)}function Cn(e,n,t,i,a,r,o){if(a==null||(i??(i=F(a,e.renderSpatialReference,G(e))),i==null))return null;const s=An(e,n,t,a,r,o);if(Pn(e,t,o)&&Tn(e,s.eye)){const{tilt:c,mode:l}=En(e,t,a,r);return Cn(e,n,c,i,a,r,l)}return Dn(s,a)}async function Gn(e,n,t,i,a,r,o,s){i??(i=await cn(a,e.renderSpatialReference,G(e),{signal:s})),$(s);const c=An(e,n,t,a,r,o);if(Pn(e,t,o)&&await ea(e,c.eye,s)){$(s);const{tilt:l,mode:u}=En(e,t,a,r);return Gn(e,n,l,i,a,r,u,s)}return Dn(c,a)}function An(e,n,t,i,a,r){const o=ra(e,n,t,i,a=Math.max(a,e.state.constraints.minimumPoiDistance),r);return(0,N(e).eyeForCenterWithHeadingTilt)(i,a,o.heading,o.tilt)}function Pn(e,n,t){const i=e.map.ground.navigationConstraint;return t===v.ADJUST&&e.viewingMode==="global"&&n>0&&(i==null||i.type==="stay-above")}function En(e,n,t,i){const a=In(e,t,i,sa(e,i,n,t));return{tilt:a,mode:n-a<1?v.LOCKED:v.ADJUST}}function Dn(e,n){return{...e,center:it(n)}}function On(e,n){const{state:t,spatialReference:i}=e,a=n.spatialReference;return t.isGlobal&&At(a,Ue.Global)||t.isLocal&&i.equals(a)}function Hn(e,n){let t,i,a;if(e.state.isGlobal){const u=new x(n.xmin,n.ymin,n.spatialReference),g=new x(n.xmax,n.ymax,n.spatialReference),f=n.spatialReference.isGeographic?Yt:Xt;t=new x({x:f.center(u.x,g.x),y:(g.y+u.y)/2,z:n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0,spatialReference:n.spatialReference});const h=Ee(n.spatialReference),p=Gt(t,u,g);i=p.lon,a=p.lat,f.diff(u.x,g.x)>f.range/2&&(i+=h.halfCircumference),i=Math.min(i,h.halfCircumference),a=Math.min(a,h.halfCircumference)}else{const u=e.renderSpatialReference??n.spatialReference;u.equals(n.spatialReference)||(n=we(n,u)),i=n.xmax-n.xmin,a=n.ymax-n.ymin;const g=n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0;t=new x({x:n.xmin+.5*i,y:n.ymin+.5*a,z:g,spatialReference:u})}const r=n.zmax!=null&&n.zmin!=null?n.zmax-n.zmin:0,o=e.state.camera,s=1/Math.tan(o.fovX/2),c=1/Math.tan(o.fovY/2),l=1/Math.tan(o.fov/2);return{center:t,distance:Math.max(.5*i*s,.5*a*c,.5*r*l)/Ae}}async function Fn(e,n,t,i,a,r){const o=On(e,n)?n:await D(n,e.spatialReference,{signal:r});$(r);const{center:s,distance:c}=Hn(e,o),l=await zn(e,t,i,s,c,a,r);return $(r),_n(e,l,e.camera.fov,r)}function aa(e,n,t,i,a,r){let o;try{o=On(e,n)?n:we(n,e.spatialReference)}catch{return null}const{center:s,distance:c}=Hn(e,o),l=Sn(e,t,i,s,c,a);return l==null?null:Un(e,l,e.camera.fov,r)}function Ba(e,n,t){const i=e.renderSpatialReference,a=F(t,i,G(e));if(a==null)return null;const r=Math.tan(n.fovX/2),o=Math.tan(n.fovY/2),s=rt(n.eye,t),c=2*s*r*Ae,l=2*s*o*Ae;return e.viewingMode==="global"?wn(e,a,c,l):pn(e,a,c,l)}function ia(e,n,t){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(t/i)/Math.LN2>Jt)return!0;const a=e.renderSpatialReference,r=G(e),o=F(n,a,r),s=F(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,a,r);if(o==null||s==null)return!1;const c=Math.tan(.5*e.state.camera.fov)*i;return s.distance(o)/c>Kt}function ra(e,n,t,i,a,r){let o=0;return r===v.ADJUST&&ia(e,i,a)?(n=0,o=oa(e,a,t,i)):o=Le(e,i,a,t),o=e.state.constraints.clampTilt(a,o),{heading:n,tilt:t=In(e,i,a,o)}}const pe=.7;function oa(e,n,t,i){const a=Le(e,i,n,t);if(!e.state.constraints.tilt)return a;const r=e.state.constraints.tilt(n);r.max=Math.min(r.max,.5*Math.PI);const o=r.min*(1-pe)+r.max*pe;return Math.min(a,o)}function sa(e,n,t,i){let a=Le(e,i,n,t);if(!e.state.constraints.tilt)return a;const r=e.state.constraints.tilt(n);return a=Math.min(a,.5*Math.PI),r.min*(1-pe)+a*pe}function In(e,n,t,i){return N(e).lookAtTiltToEyeTilt(i,n,t)}function Le(e,n,t,i){return N(e).eyeTiltToLookAtTilt(i,n,t)}function Un(e,n,t,i){if(n==null)return null;const a=e.renderSpatialReference,r=F(n.eye,a,G(e));return r==null?null:(i??(i=new ne),i.position=r,i.heading=n.heading,i.tilt=n.tilt,i.fov=t,i)}async function _n(e,n,t,i){const a=e.renderSpatialReference,r=await cn(n.eye,a,G(e),{signal:i});return $(i),new ne(r,n.heading,n.tilt,t)}function Wa(e,n){var i;const t=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(t)return t.levelAtScale(n);xn.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ca(e,n){var i;const t=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(t)return t.scaleAtLevel(n);xn.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function jn(e,n){return W(n.center,e.renderSpatialReference,nn,J.WGS84),ae(e,n.distance,nn[1])}const la=.66;function Ln(e){return 360-sn.normalize(e)}function Me(e){return sn.normalize(360-e)}function ua(e,n,t){const i=n.camera;if(i!=null)return fa(i,G(e));const{targetGeometry:a}=n;if(a==null)return null;const{camera:r,mode:o}=qn(e,n.rotation,t);if(a.type==="point")return da(e,n,a,r,o);const s=a.extent;return s==null?null:aa(e,s,r.heading,r.tilt,o)}async function kn(e,n,t,i){const a=n.camera;if(a!=null)return ma(a,G(e),i);const{targetGeometry:r}=n;if(r==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:s}=qn(e,n.rotation,t);if(r.type==="point")return pa(e,n,r,o,s,i);const c=r.extent;if(c==null)throw new Error("Target geometry has no extent!");return Fn(e,c,o.heading,o.tilt,s,i)}function fa(e,n){const t=e.position;let i;try{i=we(t,n)}catch{return null}const a=e.clone();return a.position=i.clone(),a}async function ma(e,n,t){const i=e.position,a=await D(i,n,{signal:t});$(t);const r=e.clone();return r.position=a.clone(),r}function qn(e,n,t){const i=ve(e,e.state.camera);let a=v.ADJUST;return n!=null&&(i.heading=Ln(n),a=v.LOCKED),t!=null&&(i.tilt=t),{camera:i,mode:a}}function da(e,n,t,i,a){const r=e.spatialReference;let o;try{o=we(t.clone(),r)}catch{return null}const s=n.scale!=null?_e(e,n.scale,o.latitude):e.state.camera.distance;return Qt(e,o,s,i,a)}async function pa(e,n,t,i,a,r){const o=e.spatialReference,s=await D(t.clone(),o,{signal:r});$(r);const c=n.scale!=null?_e(e,n.scale,s.latitude):e.state.camera.distance;return $n(e,s,c,i,a,r)}function ga(e,n,t=null){return t==null&&(t=new Ce),Ze(e,null,n.clone(),t)}async function ha(e,n,t){const i=Sa(e,n);if(!i)throw new Fe("viewpointutils-create:no-target","Missing target for creating viewpoint");const a=new ne({fov:e.camera.fov}),r=new Ce({camera:a});if(i.target instanceof Ce)return j(await xa(e,i.target,i,t,r));if(i.target instanceof ne)return j(await Bn(e,i.target,t,r));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof De){const l=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return j(o||l?await Pe(e,i,i.target.center,a,t,r):await ba(e,i,i.target,a,t,r))}const s={boundingBox:rn(),hasZ:!1,screenSpaceObjects:[]},c=o?ya(e,i):void 0;if(await Zn(e,i.target,c,s,t),isFinite(s.boundingBox[0])){let l;if(ct(s.boundingBox,m),M.x=m[0],M.y=m[1],M.z=m[2],M.spatialReference=e.spatialReference,isFinite(M.z)&&s.hasZ?l=lt(s.boundingBox):(M.z=void 0,l=ut(ft(s.boundingBox,Ca))),o||l)return j(await Pe(e,i,M,a,t,r));const u=za(e,s.screenSpaceObjects);return j(await Ta(e,i,M,s.boundingBox,u,a,t,r))}return i.position?j(await Ma(e,i,a,r,t)):j(await Ra(e,i,a,t,r))}function ke(e,n){return n.scale==null&&n.zoom!=null?ca(e,n.zoom):n.scale}function ya(e,n){const t=ke(e,n);return t?St(t):void 0}function qe(e,n){let t=!1;return n.heading!=null?(e.heading=n.heading,t=!0):n.rotation!=null&&(e.heading=Ln(n.rotation),t=!0),n.tilt!=null&&(e.tilt=n.tilt,t=!0),n.fov!=null&&(e.fov=n.fov),t}function Ze(e,n,t,i){const a=e.spatialReference||J.WGS84;return(n=n??Vt(e,t))==null||(i.targetGeometry=F(n.center,e.renderSpatialReference,a),i.scale=jn(e,n),i.rotation=Me(t.heading),i.camera=t),i}async function ge(e,n,t,i){var g;const a=()=>new Fe("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!n)throw a();n.type==="mesh"&&(n=n.extent);const r=n.spatialReference,o=e.spatialReference,s=e.basemapTerrain.spatialReference;if(!n.hasZ&&e.basemapTerrain){let f;switch(n.type){case"point":f=n;break;case"multipoint":case"polyline":f=(g=n.extent)==null?void 0:g.center;break;case"extent":f=n.center;break;case"polygon":f=n.centroid}f!=null&&s!=null&&e.elevationProvider!=null?(f=await D(f,s,{signal:i}),m[2]=xe(e.elevationProvider,f)??0):m[2]=0}const c=Ga[n.type],l=new Array;if(c(n,n.hasZ?f=>{l.push([f[0],f[1],f[2]])}:f=>{l.push([f[0],f[1]])},m),l.length===0)throw a();const u=await D(new pt({spatialReference:r,hasZ:n.hasZ,hasM:!1,points:l}),o,{signal:i});if(n.hasZ&&(t.hasZ=!0),n.hasZ)for(const[f,h,p]of u.points)m[0]=f,m[1]=h,m[2]=p,Ge(t.boundingBox,m);else for(const[f,h]of u.points)m[0]=f,m[1]=h,Ge(t.boundingBox,m)}async function wa(e,n,t,i,a){const r=await Ve(e.whenViewForGraphic(n));if(r.ok===!1||r.value==null||!("whenGraphicBounds"in r.value))return void await ge(e,n.geometry,i,a);const o=r.value,s=await Ve(o.whenGraphicBounds(n,{minDemResolution:t}));if(s.ok===!1||!s.value)return void await ge(e,n.geometry,i,a);const{screenSpaceObjects:c,boundingBox:l}=s.value;gt(i.boundingBox,l),c&&c.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(l[2])&&(i.hasZ=!0)}async function Zn(e,n,t,i,a){var r;if(Array.isArray(n)&&n.length===2){const o=n[0],s=n[1];if(typeof o=="number"&&typeof s=="number")return M.x=o,M.y=s,M.z=void 0,M.spatialReference=(r=e.spatialReference)!=null&&r.isGeographic?e.spatialReference:J.WGS84,void await ge(e,M,i,a)}n&&"map"in n&&typeof n.map=="function"?await Promise.allSettled(n.map(o=>Zn(e,o,t,i,a))):n instanceof mt?await ge(e,n,i,a):n instanceof dt&&await wa(e,n,t,i,a)}async function xa(e,n,t,i,a){if(n.camera!=null)return Bn(e,n.camera,i,a);a.scale=n.scale,a.rotation=n.rotation,a.targetGeometry=n.targetGeometry!=null?n.targetGeometry.clone():null,a.camera=null,t.heading!=null?a.rotation=Me(t.heading):t.rotation!=null&&(a.rotation=t.rotation);const r=ke(e,t);return r!=null&&(a.scale=r),a.camera=await kn(e,a,t.tilt,i),a}async function Bn(e,n,t,i){const a=e.spatialReference,r=await D(n.position,a,{signal:t});return(n=n.clone()).fov=e.camera.fov,n.position=r,Ze(e,null,n,i)}async function va(e,n,t,i,a,r,o){const s=e.renderSpatialReference;return await me(n,Se,s,0,{signal:o}),await me(t,ce,s,0,{signal:o}),r.targetGeometry=new x(n),a.position=new x(t),le(he,Se,ce),je(e,ce,he,i.up,a),r.scale=ae(e,on(ce,Se),r.targetGeometry.latitude),r.rotation=Me(a.heading),r.camera=a,r}async function Pe(e,n,t,i,a,r){if(t==null)throw new Fe("createfromcenter","invalid point");r.targetGeometry=t.clone();const o=K(e);if(n.position)return va(e,r.targetGeometry,n.position,o,i,r,a);if(n.zoomFactor){const c=o.distance/n.zoomFactor,l=R(m,o.viewForward,-c);o.eye=B(m,o.center,l),r.scale=ae(e,c,t.latitude)}ve(e,o,i);const s=qe(i,n)?v.LOCKED:v.ADJUST;if(!n.zoomFactor){const c=ke(e,n);if(c==null){const{renderSpatialReference:l}=e;await me(t,m,l,0,{signal:a}),Tt(o.frustum,m)?r.scale=ae(e,on(o.eye,m),t.latitude):r.scale=jn(e,o)}else r.scale=c;r.camera=await bn(e,r.targetGeometry,r.scale,i,s,a)}return r}async function Ma(e,n,t,i,a){const r=K(e);O(he,r.viewForward),je(e,r.eye,he,r.up,ze);const o=e.spatialReference,{position:s}=n;if(s){const c=await D(s,o,{signal:a});t.position=c}else t.position=new x;return t.heading=n.heading!=null?n.heading:ze.heading,t.tilt=n.tilt!=null?n.tilt:ze.tilt,Ze(e,null,t,i)}async function Ra(e,n,t,i,a){const r=K(e),{spatialReference:o,renderSpatialReference:s}=e;return Pe(e,n,F(r.center,s,o),t,i,a)}async function ba(e,n,t,i,a,r){r.targetGeometry=t.clone();const o=K(e);ve(e,o,i);const s=qe(i,n)?v.LOCKED:v.ADJUST;return r.camera=await Fn(e,t,i.heading,i.tilt,s,a),r}function $a(e,n,t,i,a){let r=0;t.z!=null?r=t.z:e.basemapTerrain&&e.elevationProvider&&(r=xe(e.elevationProvider,t)),w(m,t.x,t.y,r),ht(e.spatialReference,m,tn,e.renderSpatialReference),yt(se,tn),wt(se,se),rn(Q);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let p=0;p<o.length;p++){const T=o[p];let A=i[T[2]];isFinite(A)||(A=r),w(m,i[T[0]],i[T[1]],A),W(m,e.spatialReference,m,e.renderSpatialReference),Ge(Q,xt(m,m,se))}const s=vt(Q),c=Mt(Q),l=Rt(Q),u=1/Math.tan(n.fovX/2),g=1/Math.tan(n.fovY/2),f=.5*Math.sqrt(s*s+l*l)*Math.max(g,u)+.5*c,h=.5*c*g+.5*Math.max(s,l);return Math.max(f,h)/a}async function Ta(e,n,t,i,a,r,o,s){s.targetGeometry=t.clone();const c=K(e),l=$a(e,c,t,i,a);ve(e,c,r);const u=qe(r,n)?v.LOCKED:v.ADJUST;return s.scale=ae(e,l,s.targetGeometry.latitude),s.camera=await bn(e,s.targetGeometry,s.scale,r,u,o),s}function Sa(e,n){if(!n||!e.spatialReference)return null;const t={target:void 0};return"declaredClass"in n||Array.isArray(n)?t.target=n:(Object.assign(t,n),n.center&&!t.target&&(t.target=n.center)),t}function j(e){return(e==null?void 0:e.camera)!=null&&(e.rotation=Me(e.camera.heading)),e}function za(e,n){const t=la;if(!n.length)return t;let i=Number.NEGATIVE_INFINITY;for(let a=0;a<n.length;a++){const r=n[a].screenSpaceBoundingRect;i=Math.max(i,Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]),Math.abs(r[3]))}return t-i/Math.min(e.width,e.height)*2}const m=d(),tn=Oe(),se=bt(),Q=ot(),Ca=st(),he=d(),ce=d(),Se=d(),ze={heading:0,tilt:0},M=new x,Ga={point(e,n,t){t[0]=e.x,t[1]=e.y,e.z!=null&&(t[2]=e.z),n(t)},polygon(e,n,t){const i=e.hasZ;for(let a=0;a<e.rings.length;a++){const r=e.rings[a];for(let o=0;o<r.length;o++)t[0]=r[o][0],t[1]=r[o][1],i&&(t[2]=r[o][2]),n(t)}},polyline(e,n,t){const i=e.hasZ;for(let a=0;a<e.paths.length;a++){const r=e.paths[a];for(let o=0;o<r.length;o++)t[0]=r[o][0],t[1]=r[o][1],i&&(t[2]=r[o][2]),n(t)}},multipoint(e,n,t){const i=e.points,a=e.hasZ;for(let r=0;r<i.length;r++)t[0]=i[r][0],t[1]=i[r][1],a&&(t[2]=i[r][2]),n(t)},extent(e,n,t){e.zmin!=null&&e.zmax!=null?(n(w(t,e.xmin,e.ymin,e.zmin)),n(w(t,e.xmax,e.ymin,e.zmin)),n(w(t,e.xmin,e.ymax,e.zmin)),n(w(t,e.xmax,e.ymax,e.zmin)),n(w(t,e.xmin,e.ymin,e.zmax)),n(w(t,e.xmax,e.ymin,e.zmax)),n(w(t,e.xmin,e.ymax,e.zmax)),n(w(t,e.xmax,e.ymax,e.zmax))):(n(w(t,e.xmin,e.ymin,t[2])),n(w(t,e.xmax,e.ymin,t[2])),n(w(t,e.xmin,e.ymax,t[2])),n(w(t,e.xmax,e.ymax,t[2])))}},Ja=Object.freeze(Object.defineProperty({__proto__:null,create:ha,fromCamera:ga,toCameraAsync:kn,toCameraSync:ua},Symbol.toStringTag,{value:"Module"}));export{_e as B,v as J,Za as K,Wa as P,ae as Q,ca as U,Vt as Y,ve as Z,Sn as a,ln as b,Ja as c,ha as d,Pt as f,K as g,ga as h,ua as l,je as t,qa as u,aa as v,Ba as y};

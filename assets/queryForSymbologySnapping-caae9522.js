import{ah as z,y as D,dB as P}from"./index-b516d057.js";import{n as q}from"./projectPointToVectorWithEngine-f608a34a.js";import{e as E}from"./dehydratedPoint-5a1dfed5.js";import{u as G}from"./elevationInfoUtils-be36d866.js";import{v as B,w as A,y as H,o as J,z as N}from"./RenderGeometry-5dbc1699.js";async function M(t,d,p,l,r){const{elevationProvider:u,renderCoordsHelper:i}=t,{elevationInfo:g}=d,{pointsInFeatures:v,spatialReference:h}=l,m=z.fromJSON(h),y=B(g,!0),I=await A(y,m,r);D(r);const c=[],e=new Set,o=new Set;f.spatialReference=m;const a=t.elevationProvider.spatialReference??t.spatialReference;for(const{objectId:n,points:s}of v){const w=p(n);if(w==null){for(const R of s)c.push(R.z??0);e.add(n);continue}w.isDraped&&o.add(n);const C=w.graphic.geometry;S.setFromElevationInfo(G(C,g)),S.updateFeatureExpressionInfoContext(I,w.graphic,d);for(const{x:R,y:F,z:O}of s)f.x=R,f.y=F,f.z=O??0,await q(f,j,a,0,{signal:r}),H(j,u,S,i,b),c.push(b.z)}return{elevations:c,drapedObjectIds:o,failedObjectIds:e}}const S=new J,f=E(0,0,0,z.WGS84),b=new N,j=[0,0,0];async function Q(t,d,p){if(t==null||d.candidates.length===0)return x;const l=t.graphics3DGraphicsByObjectID??t.graphics3DGraphics,r=[],u=[],{renderer:i}=t,g=i!=null&&"arcadeRequired"in i&&i.arcadeRequired?P():null,v=async(e,{graphic:o,graphics3DSymbol:a})=>{const n=await g,s=await t.getRenderingInfoAsync(o,i,n,{signal:p});return s==null?[]:a.queryForSnapping(e,m,s,p)},{candidates:h,spatialReference:m}=d;for(let e=0;e<h.length;++e){const o=h[e],{objectId:a}=o,n=typeof a=="number"?l==null?void 0:l.get(a):void 0;if(n==null)continue;const{graphics3DSymbol:s}=n;s.symbologySnappingSupported&&(r.push(v(o,n)),u.push(e))}if(r.length===0)return x;const y=await Promise.all(r);D(p);const I=[],c=[];for(let e=0;e<y.length;++e){const o=y[e],a=u[e];for(const n of o)I.push(n),c.push(a)}return{candidates:I,sourceCandidateIndices:c}}const x={candidates:[],sourceCandidateIndices:[]};export{M as c,Q as r};

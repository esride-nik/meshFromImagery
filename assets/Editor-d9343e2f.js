import{s1 as It,a5 as l,a6 as d,a9 as V,bA as oe,V as Ne,r0 as ta,s2 as aa,qM as ia,q$ as sa,kx as ra,hk as oa,cb as C,ao as F,eH as st,i2 as Et,qw as At,y as ve,hQ as K,gs as S,X as na,hb as la,_ as A,dm as Oe,iq as $e,gT as da,s3 as ca,dw as Wt,nT as $t,cn as St,aY as De,bg as Vt,s as $,kz as ua,bn as Tt,eW as Le,eX as rt,ap as ft,nL as ie,gk as He,bh as fe,dr as Be,b9 as pa,s4 as ha,gt as ma,an as ot,iP as wt,s5 as gt,nV as fa,gj as je,ib as wa,iL as ga,ce as yt,eL as ya,cd as te,cc as he,h3 as ce,kq as va,dK as _a,op as ka,h1 as Se,s6 as ba,s7 as Fa}from"./index-b516d057.js";import{y as Ma,I as Ca}from"./Attachments-ef3101ea.js";import{D as Ia,H as Ea}from"./FeatureForm-b39b9196.js";import{t as Pt,h as Aa,o as Wa,M as $a,m as Sa}from"./FeatureTemplates-6a941e87.js";import{c as Va,h as Ta}from"./Spinner-2d11b064.js";import{i as Pa,r as Q,n as h,g as qe,X as nt,e as Re,O as Oa}from"./jsxFactory-92036771.js";import{h as Ot}from"./UpdatingHandles-7949a657.js";import{o as Ke}from"./editableLayers-856f2cb4.js";import{r as vt}from"./uuid-709b6c67.js";import{e as Lt}from"./helpMessageUtils-1ce96584.js";import{p as La}from"./SnappingManager-aa70fdd4.js";import{o as Ua,r as xa}from"./drapedUtils-5cffceb9.js";import{L as Qe}from"./symbolUtils-b4f6caa2.js";import{e as Ut}from"./GraphicState-0d3046df.js";import{t as Da,s as xt}from"./hitTestSelectUtils-d512707e.js";import{l as Dt}from"./HighlightHelper-5e29e60e.js";import{n as Ha}from"./layerViewUtils-6ebe90f4.js";import{K as Ra}from"./featureUtils-73b624d6.js";import{H as Ga}from"./featureFormUtils-24147792.js";import{a as za}from"./SketchViewModel-fedf7932.js";import{l as lt,a as dt,_ as Na,w as Ba}from"./SnappingControls-5de1618f.js";import{e as Ve,n as Fe}from"./Heading-92f210ca.js";import{l as ja}from"./uploadAssetErrors-faaa3a92.js";import{e as _t}from"./globalCss-94006b67.js";import{e as qa}from"./vmEvent-d773b6c5.js";import"./unitFormatUtils-67047561.js";import"./Cyclical-4c223a04.js";import"./AttachmentInfo-3d2302be.js";import"./AttachmentQuery-bede5a71.js";import"./FeatureLayerBase-0746b503.js";import"./HeightModelInfo-b816d32b.js";import"./featureLayerUtils-16361d1f.js";import"./featureQueryAll-40af0622.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./jsonUtils-52514725.js";import"./DictionaryLoader-e327eff9.js";import"./Version-1f969b2a.js";import"./FieldsIndex-e8db657f.js";import"./UnknownTimeZone-a05df022.js";import"./HeatmapColorStop-3fff4333.js";import"./heatmapUtils-7f42325f.js";import"./RelationshipQuery-2c9e4485.js";import"./LayerFloorInfo-4234db4d.js";import"./serviceCapabilitiesUtils-42d4d20c.js";import"./FieldInput-8449e312.js";import"./utils-1a995f8e.js";import"./basemapUtils-6ec10a55.js";import"./Basemap-8d62c69e.js";import"./loadAll-5e767cfa.js";import"./writeUtils-e226a8aa.js";import"./TimeOnly-879c5107.js";import"./ImmutableArray-ee1d0ce7.js";import"./FeatureLayer-c4c5819f.js";import"./editsZScale-e45bb69c.js";import"./queryZScale-d7a48772.js";import"./APIKeyMixin-bfb00271.js";import"./EditBusLayer-caf9fed8.js";import"./FeatureEffectLayer-1948d1a0.js";import"./FeatureEffect-c80bb16d.js";import"./FeatureFilter-55dd341e.js";import"./FeatureReductionLayer-443167bc.js";import"./clusterUtils-50a66940.js";import"./MD5-715f37cd.js";import"./FeatureReductionSelection-d84c375a.js";import"./LabelClass-c3c309a8.js";import"./labelUtils-b29175f3.js";import"./defaults-4faa92e6.js";import"./defaultsJSON-59981e75.js";import"./OrderedLayer-32293fe1.js";import"./FeatureTemplate-d1d1c7be.js";import"./FeatureType-f30c4b8b.js";import"./fieldProperties-8c831c84.js";import"./labelingInfo-aae625ac.js";import"./versionUtils-5892620e.js";import"./styleUtils-a3d96bf6.js";import"./TopFeaturesQuery-6d0bf5f5.js";import"./FeatureRelationshipViewModel-9f00674c.js";import"./AnchorElementViewModel-8d35dd28.js";import"./elevationInfoUtils-be36d866.js";import"./snappingUtils-93e84fbe.js";import"./dehydratedPoint-5a1dfed5.js";import"./screenUtils-8dc4a7f9.js";import"./signal-51ed66f5.js";import"./geometry2dUtils-a99dcf3d.js";import"./floorFilterUtils-080a7cd2.js";import"./viewUtils-9f810d02.js";import"./mat2df32-fb26a8c9.js";import"./mat2d-d4af8487.js";import"./webStyleSymbolUtils-4761c8f2.js";import"./devEnvironmentUtils-4eab2a99.js";import"./layerUtils-437666a3.js";import"./geodesicUtils-822c19ca.js";import"./SketchTooltipOptions-cc43c059.js";import"./layerListUtils-a0f5e0ab.js";import"./LayerListViewModel-3e44a2f6.js";import"./ListItem-5ca108fc.js";import"./widget-826a6ea9.js";const X="esri-editor",Z={base:X,helpMessage:`${X}__help-message`,updateActions:`${X}__update-actions`,updateActionsList:`${X}__update-actions-list`,featureTemplatesContainer:`${X}__feature-templates-container`,templateItemContentEnd:`${X}__template-item-content-end`,widgetIcon:Pa.edit};function se(e,t,a=void 0){It(e,"`"+t+"` is deprecated, because it instantiates the deprecated class 'esri.widgets.Editor.CreateWorkflow'",{replacement:a,version:"4.23",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Editor-CreateFeaturesWorkflow.html"})}let N=class extends oe{constructor(t){super(t),this.creationInfo=null,this.editableItem=null,this.parent=null,this.pendingFeatures=new Ne,this.viewModel=null,this.upload=null}};l([d()],N.prototype,"creationInfo",void 0),l([d()],N.prototype,"editableItem",void 0),l([d()],N.prototype,"parent",void 0),l([d()],N.prototype,"viewModel",void 0),l([d()],N.prototype,"upload",void 0),N=l([V("esri.widgets.Editor.CreateFeaturesWorkflowData")],N);function Ue(e){const t=e.sourceLayer;if(!t||t.type!=="feature"||!Ya(t.renderer))return{rotation:null,size:null};let a=null,i=null;const s=t.renderer.getVisualVariablesForType("rotation").filter(o=>(!o.axis||o.axis==="heading")&&o.field&&!o.valueExpression&&ta(o,e)!=null);s.length===1&&(a=Ka(s[0],t));const r=t.renderer.getVisualVariablesForType("size").filter(o=>o.field&&!o.useSymbolValue&&!o.valueExpression&&aa(o)===ia.RealWorldSize&&sa(o,e)!=null);return r.length===1&&(i=Xa(r[0],t)),{rotation:a,size:i}}function Ka(e,t){const a=(e.axis||"heading")==="heading"&&e.rotationType==="arithmetic"?-1:1,i=e.field,s=t.fields&&t.fields.filter(n=>n.name===i),r=s&&s.length===1?s[0].type:"double",o={initial:0,current:0};return{field:i,fieldType:r,getDefault:()=>Promise.resolve(0),getValue:n=>(o.current=o.initial-a*n,Ze((o.current+360)%360,r)),initValue:n=>{o.initial=n??o.current,o.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}function Qa(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}async function Za(e,t,a){if(t==null)return 0;const{symbol:i}=la(t);if(i==null||i.type==="web-style"||i.type==="cim")return 0;const s=i.symbolLayers.at(0);if(!s)return 0;switch(s.type){case"icon":{const{computeIconLayerResourceSize:r}=await A(()=>import("./symbolLayerUtils-99abac24.js"),["assets/symbolLayerUtils-99abac24.js","assets/index-b516d057.js","assets/index-b252abd2.css"]);return s.size||Math.min(z.icon,(await r(s,z.icon))[0])||z.icon}case"text":return s.size||z.text;case"line":return s.size||z.line;case"object":{const{computeObjectLayerResourceSize:r}=await A(()=>import("./symbolLayerUtils-99abac24.js"),["assets/symbolLayerUtils-99abac24.js","assets/index-b516d057.js","assets/index-b252abd2.css"]);return Qa(await r(s,e.scale/z.viewScaleSizeFactor),a)}case"path":return(s.width!=null?s.width:s.height)||e.scale/z.viewScaleSizeFactor;case"extrude":return s.size||e.scale/z.viewScaleSizeFactor;default:return 0}}function Xa(e,t){const a=e.field,i=e.axis,s=t.fields&&t.fields.filter(u=>u.name===a),r=s&&s.length===1?s[0].type:"double",o={updating:!1,initial:0,current:0},n=ra[e.valueUnit]??1;let c;return c=e.valueRepresentation==="area"?u=>(u*n/2)**2*Math.PI:e.valueRepresentation==="radius"||e.valueRepresentation==="distance"?u=>u*n/2:u=>u*n,{field:a,fieldType:r,getDefault:async(u,p)=>Ze(c(await Za(p,u,i)),r),getValue:(u,p)=>(o.initial||(o.initial=p.pixelSizeAt(p.center)),o.current=o.initial*u,Ze(o.current,r)),initValue:u=>{o.initial=u??o.current,o.current=0},isUpdatingInteractively:!1,displayUnit:ui(e.valueUnit),axis:e.axis}}function Ze(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function Ya(e){switch(e==null?void 0:e.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function H(e,t,a){const i=await Qe(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:a});oa(e.symbol,i)!=null&&(e.symbol=i)}function Ja(e){if(!e)throw new Error("no geometry type");return e==="multipatch"?"mesh":e}async function ei(e,t,a,i){(await Xe(e,t,i)).remove();const s=e.on("create",async r=>{var o,n,c;if(r.state==="cancel"&&(await Xe(e,t,i)).remove(),r.state==="complete"){const u=r.graphic;u.sourceLayer||(u.sourceLayer=t.layer),u.attributes||(u.attributes={...(o=t.template)==null?void 0:o.prototype.attributes});const p=((n=e.view)==null?void 0:n.type)==="2d"?(c=e.view)==null?void 0:c.scale:null;await H(u,i,p),a(u)}});return K([s,F(()=>e.cancel())])}async function Xe(e,t,a){var p;const i=t.layer,s={...(p=t.template)==null?void 0:p.prototype.attributes,...t.attributeOverrides};let r=null;const{view:o}=e,n=(o==null?void 0:o.type)==="2d";if(await kt(e,i,s,a,n?o.scale:null),n){const m=Oe(f=>kt(e,i,s,a,f));r=C(()=>o.scale,f=>m(f))}const{data:c,editing:u}=i.capabilities;return e.layer.elevationInfo=i.elevationInfo,await e.create(Ja(i.geometryType),{graphicProperties:{attributes:s,sourceLayer:i},hasZ:c.supportsZ,defaultZ:(n?u.zDefault:null)??e.defaultCreateOptions.defaultZ,geometryToPlace:t.geometryToPlace??void 0}),r??F()}async function kt(e,t,a,i,s){const r=new st({sourceLayer:t,attributes:a}),{rotation:o,size:n}=Ue(r);let c=await Qe(r,{useSourceLayer:!0,webStyleCache:i,scale:s}),u=!1;for(const p of[n,o])p!=null&&a[p.field]==null&&(a[p.field]=await p.getDefault(c,e.view),u=!0);switch(u&&(c=await Qe(r,{useSourceLayer:!0,webStyleCache:i,scale:s})),c==null?void 0:c.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}Ht(e.tooltipOptions,n,o)}function Ht(e,t,a){e.visualVariables=t!=null||a!=null?{size:t!=null?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:a!=null?{valueType:a.fieldType,rotationType:a.rotationType??"geographic"}:null}:null}function ct(e,t){return e?e.find(a=>a.layer===t):void 0}async function ti(e,t,a,i){switch(t.type){case"3d":return ai(e,t,a,i);case"2d":return ii(e,t,a,i)}}async function ai(e,t,a,i){if(e.length===0)return[];const{updatable:s,graphicsByLayer:r}=await a.async(async()=>{const{results:o}=await $e(Da(t,a),i),n=new Map,c=p=>{const m=p.layer,f=n.get(m);if(!f){const w=new Array;return n.set(m,w),w}return f};xt(o).forEach(({graphic:p})=>c(p).push(p));const u=e.filter(({supports:p,layer:m})=>p.includes("update")&&n.has(m));return u.length!==0&&a.stopPropagation(),{updatable:u,graphicsByLayer:n}});return $e(Promise.allSettled(s.map(async({layer:o})=>{const n=r.get(o),c=Rt(o);if(n.every(m=>da(c,m)))return n;const u=[];for(const m of n){u.push(m.getObjectId());const f=Object.keys(m.attributes);ca(c,f)}const p=o.createQuery();return p.returnGeometry=!1,p.objectIds=u,p.outFields=Wt(o.fieldsIndex,c),o.queryFeatures(p,{signal:i}).then(({features:m})=>m)})),i)}async function ii(e,t,a,i){if(e.length===0)return[];let s=null;const r=await a.async(async()=>{const{results:o}=await $e(t.hitTest(a),i);if(o.length===0)return[];const n=new Set;s=xt(o),s.forEach(({graphic:u})=>u&&n.add(u.layer));const c=e.items.filter(({layer:u,supports:p,attachmentsOnUpdateEnabled:m})=>n.has(u)&&(p.includes("update")||p.includes("delete")||m));return c.length>0&&a.stopPropagation(),c});return $e(Promise.allSettled(r.map(async({layer:o})=>{const n=o.createQuery();n.returnGeometry=!1,n.outFields=Rt(o);const c="renderer"in o?Ua({renderer:o.renderer,event:a}):0;n.geometry=xa(a.mapPoint,c,t),n.outSpatialReference=t.spatialReference;const{features:u}=await o.queryFeatures(n,{signal:i});return s==null||s.forEach(({graphic:p})=>{p.layer!==o||u.some(m=>m.getObjectId()===p.getObjectId())||u.push(p)}),u})),i)}function Rt(e){return Wt(e.fieldsIndex,[e.objectIdField,$t({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function si(e,t,a){const{sourceLayer:i}=e,s=i.createQuery();s.objectIds=[e.getAttribute(i.objectIdField)],s.outFields=["*"],s.outSpatialReference=t,s.returnM=i.capabilities.data.supportsM,s.returnZ=i.capabilities.data.supportsZ,Et()&&At()&&i.type==="scene"&&i.infoFor3D!=null&&(s.returnGeometry=!0,s.formatOf3DObjects="3D_glb");const r=await i.queryFeatures(s,{signal:a});return ve(a),r.features[0]}async function we(e){var p;const{graphic:t,sketchViewModel:a,sourceLayer:i,visualVariables:s,webStyleCache:r}=e;let o=!1;const{rotation:n,size:c}=s;if([n,c].forEach(async m=>{if(m==null)return;const f=t.getAttribute(m.field);if(f!=null)m.initValue(f);else{const w=await m.getDefault(t.symbol,a.view);m.initValue(w),t.setAttribute(m.field,w),o=!0}}),o){const m=((p=a.view)==null?void 0:p.type)==="2d"?a.view.scale:null;await H(t,r,m)}const u={multipleSelectionEnabled:!1};return i.geometryType==="point"&&(u.enableRotation=n!=null,u.enableScaling=c!=null),Ht(a.tooltipOptions,c,n),a.layer.elevationInfo=i.elevationInfo,a.update(t,u)}function ri(e){return e==null||e.type!=="rotate-start"&&e.type!=="rotate"&&e.type!=="rotate-stop"?null:e}function oi(e){return e==null||e.type!=="scale-start"&&e.type!=="scale"&&e.type!=="scale-stop"?null:e}async function ut(e,t,a,i,s){var u;if(t.geometry==null||((u=t.geometry)==null?void 0:u.type)!=="point")return;const r=i.rotation,o=ri(a.toolEventInfo);if(r!=null&&o!=null)if(o.type==="rotate-stop")r.isUpdatingInteractively=!1,r.initValue();else{r.isUpdatingInteractively=!0;const{field:p,getValue:m}=r;t.setAttribute(p,m(o.angle,e))}const n=i.size,c=oi(a.toolEventInfo);if(n!=null&&c!=null)if(c.type==="scale-stop")n.isUpdatingInteractively=!1,n.initValue();else{n.isUpdatingInteractively=!0;const{field:p,getValue:m}=n;t.setAttribute(p,m(c.xScale,e))}await H(t,s,e.type==="2d"?e.scale:null)}async function ni({feature:e,featureClone:t,visualVariableAttributes:a,sketchViewModel:i,view:s,onUpdate:r,webStyleCache:o}){var v;await H(t,o,s.type==="2d"?s.scale:null);let n=null;if(((v=i==null?void 0:i.view)==null?void 0:v.type)==="2d"){const g=Oe(M=>H(t,o,M));n=C(()=>{var M;return(M=i==null?void 0:i.view)==null?void 0:M.scale},M=>g(M))}s.map.add(i.layer);const c=t.sourceLayer,u=ge(s,c);await we({graphic:t,sketchViewModel:i,sourceLayer:c,visualVariables:a,webStyleCache:o});let p=null;u.then(g=>p=g).catch(()=>{});const m=a.size,f=a.rotation,w=C(()=>e.attributes,async g=>{let M=!1;for(const W in g){const I=g[W];I!==t.getAttribute(W)&&(t.setAttribute(W,I),m==null||m.isUpdatingInteractively||m.field!==W||m.initValue(I),f==null||f.isUpdatingInteractively||f.field!==W||f.initValue(I),(p==null||p.requiredFields.includes(W))&&(M=!0))}M&&await H(t,o,s.type==="2d"?s.scale:null)}),y=i.on("update",async g=>{const M=g.graphics[0];if(g.state==="complete")return we({graphic:M,sketchViewModel:i,sourceLayer:c,visualVariables:a,webStyleCache:o});await ut(s,M,g,a,o),r(Ye(M),g)}),b=i.on(["undo","redo"],async g=>{r(Ye(g.graphics[0]),g)});return K([b,y,F(()=>i.cancel()),w,n])}async function li(e,t,a){const i=e.view;e.layer.add(a);const s=t.sourceLayer,r=t.layer,o=t.getAttribute(r.objectIdField);let n=null;function c(u){n==null||n.abort(),n=St(async p=>{var f;const m=await ge(i,s);ve(p),(f=m.setVisibility)==null||f.call(m,o,u)})}return await ci(i,a),c(!1),K([di(i,a,u=>c(!u)),F(async()=>{c(!0);try{const u=await ge(i,s);await S(()=>!u.updating)}finally{e.layer.remove(a)}})])}function di(e,t,a){if(e.type==="3d"){const i=new Ut({graphic:t});return K([e.trackGraphicState(i),C(()=>i.displaying,a)])}return C(()=>t.visible,a)}async function ci(e,t){if(e.type==="3d"){const a=new Ut({graphic:t}),i=e.trackGraphicState(a);await S(()=>a.displaying),i.remove()}else await S(()=>t.visible)}const z={icon:De(24),text:De(12),line:De(1),viewScaleSizeFactor:100};function pt(e,t,a){let i=!1;return e.filter(s=>!!i||(i=s===t,i)).map(s=>a[s]())}function Gt(e,t){e.viewModel.syncFeatureTemplates();const a=e.creationInfo;if(t[0].id==="awaiting-feature-creation-info"&&a){const i=a.layer,s=Pt(i);s.length===1&&i.type!=="scene"&&(a.template=s[0],t.shift())}return t}function ui(e){switch(e){case"unknown":case"decimal-degrees":return null;default:return e}}function zt(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}}function Nt(e){var n,c;const{creationInfo:t,viewModel:a}=e;if(!t)return!1;const{layer:i}=t,s=a.editableItems.find(u=>u.layer===i);if(s)return s.attachmentsOnCreateEnabled;const r=(n=i.capabilities)==null?void 0:n.data,o=(c=a.layerInfos)==null?void 0:c.find(u=>u.layer===i);return!(!(r&&"supportsAttachment"in r&&r.supportsAttachment)||o&&(o.allowAttachments===!1||o.attachmentsOnUpdateEnabled===!1))}const Bt=e=>/-stop/.test(e)||/vertex-/.test(e),ge=(e,t)=>{const a=t.type==="subtype-sublayer"?t.parent:t;return e.whenLayerView(a)};function pi(e){return"createInteractiveEditSession"in e}function Ye(e){var a;const t=e.geometry;if((t==null?void 0:t.type)==="mesh"){const i=e.cloneShallow();return i.attributes=na(e.attributes),i.geometry=t.cloneShallow(),i.geometry.transform=((a=t.transform)==null?void 0:a.clone())??null,i}return e.clone()}function Je(e){const t=e.cursor;return e.cursor="progress",F(()=>e.cursor=t)}async function hi({view:e,data:t,signal:a,next:i,cancel:s}){const{creationInfo:r}=t;if(!r)return F();if(!me(r))return F();const{layer:o}=r,n=r.geometryToPlace!=null;if(r.geometryToPlace=null,n)return s(),F();const{Upload:c}=await A(()=>import("./Upload-7ae5fb42.js"),["assets/Upload-7ae5fb42.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/progressUtils-874eb29d.js"]);ve(a);const u=new c;t.upload=u;let p=null;const m=()=>p==null?void 0:p.remove(),f=K([C(()=>u.state,w=>{switch(w){case"default":case"error":m();break;case"pending":m(),p=Je(e);break;case"success":r.maxFeatures=1,r.geometryToPlace=u.result,m(),i()}}),F(()=>{u.cancel(),m()})]);return u.uploadTo(o),f}function me(e){const t=e==null?void 0:e.layer;return(t==null?void 0:t.type)==="scene"}let E=class extends Vt.EventedAccessor{constructor(t){super(t),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new Ot,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:t}=this;return!!(t&&this._stepIndex<t.filter(a=>!a.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get hasUnsupportedFields(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:t}=this,a=t&&t[this._stepIndex];return a&&a.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(t=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await t()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(t={force:!0}){return t.force!==!1?this._cancel(t):new Promise((a,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...t,force:!0}).then(a)},deny:()=>i(new $("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(t){const{steps:a}=this,i=a.findIndex(s=>s.id===t);this._indexHistory.push(this._stepIndex),await this._go(i)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(t={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),t.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const t=this._stepIndex===-1?0:this._stepIndex;await this._go(t)}async _cancel({emitCancelEvent:t=!0,error:a}={}){this.started&&(this._set("started",!1),await this._transaction(()=>{var i;return(i=this.steps[this._stepIndex])==null?void 0:i.tearDown({canceled:!0})})),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(t),t&&this.emit("cancel",{error:a})}_go(t=-1,a=!1){return this._transaction(async()=>{const{steps:i}=this;if(!(t<=-1||t>=i.length)){if(!this.started)return this._stepIndex=t,void this._notifyStepProps();this._lastStepIndex>-1&&await i[this._lastStepIndex].tearDown({canceled:a});try{await i[t].setUp()}catch(s){ua(s)}this._lastStepIndex=t,this._stepIndex=t,this._notifyStepProps()}})}async _transaction(t){const a=this._pendingOperation,i=Tt(),s=(a??Promise.resolve()).then(()=>i.promise);this._pendingOperation=s,this._updatingHandles.addPromise(s);try{a&&await a,await t()}finally{i.resolve(),s===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(t=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,t&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};l([d()],E.prototype,"data",void 0),l([d()],E.prototype,"hasNextStep",null),l([d()],E.prototype,"hasPreviousStep",null),l([d()],E.prototype,"onCommit",void 0),l([d()],E.prototype,"reliesOnOwnerAdminPrivileges",null),l([d()],E.prototype,"hasInvalidFormTemplate",null),l([d()],E.prototype,"hasUnsupportedFields",null),l([d()],E.prototype,"shouldShowAttachments",null),l([d()],E.prototype,"shouldAllowAttachmentEditing",null),l([d()],E.prototype,"started",void 0),l([d({readOnly:!0})],E.prototype,"stepId",null),l([d()],E.prototype,"steps",void 0),l([d({readOnly:!0})],E.prototype,"type",void 0),l([d()],E.prototype,"helpMessage",null),l([d()],E.prototype,"hasPendingEdits",null),l([d()],E.prototype,"keyboardCancellationEnabled",null),l([d()],E.prototype,"updating",null),E=l([V("esri.widgets.Editor.Workflow")],E);const xe=E;var Me;const Ge=Symbol(),bt=Symbol(),Y=Symbol(),ke=Symbol();let O=Me=class extends xe{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._attachmentFileInfos=new Map,this._highlightHandles=new Map,this._preventDefaultActionOnCancel=!1,this._lastActiveGraphics=[],this._isActive=!0,this._updateGraphicDebounced=Oe((t,a,i)=>H(t,a,i))}initialize(){this.isNested&&(this._isActive=!1)}get hasPendingEdits(){var r,o;if(this.numPendingFeatures>0)return!0;const{data:e}=this,{sketchViewModel:t}=e.viewModel,{activeComponent:a}=t,i=(r=t.createGraphic)==null?void 0:r.geometry;if(((i==null?void 0:i.type)==="polyline"||(i==null?void 0:i.type)==="polygon"||(i==null?void 0:i.type)==="multipoint")&&((a==null?void 0:a.type)==="draw-2d"||(a==null?void 0:a.type)==="draw-3d")&&a.drawOperation.committedVertices.length>0)return!0;const{upload:s}=e;return!(!s||s.state!=="pending"&&s.state!=="success")||!!((o=e.creationInfo)!=null&&o.geometryToPlace)}get helpMessage(){var s;const{creationInfo:e,viewModel:t}=this.data;if(this.stepId!=="creating-features"||!e)return;const a=e.layer.geometryType,i=t.sketchViewModel.createGraphic;if(a==="mesh"){this._getDrawMeshHelpMessage||A(()=>import("./helpMessageUtils3d-26675e60.js"),["assets/helpMessageUtils3d-26675e60.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/elevationInfoUtils-be36d866.js"]).then(o=>{this._getDrawMeshHelpMessage=o.getDrawMeshHelpMessage});const{view:r}=t;return(r==null?void 0:r.type)==="3d"?(s=this._getDrawMeshHelpMessage)==null?void 0:s.call(this,i,r):void 0}return Lt(a,i==null?void 0:i.geometry)}get numPendingFeatures(){return this.pendingFeatures.length}get parent(){return this.data.parent}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return this.numPendingFeatures===0}get reliesOnOwnerAdminPrivileges(){var s,r;const{creationInfo:e}=this.data;if(!e)return!1;const{layer:t}=e,a=(s=t.capabilities)==null?void 0:s.operations.supportsAdd,i=(r=Le(t))==null?void 0:r.operations.supportsAdd;return rt(t)&&!t.editingEnabled||!!i&&!a}get shouldShowAttachments(){return!(!this.data.creationInfo||!this.data.viewModel)&&Nt(this.data)}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get test(){return{addAttachment:(e,t)=>{this._attachmentFileInfos.set(e,t)}}}async enter(){this._isActive=!0;const{featureFormViewModel:e}=this.data.viewModel,t=e.relatedRecordCallbacks;e.relatedRecordCallbacks=null,this.addHandles(F(()=>{e.relatedRecordCallbacks=t}),bt),this.stepId!=="awaiting-feature-creation-info"&&this._setUpCreatingFeaturesStep()}exit(){this._isActive=!1,this.removeHandles([bt,ke])}async updatePendingFeature(e,t){return this._preventDefaultActionOnCancel=!0,this.data.viewModel.sketchViewModel.cancel(),ft(this._lastActiveGraphics,e),this._startUpdating(e,t)}async start(){var e;return await super.start(),ie((e=this.data.creationInfo)==null?void 0:e.layer)?null:{enter:async()=>{},exit:async()=>{}}}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:a,isNested:i,creationInfo:s,parent:r,startAt:o,viewModel:n}=e,c=new Me({data:new N({creationInfo:s,parent:r,viewModel:n}),isNested:i,onCommit:async u=>{var v;const{creationInfo:p}=u;if(!p)return;const m=u.pendingFeatures.toArray(),{layer:f}=p,w=((v=f.capabilities)==null?void 0:v.editing.supportsGlobalId)&&"globalIdField"in f,y=c._attachmentFileInfos;if(w){const g=wi(m,f,y);return void await a(f,g,{globalIdUsed:!0})}const b=await a(f,{addFeatures:m});if(y.size>0){const g=(b==null?void 0:b.addFeatureResults)??[];await t(f,fi(m,g,f,y))}}});return c._set("steps",this._createWorkflowSteps(c,o)),c}_fadeExistingFeatures(e){if("effect"in e){const a=e.effect;return e.effect="saturate(0.6) opacity(0.8)",F(()=>e.effect=a)}const t=e.opacity;return e.opacity=.7,F(()=>e.opacity=t)}_highlight(e){const t=this.data.viewModel.view;(t==null?void 0:t.type)==="3d"&&this._highlightHandles.set(e,t.highlight(e))}_removeHighlight(e){He(this._highlightHandles.get(e)),this._highlightHandles.delete(e)}async _startCreating(e){this.removeHandles(Y);const{data:t}=this,{creationInfo:a}=t;if(!a)return;this.createFeatureState="create-new";const i=await Xe(t.viewModel.sketchViewModel,a,e);this.addHandles(i,Y)}async _startUpdating(e,t){var b;const{pendingFeatures:a}=this;a.includes(e)||a.add(e);const{creationInfo:i,viewModel:s}=this.data,{attachmentsViewModel:r,editableItems:o,featureFormViewModel:n,layerInfos:c,sketchViewModel:u,view:p}=s;if(!p||!i)return;const m=i.layer,f=ct(c,m),w=f==null?void 0:f.formTemplate,y=p.spatialReference;if(this.data.editableItem=o.find(v=>v.layer===m),n.set({arcadeEditType:"INSERT",feature:e,formTemplate:w,spatialReference:y,map:p.map}),r.mode!=="add"&&r.mode!=="edit"||((b=s.activeWorkflow)==null||b.previous()),r.graphic=e,r.fileInfos.removeAll(),r.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach(({file:v,form:g})=>r.addFile(v,g)),this._removeHighlight(e),await H(e,t,p.type==="2d"?p.scale:null),this.removeHandles(Y),He(this._featureFormHandle),p.type==="2d"){const v=C(()=>p.scale,g=>this._updateGraphicDebounced(e,t,g));this.addHandles(v,Y)}return this._featureFormHandle=K([n.on("value-change",async()=>{e.attributes=n.getValues(),await H(e,t,p.type==="2d"?p.scale:null)}),u.on(["update","undo","redo"],v=>{(v.type==="undo"||v.type==="redo"||v.type==="update"&&v.toolEventInfo!=null&&Bt(v.toolEventInfo.type))&&n.notifyFeatureGeometryChanged()})]),this.createFeatureState="update-pending",this._visualVariableAttributes=Ue(e),ie(m)?void 0:we({graphic:e,sketchViewModel:u,sourceLayer:m,visualVariables:this._visualVariableAttributes,webStyleCache:t})}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:a}=e,i=pt(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:s,viewModel:r}=a,{view:o}=r;o&&(me(s)?e.addHandles(await hi({view:o,data:a,next:()=>e.next(),cancel:()=>r.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(a.parent&&s&&(e.addHandles(r.lockFeatureTemplatesViewModel(),this.id),r.featureTemplatesViewModel.layers=[s.layer]),e.addHandles(r.featureTemplatesViewModel.on("select",({item:n})=>{n&&(a.creationInfo={...a.creationInfo,layer:n.layer,template:n.template},e.next())}),this.id)))},async tearDown(){e.removeHandles([this.id,Y])}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(s){const{viewModel:r}=a;s.canceled&&(e.removeHandles([ke,Ge,Y]),r.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=a.viewModel,{graphic:r,fileInfos:o}=s;e._attachmentFileInfos.set(r,o.toArray()),s.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:s}=a.viewModel,{graphic:r,fileInfos:o}=s;e._attachmentFileInfos.set(r,o.toArray()),s.mode="view"}})});return Gt(a,i)}static _configureSketchViewModel(e,t){const{data:a}=e,{viewModel:i}=a,{view:s}=i,r=i.sketchViewModel;let o=null;const n=[];if(!s)return{beforeCommit:F(),afterCommit:F()};const c=r.updateOnGraphicClick;return r.updateOnGraphicClick=!1,s.type==="2d"&&a.creationInfo&&n.push(e._fadeExistingFeatures(a.creationInfo.layer)),n.push(r.on("create",async u=>{if(u.state==="cancel"){if(e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);if(e._lastActiveGraphics.length<1)return e._startCreating(t);const p=e._lastActiveGraphics.pop();return e._startUpdating(p,t)}if(u.state==="complete"&&u.graphic)return e._startUpdating(u.graphic,t)}),r.on("update",async u=>{var M,W;const{viewModel:p}=a,{attachmentsViewModel:m,featureFormViewModel:f}=p,w=u.graphics[0];if(u.state==="complete"){if(w!==o&&(e._lastActiveGraphics.push(w),e._highlight(w)),o=null,e.numPendingFeatures===((M=a.creationInfo)==null?void 0:M.maxFeatures)){const I=e._lastActiveGraphics.pop();return e._startUpdating(I,t)}if(m.mode!=="add"&&m.mode!=="edit"||((W=p.activeWorkflow)==null||W.previous()),u.aborted&&e._preventDefaultActionOnCancel)return void(e._preventDefaultActionOnCancel=!1);e.addHandles([Je(s),s.on("click",I=>I.preventDefault())],Ge),await S(()=>!f.updating),e.removeHandles(Ge),e._startCreating(t)}u.state==="start"&&e._removeHighlight(w);const y=e._visualVariableAttributes;await ut(s,w,u,y,t);const b=w.attributes,{rotation:v,size:g}=y;if(v!=null){const{field:I}=v;f.setValue(I,b[I])}if(g!=null){const{field:I}=g;f.setValue(I,b[I])}}),r.on("delete",async u=>{const p=u.graphics[0];e.pendingFeatures.remove(p),ft(e._lastActiveGraphics,p),o=p}),s.on("immediate-click",async u=>{if(me(a.creationInfo))return;const{results:p}=await s.hitTest(u,{include:r.layer}),m=p.find(w=>{var y;return w.type==="graphic"&&w.graphic.sourceLayer===((y=a.creationInfo)==null?void 0:y.layer)});if(!m)return;const f=m.graphic;if(r.activeTool==="transform"||r.activeTool==="reshape"){if(r.updateGraphics.at(0)===f)return;await e.updatePendingFeature(f,t)}}),F(()=>{e._preventDefaultActionOnCancel=!0,r.cancel()}),mi(r,a)),{beforeCommit:K(n),afterCommit:F(()=>{r.updateOnGraphicClick=c})}}async _setUpCreatingFeaturesStep(){var p;if(this.hasHandles(ke))return;const{creationInfo:e,viewModel:t}=this.data,{attachmentsViewModel:a,view:i}=t;if(!i)return;const s=new Map,r=[],o=[];this._lastActiveGraphics=[],this._featureFormHandle=He(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},zt(a),r.push(C(()=>a.mode,m=>{switch(m){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const n=Je(i);r.push(n);const c=ie(e==null?void 0:e.layer);try{if(me(e)&&o.push(F(()=>t.cancelWorkflow({warnIfNoWorkflow:!1}))),c){const m=(e==null?void 0:e.initialFeature)??new st({attributes:{...(p=e==null?void 0:e.template)==null?void 0:p.prototype.attributes,...e==null?void 0:e.attributeOverrides},sourceLayer:e==null?void 0:e.layer});await this._startUpdating(m,s)}else{const m=Me._configureSketchViewModel(this,s);r.push(m.beforeCommit),o.push(m.afterCommit),e!=null&&e.initialFeature?(t.sketchViewModel.layer.add(e.initialFeature),await this._startUpdating(e.initialFeature,s)):await this._startCreating(s)}}finally{n.remove()}const u=F(()=>this.pendingFeatures.drain(m=>t.sketchViewModel.layer.remove(m)));r.push(this._featureFormHandle),this.addHandles(r.filter(fe),this._handleKeys.beforeCommit),this.addHandles([F(()=>a.fileInfos.removeAll()),...r,...o,u].filter(fe),ke)}};function mi(e,t){let a=null;const i=()=>e.snappingOptions.featureSources,s=()=>(a=new La({layer:e.layer}),i().add(a),a),r=()=>{a!=null&&(i().remove(a),a=pa(a))};return K([C(()=>{var c;const o=(c=t.creationInfo)==null?void 0:c.layer,n=i().find(u=>u.layer===o);return{hasFeatureLayerSource:!!n,enabled:(n==null?void 0:n.enabled)??!1}},({hasFeatureLayerSource:o,enabled:n})=>{if(!o)return r();a??(a=s()),a.enabled=n},Be),F(r)])}function fi(e,t,a,i){const s=[];return t.forEach((r,o)=>{if(!r.error){const n=e[o],c=i.get(n)||[];n.attributes[a.objectIdField]=r.objectId,c.forEach(({form:u})=>s.push({feature:n,attachment:u}))}}),s}function wi(e,t,a){const i=[],s=t.globalIdField;return e.forEach((r,o)=>{var n;(n=e[o].attributes)[s]??(n[s]=vt()),((a==null?void 0:a.get(r))||[]).forEach(({file:c})=>i.push({feature:r,attachment:{globalId:vt(),data:c}}))}),i.length?{addFeatures:e,addAttachments:i}:{addFeatures:e}}l([d({constructOnly:!0})],O.prototype,"isNested",void 0),l([d()],O.prototype,"hasPendingEdits",null),l([d()],O.prototype,"_getDrawMeshHelpMessage",void 0),l([d()],O.prototype,"helpMessage",null),l([d()],O.prototype,"parent",null),l([d()],O.prototype,"keyboardCancellationEnabled",null),l([d()],O.prototype,"reliesOnOwnerAdminPrivileges",null),l([d()],O.prototype,"shouldShowAttachments",null),l([d()],O.prototype,"shouldAllowAttachmentEditing",null),O=Me=l([V("esri.widgets.Editor.CreateFeaturesWorkflow")],O);const jt=O;let ae=class extends oe{constructor(t){super(t),this.creationInfo=null,this.edits=null,this.viewModel=null}};l([d()],ae.prototype,"creationInfo",void 0),l([d()],ae.prototype,"edits",void 0),l([d()],ae.prototype,"viewModel",void 0),ae=l([V("esri.widgets.Editor.CreateWorkflowData")],ae);const gi=ae;function Ft(e){return e==null?null:JSON.stringify(e)}let D=class extends oe{constructor(t){super(t),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null}get attributesModified(){return this._stringifyAttributes(this.feature)!==this._stringifyAttributes(this.initialFeature)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(){var t;this.initialFeature=(t=this.feature)==null?void 0:t.clone()}updateAttributes(t){const{feature:a}=this;a&&(a.attributes=t,this.notifyChange("attributesModified"))}updateGeometry(t){const{feature:a}=this;a&&(a.geometry=t,this.notifyChange("geometryModified"))}_stringifyAttributes(t){return Ft(t==null?void 0:t.attributes)}_stringifyGeometry(t){const a=t==null?void 0:t.geometry;return Ft((a==null?void 0:a.type)==="mesh"?{transform:a.transform,vertexSpace:a.vertexSpace}:a)}};l([d()],D.prototype,"_stagedForDelete",void 0),l([d()],D.prototype,"attributesModified",null),l([d()],D.prototype,"feature",void 0),l([d()],D.prototype,"geometryModified",null),l([d()],D.prototype,"initialFeature",void 0),l([d()],D.prototype,"modified",null),D=l([V("esri.widgets.Editor.Edits")],D);var et;let B=et=class extends xe{constructor(e){super(e),this.type="create"}get shouldShowAttachments(){var e;return!(!((e=this.data)!=null&&e.creationInfo)||!this.data.viewModel)&&Nt(this.data)}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get hasPendingEdits(){return!0}get helpMessage(){var s;if(this.stepId!=="editing-new-feature")return;const{creationInfo:e,viewModel:t}=this.data,a=e.layer.geometryType,i=(s=t.sketchViewModel.createGraphic)==null?void 0:s.geometry;return a!=="mesh"?Lt(a,i):void 0}get reliesOnOwnerAdminPrivileges(){var i,s;const{layer:e}=this.data.creationInfo,t=(i=e.capabilities)==null?void 0:i.operations.supportsAdd,a=(s=Le(e))==null?void 0:s.operations.supportsAdd;return rt(e)&&!e.editingEnabled||!!a&&!t}static create(e,t,a){const i=new et({data:new gi({edits:new D,viewModel:e}),onCommit:async s=>{await a(s.creationInfo.layer,{addFeatures:[s.edits.feature]})}});return i._set("steps",this._createWorkflowSteps(i,t)),i}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:a}=e,i=new Map,s=pt(["awaiting-feature-creation-info","awaiting-feature-to-create","editing-new-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){a.creationInfo=null,a.edits.feature=null,a.viewModel.featureTemplatesViewModel.select(null),e.addHandles(a.viewModel.featureTemplatesViewModel.on("select",({item:r})=>{var o;r&&(a.creationInfo=r,(o=a.viewModel.activeWorkflow)==null||o.next())}),this.id)},async tearDown(){e.removeHandles(this.id)}}),"awaiting-feature-to-create":()=>({id:"awaiting-feature-to-create",async setUp(){e.addHandles(await ei(a.viewModel.sketchViewModel,a.creationInfo,r=>{var o;a.edits.feature=r,(o=a.viewModel.activeWorkflow)==null||o.next()},i),this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-new-feature":()=>({id:"editing-new-feature",async setUp(){const r=a.edits.feature,o=r.sourceLayer,n=a.viewModel,c=n.sketchViewModel,u=ct(n.layerInfos,o),p=u==null?void 0:u.formTemplate,{spatialReference:m}=n.view;n.featureFormViewModel.set({arcadeEditType:"INSERT",feature:r,formTemplate:p,spatialReference:m}),c.allowDeleteKey=!1,zt(n.attachmentsViewModel);const f=Ue(r);await we({graphic:r,sketchViewModel:c,sourceLayer:o,visualVariables:f,webStyleCache:i});const w=c.on("update",async y=>{const b=y.graphics[0];if(y.state==="complete")return we({graphic:b,sketchViewModel:c,sourceLayer:o,visualVariables:f,webStyleCache:i});await ut(c.view,b,y,f,i);const v=b.attributes;if(f.rotation!=null){const{field:g}=f.rotation;n.featureFormViewModel.setValue(g,v[g])}if(f.size!=null){const{field:g}=f.size;n.featureFormViewModel.setValue(g,v[g])}});e.addHandles([a.viewModel.featureFormViewModel.on("value-change",async()=>{a.edits.updateAttributes(a.viewModel.featureFormViewModel.getValues()),r.attributes=a.edits.feature.attributes,c.view.type==="3d"&&await H(r,i)}),w,C(()=>a.viewModel.attachmentsViewModel.mode,y=>{y==="add"&&a.viewModel.activeWorkflow.go("adding-attachment"),y==="edit"&&a.viewModel.activeWorkflow.go("editing-attachment")})],this.id)},async tearDown(r){r.canceled&&a.viewModel.sketchViewModel.layer.removeAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-new-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-new-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}})});return Gt(a,s)}};l([d()],B.prototype,"shouldShowAttachments",null),l([d()],B.prototype,"shouldAllowAttachmentEditing",null),l([d()],B.prototype,"hasPendingEdits",null),l([d()],B.prototype,"helpMessage",null),l([d()],B.prototype,"reliesOnOwnerAdminPrivileges",null),B=et=l([V("esri.widgets.Editor.CreateWorkflow")],B);const yi=B;var Ce;let G=Ce=class extends oe{constructor(e){super(e),this.attachmentsCapabilities=null,this.editableItem=null,this.edits=null,this.formTemplate=null,this.parent=null,this.viewModel=null}static async create(e){const t=Ce._makeConstructorProps(e);return new Ce(t)}static _makeConstructorProps(e){const{feature:t,parent:a,viewModel:i}=e,s=i.editableItems.find(u=>u.layer===t.layer);if(!s)throw new $("no-editableItem-found","The EditorViewModel provided did not have an EditableItem associated with the specified Graphic's layer");const r=ct(i.layerInfos,t.sourceLayer),o=s.supports,n=o.includes("create"),c=o.includes("update");return{attachmentsCapabilities:{editing:!0,operations:{add:n||c,update:c,delete:c}},editableItem:s,edits:new D({feature:t}),formTemplate:r==null?void 0:r.formTemplate,parent:a,viewModel:i}}};l([d()],G.prototype,"attachmentsCapabilities",void 0),l([d()],G.prototype,"editableItem",void 0),l([d()],G.prototype,"edits",void 0),l([d()],G.prototype,"formTemplate",void 0),l([d()],G.prototype,"parent",void 0),l([d()],G.prototype,"viewModel",void 0),G=Ce=l([V("esri.widgets.Editor.UpdateRecordWorkflowData")],G);const qt=G;var Ie;let Ee=Ie=class extends qt{constructor(e){super(e)}static async create(e){const{feature:t,viewModel:a}=e,{view:i}=a;if(!i)throw new $("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const s=await ge(i,t.layer);return new Ie({...Ie._makeConstructorProps(e),layerView:s})}};l([d()],Ee.prototype,"layerView",void 0),Ee=Ie=l([V("esri.widgets.Editor.UpdateFeatureWorkflowData")],Ee);const vi=Ee;var tt;const Ae={exit:Symbol()},_i="esri.widgets.Editor.UpdateRecordWorkflow";let L=tt=class extends xe{constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:a}=e.viewModel,i=t.feature,s=new AbortController;this.addHandles(ha(s)),this._updatingHandles.addPromise(si(i,e.viewModel.view.spatialReference,s.signal).then(r=>{ma(s)||this._onFullFeatureLoaded(r)},r=>this.cancel({force:!0,error:new $("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:r}})}))),a&&(this._highlightHelper=new Dt({view:a}),this.addHandles(F(()=>{var r;return(r=this._highlightHelper)==null?void 0:r.removeAll()})))}get editableItem(){return this.data.editableItem}get hasPendingEdits(){return this.data.edits.modified}get parent(){return this.data.parent}get shouldShowAttachments(){return this.editableItem.attachmentsOnUpdateEnabled}get shouldAllowAttachmentEditing(){return this.editableItem.supports.includes("update")}get reliesOnOwnerAdminPrivileges(){var i,s;const{layer:e}=this.editableItem,t=(i=e.capabilities)==null?void 0:i.operations.supportsUpdate,a=(s=Le(e))==null?void 0:s.operations.supportsUpdate;return rt(e)&&!e.editingEnabled||!!a&&!t}async deleteAndCommit(){return this.data.edits.stageDelete(),this.commit()}async enter(){this._configureAttachmentsViewModel(),this._configureFeatureFormViewModel()}exit(e){this.removeHandles(Ae.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:a,viewModel:i}=e,{attachmentsViewModel:s}=i;s.set({capabilities:a,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([F(()=>s.fileInfos.removeAll()),C(()=>s.mode,r=>{switch(r){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],Ae.exit)}_configureFeatureFormViewModel(){const{edits:e,formTemplate:t,viewModel:{featureFormViewModel:a,view:i}}=this.data;a.set({arcadeEditType:"UPDATE",feature:this.fullFeature,formTemplate:t,highlightHelper:this._highlightHelper,map:i==null?void 0:i.map,spatialReference:i.spatialReference});const{initialFeature:s}=e;s&&a.overrideInitialFeature(s),this.addHandles(a.on("value-change",()=>{e.updateAttributes(a.getValues()),this.fullFeature.attributes=e.feature.attributes}),Ae.exit)}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new tt({data:await qt.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}};L._onCommitFactory=e=>async t=>{var n;const{edits:a}=t,{feature:i}=a;if(!i)return;const s=i.sourceLayer,r=i.clone();if(!a.attributesModified||a.stagedForDelete){const c=s.objectIdField;if(r.attributes={[c]:i.getAttribute(c)},Et()&&At()&&s.type==="scene"&&s.infoFor3D!=null){const u=(n=s.associatedLayer)==null?void 0:n.globalIdField;u!=null&&r.setAttribute(u,i.getAttribute(u))}}a.geometryModified&&!a.stagedForDelete||(r.geometry=null);const o=a.stagedForDelete?"deleteFeatures":"updateFeatures";await e(s,{[o]:[r]})},l([d()],L.prototype,"editableItem",null),l([d()],L.prototype,"fullFeature",void 0),l([d()],L.prototype,"hasPendingEdits",null),l([d()],L.prototype,"parent",null),l([d()],L.prototype,"shouldShowAttachments",null),l([d()],L.prototype,"shouldAllowAttachmentEditing",null),l([d()],L.prototype,"reliesOnOwnerAdminPrivileges",null),L=tt=l([V(_i)],L);var at;const ne={...Ae,highlights:Symbol(),sketch:Symbol()};let ue=at=class extends L{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._webStyleCache=new Map}initialize(){const{edits:{feature:e},layerView:t}=this.data;pi(t)&&(this._layerViewEditSession=t.createInteractiveEditSession(e))}destroy(){var e;(e=this._layerViewEditSession)==null||e.rollback()}async commit(){this.removeHandles(ne.sketch);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?t==null||t.rollback():t==null||t.commit()}catch(e){throw await this._configureSketchViewModel(),new $("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:e})}}async start(){return await super.start(),this._initializeSketchViewModel()}_configureFeatureFormViewModel(){super._configureFeatureFormViewModel();const{_layerViewEditSession:e}=this,{viewModel:t}=this.data;this.addHandles(t.featureFormViewModel.on("value-change",a=>{e==null||e.setAttribute(a.fieldName,a.value)}),ne.exit)}_configureHighlight(){const{edits:e,layerView:t}=this.data;Ha(t)&&this.addHandles(t.highlight(e.feature),ne.highlights)}async _configureSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,{edits:a,viewModel:i}=e,s=a.feature,{featureFormViewModel:r,sketchViewModel:o,view:n}=i;o.allowDeleteKey=!1;const c=Ue(s),u=await ni({feature:s,featureClone:t,visualVariableAttributes:c,sketchViewModel:o,view:n,onUpdate:({geometry:p,attributes:m},f)=>{if(a.updateAttributes(m),a.updateGeometry(p),r.feature.geometry=p,c.rotation!=null){const{field:w}=c.rotation;r.setValue(w,m[w])}if(c.size!=null){const{field:w}=c.size;r.setValue(w,m[w])}(f.type==="undo"||f.type==="redo"||f.type==="update"&&f.toolEventInfo!=null&&Bt(f.toolEventInfo.type))&&r.notifyFeatureGeometryChanged()},webStyleCache:this._webStyleCache});this.addHandles(u,ne.sketch)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,a=e.edits.feature,{sketchViewModel:i}=e.viewModel,{geometryUpdatesEnabled:s}=e.editableItem,r=i.updateOnGraphicClick;i.updateOnGraphicClick=!1,this.addHandles([F(()=>{i.updateOnGraphicClick=r})]),s&&this.addHandles([await li(i,a,t)]);const{highlights:o,sketch:n}=ne;return{enter:async()=>{!this.hasHandles(n)&&s?await this._configureSketchViewModel():this.hasHandles(o)||this._configureHighlight()},exit:()=>this.removeHandles([n,o])}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e),this._sketchGraphicClone=Ye(e);const{edits:t}=this.data;t.updateGeometry(e.geometry),t.trackChanges()}static async create(e){const t=new at({data:await vi.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}};l([d()],ue.prototype,"_layerViewEditSession",void 0),l([d()],ue.prototype,"_sketchGraphicClone",void 0),ue=at=l([V("esri.widgets.Editor.UpdateFeatureWorkflow")],ue);let j=class extends oe{constructor(t){super(t),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.candidates=null,this.rootFeature=null,this.viewModel=null}};l([d()],j.prototype,"addAttachmentsCallback",void 0),l([d()],j.prototype,"applyEditsCallback",void 0),l([d()],j.prototype,"candidates",void 0),l([d()],j.prototype,"rootFeature",void 0),l([d()],j.prototype,"viewModel",void 0),j=l([V("esri.widgets.Editor.UpdateWorkflowData")],j);const ki=j;var it;const Kt="esri.widgets.Editor.UpdateWorkflow",bi=ot.getLogger(Kt);let P=it=class extends xe{constructor(e){super(e),this._workflowStack=new wt(gt),this._sketchStack=new wt(gt),this.type="update"}get activeEditableItem(){var e;return((e=this.activeWorkflow)==null?void 0:e.data.editableItem)??void 0}get activeWorkflow(){return this._workflowStack.last()}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){var e;return!!((e=this.activeEditableItem)!=null&&e.attachmentsOnUpdateEnabled)}get shouldAllowAttachmentEditing(){var e;return!!((e=this.activeEditableItem)!=null&&e.supports.includes("update"))}get hasPendingEdits(){return Array.from(this._workflowStack).some(e=>e.hasPendingEdits)}get helpMessage(){var e;return(e=this.activeWorkflow)!=null&&e.helpMessage?this.activeWorkflow.helpMessage:this.stepId==="awaiting-feature-to-update"?"select":void 0}get reliesOnOwnerAdminPrivileges(){var e;return((e=this.activeWorkflow)==null?void 0:e.reliesOnOwnerAdminPrivileges)??!1}get hasInvalidFormTemplate(){var e;return!!((e=this.activeEditableItem)!=null&&e.hasInvalidFormTemplate)}get hasUnsupportedFields(){var e;return!!((e=this.activeEditableItem)!=null&&e.hasUnsupportedFields)}async back(e=()=>Promise.resolve(!0)){const{featureFormViewModel:t}=this.data.viewModel;if(t.relationshipId==null)if(this.activeWorkflow){if(this.activeWorkflow.hasPendingEdits&&!await e())return;this.activeWorkflow.hasPreviousStep?await this.activeWorkflow.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else t.relationshipId=null}async cancelActiveWorkflow(e){var t;await((t=this.activeWorkflow)==null?void 0:t.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(e=>e.commit()),await super.commit()}static create(e){const{viewModel:t,startAt:a,addAttachmentsCallback:i,applyEditsCallback:s}=e,r=new it({data:new ki({addAttachmentsCallback:i,applyEditsCallback:s,viewModel:t}),onCommit:async()=>{}});return r._set("steps",this._createWorkflowSteps(r,a)),r}async save(){var e;this.nestedWorkflowCount>1?(await((e=this.activeWorkflow)==null?void 0:e.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=await this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new $("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:t})}}async startUpdating(e){try{const t=await this._createNestedUpdateWorkflow(e);await this._pushWorkflow(t)}catch(t){throw new $("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:t})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new $("editor:nothing-to-delete","There is no feature to delete");Fi(e)?await e.deleteAndCommit():await e.cancel(),this.nestedWorkflowCount===1?await this.reset():await this._popWorkflow()}async cancelAll(){await this._drainWorkflowStack(e=>e.cancel({force:!0}))}async _createNestedCreateFeaturesWorkflow(e){var c;const{relatedLayer:t}=e,{addAttachmentsCallback:a,applyEditsCallback:i,viewModel:s}=this.data;if(!Ke(t))throw new $("editor:unsupported-layer","Editing is not supported on the provided layer");const r=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),o=r.template||r.initialFeature?"creating-features":"awaiting-feature-creation-info",n=((c=this.activeWorkflow)==null?void 0:c.type)!=="create-features"?this.activeWorkflow:void 0;return jt.create({addAttachmentsCallback:a,applyEditsCallback:i,creationInfo:r,isNested:!0,parent:n,startAt:o,viewModel:s})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!Ke(t)||fa(t))throw new $("editor:unsupported-layer","Editing is not supported on the provided layer");const a={layer:t,maxFeatures:1},i=this._makeRelatedRecordAttributes(e),s=Pt(t);return(s==null?void 0:s.length)>0?(a.attributeOverrides=i,s.length===1&&(a.template=s[0])):a.initialFeature=new st({sourceLayer:t,attributes:i}),a}async _createNestedUpdateWorkflow(e){var o;const t=ie(e.sourceLayer)?L:ue,{applyEditsCallback:a,viewModel:i}=this.data,s=((o=this.activeWorkflow)==null?void 0:o.type)!=="create-features"?this.activeWorkflow:void 0,r=await t.create({feature:e,parent:s,viewModel:i,applyEdits:a});return await S(()=>!r.updating),r}async _drainWorkflowStack(e){const t=this._workflowStack,a=[];for(;t.length>0;){const i=t.pop();this._sketchStack.pop();const s=e(i).then(()=>i.destroy());this._updatingHandles.addPromise(s),a.push(s)}await Promise.all(a)}_makeRelatedRecordAttributes(e){var c,u;const{parentFeature:t,relatedLayer:a,relationshipId:i}=e;if(!Ra(t))return;const s=(c=a.relationships)==null?void 0:c.find(p=>p.id===i);if(!s)return void le("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if(s.role==="origin")return void le("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const r=t.sourceLayer;s.relatedTableId!==r.layerId&&le("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const o=(u=r.relationships)==null?void 0:u.find(p=>p.id===i);if(!o)return void le("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const n=t.getAttribute(o.keyField);return n||le("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field."),{[s.keyField]:n}}async _popWorkflow(){var t;(t=this._workflowStack.pop())==null||t.destroy(),this._sketchStack.pop();const e=await this._reconcileWorkflowStack();if(e.failureCount>0)throw new $("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",e)}async _pushWorkflow(e){var o;const t=this._workflowRequiresSketchViewModel(e);(o=this.activeWorkflow)==null||o.exit({removeSketchHandles:t});const a=this._sketchStack,i=await(e==null?void 0:e.start()),s=a.peek();i?(s==null||s.exit(),a.push(i)):a.push(this._cloneSketchController(s)),this._workflowStack.push(e);const r=await this._reconcileWorkflowStack();if(r.failureCount>0)throw new $("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",r)}async _reconcileWorkflowStack(){var a;const e=this._workflowStack,t=this._sketchStack;try{const i=e.peek();return await(i==null?void 0:i.enter()),await((a=t.peek())==null?void 0:a.enter()),{activeWorkflow:i,failureCount:0}}catch{e.pop().destroy(),t.pop();const{activeWorkflow:s,failureCount:r}=await this._reconcileWorkflowStack();return{activeWorkflow:s,failureCount:r+1}}}_cloneSketchController(e){return{enter:(e==null?void 0:e.enter)??(async()=>{}),exit:(e==null?void 0:e.exit)??(async()=>{})}}_workflowRequiresSketchViewModel(e){var a;const{type:t}=e;return t==="update-feature"||t==="create-features"&&!ie((a=e.data.creationInfo)==null?void 0:a.layer)}static _createWorkflowSteps(e,t="awaiting-feature-to-update"){const{data:a}=e;return pt(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,{"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:i}=a.viewModel,s=a.viewModel.view;let r=null;e.addHandles(F(()=>{r=je(r)}),this.id),a.rootFeature=null,a.candidates=[];const o=s.on("immediate-click",async n=>{n.stopPropagation(),i.location=n.mapPoint,i.visible=!0,r==null||r.abort();const{editableItems:c}=a.viewModel;r=new AbortController;const u=await new Promise((p,m)=>{wa(r==null?void 0:r.signal,()=>m(ga())),p(ti(c,s,n,r==null?void 0:r.signal))});ve(r),a.candidates=u.filter(p=>p.status==="fulfilled").flatMap(p=>p.value),i.visible=a.candidates.length===1,a.candidates.length!==0&&(a.candidates.length===1?(a.rootFeature=a.candidates[0],e.go("editing-existing-feature").catch(()=>{}).then(()=>i.visible=!1)):e.next())});s.focus(),e.addHandles(o,this.id)},async tearDown(){a.candidates.length===0&&(a.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){a.rootFeature=null;const{view:i}=a.viewModel;if(!i)return;const s=new Dt({view:i});e.addHandles([C(()=>a.rootFeature,(r,o)=>{s.remove(o),s.add(r)},yt),F(()=>s.removeAll())],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:i,viewModel:s}=e.data;if(!i)throw new $("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(i),s.spinnerViewModel.visible=!1;const r=Oe(async()=>{await S(()=>!e.updating),e.previous()}),{featureFormViewModel:o}=a.viewModel,n=o.relatedRecordCallbacks;o.relatedRecordCallbacks={addRelatedRecord:async c=>{await e.startCreatingRelatedRecord(c),o.relationshipId=null},editRelatedRecord:async({relatedFeature:c})=>{await e.startUpdating(c),o.relationshipId=null},showAllRelatedRecords:c=>o.relationshipId=c.relationshipId},e.addHandles([F(()=>o.relatedRecordCallbacks=n),C(()=>e.nestedWorkflowCount,(c,u)=>{c===0&&u!==0&&r()},yt)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){a.viewModel.attachmentsViewModel.mode="view"}})})}};l([d()],P.prototype,"activeEditableItem",null),l([d()],P.prototype,"activeWorkflow",null),l([d()],P.prototype,"nestedWorkflowCount",null),l([d()],P.prototype,"shouldShowAttachments",null),l([d()],P.prototype,"shouldAllowAttachmentEditing",null),l([d()],P.prototype,"hasPendingEdits",null),l([d()],P.prototype,"helpMessage",null),l([d()],P.prototype,"reliesOnOwnerAdminPrivileges",null),l([d()],P.prototype,"hasInvalidFormTemplate",null),l([d()],P.prototype,"hasUnsupportedFields",null),P=it=l([V(Kt)],P);const le=(e,t)=>bi.warn(`editor:${e}`,t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature."),Fi=e=>!!e&&/update-/.test(e.type),Mi=P,Qt="esri.widgets.Editor.EditorViewModel",pe=ot.getLogger(Qt),Zt=["create","create-features","update"];function R(e,t,a){pe.error(new $(e,t,a))}function Ci(e,t){return e?e.find(a=>a.layer===t):void 0}let _=class extends Vt.EventedAccessor{constructor(e){super(e),this._editableItems=new Ne,this._sketchGraphicsLayer=new ya({listMode:"hide",internal:!0}),this._updateEditableItemsTask=null,this._updatingHandles=new Ot,this._featureTemplatesViewModelLocked=!1,this.activeWorkflow=null,this._activityQueue=[],this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new Ma({capabilities:{editing:!0}}),this.featureFormViewModel=new Ia,this.featureTemplatesViewModel=new Aa({disabledItemFunction:({layer:t})=>this._itemIsSuspended(t)}),this.sketchViewModel=new za({layer:this._sketchGraphicsLayer}),this.spinnerViewModel=new Va,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.useDeprecatedCreateWorkflow=!1,this.back=async()=>{var t;this.canGoBack&&((t=this.activeWorkflow)!=null&&t.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>{var i;const{featureFormViewModel:t}=this;if(t.submit(),!t.submittable)return;const a=t.getValues();t.validateContingencyConstraints(a,{includeIncompleteViolations:!0}).length>0||await((i=this.activeWorkflow)==null?void 0:i.save())},this.selectFeature=(t,a=!1)=>{const i=this.activeWorkflow;this._candidateCommitted||(i==null?void 0:i.type)!=="update"||(i.data.rootFeature=t,a&&(i.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([C(()=>{var i,s,r;const e=(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.editableLayers.filter(({parent:o,visible:n})=>o&&"visible"in o?n&&o.visible:n),t=(r=this.view)==null?void 0:r.allLayerViews,a=t==null?void 0:t.filter(o=>!!(e!=null&&e.includes(o.layer))&&!o.suspended);return[e,a,this.layerInfos,this.allowedWorkflows,this.hideTemplatesForInactiveLayers]},()=>this._updateEditableItems(),Be),te(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),te(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),te(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),he(()=>{var e;return(e=this.view)==null?void 0:e.map},e=>e.add(this._sketchGraphicsLayer),ce),C(()=>{var e;return(e=this.view)==null?void 0:e.timeZone},e=>this.featureFormViewModel.timeZone=e),C(()=>this._editableItems.toArray(),()=>{const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;e.type!=="create"?e.type==="update"&&(t==="awaiting-feature-to-update"&&!this.canUpdate||t==="awaiting-update-feature-candidate"&&!e.data.candidates.some(a=>{const i=this._editableItems.find(s=>s.layer===a.layer);return i&&i.supports.includes("update")}))&&this._cancelWorkflow():t!=="awaiting-feature-creation-info"||this.canCreate||this._cancelWorkflow()}),C(()=>this.page,(e,t)=>{const a=[...this.pageStack];if(a.indexOf(e)===-1)a.push(e);else for(;a.length&&a.at(-1)!==e;)a.pop();this.pageStack=a},Be),he(()=>this.state==="awaiting-update-feature-candidate",()=>this._candidateCommitted=!1),te(()=>this.featureTemplatesViewModel,"select",async({item:e,oldItem:t})=>{var s;const{activeWorkflow:a}=this;if(a){if(a.type==="update"&&((s=a.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-creation-info")return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(t,{emit:!1})}}if(!e)return;const i={layer:e.layer,template:e.template};if(e.supportsUpload)return this.featureTemplatesViewModel.select(t,{emit:!1}),this.startCreateFeaturesWorkflow(i);this.useDeprecatedCreateWorkflow?this.startCreateWorkflowAtFeatureCreation(i):this.startCreateFeaturesWorkflowAtFeatureCreation(i)}),te(()=>this.view,"key-down",e=>{var t;e.key==="Escape"&&((t=this.activeWorkflow)!=null&&t.keyboardCancellationEnabled)&&(e.stopPropagation(),this.back())})])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{var e,t;(t=(e=this.view)==null?void 0:e.map)==null||t.remove(this._sketchGraphicsLayer),this.view=null}),this._updateEditableItemsTask=je(this._updateEditableItemsTask),this._updatingHandles.destroy()}get allowedWorkflows(){return this._get("allowedWorkflows")}set allowedWorkflows(e){e&&e.length!==0||(e=[...Zt]),this._set("allowedWorkflows",e)}get canCreate(){return this._editableItems.some(e=>e.supports.includes("create")&&!e.suspended)}get canUpdate(){return this._editableItems.some(({attachmentsOnUpdateEnabled:e,layer:t,supports:a,suspended:i})=>{const s=!i&&(a.includes("update")||a.includes("delete")||e),r=t.parent,o=!(r&&"visible"in r)||!!r.visible;return t.visible&&o&&s})}get editableItems(){return this._editableItems}get labelOptions(){return this.sketchViewModel.labelOptions}set labelOptions(e){this.sketchViewModel.labelOptions=e}set layerInfos(e){e==null||e.some(t=>("allowAttachments"in t&&It(pe,"Property: layerInfo.allowAttachments",{replacement:"layerInfo.attachmentsOnCreateEnabled or layerInfo.attachmentsOnUpdateEnabled",version:"4.26"}),!0)),this._set("layerInfos",e)}get snappingOptions(){return this.sketchViewModel.snappingOptions}set snappingOptions(e){this.sketchViewModel.snappingOptions=e}get state(){var a,i;if(!((a=this.view)!=null&&a.ready))return"disabled";const e=this.attachmentsViewModel.mode;if(e==="add")return"adding-attachment";if(e==="edit")return"editing-attachment";const{activeWorkflow:t}=this;return t?t.type==="update"&&((i=t.activeWorkflow)!=null&&i.stepId)?t.activeWorkflow.stepId:t.stepId:"ready"}get syncing(){return this._activityQueue.length>0}get updating(){var e;return this._updatingHandles.updating||((e=this.activeWorkflow)==null?void 0:e.updating)===!0}get tooltipOptions(){return this.sketchViewModel.tooltipOptions}set tooltipOptions(e){this.sketchViewModel.tooltipOptions=e}set view(e){this.sketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get page(){const{activeWorkflow:e,state:t}=this;if((e==null?void 0:e.type)==="update"&&e.stepId==="awaiting-feature-to-update")return"ready";if((e==null?void 0:e.type)==="create-features"&&e.numPendingFeatures===0){const a=e.data.upload;if(a)return a.state==="default"?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){var t;const{activeWorkflow:e}=this;return(e==null?void 0:e.type)==="update"&&((t=e.activeEditableItem)==null?void 0:t.attributeUpdatesEnabled)===!1}get canGoBack(){return this.activeWorkflow!=null&&!this.syncing}get shouldShowDeleteButton(){var t;const{activeWorkflow:e}=this;return!!e&&e.type==="update"&&!!((t=e.activeEditableItem)!=null&&t.supports.includes("delete"))}get hasPendingEdits(){var e;return((e=this.activeWorkflow)==null?void 0:e.hasPendingEdits)??!1}async startCreateWorkflowAtFeatureTypeSelection(){if(se(pe,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),await S(()=>!this.updating),!this.canCreate)return void R("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const e=this._createCreateWorkflow();await e.start(),this._set("activeWorkflow",e)}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateWorkflowAtFeatureCreation(e){if(se(pe,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),await S(()=>!this.updating),!this.canCreate)return void R("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createCreateWorkflow("awaiting-feature-to-create");t.data.creationInfo=e,await t.start(),this._set("activeWorkflow",t)}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e,t="awaiting-feature-creation-info"){if(await S(()=>!this.updating),!this.canCreate)throw new $("editing:unsupported-workflow","Creating features is unsupported or disabled.");await this._cancelWorkflow();const a=this._createCreateFeaturesWorkflow(e,t);await a.start(),this._set("activeWorkflow",a)}async startCreateWorkflowAtFeatureEdit(e){if(se(pe,"startCreateWorkflowAtFeatureEdit"),await S(()=>!this.updating),!this.canCreate)return void R("editing:unsupported-workflow","Create workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createCreateWorkflow("editing-new-feature");t.data.edits.feature=e,await t.start(),this._set("activeWorkflow",t)}async startCreateFeaturesWorkflowAtFeatureEdit(e){await S(()=>!this.updating);const{initialFeature:t}=e,a=t.sourceLayer,i=a?this.findEditableItemForLayer(a):void 0;if(!this.canCreate||!i)throw new $("editing:unsupported-workflow","Creating features is unsupported or disabled.");await this._cancelWorkflow();const s=this._createCreateFeaturesWorkflow({initialFeature:t,layer:i.layer,maxFeatures:1},"creating-features");await s.start(),this._set("activeWorkflow",s)}async startUpdateWorkflowAtFeatureSelection(){if(await S(()=>!this.updating),!this.canUpdate)return void R("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const e=this._createUpdateWorkflow();await e.start(),this._set("activeWorkflow",e)}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await S(()=>!this.updating),!this.canUpdate)return void R("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,await t.start(),this._set("activeWorkflow",t)}async startUpdateWorkflowAtFeatureEdit(e){if(await S(()=>!this.updating),!this.canUpdate)return void R("editing:unsupported-workflow","Update workflow is unsupported or disabled.");await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.rootFeature=e,await t.start(),this._set("activeWorkflow",t)}async deleteFeatureFromWorkflow(){const{activeWorkflow:e}=this;e&&e.type==="update"?await e.deleteActiveFeature():R("editing:unsupported-workflow","Deleting requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditableItemForLayer(e){const t=e.type==="subtype-sublayer"?e.parent:e;return this._editableItems.find(a=>a.layer===t)}itemHasInvalidFormTemplate(e){var t;return!!e&&(((t=this.findEditableItemForLayer(e.layer))==null?void 0:t.hasInvalidFormTemplate)??!1)}itemHasUnsupportedFields(e){var t;return!!e&&(((t=this.findEditableItemForLayer(e.layer))==null?void 0:t.hasUnsupportedFields)??!1)}syncFeatureTemplates(){if(this._featureTemplatesViewModelLocked)return;const e=[];for(const{layer:t,supports:a}of this._editableItems)t.loaded&&a.includes("create")&&!ie(t)&&e.push(t);this.featureTemplatesViewModel.layers=e}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&this.state==="awaiting-feature-to-update"?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}lockFeatureTemplatesViewModel(){return this._featureTemplatesViewModelLocked=!0,F(()=>{this._featureTemplatesViewModelLocked=!1,this.syncFeatureTemplates()})}async _updateEditableItems(){je(this._updateEditableItemsTask);const e=St(async t=>{var m,f;const a=(m=this.view)==null?void 0:m.allLayerViews,i=(f=this.view)==null?void 0:f.map,s=(i==null?void 0:i.editableLayers.toArray())??[],r=(i==null?void 0:i.allTables.toArray().filter(va))??[];await Promise.allSettled(r.map(w=>w.load()));const o=r.filter(w=>Ke(w)),n=[...s.reverse(),...o.reverse()].filter(w=>{var y;return w.geometryType!=="mesh"||((y=this.view)==null?void 0:y.type)==="3d"});if(!a||!s)return;const c=[],u=[];for(const w of n){const y=a.find(g=>g.layer===w),b=y?c:u,v=!!(y!=null&&y.suspended);if(!v||!this.hideTemplatesForInactiveLayers)if(w.type==="subtype-group"){await w.loadAll(),ve(t);for(let g=w.sublayers.length-1;g>=0;--g)b.push(this._makeEditableItemForLayer(w.sublayers.at(g),v))}else b.push(this._makeEditableItemForLayer(w,v))}if(t.aborted)return;const p=this._editableItems;this._editableItems=new Ne(c.concat(u)),p.destroy()});this._updatingHandles.addPromise(e.promise),this._updateEditableItemsTask=e}async _cancelWorkflow(e){const t=this.activeWorkflow;if(!t)return void((e==null?void 0:e.warnIfNoWorkflow)&&R("editing:no-active-workflow","There is no active workflow to cancel."));if(!e||e.force!==!1)return this.emit("workflow-cancel"),this._set("activeWorkflow",null),void await t.cancel(e);await t.cancel(e),this._set("activeWorkflow",null)}_createCreateFeaturesWorkflow(e,t){return jt.create({viewModel:this,creationInfo:e,startAt:t,applyEditsCallback:(a,i,s)=>this._applyEdits(a,i,s),addAttachmentsCallback:(a,i)=>this._addAttachments(a,i)})}_createCreateWorkflow(e){return yi.create(this,e,(t,a,i)=>this._applyEdits(t,a,i))}_createUpdateWorkflow(e){return Mi.create({viewModel:this,startAt:e,applyEditsCallback:(t,a,i)=>this._applyEdits(t,a,i),addAttachmentsCallback:(t,a)=>this._addAttachments(t,a)})}_addAttachments(e,t){const a=t.map(i=>this._addAttachment(e,i.feature,i.attachment))??[];return Promise.all(a)}async _addAttachment(e,t,a){let i=null;if(e.type==="geojson"||e.type==="scene"||e.type==="oriented-imagery")throw new $("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>{var s;return i=await((s=e.addAttachment)==null?void 0:s.call(e,t,a).catch(r=>{throw(r==null?void 0:r.error)||r}))??null,i}),i}async _applyEdits(e,t,a){let i=null;const s=e.url?await _a(e.url):null,r={returnServiceEditsOption:(!s||!ka(s))&&!RegExp("/hosted/","i").test(e.url)?"original-and-current-features":void 0,...a};return await this._queueOperation(async()=>{const{view:o}=this;if(!o)return null;const n=await ge(o,e).catch(()=>null);return i=await e.applyEdits(t,r),n&&await S(()=>!n.updating),i}),i}_queueOperation(e){this._activityQueue.push(e),this.notifyChange("syncing");const t=(a,i)=>{const s=i.indexOf(a);s>-1&&i.splice(s,1)};return e().then(a=>{if(a!=null&&"error"in a&&a.error!=null)throw a.error;if(a!=null&&"addFeatureResults"in a){const{addFeatureResults:i,deleteFeatureResults:s,updateFeatureResults:r}=a,o=i.find(n=>!!n.error)||r.find(n=>!!n.error)||s.find(n=>!!n.error);if(o)throw o.error}return a}).catch(a=>{R("editing:operation-error","An error occurred.",{error:a});const i={error:a,retry:()=>(t(i,this.failures),this._queueOperation(e)),cancel:()=>{t(i,this.failures)}};this._set("failures",[...this.failures,i])}).then(()=>{t(e,this._activityQueue),this.notifyChange("syncing")})}_makeEditableItemForLayer(e,t=!0){var M,W;const a=Le(e),i=a==null?void 0:a.operations,s=Ci(this.layerInfos,e),r=Ga(e),o=r||t,{allowedWorkflows:n}=this,c=n.includes("create")||n.includes("create-features"),u=n.includes("update"),p=I=>!s||s.enabled!==!1&&s[I]!==!1,m=c&&!!(i!=null&&i.supportsAdd)&&p("addEnabled"),f=u&&!!(i!=null&&i.supportsUpdate)&&p("updateEnabled"),w=!o&&u&&!!(i!=null&&i.supportsDelete)&&p("deleteEnabled"),y=[];m&&y.push("create"),f&&y.push("update"),w&&y.push("delete");const b=f&&!o&&(!s||s.attributeUpdatesEnabled!==!1),v=f&&!o&&!!((M=a==null?void 0:a.editing)!=null&&M.supportsGeometryUpdate)&&(!s||s.geometryUpdatesEnabled!==!1),g=!(!((W=a==null?void 0:a.data)!=null&&W.supportsAttachment)||s&&s.allowAttachments===!1);return{layer:e,supports:y,suspended:t,attributeUpdatesEnabled:b,geometryUpdatesEnabled:v,hasAttachments:g,attachmentsOnCreateEnabled:g&&c&&(!s||s.attachmentsOnCreateEnabled!==!1),attachmentsOnUpdateEnabled:!o&&g&&(!s||s.attachmentsOnUpdateEnabled!==!1),hasInvalidFormTemplate:r,hasUnsupportedFields:!1}}_itemIsSuspended(e){var t;return((t=this.findEditableItemForLayer(e))==null?void 0:t.suspended)??!1}};l([d()],_.prototype,"_editableItems",void 0),l([d({readOnly:!0})],_.prototype,"activeWorkflow",void 0),l([d({readOnly:!0})],_.prototype,"_activityQueue",void 0),l([d({value:[...Zt]})],_.prototype,"allowedWorkflows",null),l([d({readOnly:!0})],_.prototype,"canCreate",null),l([d({readOnly:!0})],_.prototype,"canUpdate",null),l([d()],_.prototype,"editableItems",null),l([d({readOnly:!0})],_.prototype,"failures",void 0),l([d()],_.prototype,"hideTemplatesForInactiveLayers",void 0),l([d()],_.prototype,"attachmentsViewModel",void 0),l([d()],_.prototype,"featureFormViewModel",void 0),l([d()],_.prototype,"featureTemplatesViewModel",void 0),l([d()],_.prototype,"labelOptions",null),l([d()],_.prototype,"layerInfos",null),l([d()],_.prototype,"sketchViewModel",void 0),l([d()],_.prototype,"snappingOptions",null),l([d()],_.prototype,"spinnerViewModel",void 0),l([d()],_.prototype,"state",null),l([d({readOnly:!0})],_.prototype,"syncing",null),l([d()],_.prototype,"updating",null),l([d()],_.prototype,"tooltipOptions",null),l([d()],_.prototype,"view",null),l([d()],_.prototype,"pageStack",void 0),l([d()],_.prototype,"showDiscardEditsPrompt",void 0),l([d()],_.prototype,"_candidateCommitted",void 0),l([d()],_.prototype,"page",null),l([d()],_.prototype,"featureFormDisabled",null),l([d()],_.prototype,"canGoBack",null),l([d()],_.prototype,"shouldShowDeleteButton",null),l([d()],_.prototype,"hasPendingEdits",null),l([d()],_.prototype,"useDeprecatedCreateWorkflow",void 0),_=l([V(Qt)],_);const Ii=_,Te="exclamation-mark-triangle";let x=class extends oe{constructor(t){super(t),this.createFeaturesSection=!0,this.editFeaturesSection=!0,this.sketchTooltipControls=!0,this.sketchTooltipControlsElements=new lt,this.snappingControls=!0,this.snappingControlsElements=new dt,this.undoRedoButtons=!1}};l([d({type:Boolean,nonNullable:!0})],x.prototype,"createFeaturesSection",void 0),l([d({type:Boolean,nonNullable:!0})],x.prototype,"editFeaturesSection",void 0),l([d({type:Boolean,nonNullable:!0})],x.prototype,"sketchTooltipControls",void 0),l([d({type:lt,nonNullable:!0})],x.prototype,"sketchTooltipControlsElements",void 0),l([d({type:Boolean,nonNullable:!0})],x.prototype,"snappingControls",void 0),l([d({type:dt,nonNullable:!0})],x.prototype,"snappingControlsElements",void 0),l([d({type:Boolean,nonNullable:!0})],x.prototype,"undoRedoButtons",void 0),x=l([V("esri.widgets.Editor.VisibleElements")],x);const Xt=x,de="esri-editor__panel-content",ye={base:de,message:`${de}__message`,section:`${de}__section`,sectionGroup:`${de}__section__group`,scrimContainer:`${de}__scrim-container`},_e=()=>Q({scrim:()=>A(()=>import("./calcite-scrim-5ea722f7.js"),["assets/calcite-scrim-5ea722f7.js","assets/scrim-41a5f26e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"])});function q(e,...t){return h("div",{class:qe(ye.base,e!=null&&e.showScrimOverlay?ye.scrimContainer:void 0),key:(e==null?void 0:e.key)??"panel-content"},...t,e!=null&&e.showScrimOverlay?h("calcite-scrim",null):void 0)}function ht(e,...t){return h("div",{class:ye.message,"data-testid":"panel-content-message",key:(e==null?void 0:e.key)??"panel-content-message"},...t)}function re(e,...t){return h("div",{class:ye.section,key:(e==null?void 0:e.key)??"panel-content-section"},...t)}function Ei(e,...t){return h("div",{class:ye.sectionGroup,key:(e==null?void 0:e.key)??"panel-content-section-group"},...t)}const Ai=()=>_e();function Wi({helpMessage:e}){return h(q,{key:"creating-features-panel-content"},h(ht,{key:"content-message"},e))}const $i=()=>_e();function Si({editableItems:e,filterText:t,id:a,messagesTemplates:i,onFilterTextChange:s,onSelectFeature:r,workflow:o}){const n=new Map,c=o.data.candidates;let u=0;c.map(f=>({label:Vi(f),id:f.attributes[f.layer.objectIdField],data:f})).filter(f=>{const{label:w,data:y}=f,b=t.toLowerCase(),{title:v}=y.layer,g=e.find(I=>I.layer===y.layer);if(!g)return null;const{attachmentsOnUpdateEnabled:M,supports:W}=g;return(W.includes("update")||W.includes("delete")||M)&&(!b||(w==null?void 0:w.toLowerCase().includes(b))||(v==null?void 0:v.toLowerCase().includes(b)))}).filter(fe).forEach(f=>{var y;u++;const w=f.data.layer;n.has(w)?(y=n.get(w))==null||y.items.push(f):n.set(w,{id:`${w.id}`,label:w.title??"",items:[f]})});const p=e.toArray().map(({layer:f})=>n.get(f)).filter(fe),m=u>10||t.length>0;return h(q,{key:"feature-list"},h(re,null,Wa({enableListScroll:!1,filterEnabled:m,filterText:t,id:a,items:p,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},onFilterChange:f=>s(f),onItemMouseEnter:f=>r(f.data),onItemMouseLeave:()=>r(null),onItemSelect:f=>r(f.data,!0)})))}function Vi(e){const t=e.layer;if(!t)return null;const a=t.fieldsIndex.get(t.objectIdField),i=a.alias||a.name,{attributes:s}=e,r=$t(t);return r&&s[r]&&`${s[r]}`||`${i}: ${s[a.name]}`}const Ti={base:"esri-editor__actions"},mt=()=>Q({button:()=>A(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"])});function Pe({buttons:e,key:t}){return h("div",{class:Ti.base,key:t??"footer-actions",slot:"footer"},e.filter(fe).map(({disabled:a,onClick:i,label:s,...r},o)=>h("calcite-button",{disabled:a??!1,key:`action-${o}`,onclick:i,slot:"footer-actions",width:"full",...r},s)))}const Pi={notice:"esri-editor__notice"},Yt=()=>Q({notice:()=>A(()=>import("./calcite-notice-ae448cb5.js"),["assets/calcite-notice-ae448cb5.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/openCloseComponent-3fbda1cf.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"])});function Oi({workflow:e,messages:t}){return h(nt,null,e!=null&&e.reliesOnOwnerAdminPrivileges?h(We,{message:t.ownerAdminNotice}):void 0,e!=null&&e.hasInvalidFormTemplate?h(We,{icon:Te,message:t.formFieldUpdateError}):void 0,e!=null&&e.hasUnsupportedFields?h(We,{icon:Te,message:t.formFieldUnsupportedUpdateError}):void 0)}function We({message:e,...t}){return h("calcite-notice",{class:Pi.notice,open:!0,scale:"s",...t},h("div",{slot:"message"},e))}const Li={settingsContainer:"esri-editor__settings"},Ui=()=>Q({accordion:()=>A(()=>import("./calcite-accordion-c92b8d10.js"),["assets/calcite-accordion-c92b8d10.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),"accordion-item":()=>A(()=>import("./calcite-accordion-item-4338c263.js"),["assets/calcite-accordion-item-4338c263.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"])});function xi({editorViewModel:e,messagesCommon:t,visibleElements:a}){const{labelOptions:i,snappingOptions:s,tooltipOptions:r,view:o}=e,n=[];return a.sketchTooltipControls&&n.push(h(Na,{labelOptions:i,tooltipOptions:r,viewType:o==null?void 0:o.type,visibleElements:a.sketchTooltipControlsElements??new lt})),a.snappingControls&&n.push(h(Ba,{afterCreate:c=>c.layerListOpen=!1,snappingOptions:s,view:o,visibleElements:a.snappingControlsElements??new dt})),n.length===0?null:h("calcite-accordion",{appearance:"transparent",class:Li.settingsContainer,key:"settings"},h("calcite-accordion-item",{"data-testid":"settings",heading:t.settings,iconStart:"gear"},n))}const Di={base:"esri-editor__panel-toolbar"},Hi=()=>Promise.all([Q({button:()=>A(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"])}),Ui()]);function Ri({editorViewModel:e,messagesCommon:t,visibleElements:a}){const{sketchViewModel:i}=e;return h("div",{class:Di.base,key:"panel-toolbar"},h(xi,{editorViewModel:e,messagesCommon:t,visibleElements:a}),a.undoRedoButtons?[h("calcite-button",{alignment:"center",appearance:"transparent",disabled:!i.canUndo(),iconStart:"undo",key:"undo-button",kind:"neutral",label:t.undo,onclick:()=>i.undo(),scale:"l"},t.undo),h("calcite-button",{alignment:"center",appearance:"transparent",disabled:!i.canRedo(),iconStart:"redo",key:"redo-button",kind:"neutral",label:t.redo,onclick:()=>i.redo(),scale:"l"},t.redo)]:null)}const J="esri-editor__prompt",ee={base:J,header:`${J}__header`,heading:`${J}__header__heading`,message:`${J}__message`,divider:`${J}__divider`,actions:`${J}__actions`},Gi=()=>Q({button:()=>A(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),icon:()=>A(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),scrim:()=>A(()=>import("./calcite-scrim-5ea722f7.js"),["assets/calcite-scrim-5ea722f7.js","assets/scrim-41a5f26e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"])});function zi({actions:e,context:t,headingLevel:a,message:i,title:s}){const r=e.secondary;let o;switch(t){case"danger":o="danger";break;case"info":o="brand";break;default:o="neutral"}const n=h("calcite-button",{afterCreate:Ni,appearance:"solid","data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:o,onclick:e.primary.action,scale:"m",width:r?"half":"full"},e.primary.label),c=r&&h("calcite-button",{appearance:"outline","data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:o,onclick:r.action,scale:"m",width:"half"},r.label);return h("calcite-scrim",{"data-testid":"prompt",key:"prompt"},h("div",{class:`${ee.base}--${t}`},h("div",{class:ee.header},h("calcite-icon",{icon:Te}),h(Ve,{class:ee.heading,level:a},s)),h("div",{class:ee.message},i),h("div",{class:ee.divider}),h("div",{class:ee.actions},c,n)))}function Ni(e){requestAnimationFrame(()=>e.setFocus())}const Bi=()=>Promise.all([mt(),Yt(),_e()]);function Mt({editorViewModel:e,headingLevel:t,messages:a,messagesCommon:i,onDelete:s,onSave:r,renderAttachments:o,renderFeatureForm:n}){const{activeWorkflow:c,syncing:u}=e;if(!c)return null;const p=c.type,m="activeWorkflow"in c?c.activeWorkflow:void 0,f=m==null?void 0:m.type,w=e.featureFormViewModel,y=m&&!m.hasPendingEdits||p==="update"&&!c.hasPendingEdits||u||w.updating,b=p==="update"&&f!=="create-features"?i.update:i.create,v=p==="create-features"&&c.createFeatureState==="create-new",g=p==="create-features"?c.numPendingFeatures:0,M=g>1?Se(a.createFeaturesTemplate,{numFeatures:g}):b,W=c.shouldShowAttachments&&!e.featureFormViewModel.activeRelationshipInput,I=w.inputs.every(ea=>!ea.visible)&&!W?h(ht,{key:"panel-content-message"},Se(a.clickToFinishTemplate,{button:b})):h(re,{key:"panel-content-section"},h(Oi,{messages:a,workflow:c}),h(Ei,null,n(),W?h("div",{key:"attachments"},h(Ve,{level:Fe(t)},a.attachments),o()):null));return h(nt,null,h(q,{key:"attribute-panel-content",showScrimOverlay:v},I),h(Pe,{buttons:[{onClick:r,disabled:y,label:M},e.shouldShowDeleteButton?{appearance:"outline",onClick:s,disabled:u,kind:"danger",label:i.delete}:void 0]}))}const T="esri-editor__upload-details",U={base:T,status:`${T}__status`,titleWrapper:`${T}__title-wrapper`,title:`${T}__title`,description:`${T}__description`,loader:`${T}__loader`,iconSuccess:`${T}__icon ${T}__icon--success`,iconError:`${T}__icon ${T}__icon--error`,fileList:`${T}__file-list`,file:`${T}__file`,fileIcon:`${T}__file-icon`,fileName:`${T}__file-name`},ji=()=>Promise.all([Q({icon:()=>A(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),loader:()=>A(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"])}),mt(),_e()]);function qi(e){const{messages:t,key:a,upload:i}=e;return h(nt,null,h(q,{key:a??"upload-details"},h(re,null,Ki(e))),i.state==="error"?h(Pe,{buttons:[{onClick:()=>i.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to"}],key:"upload-details-footer-actions"}):null)}function Ki(e){const t=Qi(e);return t?h("div",{class:U.base,"data-testid":"upload-details",key:"upload-details-content"},h("div",{class:U.status,key:"status"},t.iconContent,h("div",{class:U.titleWrapper,key:"text"},h("div",{class:U.title,key:"title"},t.title),h("div",{class:U.description,key:"description"},t.description))),Xi(e.upload)):null}function Qi({helpMessage:e,messages:t,upload:a}){switch(a.state){case"pending":{const{title:i,description:s}=t.modelUploads.pending;return{title:i,description:s,iconContent:h("calcite-loader",{"aria-hidden":"true",class:U.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*a.progress),a.progress===1?100:99)})}}case"success":{const{title:i}=t.modelUploads.success;return{title:i,description:e||t.helpMessages3d.mesh,iconContent:h("calcite-icon",{class:qe(U.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:i}=t.modelUploads.error;return{title:i,description:Zi(a.error,t),iconContent:h("calcite-icon",{class:qe(U.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}function Zi(e,t){if(!e)return null;const a=t.modelUploads.error.messages;switch(e.constructor){case Fa:return a.noModel;case ba:return a.multipleModels;case ja:return a.conversionFailed;default:return a.default}}function Xi(e){return h("div",{class:U.fileList,key:"file-list"},e.files.map(t=>h("div",{class:U.file,key:`file-${t.name}`},h("calcite-icon",{class:U.fileIcon,icon:Ji(t),scale:"s"}),h("span",{class:U.fileName},Yi(t.name)))))}function Yi(e){var t;return((t=e.split("/").pop())==null?void 0:t.split("\\").pop())??""}function Ji(e){var a;const t=(a=e.name.split(".").pop())==null?void 0:a.toLowerCase();return(t?ts[t]:null)??es}const es="file",Ct="file-shape",be="file-image",ts={glb:Ct,gltf:Ct,jpeg:be,jpg:be,png:be,svg:be,zip:"file-zip"},Jt="esri.widgets.Editor",ze=ot.getLogger(Jt);let k=class extends Oa{constructor(e,t){super(e,t),this._featureForm=new Ea,this._attachments=new Ca({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new $a({enableListScroll:!1,renderItemContentEnd:a=>a.supportsUpload?h("calcite-icon",{class:Z.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:a=>a.label,renderCustomGroupContent:a=>this._renderCustomTemplateGroupContent(a)}),this._filterText="",this._prompt=null,this._spinner=new Ta,this.headingLevel=4,this.iconClass=Z.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.supportingWidgetDefaults=null,this.viewModel=new Ii,this.visibleElements=new Xt,this._renderSelectIcon=()=>h("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:a,key:i},...s)=>h("calcite-flow-item",{closable:!1,heading:a,headingLevel:this.headingLevel,key:i,loading:this._loading,onCalciteFlowItemBack:this._onBack},h(Ri,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:this.visibleElements}),...s),this._showDiscardEditsPrompt=()=>{var r;const{messages:a,activeWorkflow:i}=this;if((i==null?void 0:i.type)==="create-features"&&me(i.data.creationInfo))return this._showPrompt(((r=i.data.upload)==null?void 0:r.state)==="success"?a.modelUploads.cancelPlacementPrompt:a.modelUploads.cancelUploadPrompt);const s=(i==null?void 0:i.type)==="create";return this._showPrompt({title:a[s?"cancelAddTitle":"cancelEditTitle"],message:a[s?"cancelAddWarningMessage":"cancelEditWarningMessage"],yesLabel:a[s?"discardFeature":"discardEdits"],noLabel:a[s?"continueAdding":"continueEditing"]})},this._showGenericCancelPrompt=()=>{const{messages:a,messagesCommon:i}=this;return this._showPrompt({title:a.cancelRequestTitle,message:a.cancelRequestWarningMessage,yesLabel:i.form.yes,noLabel:i.form.no})},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const{messages:a,messagesCommon:i}=this;this._prompt={title:a.deleteWarningTitle,message:a.deleteWarningMessage,context:"danger",actions:{primary:{label:i.delete,action:()=>{this.deleteFeatureFromWorkflow(),this._clearPrompt()}},secondary:{label:a.keepFeature,action:this._clearPrompt}}}},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=a=>(a==null||a.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{var i;const{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"||a.type==="update"&&((i=a.activeWorkflow)==null?void 0:i.type)==="create-features"?(this._attachments.addFile(),a.back()):this._attachments.addAttachment().then(()=>a.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:a}=this.viewModel;a&&(a.type==="create-features"?(this._attachments.updateFile(),a.back()):this._attachments.updateAttachment().then(()=>a.back()))},this._onAttachmentDelete=()=>{const{messages:a,messagesCommon:i}=this;this._prompt={title:a.deleteAttachmentWarningTitle,message:a.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:i.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:a.keepAttachment,action:this._clearPrompt}}}},this._onAttachmentDeleteConfirm=async()=>{const a=this._attachments,{activeWorkflow:i}=this.viewModel;i&&(i.type==="create-features"?a.deleteFile():(await a.deleteAttachment(a.viewModel.activeAttachmentInfo),this._clearPrompt()),await i.back(),this._clearPrompt())},this._onAttachmentsError=a=>{this._prompt={title:this.messages.errorWarningTitle,message:a.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}}},this._clearPrompt=()=>{this._prompt=null}}initialize(){this.addHandles([C(()=>Fe(this.headingLevel),e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e},ce),te(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(t=>t?e.allow():e.deny())}),C(()=>this.viewModel,e=>{this._featureForm.viewModel=(e==null?void 0:e.featureFormViewModel)??null,this._attachments.viewModel=(e==null?void 0:e.attachmentsViewModel)??null,this._featureTemplates.viewModel=(e==null?void 0:e.featureTemplatesViewModel)??null,this._spinner.viewModel=(e==null?void 0:e.spinnerViewModel)??null,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt},ce),C(()=>this.view,(e,t)=>{const a=`editor-${this.id}-spinner`;t==null||t.ui.remove(this._spinner,a),e==null||e.ui.add(this._spinner,{key:a,position:"manual"})},ce),he(()=>this.supportingWidgetDefaults,e=>{this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch)},ce),he(()=>{var e;return(e=this._attachments)==null?void 0:e.error},e=>this._onAttachmentsError(e)),he(()=>{var e;return(e=this.viewModel)==null?void 0:e.failures},e=>{const{messages:t}=this,[{error:a,retry:i,cancel:s}]=e;this._prompt={title:t.errorWarningTitle,message:Se(t.errorWarningMessageTemplate,{errorMessage:a.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{i(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{s(),this._clearPrompt()}}}}}),C(()=>{var e;return(e=this.viewModel)==null?void 0:e.state},e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),C(()=>this.viewModel.featureFormDisabled,e=>this._featureForm.disabled=e)])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy()}loadDependencies(){return Promise.all([Q({"flow-item":()=>A(()=>import("./calcite-flow-item-6dd63b22.js"),["assets/calcite-flow-item-6dd63b22.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/panel-4decad7b.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/action-79a6733c.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js","assets/scrim-41a5f26e.js"]),flow:()=>A(()=>import("./calcite-flow-e546f579.js"),["assets/calcite-flow-e546f579.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js"]),icon:()=>A(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),list:()=>A(()=>import("./calcite-list-2b87684c.js"),["assets/calcite-list-2b87684c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/observers-9c654f26.js","assets/utils3-c1eb0197.js","assets/loadable-7d42c3de.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/input-9795a695.js","assets/form-60623048.js","assets/label2-0071fcd4.js","assets/component-7281ffa6.js","assets/progress-2100df13.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js","assets/scrim-41a5f26e.js"])}),Ai(),$i(),mt(),Yt(),_e(),Hi(),Gi(),Bi(),ji()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _loading(){const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting}get activeWorkflow(){return this.viewModel.activeWorkflow}get allowedWorkflows(){return this.viewModel.allowedWorkflows}set allowedWorkflows(e){this.viewModel.allowedWorkflows=e}get useDeprecatedCreateWorkflow(){return this.viewModel.useDeprecatedCreateWorkflow}set useDeprecatedCreateWorkflow(e){this.viewModel.useDeprecatedCreateWorkflow=e}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateWorkflowAtFeatureTypeSelection(){return se(ze,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),this.viewModel.startCreateWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateWorkflowAtFeatureCreation(e){return se(ze,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),this.viewModel.startCreateWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateWorkflowAtFeatureEdit(e){return se(ze,"startCreateWorkflowAtFeatureEdit"),this.viewModel.startCreateWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{viewModel:e}=this,t=this.classes(Z.base,_t.widget,_t.panel);return e?h("div",{class:t,key:"base"},h("calcite-flow",{key:"flow"},e.pageStack.map(a=>this._renderPage(a))),this._prompt?h(zi,{...this._prompt,headingLevel:this.headingLevel}):void 0):h("div",{class:t,key:"empty"})}_renderPage(e){switch(e){case"disabled":break;case"ready":return this._renderReady();case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo();case"creating-features-upload-details":return this._renderUploadDetails();case"creating-features":return this._renderCreatingFeatures();case"editing-new-feature":case"editing-existing-feature":case"editing-attributes":return this._renderUpdateFeature();case"awaiting-update-feature-candidate":return this._renderFeatureList();case"adding-attachment":return this._renderAttachmentAdding();case"editing-attachment":return this._renderAttachmentEditing()}return h("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(){const{EditorPanel:e,messages:t}=this;return h(e,{heading:t.selectTemplate,key:"templates-panel"},h(q,{key:"feature-templates"},h(re,null,this._featureTemplates.render())))}_renderUploadDetails(){const{EditorPanel:e,activeWorkflow:t,messages:a}=this;if((t==null?void 0:t.type)!=="create-features")return null;const i=t.data.upload;return i?h(e,{heading:a.createFeatures,key:"upload-details-panel"},h(qi,{helpMessage:this._helpMessage,messages:a,upload:i})):null}_renderCreatingFeatures(){var n,c;const{EditorPanel:e,activeWorkflow:t,messages:a,messagesCommon:i,headingLevel:s,viewModel:r}=this;if(!t)return null;const o=t.type==="create-features"&&t.numPendingFeatures>0||t.type==="update"&&((n=t==null?void 0:t.activeWorkflow)==null?void 0:n.type)==="create-features"&&((c=t.activeWorkflow)==null?void 0:c.numPendingFeatures)>0;return h(e,{heading:a.createFeatures,key:"create-features-panel"},o?h(Mt,{editorViewModel:r,headingLevel:s,messages:a,messagesCommon:i,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}):h(Wi,{helpMessage:this._helpMessage}))}_renderUpdateFeature(){const{EditorPanel:e,messages:t,messagesCommon:a,headingLevel:i,viewModel:s}=this;return h(e,{heading:t.editFeature,key:"update-feature-panel"},h(Mt,{editorViewModel:s,headingLevel:i,messages:t,messagesCommon:a,renderAttachments:()=>this._attachments.render(),renderFeatureForm:()=>this._featureForm.render(),onDelete:this._onDelete,onSave:this._onSave}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:a}=this;let i=null;return e.group.items.some(s=>(a.itemHasUnsupportedFields(s)?i=t.formFieldUnsupportedCreateError:a.itemHasInvalidFormTemplate(s)&&(i=t.formFieldCreateError),i)),i?h(We,{icon:Te,message:i}):null}_renderAttachmentAdding(){const{EditorPanel:e,_attachments:t,messages:a,messagesCommon:i}=this;return h(e,{heading:a.addAttachment,key:"attachment-adding-panel"},h(q,{key:"attachments"},t.render()),h(Pe,{buttons:[{label:t.submitting?i.cancel:i.add,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentAdd}]}))}_renderAttachmentEditing(){const{EditorPanel:e,_attachments:t,activeWorkflow:a,messages:i,messagesCommon:s}=this;return a?h(e,{heading:i.editAttachment,key:"attachment-editing-panel"},h(q,{key:"attachments"},t.render()),a.shouldAllowAttachmentEditing?h(Pe,{buttons:[{label:s.update,disabled:t.submitting||!t.selectedFile,onClick:this._onAttachmentUpdate},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:t.submitting,label:s.delete}]}):void 0):null}_renderReady(){const{EditorPanel:e,messages:t,viewModel:a,visibleElements:i}=this,s=this._helpMessage;return h(e,{heading:t.widgetLabel,key:"landing-panel"},h(q,{key:"landing-content"},a.editableItems.length?[i.editFeaturesSection?h(re,{key:"edit-actions"},this._renderUpdateActions()):null,i.createFeaturesSection?h(re,{key:"create-actions"},this._renderCreateActions()):null]:h(ht,{key:"no-content"},t.noEditableLayers)),s?h("div",{class:Z.helpMessage,key:"footer-actions",slot:"footer"},s):void 0)}get _helpMessage(){var s;const{activeWorkflow:e,messages:t,view:a}=this,i=e==null?void 0:e.helpMessage;return i?(s=t[(a==null?void 0:a.type)==="3d"?"helpMessages3d":"helpMessages2d"])==null?void 0:s[i]:void 0}_renderUpdateActions(){var s;const{messages:e,messagesCommon:t,viewModel:a}=this,i={id:"select",label:t.select};return h("div",{class:Z.updateActions,key:"update-actions"},h(Ve,{level:Fe(this.headingLevel)},e.editFeatures),h("calcite-list",{class:Z.updateActionsList,selectionAppearance:"border",selectionMode:"single"},Sa({disabled:!a.canUpdate,grouped:!1,item:i,selectedItem:((s=a.activeWorkflow)==null?void 0:s.stepId)==="awaiting-feature-to-update"?i:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return h("div",{key:"create-actions"},h(Ve,{level:Fe(this.headingLevel)},this.messages.createFeatures),h("div",{class:Z.featureTemplatesContainer,key:"templates"},this._featureTemplates.render()))}_renderFeatureList(){const{EditorPanel:e,viewModel:t}=this,{activeWorkflow:a}=t;if((a==null?void 0:a.type)!=="update")return null;const i=a.data.candidates,s=Se(this.messages.multipleFeaturesTemplate,{total:i.length});return h(e,{heading:s,key:"feature-list"},h(Si,{editableItems:t.editableItems,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:a,onFilterTextChange:r=>this._filterText=r,onSelectFeature:(r,o)=>t.selectFeature(r,o)}))}_showPrompt({title:e,message:t,yesLabel:a,noLabel:i}){const s=Tt(),{view:r}=this,o=r==null?void 0:r.focused;return this._prompt={title:e,message:t,context:"danger",actions:{primary:{label:a,action:()=>s.resolve(!0)},secondary:{label:i,action:()=>s.resolve(!1)}}},s.promise.finally(()=>{this._clearPrompt(),o&&(r==null||r.focus())})}};l([d()],k.prototype,"_featureForm",void 0),l([d()],k.prototype,"_attachments",void 0),l([d()],k.prototype,"_featureTemplates",void 0),l([d()],k.prototype,"_filterText",void 0),l([d()],k.prototype,"_prompt",void 0),l([d()],k.prototype,"_spinner",void 0),l([d()],k.prototype,"_deleteButtonCommonInfo",null),l([d()],k.prototype,"_loading",null),l([d({readOnly:!0})],k.prototype,"activeWorkflow",null),l([d()],k.prototype,"allowedWorkflows",null),l([d()],k.prototype,"useDeprecatedCreateWorkflow",null),l([d()],k.prototype,"headingLevel",void 0),l([d()],k.prototype,"hideTemplatesForInactiveLayers",null),l([d()],k.prototype,"iconClass",void 0),l([d()],k.prototype,"label",null),l([d()],k.prototype,"labelOptions",null),l([d()],k.prototype,"layerInfos",null),l([d(),Re("esri/widgets/Editor/t9n/Editor")],k.prototype,"messages",void 0),l([d(),Re("esri/t9n/common")],k.prototype,"messagesCommon",void 0),l([d(),Re("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],k.prototype,"messagesTemplates",void 0),l([d()],k.prototype,"snappingOptions",null),l([d()],k.prototype,"tooltipOptions",null),l([d()],k.prototype,"supportingWidgetDefaults",void 0),l([d()],k.prototype,"view",null),l([d(),qa(["workflow-cancel","workflow-commit"])],k.prototype,"viewModel",void 0),l([d({type:Xt,nonNullable:!0})],k.prototype,"visibleElements",void 0),l([d()],k.prototype,"_helpMessage",null),k=l([V(Jt)],k);const Jr=k;export{Jr as default};

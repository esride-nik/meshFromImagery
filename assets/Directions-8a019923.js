import{bg as fe,cd as le,cb as B,dr as we,cc as j,aP as Se,s as P,al as G,V as be,a5 as c,a6 as d,a9 as J,_ as T,j as Te,fU as V,eU as Me,h3 as x,iu as Z,ao as Ce,aB as ee,mE as F,dS as $e,b5 as De,b4 as ke}from"./index-b516d057.js";import{e as Ie}from"./defaultUnit-414db021.js";import{O as U,j as Le}from"./Stop-bb61a730.js";import{L as Pe,x as Re,S as Ae}from"./Search-ca0747cf.js";import{e as O,O as ue,r as ce,n as i,i as C}from"./jsxFactory-92036771.js";import{O as de,d as Ee}from"./RouteParameters-e6740eb5.js";import{t as Be}from"./GoTo-4d856ce0.js";import{i as Oe,f as D,g as xe}from"./unitFormatUtils-67047561.js";import{C as He}from"./DatePicker-ccc9fd8a.js";import{e as f}from"./globalCss-94006b67.js";import{e as R,n as ze}from"./Heading-92f210ca.js";import{T as Ne}from"./TimePicker-9d85cfd9.js";import{t as A}from"./accessibleHandler-e91101b2.js";import{S as Fe}from"./sortable.esm-0d19b1d3.js";import"./getDefaultUnitForView-d1ffbf16.js";import"./layerViewUtils-6ebe90f4.js";import"./FullTextSearch-12e0754c.js";import"./scaleUtils-72744379.js";import"./commonProperties-da958896.js";import"./geolocationUtils-4a35382f.js";import"./project-1bd91657.js";import"./vmEvent-d773b6c5.js";import"./uuid-709b6c67.js";import"./Cyclical-4c223a04.js";import"./Popover-ca6b0b13.js";function Ue(e){return(e==null?void 0:e.declaredClass)==="esri.Graphic"}function Ve(e){return(e==null?void 0:e.declaredClass)==="esri.rest.support.Stop"}var b;(function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Failed=2]="Failed",e[e.Idle=3]="Idle",e[e.Suspended=4]="Suspended"})(b||(b={}));let g=class extends Be(fe.EventedAccessor){constructor(e){super(e),this._highlight=null,this._loadPromise=null,this._loadController=null,this._routeController=null,this._serviceDescriptionStatus=b.Idle,this.apiKey=void 0,this.defaultTravelMode=null,this.departureTime="now",this.lastError=null,this.lastRoute=null,this.layer=null,this.maxStops=50,this.routeParameters=new de({directionsLengthUnits:"kilometers",findBestSequence:!1,returnZ:!0,startTime:null,startTimeIsUTC:!0,useTimeWindows:!1}),this.serviceDescription=null,this.view=null}initialize(){this.addHandles([le(()=>{var e;return(e=this.layer)==null?void 0:e.stops},"change",()=>{this.clearResults()}),B(()=>this.layer,e=>{if(e!=null){for(;e.stops.length<2;)e.stops.add(new U);this._set("defaultTravelMode",null),this.addHandles(j(()=>{var t,s;return this.serviceDescription!=null?(s=(t=e.routeInfo)==null?void 0:t.analysisSettings)==null?void 0:s.travelMode:null},t=>{this.defaultTravelMode=this._resolveDefaultTravelMode(t)},{once:!0}))}},we)])}get _directionsLanguage(){if(this.serviceDescription==null)return;const e=this.serviceDescription.directionsSupportedLanguages;if(!e)return;const t=(this.routeParameters.directionsLanguage??Se()).slice(0,2);return e.find(s=>s.toLowerCase().slice(0,2)===t)}get impedanceAttribute(){var t,s;const e=((t=this.routeParameters.travelMode)==null?void 0:t.impedanceAttributeName)??this.routeParameters.impedanceAttribute??((s=this.serviceDescription)==null?void 0:s.impedance)??null;return this.getCostAttribute(e)}get selectedTravelMode(){var e;return this.serviceDescription==null?null:this.defaultTravelMode??this.serviceDescription.defaultTravelMode??((e=this.serviceDescription.supportedTravelModes)==null?void 0:e[0])??null}set selectedTravelMode(e){this._override("selectedTravelMode",e)}get state(){if(this._routeController!=null)return"routing";if(this.lastError!=null)return"error";switch(this._serviceDescriptionStatus){case b.Suspended:return"unauthenticated";case b.Idle:return"disabled";case b.Active:return"initializing";case b.Failed:return"error";default:return"ready"}}get timeAttribute(){var t,s;const e=((t=this.routeParameters.travelMode)==null?void 0:t.timeAttributeName)??this.routeParameters.directionsTimeAttribute??((s=this.serviceDescription)==null?void 0:s.directionsTimeAttribute)??null;return this.getCostAttribute(e)}get travelModes(){var t,s;const e=((s=(t=this.serviceDescription)==null?void 0:t.supportedTravelModes)==null?void 0:s.slice())??[];return this.defaultTravelMode==null||e.includes(this.defaultTravelMode)||e.unshift(this.defaultTravelMode),e}async load(){if(this._loadPromise!=null)return this._loadPromise;this._loadPromise=this._load(),await this._loadPromise,this._loadPromise=null}async highlight(e){if(this.clearHighlights(),!this.view||!this.layer)return;const t=await this.view.whenLayerView(this.layer);this._highlight=t.highlight(e)}clearHighlights(){this._highlight!=null&&(this._highlight.remove(),this._highlight=null)}centerAt(e){if(this.view==null)return;const t=Ve(e)||Ue(e)?e.geometry:e;t!=null&&this.callGoTo({target:t})}clearResults(){var e;this._set("lastRoute",null),(e=this.layer)==null||e.removeResult()}async getDirections(){const{apiKey:e,departureTime:t,layer:s,state:r}=this;if(s==null)throw new P("directions-view-model:missing-route-layer","A route layer must be associated with the view model.");if(r==="unauthenticated"||r==="initializing"||r==="disabled"||this._serviceDescriptionStatus===b.Failed)throw new P("directions-view-model:not-loaded","Cannot get directions until view model loads.");this._set("lastError",null),this._routeController!=null&&(this._routeController.abort(),this._routeController=null);const o=t==="now",a=t==="now"?new Date:t;if(a&&!o){const m=60*a.getTimezoneOffset()*1e3;a.setTime(a.getTime()-m)}const u=this.view!=null?this.view.spatialReference:null,p=this.routeParameters.clone();if(p.set({startTime:a,startTimeIsUTC:o,directionsLanguage:this._directionsLanguage,apiKey:e,outSpatialReference:u}),this.selectedTravelMode!=null&&(p.travelMode=this.selectedTravelMode),s.stops.filter(({geometry:m})=>m!=null).length<2){const m=new P("directions-view-model:not-enough-stops","Not enough stops for routing");throw this._set("lastError",m),m}this._routeController=new AbortController;const{signal:_}=this._routeController;let v=null;try{v=await s.solve(p,{signal:_})}catch(m){if(!G(m)){const S=new P("directions-view-model:unable-to-route","Unable to route to these addresses",{error:m});throw this._set("lastError",S),this._set("lastRoute",null),S}}finally{this._routeController=null}for(const m of v.stops)m.geometry==null&&(m.name=null);return s.update(v),this._set("lastRoute",v),this.zoomToRoute(),v}getCostAttribute(e){var t,s;return(((s=(t=this.serviceDescription)==null?void 0:t.networkDataset)==null?void 0:s.networkAttributes)??[]).find(({name:r,usageType:o})=>r===e&&o==="cost")??null}reset(){this.clearHighlights(),this.clearResults(),this.layer!=null&&(this.layer.removeAll(),this.layer.stops=new be([new U,new U]))}save(){if(!this.layer)throw new P("directions-view-model:missing-layer","save() requires a layer");return this.layer.save()}saveAs(e,t={}){if(!this.layer)throw new P("directions-view-model:missing-layer","saveAs() requires a layer");return this.layer.saveAs(e,t)}zoomToRoute(){const{view:e,layer:t}=this;if(e==null||(t==null?void 0:t.routeInfo)==null)return;const{geometry:s}=t.routeInfo;if(s==null)return;const r=s.extent;if(!r)return;const o=r.width>r.height,a=r.clone().expand(o?2:1);this.callGoTo({target:a})}async _load(){if(this.serviceDescription!=null||this.layer==null)return;this._loadController!=null&&(this._loadController.abort(),this._loadController=null),this._loadController=new AbortController;const{signal:e}=this._loadController;try{this._serviceDescriptionStatus=b.Active;const t=await Ee(this.layer.url,this.apiKey,{signal:e});this._set("serviceDescription",t),this._serviceDescriptionStatus=b.Complete}catch(t){if(G(t))return void(this._serviceDescriptionStatus=b.Idle);if(t.name==="identity-manager:user-aborted")return void(this._serviceDescriptionStatus=b.Suspended);const s=new P("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:t});throw this._serviceDescriptionStatus=b.Failed,this._set("lastError",s),s}finally{this._loadController=null}}_resolveDefaultTravelMode(e){var a,u;if(this.serviceDescription==null)return null;const{defaultTravelMode:t,supportedTravelModes:s}=this.serviceDescription,r=(u=(a=/^<(?<name>.*)>$/i.exec(e.name))==null?void 0:a.groups)==null?void 0:u.name;if(r){const p=s==null?void 0:s.find(({name:v})=>v.toLocaleLowerCase()===r.trim().toLocaleLowerCase()),_=p??t;return Le.fromJSON({..._==null?void 0:_.toJSON(),...e.toJSON()})}return(s==null?void 0:s.find(({name:p})=>p.toLocaleLowerCase()===e.name.toLocaleLowerCase()))??t}};c([d()],g.prototype,"_directionsLanguage",null),c([d()],g.prototype,"_routeController",void 0),c([d()],g.prototype,"_serviceDescriptionStatus",void 0),c([d()],g.prototype,"apiKey",void 0),c([d()],g.prototype,"defaultTravelMode",void 0),c([d()],g.prototype,"departureTime",void 0),c([d({readOnly:!0})],g.prototype,"impedanceAttribute",null),c([d()],g.prototype,"lastError",void 0),c([d({readOnly:!0})],g.prototype,"lastRoute",void 0),c([d()],g.prototype,"layer",void 0),c([d({type:Number,range:{min:2,max:50},nonNullable:!0})],g.prototype,"maxStops",void 0),c([d({type:de,nonNullable:!0})],g.prototype,"routeParameters",void 0),c([d()],g.prototype,"selectedTravelMode",null),c([d({readOnly:!0})],g.prototype,"serviceDescription",void 0),c([d({readOnly:!0})],g.prototype,"state",null),c([d({readOnly:!0})],g.prototype,"timeAttribute",null),c([d()],g.prototype,"travelModes",null),c([d()],g.prototype,"view",void 0),c([d()],g.prototype,"getDirections",null),c([d()],g.prototype,"zoomToRoute",null),g=c([J("esri.widgets.Directions.DirectionsViewModel")],g);const he=g,w="esri-save-layer",M={panel:`${w}`,error:`${w}__error`,errorIcon:`${w}__error-icon`,errorLabel:`${w}__error-label`,layerNameLabel:`${w}__layer-name-label`,portalFolderLabel:`${w}__portal-folder-label`,processLabel:`${w}__process-label`,processLoader:`${w}__process-loader`};let k=class extends ue{constructor(e,t){super(e,t),this._folders=null,this._layer=null,this._layerNameInput=null,this._portalFolderCombobox=null,this._userName=null,this.messages=null,this.messagesCommon=null,this.messagesIdentity=null,this.opened=!1,this.state="initialized",this.close=()=>{this.opened=!1,this.state="initialized"}}loadDependencies(){return ce({button:()=>T(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),combobox:()=>T(()=>import("./calcite-combobox-7d2cf661.js"),["assets/calcite-combobox-7d2cf661.js","assets/combobox-234207ac.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/floating-ui-a6c9d5df.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/openCloseComponent-3fbda1cf.js","assets/t9n-622f279b.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/chip-9ebcd4a3.js","assets/conditionalSlot-11b5e54d.js","assets/icon-c122f720.js"]),"combobox-item":()=>T(()=>import("./calcite-combobox-item-961b0328.js"),["assets/calcite-combobox-item-961b0328.js","assets/combobox-item-3b86c430.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),icon:()=>T(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),input:()=>T(()=>import("./calcite-input-f0ebb300.js"),["assets/calcite-input-f0ebb300.js","assets/input-9795a695.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/progress-2100df13.js"]),label:()=>T(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),loader:()=>T(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"]),panel:()=>T(()=>import("./calcite-panel-e7a1d066.js"),["assets/calcite-panel-e7a1d066.js","assets/panel-4decad7b.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/observers-9c654f26.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/guid-2347ca41.js","assets/key-c2c83cc7.js","assets/action-79a6733c.js","assets/locale-2cb18332.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js","assets/scrim-41a5f26e.js"])})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}async open(e){this.state="initialized",this.opened=!0,this._layer=e,this.state="connect-to-portal";const t=Te.getDefault();try{await t.signIn()}catch(r){return void(G(r)||r.name==="identity-manager:user-aborted"?this.close():this.state="connect-to-portal-error")}this.state="fetch-portal-information";const{user:s}=t;this._userName=s==null?void 0:s.username;try{this._folders=await(s==null?void 0:s.fetchFolders())}catch{return void(this.state="fetch-portal-information-error")}this.state="save-layer"}render(){switch(this.state){case"initialized":return this._renderInitialized();case"connect-to-portal":return this._renderProcess(this.messagesIdentity.lblSigning);case"connect-to-portal-error":return this._renderError(this.messages.errors.authenticating);case"fetch-portal-information":return this._renderProcess(this.messages.processing.fetching);case"fetch-portal-information-error":return this._renderError(this.messages.errors.fetching);case"save-layer":return this._renderSaveLayer();case"saving":return this._renderProcess(this.messages.processing.saving);case"saving-error":return this._renderError(this.messages.errors.saving)}}_renderError(e){return i("calcite-panel",{class:M.panel,heading:this.messages.widgetLabel,key:`${w}-error-panel`},i("div",{class:M.error},i("calcite-icon",{class:M.errorIcon,icon:"exclamation-mark-triangle",scale:"l",textLabel:this.messagesCommon.errorMessage}),i("calcite-label",{class:M.errorLabel},e)),i("calcite-button",{appearance:"outline",onclick:this.close,slot:"footer-actions",width:"half"},this.messagesCommon.close))}_renderInitialized(){return i("calcite-panel",{class:M.panel,heading:this.messages.widgetLabel,key:`${w}-initialize-panel`})}_renderProcess(e){return i("calcite-panel",{class:M.panel,heading:this.messages.widgetLabel,key:`${w}-process-panel`},i("calcite-loader",{class:M.processLoader,label:e}),i("calcite-label",{alignment:"center",class:M.processLabel},e))}_renderSaveLayer(){if(this._layer==null||this._folders==null||this._userName==null)return this._renderInitialized();const{stops:e}=this._layer,t=`${e.at(0).name} - ${e.at(-1).name}`,s=this._folders.map(r=>i("calcite-combobox-item",{key:`${w}-folder-${r.id}`,textLabel:r.title??"",value:r.id}));return s.unshift(i("calcite-combobox-item",{key:`${w}-folder-home`,selected:!0,textLabel:`${this._userName} (${this.messagesCommon.home})`,value:null})),i("calcite-panel",{class:M.panel,heading:this.messages.widgetLabel,key:`${w}-save-panel`},i("calcite-label",{class:M.layerNameLabel},this.messages.laverName,i("calcite-input",{afterCreate:r=>{this._layerNameInput=r},label:this.messages.laverName,value:t})),i("calcite-label",{class:M.portalFolderLabel},this.messages.saveInFolder,i("calcite-combobox",{afterCreate:r=>{this._portalFolderCombobox=r},label:this.messages.saveInFolder,overlayPositioning:"fixed",selectionMode:"single"},s)),i("calcite-button",{onclick:()=>this._saveButtonClick(),slot:"footer-actions",width:"half"},this.messagesCommon.save),i("calcite-button",{appearance:"outline",onclick:()=>{this.close()},slot:"footer-actions",width:"half"},this.messagesCommon.cancel))}_saveButtonClick(){this.state="saving",this._saveLayer().then(()=>{this.close()}).catch(()=>{this.state="saving-error"})}async _saveLayer(){var r,o;if(this._layer==null||this._folders==null)return;const e=(r=this._layerNameInput)==null?void 0:r.value,t=(o=this._portalFolderCombobox)==null?void 0:o.value,s=this._folders.find(a=>a.id===t);await this._layer.saveAs({title:e},{folder:s})}};c([d()],k.prototype,"label",null),c([d(),O("esri/widgets/support/t9n/SaveLayer")],k.prototype,"messages",void 0),c([d(),O("esri/t9n/common")],k.prototype,"messagesCommon",void 0),c([d(),O("esri/identity/t9n/identity")],k.prototype,"messagesIdentity",void 0),c([d()],k.prototype,"opened",void 0),c([d()],k.prototype,"state",void 0),k=c([J("esri.widgets.Directions.SaveLayer")],k);function E(e,t){return V(e,{style:"unit",unit:t,unitDisplay:"short"})}function te(e,t,s){if(t===0)return"";let r,o,a=0;const u=Oe(t,"meters");switch(s){case"metric":u.value<.01?{value:r,unit:o}=D(u,"millimeters"):u.value<1?{value:r,unit:o}=D(u,"centimeters"):u.value<1e3?{value:r,unit:o}=D(u,"meters"):u.value<1e5?({value:r,unit:o}=D(u,"kilometers"),a=1):{value:r,unit:o}=D(u,"kilometers");break;case"imperial":u.value<.254?{value:r,unit:o}=D(u,"inches"):u.value<160.9344?{value:r,unit:o}=D(u,"feet"):u.value<160934.4?({value:r,unit:o}=D(u,"miles"),a=1):{value:r,unit:o}=D(u,"miles");break;default:({value:r,unit:o}=D(u,s)),a=2}return xe(e,r,o,a)}function se(e){if(e===0)return"";if(e<1)return E(Math.floor(60*e),"second");if(e<60)return E(Math.floor(e),"minute");const t=Math.floor(e/60);if(e<1440){const s=Math.floor(e%60);return s===0?`${E(t,"hour")}`:`${E(t,"hour")} ${E(s,"minute")}`}return E(t,"hour")}const l="esri-directions",n={base:l,widgetIcon:C.directions,addStopButton:`${l}__add-stop-button`,arrivalTime:`${l}__arrival-time`,arrivalTimeContainer:`${l}__arrival-time-container`,clearRouteButton:`${l}__clear-route-button`,collapsibleSection:`${l}__maneuver-section--collapsible`,contentTitle:`${l}__content-title`,costsDetails:`${l}__costs-details`,departureTime:`${l}__departure-time`,departureTimeControls:`${l}__departure-time-controls`,departureTimeSelect:`${l}__departure-time-select`,directionCosts:`${l}__costs`,directionsButton:`${l}__button`,directionsSection:`${l}__directions-section`,disclaimer:`${l}__disclaimer`,horizontalSplitter:`${l}__horizontal-splitter`,interactiveStopIcon:`${l}__stop-icon--interactive`,intermediateCost:`${l}__cost--intermediate`,lastStopIconContainer:`${l}__stop-icon-container--last`,layerDetailsLink:`${l}__layer-details-link`,loader:`${l}__loader`,maneuver:`${l}__maneuver`,maneuverActive:`${l}__maneuver--active`,maneuverCosts:`${l}__maneuver-costs`,maneuverCostsContainer:`${l}__maneuver-costs-container`,maneuverIcon:`${l}__maneuver-icon`,maneuverList:`${l}__maneuver-list`,maneuverSection:`${l}__maneuver-section`,maneuverSectionHeader:`${l}__maneuver-section-header`,maneuverSectionHeaderButton:`${l}__maneuver-section-header-toggle-button`,maneuverSectionTitle:`${l}__maneuver-section-title`,maneuverSectionToggle:`${l}__maneuver-section-toggle`,maneuvers:`${l}__maneuvers`,message:`${l}__message`,messageHeading:`${l}__message_heading`,panelContent:`${l}__panel-content`,panelContentError:`${l}__panel-content--error`,panelContentLoading:`${l}__panel-content--loading`,panelContentSignIn:`${l}__panel-content--sign-in`,primaryCosts:`${l}__costs-value`,printButton:`${l}__print-button`,removeStop:`${l}__remove-stop-icon`,removeStopButton:`${l}__remove-stop`,reverseStops:`${l}__reverse-stops`,routeActions:`${l}__route-actions`,saveAsButton:`${l}__save-as-button`,saveAsButtonPopover:`${l}__save-as-button-with-popover`,saveButton:`${l}__save-button`,saveButtons:`${l}__save-buttons`,saveSection:`${l}__save-section`,scroller:`${l}__scroller`,secondaryCosts:`${l}__other-costs-total`,section:`${l}__section`,sectionSplitter:`${l}__section-splitter`,signInButton:`${l}__sign-in-button`,signInContent:`${l}__sign-in-content`,stopHandle:`${l}__stop-handle`,stopHandleIcon:`${l}__stop-handle-icon`,stopIcon:`${l}__stop-icon`,stopIconContainer:`${l}__stop-icon-container`,stopInput:`${l}__stop-input`,stopOptions:`${l}__stop-options`,stopRow:`${l}__stop-row`,stopRowGhost:`${l}__stop-row-ghost`,stops:`${l}__stops`,summary:`${l}__summary`,toolbarButtons:`${l}__toolbar-buttons`,toolbarSection:`${l}__toolbar-section`,travelMode:`${l}__travel-modes`,travelModeSelect:`${l}__travel-modes-select`,validStopRow:`${l}__stop-row--valid`,verticalSplitter:`${l}__vertical-splitter`,warningCard:`${l}__warning-card`,warningHeader:`${l}__warning-header`,warningHeading:`${l}__warning-heading`,warningMessage:`${l}__warning-message`},re=new Map([["arrive","route-to"],["bear-left","bear-left"],["bear-right","bear-right"],["boundary-crossing","blank"],["central-fork","fork-middle"],["clockwise-roundabout","round-about-right"],["counter-clockwise-roundabout","round-about"],["depart","route-from"],["door","walk-through-door"],["down-elevator","elevator-down"],["down-escalator","escalator-down"],["down-stairs","stairs-down"],["elevator","elevator"],["escalator","escalator"],["general-event","information"],["landmark","map-pin"],["left-fork","fork-left"],["left-handed-u-turn","u-turn"],["left-ramp","ramp-left"],["left-turn","left"],["left-turn-and-immediate-left-turn","left-left"],["left-turn-and-immediate-right-turn","left-right"],["off-ferry","disembark"],["on-ferry","embark"],["pedestrian-ramp","take-pedestrian-ramp"],["restriction-violation","exclamation-mark-triangle"],["right-fork","fork-right"],["right-handed-u-turn","u-turn-right"],["right-ramp","exit-highway-right"],["right-ramp","ramp-right"],["right-turn","right"],["right-turn-and-immediate-left-turn","right-left"],["right-turn-and-immediate-right-turn","right-right"],["roundabout","round-about"],["scaled-cost-barrier-event","blank"],["sharp-left","sharp-left"],["sharp-right","sharp-right"],["stairs","stairs"],["straight","straight"],["time-zone-change","clock"],["traffic-event","exclamation-mark-triangle"],["u-turn","u-turn"],["up-elevator","elevator-up"],["up-escalator","escalator-up"],["up-stairs","stairs-up"]]);var y;function Ke(e){return e==null||!re.has(e)?null:re.get(e)}(function(e){e.NOW="now",e.DEPART_AT="depart-at",e.UNSPECIFIED="unspecified"})(y||(y={}));const ie={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0};function qe(e){const t=e.getTimezoneOffset(),s=t>0?"-":"+",r=60,o=Math.abs(Math.floor(t/r)),a=Math.abs(Math.floor(t)%r),u={minimumIntegerDigits:2};return`GMT${s}${V(o,u)}${V(a,u)}`}function oe(e){var t;return!!((t=e.composedPath)!=null&&t.call(e).find(s=>{var r;return(r=s.classList)==null?void 0:r.contains("esri-search__suggestions-list")}))}const K="search-term",ne="date-time-picker",ae=100,We=500;let h=class extends ue{constructor(e,t){super(e,t),this._activeStop=null,this._activeManeuver=null,this._autoStopRemovalDelay=ae,this._autoStopRemovalTimeoutId=void 0,this._departureTimeOption=y.NOW,this._datePicker=new He,this._focusedManeuver=null,this._newPlaceholderStop=null,this._pointerDownUpHandle=null,this._pointerPressedSearchSuggestionStop=null,this._renderSavePopoverFunction=null,this._saveAsButtonNode=null,this._saveLayer=new k,this._sections=null,this._sortable=null,this._stopsToSearches=new Map,this._timePicker=new Ne,this._viewClickHandle=null,this.headingLevel=2,this.iconClass=n.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.searchProperties=null,this.viewModel=new he,this.visibleElements={...ie},this._setUpDragAndDropStops=s=>{this._sortable=Fe.create(s,{draggable:`.${n.validStopRow}`,ghostClass:n.stopRowGhost,handle:`.${n.stopHandle}`,onEnd:this._handleStopInputDragEnd})},this._handleDragHandlePointerDown=()=>{var s;return(s=this.viewModel.layer)==null?void 0:s.stops.forEach(r=>this.acquireSearch(r).activeMenu="none")},this._handleStopInputDragEnd=({oldIndex:s,newIndex:r,target:o})=>{if(s===r||r==null||s==null)return;const{children:a}=o,u=a[r],p=a[s],_=r-s<0;o.insertBefore(u,_?p.nextElementSibling:p);const{stops:v}=this.viewModel.layer;v.reorder(v.at(s),r);for(const m of v)m.sequence=null;this._getDirections()}}initialize(){this.addHandles([B(()=>{var e;return(e=this.viewModel.layer)==null?void 0:e.routeInfo},()=>{this._activeManeuver=null,this._focusedManeuver=null,this._sections=this._getSections(),this.scheduleRender()},x),j(()=>this.view,(e,t)=>{if(t&&(this._viewClickHandle=null,t!=null&&this.removeHandles(t)),e){const s=this._prepPointerDownUpClick(),r=this._prepViewClick();s.pause(),r.pause();const o=e.surface;this.addHandles([Z(o,"mousedown",()=>this._autoStopRemovalDelay=We),Z(o,"mouseup",()=>this._autoStopRemovalDelay=ae),s,r],e),this._pointerDownUpHandle=s,this._viewClickHandle=r}},x),j(()=>this.viewModel.serviceDescription==null,()=>{try{this.viewModel.load()}catch{}},x),B(()=>this._saveLayer.state,()=>{this.scheduleRender()})]),this.when(()=>{this.destroyed||this.visibleElements.saveAsButton&&(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),this._projector.append(document.body,this._renderSavePopoverFunction))})}loadDependencies(){return ce({button:()=>T(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),icon:()=>T(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),link:()=>T(()=>import("./calcite-link-a739980d.js"),["assets/calcite-link-a739980d.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/icon-c122f720.js","assets/observers-9c654f26.js"]),popover:()=>T(()=>import("./calcite-popover-c20a56ef.js"),["assets/calcite-popover-c20a56ef.js","assets/popover-33772892.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/FloatingArrow-9e5c8eb0.js","assets/component-7281ffa6.js","assets/action-79a6733c.js","assets/interactive-39956fb6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"])})}destroy(){var e;this._datePicker.destroy(),this._timePicker.destroy();for(const t of this._stopsToSearches.values())t.destroy();(e=this._sortable)==null||e.destroy(),this._renderSavePopoverFunction!=null&&this._projector.detach(this._renderSavePopoverFunction)}get apiKey(){return this.viewModel.apiKey}set apiKey(e){this.viewModel.apiKey=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get lastRoute(){return this.viewModel.lastRoute}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get maxStops(){return this.viewModel.maxStops}set maxStops(e){this.viewModel.maxStops=e}get unit(){return this.defaultUnit}set unit(e){this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...ie,...e}}acquireSearch(e){const{view:t}=this.viewModel;if(this._stopsToSearches.has(e)){const r=this._stopsToSearches.get(e);return r.view=t,this._overrideDefaultSources(r),r}const s=new Pe({view:t,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});return this._normalizeSearchSources(s),this.addHandles([le(()=>s.allSources,"change",()=>this._normalizeSearchSources(s)),s.on("select-result",()=>{var r,o;e.geometry=(r=s.selectedResult)==null?void 0:r.feature.geometry,e.name=(o=s.selectedResult)==null?void 0:o.name,this._getDirections()}),s.on("search-focus",()=>this._handleStopInputFocus(s,e)),s.on("search-blur",()=>this._handleStopInputBlur(s,e)),s.on("search-clear",()=>{var r;e.geometry=null,e.name=null,this._activeStop=e,(r=this.viewModel.layer)==null||r.removeResult()}),B(()=>s.searchTerm,r=>{e.name=r})],s),this._stopsToSearches.set(e,s),s}getDirections(){return this.viewModel.getDirections()}render(){return i("div",{class:this.classes(n.base,f.widget,f.panel,n.scroller)},this._renderPanelContent())}save(){return this.viewModel.save()}saveAs(e,t={}){return this.viewModel.saveAs(e,t)}zoomToRoute(){return this.viewModel.zoomToRoute()}_renderPanelContent(){const{layer:e,serviceDescription:t,state:s}=this.viewModel,r=s==="initializing",o=s==="error"&&!t,a=s==="unauthenticated",u={[n.panelContentLoading]:r,[n.panelContentError]:o||!e,[n.panelContentSignIn]:a},p=r?"presentation":"group",_=e?a?this._renderSignIn():o?this._renderMessage(this._getErrorMessage()):r?this._renderLoader():this._renderReadyContent():this._renderMessage(this.messages.missingLayer);return i("div",{class:this.classes(n.panelContent,u),role:p},_)}_renderReadyContent(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]}_renderSignIn(){return i("div",{class:n.signInContent,key:"sign-in"},i(R,{class:n.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),i(R,{level:ze(this.headingLevel)},this.messages.signInRequired),i("button",{bind:this,class:this.classes(f.button,f.buttonSecondary,n.signInButton),onclick:this._handleSignInClick,tabIndex:0,type:"button"},this.messagesCommon.auth.signIn))}_handleSignInClick(){this.viewModel.load().catch(()=>{})}_renderTravelModeOptions(){if(!this.visibleElements.traveMode)return null;const{selectedTravelMode:e,travelModes:t}=this.viewModel;if(t.length===0)return null;const s=e!=null?e.name:this.messages.travelMode;return i("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(n.travelMode,this._saveLayer.opened&&f.buttonDisabled),key:"esri-directions__travel-mode-controls",role:"group"},i("select",{"aria-label":s,bind:this,class:this.classes(n.travelModeSelect,f.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:s},t.map((r,o)=>i("option",{"data-mode":r,key:`esri-directions__travel-mode-${o}`,selected:e===r,value:`${o}`},r.name))))}_handleTravelModeChange(e){const t=e.currentTarget;this.viewModel.selectedTravelMode=je(t.item(t.selectedIndex)),this._getDirections()}_renderStopsContainer(){return this.visibleElements.stops?i("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(n.section,this._saveLayer.opened&&f.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null}_renderDepartureTimeControls(){if(!this.visibleElements.departureTime)return null;const{messages:{departAt:e,departureTime:t,leaveNow:s,timeUnspecified:r}}=this;return i("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(n.departureTime,this._saveLayer.opened&&f.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},i("select",{"aria-label":t,bind:this,class:this.classes(n.departureTimeSelect,f.select),onchange:this._handleDepartureOptionChange,title:t},i("option",{selected:this._departureTimeOption===y.NOW,value:y.NOW},s),i("option",{selected:this._departureTimeOption===y.DEPART_AT,value:y.DEPART_AT},e),i("option",{selected:this._departureTimeOption===y.UNSPECIFIED,value:y.UNSPECIFIED},r)),this._departureTimeOption===y.DEPART_AT?this._renderTimeControls():null)}_renderStops(){const{stops:e}=this.viewModel.layer;let t=0;for(const o of this._stopsToSearches.keys())e.includes(o)||this._disposeSearch(o);for(const o of e){const a=this.acquireSearch(o);a.activeMenu!=="none"&&(t+=1),o.name!=null&&(a.searchTerm=o.name)}const s=e.toArray().map((o,a)=>{const u=e.length,p=a>1&&o.geometry==null,_={[C.radioUnchecked]:a>=0&&a<u-1,[C.radioChecked]:a===u-1},v={[n.lastStopIconContainer]:a===u-1},m={[n.validStopRow]:!p},S=e.at(a+1),$=a===u-1,L=a===u-2,H=u===2&&a===0||u>2&&!$&&!L||u>2&&L&&(S==null?void 0:S.geometry)!=null||u>2&&$&&o.geometry==null,z=u<3,I=this.acquireSearch(o),{messages:N}=this,{removeStop:Y,reverseStops:Q,unlocated:pe}=N,ve=o.geometry!=null&&o.name!=null?o.name:pe,me=V(a+1),_e=`${N.stopLabel} ${me} (${ve})`,X=`${this.id}__stop--${a}`,ge=!!I.searchTerm&&!!I.selectedResult&&o.geometry!=null&&I.selectedResult.name===o.name,ye={zIndex:I.activeMenu!=="none"?""+t--:""};return i("li",{afterCreate:this._handleStopFieldCreation,"aria-label":_e,bind:this,class:this.classes(n.stopRow,m),"data-stop-index":a,id:X,key:a,styles:ye},i("div",{class:n.stopHandle},i("span",{"aria-hidden":"true",class:this.classes(n.stopIcon,C.handleVertical,n.stopHandleIcon,n.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),i("div",{"aria-labelledby":X,bind:this,class:this.classes(n.stopIconContainer,v),"data-stop-index":a,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},i("span",{class:this.classes(n.stopIcon,_),tabIndex:ge?0:void 0}))),i("div",{class:n.stopInput},I.render()),i("div",{class:n.stopOptions,role:"group"},i("div",{"aria-label":Y,bind:this,class:n.removeStopButton,"data-stop-index":a,hidden:z,onclick:this._handleRemoveStop,onkeydown:this._handleRemoveStop,role:"button",tabIndex:0,title:Y},i("span",{"aria-hidden":"true",class:this.classes(n.stopIcon,n.removeStop,C.trash,n.interactiveStopIcon)}),i("span",{class:C.fontFallbackText},"removeStopTitle")),i("div",{"aria-label":Q,bind:this,class:n.reverseStops,hidden:H,onclick:this._handleReverseStops,onkeydown:this._handleReverseStops,role:"button",tabIndex:0,title:Q},i("span",{"aria-hidden":"true",class:this.classes(n.stopIcon,C.upDownArrows,n.interactiveStopIcon)}),i("span",{class:C.fontFallbackText},"removeStopTitle"))))}),r=this._renderAddStop();return i("div",null,i("ol",{afterCreate:this._setUpDragAndDropStops,class:n.stops,role:"group"},s),r)}_renderAddStop(){var r;const e=(r=this.viewModel.layer)==null?void 0:r.stops;if(!e)return null;const t=e.filter(({geometry:o})=>o!=null),s=e.at(-1);return t.length>1&&t.length<this.maxStops&&(s==null?void 0:s.geometry)!=null?i("div",{class:n.toolbarSection},i("div",{class:n.toolbarButtons},i("calcite-button",{appearance:"outline",class:n.addStopButton,iconStart:"plus",key:n.addStopButton,kind:"neutral",label:this.messages.addStop,onclick:()=>{this._addNewPlaceholder()},round:!0,scale:"s",width:"full"},this.messages.addStop))):null}_handleStopIconClick(e){var r;const t=q(e.currentTarget),s=t!=null?(r=this.viewModel.layer)==null?void 0:r.stops.at(t):void 0;s!=null&&s.geometry&&this._centerAtStop(s)}_handleClearRouteClick(){this.viewModel.reset()}_centerAtStop(e){this.viewModel.centerAt(e)}_handleStopFieldCreation(e){var o;const t=this._newPlaceholderStop;if(!t)return;const s=q(e),r=s!=null?(o=this.viewModel.layer)==null?void 0:o.stops.at(s):void 0;if(t===r){const a=this.acquireSearch(r);a.when(()=>{this.renderNow(),a.focus()})}this._newPlaceholderStop=null}_handleStopInputBlur(e,t){var o,a,u,p,_,v,m,S;if(this._saveLayer.opened)return;if(this.removeHandles(K),e.selectedResult&&t.geometry!=null&&((o=e.selectedResult)==null?void 0:o.feature.geometry)!=null&&t.geometry===((a=e.selectedResult)==null?void 0:a.feature.geometry))return void((u=this._pointerDownUpHandle)==null?void 0:u.pause());const s=t.geometry==null&&((p=e.selectedResult)==null?void 0:p.feature.geometry)==null,r=t.geometry!=null&&((_=e.selectedResult)==null?void 0:_.feature.geometry)!=null&&t.geometry!==((v=e.selectedResult)==null?void 0:v.feature.geometry);if((s||r)&&e.activeMenu==="none"&&e.searchTerm)return e.search(),void((m=this._pointerDownUpHandle)==null?void 0:m.pause());e.searchTerm||((S=this._viewClickHandle)==null||S.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=setTimeout(()=>{var $,L;this.destroyed||(($=this._viewClickHandle)==null||$.pause(),e.viewModel.state!=="searching"?this._pointerPressedSearchSuggestionStop||(t.geometry!=null&&(t.geometry=null,this._getDirections()),this.scheduleRender()):(L=this._pointerDownUpHandle)==null||L.pause())},this._autoStopRemovalDelay))}_handleStopInputFocus(e,t){var o;(o=this._pointerDownUpHandle)==null||o.resume();const{view:s}=this;if(this.hasHandles(K)||!s)return;const r=s.cursor;this.addHandles([Ce(()=>{s.cursor=r}),B(()=>e.searchTerm,a=>{e.destroyed||(s.cursor=a.length?r:"copy")},x)],K),this._activeStop=t}_prepViewClick(){const{view:e}=this.viewModel;ee(e),ee(e.surface);const t=F(e,"click",this._handleViewClick.bind(this)),s=F(e.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId),s.pause()});return{remove(){s.remove(),t.remove()},pause(){s.pause(),t.pause()},resume(){s.resume(),t.resume()}}}_prepPointerDownUpClick(){const e=F(document,"pointerdown",s=>{this._pointerPressedSearchSuggestionStop=oe(s)?this._activeStop:null}),t=F(document,"pointerup",s=>{var a;(a=this._pointerDownUpHandle)==null||a.pause();const r=oe(s),o=this._activeStop;r||o!==this._pointerPressedSearchSuggestionStop||this._removeStop(o),this.scheduleRender(),this._pointerPressedSearchSuggestionStop=r?o:null});return{remove(){t.remove(),e.remove()},pause(){t.pause(),e.pause()},resume(){e.resume()}}}_handleViewClick(e){var r;e.stopPropagation();const t=this._activeStop,s=t?this._stopsToSearches.get(t):null;t&&s&&!s.searchTerm&&(s.search(e.mapPoint).then(o=>{const a=o==null?void 0:o.results[0].results;if(!a)return;const{feature:u,name:p}=a[0];t.geometry=u.geometry,t.name=p,s.searchTerm=p}),this.scheduleRender()),(r=this._viewClickHandle)==null||r.pause(),clearTimeout(this._autoStopRemovalTimeoutId)}_addNewPlaceholder(){var t,s;if((t=this._pointerDownUpHandle)==null||t.pause(),this._newPlaceholderStop)return;const e=new U({symbol:new $e});(s=this.viewModel.layer)==null||s.stops.add(e),this._newPlaceholderStop=e}_handleReverseStops(){this._reverseStops()}_reverseStops(){var t;const e=((t=this.viewModel.layer)==null?void 0:t.stops)??[];e.reverse();for(const s of e)s.sequence=null;this._getDirections()}_handleRemoveStop(e){const{layer:t}=this.viewModel;if(!t)return;const s=q(e.currentTarget);if(s==null)return;const{stops:r,routeInfo:o}=t,a=r.at(s);this._removeStop(a),a.geometry==null&&o!=null||this._getDirections()}_removeStop(e){const{stops:t}=this.viewModel.layer;!e||t.length<=2||(this._disposeSearch(e),t.remove(e))}_handleDepartureOptionChange(e){const t=e.currentTarget,s=t.item(t.selectedIndex);s.value===y.NOW?(this._departureTimeOption=y.NOW,this.viewModel.departureTime=y.NOW,this.removeHandles(ne),this._getDirections()):s.value===y.DEPART_AT?(this._departureTimeOption=y.DEPART_AT,this.addHandles(B(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime(),this._getDirections()},x),ne)):(this._departureTimeOption=y.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())}_updateDepartureTime(){const e=this._datePicker.value,t=this._timePicker.value;e&&t&&(this.viewModel.departureTime=new Date(e.getFullYear(),e.getMonth(),e.getDate(),t.getHours(),t.getMinutes()))}_renderTimeControls(){return i("div",{class:n.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())}_renderSectionSplitter(){return i("div",{class:n.sectionSplitter})}_renderSaveContainer(){const{saveButton:e,saveAsButton:t,printButton:s,layerDetails:r}=this.visibleElements;return e||t||s||r?i("div",{class:n.saveSection,key:n.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null}_renderSaveButtons(){const{saveButton:e,saveAsButton:t,printButton:s}=this.visibleElements;return e||t||s?i("div",{class:n.saveButtons,key:n.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null}_renderSaveButton(){if(!this.visibleElements.saveButton)return null;const{portalItem:e,routeInfo:t}=this.viewModel.layer,s=e==null?void 0:e.itemControl,r=t!=null&&(s==="admin"||s==="update");return i("calcite-button",{appearance:"outline",class:n.saveButton,disabled:!r,iconStart:"save",key:n.saveButton,label:this.messagesCommon.save,onclick:()=>{this._handleSaveButtonClick()},width:"full"},this.messagesCommon.save)}_renderSaveAsButton(){if(!this.visibleElements.saveAsButton)return null;const e=this.viewModel.layer.routeInfo==null;return i("div",{class:n.saveAsButtonPopover,key:n.saveAsButtonPopover},i("calcite-button",{afterCreate:t=>{this._saveAsButtonNode=t},appearance:"outline",class:n.saveAsButton,disabled:e,iconStart:"duplicate",key:n.saveAsButton,label:this.messagesCommon.saveAs,onclick:()=>this._handleSaveAsButtonClick(),width:"full"},this.messagesCommon.saveAs))}_renderSavePopover(){return i("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,overlayPositioning:"fixed",referenceElement:this._saveAsButtonNode},this._saveLayer.render())}_handleSaveAsButtonClick(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)}_renderPrintButton(){return this.visibleElements.printButton?i("calcite-button",{appearance:"outline",class:n.printButton,iconStart:"print",key:n.printButton,label:this.messagesCommon.print}):null}_renderRouteLayerDetailsLink(){if(!this.visibleElements.layerDetails)return null;const{portalItem:e}=this.viewModel.layer;if(!e)return null;const{id:t,portal:{url:s}}=e,r=`${s}/home/item.html?id=${t}`;return i("calcite-link",{class:n.layerDetailsLink,href:r,key:n.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)}_handleSaveButtonClick(){this.viewModel.layer.save()}_renderDirectionsContainer(){return i("div",{class:this.classes(n.directionsSection,n.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())}_renderLoader(){return i("div",{class:n.loader,key:"loader"})}_renderWarningCard(){return i("div",{class:n.warningCard,role:"alert"},i("div",{class:n.warningHeader},i("span",{"aria-hidden":"true",class:C.noticeTriangle}),i(R,{class:n.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),i("div",{class:n.warningMessage},this._getErrorMessage()))}_renderDirectionsContainerContent(){const{layer:e,state:t}=this.viewModel;return t==="error"?this._renderWarningCard():t==="routing"?this._renderLoader():e.directionLines!=null?i("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(n.summary,this._saveLayer.opened&&f.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):i("div",{class:f.empty,key:"esri-directions__placeholder"},this._renderPlaceholder(),i(R,{class:n.message,level:this.headingLevel},this.messages.directionsPlaceholder))}_renderPlaceholder(){return i("svg",{class:f.emptyIllustration,viewBox:"0 0 256 256",xmlns:"http://www.w3.org/2000/svg"},i("path",{d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z",fill:"currentcolor"}))}_renderMessage(e){return i(R,{class:n.messageHeading,level:this.headingLevel},e)}_renderRouteActions(){return i("div",{class:n.routeActions},i("button",{"aria-label":this.messages.clearRoute,bind:this,class:this.classes(n.clearRouteButton,f.button,f.buttonTertiary),onclick:this._handleClearRouteClick,tabIndex:0,type:"button"},this.messages.clearRoute))}_getSections(){const{layer:e}=this.viewModel;if(!e)return null;const{directionPoints:t,directionLines:s,stops:r}=e;if(t==null||s==null)return null;const o=[];let a=null;for(const u of t){const{objectId:p,stopId:_}=u;if(_!=null){const m=r.find(({objectId:$})=>$===_),S=o.length===0;a!=null&&a.stop===m||(a={stop:m,directions:[],open:S},o.push(a));continue}if(a==null)continue;const v=s.find(({directionPointId:m})=>m===p);v!=null&&a.directions.push({directionPoint:u,directionLine:v})}return o}_renderManeuverSections(){return this._sections==null?null:i("div",{class:n.maneuvers,role:"group"},this._sections.map((e,t)=>{const{open:s}=e;let r;e.directions.length>0&&s&&(r=i("ol",{class:n.maneuverList},e.directions.map(v=>this._renderManeuver(v))));const o=this._sections.length>2,a=t===this._sections.length-1,u={[n.collapsibleSection]:o},p={[C.down]:!s,[C.up]:s};let _;if(o&&!a){const v=s?this.messagesCommon.close:this.messagesCommon.open;_=i("header",{class:this.classes(n.maneuverSectionHeader,n.maneuverSectionToggle),key:n.maneuverSectionHeader},i("div",{"aria-expanded":s.toString(),"aria-label":v,bind:this,class:n.maneuverSectionHeaderButton,"data-maneuver-section":e,onclick:this._handleSectionToggle,onkeydown:this._handleSectionToggle,role:"button",tabIndex:0,title:v},i(R,{class:n.maneuverSectionTitle,level:this.headingLevel},e.stop.name),i("span",{"aria-hidden":"true",class:this.classes(p)})))}else _=i("header",{class:n.maneuverSectionHeader,key:n.maneuverSectionHeader},i(R,{class:n.maneuverSectionTitle,level:this.headingLevel},e.stop.name));return i("section",{class:this.classes(n.maneuverSection,u),key:t},_,r)}))}_handleSectionToggle(e){const t=Ge(e.currentTarget);t&&(t.open=!t.open)}_renderCosts(){const e=this._getCostSummary(),{directionPoints:t}=this.viewModel.layer;if(t==null||e==null)return null;const{distance:s,duration:r}=e,{primaryCosts:o,secondaryCosts:a,zoomToRoute:u}=this.messages,p=this._renderEta();return i("div",{"aria-label":u,bind:this,class:n.directionCosts,onclick:this._handleSummaryInteraction,onkeydown:this._handleSummaryInteraction,role:"button",tabIndex:0,title:u},i("div",{class:n.costsDetails,role:"group"},i("div",{class:n.primaryCosts,title:o},r),i("div",{class:n.verticalSplitter}),i("div",{class:n.secondaryCosts,title:a},s)),p)}_renderEta(){const{directionPoints:e}=this.viewModel.layer,{eta:t}=this.messages;if(e==null)return null;const s=e.at(-1).arrivalTime,r=ke("short-time");return s&&this._departureTimeOption!==y.UNSPECIFIED?i("div",{class:n.arrivalTimeContainer,title:t},i("span",{class:n.arrivalTime},De(s,r))," ",qe(s)):null}_handleSummaryInteraction(){this._activeManeuver=null,this._focusedManeuver=null,this.viewModel.clearHighlights(),this.zoomToRoute()}_getErrorMessage(){var e;switch((e=this.viewModel.lastError)==null?void 0:e.name){case"directions-view-model:unable-to-route":return this.messages.errors.unableToRoute;case"directions-view-model:service-metadata-unavailable":return this.messages.errors.unableToLoadServiceMetadata;default:return this.messages.errors.unknownError}}_normalizeSearchSources(e){this._overrideDefaultSources(e),this._applyLocatorSourceOverrides(e)}_overrideDefaultSources(e){e.viewModel.defaultSources.forEach(t=>{t.autoNavigate=!1})}_applyLocatorSourceOverrides({allSources:e}){for(const t of e)"url"in t&&t.url&&(t.locationType??(t.locationType="street"),Re(t.url)&&this.apiKey&&t.apiKey==null&&(t.apiKey=this.apiKey,t.url=Ae))}_disposeSearch(e){if(!e||!this._stopsToSearches.has(e))return;const t=this._stopsToSearches.get(e);this.removeHandles(t),t.destroy(),this._stopsToSearches.delete(e)}_renderManeuver(e){const{directionPoint:t,directionLine:s}=e,{distance:r,duration:o}=s,{messages:a,messagesUnits:u,unit:p}=this,_=te(u,r??0,p),v=se(o??0),m=_&&v?`${_}&nbsp;&middot;&nbsp;${v}`:`${_}${v}`,S=this._getFormattedManeuverText(t),{objectId:$,directionPointType:L}=t,H=Ke(L),z=`esri-directions__maneuver-${$}`,I=`esri-directions__intermediate-costs-${$}`,N={[n.maneuverActive]:this._activeManeuver===s};return i("li",{"aria-labelledby":`${z} ${I}`,bind:this,class:this.classes(n.maneuver,N),"data-maneuver":s,key:s,onblur:this._handleManeuverBlur,onclick:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onkeydown:this._handleManeuverClick,onmouseout:this._handleManeuverMouseOut,onmouseover:this._handleManeuverMouseOver,tabIndex:0},H?i("calcite-icon",{alt:"",class:n.maneuverIcon,icon:H}):null,i("div",{class:n.maneuverCostsContainer},i("span",{id:z,innerHTML:S??""}),i("div",{class:n.maneuverCosts},i("div",{class:n.horizontalSplitter}),i("div",{"aria-hidden":"true",class:n.intermediateCost,id:I,innerHTML:m,title:a.intermediateCosts}))))}_handleManeuverClick(e){const t=W(e.currentTarget);if(!t)return;if(this._activeManeuver===t)return this._activeManeuver=null,void this.zoomToRoute();this._activeManeuver=t;const{geometry:s}=t;this.viewModel.centerAt(s),this.viewModel.highlight(t)}_handleManeuverMouseOver(e){if(this._activeManeuver||this._focusedManeuver)return;const t=W(e.currentTarget);t&&this.viewModel.highlight(t)}_handleManeuverMouseOut(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()}_handleManeuverBlur(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())}_handleManeuverFocus(e){if(this._activeManeuver)return;const t=W(e.currentTarget);t&&(this._focusedManeuver=t,this.viewModel.highlight(t))}_getFormattedManeuverText(e){const{displayText:t,name:s,intersectingName:r}=e;if(t==null)return"";let o=t;return s!=null&&o.includes(s)&&(o=o.replace(s,`<strong>${s}</strong>`)),r!=null&&o.includes(r)&&(o=o.replace(r,`<strong>${r}</strong>`)),o}_getCostSummary(){const{messagesUnits:e,unit:t,viewModel:s}=this,{routeInfo:r}=s.layer;if(r==null)return null;const o=r.totalDistance??0,a=r.totalDuration??0;return{distance:te(e,o,t),duration:se(a)}}async _getDirections(){var t;const e=(t=this.viewModel.layer)==null?void 0:t.stops.filter(({geometry:s})=>s!=null);if(e&&!(e.length<2))try{await this.viewModel.getDirections()}catch{}}};c([d()],h.prototype,"apiKey",null),c([d(Ie)],h.prototype,"defaultUnit",void 0),c([d()],h.prototype,"goToOverride",null),c([d()],h.prototype,"headingLevel",void 0),c([d()],h.prototype,"iconClass",void 0),c([d()],h.prototype,"icon",void 0),c([d()],h.prototype,"label",null),c([d({readOnly:!0})],h.prototype,"lastRoute",null),c([d()],h.prototype,"layer",null),c([d()],h.prototype,"maxStops",null),c([d(),O("esri/widgets/Directions/t9n/Directions")],h.prototype,"messages",void 0),c([d(),O("esri/t9n/common")],h.prototype,"messagesCommon",void 0),c([d(),O("esri/core/t9n/Units")],h.prototype,"messagesUnits",void 0),c([d()],h.prototype,"searchProperties",void 0),c([d()],h.prototype,"unit",null),c([d()],h.prototype,"view",null),c([d({type:he})],h.prototype,"viewModel",void 0),c([d()],h.prototype,"visibleElements",void 0),c([Me("visibleElements")],h.prototype,"castVisibleElements",null),c([A()],h.prototype,"_handleStopIconClick",null),c([A()],h.prototype,"_handleClearRouteClick",null),c([A()],h.prototype,"_handleReverseStops",null),c([A()],h.prototype,"_handleRemoveStop",null),c([A()],h.prototype,"_handleSectionToggle",null),c([A()],h.prototype,"_handleSummaryInteraction",null),c([A()],h.prototype,"_handleManeuverClick",null),h=c([J("esri.widgets.Directions")],h);const wt=h;function je(e){return e==null?void 0:e["data-mode"]}function q(e){return e==null?void 0:e["data-stop-index"]}function Ge(e){return e==null?void 0:e["data-maneuver-section"]}function W(e){return e==null?void 0:e["data-maneuver"]}export{wt as default};

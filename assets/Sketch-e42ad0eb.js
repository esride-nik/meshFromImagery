import{a5 as n,a6 as l,a9 as M,bA as D,iq as H,gl as I,kq as ae,nQ as W,nR as ce,nS as pe,nT as ue,_ as E,bg as X,dU as de,dT as he,dm as ve,eL as ye,dS as _e,V as Y,cb as B,gk as G,kn as x,an as L,hQ as U,eU as me,dr as j,cc as ge,b9 as we,h1 as be}from"./index-b516d057.js";import{e as A,O as Z,r as ee,n as a,i as te,Q as q}from"./jsxFactory-92036771.js";import{a as oe}from"./SketchViewModel-fedf7932.js";import{l as se,a as ie,w as fe,_ as Te}from"./SnappingControls-5de1618f.js";import{e as F}from"./globalCss-94006b67.js";import{r as Q}from"./layerUtils-437666a3.js";import{i as N}from"./layerViewUtils-6ebe90f4.js";import{o as Oe,r as Ce}from"./drapedUtils-5cffceb9.js";import{e as Me}from"./vmEvent-d773b6c5.js";import"./uuid-709b6c67.js";import"./elevationInfoUtils-be36d866.js";import"./geodesicUtils-822c19ca.js";import"./screenUtils-8dc4a7f9.js";import"./signal-51ed66f5.js";import"./snappingUtils-93e84fbe.js";import"./dehydratedPoint-5a1dfed5.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./SketchTooltipOptions-cc43c059.js";import"./SnappingManager-aa70fdd4.js";import"./UpdatingHandles-7949a657.js";import"./geometry2dUtils-a99dcf3d.js";import"./FeatureFilter-55dd341e.js";import"./floorFilterUtils-080a7cd2.js";import"./viewUtils-9f810d02.js";import"./hitTestSelectUtils-d512707e.js";import"./layerListUtils-a0f5e0ab.js";import"./LayerListViewModel-3e44a2f6.js";import"./ListItem-5ca108fc.js";import"./widget-826a6ea9.js";let b=class extends D{constructor(t){super(t),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0}};n([l({type:Boolean,nonNullable:!0})],b.prototype,"point",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"polyline",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"polygon",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"rectangle",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"circle",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"multipoint",void 0),n([l({type:Boolean,nonNullable:!0})],b.prototype,"mesh",void 0),b=n([M("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],b);let $=class extends D{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}};n([l({nonNullable:!0})],$.prototype,"rectangle-selection",void 0),n([l({nonNullable:!0})],$.prototype,"lasso-selection",void 0),n([l({nonNullable:!0})],$.prototype,"custom-selection",void 0),$=n([M("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],$);let m=class extends D{constructor(e){super(e),this.createTools=new b,this.duplicateButton=!0,this.selectionTools=new $,this.settingsMenu=!0,this.sketchTooltipControls=!0,this.sketchTooltipControlsElements=new se,this.snappingControls=!0,this.snappingControlsElements=new ie,this.undoRedoMenu=!0}};n([l({type:b,nonNullable:!0})],m.prototype,"createTools",void 0),n([l({type:Boolean,nonNullable:!0})],m.prototype,"duplicateButton",void 0),n([l({type:$,nonNullable:!0})],m.prototype,"selectionTools",void 0),n([l({type:Boolean,nonNullable:!0})],m.prototype,"settingsMenu",void 0),n([l({type:Boolean,nonNullable:!0})],m.prototype,"sketchTooltipControls",void 0),n([l({type:se,nonNullable:!0})],m.prototype,"sketchTooltipControlsElements",void 0),n([l({type:Boolean,nonNullable:!0})],m.prototype,"snappingControls",void 0),n([l({type:ie,nonNullable:!0})],m.prototype,"snappingControlsElements",void 0),n([l({type:Boolean,nonNullable:!0})],m.prototype,"undoRedoMenu",void 0),m=n([M("esri.widgets.Sketch.VisibleElements")],m);const ne=m;async function Se(){return E(()=>import("./geometryEngineJSON-1bbfc398.js"),["assets/geometryEngineJSON-1bbfc398.js","assets/geometryEngineBase-dfbd3a67.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/geometryEngineJSON-53aa2407.js","assets/json-48e3ea08.js"])}async function $e(){return Se().then(({contains:e,intersects:t,overlaps:o,simplify:s})=>({contains:e,intersects:t,overlaps:o,simplify:s}))}async function le(e){const{currentSelection:t,options:o,selector:s,signal:i,sources:r,view:c}=e;if(!(r!=null&&r.length))return{added:[],removed:[]};const{layers:u,layerViews:y,graphicsLayers:_}=Ge(r),f=(await H(Promise.all([Be(s,u,c,i),Ee(s,y,c,i),ke(s,_,o,c)]),i)).flat();if(!t)return{added:f,removed:[]};const T=f.filter(C=>J(t.toArray(),C)),O=t.filter(C=>J(f,C)).toArray();return t.removeMany(O),t.addMany(T),{added:T,removed:O}}const ke=async(e,t,o,s)=>xe({candidates:t.flatMap(i=>i.graphics.toArray())??[],selector:e,options:o,view:s}),Be=async(e,t,o,s)=>{const i=await I(Ne({selector:e,signal:s,layers:t,view:o}));return i?i.filter(r=>r.status==="fulfilled").flatMap(r=>r.value):[]},Ee=async(e,t,o,s)=>{const i=await I(Re({selector:e,signal:s,layerViews:t,view:o}));return i?i.filter(r=>r.status==="fulfilled").flatMap(r=>r.value):[]};function Ge(e){const t=[],o=[],s=[];return e.forEach(i=>{var r,c;ae(i)?t.push(i):W(i)&&((r=i.layers)!=null&&r.length)?t.push(...i.layers.toArray()):ce(i)&&((c=i.sublayers)!=null&&c.length)?s.push(...i.sublayers.toArray()):pe(i)?s.push(i):N(i)&&o.push(i)}),{layers:t,layerViews:o,graphicsLayers:s}}function J(e,t){const o=e.includes(t),s=t.getObjectId(),i=s!=null,r=e.some(c=>{const u=t.layer===c.layer,y=i&&c.getObjectId()===s,_=t.uid===c.uid;return u&&(y||_)});return!o&&!r}async function Re(e){const{layerViews:t,selector:o,signal:s,view:i}=e;return H(Promise.allSettled(t.map(async r=>{const c=r.createQuery(),{outFields:u,geometry:y}=re(o,r.layer,i);return c.outFields=u,c.geometry=y,c.returnGeometry=!0,c.outSpatialReference=i.spatialReference,r.queryFeatures(c,{signal:s}).then(({features:_})=>_)})),s)}async function Ne(e){const{layers:t,selector:o,signal:s,view:i}=e;return H(Promise.allSettled(t.map(async r=>r.queryFeatures(Ie(r.createQuery(),o,r,i),{signal:s}).then(({features:c})=>c))),s)}function re(e,t,o){const s="displayField"in t?t.displayField:null,i=ue({displayField:s,fields:t.fields}),r=[t.objectIdField];i!=null&&t.fieldsIndex.has(i)&&r.push(i);const c="renderer"in t?Oe({renderer:t.renderer}):0;return{geometry:e.type==="point"?Ce(e,c,o):e,outFields:r}}function Ie(e,t,o,s){const{outFields:i,geometry:r}=re(t,o,s);return e.outFields=i,e.geometry=r,e.returnGeometry=!0,e.outSpatialReference=s.spatialReference,e}async function xe(e){const{selector:t,candidates:o,options:s,view:i}=e;if(!(o!=null&&o.length)||!t||!s)return[];const{overlaps:r,intersects:c,contains:u}=s,{spatialReference:y}=i,_=t,f=await $e();return o.filter(T=>{const O=T.geometry,C=r&&f.overlaps(y,_,O),k=c&&f.intersects(y,_,O),R=u&&f.contains(y,_,O);return C||k||R})}const Le=100;let g=class extends X.EventedAccessor{constructor({options:e,view:t}){super(),this._abortController=null,this._activeOptions=null,this._completed=!1,this._dashedFillSymbol=new de({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new he({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={createTool:"rectangle",selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._processSelectionGeometry=async({canceled:u,completed:y,selector:_})=>{const{_activeOptions:f,sources:T,selection:O,view:C}=this;if(this._abortController&&this._abortController.abort(),(y||u)&&(this._completed=!0),u)return void this._onComplete([],!0);if(!_||!(T!=null&&T.length)||!C)return void O.removeAll();const k=new AbortController;this._abortController=k;const{added:R,removed:z}=await le({currentSelection:O,sources:T,options:f.selectionOptions,selector:_,signal:k.signal,view:C});this._abortController===k&&(this._abortController=null),k.signal.aborted||(y?this._onComplete(this.selection.toArray(),!1):(R.length||z.length)&&this.emit("selection-change",{added:R,removed:z,type:"selection-change"}))},this._processDebounced=ve(this._processSelectionGeometry,Le),this._sketchViewModel=new oe,this._sketchGraphicsLayer=new ye({listMode:"hide",internal:!0}),this._transparentPointSymbol=new _e({color:[0,0,0,0],outline:{style:"none",width:0}}),this.options=null,this.selection=new Y,this.sources=null,this.options=e,this.view=t;const{_dashedFillSymbol:o,_dashedLineSymbol:s,_sketchViewModel:i,_sketchGraphicsLayer:r,_transparentPointSymbol:c}=this;i.set({layer:r,activePointSymbol:c,activeLineSymbol:s,activeVertexSymbol:c,activeFillSymbol:o,pointSymbol:c,polygonSymbol:o,polylineSymbol:s,vertexSymbol:c,view:t}),this.addHandles([i.on("create",u=>this._onSketchEvent(u)),i.on(["undo","redo"],u=>this._onSketchEvent(u)),i.watch("activeComponent.forceUniformSize",()=>this._onSketchGeometryChange())])}initialize(){this._load()}set cursor(e){var o;const t=(o=this._sketchViewModel)==null?void 0:o.activeComponent;(t==null?void 0:t.type)!=="draw-2d"&&(t==null?void 0:t.type)!=="draw-3d"||(t.cursor=e),this._set("cursor",e)}get state(){const{_completed:e,_sketchViewModel:{state:t}}=this;return e?"complete":t==="active"?"active":"disabled"}set view(e){this._sketchViewModel.view=e,this._set("view",e)}cancel(){return this._sketchViewModel.cancel()}async _load(){var r,c,u;await((r=this.view)==null?void 0:r.whenReady());const{_defaultOptions:e,options:t}=this,o=((c=t==null?void 0:t.createOptions)==null?void 0:c.cursor)||this.cursor||((u=e.createOptions)==null?void 0:u.cursor),{createTool:s,createOptions:i}=this._activeOptions={...e,...t,createOptions:{...e.createOptions,cursor:o,...t==null?void 0:t.createOptions},selectionOptions:{...e.selectionOptions,...t==null?void 0:t.selectionOptions}};this._sketchViewModel.create(s,i)}_onSketchEvent(e){const t=e.type==="create"?e.graphic:e.graphics[0],o=t==null?void 0:t.geometry,s=e.type==="create"&&e.state==="cancel",i=e.type==="create"&&e.state==="complete";I(this._processDebounced({canceled:s,completed:i,selector:o}))}_onSketchGeometryChange(){const e=this._sketchViewModel.createGraphic,t=e==null?void 0:e.geometry;t&&I(this._processDebounced({canceled:!1,completed:!1,selector:t}))}_onComplete(e,t){this.removeAllHandles(),this.notifyChange("state"),this.emit("complete",{aborted:t,selection:e,type:"complete"})}};n([l()],g.prototype,"_abortController",void 0),n([l()],g.prototype,"_completed",void 0),n([l()],g.prototype,"cursor",null),n([l()],g.prototype,"options",void 0),n([l({readOnly:!0})],g.prototype,"selection",void 0),n([l()],g.prototype,"sources",void 0),n([l({readOnly:!0})],g.prototype,"state",null),n([l()],g.prototype,"view",null),g=n([M("esri.widgets.support.Selector2D.SelectionOperation2D")],g);const De=g;let S=class extends D{constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.cursor=null,this.options=null,this.sources=null,this.view=null}draw(e){const{operationOptions:t}=e,{view:o}=this;return new De({cursor:this.cursor,sources:e.sources??this.sources??[],options:{...t,selectionOptions:{...this._defaultSelectionOptions,...this.options,...t==null?void 0:t.selectionOptions}},view:o})}async selectionFrom(e){const{view:t}=this,o=e.sources??this.sources??[];if(!o.length||!t)return[];const s=new Y;return await le({selector:e.geometry,currentSelection:s,sources:o,options:{...this._defaultSelectionOptions,...this.options,...e.selectionOptions},view:t}),s.toArray()}};n([l()],S.prototype,"cursor",void 0),n([l()],S.prototype,"options",void 0),n([l()],S.prototype,"sources",void 0),n([l()],S.prototype,"view",void 0),S=n([M("esri.widgets.support.Selector2D")],S);const Pe=S;let w=class extends X.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.selector=new Pe,this.sources=null}initialize(){this.addHandles([B(()=>this._sources,e=>{this.selector.sources=e,this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this._operationHandlesGroup=G(this._operationHandlesGroup),this.selector.destroy()}get _sources(){const{sources:e,view:t}=this;return t&&(e!=null&&e.length)?e.flatMap(o=>{if(N(o))return o;if(W(o)){const i=o.layers||[],r=i.map(c=>{const u=Q(t,c)||void 0;return N(u)?u:c});return r.length?r.toArray():i.length?i.toArray():o}const s=Q(t,o)||void 0;return N(s)?s:o}):[]}set cursor(e){this.activeOperation&&(this.activeOperation.cursor=e),this.selector.cursor=e,this._set("cursor",e)}get layers(){return x(L.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){x(L.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){var e;return this.activeOperation?"active":(e=this.view)!=null&&e.ready&&this._sources.length?"ready":"disabled"}set view(e){this.selector.view=e,this._set("view",e)}async selectionFrom(e,t){const{_sources:o}=this;return this.view&&o.length?this.selector.selectionFrom({geometry:e,selectionOptions:t,sources:o}):[]}cancel(){var e;this.state==="active"&&((e=this.activeOperation)==null||e.cancel(),this._set("activeOperation",null))}activate(e){const{_sources:t,state:o}=this;if(o==="disabled"||!(t!=null&&t.length))return;o==="active"&&this.cancel();const s=this.selector.draw({sources:t,operationOptions:e});return this._operationHandlesGroup=U([s.once("complete",i=>this._onOperationComplete(i)),s.on("selection-change",i=>this._onOperationSelectionChange(i))]),this._set("activeOperation",s),s}_onOperationSelectionChange(e){this.emit("selection-change",e)}_onOperationComplete(e){this._operationHandlesGroup=G(this._operationHandlesGroup),this._set("activeOperation",null),this.emit("complete",e)}};n([l()],w.prototype,"_sources",null),n([l({readOnly:!0})],w.prototype,"activeOperation",void 0),n([l()],w.prototype,"cursor",null),n([l()],w.prototype,"layers",null),n([l({readOnly:!0})],w.prototype,"selector",void 0),n([l()],w.prototype,"sources",void 0),n([l({readOnly:!0})],w.prototype,"state",null),n([l()],w.prototype,"view",null),w=n([M("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],w);const Ve=w,K={lassoTool:!0,rectangleTool:!0},Ae={createTool:"polygon",createOptions:{mode:"freehand"}},Fe={createTool:"rectangle"},P="esri-selection-toolbar",V={base:P,widgetIcon:te.vertexGps,container:`${P}__container`,toolButton:`${P}__tool-button`};let v=class extends Z{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.messages=null,this.toolConfigs=[],this.viewModel=new Ve,this.visibleElements={...K},this._viewModelHandlesGroup=U([this.viewModel.on("selection-change",o=>this.emit("selection-change",o)),this.viewModel.on("complete",o=>{this._set("activeToolInfo",null),this.emit("complete",o)})])}destroy(){this._viewModelHandlesGroup=G(this._viewModelHandlesGroup)}loadDependencies(){return ee({action:()=>E(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),icon:()=>E(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"])})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return x(L.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){x(L.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...K,...e}}get visibleToolCount(){const{view:e,toolConfigs:t,visibleElements:o}=this;return((t==null?void 0:t.length)??0)+((e==null?void 0:e.type)==="2d"?(o.lassoTool?1:0)+(o.rectangleTool?1:0):0)}activate(e){switch(this.cancel(),e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return a("div",{"aria-label":this.label,class:this.classes(V.base,F.widget)},a("div",{class:V.container},this._renderDefaultTools(),this._renderCustomTools()))}_renderDefaultTools(){var e;if(((e=this.view)==null?void 0:e.type)==="2d")return[this._renderRectangleTool(),this._renderLassoTool()]}_renderCustomTools(){var e;if((e=this.toolConfigs)!=null&&e.length)return this.toolConfigs.map(t=>{var o;return a("calcite-action",{active:((o=this.activeToolInfo)==null?void 0:o.toolName)===t.toolName,bind:this,class:V.toolButton,label:t.toolName,onclick:()=>this._onCustomToolClick(t.toolName),scale:"s",text:t.toolName,title:t.toolName},a("calcite-icon",{icon:t.icon||"selection",scale:"s"}))})}_renderLassoTool(){const{activeToolInfo:e,messages:t,visibleElements:o}=this;if(o.lassoTool)return a("calcite-action",{active:(e==null?void 0:e.toolName)==="lasso",bind:this,label:t.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:t.selectByLasso,title:t.selectByLasso},a("calcite-icon",{icon:"lasso-select",scale:"s"}))}_renderRectangleTool(){const{activeToolInfo:e,messages:t,visibleElements:o}=this;if(o.rectangleTool)return a("calcite-action",{active:(e==null?void 0:e.toolName)==="rectangle",bind:this,label:t.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:t.selectByRectangle,title:t.selectByRectangle},a("calcite-icon",{icon:"cursor-marquee",scale:"s"}))}_onCustomToolClick(e){this._toggleTool(e)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(e){const t=this._getToolOptions(e);if(!t)return;const o=this.viewModel.activate(t);o&&this._set("activeToolInfo",{toolName:e,operation:o})}_toggleTool(e){if(this.activeToolInfo){const t=this.activeToolInfo.toolName;if(this.cancel(),t===e)return}this._activateTool(e)}_getToolOptions(e){if(e==="lasso")return Ae;if(e==="rectangle")return Fe;const t=this.toolConfigs.find(r=>r.toolName===e);if(!t)return;const{createTool:o,createOptions:s,selectionOptions:i}=t;return{createTool:o,createOptions:s,selectionOptions:i}}};n([l({readOnly:!0})],v.prototype,"activeToolInfo",void 0),n([l()],v.prototype,"label",null),n([l()],v.prototype,"layers",null),n([l(),A("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],v.prototype,"messages",void 0),n([l()],v.prototype,"sources",null),n([l()],v.prototype,"toolConfigs",void 0),n([l()],v.prototype,"view",null),n([l()],v.prototype,"viewModel",void 0),n([l()],v.prototype,"visibleElements",void 0),n([me("visibleElements")],v.prototype,"castVisibleElements",null),n([l()],v.prototype,"visibleToolCount",null),v=n([M("esri.widgets.support.SelectionToolbar")],v);const He=v,h="esri-sketch",d={base:h,widgetIcon:te.edit,verticalLayout:`${h}--vertical`,panel:`${h}__panel`,infoPanel:`${h}__info-panel`,section:`${h}__section`,toolSection:`${h}__tool-section`,infoSection:`${h}__info-section`,infoCountSection:`${h}__info-count-section`,menuContainer:`${h}__menu-container`,menuHeader:`${h}__menu-header`,menuTitle:`${h}__menu-title`,featureCountBadge:`${h}__feature-count-badge`,featureCountText:`${h}__feature-count-text`,featureCountNumber:`${h}__feature-count-number`,actionToggle:`${h}__action-toggle`,actionToggleOn:`${h}__action-toggle--on`,actionTitle:`${h}__item-action-title`,actionIcon:`${h}__item-action-icon`};let p=class extends Z{constructor(e,t){super(e,t),this._activeCreateOptions=null,this._menuOpen=!1,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.creationMode="continuous",this.iconClass=d.widgetIcon,this.icon=null,this.layout="horizontal",this.messages=null,this.messagesCommon=null,this.visibleElements=new ne,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=(e==null?void 0:e.viewModel)||new oe}initialize(){const{layer:e,view:t}=this,o=new He({view:(t==null?void 0:t.type)==="2d"?t:null,sources:e?[e]:null});this.addHandles([B(()=>this.viewModel,s=>{this._viewModelHandlesGroup=G(this._viewModelHandlesGroup),s&&(this._viewModelHandlesGroup=U([s.on("create",i=>{this.scheduleRender(),this._onCreateOperation(i)}),s.on("update",()=>this.scheduleRender()),s.on("delete",i=>this.emit("delete",i)),s.on("undo",()=>this.scheduleRender()),s.on("redo",()=>this.scheduleRender()),B(()=>s.layer,i=>{this._selectionToolbar&&(this._selectionToolbar.sources=i?[i]:null)}),B(()=>s.view,i=>{this._selectionToolbar&&(this._selectionToolbar.view=(i==null?void 0:i.type)==="2d"?i:null)}),B(()=>s.state,()=>this.notifyChange("state"))]))},j),ge(()=>o.activeToolInfo,()=>this.viewModel.cancel()),o.on("complete",s=>this._onSelectionOperationComplete(s)),B(()=>{const{selectionTools:s}=this.visibleElements;return{lassoTool:!!(s!=null&&s["lasso-selection"]),rectangleTool:!!(s!=null&&s["rectangle-selection"])}},s=>{Object.assign(o.visibleElements,s)},j)]),this._selectionToolbar=o}loadDependencies(){return ee({action:()=>E(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),icon:()=>E(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"])})}destroy(){var e;(e=this._selectionToolbar)==null||e.destroy(),this._viewModelHandlesGroup=G(this._viewModelHandlesGroup)}get activeTool(){var t;const e=(t=this._selectionToolbar)==null?void 0:t.activeToolInfo;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}return this.viewModel.activeTool}get createGraphic(){return this.viewModel.createGraphic}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){var e;return(e=this._selectionToolbar)!=null&&e.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&we(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,visibleElements:t}=this;return e==null?void 0:e.filter(o=>{var s;return!!((s=t.createTools)!=null&&s[o])})}create(e,t){this._activeCreateOptions=t||null,this.viewModel.create(e,t)}update(e,t){return this.viewModel.update(e,t)}complete(){this.viewModel.complete()}cancel(){var e;(e=this._selectionToolbar)==null||e.cancel(),this.viewModel.cancel()}undo(){var e;this.viewModel.undo(),(e=this.view)==null||e.focus()}redo(){var e;this.viewModel.redo(),(e=this.view)==null||e.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}render(){const{label:e,layout:t,viewModel:{state:o}}=this;return a("div",{"aria-label":e,class:this.classes(d.base,F.widget,{[F.disabled]:o==="disabled",[d.verticalLayout]:t==="vertical"})},a("div",{class:d.panel,role:"toolbar"},this._renderTopPanelContents()),a("div",{class:this.classes(d.panel,d.infoPanel)},this._renderInfoPanelContents()))}_renderTopPanelContents(){var i;const e=this.classes(d.section,d.toolSection),{_effectiveAvailableCreateTools:t,visibleElements:o,viewModel:s}=this;return[s.updateOnGraphicClick||(i=this._selectionToolbar)!=null&&i.visibleToolCount?a("div",{class:e,key:"selection-button-container",role:"menu"},this._renderDefaultSelectionButton(),this._renderSelectionToolbar()):null,t!=null&&t.length?a("div",{class:e,role:"menu"},this._renderDrawButtons()):null,o.undoRedoMenu?a("div",{class:e,key:"undo-redo-menu-button-container",role:"menu"},this._renderUndoRedoMenuButtons()):null,o.settingsMenu?a("div",{class:d.section,key:"settings-menu-button-container"},this._renderSettingsMenuButton()):null]}_renderInfoPanelContents(){return this._menuOpen?this._renderSettingsMenu():this.updateGraphics.length?[a("div",{class:this.classes(d.section,d.infoSection,d.infoCountSection),key:"feature-count-container"},this._renderFeatureCount()),a("div",{class:this.classes(d.section,d.infoSection),key:"delete-button-container"},this._renderDuplicateButton(),this._renderDeleteButton())]:void 0}_renderSettingsMenu(){const{labelOptions:e,messagesCommon:t,snappingOptions:o,tooltipOptions:s,view:i,visibleElements:r}=this;return[a("div",{class:d.menuContainer,"data-testid":"menu",key:"settings-menu-container",role:"menu"},a("header",{class:d.menuHeader,key:"settings-menu-header"},a("span",{class:d.menuTitle},t.settings)),r.sketchTooltipControls?a(Te,{labelOptions:e,tooltipOptions:s,viewType:i==null?void 0:i.type,visibleElements:r.sketchTooltipControlsElements}):void 0,r.snappingControls&&i&&o?a(fe,{snappingOptions:o,view:i,visibleElements:r.snappingControlsElements}):void 0)]}_renderFeatureCount(){const{layout:e,messages:t,updateGraphics:{length:o}}=this,s=be(t.selectedCount,{count:o});return a("div",{"aria-label":s,class:d.featureCountBadge},a("span",{class:d.featureCountNumber},e==="vertical"?o:s))}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return;const e=this.messages,t=this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature;return a("calcite-action",{bind:this,label:t,onclick:this._onDuplicateSelect,scale:"s",text:t,title:t},a("calcite-icon",{icon:"copy",scale:"s"}))}_renderDeleteButton(){const e=this.messages,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return a("calcite-action",{bind:this,label:t,onclick:this.delete,scale:"s",text:t,title:t},a("calcite-icon",{icon:"trash",scale:"s"}))}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const e=this.messages.selectFeature;return a("calcite-action",{active:this.state==="ready",bind:this,label:e,onclick:this._activateDefaultSelectTool,scale:"s",text:e,title:e},a("calcite-icon",{icon:"cursor",scale:"s"}))}_renderSelectionToolbar(){var e;if(((e=this.view)==null?void 0:e.type)==="2d"&&this._selectionToolbar)return this._selectionToolbar.render()}_renderDrawButtons(){var e;return(e=this._effectiveAvailableCreateTools)==null?void 0:e.map(t=>{switch(t){case"point":return this._renderPointButton();case"polyline":return this._renderPolylineButton();case"polygon":return this._renderPolygonButton();case"rectangle":return this._renderRectangleButton();case"circle":return this._renderCircleButton();default:return}})}_renderPointButton(){const e="point",t=this.messages.drawPoint;return a("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},a("calcite-icon",{icon:"pin",scale:"s"}))}_renderPolygonButton(){const e="polygon",t=this.messages.drawPolygon;return a("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},a("calcite-icon",{icon:"polygon",scale:"s"}))}_renderPolylineButton(){const e="polyline",t=this.messages.drawPolyline;return a("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},a("calcite-icon",{icon:"line",scale:"s"}))}_renderCircleButton(){const e="circle",t=this.messages.drawCircle;return a("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},a("calcite-icon",{icon:"circle",scale:"s"}))}_renderRectangleButton(){const e="rectangle",t=this.messages.drawRectangle;return a("calcite-action",{active:this.activeTool===e,bind:this,label:t,onclick:()=>this._activateCreateTool(e),scale:"s",text:t,title:t},a("calcite-icon",{icon:"rectangle",scale:"s"}))}_renderUndoRedoMenuButtons(){return[this._renderUndoButton(),this._renderRedoButton()]}_renderUndoButton(){const e=this.messages.undo;return a("calcite-action",{bind:this,disabled:!this.viewModel.canUndo(),label:e,onclick:this.undo,scale:"s",text:e,title:e},a("calcite-icon",{icon:q(this.container)?"redo":"undo",scale:"s"}))}_renderRedoButton(){const e=this.messages.redo;return a("calcite-action",{bind:this,disabled:!this.viewModel.canRedo(),label:e,onclick:this.redo,scale:"s",text:e,title:e},a("calcite-icon",{icon:q(this.container)?"undo":"redo",scale:"s"}))}_renderSettingsMenuButton(){const e=this.messagesCommon.settings;return a("calcite-action",{active:this._menuOpen,bind:this,"data-testid":"settings-menu-action",label:e,onclick:this._toggleMenu,scale:"s",text:e,title:e},a("calcite-icon",{icon:"gear",scale:"s"}))}_activateCreateTool(e){var t;this.activeTool!==e?((t=this._selectionToolbar)==null||t.cancel(),this.create(e)):this.cancel()}_onCreateOperation(e){if(e.state!=="complete")return;const{creationMode:t}=this,{type:o}=e;if(o==="create"){const{tool:s,graphic:i}=e,r=this._activeCreateOptions;this._activeCreateOptions=null,t==="continuous"?this.create(s,r):t==="update"&&this.update([i])}}_toggleMenu(){this._menuOpen=!this._menuOpen,this.scheduleRender()}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;t!=="transform"&&t!=="reshape"||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:o}=e;if(!e.aborted&&o.length){const s=t.tool,i=o.length>1&&s==="reshape"?"transform":s;this.update(o,{...t,tool:i})}this.notifyChange("state")}_activateDefaultSelectTool(){var e;this.cancel(),(e=this.view)==null||e.focus()}};n([l()],p.prototype,"activeTool",null),n([l({cast:e=>{if(!(e!=null&&e.length))return null;const t=new Set(["point","polyline","polygon","rectangle","circle"]);return e.filter(o=>t.has(o))}})],p.prototype,"availableCreateTools",void 0),n([l({readOnly:!0})],p.prototype,"createGraphic",null),n([l()],p.prototype,"creationMode",void 0),n([l()],p.prototype,"defaultCreateOptions",null),n([l()],p.prototype,"defaultUpdateOptions",null),n([l()],p.prototype,"iconClass",void 0),n([l()],p.prototype,"icon",void 0),n([l()],p.prototype,"label",null),n([l()],p.prototype,"labelOptions",null),n([l()],p.prototype,"layer",null),n([l({type:["horizontal","vertical"]})],p.prototype,"layout",void 0),n([l(),A("esri/widgets/Sketch/t9n/Sketch")],p.prototype,"messages",void 0),n([l(),A("esri/t9n/common")],p.prototype,"messagesCommon",void 0),n([l()],p.prototype,"snappingOptions",null),n([l()],p.prototype,"state",null),n([l()],p.prototype,"tooltipOptions",null),n([l({readOnly:!0})],p.prototype,"updateGraphics",null),n([l()],p.prototype,"view",null),n([l(),Me(["create","update","undo","redo"])],p.prototype,"viewModel",null),n([l({type:ne,nonNullable:!0})],p.prototype,"visibleElements",void 0),n([l()],p.prototype,"_effectiveAvailableCreateTools",null),p=n([M("esri.widgets.Sketch")],p);const ft=p;export{ft as default};

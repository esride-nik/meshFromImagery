import{hh as d,M as D,D as R,B as O,C as b,E as V,fP as W,j as H,hi as cn,ez as fn}from"./index-b516d057.js";import{x as o,n as h,Q as U,K,X as Q,d as k,a as i,r as s,q as I,b as F,i as M,H as C,y as w,A as X,B as q,E,c as x,J as ln,S as on,T as dn,V as Y,N as L,Y as z,Z as wn,_ as J}from"./arcadeUtils-b244a3e5.js";import{c as P,r as j,a as m}from"./TimeOnly-879c5107.js";import{l as _}from"./portalUtils-a30ad7a3.js";import{disjoint as hn,intersects as mn,touches as pn,crosses as yn,within as gn,contains as vn,overlaps as Pn,equals as An,relate as In,intersect as Fn,union as xn,difference as Nn,symmetricDifference as Rn,clip as bn,cut as Sn,planarArea as G,geodesicArea as $,planarLength as Z,geodesicLength as B,distance as On,densify as nn,geodesicDensify as en,generalize as Dn,buffer as jn,geodesicBuffer as Mn,offset as Cn,rotate as rn,simplify as tn,isSimple as Ln,convexHull as zn,nearestCoordinate as Jn,nearestVertex as Zn}from"./geometryEngineAsync-5fa34d0d.js";import{n as an}from"./utils-969a0551.js";import"./ImmutableArray-ee1d0ce7.js";import"./number-2ab18aee.js";import"./featureConversionUtils-09cf00ff.js";import"./OptimizedFeature-e90b69df.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./OptimizedGeometry-196224d4.js";import"./FieldsIndex-e8db657f.js";import"./UnknownTimeZone-a05df022.js";import"./hash-6f442295.js";function sn(t){return cn.indexOf("4.")===0?b.fromExtent(t):new b({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function A(t,e,r){if(h(t,2,2,e,r),!(t[0]instanceof d&&t[1]instanceof d)){if(!(t[0]instanceof d&&t[1]===null)){if(!(t[1]instanceof d&&t[0]===null)){if(t[0]!==null||t[1]!==null)throw new i(e,s.InvalidParameter,r)}}}}async function un(t,e){if(t.type!=="polygon"&&t.type!=="polyline"&&t.type!=="extent")return 0;let r=1;(t.spatialReference.vcsWkid||t.spatialReference.latestVcsWkid)&&(r=wn(t.spatialReference)/fn(t.spatialReference));let c=0;if(t.type==="polyline")for(const n of t.paths)for(let a=1;a<n.length;a++)c+=J(n[a],n[a-1],r);else if(t.type==="polygon")for(const n of t.rings){for(let a=1;a<n.length;a++)c+=J(n[a],n[a-1],r);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(c+=J(n[0],n[n.length-1],r))}else t.type==="extent"&&(c+=2*J([t.xmin,t.ymin,0],[t.xmax,t.ymin,0],r),c+=2*J([t.xmin,t.ymin,0],[t.xmin,t.ymax,0],r),c*=2,c+=4*Math.abs(w(t.zmax,0)*r-w(t.zmin,0)*r));const l=new R({hasZ:!1,hasM:!1,spatialReference:t.spatialReference,paths:[[0,0],[0,c]]});return Z(l,e)}function $n(t){t.mode==="async"&&(t.functions.disjoint=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]===null||n[1]===null||hn(n[0],n[1])))},t.functions.intersects=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&mn(n[0],n[1])))},t.functions.touches=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&pn(n[0],n[1])))},t.functions.crosses=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&yn(n[0],n[1])))},t.functions.within=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&gn(n[0],n[1])))},t.functions.contains=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&vn(n[0],n[1])))},t.functions.overlaps=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]!==null&&Pn(n[0],n[1])))},t.functions.equals=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(h(n,2,2,e,r),n[0]===n[1]||(n[0]instanceof d&&n[1]instanceof d?An(n[0],n[1]):(U(n[0])&&U(n[1])||!!(K(n[0])&&K(n[1])||Q(n[0])&&Q(n[1])))&&n[0].equals(n[1]))))},t.functions.relate=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,3,3,e,r),n[0]instanceof d&&n[1]instanceof d)return In(n[0],n[1],k(n[2]));if(n[0]instanceof d&&n[1]===null||n[1]instanceof d&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new i(e,s.InvalidParameter,r)})},t.functions.intersection=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]===null||n[1]===null?null:Fn(n[0],n[1])))},t.functions.union=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{const a=[];if((n=o(n)).length===0)throw new i(e,s.WrongNumberOfParameters,r);if(n.length===1)if(I(n[0])){const u=o(n[0]);for(let f=0;f<u.length;f++)if(u[f]!==null){if(!(u[f]instanceof d))throw new i(e,s.InvalidParameter,r);a.push(u[f])}}else{if(!F(n[0])){if(n[0]instanceof d)return M(P(n[0]),e.spatialReference);if(n[0]===null)return null;throw new i(e,s.InvalidParameter,r)}{const u=o(n[0].toArray());for(let f=0;f<u.length;f++)if(u[f]!==null){if(!(u[f]instanceof d))throw new i(e,s.InvalidParameter,r);a.push(u[f])}}}else for(let u=0;u<n.length;u++)if(n[u]!==null){if(!(n[u]instanceof d))throw new i(e,s.InvalidParameter,r);a.push(n[u])}return a.length===0?null:xn(a)})},t.functions.difference=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:Nn(n[0],n[1])))},t.functions.symmetricdifference=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>(A(n=o(n),e,r),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):Rn(n[0],n[1])))},t.functions.clip=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[1]instanceof D)&&n[1]!==null)throw new i(e,s.InvalidParameter,r);if(n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return n[1]===null?null:bn(n[0],n[1])})},t.functions.cut=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[1]instanceof R)&&n[1]!==null)throw new i(e,s.InvalidParameter,r);if(n[0]===null)return[];if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return n[1]===null?[P(n[0])]:Sn(n[0],n[1])})},t.functions.area=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(C(n[0])){const a=await n[0].sumArea(j(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=X(n[0],e.spatialReference);return a===null?0:G(a,j(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return G(n[0],j(w(n[1],-1)))})},t.functions.areageodetic=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(C(n[0])){const a=await n[0].sumArea(j(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=X(n[0],e.spatialReference);return a===null?0:$(a,j(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return $(n[0],j(w(n[1],-1)))})},t.functions.length=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(C(n[0])){const a=await n[0].sumLength(m(w(n[1],-1)),!1,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=q(n[0],e.spatialReference);return a===null?0:Z(a,m(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return Z(n[0],m(w(n[1],-1)))})},t.functions.length3d=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(I(n[0])||F(n[0])){const a=q(n[0],e.spatialReference);return a===null?0:a.hasZ===!0?un(a,m(w(n[1],-1))):Z(a,m(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return n[0].hasZ===!0?un(n[0],m(w(n[1],-1))):Z(n[0],m(w(n[1],-1)))})},t.functions.lengthgeodetic=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(h(n,1,2,e,r),(n=o(n))[0]===null)return 0;if(C(n[0])){const a=await n[0].sumLength(m(w(n[1],-1)),!0,e.abortSignal);if(e.abortSignal.aborted)throw new i(e,s.Cancelled,r);return a}if(I(n[0])||F(n[0])){const a=q(n[0],e.spatialReference);return a===null?0:B(a,m(w(n[1],-1)))}if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return B(n[0],m(w(n[1],-1)))})},t.functions.distance=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{n=o(n),h(n,2,3,e,r);let a=n[0];(I(n[0])||F(n[0]))&&(a=E(n[0],e.spatialReference));let u=n[1];if((I(n[1])||F(n[1]))&&(u=E(n[1],e.spatialReference)),!(a instanceof d))throw new i(e,s.InvalidParameter,r);if(!(u instanceof d))throw new i(e,s.InvalidParameter,r);return On(a,u,m(w(n[2],-1)))})},t.functions.distancegeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{n=o(n),h(n,2,3,e,r);const a=n[0],u=n[1];if(!(a instanceof O))throw new i(e,s.InvalidParameter,r);if(!(u instanceof O))throw new i(e,s.InvalidParameter,r);const f=new R({paths:[],spatialReference:a.spatialReference});return f.addPath([a,u]),B(f,m(w(n[2],-1)))})},t.functions.densify=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);if(a<=0)throw new i(e,s.InvalidParameter,r);return n[0]instanceof b||n[0]instanceof R?nn(n[0],a,m(w(n[2],-1))):n[0]instanceof D?nn(sn(n[0]),a,m(w(n[2],-1))):n[0]})},t.functions.densifygeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);if(a<=0)throw new i(e,s.InvalidParameter,r);return n[0]instanceof b||n[0]instanceof R?en(n[0],a,m(w(n[2],-1))):n[0]instanceof D?en(sn(n[0]),a,m(w(n[2],-1))):n[0]})},t.functions.generalize=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,4,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);return Dn(n[0],a,ln(w(n[2],!0)),m(w(n[3],-1)))})},t.functions.buffer=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);return a===0?P(n[0]):jn(n[0],a,m(w(n[2],-1)))})},t.functions.buffergeodetic=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,3,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);return a===0?P(n[0]):Mn(n[0],a,m(w(n[2],-1)))})},t.functions.offset=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,2,6,e,r),n[0]===null)return null;if(!(n[0]instanceof b||n[0]instanceof R))throw new i(e,s.InvalidParameter,r);const a=x(n[1]);if(isNaN(a))throw new i(e,s.InvalidParameter,r);const u=x(w(n[4],10));if(isNaN(u))throw new i(e,s.InvalidParameter,r);const f=x(w(n[5],0));if(isNaN(f))throw new i(e,s.InvalidParameter,r);return Cn(n[0],a,m(w(n[2],-1)),k(w(n[3],"round")).toLowerCase(),u,f)})},t.functions.rotate=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{n=o(n),h(n,2,3,e,r);let a=n[0];if(a===null)return null;if(!(a instanceof d))throw new i(e,s.InvalidParameter,r);a instanceof D&&(a=b.fromExtent(a));const u=x(n[1]);if(isNaN(u))throw new i(e,s.InvalidParameter,r);const f=w(n[2],null);if(f===null)return rn(a,u);if(f instanceof O)return rn(a,u,f);throw new i(e,s.InvalidParameter,r)})},t.functions.centroid=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;let a=n[0];if((I(n[0])||F(n[0]))&&(a=E(n[0],e.spatialReference)),a===null)return null;if(!(a instanceof d))throw new i(e,s.InvalidParameter,r);return a instanceof O?M(P(n[0]),e.spatialReference):a instanceof b?a.centroid:a instanceof R?on(a):a instanceof V?dn(a):a instanceof D?a.center:null})},t.functions.multiparttosinglepart=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{n=o(n),h(n,1,1,e,r);const a=[];if(n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);if(n[0]instanceof O)return[M(P(n[0]),e.spatialReference)];if(n[0]instanceof D)return[M(P(n[0]),e.spatialReference)];const u=await tn(n[0]);if(u instanceof b){const f=[],y=[];for(let p=0;p<u.rings.length;p++)if(u.isClockwise(u.rings[p])){const g=W({rings:[u.rings[p]],hasZ:u.hasZ===!0,hazM:u.hasM===!0,spatialReference:u.spatialReference.toJSON()});f.push(g)}else y.push({ring:u.rings[p],pt:u.getPoint(p,0)});for(let p=0;p<y.length;p++)for(let g=0;g<f.length;g++)if(f[g].contains(y[p].pt)){f[g].addRing(y[p].ring);break}return f}if(u instanceof R){const f=[];for(let y=0;y<u.paths.length;y++){const p=W({paths:[u.paths[y]],hasZ:u.hasZ===!0,hazM:u.hasM===!0,spatialReference:u.spatialReference.toJSON()});f.push(p)}return f}if(n[0]instanceof V){const f=M(P(n[0]),e.spatialReference);for(let y=0;y<f.points.length;y++)a.push(f.getPoint(y));return a}return null})},t.functions.issimple=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return!0;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return Ln(n[0])})},t.functions.simplify=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return tn(n[0])})},t.functions.convexhull=function(e,r){return t.standardFunctionAsync(e,r,(c,l,n)=>{if(n=o(n),h(n,1,1,e,r),n[0]===null)return null;if(!(n[0]instanceof d))throw new i(e,s.InvalidParameter,r);return zn(n[0])})},t.functions.getuser=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{var y,p;h(n,0,2,e,r);let a=w(n[1],""),u=a===!0;if(a=a===!0||a===!1?"":k(a),n.length===0||n[0]instanceof Y){let g=null;g=(y=e.services)!=null&&y.portal?e.services.portal:H.getDefault(),n.length>0&&(g=_(n[0],g));const S=await an(g,a,u);if(S){const N=JSON.parse(JSON.stringify(S));for(const v of["lastLogin","created","modified"])N[v]!==void 0&&N[v]!==null&&(N[v]=new Date(N[v]));return L.convertObjectToArcadeDictionary(N,z(e))}return null}let f=null;if(C(n[0])&&(f=n[0]),f){if(u=!1,a)return null;await f.load();const g=await f.getOwningSystemUrl();if(!g){if(!a){const v=await f.getIdentityUser();return v?L.convertObjectToArcadeDictionary({username:v},z(e)):null}return null}let S=null;S=(p=e.services)!=null&&p.portal?e.services.portal:H.getDefault(),S=_(new Y(g),S);const N=await an(S,a,u);if(N){const v=JSON.parse(JSON.stringify(N));for(const T of["lastLogin","created","modified"])v[T]!==void 0&&v[T]!==null&&(v[T]=new Date(v[T]));return L.convertObjectToArcadeDictionary(v,z(e))}return null}throw new i(e,s.InvalidParameter,r)})}),t.functions.nearestcoordinate=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,r);if(!(n[1]instanceof O||n[1]===null))throw new i(e,s.InvalidParameter,r);if(n[0]===null||n[1]===null)return null;const a=await Jn(n[0],n[1]);return a===null?null:L.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},z(e),!1,!0)})},t.functions.nearestvertex=function(e,r){return t.standardFunctionAsync(e,r,async(c,l,n)=>{if(n=o(n),h(n,2,2,e,r),!(n[0]instanceof d||n[0]===null))throw new i(e,s.InvalidParameter,r);if(!(n[1]instanceof O||n[1]===null))throw new i(e,s.InvalidParameter,r);if(n[0]===null||n[1]===null)return null;const a=await Zn(n[0],n[1]);return a===null?null:L.convertObjectToArcadeDictionary({coordinate:a.coordinate,distance:a.distance},z(e),!1,!0)})}}export{$n as registerFunctions};

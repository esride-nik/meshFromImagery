import{V as ie,bg as ae,cb as v,h3 as A,a5 as d,a6 as g,a9 as se,eU as le,cd as J,_ as Q,h7 as oe}from"./index-b516d057.js";import{e as W,O as ce,r as de,n as o,i as I}from"./jsxFactory-92036771.js";import{k as U}from"./ListItem-5ca108fc.js";import{d as H}from"./layerListUtils-a0f5e0ab.js";import{e as L}from"./globalCss-94006b67.js";import{e as N,n as X}from"./Heading-92f210ca.js";import{t as M}from"./accessibleHandler-e91101b2.js";import{e as he}from"./vmEvent-d773b6c5.js";import{S as Y}from"./sortable.esm-0d19b1d3.js";import"./uuid-709b6c67.js";import"./widget-826a6ea9.js";const f={view:"view",basemap:"basemap",baseLayers:"base-layers",referenceLayers:"reference-layers",baseLayersListMode:"reference-layers-list-mode",referenceLayersListMode:"base-layers-list-mode",baseLayerViews:"base-layer-views",referenceLayerViews:"reference-layer-views",children:"children"},V=ie.ofType(U);let $=class extends ae.EventedAccessor{constructor(e){super(e),this.baseItems=new V,this.baseListItemCreatedFunction=null,this.checkPublishStatusEnabled=!1,this.referenceListItemCreatedFunction=null,this.referenceItems=new V,this.view=null,this._compileBaseList=this._compileBaseList.bind(this),this._compileReferenceList=this._compileReferenceList.bind(this)}initialize(){this.addHandles([v(()=>{var e,t,i,s;return[(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap,this.view,(i=this.view)==null?void 0:i.ready,(s=this.view)==null?void 0:s.basemapView]},()=>this._watchBasemapLayers(),A),v(()=>[this.baseListItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._baseListItemCreatedFunctionChanged()),v(()=>[this.referenceListItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._referenceListItemCreatedFunctionChanged())],f.view)}destroy(){this.view=null,this.baseItems.removeAll(),this.referenceItems.removeAll()}get basemapTitle(){var e,t,i;return((i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)==null?void 0:i.title)??null}set basemapTitle(e){this._override("basemapTitle",e)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":this.view?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}transferListItem({listItem:e,from:t,to:i,newIndex:s}){var C,k;const{referenceItems:n,baseItems:a}=this,{layer:l}=e,c=(k=(C=this.view)==null?void 0:C.map)==null?void 0:k.basemap,h=c==null?void 0:c.baseLayers,b=c==null?void 0:c.referenceLayers;if(!h||!b||t===i)return;const y=i==="reference"?n:a,_=t==="reference"?b:h,w=i==="reference"?b:h;(t==="reference"?n:a).remove(e),_.remove(l),y.add(e,s),w.add(l,s)}_createItemChangeHandles({items:e,key:t,callback:i}){this.removeHandles(t),i(),e&&this.addHandles(e.on("change",()=>i()),t)}_createListItem({layer:e,type:t}){const{view:i,baseListItemCreatedFunction:s,referenceListItemCreatedFunction:n,checkPublishStatusEnabled:a}=this;return new U({layer:e,checkPublishStatusEnabled:a,listItemCreatedFunction:t==="base"?s:n,view:i})}_watchLayersListMode({layers:e,key:t,callback:i}){this.removeHandles(t),e&&e.forEach(s=>{this.addHandles(v(()=>s.listMode,()=>i()),t)})}_compileListItems({layers:e,items:t,key:i,type:s,callback:n}){this._watchLayersListMode({layers:e,key:i,callback:n}),this._createNewItems({type:s,items:t,layers:e}),this._removeItems({items:t,layers:e}),this._sortItems(t,e)}_compileReferenceList(){var i,s,n;const{referenceItems:e}=this,t=(n=(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.basemap)==null?void 0:n.referenceLayers;this._compileListItems({type:"reference",layers:t,items:e,key:f.referenceLayersListMode,callback:this._compileReferenceList})}_compileBaseList(){var i,s,n;const{baseItems:e}=this,t=(n=(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.basemap)==null?void 0:n.baseLayers;this._compileListItems({type:"base",layers:t,items:e,key:f.baseLayersListMode,callback:this._compileBaseList})}_compileLists(){this._compileReferenceList(),this._compileBaseList()}_createNewItems({items:e,layers:t,type:i}){t&&t.forEach(s=>{e.find(n=>n.layer===s)||e.add(this._createListItem({type:i,layer:s}))})}_removeItems({items:e,layers:t}){e&&e.forEach(i=>{if(!i)return;(t==null?void 0:t.find(n=>i.layer===n))||(this.removeHandles(`${f.children}-${i.uid}`),e.remove(i))})}_sortItems(e,t){e&&t&&e.sort((i,s)=>{const n=t.indexOf(i.layer),a=t.indexOf(s.layer);return n>a?-1:n<a?1:0})}_removeAllBaseItems(){const{baseItems:e}=this;e.forEach(t=>{this.removeHandles(`${f.children}-${t.uid}`)}),e.removeAll()}_removeAllReferenceItems(){const{referenceItems:e}=this;e.forEach(t=>{this.removeHandles(`${f.children}-${t.uid}`)}),e.removeAll()}_baseListItemCreatedFunctionChanged(){this._removeAllBaseItems(),this._compileLists()}_referenceListItemCreatedFunctionChanged(){this._removeAllReferenceItems(),this._compileLists()}_watchBasemapLayers(){const{view:e}=this;this.removeHandles([f.baseLayers,f.referenceLayers,f.basemap,f.baseLayerViews,f.referenceLayerViews]),this._compileLists(),e&&e.ready&&this.addHandles([v(()=>{var t,i,s;return(s=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap)==null?void 0:s.baseLayers},t=>this._createItemChangeHandles({items:t,key:f.baseLayers,callback:this._compileBaseList}),A),v(()=>{var t,i,s;return(s=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap)==null?void 0:s.referenceLayers},t=>this._createItemChangeHandles({items:t,key:f.referenceLayers,callback:this._compileReferenceList}),A),v(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.basemapView)==null?void 0:i.baseLayerViews},t=>this._createItemChangeHandles({items:t,key:f.baseLayerViews,callback:this._compileBaseList}),A),v(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.basemapView)==null?void 0:i.referenceLayerViews},t=>this._createItemChangeHandles({items:t,key:f.referenceLayerViews,callback:this._compileReferenceList}),A)],f.basemap)}};d([g({type:V,readOnly:!0})],$.prototype,"baseItems",void 0),d([g()],$.prototype,"basemapTitle",null),d([g()],$.prototype,"baseListItemCreatedFunction",void 0),d([g()],$.prototype,"checkPublishStatusEnabled",void 0),d([g()],$.prototype,"referenceListItemCreatedFunction",void 0),d([g({type:V,readOnly:!0})],$.prototype,"referenceItems",void 0),d([g({readOnly:!0})],$.prototype,"state",null),d([g()],$.prototype,"view",void 0),d([g()],$.prototype,"transferListItem",null),$=d([se("esri.widgets.BasemapLayerList.BasemapLayerListViewModel")],$);const ne=$,me=ie.ofType(U);function Z(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const ue=".*\\S+.*",ee="root-layers",F="data-layer-uid",ge="layerUid",m="esri-basemap-layer-list",p=`${m}__item`,R=`${m}__list`,r={base:m,widgetIcon:I.layers,newUI:`${m}--new-ui`,titleContainer:`${m}__title-container`,mainHeading:`${m}__main-heading`,editingCard:`${m}__editing-card`,editingInput:`${m}__editing-input`,editingActions:`${m}__editing-actions`,editButton:`${m}__edit-button`,editButtonIcon:`${m}__edit-button-icon`,submitButton:`${m}__submit-button`,cancelButton:`${m}__cancel-button`,noItems:`${m}__no-items`,horizontalRule:`${m}__hr`,list:R,listHeading:`${R}-heading`,listRoot:`${R}--root`,listExclusive:`${R}--exclusive`,listEmpty:`${m}__list--empty`,listEmptyState:`${m}__list-empty-state`,listInherited:`${R}--inherited`,listIndependent:`${R}--independent`,item:p,itemOnlyChild:`${p}--only-child`,itemContent:`${p}-content`,itemMessage:`${p}--has-message`,itemInvisible:`${p}--invisible`,itemInvisibleAtScale:`${p}--invisible-at-scale`,itemChildren:`${p}--has-children`,itemSelectable:`${p}--selectable`,itemContainer:`${p}-container`,actionsMenu:`${p}-actions-menu`,actionsMenuItem:`${p}-actions-menu-item`,actionsMenuItemActive:`${p}-actions-menu-item--active`,actions:`${p}-actions`,actionsList:`${p}-actions-list`,action:`${p}-action`,actionIcon:`${p}-action-icon`,actionImage:`${p}-action-image`,actionTitle:`${p}-action-title`,actionToggle:`${m}__action-toggle`,actionToggleOn:`${m}__action-toggle--on`,label:`${p}-label`,message:`${p}-message`,title:`${p}-title`,statusIndicator:`${m}__status-indicator`,publishing:`${m}__publishing`,updating:`${m}__updating`,connectionStatus:`${m}__connection-status`,connectionStatusConnected:`${m}__connection-status--connected`,toggleVisible:`${p}-toggle`,toggleVisibleIcon:`${p}-toggle-icon`,toggleIcon:`${p}-toggle-icon`,radioIcon:`${p}-radio-icon`,childToggle:`${m}__child-toggle`,childToggleOpen:`${m}__child-toggle--open`,childOpened:`${m}__child-toggle-icon--opened`,childClosed:`${m}__child-toggle-icon--closed`,childClosed_RTL:`${m}__child-toggle-icon--closed-rtl`,sortableChosen:`${m}--chosen`},x={actions:"actions",actionSection:"action-section",baseItems:"base-items",referenceItems:"reference-items"},O={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function P(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach(s=>P(s))}const te={baseLayers:!0,referenceLayers:!0,statusIndicators:!0,errors:!1};let u=class extends ce{constructor(e,t){super(e,t),this._tooltipReferenceMap=new Map,this._editingTitle=!1,this._editTitleInput=null,this._editTitleButton=null,this._focusOnElement=null,this._sortableBaseLayers=null,this._sortableReferenceLayers=null,this._sortableBaseLayersNode=null,this._sortableReferenceLayersNode=null,this._focusSortUid=null,this.visibleItems=null,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=r.widgetIcon,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectedItems=new me,this.style="classic",this.viewModel=new ne,this.visibleElements={...te}}initialize(){const{baseItems:e,referenceItems:t}=this;this._setVisibleItems(),this.addHandles([v(()=>this.visibleElements,()=>{this._itemsChanged(e,x.baseItems),this._itemsChanged(t,x.referenceItems)}),J(()=>this.baseItems,"change",()=>{this._itemsChanged(e,x.baseItems)}),J(()=>this.referenceItems,"change",()=>this._itemsChanged(t,x.referenceItems)),v(()=>this.editingEnabled,()=>this._toggleSorting(),A)])}loadDependencies(){return de({icon:()=>Q(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),tooltip:()=>Q(()=>import("./calcite-tooltip-5cb74da1.js"),["assets/calcite-tooltip-5cb74da1.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"])})}destroy(){this._destroyBaseSortable(),this._destroyReferenceSortable(),this._tooltipReferenceMap.clear()}get basemapTitle(){return this.viewModel.basemapTitle}set basemapTitle(e){this.viewModel.basemapTitle=e}get baseListItemCreatedFunction(){return this.viewModel.baseListItemCreatedFunction}set baseListItemCreatedFunction(e){this.viewModel.baseListItemCreatedFunction=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get referenceListItemCreatedFunction(){return this.viewModel.referenceListItemCreatedFunction}set referenceListItemCreatedFunction(e){this.viewModel.referenceListItemCreatedFunction=e}get baseItems(){return this.viewModel.baseItems}get referenceItems(){return this.viewModel.referenceItems}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...te,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){const{state:e}=this.viewModel,t={[r.newUI]:this.style==="modern",[L.hidden]:e==="loading",[L.disabled]:e==="disabled"},i=this._renderItemTooltips(),s=this._renderReferenceSection(),n=this._renderBaseSection(),a=s&&n?o("hr",{class:r.horizontalRule}):null,l=[this._renderTitleContainer(),s,a,n];return o("div",{class:this.classes(r.base,L.widget,L.panel,t)},[i,l])}_renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?o("calcite-tooltip",{referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}_renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this._renderItemTooltip(e):null,...!t&&i?i.toArray().map(s=>this._renderItemTooltipNodes(s)):[]]}_renderItemTooltips(){var e;return((e=this.visibleItems)==null?void 0:e.toArray().map(t=>this._renderItemTooltipNodes(t)))??[]}_renderEditingInput(){const{messages:e}=this,{basemapTitle:t}=this.viewModel;return o("label",{class:r.editingInput},e.basemapTitle,o("input",{afterCreate:this._storeEditTitleInput,afterUpdate:this._focusEditElement,"aria-label":e.basemapTitle,bind:this,class:L.input,pattern:ue,placeholder:e.basemapTitle,required:!0,role:"textbox",title:e.basemapTitle,type:"text",value:t??void 0}))}_renderCancelButton(){const{messagesCommon:e}=this;return o("button",{"aria-label":e.cancel,bind:this,class:this.classes(L.button,L.buttonTertiary),onclick:this._toggleEditingTitle,title:e.cancel,type:"button"},e.cancel)}_renderSubmitButton(){const{messagesCommon:e}=this;return o("button",{"aria-label":e.form.submit,bind:this,class:L.button,title:e.form.submit,type:"submit"},e.form.ok)}_renderEditingForm(){return o("div",{class:r.editingCard},o("form",{bind:this,onsubmit:this._formSubmit},this._renderEditingInput(),o("div",{class:r.editingActions},this._renderCancelButton(),this._renderSubmitButton())))}_renderBasemapTitle(){const{basemapTitle:e}=this.viewModel;return o(N,{class:this.classes(L.heading,r.mainHeading),level:this.headingLevel},e)}_renderEditTitleButton(){const{_editingTitle:e,editingEnabled:t,messagesCommon:i}=this;return t&&!e?o("button",{afterCreate:this._storeEditTitleButton,afterUpdate:this._focusEditElement,"aria-label":i.edit,bind:this,class:r.editButton,"data-node-ref":"_editButtonNode",onclick:this._toggleEditingTitle,title:i.edit,type:"button"},o("span",{"aria-hidden":"true",class:this.classes(I.edit,r.editButtonIcon)})):null}_renderTitleContainer(){return o("div",{class:r.titleContainer},this._editingTitle?this._renderEditingForm():this._renderBasemapTitle(),this._renderEditTitleButton())}_renderNoLayersInfo(e,t){return o("div",{class:r.noItems,key:t},e)}_renderList(e,t){const{messages:i}=this,s=t==="reference"?this._destroyReferenceSortable:this._destroyBaseSortable;return o("ul",{afterCreate:this._sortNodeCreated,afterRemoved:s,"aria-label":i.widgetLabel,bind:this,class:this.classes(r.list,r.listRoot,r.listIndependent),"data-node-ref":t,key:t,role:this.editingEnabled&&e.length?"listbox":void 0},e.map(n=>this._renderItem({item:n,parent:null,itemType:t,isOnlyChild:e.length===1})))}_renderBaseHeader(){return o(N,{class:this.classes(L.heading,r.listHeading),key:"base-heading",level:X(this.headingLevel)},this.messages.baseHeading)}_renderBaseSection(){const{baseItems:e,messages:t,visibleElements:i}=this;if(!i.baseLayers)return null;const s=this._getItems(e),n="base";return[this._renderBaseHeader(),[s.length===0?this._renderNoLayersInfo(t.noBaseLayers,n):null,this._renderList(s,n)]]}_renderReferenceHeader(){return o(N,{class:this.classes(L.heading,r.listHeading),key:"reference-heading",level:X(this.headingLevel)},this.messages.referenceHeading)}_renderReferenceSection(){const{referenceItems:e,messages:t,visibleElements:i}=this;if(!i.referenceLayers)return null;const s=this._getItems(e),n="reference";return[this._renderReferenceHeader(),[s.length===0?this._renderNoLayersInfo(t.noReferenceLayers,n):null,this._renderList(s,n)]]}_renderChildrenToggle(e,t){const{messagesCommon:i}=this,{children:s}=e,n=!!e.error,a=!!s.length&&!n,l={[r.childToggleOpen]:e.open},c=e.open?i.collapse:i.expand;return a?o("span",{"aria-controls":t,"aria-label":c,class:this.classes(r.childToggle,l),"data-item":e,key:"toggle-children",onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,role:"button",tabIndex:0,title:c},o("span",{"aria-hidden":"true",class:this.classes(r.childClosed,I.rightTriangleArrow)}),o("span",{"aria-hidden":"true",class:this.classes(r.childOpened,I.downArrow)}),o("span",{"aria-hidden":"true",class:this.classes(r.childClosed_RTL,I.leftTriangleArrow)})):null}_renderItemMessage(e){return e.error?o("div",{class:r.message,key:"esri-basemap-layer-list__error",role:"alert"},o("span",{"aria-hidden":"true",class:I.noticeTriangle}),this.messages.layerError):e.incompatible?o("div",{class:r.message,key:"esri-basemap-layer-list__incompatible",role:"alert"},o("span",{afterCreate:t=>this._setTooltipReference(t,e),"aria-hidden":"true",bind:this,class:I.noticeTriangle,tabIndex:0}),this.messages.layerIncompatible):null}_renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[r.actionsMenuItemActive]:e.actionsOpen};return o("div",{"aria-controls":t,"aria-label":i.options,bind:this,class:this.classes(r.actionsMenuItem,s),"data-item":e,key:"actions-menu-toggle",onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,role:"button",tabIndex:0,title:i.options},o("span",{"aria-hidden":"true",class:I.handleHorizontal}))}_renderActionsMenu(e,t,i,s){const{panel:n}=e,a=n&&n.visible?this._renderPanelButton(n):null,l=i===1&&this._getSingleActionButton(t),c=l?this._renderAction({item:e,action:l,singleAction:!0}):null,h=!l&&i?this._renderActionsMenuIcon(e,s):null;return h||a||l?o("div",{class:r.actionsMenu,key:"actions-menu"},a,c,h):null}_renderChildList(e,t){var y;const{editingEnabled:i}=this,{visibilityMode:s,children:n}=e,a=this._hasChildren(e),l=!a&&i&&((y=e.layer)==null?void 0:y.type)==="group",{exclusive:c,inherited:h}=O,b={[r.listEmpty]:!a,[r.listExclusive]:s===c,[r.listInherited]:s===h,[r.listIndependent]:s!==h&&s!==c};return a||l?a?o("ul",{afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,"aria-expanded":e.open?"true":"false",bind:this,class:this.classes(r.list,b),"data-group":e.uid,"data-item":e,hidden:!e.open||null,id:t,key:"list-items",role:i?"listbox":s===c?"radiogroup":"group"},n==null?void 0:n.map(_=>this._renderItem({item:_,parent:e})).toArray()):o("div",{bind:this,class:r.listEmptyState,id:t,key:"list-items"},this.messages.noItemsToDisplay):null}_renderItemContent(e,t,i){const{id:s}=this,n=`${s}_${e.uid}`,a=`${n}_actions`,l=`${n}__list`,{panel:c}=e,h=this._filterActions(e.actionsSections),b=this._countActions(h);return[o("div",{class:r.itemContainer,key:"list-item-container"},this._renderChildrenToggle(e,l),this._renderLabel(e,t,i),this._renderActionsMenu(e,h,b,a)),this._renderItemMessage(e),b?this._renderActionsSections(e,h,a):null,c&&c.open&&!c.disabled?c.render():null,this._renderChildList(e,l)]}_renderItem({item:e,parent:t,itemType:i,isOnlyChild:s}){var w;const{style:n,id:a,editingEnabled:l,selectedItems:c}=this,h=`${`${a}_${e.uid}`}__title`,b=this._hasMessage(e),y=this._hasChildren(e),_={[r.itemChildren]:y,[r.itemMessage]:!!b,[r.itemInvisible]:n==="modern"&&!e.visible,[r.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[r.itemSelectable]:l};if(l){const C={[F]:(w=e.layer)==null?void 0:w.uid};return o("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":h,"aria-selected":H(e,c)?"true":"false",bind:this,class:this.classes(r.item,_,{[r.itemOnlyChild]:!!s}),"data-item":e,"data-item-type":i,key:`item-with-selection-${e.uid}`,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,role:"option",tabIndex:0,...C},this._renderItemContent(e,t,h))}return o("li",{afterCreate:this._focusListItem,afterUpdate:this._focusListItem,"aria-labelledby":h,bind:this,class:this.classes(r.item,_),key:`item-no-selection-${e.uid}`},this._renderItemContent(e,t,h))}_renderConnectionIcon(e){const{connectionStatus:t}=e;return t!=null?o("calcite-icon",{icon:t==="connected"?"check-circle":"offline",scale:"s"}):null}_renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:s,publishing:n,updating:a}=e,l=a&&!t,c=!!s;return o("span",{class:this.classes({[r.statusIndicator]:!0,[r.publishing]:n,[r.updating]:l,[r.connectionStatus]:c,[r.connectionStatusConnected]:c&&s==="connected"}),key:"layer-item-status"},this._renderConnectionIcon(e))}_renderItemTitle(e,t){const{messages:i}=this,s=e.title||i.untitledLayer,n=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return o("span",{"aria-label":n,class:r.title,id:t,key:"layer-title-container",title:n},s)}_renderItemToggleIcon({visible:e},t){const{style:i}=this,{exclusive:s}=O,n=t==null?void 0:t.visibilityMode,a=i==="modern",l=n===s,c={[r.toggleIcon]:a&&!l,[r.radioIcon]:a&&l,[I.radioChecked]:l&&e,[I.radioUnchecked]:l&&!e,[I.visible]:!l&&e,[I.nonVisible]:!l&&!e};return o("span",{"aria-hidden":"true",class:this.classes(c),key:"item-toggle-icon"})}_renderItemToggle(e,t,i){const{editingEnabled:s,messages:n}=this,{exclusive:a}=O,l=t==null?void 0:t.visibilityMode,c=l===a?"radio":"switch";return o("span",s?{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:r.toggleVisible,"data-item":e,"data-parent-visibility":l,key:"item-toggle-selection-enabled",onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:c,tabIndex:0,title:n.layerVisibility}:{class:r.toggleVisible,key:"item-toggle"},this._renderItemToggleIcon(e,t))}_renderLabel(e,t,i){const{editingEnabled:s,style:n,messages:a}=this,{inherited:l,exclusive:c}=O,h=t==null?void 0:t.visibilityMode,b=h===c?"radio":"switch",y=this._renderItemTitle(e,i),_=this._renderItemStatus(e,t),w=this._renderItemToggle(e,t,i),C=n==="modern"?[y,_,w]:[w,y,_],k=o("div",s?{class:r.label,key:`item-label-no-selection-${e.uid}`}:{"aria-checked":e.visible?"true":"false","aria-labelledby":i,bind:this,class:r.label,"data-item":e,"data-parent-visibility":h,key:`item-label-with-selection-${e.uid}`,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,role:b,tabIndex:0,title:a.layerVisibility},C);return h===l||e.error?o("div",{class:r.label,key:`item-label-container-${e.uid}`},this._renderItemTitle(e,i),this._renderItemStatus(e,t)):k}_renderPanelButton(e){const{className:t,open:i,title:s,image:n,disabled:a}=e,l=n||t?t:I.defaultAction,c=this._getIconImageStyles(e),h={[r.actionsMenuItemActive]:i&&!a},b={[r.actionImage]:!!c["background-image"],[L.disabledElement]:e.disabled};return l&&(b[l]=!!l),o("div",{"aria-disabled":e.disabled.toString(),"aria-label":s,bind:this,class:this.classes(r.actionsMenuItem,h),"data-panel":e,key:`panel-${e.uid}`,onclick:this._triggerPanel,onkeydown:this._triggerPanel,role:"button",tabIndex:e.disabled?void 0:0,title:s},o("span",{class:this.classes(b),styles:c}))}_renderActionsSections(e,t,i){const s=t.toArray().map((n,a)=>o("ul",{class:r.actionsList,key:`${e}-action-section-${a}`},this._renderActionSection(e,n)));return o("div",{"aria-expanded":e.actionsOpen?"true":"false",class:r.actions,hidden:!e.actionsOpen||null,id:i,key:"actions-section",role:"group"},s)}_renderActionSection(e,t){return(t&&t.toArray()).map(i=>this._renderAction({item:e,action:i}))}_renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n=e.type!=="button"||e.image||i?i:I.defaultAction,a={[r.actionImage]:!t&&!!s["background-image"],[I.loadingIndicator]:t,[L.rotating]:t};return n&&!t&&(a[n]=!0),o("span",{"aria-hidden":"true",class:this.classes(r.actionIcon,a),key:"action-icon",styles:s})}_renderActionTitle(e,t){return t?null:o("span",{class:r.actionTitle,key:"action-title"},e)}_renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:a,title:l}=i,c={[r.actionsMenuItem]:s&&i.type==="button",[r.action]:n||!s&&i.type!=="toggle",[r.actionToggle]:!n&&i.type==="toggle",[r.actionToggleOn]:!n&&i.type==="toggle"&&i.value,[L.disabledElement]:a},h=[this._renderActionIcon(i),this._renderActionTitle(l,s)];return s?o("div",{"aria-label":l,bind:this,classes:c,"data-action":i,"data-item":t,key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:l??void 0},h):o("li",{"aria-label":l,bind:this,classes:c,"data-action":i,"data-item":t,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:0,title:l??void 0},h)}_setVisibleItems(){const{referenceItems:e,baseItems:t,visibleElements:i}=this,s=e.concat(t);this.visibleItems=s==null?void 0:s.filter(n=>!n.hidden&&(i.errors||!n.error))}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_filterActions(e){return e.map(t=>t.filter(i=>i.visible))}_destroyReferenceSortable(){const{_sortableReferenceLayers:e}=this;e!=null&&e.el&&e.destroy(),this._sortableReferenceLayersNode=null}_destroyBaseSortable(){const{_sortableBaseLayers:e}=this;e!=null&&e.el&&e.destroy(),this._sortableBaseLayersNode=null}_toggleEditingTitle(){const{_editingTitle:e}=this,t=!e;this._editingTitle=t,this._focusOnElement=t?"edit-input":"edit-button",this.scheduleRender()}_storeEditTitleInput(e){this._editTitleInput=e,this._focusEditElement()}_focusEditElement(){this._editTitleInput&&this._focusOnElement==="edit-input"&&(this._focusOnElement=null,this._editTitleInput.focus()),this._editTitleButton&&this._focusOnElement==="edit-button"&&(this._focusOnElement=null,this._editTitleButton.focus())}_storeEditTitleButton(e){this._editTitleButton=e,this._focusEditElement()}_formSubmit(e){var i;e.preventDefault();const t=(i=this._editTitleInput)==null?void 0:i.value;t!=null&&t.trim()&&(this.basemapTitle=t),this._toggleEditingTitle()}_itemMovedList(e){const t=E(e.item);if(!t)return;const i=e.to.dataset.nodeRef,s=e.from.dataset.nodeRef,n=e.newIndex;this.viewModel.transferListItem({listItem:t,from:s,to:i,newIndex:n})}_toggleSortingBaseLayers(){const{_sortableBaseLayers:e,_sortableBaseLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const n=Y.create(t,{dataIdAttr:F,group:ee,filter:`.${r.itemOnlyChild}`,fallbackTolerance:4,disabled:s,onSort:()=>this._sortLayersToItems({type:"base",itemIds:n.toArray()}),onAdd:a=>this._itemMovedList(a),chosenClass:r.sortableChosen});this._sortableBaseLayers=n}}_toggleSortingReferenceLayers(){const{_sortableReferenceLayers:e,_sortableReferenceLayersNode:t,editingEnabled:i}=this;if(!t)return;const s=!i;if(e)e.option("disabled",s);else{const n=Y.create(t,{dataIdAttr:F,group:ee,disabled:s,fallbackTolerance:4,onSort:()=>this._sortLayersToItems({type:"reference",itemIds:n.toArray()}),onAdd:a=>this._itemMovedList(a),chosenClass:r.sortableChosen});this._sortableReferenceLayers=n}}_toggleSorting(){this._toggleSortingBaseLayers(),this._toggleSortingReferenceLayers()}_sortNodeCreated(e){const t=e.getAttribute("data-node-ref");t==="base"&&(this._sortableBaseLayersNode=e),t==="reference"&&(this._sortableReferenceLayersNode=e),this._toggleSorting()}_getItems(e){return e.toArray().filter(t=>!t.hidden&&(this.visibleElements.errors||!t.error))}_getSingleActionButton(e){return e.reduce(t=>t).filter(t=>t&&t.type==="button").at(0)}_sortLayersToItems({type:e,itemIds:t}){var s,n,a,l,c,h;const i=e==="base"?(a=(n=(s=this.view)==null?void 0:s.map)==null?void 0:n.basemap)==null?void 0:a.baseLayers:e==="reference"?(h=(c=(l=this.view)==null?void 0:l.map)==null?void 0:c.basemap)==null?void 0:h.referenceLayers:null;i&&i.sort((b,y)=>{const _=t.indexOf(b.uid),w=t.indexOf(y.uid);return _>w?-1:_<w?1:0})}_focusListItem(e){var s;const{_focusSortUid:t}=this;if(!e||!t)return;const i=E(e);((s=i==null?void 0:i.layer)==null?void 0:s.uid)===t&&(e.focus(),this._focusSortUid=null)}_selectionKeydown(e){var D,z,K,j,q,G;const t=["ArrowDown","ArrowUp"],i=oe(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget,n=E(s),a=s.dataset.itemType,{_sortableBaseLayers:l,_sortableReferenceLayers:c,selectedItems:h}=this,b=a==="base"?l:a==="reference"?c:null;if(!b||!n)return;const y=H(n,h),_=b.toArray(),w=e.target,C=_.indexOf(w.dataset[ge]),{baseItems:k,referenceItems:re}=this.viewModel;if(C!==-1){if(i==="ArrowDown"){const B=C+1,S=B>=_.length;if(S&&a==="reference"&&y){const T=k.length;return this.viewModel.transferListItem({listItem:n,from:"reference",to:"base",newIndex:T}),this._focusSortUid=(D=n.layer)==null?void 0:D.uid,void this.scheduleRender()}if(S&&a==="reference"){const T=k.at(0);return this._focusSortUid=(z=T==null?void 0:T.layer)==null?void 0:z.uid,void this.scheduleRender()}return S?void 0:(y&&(Z(_,C,B),b.sort(_),this._sortLayersToItems({type:a,itemIds:b.toArray()})),this._focusSortUid=(K=n.layer)==null?void 0:K.uid,void this.scheduleRender())}if(i==="ArrowUp"){const B=C-1,S=B<0;if(S&&a==="base"&&y){if(k.length===1)return;const T=0;return this.viewModel.transferListItem({listItem:n,from:"base",to:"reference",newIndex:T}),this._focusSortUid=(j=n.layer)==null?void 0:j.uid,void this.scheduleRender()}if(S&&a==="base"){const T=re.at(-1);return this._focusSortUid=(q=T==null?void 0:T.layer)==null?void 0:q.uid,void this.scheduleRender()}if(S)return;y&&(Z(_,C,B),b.sort(_),this._sortLayersToItems({type:a,itemIds:b.toArray()})),this._focusSortUid=(G=n.layer)==null?void 0:G.uid,this.scheduleRender()}}}_watchActionSectionChanges(e,t){this.addHandles(e.on("change",()=>this.scheduleRender()),t),e.forEach(i=>this._renderOnActionChanges(i,t))}_renderOnActionChanges(e,t){e.type!=="toggle"?e.type!=="slider"?this.addHandles([v(()=>[e.className,e.image,e.id,e.title,e.visible],()=>this.scheduleRender(),A)],t):this.addHandles([v(()=>[e.className,e.id,e.title,e.visible,e.value,e.displayValueEnabled,e.max,e.min,e.step],()=>this.scheduleRender(),A)],t):this.addHandles([v(()=>[e.className,e.image,e.id,e.title,e.visible,e.value],()=>this.scheduleRender(),A)],t)}_renderOnItemChanges(e,t){this.addHandles([v(()=>{var i,s,n;return[e.actionsOpen,e.visible,e.open,e.updating,e.connectionStatus,e.publishing,e.title,e.visibleAtCurrentScale,e.error,e.visibilityMode,e.panel,(i=e.panel)==null?void 0:i.title,(s=e.panel)==null?void 0:s.content,(n=e.panel)==null?void 0:n.className]},()=>this.scheduleRender(),A),v(()=>[e.hidden,e.error],()=>this._setVisibleItems()),e.actionsSections.on("change",()=>this.scheduleRender()),e.children.on("change",()=>this.scheduleRender())],t),e.children.forEach(i=>this._renderOnItemChanges(i,t)),e.actionsSections.forEach(i=>this._watchActionSectionChanges(i,t))}_itemsChanged(e,t){this.removeHandles(t),this._tooltipReferenceMap.clear(),this._setVisibleItems(),e.forEach(i=>this._renderOnItemChanges(i,t)),this.scheduleRender()}_countActions(e){return e.reduce((t,i)=>t+i.length,0)}_getIconImageStyles(e){const t=e.declaredClass==="esri.widgets.LayerList.ListItemPanel"||e.declaredClass==="esri.support.Action.ActionButton"||e.declaredClass==="esri.support.Action.ActionToggle"?e.image:null;return{"background-image":t?`url("${t}")`:""}}_toggleActionsOpen(e){e.stopPropagation();const t=E(e.currentTarget);if(!t)return;const{actionsOpen:i}=t,s=!i,{baseItems:n,referenceItems:a}=this;s&&(n.forEach(l=>P(l)),a.forEach(l=>P(l))),t.actionsOpen=s}_triggerPanel(e){e.stopPropagation();const t=be(e.currentTarget);t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){e.stopPropagation();const t=e.currentTarget,i=pe(t),s=E(t);s&&i&&(i.type==="toggle"&&(i.value=!i.value),this.triggerAction(i,s))}_toggleVisibility(e){e.stopPropagation();const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=E(t);s&&(i===O.exclusive&&s.visible||(s.visible=!s.visible))}_toggleChildrenClick(e){e.stopPropagation();const t=E(e.currentTarget);t&&(t.open=!t.open)}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=t&&(e.metaKey||e.ctrlKey),n=E(e.currentTarget);if(!n)return;const a=H(n,i),{length:l}=i;if(!s)return l&&!(a&&l===1)?(i.removeAll(),void i.add(n)):void(a?i.remove(a):i.add(n));a?i.remove(a):i.add(n)}get test(){return{visibleItems:this.visibleItems}}};function pe(e){return e["data-action"]}function be(e){return e["data-panel"]}function E(e){return e["data-item"]}d([g()],u.prototype,"visibleItems",void 0),d([g()],u.prototype,"basemapTitle",null),d([g()],u.prototype,"baseListItemCreatedFunction",null),d([g()],u.prototype,"editingEnabled",void 0),d([g()],u.prototype,"headingLevel",void 0),d([g()],u.prototype,"iconClass",void 0),d([g()],u.prototype,"label",null),d([g(),W("esri/widgets/BasemapLayerList/t9n/BasemapLayerList")],u.prototype,"messages",void 0),d([g(),W("esri/t9n/common")],u.prototype,"messagesCommon",void 0),d([g()],u.prototype,"multipleSelectionEnabled",void 0),d([g()],u.prototype,"referenceListItemCreatedFunction",null),d([g({readOnly:!0})],u.prototype,"baseItems",null),d([g({readOnly:!0})],u.prototype,"referenceItems",null),d([g()],u.prototype,"selectedItems",void 0),d([g()],u.prototype,"style",void 0),d([g()],u.prototype,"view",null),d([he("trigger-action"),g({type:ne})],u.prototype,"viewModel",void 0),d([g()],u.prototype,"visibleElements",void 0),d([le("visibleElements")],u.prototype,"castVisibleElements",null),d([M()],u.prototype,"_toggleActionsOpen",null),d([M()],u.prototype,"_triggerPanel",null),d([M()],u.prototype,"_triggerAction",null),d([M()],u.prototype,"_toggleVisibility",null),d([M()],u.prototype,"_toggleChildrenClick",null),d([M()],u.prototype,"_toggleSelection",null),u=d([se("esri.widgets.BasemapLayerList")],u);const ke=u;export{ke as default};

import{a5 as n,a6 as d,a9 as N,bA as Q,V as W,an as X,bg as Y,kn as D,s as I,eU as M,cb as x,h3 as R,_ as T,bh as tt,b5 as H,b4 as L,lF as F,cd as et,h7 as ot}from"./index-b516d057.js";import{p as G}from"./SlideThumbnail-a64b3c3c.js";import{i as v,e as V,O as it,r as at,n as a,x as st}from"./jsxFactory-92036771.js";import{l as rt}from"./Viewpoint-f83262d0.js";import{f as z}from"./Bookmark-479b355a.js";import{t as nt}from"./GoTo-4d856ce0.js";import{c as A,h as dt}from"./ButtonMenu-86226b21.js";import{e as k}from"./globalCss-94006b67.js";import{e as lt}from"./Heading-92f210ca.js";import{e as ut}from"./vmEvent-d773b6c5.js";import{S as kt}from"./sortable.esm-0d19b1d3.js";import"./uuid-709b6c67.js";import"./Cyclical-4c223a04.js";let E=class extends Q{constructor(t){super(t)}get editedBookmark(){const{bookmark:t}=this;return t?this._get("editedBookmark")||t.clone():null}get state(){return this._get("state")}set state(t){this.validationState=void 0,this.loading=void 0,this._set("state",t)}};n([d()],E.prototype,"bookmark",void 0),n([d({readOnly:!0})],E.prototype,"editedBookmark",null),n([d()],E.prototype,"state",null),n([d()],E.prototype,"validationState",void 0),n([d()],E.prototype,"loading",void 0),E=n([N("esri.widgets.Bookmarks.UserState")],E);const O=E,Z=W.ofType(z),mt={width:128,height:128,format:"png"},S={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},C={time:!0},j="esri.widgets.Bookmarks.BookmarksViewModel",P=X.getLogger(j);let p=class extends nt(Y.EventedAccessor){constructor(t){super(t),this.capabilities={...C},this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}get abilities(){return D(P,"abilities",{replacement:"capabilities",version:"4.27"}),this.capabilities}set abilities(t){D(P,"abilities",{replacement:"capabilities",version:"4.27"}),this.capabilities=t}castAbilities(t){return{...C,...t}}castCapabilities(t){return{...C,...t}}get bookmarks(){var t,e;return((e=(t=this.view)==null?void 0:t.map)==null?void 0:e.bookmarks)??new Z}set bookmarks(t){this._overrideIfSome("bookmarks",t)}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...S,...t})}get defaultCreateOptions(){return S}set defaultEditOptions(t){this._set("defaultEditOptions",{...S,...t})}get defaultEditOptions(){return S}get state(){const{view:t}=this;return t&&!t.ready?"loading":"ready"}async createBookmark(t){const{view:e,defaultCreateOptions:o,capabilities:i}=this;if(!e)throw new I("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:l,captureViewpoint:m,captureRotation:c,captureScale:b,captureTimeExtent:B}={...o,...t},f=r?await this._createThumbnail(l):void 0,J=i.time&&B&&e.timeExtent!=null?e.timeExtent.clone():void 0;return new z({...f&&{thumbnail:f},...B&&{timeExtent:J},...m&&{viewpoint:this._createViewpoint({view:e,captureScale:b,captureRotation:c})}})}async editBookmark(t,e){if(!t)return t;const{view:o,defaultEditOptions:i}=this;if(!o)throw new I("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:l,captureViewpoint:m,captureRotation:c,captureScale:b,captureTimeExtent:B}={...i,...e},f=r?await this._createThumbnail(l):void 0;return f&&(t.thumbnail=f),m&&(t.viewpoint=this._createViewpoint({view:o,captureScale:b,captureRotation:c})),B&&o.timeExtent!=null&&(t.timeExtent=o.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:t}),t}goTo(t){const{capabilities:e,view:o}=this;if(!o)throw new I("go-to:invalid-view","Cannot go to a bookmark without a view");const i=t==null?void 0:t.viewpoint;if(!i)throw new I("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:t});this._set("activeBookmark",t);const r={target:i},l=this.callGoTo(r),m=t==null?void 0:t.timeExtent;return e.time&&m&&(o.timeExtent=m),this.emit("bookmark-select",{bookmark:t}),l.catch(()=>{}).then(()=>this._set("activeBookmark",null)),l}async _createThumbnail(t){const{view:e}=this;if(!e)throw new I("bookmark:invalid-view","Cannot create slide thumbnail without a view");const o=await e.takeScreenshot({...mt,...t});return new G({url:o.dataUrl})}_createViewpoint({view:t,captureRotation:e,captureScale:o}){var r,l;const i=(r=t.viewpoint)==null?void 0:r.clone();return new rt({targetGeometry:(l=t.extent)==null?void 0:l.clone(),rotation:(e?i==null?void 0:i.rotation:null)??0,scale:(o?i==null?void 0:i.scale:null)??0})}};n([d()],p.prototype,"abilities",null),n([M("abilities")],p.prototype,"castAbilities",null),n([d()],p.prototype,"capabilities",void 0),n([M("capabilities")],p.prototype,"castCapabilities",null),n([d({readOnly:!0})],p.prototype,"activeBookmark",void 0),n([d({type:Z})],p.prototype,"bookmarks",null),n([d()],p.prototype,"defaultCreateOptions",null),n([d()],p.prototype,"defaultEditOptions",null),n([d({readOnly:!0})],p.prototype,"state",null),n([d()],p.prototype,"view",void 0),p=n([N(j)],p);const K=p,h="esri-bookmarks",g=`${h}__authoring`,_=`${h}__bookmark`,y=`${h}__time-extent`,s={base:h,widgetIcon:v.bookmark,loaderContainer:`${h}__loader-container`,loader:`${h}__loader`,fadeIn:`${h}--fade-in`,bookmarkList:`${h}__list`,bookmarkListSortable:`${h}__list--sortable`,bookmark:_,bookmarkButton:`${_}-button`,bookmarkImageContainer:`${_}-image-container`,bookmarkImageContainerHasImage:`${_}-image-container--has-image`,bookmarkEditButtonContainer:`${_}-edit-button-container`,bookmarkEditButton:`${_}-edit-button`,bookmarkDragHandle:`${h}_bookmark-drag-handle`,bookmarkDragHandleIcon:`${h}_bookmark-drag-handle-icon`,bookmarkIcon:`${_}-icon`,bookmarkImage:`${h}__image`,bookmarkLabel:`${_}-label`,bookmarkName:`${_}-name`,bookmarkTimeExtent:`${_}-time-extent`,bookmarkActive:`${_}--active`,noBookmarksHeader:`${h}__no-bookmarks-heading`,noBookmarksDescription:`${h}__no-bookmarks-description`,addingBookmark:`${h}__adding-bookmark`,addBookmark:`${h}__add-bookmark`,addBookmarkButton:`${h}__add-bookmark-button`,addBookmarkIcon:`${h}__add-bookmark-icon`,authoringCard:`${g}-card`,authoringContainer:`${g}-container`,authoringForm:`${g}-form`,authoringFormAdding:`${g}-form--adding`,authoringLabel:`${g}-label`,authoringLabelStartPadding:`${g}-label--start-padding`,authoringActions:`${g}-actions`,authoringInputInvalid:`${g}-input--invalid`,authoringDeleteButton:`${g}-delete-button`,authoringCancelButton:`${g}-cancel-button`,timeExtentContainer:`${y}-container`,timeExtent:y,timeExtentGroup:`${y}-group`,timeExtentDate:`${y}-date`,timeExtentTime:`${y}-time`};function ht(t,e,o){t.splice(o,0,t.splice(e,1)[0])}const ct="bookmarks",w="data-bookmark-uid",q={addBookmark:!0,thumbnail:!0,time:!0},U=/^https:\/\/.*/i,bt="esri.widgets.Bookmarks";let u=class extends it{constructor(t,e){super(t,e),this._tooltipReferenceMap=new Map,this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._addBookmarkButtonNode=null,this._focusAddBookmarkButton=!1,this._focusEditInputBox=!1,this._focusAddInputBox=!1,this._focusUrlEditInputBox=!1,this._sortable=null,this._sortableNode=null,this._focusSortUid=null,this._selectedSortUid=null,this._sortableSavedItems=[],this._editIncludeTimeExtent=void 0,this._userState=null,this.disabled=!1,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=s.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.viewModel=new K,this.visibleElements={...q}}initialize(){this.addHandles([x(()=>{var t;return(t=this.viewModel)==null?void 0:t.bookmarks},()=>this._bookmarksInitialized(),R),x(()=>this.editingEnabled,()=>this._toggleSorting(),R)])}destroy(){this._destroySortable(),this._editMenu.destroy(),this._tooltipReferenceMap.clear()}loadDependencies(){return at({label:()=>T(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),switch:()=>T(()=>import("./calcite-switch-d026b1cc.js"),["assets/calcite-switch-d026b1cc.js","assets/switch-bf0dca96.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),tooltip:()=>T(()=>import("./calcite-tooltip-5cb74da1.js"),["assets/calcite-tooltip-5cb74da1.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"])})}get _editMenuItems(){var i,r;const{messages:t,_userState:e}=this,o=(r=(i=e==null?void 0:e.editedBookmark)==null?void 0:i.thumbnail)==null?void 0:r.url;return[new A({label:t==null?void 0:t.menu.refreshThumbnail,iconClass:v.refresh,clickFunction:()=>this._refreshThumbnail()}),new A({label:o&&U.test(o)?t==null?void 0:t.menu.editImageUrl:t==null?void 0:t.menu.useImageUrl,iconClass:v.link,clickFunction:()=>this._startUseImageUrl()}),o?new A({label:t==null?void 0:t.menu.removeThumbnail,iconClass:v.erase,clickFunction:()=>this._removeThumbnail()}):null].filter(tt)}get _editMenu(){const{_editMenuItems:t,messages:e,disabled:o}=this,i=this._get("_editMenu");i&&i.destroy();const r=new dt({disabled:o,iconClass:v.handleHorizontal,label:e==null?void 0:e.menu.label});return r.items=t,r}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(t){this.viewModel.defaultEditOptions=t}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(t){this.viewModel.bookmarks=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...q,...t}}endAddBookmark(){this._userState=null}goTo(t){return this.viewModel.goTo(t)}render(){const{state:t}=this.viewModel,e=t==="loading"?this._renderLoading():this._renderBookmarks();return a("div",{class:this.classes(s.base,k.widget,k.panel,{[k.widgetDisabled]:this.disabled})},e)}startAddBookmark(){this._userState=new O({state:"add"}),this._focusAddInputBox=!0,this.scheduleRender()}_renderBookmarkTooltips(t){return t.toArray().map(e=>this._renderBookmarkTooltip(e))??[]}_renderBookmarkTooltip(t){const{_tooltipReferenceMap:e,messagesCommon:o}=this,i=this._getBookmarkTitle(t),r=`${o==null?void 0:o.dragHandleTitle} ${i}`;return t?a("calcite-tooltip",{key:`tooltip-${t.uid}`,referenceElement:e.get(t.uid)},r):null}_renderLoading(){return a("div",{class:s.loaderContainer,key:"loader",tabIndex:this.disabled?-1:void 0},a("div",{class:s.loader}))}_renderNoBookmarksContainer(){const{messages:t,disabled:e}=this;return a("div",{class:k.empty,key:"no-bookmarks",tabIndex:e?-1:void 0},a("span",{"aria-hidden":"true",class:this.classes(k.noBookmarksIcon,s.widgetIcon)}),a(lt,{class:this.classes(k.heading,s.noBookmarksHeader),level:this.headingLevel},t==null?void 0:t.noBookmarksHeading),a("p",{class:s.noBookmarksDescription},t==null?void 0:t.noBookmarksDescription))}_renderAddBookmarkLoading(){var t;return a("div",{class:s.addingBookmark,key:"adding-bookmark"},a("span",{"aria-hidden":"true",class:this.classes(v.loadingIndicator,k.rotating)}),(t=this.messages)==null?void 0:t.addingBookmark)}_renderBookmarkItems(t){if(!t)return[];const{_userState:e,editingEnabled:o}=this;return t.map(i=>o&&i&&e&&(e.state==="edit"||e.state==="edit-thumbnail")&&e.bookmark===i?e.state==="edit-thumbnail"?this._renderEditingBookmarkUrl(e.editedBookmark):this._renderEditingBookmark(e.editedBookmark):this._renderBookmark(i)).toArray()}_renderBookmarksContainer(t){var b;const{_userState:e,editingEnabled:o,disabled:i,view:r}=this,l=(e==null?void 0:e.state)==="add",m=r&&o&&!l?this._renderAddBookmarkButton():null,c=o?l&&e.loading?this._renderAddBookmarkLoading():(e==null?void 0:e.state)==="add"?this._renderAddingBookmark():null:null;return[a("ul",{afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"aria-label":(b=this.messages)==null?void 0:b.widgetLabel,bind:this,class:this.classes(s.bookmarkList,{[s.bookmarkListSortable]:this.editingEnabled}),"data-node-ref":"_sortableNode",key:"bookmark-list",tabIndex:i?-1:void 0},this._renderBookmarkItems(t)),m,c]}_renderAddBookmarkButton(){var t;return this.visibleElements.addBookmark?a("div",{class:s.addBookmark,key:"add-bookmark-item"},a("button",{afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,bind:this,class:this.classes(k.button,k.buttonTertiary,s.addBookmarkButton),"data-node-ref":"_addBookmarkButtonNode",disabled:this.disabled,onclick:this.startAddBookmark,type:"button"},a("span",{"aria-hidden":"true",class:this.classes(s.addBookmarkIcon,v.plus)}),(t=this.messages)==null?void 0:t.addBookmark)):null}_renderBookmarks(){const{bookmarks:t}=this.viewModel,e=t&&t.filter(Boolean),o=e&&e.length,i=o||this.editingEnabled?this._renderBookmarksContainer(e):null;return[o?null:this._renderNoBookmarksContainer(),i,this._renderBookmarkTooltips(t)]}_renderEditContainer(t){const{messagesCommon:e,disabled:o}=this,i=this._getBookmarkTitle(t);return a("div",{class:s.bookmarkEditButtonContainer,key:"edit-container"},a("button",{"aria-label":`${e==null?void 0:e.edit} ${i}`,bind:this,class:s.bookmarkEditButton,"data-bookmark":t,disabled:o,onclick:this._showEditBookmarkForm,title:`${e==null?void 0:e.edit} ${i}`,type:"button"},a("span",{"aria-hidden":"true",class:v.edit})))}_renderDragHandle(t){const{messagesCommon:e,disabled:o}=this,i=this._getBookmarkTitle(t),r={[w]:t.uid};return a("div",{afterCreate:this._focusDragHandle,afterUpdate:this._focusDragHandle,"aria-label":`${e==null?void 0:e.dragHandleTitle} ${i}`,"aria-pressed":this._selectedSortUid===t.uid?"true":"false",bind:this,class:s.bookmarkDragHandle,"data-bookmark":t,key:"drag-handle",onblur:this._dragHandleBlur,onkeydown:this._dragHandleKeydown,role:"button",tabIndex:o?-1:0,...r},a("span",{"aria-hidden":"true",class:this.classes(s.bookmarkDragHandleIcon,v.handleVertical)}))}_renderBookmarkImageIcon(){return a("span",{"aria-hidden":"true",class:this.classes(s.bookmarkIcon,s.widgetIcon)})}_renderBookmarkImage(t){const{visibleElements:e}=this,{thumbnail:o}=t,i=(o==null?void 0:o.url)||"";return e.thumbnail&&i?a("img",{alt:"",class:s.bookmarkImage,src:i}):null}_renderBookmarkTimeSwitch(t){const{messages:e,disabled:o}=this,{timeExtent:i}=t,{view:r}=this.viewModel;return(r==null?void 0:r.timeExtent)??i?a("calcite-label",{layout:"inline-space-between"},e==null?void 0:e.includeTimeExtent,a("calcite-switch",{checked:!!i,disabled:o,scale:"s",onCalciteSwitchChange:l=>{this._editIncludeTimeExtent=!!l.target.checked}})):null}_renderBookmarkTimeExtent(t){const{visibleElements:e}=this,{timeExtent:o}=t;return o?a("span",{class:s.timeExtent},[o.start!=null&&a("span",{class:s.timeExtentGroup,key:"start-date-group"},a("span",{class:s.timeExtentDate,key:"start-date"},this._formatDate(o.start)),e.time?a("span",{class:s.timeExtentTime,key:"start-time"},this._formatTime(o.start)):null),o.end!=null&&(o.start==null||o.start.getTime()!==o.end.getTime())&&a("span",{class:s.timeExtentGroup,key:"end-date-group"},a("span",{class:s.timeExtentDate,key:"end-date"},this._formatDate(o.end)),e.time?a("span",{class:s.timeExtentTime,key:"end-time"},this._formatTime(o.end)):null)]):null}_renderBookmarkButton(t){const{disabled:e}=this,{timeExtent:o}=t,{capabilities:i}=this.viewModel,r=this._getBookmarkTitle(t),{thumbnail:l}=t,m=a("div",{class:this.classes(s.bookmarkImageContainer,l!=null&&l.url?s.bookmarkImageContainerHasImage:null)},this._renderBookmarkImage(t)||this._renderBookmarkImageIcon()),c=i.time&&o?a("span",{class:s.bookmarkTimeExtent,key:"time-extent"},this._renderBookmarkTimeExtent(t)):null;return a("button",{bind:this,class:s.bookmarkButton,"data-bookmark":t,disabled:e,key:"bookmark-button",onclick:this._goToBookmark,type:"button"},m,a("div",{class:s.bookmarkLabel},a("span",{class:s.bookmarkName,key:"bookmark-title"},r),c))}_renderBookmark(t){const{activeBookmark:e}=this.viewModel,o={[s.bookmarkActive]:e===t},i=this.editingEnabled?this._renderEditContainer(t):null,r={[w]:t.uid},l=this.editingEnabled?this._renderDragHandle(t):null;return a("li",{class:this.classes(s.bookmark,o),key:t,...r},l,this._renderBookmarkButton(t),i)}_renderEditingBookmarkName(t){var l;const{messages:e,_userState:o,disabled:i}=this,r=(o==null?void 0:o.validationState)==="name-required";return a("label",{class:this.classes({[s.authoringLabel]:!0,[s.authoringLabelStartPadding]:!!((l=this.visibleElements)!=null&&l.thumbnail)})},e==null?void 0:e.title,r?a("strong",null,e==null?void 0:e.invalidTitle):null,a("input",{afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,bind:this,class:this.classes(k.input,r?s.authoringInputInvalid:null),"data-bookmark":t,"data-node-ref":"_editInputNode",disabled:i,placeholder:e==null?void 0:e.titlePlaceholder,required:!0,type:"text",value:t.name}))}_renderEditingBookmarkUrlActions(){const{messagesCommon:t,disabled:e}=this;return a("div",{class:s.authoringActions},a("input",{bind:this,class:this.classes(k.button,k.buttonTertiary),disabled:e,onclick:this._closeUrlEditBookmarkForm,type:"button",value:t==null?void 0:t.back}),a("input",{class:k.button,disabled:e,type:"submit",value:t==null?void 0:t.add}))}_renderEditingBookmarkActions(){var i;const{messagesCommon:t,disabled:e}=this,o=(i=this._userState)==null?void 0:i.bookmark;return a("div",{class:s.authoringActions},a("input",{bind:this,class:this.classes(k.button,k.buttonTertiary,s.authoringDeleteButton),"data-bookmark":o,disabled:e,onclick:this._deleteBookmark,type:"button",value:t==null?void 0:t.delete}),a("input",{bind:this,class:this.classes(k.button,k.buttonTertiary),disabled:e,onclick:this._closeEditBookmarkForm,type:"button",value:t==null?void 0:t.cancel}),a("input",{class:k.button,disabled:e,type:"submit",value:t==null?void 0:t.save}))}_renderEditingBookmarkUrlInput(t){var c,b;const{messages:e,_userState:o,disabled:i}=this,r=(c=t.thumbnail)==null?void 0:c.url,l=r&&U.test(r)?r:void 0,m=(o==null?void 0:o.validationState)==="absolute-url-required";return a("label",{class:this.classes({[s.authoringLabel]:!0,[s.authoringLabelStartPadding]:!!((b=this.visibleElements)!=null&&b.thumbnail)})},m?a("strong",null,e==null?void 0:e.invalidImageUrl):null,a("input",{afterCreate:this._storeUrlEditInput,afterUpdate:this._focusUrlEditInput,bind:this,class:this.classes(k.input,m?s.authoringInputInvalid:null),"data-bookmark":t,"data-node-ref":"_urlEditInputNode",disabled:i,placeholder:e?`https://<${e.imageUrlPlaceholder}>`:void 0,required:!0,title:e==null?void 0:e.imageUrlTooltip,type:"text",value:l}))}_renderEditingBookmarkUrl(t){if(!t)return null;const e={[w]:t.uid};return a("li",{class:s.authoringCard,key:"edit-bookmark-url-form",...e},a("form",{bind:this,class:s.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkUrlSubmit},this._renderEditingBookmarkUrlInput(t),this._renderEditingBookmarkUrlActions()))}_renderEditingBookmark(t){if(!t)return null;const e={[w]:t.uid},{capabilities:o}=this.viewModel,i=o.time?a("div",{class:s.timeExtentContainer,key:"edit-bookmark-time-container"},this._renderBookmarkTimeSwitch(t),this._editIncludeTimeExtent?this._renderBookmarkTimeExtent(t):null):null;return a("li",{class:s.authoringCard,key:"edit-bookmark-form",...e},a("form",{bind:this,class:s.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkSubmit},a("div",{class:s.authoringContainer},this.visibleElements.thumbnail?a("div",{class:s.bookmarkImageContainer},this._renderBookmarkImage(t),this._editMenu.render()):null,this._renderEditingBookmarkName(t)),i,this._renderEditingBookmarkActions()))}_renderAddingBookmarkName(){const{_userState:t,messages:e,disabled:o}=this,i=(t==null?void 0:t.validationState)==="name-required";return a("label",{class:s.authoringLabel},e==null?void 0:e.title,i?a("strong",null,e==null?void 0:e.invalidTitle):null,a("input",{afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,bind:this,class:this.classes(k.input,i?s.authoringInputInvalid:null),"data-node-ref":"_addInputNode",disabled:o,placeholder:e==null?void 0:e.titlePlaceholder,required:!0,type:"text",value:""}))}_renderAddingBookmarkActions(){const{messagesCommon:t,disabled:e}=this;return a("div",{class:this.classes(s.authoringActions)},a("input",{bind:this,class:this.classes(k.button,k.buttonTertiary,s.authoringCancelButton),disabled:e,onclick:this._endAddBookmark.bind(this),type:"button",value:t==null?void 0:t.cancel}),a("input",{class:k.button,disabled:e,type:"submit",value:t==null?void 0:t.add}))}_renderAddingBookmark(){return a("div",{class:s.authoringCard,key:"add-bookmark-form"},a("form",{bind:this,class:this.classes(s.authoringForm,s.authoringFormAdding),onsubmit:this._addBookmarkSubmit},this._renderAddingBookmarkName(),this._renderAddingBookmarkActions()))}_setTooltipReference(t,e){this._tooltipReferenceMap.set(e.uid,t),this.scheduleRender()}_getBookmarkTitle(t){var e;return((t==null?void 0:t.name)||((e=this.messagesCommon)==null?void 0:e.untitled))??""}_formatDate(t){var e;return t?H(t,{...L("short-date"),timeZone:((e=this.view)==null?void 0:e.timeZone)??F}):""}_formatTime(t){var e;return t?H(t,{...L("long-time"),timeZone:((e=this.view)==null?void 0:e.timeZone)??F}):""}_dragHandleBlur(){this._selectedSortUid=null,this.scheduleRender()}_dragHandleKeydown(t){const{_sortableSavedItems:e}=this,o=["ArrowDown","ArrowUp","Escape","Tab"," ","Enter"],i=ot(t);if(!o.includes(i))return;const{_sortable:r,_selectedSortUid:l}=this;if(!r)return;const m=r.toArray(),c=t.target.getAttribute(w),b=m.indexOf(c);if(st(i)){const f=l&&l===c;return this._selectedSortUid=f?null:c,this._sortableSavedItems=f?[]:r.toArray(),void this.scheduleRender()}if(i==="Tab")return this._selectedSortUid=null,void this.scheduleRender();if(i==="Escape"&&e.length!==0)return t.stopPropagation(),this._selectedSortUid=null,this._updateSortItems(e,r,c),void this.scheduleRender();if(b===-1||!l)return;const B=i==="ArrowUp"?b-1:b+1;B>=m.length||B<=-1||(ht(m,b,B),this._updateSortItems(m,r,c))}_updateSortItems(t,e,o){e.sort(t),this._sortBookmarks(e),this._focusSortUid=o,this._selectedSortUid=o}_focusDragHandle(t){const e=$(t);if(!e)return;this._setTooltipReference(t,e);const{_focusSortUid:o}=this;!t||!o||t.getAttribute(w)===o&&(t.focus(),this._focusSortUid=null)}_toggleSorting(){const{_sortable:t,_sortableNode:e,editingEnabled:o,disabled:i}=this;if(e)if(t)t.option("disabled",i||!o);else{const r=kt.create(e,{dataIdAttr:w,handle:`.${s.bookmarkDragHandle}`,group:ct,disabled:i||!o,onSort:()=>this._sortBookmarks(r)});this._sortable=r}}_sortNodeCreated(t){this._sortableNode=t,this._toggleSorting()}_sortBookmarks(t){const{bookmarks:e}=this.viewModel;if(!e)return;const o=t.toArray();e.sort((i,r)=>{const l=o.indexOf(i.uid),m=o.indexOf(r.uid);return l>m?1:l<m?-1:0})}_destroySortable(){const{_sortable:t}=this;t&&t.destroy(),this._sortable=null}_endAddBookmark(){this._focusAddBookmarkButton=!0,this.endAddBookmark()}_bookmarksInitialized(){const t="bookmarks-init";this.removeHandles(t),this.addHandles(et(()=>{var e;return(e=this.viewModel)==null?void 0:e.bookmarks},"change",()=>this._bookmarksChanged()),t)}_bookmarksChanged(){const t="bookmarks-change",{bookmarks:e}=this.viewModel;this.removeHandles(t);const o=e.map(i=>x(()=>{var r;return[i==null?void 0:i.name,(r=i==null?void 0:i.thumbnail)==null?void 0:r.url]},()=>this.scheduleRender()));this.addHandles(o.toArray(),t),this.scheduleRender()}_showEditBookmarkForm(t){const e=$(t.currentTarget);e&&(this._editIncludeTimeExtent=!!e.timeExtent,this._focusEditInputBox=!0,this._userState=new O({bookmark:e,state:"edit"}),this.viewModel.goTo(e),this.scheduleRender())}_closeUrlEditBookmarkForm(){this._focusEditInputBox=!0,this._userState&&(this._userState.state="edit")}_closeEditBookmarkForm(){this._userState=null}_addBookmarkSubmit(t){t.preventDefault();const{_addInputNode:e,_userState:o}=this;if(!o)return;const i=e?e.value.trim():null;i?(o.loading=!0,this.viewModel.createBookmark().then(r=>{r.name=i,this.viewModel.bookmarks.add(r),this._endAddBookmark()})):o.validationState="name-required"}async _editBookmarkAndClose(t,e){const{viewModel:o}=this;await o.editBookmark(t,{...o.defaultEditOptions,...e}),this._closeEditBookmarkForm()}_editBookmarkSubmit(t){t.preventDefault();const{_editInputNode:e,_userState:o,_editIncludeTimeExtent:i}=this;if(!(o!=null&&o.bookmark)||!o.editedBookmark)return;const r=e&&e.value.trim();r?(o.bookmark.name=r,o.bookmark.thumbnail=o.editedBookmark.thumbnail,i||(o.bookmark.timeExtent=null),this._editBookmarkAndClose(o.bookmark,{takeScreenshot:!1,captureTimeExtent:i})):o.validationState="name-required"}_storeAddBookmarkButton(t){this._addBookmarkButtonNode=t,this._focusAddBookmark()}_storeEditInput(t){this._editInputNode=t,this._focusEditInput()}_storeAddInput(t){this._addInputNode=t,this._focusAddInput()}_storeUrlEditInput(t){this._urlEditInputNode=t,this._focusUrlEditInput()}_focusUrlEditInput(){this._urlEditInputNode&&this._focusUrlEditInputBox&&(this._focusUrlEditInputBox=!1,this._urlEditInputNode.focus())}_focusAddInput(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())}_focusAddBookmark(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())}_focusEditInput(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())}_deleteBookmark(t){const e=$(t.currentTarget);e&&this.viewModel.bookmarks.remove(e)}_goToBookmark(t){const e=$(t.currentTarget);e&&(this.endAddBookmark(),this._closeEditBookmarkForm(),this.viewModel.goTo(e))}async _refreshThumbnail(){const{_userState:t,_editMenu:e,viewModel:o}=this;t&&(t.validationState=void 0,await o.editBookmark(t.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}),e.open=!1,this._focusEditInputBox=!0,this.scheduleRender())}_removeThumbnail(){const{_userState:t,_editMenu:e}=this;t!=null&&t.editedBookmark&&(t.editedBookmark.thumbnail=null,t.validationState=void 0,e.open=!1,this._focusEditInputBox=!0,this.scheduleRender())}_startUseImageUrl(){this._userState&&(this._userState.state="edit-thumbnail"),this._editMenu.open=!1,this._focusUrlEditInputBox=!0,this.scheduleRender()}_editBookmarkUrlSubmit(t){t.preventDefault();const{_urlEditInputNode:e,_userState:o}=this;if(!e||!o)return;const i=e.value;U.test(i)?(i&&o.editedBookmark&&(o.editedBookmark.thumbnail=new G({url:i})),this._closeUrlEditBookmarkForm()):o.validationState="absolute-url-required"}};function $(t){return t["data-bookmark"]}n([d()],u.prototype,"_editIncludeTimeExtent",void 0),n([d({type:O})],u.prototype,"_userState",void 0),n([d({readOnly:!0})],u.prototype,"_editMenuItems",null),n([d({readOnly:!0})],u.prototype,"_editMenu",null),n([d()],u.prototype,"defaultCreateOptions",null),n([d()],u.prototype,"defaultEditOptions",null),n([d()],u.prototype,"bookmarks",null),n([d()],u.prototype,"disabled",void 0),n([d()],u.prototype,"editingEnabled",void 0),n([d()],u.prototype,"headingLevel",void 0),n([d()],u.prototype,"goToOverride",null),n([d()],u.prototype,"iconClass",void 0),n([d()],u.prototype,"icon",void 0),n([d()],u.prototype,"label",null),n([d(),V("esri/widgets/Bookmarks/t9n/Bookmarks")],u.prototype,"messages",void 0),n([d(),V("esri/t9n/common")],u.prototype,"messagesCommon",void 0),n([d()],u.prototype,"uiStrings",void 0),n([d()],u.prototype,"view",null),n([d({type:K}),ut(["select-bookmark","bookmark-edit","bookmark-select"])],u.prototype,"viewModel",void 0),n([d()],u.prototype,"visibleElements",void 0),n([M("visibleElements")],u.prototype,"castVisibleElements",null),n([d()],u.prototype,"endAddBookmark",null),n([d()],u.prototype,"startAddBookmark",null),u=n([N(bt)],u);const Tt=u;export{Tt as default};

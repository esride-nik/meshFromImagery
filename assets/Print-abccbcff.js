import{a5 as l,a6 as u,a9 as N,bA as he,cb as ie,h3 as se,ah as qe,M as ut,ba as Dt,ae as ee,ch as te,dx as pt,cz as We,e3 as De,hg as Mt,eK as Et,e4 as ne,v as Y,ab as Vt,_ as Ft,ib as kt,iL as Ke,q$ as Nt,aY as X,qn as At,qo as Gt,r0 as Rt,S as He,hf as jt,w as ye,hH as Ut,C as Jt,r1 as Bt,be as me,gQ as zt,o as qt,r2 as Se,aZ as fe,s as oe,V as ct,j as dt,U as Wt,X as ht,b5 as Kt,b4 as Ht,kW as Zt,an as be,iu as Yt,hz as Qt,df as Xt,h7 as ea}from"./index-b516d057.js";import{e as Ze,O as ta,x as Ye,Y as aa,n as c,i as A}from"./jsxFactory-92036771.js";import{a as mt}from"./GPMessage-28c119de.js";import{o as ia}from"./floorFilterUtils-080a7cd2.js";import{e as x}from"./globalCss-94006b67.js";import{e as Qe}from"./Heading-92f210ca.js";import{y as sa}from"./Popover-ca6b0b13.js";import"./uuid-709b6c67.js";let B=class extends he{constructor(i){super(i),this.state="pending",this.url=""}initialize(){this.addHandles([ie(()=>[this.extension,this.name],()=>this._setFormattedFileName(),se)])}_setFormattedFileName(){if(!this.name||!this.extension)return;let i=this.name+"."+this.extension;this.count&&(i=this.name+"("+this.count+")."+this.extension),this.formattedName=i}};l([u()],B.prototype,"count",void 0),l([u()],B.prototype,"error",void 0),l([u()],B.prototype,"extension",void 0),l([u()],B.prototype,"formattedName",void 0),l([u()],B.prototype,"name",void 0),l([u()],B.prototype,"state",void 0),l([u()],B.prototype,"url",void 0),B=l([N("esri.widgets.print.FileLink")],B);const yt=B;let G=class extends he{constructor(){super(...arguments),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}};l([u({type:qe})],G.prototype,"outSpatialReference",void 0),l([u({type:ut})],G.prototype,"processExtent",void 0),l([u({type:qe})],G.prototype,"processSpatialReference",void 0),l([u({nonNullable:!0})],G.prototype,"returnFeatureCollection",void 0),l([u({nonNullable:!0})],G.prototype,"returnM",void 0),l([u({nonNullable:!0})],G.prototype,"returnZ",void 0),G=l([N("esri.rest.geoprocessor.GPOptions")],G),G.from=Dt(G);const Fe=G;let R=class extends ee{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};l([u({type:ut})],R.prototype,"extent",void 0),l([u()],R.prototype,"height",void 0),l([u()],R.prototype,"href",void 0),l([u()],R.prototype,"opacity",void 0),l([u()],R.prototype,"rotation",void 0),l([u()],R.prototype,"scale",void 0),l([u()],R.prototype,"visible",void 0),l([u()],R.prototype,"width",void 0),R=l([N("esri.layer.support.MapImage")],R);const Xe=R;let ce=class extends ee{constructor(i){super(i),this.itemId=null,this.url=null}};l([u({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],ce.prototype,"itemId",void 0),l([u({type:String,json:{write:!0}})],ce.prototype,"url",void 0),ce=l([N("esri.rest.support.DataFile")],ce);const Pe=ce,et=new te({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let de=class extends ee{constructor(i){super(i),this.distance=0,this.units=null}};l([u({json:{write:!0}})],de.prototype,"distance",void 0),l([u({json:{read:et.read,write:et.write}})],de.prototype,"units",void 0),de=l([N("esri.rest.support.LinearUnit")],de);const tt=de,na=new te({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"});let re=class extends ee{constructor(i){super(i),this.dataType=null,this.paramName=null,this.value=null}};l([pt(na,{ignoreUnknown:!1})],re.prototype,"dataType",void 0),l([u()],re.prototype,"paramName",void 0),l([u()],re.prototype,"value",void 0),re=l([N("esri.rest.support.ParameterValue")],re);const oa=re;let le=class extends ee{constructor(i){super(i),this.format=null,this.itemId=null,this.url=null}};l([u()],le.prototype,"format",void 0),l([u({json:{read:{source:"itemID"},write:{target:"itemID"}}})],le.prototype,"itemId",void 0),l([u()],le.prototype,"url",void 0),le=l([N("esri.rest.support.RasterData")],le);const at=le;async function ft(e,i,a,t,s){const n={},r={},p=[];return ra(t,p,n),Et(p).then(o=>{const{outSpatialReference:h,processExtent:g,processSpatialReference:d,returnFeatureCollection:b,returnM:w,returnZ:y}=a,{path:f}=ne(e);for(const j in n){const U=n[j];r[j]=o.slice(U[0],U[1])}const _=h?h.wkid||h:null,T=d?d.wkid||d:null,D=i==="execute"?{returnFeatureCollection:b||void 0,returnM:w||void 0,returnZ:y||void 0}:null,I=xe({...g?{context:{extent:g,outSR:_,processSR:T}}:{"env:outSR":_,"env:processSR":T},...t,...D,f:"json"},null,r),E={...s,query:I};return Y(`${f}/${i}`,E)})}function ra(e,i,a){for(const t in e){const s=e[t];if(s&&typeof s=="object"&&s instanceof De){const{features:n}=s;a[t]=[i.length,i.length+n.length],n.forEach(r=>{i.push(r.geometry)})}}}function Me(e){const i=e.dataType,a=oa.fromJSON(e);switch(i){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return a;case"GPDate":a.value=new Date(a.value);break;case"GPDataFile":a.value=Pe.fromJSON(a.value);break;case"GPLinearUnit":a.value=tt.fromJSON(a.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const t=e.value.url;a.value=t?Pe.fromJSON(a.value):De.fromJSON(a.value);break}case"GPRasterData":case"GPRasterDataLayer":{const t=e.value.mapImage;a.value=t?Xe.fromJSON(t):at.fromJSON(a.value);break}case"GPField":a.value=We.fromJSON(a.value);break;case"GPMultiValue:GPDate":{const t=a.value;a.value=t.map(s=>new Date(s));break}case"GPMultiValue:GPDataFile":a.value=a.value.map(t=>Pe.fromJSON(t));break;case"GPMultiValue:GPLinearUnit":a.value=a.value.map(t=>tt.fromJSON(t));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":a.value=a.value.map(t=>De.fromJSON(t));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":a.value=a.value.map(t=>t?Xe.fromJSON(t):at.fromJSON(a.value));break;case"GPMultiValue:GPField":a.value=a.value.map(t=>We.fromJSON(t))}return a}function xe(e,i,a){for(const t in e){const s=e[t];Array.isArray(s)?e[t]=JSON.stringify(s.map(n=>xe({item:n},!0).item)):s instanceof Date&&(e[t]=s.getTime())}return Mt(e,i,a)}async function bt(e,i,a,t){return a=Fe.from(a||{}),ft(e,"execute",a,i??{},t).then(s=>{const n=s.data.results||[],r=s.data.messages||[];return{results:n.map(Me),messages:r.map(p=>mt.fromJSON(p))}})}var ve;const la=Vt()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let q=ve=class extends ee{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:i,sourceUrl:a}=this,{path:t}=ne(a),s={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const n=`${t}/jobs/${i}/cancel`,{data:r}=await Y(n,s),{messages:p,jobStatus:o,progress:h}=ve.fromJSON(r);return this.set({messages:p,jobStatus:o,progress:h}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:i}=ne(this.sourceUrl),a={...this.requestOptions,...e,query:{f:"json"}},t=`${i}/jobs/${this.jobId}`,{data:s}=await Y(t,a),{messages:n,jobStatus:r,progress:p}=ve.fromJSON(s);return this.set({messages:n,jobStatus:r,progress:p}),this}async fetchResultData(e,i,a){i=Fe.from(i||{});const{returnFeatureCollection:t,returnM:s,returnZ:n,outSpatialReference:r}=i,{path:p}=ne(this.sourceUrl),o=xe({returnFeatureCollection:t,returnM:s,returnZ:n,outSR:r,returnType:"data",f:"json"},null),h={...this.requestOptions,...a,query:o},g=`${p}/jobs/${this.jobId}/results/${e}`,{data:d}=await Y(g,h);return Me(d)}async fetchResultImage(e,i,a){const{path:t}=ne(this.sourceUrl),s={...i.toJSON(),f:"json"},n=xe(s),r={...this.requestOptions,...a,query:n},p=`${t}/jobs/${this.jobId}/results/${e}`,{data:o}=await Y(p,r);return Me(o)}async fetchResultMapImageLayer(){const{path:e}=ne(this.sourceUrl),i=e.indexOf("/GPServer/"),a=`${e.substring(0,i)}/MapServer/jobs/${this.jobId}`;return new(await Ft(()=>import("./MapImageLayer-35689dc1.js"),["assets/MapImageLayer-35689dc1.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/loadAll-5e767cfa.js","assets/scaleUtils-72744379.js","assets/APIKeyMixin-bfb00271.js","assets/SublayersOwner-0f33bba5.js","assets/Version-1f969b2a.js","assets/CollectionFlattener-193451da.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/QueryTask-c8bdd708.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/executeForIds-dd65ee28.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/OptimizedGeometry-196224d4.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-d7a48772.js","assets/executeQueryJSON-eec0ecca.js","assets/executeQueryPBF-ba35ba83.js","assets/featureConversionUtils-09cf00ff.js","assets/FeatureType-f30c4b8b.js","assets/FeatureTemplate-d1d1c7be.js","assets/LabelClass-c3c309a8.js","assets/labelUtils-b29175f3.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/labelingInfo-aae625ac.js","assets/LayerFloorInfo-4234db4d.js","assets/serviceCapabilitiesUtils-42d4d20c.js","assets/AttachmentQuery-bede5a71.js","assets/sublayerUtils-4fbad2bd.js","assets/ExportImageParameters-eb8f9ddb.js","assets/floorFilterUtils-080a7cd2.js","assets/imageBitmapUtils-064ef341.js","assets/versionUtils-5892620e.js"])).default({url:a})}async waitForJobCompletion(e={}){const{interval:i=1e3,signal:a,statusCallback:t}=e;return new Promise((s,n)=>{kt(a,()=>{this._clearTimer(),n(Ke())}),this._clearTimer();const r=setInterval(()=>{this._timer||n(Ke()),this.checkJobStatus(this.requestOptions).then(p=>{const{jobStatus:o}=p;switch(this.jobStatus=o,o){case"job-succeeded":this._clearTimer(),s(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":t&&t(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),n(this)}})},i);this._timer=r})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};l([u()],q.prototype,"jobId",void 0),l([pt(la,{ignoreUnknown:!1})],q.prototype,"jobStatus",void 0),l([u({type:[mt]})],q.prototype,"messages",void 0),l([u()],q.prototype,"progress",void 0),l([u()],q.prototype,"requestOptions",void 0),l([u({json:{write:!0}})],q.prototype,"sourceUrl",void 0),q=ve=l([N("esri.rest.support.JobInfo")],q);const ua=q;async function pa(e,i,a,t){return a=Fe.from(a||{}),ft(e,"submitJob",a,i??{},t).then(s=>{const n=ua.fromJSON(s.data);return n.sourceUrl=e,n})}const Oe=new te({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),Ee=Oe.fromJSON.bind(Oe),ca=Oe.toJSON.bind(Oe),Ie=new te({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),we=Ie.fromJSON.bind(Ie),da=Ie.toJSON.bind(Ie),Ce="simple-marker",ha="picture-marker",it="simple-line",ma="simple-fill",ya="shield-label-symbol",fa="text";function ba(e,i){const{graphic:a,renderer:t,symbol:s}=i,n=s.type;if(n===fa||n===ya||!("visualVariables"in t)||!t.visualVariables)return;const r=t.getVisualVariablesForType("size"),p=t.getVisualVariablesForType("color"),o=t.getVisualVariablesForType("opacity"),h=t.getVisualVariablesForType("rotation"),g=r[0],d=p[0],b=o[0],w=h[0];if(g){const y=n===Ce?s.style:null,f=Nt(g,a,{shape:y});f!=null&&(n===Ce?e.size=X(f):n===ha?(e.width=X(f),e.height=X(f)):n===it?e.width=X(f):e.outline&&(e.outline.width=X(f)))}if(d){const y=At(d,a);(y&&n===Ce||n===it||n===ma)&&(e.color=y?y.toJSON():void 0)}if(b){const y=Gt(b,a);y!=null&&e.color&&(e.color[3]=Math.round(255*y))}w&&(e.angle=-Rt(t,a))}function ga(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function va(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function st(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function wa(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function _a(e,i=15){const a=e.canvas.width,t=e.canvas.height,s=e.getImageData(0,0,a,t).data;let n,r,p,o,h,g;e:for(r=t;r--;)for(n=a;n--;)if(s[4*(a*r+n)+3]>i){g=r;break e}if(!g)return null;e:for(n=a;n--;)for(r=g+1;r--;)if(s[4*(a*r+n)+3]>i){h=n;break e}e:for(n=0;n<=h;++n)for(r=g+1;r--;)if(s[4*(a*r+n)+3]>i){p=n;break e}e:for(r=0;r<=g;++r)for(n=p;n<=h;++n)if(s[4*(a*r+n)+3]>i){o=r;break e}return{x:p,y:o,width:h-p,height:g-o}}function Ta(e,i){const a=e.allLayerViews.items;if(i===e.scale)return a.filter(s=>!s.suspended);const t=new Array;for(const s of a)Oa(s.parent)&&!t.includes(s.parent)||!s.visible||i&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(i)||t.push(s);return t}function Sa(e){return(e==null?void 0:e.type)==="bing-maps"}function gt(e){return e&&"blendMode"in e&&"effect"in e}function xa(e){return(e==null?void 0:e.type)==="csv"}function Oa(e){return(e==null?void 0:e.declaredClass)==="esri.views.2d.layers.GroupLayerView2D"}function Ia(e){const i=e.layer;if(gt(i)){const a=i.blendMode;if((!a||a==="normal")&&(i.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let C=class extends he{constructor(i){super(i),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};l([u()],C.prototype,"attributionVisible",void 0),l([u()],C.prototype,"exportOptions",void 0),l([u()],C.prototype,"forceFeatureAttributes",void 0),l([u()],C.prototype,"format",void 0),l([u()],C.prototype,"includeCharts",void 0),l([u()],C.prototype,"includeTables",void 0),l([u()],C.prototype,"label",void 0),l([u()],C.prototype,"layout",void 0),l([u({type:He})],C.prototype,"layoutItem",void 0),l([u()],C.prototype,"layoutOptions",void 0),l([u()],C.prototype,"outScale",void 0),l([u()],C.prototype,"report",void 0),l([u({type:He})],C.prototype,"reportItem",void 0),l([u()],C.prototype,"reportOptions",void 0),l([u()],C.prototype,"scalePreserved",void 0),l([u()],C.prototype,"showLabels",void 0),C=l([N("esri.rest.support.PrintTemplate")],C);const vt=C,Le=new te({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});Le.fromJSON.bind(Le);const La=Le.toJSON.bind(Le),nt={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},ot=new te({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),$a=new te({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Ve=new Map;async function Pa(e,i,a){const t=Ma(e);let s=Ve.get(t);return Promise.resolve().then(()=>s?{data:s.gpMetadata}:(s={gpServerUrl:t,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},Y(t,jt({f:"json"},a)))).then(n=>(s.gpMetadata=n.data,s.cimVersion=s.gpMetadata.cimVersion,s.is11xService=!!s.cimVersion,Ve.set(t,s),Ca(i,s))).then(n=>{const r=Qa(s);let p;const o=h=>{var g,d;return r==="sync"?(d=(g=h.results)==null?void 0:g[0])==null?void 0:d.value:p.fetchResultData("Output_File",null,a).then(b=>b.value)};return r==="async"?pa(e,n,void 0,a).then(h=>(p=h,h.waitForJobCompletion({interval:i.updateDelay}).then(o))):bt(e,n,void 0,a).then(o)})}async function Ca(e,i){i=i||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const a=e.template||new vt;a.showLabels==null&&(a.showLabels=!0);const t=a.exportOptions;let s;const n=da(a.layout);if(t&&(s={dpi:t.dpi},n.toLowerCase()==="map_only"||n==="")){const d=t.width,b=t.height;s.outputSize=d!=null&&b!=null?[d,b]:void 0}const r=a.layoutOptions;let p;if(r){let d,b;r.scalebarUnit==="Miles"||r.scalebarUnit==="Kilometers"?(d="Kilometers",b="Miles"):r.scalebarUnit!=="Meters"&&r.scalebarUnit!=="Feet"||(d="Meters",b="Feet"),p={titleText:r.titleText,authorText:r.authorText,copyrightText:r.copyrightText,customTextElements:r.customTextElements,elementOverrides:r.elementOverrides,scaleBarOptions:{metricUnit:ot.toJSON(d),metricLabel:d?nt[d]:void 0,nonMetricUnit:ot.toJSON(b),nonMetricLabel:b?nt[b]:void 0}}}let o=null;r!=null&&r.legendLayers&&(o=r.legendLayers.map(d=>{const b=d.layerId;i.legendLayerNameMap[b]=d.title;const w={id:b};return d.subLayerIds&&(w.subLayerIds=d.subLayerIds),w}));const h=await Da(e,a,i);if(h.operationalLayers){const d=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),b=/[\u0600-\u06FF]/,w=f=>{var I;const _=f.text,T=f.font,D=(I=T==null?void 0:T.family)==null?void 0:I.toLowerCase();_&&T&&(D==="arial"||D==="arial unicode ms")&&(T.family=d.test(_)?"Arial Unicode MS":"Arial",T.style!=="normal"&&b.test(_)&&(T.family="Arial Unicode MS"))},y=()=>{throw new oe("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};h.operationalLayers.forEach(f=>{var _,T,D;(_=f.featureCollection)!=null&&_.layers?f.featureCollection.layers.forEach(I=>{var E,j,U,H;if((U=(j=(E=I.layerDefinition)==null?void 0:E.drawingInfo)==null?void 0:j.renderer)!=null&&U.symbol){const k=I.layerDefinition.drawingInfo.renderer;k.symbol.type==="esriTS"?w(k.symbol):k.symbol.type!=="CIMSymbolReference"||i.is11xService||y()}(H=I.featureSet)!=null&&H.features&&I.featureSet.features.forEach(k=>{k.symbol&&(k.symbol.type==="esriTS"?w(k.symbol):k.symbol.type!=="CIMSymbolReference"||i.is11xService||y())})}):!i.is11xService&&((D=(T=f.layerDefinition)==null?void 0:T.drawingInfo)!=null&&D.renderer)&&JSON.stringify(f.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&y()})}e.outSpatialReference&&(h.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(h,{exportOptions:s,layoutOptions:p||{}}),Object.assign(h.layoutOptions,{legendOptions:{operationalLayers:o??i.legendLayers.slice()}}),i.legendLayers.length=0,Ve.set(i.gpServerUrl,i);const g={Web_Map_as_JSON:JSON.stringify(h),Format:ca(a.format),Layout_Template:n,Layout_Item_ID:void 0,Report_Template:La(a.report),Report_Item_ID:void 0};if(a.layoutItem){delete g.Layout_Template;const d=a.layoutItem;await d.load(),d.access!=="public"&&ye&&await ye.getCredential(i.gpServerUrl),g.Layout_Item_ID=JSON.stringify({id:d.id})}if(a.reportItem){delete g.Report_Template;const d=a.reportItem;await d.load(),d.access!=="public"&&ye&&await ye.getCredential(i.gpServerUrl),g.Report_Item_ID=JSON.stringify({id:d.id})}return e.extraParameters&&Object.assign(g,e.extraParameters),g}async function Da(e,i,a){const t=e.view;let s=t.spatialReference;const n={operationalLayers:await Ea(t,i,a)};i.includeTables&&(n.tables=await qa(t));let r=a.ssExtent||e.extent||t.extent;if(s&&s.isWrappable&&(r=r.clone()._normalize(!0),s=r.spatialReference),n.mapOptions={extent:r&&r.toJSON(),spatialReference:s&&s.toJSON(),showAttribution:i.attributionVisible},a.ssExtent=null,t.background&&(n.background=t.background.toJSON()),t.rotation&&(n.mapOptions.rotation=-t.rotation),i.scalePreserved&&(n.mapOptions.scale=i.outScale||t.scale),t.timeExtent!=null){const p=t.timeExtent.start!=null?t.timeExtent.start.getTime():null,o=t.timeExtent.end!=null?t.timeExtent.end.getTime():null;n.mapOptions.time=[p,o]}return i.reportOptions&&(n.reportOptions=i.reportOptions),n}function Ma(e){let i=e;const a=i.lastIndexOf("/GPServer/");return a>0&&(i=i.slice(0,a+9)),i}async function Ea(e,i,a){const t=[],s={layerView:null,printTemplate:i,view:e};let n=0;i.scalePreserved&&(n=i.outScale||e.scale);const r=Ta(e,n);for(const p of r){const o=p.layer;if(!o.loaded||(o==null?void 0:o.type)==="group")continue;let h;s.layerView=p,h=Ia(p)?await ue(o,s,a):Sa(o)?Va(o):xa(o)?await Fa(o,s,a):(o==null?void 0:o.type)==="feature"?await ka(o,s,a):(o==null?void 0:o.type)==="geojson"?await Na(o,s,a):(o==null?void 0:o.type)==="graphics"?await Aa(o,s,a):(o==null?void 0:o.type)==="imagery"?Ga(o,a):(o==null?void 0:o.type)==="imagery-tile"?await Ra(o,s,a):(o==null?void 0:o.type)==="kml"?await ja(o,s,a):(o==null?void 0:o.type)==="map-image"?Ua(o,s,a):(o==null?void 0:o.type)==="map-notes"?await Ja(s,a):(o==null?void 0:o.type)==="open-street-map"?Ba():(o==null?void 0:o.type)==="stream"?await za(o,s,a):(o==null?void 0:o.type)==="tile"?Wa(o,a):(o==null?void 0:o.type)==="vector-tile"?await Ka(o,s,a):(o==null?void 0:o.type)==="web-tile"?Ha(o):(o==null?void 0:o.type)==="wms"?Za(o,a):(o==null?void 0:o.type)==="wmts"?Ya(o):await ue(o,s,a),h&&(Array.isArray(h)?t.push(...h):(h.id=o.id,h.title=a.legendLayerNameMap[o.id]||o.title,h.opacity=o.opacity,h.minScale=o.minScale||0,h.maxScale=o.maxScale||0,gt(o)&&o.blendMode&&o.blendMode!=="normal"&&(h.blendMode=o.blendMode),t.push(h)))}if(n&&t.forEach(p=>{p.minScale=0,p.maxScale=0}),e.graphics&&e.graphics.length){const p=await K(null,e.graphics,i,a);p&&t.push(p)}return t}function Va(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function Fa(e,i,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const t=i.layerView,s=i.printTemplate;let n;return!a.is11xService||t.filter?K(e,await $e(t),s,a):(n={type:"CSV"},e.write(n,{origin:"web-map"}),delete n.popupInfo,delete n.layerType,n.showLabels=s.showLabels&&e.labelsVisible,n)}async function K(e,i,a,t){var _,T,D,I,E,j,U,H,k;let s;const n=va(),r=wa(),p=st(),o=ga(),h=st();if(h.layerDefinition.name="textLayer",delete h.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?n.layerDefinition.name=r.layerDefinition.name=p.layerDefinition.name=o.layerDefinition.name=t.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(i=e.graphics.items),e.renderer){const O=e.renderer.toJSON(),S=n.layerDefinition.drawingInfo;S&&(S.renderer=O);const V=r.layerDefinition.drawingInfo;V&&(V.renderer=O);const M=p.layerDefinition.drawingInfo;M&&(M.renderer=O);const F=o.layerDefinition.drawingInfo;F&&(F.renderer=O)}if(a.showLabels&&e.labelsVisible&&typeof e.write=="function"){const O=e.write({},{origin:"web-map"}),S=(T=(_=O.layerDefinition)==null?void 0:_.drawingInfo)==null?void 0:T.labelingInfo;if(S){s=!0;const V=n.layerDefinition.drawingInfo;V&&(V.labelingInfo=S);const M=r.layerDefinition.drawingInfo;M&&(M.labelingInfo=S);const F=p.layerDefinition.drawingInfo;F&&(F.labelingInfo=S);const Q=o.layerDefinition.drawingInfo;Q&&(Q.labelingInfo=S)}}}let g;e!=null&&e.renderer||s||(delete n.layerDefinition.drawingInfo,delete r.layerDefinition.drawingInfo,delete p.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo);const d=e==null?void 0:e.fieldsIndex,b=e==null?void 0:e.renderer;if(d){const O=new Set;s&&await Ut(O,e),b&&typeof b.collectRequiredFields=="function"&&await b.collectRequiredFields(O,d),g=Array.from(O);const S=d.fields.map(V=>V.toJSON());n.layerDefinition.fields=S,r.layerDefinition.fields=S,p.layerDefinition.fields=S,o.layerDefinition.fields=S}const w=i==null?void 0:i.length;let y;for(let O=0;O<w;O++){const S=i[O]||i.at(O);if(S.visible===!1||!S.geometry||(y=S.toJSON(),y.hasOwnProperty("popupTemplate")&&delete y.popupTemplate,(D=y.geometry)!=null&&D.z&&delete y.geometry.z,((I=y.symbol)==null?void 0:I.outline)&&y.symbol.outline.type==="esriCLS"&&!t.is11xService))continue;!t.is11xService&&((U=(j=(E=y.symbol)==null?void 0:E.outline)==null?void 0:j.color)!=null&&U[3])&&(y.symbol.outline.color[3]=255);const V=(e==null?void 0:e.renderer)&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!y.symbol&&(e!=null&&e.renderer)&&V&&!t.is11xService){const M=e.renderer,F=await M.getSymbolAsync(S);if(!F)continue;y.symbol=F.toJSON(),"hasVisualVariables"in M&&M.hasVisualVariables()&&ba(y.symbol,{renderer:M,graphic:S,symbol:F})}if(y.symbol&&(y.symbol.angle||delete y.symbol.angle,Te(y.symbol)?y.symbol=await _e(y.symbol,t):y.symbol.text&&delete y.attributes),(!a||!a.forceFeatureAttributes)&&(g==null?void 0:g.length)){const M={};g.forEach(F=>{var Q;(Q=y.attributes)!=null&&Q.hasOwnProperty(F)&&(M[F]=y.attributes[F])}),y.attributes=M}S.geometry.type==="polygon"?n.featureSet.features.push(y):S.geometry.type==="polyline"?r.featureSet.features.push(y):S.geometry.type==="point"?(H=y.symbol)!=null&&H.text?h.featureSet.features.push(y):p.featureSet.features.push(y):S.geometry.type==="multipoint"?o.featureSet.features.push(y):S.geometry.type==="extent"&&(y.geometry=Jt.fromExtent(S.geometry).toJSON(),n.featureSet.features.push(y))}const f=[n,r,o,p,h].filter(O=>O.featureSet.features.length>0);for(const O of f){const S=O.featureSet.features.every(V=>V.symbol);!S||a&&a.forceFeatureAttributes||O.featureSet.features.forEach(V=>{delete V.attributes}),S&&delete O.layerDefinition.drawingInfo,(k=O.layerDefinition.drawingInfo)!=null&&k.renderer&&await wt(O.layerDefinition.drawingInfo.renderer,t)}return f.length?{featureCollection:{layers:f},showLabels:s}:null}async function ka(e,i,a){var b,w,y,f,_,T;let t;const s=e.renderer,n=parseFloat(a.cimVersion);if(((b=e.featureReduction)==null?void 0:b.type)==="binning"||((w=e.featureReduction)==null?void 0:w.type)==="cluster"&&(!a.is11xService||n<2.9)||(s==null?void 0:s.type)==="pie-chart"||(s==null?void 0:s.type)==="dot-density"&&(!a.is11xService||n<2.6))return ue(e,i,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const r=i.layerView,{printTemplate:p,view:o}=i,h=s&&("valueExpression"in s&&s.valueExpression||"hasVisualVariables"in s&&s.hasVisualVariables()),g=((y=e.source)==null?void 0:y.type)!=="feature-layer"&&((f=e.source)==null?void 0:f.type)!=="ogc-feature";if(!a.is11xService&&h||r.filter||g||!s||"field"in s&&s.field!=null&&(typeof s.field!="string"||!e.getField(s.field))){const D=await $e(r);t=await K(e,D,p,a)}else{if(t={id:(d=e.write()).id,title:d.title,opacity:d.opacity,minScale:d.minScale,maxScale:d.maxScale,url:d.url,layerType:d.layerType,customParameters:d.customParameters,layerDefinition:d.layerDefinition,charts:p.includeCharts?d.charts:void 0},t.showLabels=p.showLabels&&e.labelsVisible,pe(t,e),((T=(_=t.layerDefinition)==null?void 0:_.drawingInfo)==null?void 0:T.renderer)&&(delete t.layerDefinition.minScale,delete t.layerDefinition.maxScale,await wt(t.layerDefinition.drawingInfo.renderer,a),"visualVariables"in s&&s.visualVariables&&s.visualVariables[0])){const I=s.visualVariables[0];if(I.type==="size"&&I.maxSize&&typeof I.maxSize!="number"&&I.minSize&&typeof I.minSize!="number"){const E=Bt(I,o.scale);t.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=E.minSize,t.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=E.maxSize}}const D=ia(r);D&&(t.layerDefinition||(t.layerDefinition={}),t.layerDefinition.definitionExpression=t.layerDefinition.definitionExpression?`(${t.layerDefinition.definitionExpression}) AND (${D})`:D)}var d;return t}async function Na(e,i,a){var t,s;return((t=e.featureReduction)==null?void 0:t.type)==="binning"||((s=e.featureReduction)==null?void 0:s.type)==="cluster"?ue(e,i,a):(e.legendEnabled&&a.legendLayers.push({id:e.id}),K(e,await $e(i.layerView),i.printTemplate,a))}async function Aa(e,{printTemplate:i},a){return K(e,null,i,a)}function Ga(e,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a={layerType:(t=e.write()).layerType,customParameters:t.customParameters};var t;if(a.bandIds=e.bandIds,a.compressionQuality=e.compressionQuality,a.format=e.format,a.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(a.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction||e.renderer)if(i.is11xService)e.rasterFunction&&(a.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(a.layerDefinition=a.layerDefinition||{},a.layerDefinition.drawingInfo=a.layerDefinition.drawingInfo||{},a.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const s=e.exportImageServiceParameters.combineRendererWithRenderingRule();s&&(a.renderingRule=s.toJSON())}return pe(a,e),a}async function Ra(e,i,a){var n;if(((n=e.renderer)==null?void 0:n.type)==="flow")return ue(e,i,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const t={bandIds:(s=e.write()||{}).bandIds,customParameters:s.customParameters,interpolation:s.interpolation,layerDefinition:s.layerDefinition};var s;return t.layerType="ArcGISImageServiceLayer",pe(t,e),t}async function ja(e,i,a){const t=i.printTemplate;if(a.is11xService){const s={type:"kml"};return e.write(s,{origin:"web-map"}),delete s.layerType,s.url=me(e.url),s}{const s=[],n=i.layerView;n.allVisibleMapImages.forEach((o,h)=>{const g={id:`${e.id}_image${h}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:o.extent};o.href.substr(0,22)==="data:image/png;base64,"?g.imageData=o.href.substr(22):g.url=o.href,s.push(g)});const r=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],p={id:e.id,...await K(null,r,t,a)};return s.push(p),s}}function Ua(e,{view:i},a){var h,g;let t;const s={id:e.id,subLayerIds:[]};let n=[];const r=i.scale,p=d=>{const b=r===0,w=d.minScale===0||r<=d.minScale,y=d.maxScale===0||r>=d.maxScale;if(d.visible&&(b||w&&y))if(d.sublayers)d.sublayers.forEach(p);else{const f=d.toExportImageJSON(),_={id:d.id,name:d.title,layerDefinition:{drawingInfo:f.drawingInfo,definitionExpression:f.definitionExpression,source:f.source}};n.unshift(_),s.subLayerIds.push(d.id)}};var o;return e.sublayers&&e.sublayers.forEach(p),n.length&&(n=n.map(({id:d,name:b,layerDefinition:w})=>({id:d,name:b,layerDefinition:w})),t={layerType:(o=e.write()).layerType,customParameters:o.customParameters},t.layers=n,t.visibleLayers=(g=(h=e.capabilities)==null?void 0:h.exportMap)!=null&&g.supportsDynamicLayers?void 0:s.subLayerIds,pe(t,e),e.legendEnabled&&a.legendLayers.push(s)),t}async function Ja({layerView:e,printTemplate:i},a){const t=[],s=e.layer;if(s.featureCollections!=null)for(const n of s.featureCollections){const r=await K(n,n.source,i,a);r&&t.push(...r.featureCollection.layers)}else if(s.sublayers!=null)for(const n of s.sublayers){const r=await K(null,n.graphics,i,a);r&&t.push(...r.featureCollection.layers)}return{featureCollection:{layers:t}}}function Ba(){return{type:"OpenStreetMap"}}async function ue(e,{printTemplate:i,view:a},t){var d;const s={type:"image"},n={format:"png",ignoreBackground:!0,layers:[e],rotation:0},r=t.ssExtent||a.extent.clone();let p=96,o=!0,h=!0;if(i.exportOptions){const b=i.exportOptions;b.dpi!=null&&b.dpi>0&&(p=b.dpi),b.width!=null&&b.width>0&&(o=b.width%2==a.width%2),b.height!=null&&b.height>0&&(h=b.height%2==a.height%2)}if(i.layout==="map-only"&&i.scalePreserved&&(!i.outScale||i.outScale===a.scale)&&p===96&&(!o||!h)&&(n.area={x:0,y:0,width:a.width,height:a.height},o||(n.area.width-=1),h||(n.area.height-=1),!t.ssExtent)){const b=a.toMap(zt(n.area.width,n.area.height));r.ymin=b.y,r.xmax=b.x,t.ssExtent=r}s.extent=r.clone()._normalize(!0).toJSON();const g=await a.takeScreenshot(n);return s.imageData=(d=qt(g.dataUrl))==null?void 0:d.data,s}async function za(e,{layerView:i,printTemplate:a},t){return e.legendEnabled&&t.legendLayers.push({id:e.id}),K(e,await $e(i),a,t)}async function qa(e){var s,n;const i=[],a=[];for(const r of e.map.allTables)r.type!=="feature"||r.loaded||a.push(r.load());a.length&&await Promise.allSettled(a);for(const r of e.map.allTables)if(r.type==="feature"&&r.loaded&&r.isTable&&((s=r.source)==null?void 0:s.type)==="feature-layer"){const p={id:(t=r.write()).id,title:t.title,customParameters:t.customParameters,layerDefinition:{definitionExpression:(n=t.layerDefinition)==null?void 0:n.definitionExpression},url:t.url};pe(p,r),i.push(p)}var t;return i.length?i:void 0}function Wa(e,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const a={layerType:(t=e.write()).layerType,customParameters:t.customParameters};var t;return pe(a,e),a}async function Ka(e,i,a){if(a.is11xService&&e.serviceUrl&&e.styleUrl){const t=Se(e.styleUrl,e.apiKey),s=Se(e.serviceUrl,e.apiKey);if(!t&&!s||a.cimVersion!=="2.1.0"){const n={type:"VectorTileLayer"};return n.styleUrl=me(e.styleUrl),n.token=t,s!==t&&(n.additionalTokens=[{url:e.serviceUrl,token:s}]),n}}return ue(e,i,a)}function Ha(e){var t;const i=(t=e.urlTemplate)==null?void 0:t.replace(/\${/g,"{"),a={type:"WebTiledLayer",urlTemplate:i,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(a.subDomains=e.subDomains),a}function Za(e,i){let a;const t=[],s=n=>{n.visible&&(n.sublayers?n.sublayers.forEach(s):n.name&&t.unshift(n.name))};return e.sublayers&&e.sublayers.forEach(s),t.length&&(e.legendEnabled&&i.legendLayers.push({id:e.id,subLayerIds:t}),a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:t,url:me(e.url),version:e.version}),a}function Ya(e){const i=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:i.imageFormat,layer:i.id,style:i.styleId,tileMatrixSet:i.tileMatrixSetId,url:me(e.url)}}function pe(e,i){i.url&&(e.url=me(e.url||i.url),e.token=Se(e.url,i.apiKey))}async function _e(e,i){var r;i.canvas||(i.canvas=document.createElement("canvas"));const a=1024;i.canvas.width=a,i.canvas.height=a;const t=i.canvas.getContext("2d");let s,n;if(e.path){const p=new Path2D(e.path);p.closePath(),t.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",t.fill(p);const o=_a(t);if(!o)return null;t.clearRect(0,0,a,a);const h=fe(e.size)/Math.max(o.width,o.height);t.scale(h,h);const g=a/h,d=g/2-o.width/2-o.x,b=g/2-o.height/2-o.y;if(t.translate(d,b),Array.isArray(e.color)&&t.fill(p),((r=e.outline)==null?void 0:r.width)&&Array.isArray(e.outline.color)){const y=e.outline;t.lineWidth=fe(y.width)/h,t.lineJoin="round",t.strokeStyle=`rgba(${y.color[0]},${y.color[1]},${y.color[2]},${y.color[3]/255})`,t.stroke(p),o.width+=t.lineWidth,o.height+=t.lineWidth}o.width*=h,o.height*=h;const w=t.getImageData(a/2-o.width/2,a/2-o.height/2,Math.ceil(o.width),Math.ceil(o.height));s=w.width,n=w.height,t.canvas.width=s,t.canvas.height=n,t.putImageData(w,0,0)}else{const p=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,o=(await Y(p,{responseType:"image"})).data;s=fe(e.width),n=fe(e.height),t.canvas.width=s,t.canvas.height=n,t.drawImage(o,0,0,t.canvas.width,t.canvas.height)}return{type:"esriPMS",imageData:t.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:X(n),width:X(s),xoffset:e.xoffset,yoffset:e.yoffset}}async function wt(e,i){const a=e.type;if(a==="simple"&&Te(e.symbol))e.symbol=await _e(e.symbol,i);else if(a==="uniqueValue"||a==="classBreaks"){Te(e.defaultSymbol)&&(e.defaultSymbol=await _e(e.defaultSymbol,i));const t=e[a==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(t)for(const s of t)Te(s.symbol)&&(s.symbol=await _e(s.symbol,i))}}async function $e(e){return e.queryFeatures(e.createQuery()).then(i=>i.features)}function Qa(e){var i;return(i=e.gpMetadata)!=null&&i.executionType?$a.fromJSON(e.gpMetadata.executionType):"sync"}function Te(e){var i;return e&&(e.path||e.contentType==="image/svg+xml"||((i=e.url)==null?void 0:i.endsWith(".svg")))}let W=class extends he{constructor(i){super(i),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};l([u()],W.prototype,"extent",void 0),l([u()],W.prototype,"extraParameters",void 0),l([u()],W.prototype,"outSpatialReference",void 0),l([u()],W.prototype,"template",void 0),l([u()],W.prototype,"updateDelay",void 0),l([u()],W.prototype,"view",void 0),W=l([N("esri.rest.support.PrintParameters")],W);const Xa=W;let Z=class extends ee{constructor(i){super(i),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutOptions=null}};l([u()],Z.prototype,"description",void 0),l([u({json:{read:Ee}})],Z.prototype,"format",void 0),l([u()],Z.prototype,"label",void 0),l([u({json:{read:we}})],Z.prototype,"layout",void 0),l([u()],Z.prototype,"layoutOptions",void 0),Z=l([N("esri.widgets.Print.CustomTemplate")],Z);const _t=Z,Tt=ct.ofType(_t);function ei(e){var a;e.layoutOptions??(e.layoutOptions={}),(a=e.layoutOptions).customTextElements??(a.customTextElements=[]);const i="date";if(!e.layoutOptions.customTextElements.find(t=>i in t)){const{customTextElements:t}=e.layoutOptions;let s=Kt(Date.now(),Ht("short-date"));Zt()==="ar"&&(s="â€"+s),t.push({date:s})}}let L=class extends Wt{constructor(e){super(e),this._serviceTemplateCustomTextElements=null,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new Tt,this.extraParameters=null,this.includeDefaultTemplates=!0,this.error=null,this.portal=dt.getDefault(),this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null,this.print=this.print.bind(this)}destroy(){this.view=null}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const e=ht(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(i=>{var t;const a=e[i];if(a){const s=(t=this.templateCustomTextElements)==null?void 0:t[i];a.forEach(n=>{const[r]=Object.entries(n)[0];s==null||s.forEach(p=>{const[o,h]=Object.entries(p)[0];r===o&&(n[r]=h)})})}}),Object.freeze(e)}get state(){var e;return this.loadStatus==="loading"?"initializing":this.error||this.loadStatus==="failed"?"error":(e=this.view)!=null&&e.ready&&this.loadStatus==="loaded"?"ready":"disabled"}async load(e){return this.addResolvingPromise(this._loadResources(e).catch(i=>this.error=i)),this}async print(e){const{view:i,extraParameters:a,updateDelay:t}=this;if(!i)throw new oe("print:view-required","view is not set");ei(e);const s=new Xa({view:i,template:e,extraParameters:a,updateDelay:t});try{return await Pa(this.effectivePrintServiceUrl,s,{timeout:this.printTimeout})}catch(n){throw new oe("print:export-error","An error occurred while exporting the web map.",{error:n})}}toPrintTemplate({attributionEnabled:e,author:i,copyright:a,customTextElements:t,dpi:s,forceFeatureAttributes:n,format:r,height:p,includeTables:o,layout:h,legendEnabled:g,northArrowEnabled:d,scale:b,scaleEnabled:w,title:y,width:f}){const _=new vt({attributionVisible:e,forceFeatureAttributes:n,format:r,includeTables:o,layout:h,layoutOptions:{authorText:i||"",copyrightText:a||"",customTextElements:t,titleText:y||""},outScale:b??0,scalePreserved:w});f&&(_.exportOptions.width=f),p&&(_.exportOptions.height=p),s&&(_.exportOptions.dpi=s),!g&&_.layoutOptions&&(_.layoutOptions.legendLayers=[]);const T=this.templateToNorthArrowInfo[h];return T&&T.visible!==d&&_.layoutOptions&&(_.layoutOptions.elementOverrides={[T.name]:{visible:d}}),_}async _loadResources(e){var s,n;let i=[];const{printServiceUrl:a}=this;if(!a){if(this.destroyed)return;const{portal:r}=this;try{await r.load(e)}catch{throw new oe("print:could-not-load-portal","Cannot load print resource information from portal",{url:this.effectivePrintServiceUrl})}const p=(s=r.helperServices)==null?void 0:s.printTask;p&&(this._set("effectivePrintServiceUrl",p.url),i=((p==null?void 0:p.templates)??[]).map(o=>_t.fromJSON(o)))}i.length>0&&this.defaultTemplates.addMany(i);const t=(n=this.effectivePrintServiceUrl)==null?void 0:n.toLowerCase().split("/");if(((t==null?void 0:t.indexOf("gpserver"))??-1)===-1)throw new oe("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});this._processLayoutTemplateInfos(await this._getLayoutTemplatesInfo(e)),await this._loadServiceDescription(e)}async _loadServiceDescription(e){const i=await this._getPrintTemplatesFromService(e);this._set("templatesInfo",i)}async _getLayoutTemplatesInfo(e){let i=[];const a=async t=>{const s=this.effectivePrintServiceUrl.replace(/(\/GPServer\/).+/i,`$1${encodeURI(t)}`);return(await bt(s,null,null,e)).results[0].value};try{i=await a("Get Layout Templates Info Task")}catch{}if(!i||i.length<1)try{i=await a("Get Layout Templates Info")}catch{}return i}_processLayoutTemplateInfos(e){const i={},a={};e.forEach(({layoutTemplate:t,layoutOptions:{customTextElements:s,mapSurroundInfos:n}})=>{const r=we(t);i[r]=s,n&&(a[r]=n.find(p=>p.type==="CIMMarkerNorthArrow"))}),this._serviceTemplateCustomTextElements=Object.freeze(i),this.templateToNorthArrowInfo=a}async _getPrintTemplatesFromService(e){return Y(this.effectivePrintServiceUrl,{...e,query:{f:"json"},timeout:this.printTimeout}).then(i=>{const a=i==null?void 0:i.data,t=a==null?void 0:a.parameters;let s=null,n=null;return t.forEach(r=>{var g;let p=(g=r.choiceList)==null?void 0:g.slice(),o=-1;p!=null&&p.length&&r.defaultValue&&(o=p.indexOf(r.defaultValue)),o>-1&&(p.splice(o,1),p.unshift(r.defaultValue));const h=(d,b)=>{const w=b==="all"?d:d.filter(y=>b.includes(y));return w.length===0?d:w};if(r.name==="Format"){const d=h(p.map(Ee),this.allowedFormats),b=Ee(r.defaultValue);s={defaultValue:d.includes(b)?b:d[0],choiceList:d}}else if(r.name==="Layout_Template"){p=p.filter(f=>f.toLowerCase()!=="map_only");let d,b=-1;p.some((f,_)=>{const T=f.toLowerCase();return T.includes("letter")&&T.includes("landscape")?(b=_,!0):!(!T.includes("a4")||!T.includes("landscape"))&&(b=_,!1)}),b>0&&(d=p[b],p.splice(b,1),p.unshift(d));const w=h(p.map(we),this.allowedLayouts),y=we(r.defaultValue);n={defaultValue:w.includes(y)?y:w[0],choiceList:w}}}),this.error=null,{format:s,layout:n}}).catch(i=>{throw new oe("print:unavailable-service-info","Can't fetch templates info from service",{error:i})})}};l([u()],L.prototype,"_serviceTemplateCustomTextElements",void 0),l([u()],L.prototype,"allowedFormats",void 0),l([u()],L.prototype,"allowedLayouts",void 0),l([u({type:Tt})],L.prototype,"defaultTemplates",void 0),l([u()],L.prototype,"extraParameters",void 0),l([u()],L.prototype,"includeDefaultTemplates",void 0),l([u({readOnly:!0})],L.prototype,"effectivePrintServiceUrl",null),l([u()],L.prototype,"effectiveTemplateCustomTextElements",null),l([u()],L.prototype,"error",void 0),l([u({type:dt})],L.prototype,"portal",void 0),l([u()],L.prototype,"printServiceUrl",void 0),l([u()],L.prototype,"printTimeout",void 0),l([u({readOnly:!0})],L.prototype,"state",null),l([u({readOnly:!0})],L.prototype,"templatesInfo",void 0),l([u()],L.prototype,"updateDelay",void 0),l([u()],L.prototype,"view",void 0),l([u()],L.prototype,"templateCustomTextElements",void 0),l([u()],L.prototype,"templateToNorthArrowInfo",void 0),L=l([N("esri.widgets.Print.PrintViewModel")],L);const St=L;let P=class extends he{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.layout="letter-ansi-a-landscape",this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};l([u()],P.prototype,"attributionEnabled",void 0),l([u()],P.prototype,"author",void 0),l([u()],P.prototype,"copyright",void 0),l([u()],P.prototype,"customTextElements",void 0),l([u()],P.prototype,"dpi",void 0),l([u()],P.prototype,"fileName",void 0),l([u()],P.prototype,"forceFeatureAttributes",void 0),l([u()],P.prototype,"format",void 0),l([u()],P.prototype,"height",void 0),l([u()],P.prototype,"includeTables",void 0),l([u()],P.prototype,"layout",void 0),l([u()],P.prototype,"legendEnabled",void 0),l([u()],P.prototype,"northArrowEnabled",void 0),l([u()],P.prototype,"scale",void 0),l([u()],P.prototype,"scaleEnabled",void 0),l([u()],P.prototype,"title",void 0),l([u()],P.prototype,"width",void 0),P=l([N("esri.widgets.Print.TemplateOptions")],P);const xt=P,Ot=ct.ofType(yt),It="MAP_ONLY";var z;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab"})(z||(z={}));const v="esri-print",ae=`${v}__advanced-options-button`,m={base:v,widgetIcon:A.printer,headerTitle:`${v}__header-title`,inputText:`${v}__input-text`,layoutTabList:`${v}__layout-tab-list`,layoutTab:`${v}__layout-tab`,layoutSection:`${v}__layout-section`,mapOnlySection:`${v}__map-only-section`,scaleInput:`${v}__scale-input`,templateList:`${v}__template-list`,templateListScroller:`${v}__template-list-scroller`,templateListFooter:`${v}__template-list-footer`,loader:`${v}__loader`,advancedOptionsButton:ae,advancedOptionsButtonContainer:`${ae}-container`,advancedOptionsButtonTitle:`${ae}-title`,advancedOptionsButtonIconOpened:`${ae}-icon--opened`,advancedOptionsButtonIconClosed:`${ae}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${ae}-icon--closed-rtl`,refreshButton:`${v}__refresh-button`,swapButton:`${v}__swap-button`,linkButton:`${v}__link-button`,printButton:`${v}__export-button`,templateButton:`${v}__template-button`,formSectionContainer:`${v}__form-section-container`,advancedOptionsSection:`${v}__advanced-options-section`,advancedOptionsContainer:`${v}__advanced-options-container`,authorInfoContainer:`${v}__author-info-container`,copyrightInfoContainer:`${v}__copyright-info-container`,exportedFilesContainer:`${v}__export-panel-container`,exportedFilesTitle:`${v}__export-title`,exportedFile:`${v}__exported-file`,exportedFileLink:`${v}__exported-file-link`,exportedFileLinkTitle:`${v}__exported-file-link-title`,heightContainer:`${v}__height-container`,legendInfoContainer:`${v}__legend-info-container`,printWidgetContainer:`${v}__container`,panelContainer:`${v}__panel-container`,scaleInfoContainer:`${v}__scale-info-container`,scaleInputContainer:`${v}__scale-input-container`,sizeContainer:`${v}__size-container`,widthContainer:`${v}__width-container`,panelError:`${v}__panel--error`,exportedFileError:`${v}__exported-file--error`},rt="User sets an invalid layout, resetting it to the default valid one...",lt="User sets an invalid format, resetting it to the default valid one...";function ti(e){return{width:Math.round(e*8.3333),height:Math.round(e*11.4583)}}function ai(e){return!isNaN(e)&&e>0}function ge(e){return(e==null?void 0:e.toUpperCase())===It}let $=class extends ta{constructor(e,i){super(e,i),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._focusedTemplateIndex=0,this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this._selectTemplateNode=null,this._templateListPopover=new sa({owner:this,placement:"top",offset:[0,-100],anchorElement:()=>this._selectTemplateNode,renderContentFunction:this._renderTemplateList}),this.exportedLinks=new Ot,this.headingLevel=3,this.iconClass=m.widgetIcon,this.icon=null,this.templateOptions=new xt,this.viewModel=new St,this._handleTemplateListCreation=a=>a.focus(),this._handleTemplateChildBlur=a=>{var s;((s=a.relatedTarget)==null?void 0:s.closest(`.${m.templateList}`))||this._handleCloseTemplateSelection()},this._handleCloseTemplateSelection=()=>{var a;this._focusedTemplateIndex=0,this._templateListPopover.open=!1,(a=this._selectTemplateNode)==null||a.focus()},this._handleSelectTemplateClick=()=>{this._focusedTemplateIndex=0,this._templateListPopover.open=!0},this._handleTemplateListClick=a=>{const t=ii(a.target);t&&this._applyTemplate(t)},this._handleTemplateListKeyDown=a=>{if(this._focusedTemplateIndex){if(Ye(a.key))return this._applyTemplate(this.viewModel.defaultTemplates.at(this._focusedTemplateIndex)),void a.preventDefault();if(a.key==="ArrowDown"||a.key==="ArrowUp"){const{defaultTemplates:t}=this.viewModel,s=a.key==="ArrowDown"?1:-1,n=(this._focusedTemplateIndex+s)%t.length;this._focusedTemplateIndex=n<0?t.length-1:n;const r=a.currentTarget;aa(r.querySelectorAll(`.${x.menuItem}`)[this._focusedTemplateIndex],r.parentElement),a.preventDefault()}a.key==="Escape"&&this._handleCloseTemplateSelection()}},this._removeLink=a=>{const t=a.currentTarget["data-item"];t&&t.state==="error"&&this.exportedLinks.remove(t)},this._handleLinkClick=a=>{const t=a.currentTarget,{href:s}=t,n=Se(this.viewModel.effectivePrintServiceUrl);if(!n)return;if(!a.isTrusted)return void a.stopPropagation();a.preventDefault();const r=new URL(s);r.searchParams.set("token",n),t.href=r.href,t.click(),t.href=s},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([ie(()=>{var t;return(t=this.viewModel)==null?void 0:t.templatesInfo},t=>{const{format:s,layout:n}=this.templateOptions;if(t){const r=n===t.layout.defaultValue||ge(n)||t.layout.choiceList&&n&&t.layout.choiceList.includes(n),p=s===t.format.defaultValue||t.format.choiceList&&s&&t.format.choiceList.includes(s);r||(n&&be.getLogger(this).warn(rt),this.templateOptions.layout=t.layout.defaultValue),p||(s&&be.getLogger(this).warn(lt),this.templateOptions.format=t.format.defaultValue),ge(n)&&(this._layoutTabSelected=!1)}},se),ie(()=>{var t;return(t=this.templateOptions)==null?void 0:t.format},t=>{const{viewModel:{templatesInfo:s}}=this;if(s&&t){let n=!1;s.format.choiceList&&s.format.choiceList.forEach(r=>{r.toUpperCase()===t.toUpperCase()&&(this.templateOptions.format=r,n=!0)}),n||(this.templateOptions.format=s.format.defaultValue,be.getLogger(this).warn(lt)),this.scheduleRender()}},se),ie(()=>{var t;return(t=this.templateOptions)==null?void 0:t.layout},t=>{const{viewModel:{templatesInfo:s}}=this;if(s&&t){this._layoutTabSelected=!ge(t);let n=!this._layoutTabSelected;n||s.layout.choiceList&&s.layout.choiceList.forEach(p=>{p.toUpperCase()===t.toUpperCase()&&(this.templateOptions.layout=p,n=!0)}),n||(this.templateOptions.layout=s.layout.defaultValue,be.getLogger(this).warn(rt));const r=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=r?ht(r):null,this.scheduleRender()}},se),ie(()=>{var t;return(t=this.templateOptions)==null?void 0:t.dpi},t=>{t<=0?this.templateOptions.dpi=1:this.scheduleRender()},se),ie(()=>{var t,s;return(s=(t=this.viewModel)==null?void 0:t.view)==null?void 0:s.scale},t=>{const{scale:s,scaleEnabled:n}=this.templateOptions;n&&s||(this.templateOptions.scale=t)},se)]);const{height:e,width:i}=this.templateOptions;this.templateOptions.width=i||800,this.templateOptions.height=e||1100;const a=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>clearTimeout(a))}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var Ae,Ge,Re,je,Ue,Je,Be,ze;const{attributionEnabled:e,author:i,copyright:a,dpi:t,format:s,height:n,layout:r,legendEnabled:p,northArrowEnabled:o,scaleEnabled:h,scale:g,width:d}=this.templateOptions,b=((Ae=this.viewModel)==null?void 0:Ae.state)!=="ready",w=this._renderTitleOrFileNameSection(),{includeDefaultTemplates:y,messages:f,viewModel:_}=this,T=((je=(Re=(Ge=this.viewModel)==null?void 0:Ge.templatesInfo)==null?void 0:Re.format)==null?void 0:je.choiceList)||[],D=T.length>0?T.map(J=>c("option",{key:J,selected:J===s,value:J},J.toUpperCase())):c("option",{key:"format-default-option"},f.formatDefaultOption),I=c("div",{class:m.formSectionContainer},c("label",null,f.fileFormatTitle,c("select",{bind:this,class:x.select,"data-target-property":"format",onchange:this._updateFromOption},D))),E=(Be=(Je=(Ue=this.viewModel)==null?void 0:Ue.templatesInfo)==null?void 0:Je.layout)==null?void 0:Be.choiceList,j=E!=null&&E.length?E.map(J=>c("option",{key:J,selected:J===r,value:J},f[J]||J)):c("option",{key:"layout-default-option"},f.layoutDefaultOption),U=c("div",{class:m.formSectionContainer},c("label",null,f.layoutTitle,c("select",{bind:this,class:x.select,"data-target-property":"layout",onchange:this._updateFromOption},j))),H=c("div",{class:m.formSectionContainer},c("label",null,f.dpi,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:`${t}`}))),k=c("div",{class:this.classes(m.scaleInfoContainer,m.formSectionContainer)},c("label",null,c("input",{bind:this,checked:h,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),f.scale),c("div",{class:m.scaleInputContainer},c("input",{"aria-label":f.scaleLabel,"aria-valuenow":`${g}`,bind:this,class:this.classes(m.inputText,x.input,m.scaleInput),"data-input-name":"scale",disabled:!h,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:`${g}`}),c("button",{"aria-label":f.reset,bind:this,class:this.classes(x.widgetButton,m.refreshButton,A.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),O=this._advancedOptionsVisibleForLayout?c("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:m.advancedOptionsContainer},k,c("div",{class:this.classes(m.authorInfoContainer,m.formSectionContainer)},c("label",null,f.author,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:i??""}))),c("div",{class:this.classes(m.copyrightInfoContainer,m.formSectionContainer)},c("label",null,f.copyright,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:a??""}))),H,c("div",{class:this.classes(m.legendInfoContainer,m.formSectionContainer)},c("label",null,c("input",{bind:this,checked:p,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),f.legend)),this.viewModel.templateToNorthArrowInfo[r]?c("div",{class:this.classes(m.legendInfoContainer,m.formSectionContainer),key:"north-arrow"},c("label",null,c("input",{bind:this,checked:o,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),f.northArrow)):null,this._renderCustomTextElementSection()):null,S=this._advancedOptionsVisibleForMapOnly?c("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:m.advancedOptionsContainer},k,H,c("div",{class:m.formSectionContainer},c("label",null,c("input",{bind:this,checked:e,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),f.attribution)),this._renderCustomTextElementSection()):null,V=this._layoutTabSelected?c("section",{"aria-labelledby":`${this.id}__layoutTab`,class:m.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},c("div",{class:m.panelContainer},w,U,this._layoutTabSelected?I:null),c("div",{class:this.classes(m.panelContainer,m.advancedOptionsSection)},c("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":f.advancedOptions,bind:this,class:m.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},c("div",{class:m.advancedOptionsButtonContainer},c("span",{"aria-hidden":"true",class:this.classes(A.rightTriangleArrow,m.advancedOptionsButtonIconClosed)}),c("span",{"aria-hidden":"true",class:this.classes(A.leftTriangleArrow,m.advancedOptionsButtonIconClosed_RTL)}),c("span",{"aria-hidden":"true",class:this.classes(A.downArrow,m.advancedOptionsButtonIconOpened)}),c("span",{class:m.advancedOptionsButtonTitle},f.advancedOptions))),O)):c("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:m.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},c("div",{class:m.panelContainer},w,this._layoutTabSelected?null:I,c("div",{class:this.classes(m.sizeContainer,m.formSectionContainer)},c("div",{class:m.widthContainer},c("label",null,f.width,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${d}`}))),c("div",{class:m.heightContainer},c("label",null,f.height,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${n}`}))),c("button",{"aria-label":f.swap,bind:this,class:this.classes(x.widgetButton,m.swapButton,A.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),c("div",{class:this.classes(m.panelContainer,m.advancedOptionsSection)},c("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":f.advancedOptions,bind:this,class:m.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},c("div",{class:m.advancedOptionsButtonContainer},c("span",{"aria-hidden":"true",class:this.classes(A.rightTriangleArrow,m.advancedOptionsButtonIconClosed)}),c("span",{"aria-hidden":"true",class:this.classes(A.leftTriangleArrow,m.advancedOptionsButtonIconClosed_RTL)}),c("span",{"aria-hidden":"true",class:this.classes(A.downArrow,m.advancedOptionsButtonIconOpened)}),c("span",{class:m.advancedOptionsButtonTitle},f.advancedOptions))),S))),M=this.exportedLinks.toArray(),F=this._renderExportedLink(M),Q={[x.buttonDisabled]:b||!r&&!s},{view:ke}=this,Ne=!ke||ke.type!=="2d",Lt=c("div",{class:m.panelError},Ne?f.sceneViewError:f.serviceError),$t=c("div",null,c("ul",{bind:this,class:m.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},c("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._layoutTabSelected}`,class:m.layoutTab,"data-tab-id":z.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},f.layoutTab),c("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${!this._layoutTabSelected}`,class:m.layoutTab,"data-tab-id":z.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},f.mapOnlyTab)),V,c("button",{"aria-label":f.exportDescription,bind:this,class:this.classes(m.printButton,x.button,Q),disabled:b,onclick:this._handlePrintMap,tabIndex:0,type:"button"},f.export),y&&_.defaultTemplates.length>0?this._renderTemplateSectionTrigger():null,c("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:m.exportedFilesContainer},c(Qe,{class:m.exportedFilesTitle,level:this.headingLevel},f.exportText),M.length>0?null:c("div",null,c("div",null,f.exportHint)),F)),Pt=c("div",{class:m.printWidgetContainer},c("header",{class:m.headerTitle},f.export),this.error||Ne||!this.view?Lt:$t),Ct=((ze=this.viewModel)==null?void 0:ze.state)==="initializing"?this._renderLoader():Pt;return c("div",{afterCreate:this._handleRootAfterCreate,bind:this,class:this.classes(m.base,x.widget,x.panel)},Ct)}_renderTemplateSectionTrigger(){const{messages:e,_templateListPopover:i}=this,a=i.open;return c("button",{afterCreate:t=>this._selectTemplateNode=t,"aria-controls":a?`${this.id}__template-selection`:"","aria-label":e.selectTemplateDescription,"aria-pressed":a.toString(),class:this.classes(x.button,x.buttonTertiary,m.templateButton),onclick:this._handleSelectTemplateClick,title:e.selectTemplateDescription,type:"button"},e.selectTemplate)}_renderCustomTextElementSection(){const{templateOptions:{customTextElements:e}}=this;return e?c("div",{class:m.formSectionContainer,key:"custom-text-elements"},e.map(i=>{const[a,t]=Object.entries(i)[0];return a==="date"?null:c("label",{key:a},a,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-custom":!0,"data-input-name":a,onchange:this._updateInputValue,type:"text",value:t}))})):null}_renderTemplateList(){const{messages:e,messagesCommon:i,viewModel:a}=this,{defaultTemplates:t}=a,s=e.selectTemplateDescription,n=`${this.id}__template-selection`;return c("div",{class:this.classes(m.templateList,x.widget,x.panel),id:n},c(Qe,{class:x.menuHeader,level:this.headingLevel},e.selectTemplate),c("div",{class:m.templateListScroller},c("ul",{afterCreate:this._handleTemplateListCreation,"aria-activedescendant":`${this.id}__template-item--${this._focusedTemplateIndex}`,"aria-label":s,class:x.menuList,key:"templates",onblur:this._handleTemplateChildBlur,onclick:this._handleTemplateListClick,onkeydown:this._handleTemplateListKeyDown,role:"listbox",tabIndex:0,title:s},t.toArray().map((r,p)=>{const o=p===this._focusedTemplateIndex,h=r.description??"",g=r.label??"";return c("li",{"aria-label":h,class:this.classes(x.menuItem,{[x.menuItemFocus]:o}),"data-template":r,id:`${this.id}__template-item--${p}`,key:g,title:h},ge(g)?e.mapOnlyTab:g)}))),c("div",{class:m.templateListFooter},c("button",{class:this.classes(x.button,x.buttonSecondary),onblur:this._handleTemplateChildBlur,onclick:this._handleCloseTemplateSelection,type:"button"},i.done)))}_applyTemplate(e){const{format:i,layout:a,layoutOptions:t}=e,{templateOptions:s}=this;this._templateListPopover.open=!1,this._toggleTab(a==="map-only"?z.mapOnly:z.layout,!1),i&&(s.format=i),a&&(s.layout=a),this._focusedTemplateIndex=null,s.legendEnabled=(t==null?void 0:t.legend)??s.legendEnabled,this._handleCloseTemplateSelection()}_renderTitleOrFileNameSection(){const{templateOptions:e,messages:i}=this;let a,t,s,n;return this._layoutTabSelected?(a=i.title,t=i.titlePlaceHolder,s=e.title,n="title"):(a=i.fileName,t=i.fileNamePlaceHolder,s=e.fileName,n="fileName"),c("div",{class:m.formSectionContainer,key:n},c("label",null,a,c("input",{bind:this,class:this.classes(m.inputText,x.input),"data-input-name":n,onchange:this._updateInputValue,placeholder:t,tabIndex:0,type:"text",value:s??""})))}_handleRootAfterCreate(e){this._rootNode=e,this.addHandles(Yt(e,"scroll",()=>{this._templateListPopover.open&&this._handleCloseTemplateSelection()}))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const i=e.getAttribute("data-tab-id");(i==="layoutTab"&&this._layoutTabSelected||i==="mapOnlyTab"&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[m.loader]:this._awaitingServerResponse};return c("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,i){const a=i||this.messages.untitled,t=e.format.toLowerCase(),s=t.includes("png")?"png":t,n=a+s;return this._exportedFileNameMap[n]!==void 0?this._exportedFileNameMap[n]++:this._exportedFileNameMap[n]=0,new yt({name:a,extension:s,count:this._exportedFileNameMap[n]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,i,a){e.find(t=>{const[s]=Object.entries(t)[0];return s===i})[i]=a}_updateInputValue(e){const i=e.target,a=i.getAttribute("data-input-name"),t=!!i["data-input-custom"],{templateOptions:s}=this;if(t)return void this._updateCustomTextElementValue(s.customTextElements,a,i.value);let n;if(i.type==="number"){if(!ai(i.valueAsNumber)){const r=s[a];return void(i.value=`${r}`)}n=i.valueAsNumber}else n=i.value;s[a]=n}_handleDPIChange(e){this._updateInputValue(e);const i=e.currentTarget.valueAsNumber,{height:a,width:t}=ti(i),{templateOptions:s}=this;s.height=a,s.width=t}_handlePrintMap(){var s;this._pendingExportScroll=!0;const{templateOptions:e}=this,i=this.viewModel.toPrintTemplate(e),a=this._layoutTabSelected?(s=i.layoutOptions)==null?void 0:s.titleText:e.fileName,t=this._createFileLink(i,a);this.exportedLinks.add(t),this.emit("submit",{link:t}),this.viewModel.print(i).then(n=>{t.set({url:n&&n.url,state:"ready"})}).catch(n=>{t.set({error:n,state:"error"})}).then(()=>{this.emit("complete",{link:t}),this.scheduleRender()})}_updateFromOption(e){var s;const i=e.target,a=i.selectedOptions?(s=i.selectedOptions.item(0))==null?void 0:s.value:i.options[i.selectedIndex].value,t=i.getAttribute("data-target-property");this.templateOptions[t]=a}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:i,scrollHeight:a}=e,t=a-i;t>0&&(e.scrollTop=t)}_toggleInputValue(e){const i=e.target,a=i.getAttribute("data-option-name");this.templateOptions[a]=i.checked,a==="scaleEnabled"&&(this.templateOptions[a]||this._resetToCurrentScale())}_renderExportedLink(e){const i=this.messages;return e.map(a=>{const{error:t,url:s,state:n}=a,r=a.formattedName??"",p=n==="error",o=n==="pending",h=n==="ready",g={[x.anchorDisabled]:o||p};let d=s||null;d&&(d=Qt(d));const b=Xt(s,location.href),w={[A.loadingIndicator]:o,[x.rotating]:o,[A.download]:b&&h,[A.launchLinkExternal]:!b&&h,[A.error]:p,[m.exportedFileError]:p},y={[m.exportedFileError]:p};let f;f=o?i.pending:h?i.ready:i.errorMessage;const _=p?(t==null?void 0:t.name)==="print-task:cim-symbol-unsupported"?i.exportWebMapCIMError:i.exportWebMapError:"";return c("div",{"aria-label":f,class:m.exportedFile,"data-item":a,key:r,onclick:this._removeLink,title:_},c("a",{"aria-label":`${r}. ${i.linkReady}`,class:this.classes(m.exportedFileLink,x.anchor,g),download:r,href:d??"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},c("span",{class:this.classes(w)}),c("span",{class:this.classes(m.exportedFileLinkTitle,y)},r)))})}_toggleLayoutPanel(e){const i=e.target;this._toggleTab(i.getAttribute("data-tab-id"))}_toggleTab(e,i=!0){var a,t,s;if(this._layoutTabSelected=e===z.layout,this._layoutTabSelected){const n=(s=(t=(a=this.viewModel)==null?void 0:a.templatesInfo)==null?void 0:t.layout)==null?void 0:s.choiceList;this.templateOptions.layout=n?n[0]:"letter-ansi-a-landscape"}else this.templateOptions.layout=It;i&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const i=ea(e),a=e.target.getAttribute("data-tab-id");if(Ye(i))return this._toggleTab(a),e.preventDefault(),void e.stopPropagation();i!=="ArrowLeft"&&i!=="ArrowRight"||(this._toggleTab(a===z.layout?z.mapOnly:z.layout),e.preventDefault(),e.stopPropagation())}};function ii(e){return e==null?void 0:e["data-template"]}l([u()],$.prototype,"allowedFormats",null),l([u()],$.prototype,"allowedLayouts",null),l([u()],$.prototype,"error",null),l([u({type:Ot})],$.prototype,"exportedLinks",void 0),l([u()],$.prototype,"extraParameters",null),l([u()],$.prototype,"headingLevel",void 0),l([u()],$.prototype,"iconClass",void 0),l([u()],$.prototype,"icon",void 0),l([u()],$.prototype,"includeDefaultTemplates",null),l([u()],$.prototype,"label",null),l([u(),Ze("esri/widgets/Print/t9n/Print")],$.prototype,"messages",void 0),l([u(),Ze("esri/t9n/common")],$.prototype,"messagesCommon",void 0),l([u()],$.prototype,"portal",null),l([u()],$.prototype,"printServiceUrl",null),l([u()],$.prototype,"templateCustomTextElements",null),l([u({type:xt})],$.prototype,"templateOptions",void 0),l([u()],$.prototype,"view",null),l([u({type:St})],$.prototype,"viewModel",void 0),$=l([N("esri.widgets.Print")],$);const Ti=$;export{Ti as default};

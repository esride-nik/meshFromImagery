import{bg as Xr,eG as _y,ah as _i,t_ as Lx,an as ce,a5 as h,a6 as u,a9 as N,V as ho,bA as ue,cc as Tl,cb as D,ce as at,_ as ie,s as Mr,iL as ks,ao as dn,cn as xu,cf as $x,gk as Fa,b9 as re,gj as wo,gt as rn,bn as gy,b0 as K,t$ as fd,fO as Ht,mq as Fs,eU as Cl,fM as om,kn as ln,i0 as Ix,ne as Nx,X as Og,g_ as fn,db as ft,gH as se,tE as Tu,fx as nt,a$ as gi,gi as yi,aW as b,iN as ph,dr as yt,kP as Bc,n3 as l_,f6 as Xt,fa as ve,jM as Gr,fw as gs,mk as Va,hW as He,u0 as Hc,a3 as et,g3 as De,k as li,fJ as Ua,lf as Cu,fZ as za,p$ as Fx,fz as Tt,h3 as si,u1 as Vx,nn as c_,fv as ye,fe as Ie,d1 as J,da as ws,fB as Dl,d2 as me,tc as Ux,u2 as Eg,f9 as sr,fC as Wt,u3 as zx,jo as Bi,tr as fy,fK as jr,ld as Ag,u4 as qx,al as yn,ss as yy,d8 as ae,o1 as h_,o8 as lm,o0 as d_,n$ as Hd,kj as Mg,d0 as uo,u5 as Pu,qv as Bx,fk as pe,fc as Su,fd as ea,ft as po,fq as Zt,u6 as Ru,u7 as u_,u8 as p_,fN as kc,f1 as vn,l9 as Yu,lV as Hx,jK as cn,jL as Ll,aR as Oe,kM as ds,kL as vy,aB as kx,j1 as Gx,q1 as m_,fX as $l,e_ as mo,i$ as jx,u9 as Wx,mg as Sc,f8 as __,f5 as Rt,gy as Dt,d4 as un,o$ as by,d9 as ta,ni as Pa,ez as wy,M as Us,ib as xy,gs as cm,B as Qr,p7 as Ty,gQ as Cy,cd as Oa,n1 as Ou,bo as Qx,l6 as Gc,gG as pn,gA as Py,oA as jc,la as kd,fW as zs,fr as Pl,gS as mh,fs as Dg,tY as Zx,bj as Yt,gL as Ea,ua as Xx,bt as ia,d5 as Sy,j0 as hm,t7 as Ry,tk as Oy,kC as Yn,kD as Wc,eE as mn,jr as Eu,bu as Et,lO as Gd,aU as g_,nk as Yx,np as Kx,y as fr,kF as Jx,tx as e2,x as t2,cj as bn,ub as Lg,i5 as $g,aA as Ey,uc as i2,jq as Ay,i7 as Ig,j3 as dm,cA as r2,nZ as s2,fY as Ng,fV as um,eM as a2,bm as Fg,q as n2,dA as no,pg as o2,ph as l2,k9 as c2,iq as h2,r4 as My,ac as d2,hR as u2,ud as p2,hV as m2,eH as Dy,fn as f_,p4 as Qc,tZ as Ly,ue as xh,jO as _2,tA as Vg,eF as oo,nx as Rc,uf as g2,ug as Bt,k0 as f2,jA as y2,o3 as v2,gg as b2,uh as w2,kG as pm,kk as Ug,gJ as Zr,cv as Au,g4 as jd,ui as x2,uj as Sl,eV as T2,t2 as Oc,lL as Zc,lG as y_,k3 as C2,nj as $y,jz as us,jk as Iy,uk as P2,gE as Ny,kE as S2,ul as yd,er as zg,o_ as R2,bD as O2,jp as Fy,gv as Wd,hl as E2,um as A2,qC as qg,c9 as Gs,un as M2,lh as Vy,qZ as D2,p2 as Uy,pW as L2,cG as $2,cH as I2,jm as N2,kv as F2,cI as V2,kK as v_,qy as _l,uo as U2,up as z2,of as _h,uq as q2,ur as zy,us as Bg,bQ as Qd,m1 as B2,g5 as H2,tj as mm,a_ as k2,lT as qy,hj as b_,mB as js,fo as Zd,kI as By,gD as G2,d3 as j2,gP as W2,ji as Q2,iM as Th,ut as Z2,t9 as X2,ml as Y2,j5 as Hg,mj as kg,r3 as Ku,r$ as K2,uu as J2,uv as Gg,ba as eT,uw as jg,ux as Wg,hQ as Qg,r_ as tT,h_ as Zg,iu as iT,eh as rT,di as Hy,sZ as sT,hq as aT}from"./index-b516d057.js";import{l as Rl,d as _o}from"./Viewpoint-f83262d0.js";import{Z as nT}from"./jsxFactory-92036771.js";import{v as oT}from"./HeightModelInfo-b816d32b.js";import{p as lT,g as Br,L as fs,k as cT,b as hT,q as dT,t as uT,v as pT,y as Xg,e as mT,z as _T,B as gT,C as Yg,D as fT,w as yT,E as vT,F as bT,G as wT,N as xT,o as ky,H as TT,a as Gy,I as CT,J as Xc}from"./ElevationQuery-a3eaf0a0.js";import{t as Aa}from"./projectVectorToVector-56c29b20.js";import{u as PT,W as Mu,Z as w_,l as ST,p as RT,G as OT}from"./boundedPlane-1da2f094.js";import{D as _m,B as Kg,F as ET}from"./coordinateSystem-38339d17.js";import{o as AT}from"./scaleUtils-72744379.js";import{o as MT}from"./LayerConstants-d3ac1b7a.js";import{a as Ol,t as DT,O as x_,k as Jg,s as Ju,P as ef,m as LT,f as $T,q as IT,r as NT,v as FT,z as VT,B as UT,C as zT,W as qT,w as BT,I as jy,J as HT,K as kT,L as GT,Q as Wy,E as ep,F as tp,R as jT,S as WT,M as QT,N as ZT}from"./DefaultUI-af7068c2.js";import{y as Qy,f as T_,u as Zy,d as XT,Y as Ka,Z as tf,Q as Xy,h as YT,P as KT,g as JT,v as ip,J as Ch,a as eC,B as tC,U as iC,l as rC,K as sC,b as aC,t as nC}from"./viewpointUtils-245ed782.js";import{p as oC,t as lC}from"./ElevationSamplerData-9f34f589.js";import{l as Yc,D as cC,N as Kc,m as hC,u as dC,b as Du,H as Yy,p as A,i as ac,c as gm,d as Ky,e as fm,w as gl,T as rr,f as Ns,A as uC,U as Jc,S as mt,g as Xd,h as Ti,X as Sa,B as C_,Y as Yd,Q as rf,K as sf,z as af,J as nf,s as ym,P as pC,q as mC,G as qr,F as ha,V as of,_ as Kd,j as _C,x as gC,L as fC,n as yC,O as vC,o as bC,a as Lo,r as Ph,t as wC,y as xC,E as TC,I as Hl,W as lf,R as cf,Z as hf,$ as CC,a0 as PC,a1 as SC,a2 as RC,C as OC}from"./terrainUtils-b6b761ab.js";import{l as Ne,a as rp,o as df}from"./ViewingMode-5d7d590b.js";import{p as Jy,a as ev,j as tv,n as EC}from"./Environment-91bfea7d.js";import{t as AC}from"./projectPointToWGS84ComparableLonLat-1ba40d40.js";import{o as At,af as Lu,aa as wn,I as Gi,x as Ci,H as Si,z as Ma,e as Ue,s as ke,at as P_,F as go,i as Lt,r as $t,j as Mt,J as $r,aP as vm,an as Vt,h as iv,T as xo,ar as MC,ap as Qt,as as DC,av as LC,b0 as bm,n as S_,b as rv,t as sv,v as gh,A as $,L as av,am as nv,b1 as $C,aS as IC,b2 as NC,a as ki,N as FC,W as eh,ac as ov,aJ as Ca,b3 as R_,ad as Il,ax as VC,ag as UC,d as zC,f as M,U as lv,B as uf,a5 as wm,a6 as pf,R as mf,az as cv,P as hv,aB as dv,y as qC,O as BC,au as uv,b4 as HC,aR as O_,ai as Hr,K as kC,ae as pv,ak as fo,b5 as vd,ah as mv,aj as GC,b6 as jC,b7 as WC,aC as QC,C as ZC,c as xm,aA as _v,k as XC,b8 as YC,m as KC,g as JC,b9 as e3,ba as gv,bb as fv,G as E_,_ as t3,bc as i3,aQ as pr,bd as r3,be as s3,aw as yv,bf as a3,Q as _f,bg as n3}from"./DefaultTechniqueConfiguration-b4dbe32f.js";import{aA as A_,T as na,aB as $u,aC as o3,aD as M_,aE as D_,aF as nc,aG as Tm,aH as l3,J as To,aI as c3,$ as gt,aJ as _r,m as h3,aK as d3,S as u3,r as Ir,aL as p3,aM as ni,aN as Jd,aO as kl,aP as ms,aw as m3,aQ as Vs,aR as vv,aS as gf,aT as ff,aU as sp,E as Gt,I as da,_ as bv,aV as eu,h as _3,aW as wv,aX as g3,aY as yf,aZ as Zo,a_ as f3,a$ as y3,b0 as v3,b1 as b3,b2 as tu,b3 as xv,V as w3,b4 as x3,b5 as T3,b6 as C3,N as ua,b7 as P3,b8 as S3,b9 as R3,ba as O3,bb as E3,bc as A3,bd as M3,be as D3,bf as vf,C as ap}from"./RenderGeometry-5dbc1699.js";import{o as _,n as ti}from"./interfaces-8918b36f.js";import{E as It,e as L3,f as $3,n as Tv,i as I3,g as Cv,V as Pv,v as N3,d as er,M as Sv,T as F3,I as V3}from"./Material-5f4156ac.js";import{R as G,O as Pi,E as fi,T as Rv,M as Cm,D as ra,F as vs,L as Da,G as $i,I as np,B as U3,_ as ii,C as Ec,U as bd,P as z3}from"./enums-bdecffa2.js";import{S as Je,s as sa,_ as tt,f as nr,r as Ov,a as L_,o as Jt,d as Ev,A as q3,h as B3,l as H3,e as k3}from"./OrderIndependentTransparency-755f7dcc.js";import{r as I,t as Ts}from"./ShaderTechniqueConfiguration-2502462e.js";import{r as qs,a as G3,n as j3}from"./vec3f32-bac7ea57.js";import{E as Iu,h as Lr,S as $_,a as W3}from"./FramebufferObject-123b7c8d.js";import{e as Yr,n as La,T as Hi,i as Q3,o as Z3}from"./Texture-bcb6d63f.js";import{I as ci,g as yr,C as Bs,F as iu,c as X3}from"./Scheduler-ff5943a4.js";import{p as Pm}from"./weather-2eb64924.js";import{r as Rn}from"./glUtil-ce5ee52b.js";import{H as On}from"./InterleavedLayout-d76b0d59.js";import{h as Nu}from"./UpdatingHandles-7949a657.js";import{c as bf}from"./earthUtils-ef4b5643.js";import{S as Y3,O as K3,z as J3,E as Av,t as wf,r as eP}from"./ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js";import{b as xs,w as ru,t as Xs,o as Mv,i as va,c as xf,M as tP}from"./Intersector-fa865806.js";import{r as xn,i as Tf}from"./Cyclical-4c223a04.js";import{f as Nl,g as Dv,l as Lv}from"./ray-8da55042.js";import{A as sn,z as iP,w as rP}from"./verticalOffsetUtils-e5214af9.js";import{i as Cs,o as Tn,d as sP,_ as Cf,a as Pf,r as Sf}from"./screenUtils-8dc4a7f9.js";import{k as pt,I as su,N as aP,L as nP,s as oP,P as Fu,i as lP,c as cP,b as hP,h as dP,l as fl,v as uP,u as Sm}from"./frustum-f9d53cdf.js";import{o as Ws,A as pP,p as au,t as mP,i as _P,j as $v,l as gP,k as hn,m as fP,q as yl,s as yP,v as vP,n as bP,a as wP,w as op,y as xP}from"./objectResourceUtils-003803db.js";import{I as Ui}from"./RenderState-1d6218ee.js";import{t as lp,b as TP,s as Iv,a as Nv,l as Fv}from"./ZoomMomentumEstimator-7437d26a.js";import{$ as Vv,a as CP}from"./ColorMaterial-bdf1f62a.js";import{c as PP}from"./hydratedFeatures-2365c307.js";import{createLabelFunction as SP}from"./labelFormatUtils-d440367f.js";import{t as oc,s as mr}from"./FeatureTileDescriptor3D-27dbeac7.js";import{a as Rf}from"./ElevationProvider-abb53936.js";import{getGeometryServiceURL as RP}from"./geometryServiceUtils-3e048225.js";import{p as OP,n as EP}from"./project-1bd91657.js";import{U as AP}from"./RenderCoordsHelper-8f237859.js";import{r as MP}from"./signal-51ed66f5.js";import{l as DP,n as LP,m as Uv}from"./DefaultMaterial_COLOR_GAMMA-101ea40c.js";import{l as $P}from"./CollectionFlattener-193451da.js";import{t as IP,d as Of,g as Ef}from"./intersectorUtilsConversions-d05d75a3.js";import{s as NP,a as FP}from"./LercDecoder-b49c0e9c.js";import{d as cp,t as VP,u as UP}from"./RenderableTile-52f61d09.js";import{m as zP,_ as qP,p as BP,A as HP,T as kP,c as GP,l as Af}from"./rasterUtils-15abcc11.js";import"./TileInfoView-ce4d65fb.js";import{e as jP}from"./TileKey-4b1303ff.js";import"./TileStrategy-a729431f.js";import{a as WP}from"./StyleDefinition-29c49b98.js";import{r as QP,e as zv}from"./mat3f32-6c416b1c.js";import{n as nu,r as ZP}from"./symbolColorUtils-3ca646c8.js";import{Z as XP,N as YP,J as Mf,e as KP,_ as JP}from"./orientedBoundingBox-67c5cd22.js";import{o as Rm,r as eS}from"./floatRGBA-ca990bbb.js";import{e as qv}from"./VerticalOffset.glsl-5743f98e.js";import{m as tS,T as Om,r as Bv,A as iS,a as Df,E as rS,b as sS,w as aS}from"./edgeProcessing-82213448.js";import{f as nS}from"./VertexArrayObject-d19dab8d.js";import{W as so}from"./Octree-7cea9440.js";import{t as th}from"./requestImageUtils-b142708c.js";import{s as oS}from"./resources-15104e7a.js";import{A as Ve}from"./edgeUtils-6e4a97fb.js";import{a as lS}from"./EdgeWorkerHandle-7d97defa.js";import{E as cS}from"./testSVGPremultipliedAlpha-f5e92e14.js";import{N as hS,n as dS}from"./RenderingContext-c0ea7a49.js";import{t as uS}from"./contextUtils-81fda295.js";import{n as pS}from"./DefaultVertexAttributeLayouts-8962d8eb.js";import{t as mS}from"./hitTestSelectUtils-d512707e.js";import{e as _S}from"./layerViewUtils-6ebe90f4.js";import{r as Lf}from"./spatialReferenceSupport-5aeb751c.js";let Ja=class extends Xr.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=Yc}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if((e==null?void 0:e.extent)==null||e.spatialReference==null)return null;const t=_y(e.extent,e.spatialReference);return t.zmin=e.visibleElevationBounds.min,t.zmax=e.visibleElevationBounds.max,t}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??_i.WGS84}elevationAt(e,t){var r;if(this.extent==null||!Lx(this.extent,e,t)){const s=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ce.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${s})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,t,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return oC(e.clone(),this)}};h([u({readOnly:!0})],Ja.prototype,"demResolution",void 0),h([u({readOnly:!0})],Ja.prototype,"extent",null),h([u({readOnly:!0})],Ja.prototype,"noDataValue",void 0),h([u()],Ja.prototype,"spatialReference",null),h([u({constructOnly:!0})],Ja.prototype,"view",void 0),Ja=h([N("esri.views.support.GroundViewElevationSampler")],Ja);const gS=Ja;let ma=class extends ue{constructor(e){super(e),this.view=null,this.layerViews=new ho}initialize(){this.addHandles(Tl(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new gS({view:this.view}):null:null}get extent(){const e=this.view;return e&&e.type!=="2d"&&e.ready?Qy(e,e.state.camera,e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation):null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>D(()=>e.updating,()=>this._updateUpdating(),at)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};h([u({readOnly:!0})],ma.prototype,"elevationSampler",null),h([u({readOnly:!0})],ma.prototype,"extent",null),h([u({type:Boolean,readOnly:!0})],ma.prototype,"updating",null),h([u({constructOnly:!0})],ma.prototype,"view",void 0),h([u({type:ho,readOnly:!0})],ma.prototype,"layerViews",void 0),h([u({readOnly:!0})],ma.prototype,"suspended",null),ma=h([N("esri.views.GroundView")],ma);const fS=ma,Gl=()=>ie(()=>import("./TileLayerView3D-7516f50a.js"),["assets/TileLayerView3D-7516f50a.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/MapServiceLayerViewHelper-7f390707.js","assets/scaleUtils-72744379.js","assets/floorFilterUtils-080a7cd2.js","assets/drapedUtils-5cffceb9.js","assets/sublayerUtils-4fbad2bd.js","assets/popupUtils-e4ebc84a.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),$f=()=>ie(()=>import("./ElevationLayerView3D-b4c9b333.js"),["assets/ElevationLayerView3D-b4c9b333.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),If={"base-dynamic":()=>ie(()=>import("./BaseDynamicLayerView3D-7271b1b7.js"),["assets/BaseDynamicLayerView3D-7271b1b7.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DynamicLayerView3D-23a674d4.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/ImageMaterial-10c9471b.js","assets/VerticalOffset.glsl-5743f98e.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/layerViewUtils-6ebe90f4.js"]),"base-elevation":$f,"base-tile":Gl,"bing-maps":Gl,"building-scene":()=>ie(()=>import("./BuildingSceneLayerView3D-a52c6e71.js"),["assets/BuildingSceneLayerView3D-a52c6e71.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/BuildingGroupSublayer-2dcd1645.js","assets/loadAll-5e767cfa.js","assets/BuildingComponentSublayer-0e038021.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/Version-1f969b2a.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/FeatureLayer-c4c5819f.js","assets/FeatureLayerBase-0746b503.js","assets/HeightModelInfo-b816d32b.js","assets/featureLayerUtils-16361d1f.js","assets/featureQueryAll-40af0622.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/AttachmentQuery-bede5a71.js","assets/RelationshipQuery-2c9e4485.js","assets/LayerFloorInfo-4234db4d.js","assets/serviceCapabilitiesUtils-42d4d20c.js","assets/editsZScale-e45bb69c.js","assets/queryZScale-d7a48772.js","assets/APIKeyMixin-bfb00271.js","assets/EditBusLayer-caf9fed8.js","assets/uuid-709b6c67.js","assets/FeatureEffectLayer-1948d1a0.js","assets/FeatureEffect-c80bb16d.js","assets/FeatureFilter-55dd341e.js","assets/FeatureReductionLayer-443167bc.js","assets/clusterUtils-50a66940.js","assets/MD5-715f37cd.js","assets/FeatureReductionSelection-d84c375a.js","assets/LabelClass-c3c309a8.js","assets/labelUtils-b29175f3.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-32293fe1.js","assets/FeatureTemplate-d1d1c7be.js","assets/FeatureType-f30c4b8b.js","assets/fieldProperties-8c831c84.js","assets/labelingInfo-aae625ac.js","assets/versionUtils-5892620e.js","assets/styleUtils-a3d96bf6.js","assets/TopFeaturesQuery-6d0bf5f5.js","assets/capabilities-c607cf72.js","assets/I3SIndexInfo-ea0c11e7.js","assets/I3SLayerDefinitions-9d2b79a5.js","assets/I3SUtil-1c5e04a1.js","assets/projectVectorToVector-56c29b20.js","assets/I3SBinaryReader-e72af7de.js","assets/edgeUtils-6e4a97fb.js","assets/symbolColorUtils-3ca646c8.js","assets/orientedBoundingBox-67c5cd22.js","assets/ViewingMode-5d7d590b.js","assets/popupUtils-e4ebc84a.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/I3SMeshView3D-c4f22244.js","assets/UpdatingHandles-7949a657.js","assets/I3SOverrides-a9f31f33.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/I3SNode-81f8301c.js","assets/layerViewUtils-6ebe90f4.js","assets/ReactiveSet-7afb73d5.js","assets/meshFeatureSet-8aa95dd7.js","assets/FeatureLayerView3D-08fb50ad.js","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/FeatureLikeLayerView3D-88097627.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/dehydratedFeatureComparison-7855b188.js","assets/terrainUtils-b6b761ab.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-511adea3.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/writeUtils-e226a8aa.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/SceneModification-073489fb.js","assets/persistable-a11ce298.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-63924db9.js","assets/SceneLayerWorker-b7dd55be.js","assets/I3SQueryFeatureStore-daac455a.js","assets/DefinitionExpressionSceneLayerView-8a0da2cd.js"]),csv:()=>ie(()=>import("./CSVLayerView3D-6e56de89.js"),["assets/CSVLayerView3D-6e56de89.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),dimension:()=>ie(()=>import("./DimensionLayerView3D-53b720e3.js"),["assets/DimensionLayerView3D-53b720e3.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js"]),elevation:$f,feature:()=>ie(()=>import("./FeatureLayerView3D-08fb50ad.js"),["assets/FeatureLayerView3D-08fb50ad.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),geojson:()=>ie(()=>import("./GeoJSONLayerView3D-bcfa9b43.js"),["assets/GeoJSONLayerView3D-bcfa9b43.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),graphics:()=>ie(()=>import("./GraphicsLayerView3D-e20a5d21.js"),["assets/GraphicsLayerView3D-e20a5d21.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/dehydratedPoint-5a1dfed5.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/GraphicsProcessor-c903d185.js","assets/UpdatingHandles-7949a657.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/LayerView-060b46d4.js"]),group:()=>ie(()=>import("./GroupLayerView-bee86e07.js"),["assets/GroupLayerView-bee86e07.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js"]),imagery:()=>ie(()=>import("./ImageryLayerView3D-78ae06cf.js"),["assets/ImageryLayerView3D-78ae06cf.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DynamicLayerView3D-23a674d4.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/ImageMaterial-10c9471b.js","assets/VerticalOffset.glsl-5743f98e.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/layerViewUtils-6ebe90f4.js","assets/ImageryLayerView-a6e95126.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/popupUtils-e4ebc84a.js"]),"integrated-mesh":()=>ie(()=>import("./IntegratedMeshLayerView3D-03a3dfe4.js"),["assets/IntegratedMeshLayerView3D-03a3dfe4.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/I3SMeshView3D-c4f22244.js","assets/UpdatingHandles-7949a657.js","assets/I3SOverrides-a9f31f33.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/uuid-709b6c67.js","assets/I3SNode-81f8301c.js","assets/I3SUtil-1c5e04a1.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/I3SBinaryReader-e72af7de.js","assets/layerViewUtils-6ebe90f4.js","assets/ReactiveSet-7afb73d5.js","assets/featureQueryAll-40af0622.js","assets/meshFeatureSet-8aa95dd7.js","assets/FeatureLayerView3D-08fb50ad.js","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/FeatureLikeLayerView3D-88097627.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/dehydratedFeatureComparison-7855b188.js","assets/terrainUtils-b6b761ab.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/SceneModification-073489fb.js","assets/persistable-a11ce298.js","assets/MD5-715f37cd.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-63924db9.js","assets/SceneLayerWorker-b7dd55be.js"]),"line-of-sight":()=>ie(()=>import("./LineOfSightLayerView3D-423f4622.js"),["assets/LineOfSightLayerView3D-423f4622.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js"]),"map-image":()=>ie(()=>import("./MapImageLayerView3D-f24080ca.js"),["assets/MapImageLayerView3D-f24080ca.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DynamicLayerView3D-23a674d4.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/ImageMaterial-10c9471b.js","assets/VerticalOffset.glsl-5743f98e.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/layerViewUtils-6ebe90f4.js","assets/MapImageLayerView-f56ba110.js","assets/ExportImageParameters-eb8f9ddb.js","assets/scaleUtils-72744379.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-4fbad2bd.js","assets/MapServiceLayerViewHelper-7f390707.js","assets/drapedUtils-5cffceb9.js","assets/popupUtils-e4ebc84a.js"]),media:()=>ie(()=>import("./MediaLayerView3D-608ca012.js"),["assets/MediaLayerView3D-608ca012.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/MediaElementView-bf85e2c4.js","assets/normalizeUtilsSync-7ead5aec.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/ImageMaterial-10c9471b.js","assets/VerticalOffset.glsl-5743f98e.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js"]),"ogc-feature":()=>ie(()=>import("./OGCFeatureLayerView3D-325028c1.js"),["assets/OGCFeatureLayerView3D-325028c1.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/OGCFeatureLayerView-e761230f.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),"open-street-map":Gl,"oriented-imagery":()=>ie(()=>import("./FeatureLayerView3D-08fb50ad.js"),["assets/FeatureLayerView3D-08fb50ad.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),"point-cloud":()=>ie(()=>import("./PointCloudLayerView3D-0b7fb2e4.js").then(i=>i.P),["assets/PointCloudLayerView3D-0b7fb2e4.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/vec3f32-bac7ea57.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/WorkerHandle-9433ab9a.js","assets/I3SUtil-1c5e04a1.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/I3SBinaryReader-e72af7de.js","assets/PointCloudWorkerUtil-4698dfea.js","assets/PointCloudUniqueValueRenderer-60348ed7.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/PopupSceneLayerView-3bc58223.js","assets/popupUtils-e4ebc84a.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/layerViewUtils-6ebe90f4.js"]),voxel:()=>ie(()=>import("./VoxelLayerView3D-295664c6.js"),["assets/VoxelLayerView3D-295664c6.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/projectVectorToVector-56c29b20.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/PopupSceneLayerView-3bc58223.js","assets/popupUtils-e4ebc84a.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),route:()=>ie(()=>import("./RouteLayerView3D-bd293235.js"),["assets/RouteLayerView3D-bd293235.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/CollectionFlattener-193451da.js","assets/RouteInfo-fa5be8a1.js","assets/Stop-bb61a730.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/GraphicsProcessor-c903d185.js","assets/UpdatingHandles-7949a657.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/EventedSet-680e6831.js","assets/LayerView-060b46d4.js"]),scene:i=>i.profile==null||i.profile==="mesh-pyramids"?ie(()=>import("./SceneLayerView3D-b5bfd0e1.js"),["assets/SceneLayerView3D-b5bfd0e1.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/ReactiveSet-7afb73d5.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/UnknownTimeZone-a05df022.js","assets/FeatureFilter-55dd341e.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/floorFilterUtils-080a7cd2.js","assets/I3SMeshView3D-c4f22244.js","assets/UpdatingHandles-7949a657.js","assets/I3SOverrides-a9f31f33.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/uuid-709b6c67.js","assets/I3SNode-81f8301c.js","assets/I3SUtil-1c5e04a1.js","assets/I3SBinaryReader-e72af7de.js","assets/layerViewUtils-6ebe90f4.js","assets/featureQueryAll-40af0622.js","assets/meshFeatureSet-8aa95dd7.js","assets/FeatureLayerView3D-08fb50ad.js","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/FeatureLikeLayerView3D-88097627.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/dehydratedFeatureComparison-7855b188.js","assets/terrainUtils-b6b761ab.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/QueryEngine-ee1ccbba.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/SceneModification-073489fb.js","assets/persistable-a11ce298.js","assets/MD5-715f37cd.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/resourceExtension-63924db9.js","assets/SceneLayerWorker-b7dd55be.js","assets/SceneLayerView-5ec175b3.js","assets/DefinitionExpressionSceneLayerView-8a0da2cd.js","assets/I3SQueryFeatureStore-daac455a.js","assets/PopupSceneLayerView-3bc58223.js"]):ie(()=>import("./SceneLayerGraphicsView3D-9d499548.js"),["assets/SceneLayerGraphicsView3D-9d499548.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/projectVectorToVector-56c29b20.js","assets/LayerConstants-d3ac1b7a.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/I3SOverrides-a9f31f33.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/uuid-709b6c67.js","assets/I3SNode-81f8301c.js","assets/I3SUtil-1c5e04a1.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/I3SBinaryReader-e72af7de.js","assets/layerViewUtils-6ebe90f4.js","assets/ReactiveSet-7afb73d5.js","assets/featureQueryAll-40af0622.js","assets/meshFeatureSet-8aa95dd7.js","assets/FeatureLayerView3D-08fb50ad.js","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/dehydratedFeatureComparison-7855b188.js","assets/terrainUtils-b6b761ab.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/coordinateSystem-38339d17.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/SceneLayerView-5ec175b3.js","assets/DefinitionExpressionSceneLayerView-8a0da2cd.js","assets/PopupSceneLayerView-3bc58223.js"]),stream:()=>ie(()=>import("./StreamLayerView3D-db1e6f54.js"),["assets/StreamLayerView3D-db1e6f54.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/StreamFeatureManager-3c1591f4.js","assets/CircularArray-ef508845.js","assets/createConnection-c6387383.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/OptimizedGeometry-196224d4.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-d7a48772.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/EventedSet-680e6831.js","assets/FeatureLikeLayerView3D-88097627.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/LayerView-060b46d4.js","assets/StreamLayerView-ea24b9cf.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),tile:Gl,"imagery-tile":()=>ie(()=>import("./ImageryTileLayerView3D-616ca655.js"),["assets/ImageryTileLayerView3D-616ca655.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/ImageryTileLayerView-59c582f2.js","assets/popupUtils-e4ebc84a.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/drapedUtils-5cffceb9.js","assets/capabilities-9d56a1da.js","assets/contextUtils-81fda295.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),"vector-tile":()=>ie(()=>import("./VectorTileLayerView3D-593e1b51.js"),["assets/VectorTileLayerView3D-593e1b51.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/mat3f32-6c416b1c.js","assets/TileInfoViewPOT-2edba27b.js","assets/Rect-ea14f53a.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/pbf-2651fe50.js","assets/rasterizingUtils-364392eb.js","assets/floatRGBA-ca990bbb.js","assets/TileKey-4b1303ff.js","assets/config-1337d16e.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/FramebufferObject-123b7c8d.js","assets/VertexArrayObject-d19dab8d.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/TileInfoView-ce4d65fb.js","assets/WGLBrushVTLSymbol-00207292.js","assets/vec4f32-0d1b2306.js","assets/definitions-5366d472.js","assets/enums-b1d611e3.js","assets/number-e491b09e.js","assets/vec2f32-eaf29605.js","assets/GeometryUtils-dd03fc25.js","assets/VTLMaterialManager-5138ba61.js","assets/ShaderCompiler-77d0dcb6.js","assets/programUtils-f035fe8a.js","assets/StyleRepository-00d8a116.js","assets/VertexElementDescriptor-2925c6af.js","assets/GeometryUtils-984e8446.js","assets/unitBezier-881ac1eb.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/rasterUtils-15abcc11.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),wcs:()=>ie(()=>import("./ImageryTileLayerView3D-616ca655.js"),["assets/ImageryTileLayerView3D-616ca655.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/ImageryTileLayerView-59c582f2.js","assets/popupUtils-e4ebc84a.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/drapedUtils-5cffceb9.js","assets/capabilities-9d56a1da.js","assets/contextUtils-81fda295.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),"web-tile":Gl,wfs:()=>ie(()=>import("./WFSLayerView3D-ab68d8d5.js"),["assets/WFSLayerView3D-ab68d8d5.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/FeatureLayerViewBase3D-6a7790b6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/FeatureLikeLayerView3D-88097627.js","assets/UpdatingHandles-7949a657.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/ViewingMode-5d7d590b.js","assets/dehydratedFeatureComparison-7855b188.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/terrainUtils-b6b761ab.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/queryForSymbologySnapping-caae9522.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/elevationInfoUtils-be36d866.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/hash-6f442295.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-ee1ccbba.js","assets/WhereClause-41137be1.js","assets/TimeOnly-879c5107.js","assets/projectionSupport-dcf335fc.js","assets/json-48e3ea08.js","assets/QueryEngineCapabilities-85c4f1d0.js","assets/utils-f54bcc46.js","assets/utils-1a995f8e.js","assets/scaleUtils-72744379.js","assets/FeatureStore-02a891a3.js","assets/BoundsStore-230a1891.js","assets/heatmapTextureUtils-6877589a.js","assets/projectExtentUtils-15e84132.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/queryZScale-d7a48772.js","assets/WorkerHandle-9433ab9a.js","assets/EventedSet-680e6831.js","assets/FeatureLayerView-7680760d.js","assets/FeatureEffect-c80bb16d.js","assets/LayerView-060b46d4.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/coordinateSystem-38339d17.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/Map-1ad4186f.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js"]),wms:()=>ie(()=>import("./WMSLayerView3D-2917c3cf.js"),["assets/WMSLayerView3D-2917c3cf.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DynamicLayerView3D-23a674d4.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/projectExtentUtils-15e84132.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/ImageMaterial-10c9471b.js","assets/VerticalOffset.glsl-5743f98e.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/layerViewUtils-6ebe90f4.js","assets/WMSLayerView-17758430.js","assets/ExportWMSImageParameters-e60a8707.js"]),wmts:()=>ie(()=>import("./WMTSLayerView3D-7b058ecb.js"),["assets/WMTSLayerView3D-7b058ecb.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/LayerView3D-c03d44fc.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/HeightModelInfo-b816d32b.js","assets/TiledLayerView3D-14f64d5b.js","assets/terrainUtils-b6b761ab.js","assets/ViewingMode-5d7d590b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/LayerView-060b46d4.js","assets/UpdatingHandles-7949a657.js","assets/RefreshableLayerView-4a86a8ac.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function yS(i){const e=i.declaredClass?i.declaredClass.slice(i.declaredClass.lastIndexOf(".")+1):"Unknown",t=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Mr(`${t}:view-not-supported`,`${e} is not supported in 3D`)}const Nf={hasLayerViewModule:i=>If[i.type]!=null,importLayerView:i=>{const e=If[i.type];if(e==null)throw yS(i);return e(i)}},Ff="analyses-owner-handles";var al,Kn;(function(i){i[i.PENDING=0]="PENDING",i[i.CREATED=1]="CREATED"})(al||(al={})),function(i){i[i.ADDED=0]="ADDED",i[i.REMOVED=1]="REMOVED"}(Kn||(Kn={}));let Bn=class extends ue{constructor(e){super(e),this._allAnalysisViews=new ho,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Vf(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(ks("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(ks()),this._attachedToViewResolver=Vf()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(t==null||t.state.list===Kn.REMOVED)throw new Mr("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.addHandles(this._connectAnalysesCollection(this.view.analyses),Ff)}_disconnectOwners(){this.removeHandles(Ff),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const s of e)this._addAnalysis(s);const t=e.on("after-add",s=>this._addAnalysis(s.item)),r=e.on("after-remove",s=>this._removeAnalysis(s.item));return dn(()=>{t.remove(),r.remove();for(const s of e)this._removeAnalysis(s)})}_addAnalysis(e){const t=this._items.get(e);if(t==null){const r={state:{view:al.PENDING,list:Kn.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=xu(s=>this._createAnalysisViewPromise(r,s))}else t.state.list=Kn.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=Kn.REMOVED,this._scheduleUpdate()):ce.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=$x(()=>this._update()))}_update(){this._scheduledUpdateHandle=Fa(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Kn.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case al.PENDING:e.createAnalysisViewTask=wo(e.createAnalysisViewTask);break;case al.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=re(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const r=e.analysis,s=r.type,a=this._analysisModules[s];if(this._creatingViewCount+=1,a.module==null)try{a.module=await this._loadAnalysisModule(s)}catch(o){throw this._creatingViewCount-=1,o}if(rn(t))throw this._creatingViewCount-=1,ks("AnalysisView creation aborted");const n=new a.module.default({analysis:r,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(rn(t))throw this._creatingViewCount-=1,n.destroy(),ks("AnalysisView creation aborted");return e.view=n,e.state.view=al.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return ie(()=>import("./AreaMeasurementAnalysisView3D-97405ff0.js").then(t=>t.A),["assets/AreaMeasurementAnalysisView3D-97405ff0.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/defaultUnit-414db021.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/AnalysisView3D-3b0b8c91.js","assets/interfaces-b9217804.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/projectVectorToVector-56c29b20.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/measurementUtils-2ddcde49.js","assets/geometryEngine-656a968c.js","assets/geometryEngineBase-dfbd3a67.js","assets/hydrated-40effdd0.js","assets/geodesicUtils-822c19ca.js","assets/UnitNormalizer-81df6daa.js","assets/ElevationProvider-abb53936.js","assets/euclideanAreaMeasurementUtils-f9ba1710.js","assets/measurementUtils-3881da59.js","assets/LineVisualElement-e3bb1937.js","assets/Object3DVisualElement-459b9b9c.js","assets/VisualElement-187372ae.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/lineStippleUtils-0688e06c.js","assets/EditGeometryOperations-c2e73f2d.js","assets/geometry2dUtils-a99dcf3d.js","assets/quantityFormatUtils-e5b1c45f.js","assets/Segment-fd60ac10.js","assets/viewUtils-9f810d02.js","assets/elevationInfoUtils-be36d866.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/TextOverlayItem-7f83875e.js"]);case"dimension":return ie(()=>import("./DimensionAnalysisView3D-cc2e9f9b.js"),["assets/DimensionAnalysisView3D-cc2e9f9b.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/AnalysisView3D-3b0b8c91.js","assets/LengthDimension-61f692da.js","assets/Cyclical-4c223a04.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/unitFormatUtils-67047561.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/Segment-fd60ac10.js","assets/VisualElement-187372ae.js","assets/viewUtils-9f810d02.js","assets/elevationInfoUtils-be36d866.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/TextOverlayItem-7f83875e.js","assets/projectVectorToVector-56c29b20.js","assets/euclideanLengthMeasurementUtils-aa8fca96.js","assets/measurementUtils-3881da59.js","assets/manipulatorUtils-9334c98f.js","assets/interfaces-0421c5e6.js","assets/ElevationProvider-abb53936.js","assets/ray-8da55042.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dragEventPipeline3D-4663cd2c.js","assets/InteractiveToolBase-ddd44c70.js","assets/interfaces-1a80c8eb.js","assets/drawUtils-bd7471ac.js","assets/ImageMaterial-10c9471b.js","assets/memoize-3e55df82.js","assets/UpdatingHandles-7949a657.js","assets/Factory-829a6ea7.js","assets/SnappingVisualizer3D-493bdb16.js","assets/ExtendedLineVisualElement-451ab04d.js","assets/vec4f32-0d1b2306.js","assets/EngineVisualElement-43f3e8cb.js","assets/LaserlineVisualElement-c0026af2.js","assets/PointVisualElement-11117df9.js","assets/Object3DVisualElement-459b9b9c.js","assets/RightAngleQuadVisualElement-95156bc2.js","assets/snappingUtils-93e84fbe.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/screenUtils-8dc4a7f9.js","assets/SnappingContext-90969376.js","assets/PointSnappingHint-671c9f09.js","assets/LineVisualElement-e3bb1937.js","assets/lineStippleUtils-0688e06c.js","assets/VerticesVisualElement-efafb673.js","assets/EditGeometryOperations-c2e73f2d.js","assets/geometry2dUtils-a99dcf3d.js","assets/SceneSnappingManagerPool-2ede5e56.js","assets/SnappingManager-aa70fdd4.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/SnappingDragPipelineStep-e275580d.js","assets/dehydratedFeatureComparison-7855b188.js","assets/SnappingOperation-4a4ee09b.js","assets/AnalysisToolBase-71ee6ca9.js","assets/quantityFormatUtils-e5b1c45f.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/analysisViewUtils-9b921032.js"]);case"direct-line-measurement":return ie(()=>import("./DirectLineMeasurementAnalysisView3D-fb3f8377.js").then(t=>t.D),["assets/DirectLineMeasurementAnalysisView3D-fb3f8377.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/defaultUnit-414db021.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/AnalysisView3D-3b0b8c91.js","assets/interfaces-b9217804.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/geometryEngine-656a968c.js","assets/geometryEngineBase-dfbd3a67.js","assets/hydrated-40effdd0.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/geodesicUtils-822c19ca.js","assets/LineVisualElement-e3bb1937.js","assets/ElevationProvider-abb53936.js","assets/Object3DVisualElement-459b9b9c.js","assets/VisualElement-187372ae.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/lineStippleUtils-0688e06c.js","assets/UnitNormalizer-81df6daa.js","assets/quantityFormatUtils-e5b1c45f.js","assets/interfaces-1d0b1e46.js","assets/Segment-fd60ac10.js","assets/viewUtils-9f810d02.js","assets/elevationInfoUtils-be36d866.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/TextOverlayItem-7f83875e.js","assets/projectVectorToVector-56c29b20.js","assets/RightAngleQuadVisualElement-95156bc2.js","assets/EngineVisualElement-43f3e8cb.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js"]);case"line-of-sight":return ie(()=>import("./LineOfSightAnalysisView3D-52843a9d.js"),["assets/LineOfSightAnalysisView3D-52843a9d.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/AnalysisView3D-3b0b8c91.js","assets/LineOfSightAnalysisTarget-09d41c0b.js","assets/persistable-a11ce298.js","assets/MD5-715f37cd.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/uuid-709b6c67.js","assets/resourceExtension-63924db9.js","assets/UpdatingHandles-7949a657.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/elevationInfoUtils-be36d866.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/ray-8da55042.js","assets/LineVisualElement-e3bb1937.js","assets/Object3DVisualElement-459b9b9c.js","assets/VisualElement-187372ae.js","assets/manipulatorUtils-9334c98f.js","assets/interfaces-0421c5e6.js","assets/manipulatorUtils-c4d6f78f.js","assets/LaserlineVisualElement-c0026af2.js","assets/DefaultUI-af7068c2.js","assets/jsxFactory-92036771.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/HeightModelInfo-b816d32b.js","assets/IViewEvents-9a85f53d.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/AnalysisToolBase-71ee6ca9.js","assets/InteractiveToolBase-ddd44c70.js","assets/drawUtils-bd7471ac.js","assets/PointVisualElement-11117df9.js","assets/analysisViewUtils-9b921032.js"]);case"slice":return ie(()=>import("./SliceAnalysisView3D-d73e1d00.js"),["assets/SliceAnalysisView3D-d73e1d00.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/AnalysisView3D-3b0b8c91.js","assets/SlicePlane-40eedf78.js","assets/Cyclical-4c223a04.js","assets/persistable-a11ce298.js","assets/MD5-715f37cd.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/uuid-709b6c67.js","assets/resourceExtension-63924db9.js","assets/boundedPlane-1da2f094.js","assets/BuildingComponentSublayer-0e038021.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/Version-1f969b2a.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/FeatureLayer-c4c5819f.js","assets/FeatureLayerBase-0746b503.js","assets/HeightModelInfo-b816d32b.js","assets/featureLayerUtils-16361d1f.js","assets/featureQueryAll-40af0622.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/AttachmentQuery-bede5a71.js","assets/RelationshipQuery-2c9e4485.js","assets/LayerFloorInfo-4234db4d.js","assets/serviceCapabilitiesUtils-42d4d20c.js","assets/editsZScale-e45bb69c.js","assets/queryZScale-d7a48772.js","assets/APIKeyMixin-bfb00271.js","assets/EditBusLayer-caf9fed8.js","assets/FeatureEffectLayer-1948d1a0.js","assets/FeatureEffect-c80bb16d.js","assets/FeatureFilter-55dd341e.js","assets/FeatureReductionLayer-443167bc.js","assets/clusterUtils-50a66940.js","assets/FeatureReductionSelection-d84c375a.js","assets/LabelClass-c3c309a8.js","assets/labelUtils-b29175f3.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-32293fe1.js","assets/FeatureTemplate-d1d1c7be.js","assets/FeatureType-f30c4b8b.js","assets/fieldProperties-8c831c84.js","assets/labelingInfo-aae625ac.js","assets/versionUtils-5892620e.js","assets/styleUtils-a3d96bf6.js","assets/TopFeaturesQuery-6d0bf5f5.js","assets/capabilities-c607cf72.js","assets/I3SIndexInfo-ea0c11e7.js","assets/I3SLayerDefinitions-9d2b79a5.js","assets/I3SUtil-1c5e04a1.js","assets/projectVectorToVector-56c29b20.js","assets/I3SBinaryReader-e72af7de.js","assets/edgeUtils-6e4a97fb.js","assets/symbolColorUtils-3ca646c8.js","assets/orientedBoundingBox-67c5cd22.js","assets/ViewingMode-5d7d590b.js","assets/popupUtils-e4ebc84a.js","assets/ShiftManipulator-85ff8a40.js","assets/manipulatorUtils-9334c98f.js","assets/interfaces-0421c5e6.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/ElevationProvider-abb53936.js","assets/ray-8da55042.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/verticalOffsetUtils-e5214af9.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/ImageMaterial-10c9471b.js","assets/LineVisualElement-e3bb1937.js","assets/Object3DVisualElement-459b9b9c.js","assets/VisualElement-187372ae.js","assets/lineStippleUtils-0688e06c.js","assets/RenderCoordsHelper-8f237859.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/projectVectorToPoint-fbaf5599.js","assets/coordinateSystem-38339d17.js","assets/Factory-829a6ea7.js","assets/dragEventPipeline3D-4663cd2c.js","assets/elevationInfoUtils-be36d866.js","assets/InteractiveToolBase-ddd44c70.js","assets/interfaces-1a80c8eb.js","assets/drawUtils-bd7471ac.js","assets/AnalysisToolBase-71ee6ca9.js","assets/screenUtils-8dc4a7f9.js","assets/analysisViewUtils-9b921032.js"])}}};function Vf(){const i=gy();return i.promise.catch(()=>{}),i}h([u()],Bn.prototype,"updating",null),h([u({constructOnly:!0})],Bn.prototype,"view",void 0),h([u()],Bn.prototype,"_allAnalysisViews",void 0),h([u()],Bn.prototype,"_creatingViewCount",void 0),Bn=h([N("esri.views.3d.analysis.AnalysisViewManager3D")],Bn);const vS=Bn;let _a=class extends ue{constructor(e){super(e),this.collision=new lc,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ne.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ne.Local?this._set("altitude",e):ce.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?K(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const r=this.tilt(e);return K(t,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ne.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,r=hp)=>(r.min=xi.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?fd([[4e3,xi.max],[1e4,Ht(88)],[6e6,Ht(88)]]):()=>xi.max;return(t,r=hp)=>(r.min=xi.min,r.max=e(t),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?fd([[4e3,xi.max],[5e4,Ht(88)],[6e6,Ht(88)],[2e7,xi.min]]):fd([[3e5,xi.max],[3e6,Ht(88)],[6e6,Ht(88)],[2e7,xi.min]]);return(t,r=hp)=>(r.min=xi.min,r.max=e(t),r)}};function bS(i){return{min:-2e5,max:4*i.radius}}h([u()],_a.prototype,"altitude",null),h([u({readOnly:!0})],_a.prototype,"collision",void 0),h([u()],_a.prototype,"distance",void 0),h([u({readOnly:!0})],_a.prototype,"minimumPoiDistance",void 0),h([u()],_a.prototype,"tilt",void 0),h([u({constructOnly:!0})],_a.prototype,"mode",void 0),_a=h([N("esri.views.3d.state.Constraints")],_a);const Uf=bS(Fs),xi={min:Ht(.5),max:Ht(179.5)},hp={min:0,max:0};let lc=class extends ue{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};h([u({type:Boolean})],lc.prototype,"enabled",void 0),h([u({type:Number})],lc.prototype,"elevationMargin",void 0),lc=h([N("esri.views.3d.state.Constraints.CollisionConstraint")],lc);let nl=class extends ue{constructor(){super(...arguments),this.min=Uf.min,this.max=Uf.max}};h([u({type:Number})],nl.prototype,"min",void 0),h([u({type:Number})],nl.prototype,"max",void 0),nl=h([N("esri.views.3d.constraints.AltitudeConstraint")],nl);let ba=class extends ue{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};h([u({type:Number,value:1e-8})],ba.prototype,"near",null),h([Cl("near")],ba.prototype,"castNear",null),h([u({type:Number,value:1e-8})],ba.prototype,"far",null),h([Cl("far")],ba.prototype,"castFar",null),h([u({type:["auto","manual"]})],ba.prototype,"mode",void 0),ba=h([N("esri.views.3d.constraints.ClipDistanceConstraint")],ba);const Em={min:om(xi.min),max:om(xi.max)};let Jn=class extends ue{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return K(e,Em.min,Em.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};h([u({type:["auto","manual"]})],Jn.prototype,"mode",void 0),h([u({type:Number,value:Em.max})],Jn.prototype,"max",null),h([Cl("max")],Jn.prototype,"castMax",null),Jn=h([N("esri.views.3d.constraints.TiltConstraint")],Jn);let eo=class extends ue{constructor(){super(...arguments),this.tilt=new Jn,this.altitude=new nl,this.clipDistance=new ba}};h([u({type:Jn})],eo.prototype,"tilt",void 0),h([u({type:nl})],eo.prototype,"altitude",void 0),h([u({type:ba})],eo.prototype,"clipDistance",void 0),eo=h([N("esri.views.3d.constraints.Constraints")],eo);var Xo;const Hv="esri.views.3d.environment.SunLighting",Sh=ce.getLogger(Hv);let As=Xo=class extends Xr.EventedMixin(Jy){constructor(i){super(i),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),t=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",t),this._set("date",t)}get ambientOcclusionEnabled(){return ln(Sh,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(i){ln(Sh,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",i)}get waterReflectionEnabled(){return ln(Sh,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(i){ln(Sh,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(i){return new Xo(i.cloneConstructProperties())}set defaultDate(i){const e=this._get("date")===this._get("defaultDate");i=new Date(i.getTime()),this._set("defaultDate",i),e&&this._set("date",i)}set date(i){i!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(i.getTime())))}autoUpdate(i,e){const t=Xo.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;i!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(i.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(i.getTime()))));const s=Xo.calculateTimezoneOffset(this.positionTimezoneInfo);if(t!==s&&(Rh.target=this,Rh.timezoneOffset=s,this.emit("timezone-will-change",Rh),Rh.target=null),i!=null)return isNaN(i.getTime())||r!==i.getTime()}clone(){const i=this._get("date")===this._get("defaultDate"),e=new Xo({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return i&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(i){const e=this.clone();return i.date!=null&&(e.date=i.date),e.directShadowsEnabled=i.directShadowsEnabled,e.displayUTCOffset=i.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([u({type:Boolean})],As.prototype,"cameraTrackingEnabled",void 0),h([u({type:Boolean})],As.prototype,"ambientOcclusionEnabled",null),h([u({type:Boolean})],As.prototype,"waterReflectionEnabled",null),h([u({type:Date})],As.prototype,"defaultDate",null),h([u({type:Date})],As.prototype,"date",null),As=Xo=h([N(Hv)],As),function(i){function e({hours:t,minutes:r,seconds:s}){return Math.round(t+r/60+s/3600)}i.calculateTimezoneOffset=e}(As||(As={}));const Rh={target:null,timezoneOffset:0},Hn=As;var wd;const kv="esri.views.3d.environment.VirtualLighting",Oh=ce.getLogger(kv);let Yo=wd=class extends Xr.EventedMixin(ev){constructor(i){super(i),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return ln(Oh,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(i){ln(Oh,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",i)}get waterReflectionEnabled(){return ln(Oh,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(i){ln(Oh,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",i)}clone(){return new wd({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(i){return new wd(i.cloneConstructProperties())}cloneWithWebsceneLighting(i){const e=this.clone();return e.directShadowsEnabled=i.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};h([u({type:Boolean})],Yo.prototype,"ambientOcclusionEnabled",null),h([u({type:Boolean})],Yo.prototype,"waterReflectionEnabled",null),h([u({type:Boolean})],Yo.prototype,"cameraTrackingEnabled",void 0),Yo=wd=h([N(kv)],Yo);const cc=Yo,wS={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Hn,virtual:cc}};var Am;let Ac=Am=class extends ue{set quality(i){["low","high"].includes(i)&&this._set("quality",i)}clone(){return new Am({quality:this.quality})}};h([u({type:["low","high"],value:"low"})],Ac.prototype,"quality",null),Ac=Am=h([N("esri.views.3d.environment.SceneViewAtmosphere")],Ac);var hc;let Ko=hc=class extends tv{constructor(i){super(i),this.atmosphere=new Ac,this.lighting=this.castLighting(),this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(i){const e=i.cloneConstructProperties();return new hc({...e,lighting:e.lighting?e.lighting.type==="virtual"?cc.fromWebsceneLighting(e.lighting):Hn.fromWebsceneLighting(e.lighting):void 0})}castLighting(i){return this._convertLightingWithDestroy(i)}applyLighting(i){this.lighting=this._convertLightingWithDestroy(i)}_convertLightingWithDestroy(i){const e=this._convertLighting(i);return e!==i&&this.addHandles(Ix(e)),e}_convertLighting(i){var e,t;return i?i instanceof Hn||i instanceof cc?i:i instanceof Jy?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(i):new Hn({...i.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):i instanceof ev?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(i):new cc({...i.cloneConstructProperties(),...(t=this.lighting)==null?void 0:t.cloneNonPersistentConstructProperties()}):Nx(wS,i):new Hn}clone(){return new hc({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Og(this.background)})}cloneWithWebsceneEnvironment(i){return new hc({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Og(this.background),...i.cloneConstructProperties(),lighting:this._getLighting(i)})}_getLighting(i){switch(i.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(i.lighting):Hn.fromWebsceneLighting(i.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(i.lighting):cc.fromWebsceneLighting(i.lighting);default:return fn(i.lighting),Hn.fromWebsceneLighting(i.lighting)}}};h([u({type:Ac,json:{read:!1},nonNullable:!0})],Ko.prototype,"atmosphere",void 0),h([u({nonNullable:!0})],Ko.prototype,"lighting",void 0),h([Cl("lighting")],Ko.prototype,"castLighting",null),Ko=hc=h([N("esri.views.3d.environment.SceneViewEnvironment")],Ko);const Jo=Ko;var Di;(function(i){i[i.Realistic=0]="Realistic",i[i.Local=1]="Local",i[i.Mars=2]="Mars",i[i.None=3]="None"})(Di||(Di={}));function I_(i){return K((i-1e5)/(1e6-1e5),0,1)}const Mm=1e4,xS=.085,tn=1e5,Mc=ft(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),dp=3,up=ft(dp*parseFloat(65e-8.toFixed(6)),dp*parseFloat(1881e-9.toFixed(6)),dp*parseFloat(85e-9.toFixed(6))),TS=3996e-9,CS=ft(parseFloat(Number(Mc[0]+up[0]).toFixed(6)),parseFloat(Number(Mc[1]+up[1]).toFixed(6)),parseFloat(Number(Mc[2]+up[2]).toFixed(6)));function PS(i){const e=new At;e.attributes.add(se.POSITION,"vec2"),e.include(Lu,{textureCoordinateType:wn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:t,fragment:r}=e;return t.uniforms.add(new Gi("inverseProjectionMatrix",(s,a)=>a.camera.inverseProjectionMatrix),new Gi("inverseViewMatrix",(s,a)=>Tu(SS,a.camera.viewMatrix))),t.code.add(_`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ci("backgroundColor",s=>s.backgroundColor),new Si("radii",s=>s.radii),new Ci("cameraPosition",(s,a)=>a.camera.eye),new Ma("heightParameters",s=>s.heightParameters),new Ue("innerFadeDistance",s=>s.innerFadeDistance),new Ue("altitudeFade",s=>s.altitudeFade),new ke("depthTexture",s=>s.depthTexture),new Ue("hazeStrength",s=>s.hazeStrength)),r.constants.add("betaRayleigh","vec3",Mc),r.constants.add("betaCombined","vec3",CS),r.constants.add("betaMie","float",TS),r.constants.add("scaleHeight","float",xS*tn),P_(r),e.include(A_),i.haze&&(r.include(go),r.uniforms.add(new Si("nearFar",(s,a)=>a.camera.nearFar))),r.code.add(_`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(_`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(_`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(_`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${i.haze?_`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${i.haze?"":_`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${i.haze?"":_`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${i.haze?_`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:_`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${i.haze?"":_`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${i.haze&&i.reduced?_`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${i.haze?_`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${i.reduced?_`cameraSpaceRay *= -textureBilinear(vuv0);`:_`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:_`${i.reduced?"":_`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${i.haze?_`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:_`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${i.haze?"":_`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const SS=nt(),RS=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:Mc,build:PS},Symbol.toStringTag,{value:"Module"}));let OS=class extends ti{constructor(){super(...arguments),this.heightParameters=gi(),this.radii=yi(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=yi(),this.backgroundColor=b()}},dc=class Gv extends $t{initializeProgram(e){return new Mt(e.rctx,Gv.shader.get().build(this.configuration),It)}initializePipeline(){return this.configuration.reduced?Je({blending:sa(G.ONE,G.ZERO),depthTest:{func:Pi.ALWAYS},colorWrite:tt}):this.configuration.haze?Je({blending:nr(G.ONE,G.ZERO,G.ONE_MINUS_SRC_COLOR,G.ONE),colorWrite:tt}):Je({blending:sa(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};dc.shader=new Lt(RS,()=>ie(()=>import("./ChapmanAtmosphere.glsl-7d91aa81.js"),["assets/ChapmanAtmosphere.glsl-7d91aa81.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let ou=class extends Ts{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};h([I()],ou.prototype,"haze",void 0),h([I()],ou.prototype,"reduced",void 0);let jv=class extends ti{};function ES(i){const e=new At;e.include($r),e.fragment.uniforms.add(new ke("colorTexture",r=>r.color),new ke("depthTexture",r=>r.depth));const t=i.haze;return e.fragment.code.add(_`
    void main() {
      ${t?_`vec4`:_`float`} depthSample = texture(depthTexture, uv) ${t?"":_`.r`};
      if (depthSample ${t?_`== vec4(0)`:_`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(colorTexture, uv);
    }
    `),e}const AS=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:jv,build:ES},Symbol.toStringTag,{value:"Module"}));let Wv=class Qv extends $t{initializeProgram(e){return new Mt(e.rctx,Qv.shader.get().build(this.configuration),It)}initializePipeline(){return this.configuration.haze?Je({blending:nr(G.ONE,G.ZERO,G.ONE_MINUS_SRC_COLOR,G.ONE),depthTest:{func:Pi.ALWAYS},colorWrite:tt}):Je({blending:sa(G.SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.ALWAYS},colorWrite:tt})}};Wv.shader=new Lt(AS,()=>ie(()=>import("./AtmosphereCompositing.glsl-c99b8cd8.js"),["assets/AtmosphereCompositing.glsl-c99b8cd8.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let zf=class{constructor(e,t){this._view=e,this._context=t,this.type=Di.Realistic,this._handles=new ph,this._atmosphereCompositionParameters=new jv,this._atmosphereConfiguration=new ou,this._passParameters=new OS,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Fs.radius,this._fadeHaze=0,this._updateRadius(Fs.radius);const r=this._context.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([D(()=>{var a,n;return(n=(a=this._view)==null?void 0:a.basemapTerrain)==null?void 0:n.rootTileElevationBounds},()=>{var a;return(a=this._view)!=null&&a.basemapTerrain?this._updateRootTileElevationBounds():null}),D(()=>{var a,n;return(n=(a=this._view)==null?void 0:a.basemapTerrain)==null?void 0:n.visibleElevationBounds},()=>{var a;return(a=this._view)!=null&&a.basemapTerrain?this._updateVisibleElevationBounds():null}),D(()=>{var a;return(a=this._view)==null?void 0:a.environment.background},a=>{const n=a instanceof EC?Bc(a.color):l_;Xt(this._passParameters.backgroundColor,n[0]*n[3],n[1]*n[3],n[2]*n[3])},yt)]);const s=new ou;s.haze=!1,this._atmosphereTechnique=this._context.techniqueRepository.acquire(dc,s),s.haze=!0,this._atmosphereHazeTechnique=this._context.techniqueRepository.acquire(dc,s),s.reduced=!0,s.haze=!1,this._atmosphereReducedTechnique=this._context.techniqueRepository.acquire(dc,s),s.haze=!0,this._atmosphereHazeReducedTechnique=this._context.techniqueRepository.acquire(dc,s),this._vao=na(r,$u)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,t){this._render(e,t?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,t,!1)}renderHaze(e,t,r){var s;this._fadeHaze=t,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,(s=e.bindParameters.linearDepth)==null?void 0:s.colorTexture,r,!0)}_render(e,t,r,s,a){if(r==null)return;const n=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=r;const o=e.rctx.bindTechnique(t,this._passParameters,e.bindParameters);if(s)n.renderDepthDetached(()=>this._renderCommon(o,e));else{const l=e.rctx.getViewport(),c=ve(e.bindParameters.camera.eye)-Fs.radius;let d;if(c<tn){const y=Math.min(1,Math.max(0,c/tn));d=a?He(.4,.5,y):He(.2,.3,y)}else{const y=Math.min(1,Math.max(0,(c-tn)/(15*tn)));d=a?He(.5,1,y):He(.3,.6,y)}const p=vm(Math.round(d*e.bindParameters.camera.fullViewport[2])),m=vm(Math.round(d*e.bindParameters.camera.fullViewport[3]));e.rctx.setViewport(0,0,p,m);const g=n.renderToCachedFBO(null,()=>this._renderCommon(o,e),[0,0,0,1],Vt.RGBA,null,p,m);e.rctx.setViewport(l.x,l.y,l.width,l.height),this._atmosphereCompositionParameters.color=g.colorTexture,this._atmosphereCompositionParameters.depth=r,this._atmosphereConfiguration.haze=a;const f=this._context.techniqueRepository.acquire(Wv,this._atmosphereConfiguration);e.rctx.bindTechnique(f,this._atmosphereCompositionParameters,e.bindParameters),n.renderDepthDetached(()=>e.rctx.screen.draw()),f.release(),g.release()}}_renderCommon(e,t){this._vao!=null&&(t.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),t.rctx.drawArrays(fi.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Fs.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Fs.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Gr(this._passParameters.radii,e,e+tn),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-Mm)*Mm)}_update(e){if(!e)return;const t=gs(e.eye),r=Math.sqrt(t),s=t-this._passParameters.radii[1]*this._passParameters.radii[1],a=K((r-this._passParameters.radii[0])/tn,0,1);Va(this._passParameters.heightParameters,r,t,s,a),this._passParameters.altitudeFade=I_(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=He(He(.6,1,Hc(9500,10500,r-Fs.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function MS(){const i=new At,{attributes:e,varyings:t,vertex:r,fragment:s}=i;return e.add(se.POSITION,"vec2"),t.add("worldRay","vec3"),r.uniforms.add(new Gi("inverseProjectionMatrix",(a,n)=>n.camera.inverseProjectionMatrix),new Gi("inverseViewMatrix",(a,n)=>Tu(DS,n.camera.viewMatrix))),r.code.add(_`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),s.include(iv),s.include(xo),i.include(MC,{pbrMode:Qt.Disabled,lightingSphericalHarmonicsOrder:2}),i.include(DC),i.include(A_),i.include(LC),i.include(o3),s.uniforms.add(new Ci("cameraPosition",(a,n)=>n.camera.eye)),s.code.add(_`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),i}const DS=nt(),LS=Object.freeze(Object.defineProperty({__proto__:null,build:MS},Symbol.toStringTag,{value:"Module"}));let Zv=class Xv extends $t{constructor(e){super(e,new Ts,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,Xv.shader.get().build(),It)}initializePipeline(){return Je({blending:nr(G.ONE,G.ZERO,G.SRC_ALPHA,G.ONE),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};Zv.shader=new Lt(LS,()=>ie(()=>import("./CloudsComposition.glsl-f8c8123c.js"),["assets/CloudsComposition.glsl-f8c8123c.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let kn=class extends ue{constructor(e){super(e),this._technique=new Zv(e),this._vao=na(e.rctx)}destroy(){this._technique=et(this._technique),this._vao=De(this._vao)}render(e){if(!this._technique.compiled)return void this.requestRender();const t=e.bindParameters.cloudsFade;if(this._vao==null||t.data==null)return;const r=e.rctx.bindTechnique(this._technique,$S,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(fi.TRIANGLE_STRIP,0,4)}};h([u({constructOnly:!0})],kn.prototype,"rctx",void 0),h([u({constructOnly:!0})],kn.prototype,"viewingMode",void 0),h([u({constructOnly:!0})],kn.prototype,"planetRadius",void 0),h([u({constructOnly:!0})],kn.prototype,"requestRender",void 0),kn=h([N("esri.views.3d.environment.CloudsComposition")],kn);const $S=new ti;var ar;(function(i){i[i.SIXTEEN=0]="SIXTEEN",i[i.HUNDRED=1]="HUNDRED",i[i.TWOHUNDRED=2]="TWOHUNDRED",i[i.COUNT=3]="COUNT"})(ar||(ar={}));let xd=class extends Ts{constructor(){super(...arguments),this.steps=ar.SIXTEEN,this.writeTextureChannels=M_.RG}};h([I({count:ar.COUNT})],xd.prototype,"steps",void 0),h([I({constValue:li("esri-mobile")?1024:2048})],xd.prototype,"cubeMapSize",void 0),h([I()],xd.prototype,"writeTextureChannels",void 0);let uc=class{constructor(e,t,r,s,a,n,o,l,c=.5){this.coverage=e,this.density=t,this.absorption=r,this.cloudSize=s,this.detailSize=a,this.smoothness=n,this.cloudHeight=o,this.raymarchingSteps=l,this.median=c}};const qf=new uc([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ar.SIXTEEN),Mi={sunny:qf,cloudy:new uc([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ar.TWOHUNDRED,.6),rainy:new uc([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ar.TWOHUNDRED,.4),snowy:new uc([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ar.HUNDRED,.65),foggy:new uc([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ar.SIXTEEN),default:qf},zr=li("esri-mobile")?64:128,IS=zr/128,hs=Math.ceil(Math.sqrt(zr)),_n=(zr+2)*hs,NS=1e5,pp=128,FS=_n/1560;let Yv=class extends ti{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=Mi.default.raymarchingSteps,this.weatherTile=yi()}},Kv=class extends ti{constructor(){super(...arguments),this.viewMatrix=Ua()}};function VS(i){const e=new At;e.include($r,!1);const t=e.fragment;return t.uniforms.add(new Ue("cloudRadius",r=>r.cloudRadius),new Ue("power",r=>He(35,120,r.absorption)),new Ue("sigmaE",r=>1+r.absorption),new Ue("density",r=>He(0,.3,r.density)),new Ue("cloudSize",r=>He(0,.02,Math.max(.01,1-r.cloudSize))),new Ue("detailSize",r=>He(0,.2,Math.max(.01,1-r.detailSize))),new Ue("smoothness",r=>He(0,.5,1-r.smoothness)),new Ue("cloudHeight",r=>He(0,1500,r.cloudHeight)),new Ue("coverage",r=>r.coverage),new bm("view",r=>r.viewMatrix),new ke("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Si("cloudVariables",r=>Gr(US,r.coverage,r.absorption))),t.constants.add("halfCubeMapSize","float",.5*i.cubeMapSize),t.code.add(_`
    const int STEPS = ${i.steps===ar.SIXTEEN?_`16`:i.steps===ar.HUNDRED?_`100`:_`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.code.add(_`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${_.float(_n)};
      const float dataWidth = ${_.float(_n)};
      const float tileRows = ${_.float(hs)};
      const vec3 atlasDimensions = vec3(${_.float(zr)}, ${_.float(zr)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${_.float(IS)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${_.float(FS)} * p) / ${_.float(_n)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),t.code.add(_`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.code.add(_`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.code.add(_`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.code.add(_`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),t.code.add(_`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const US=yi(),zS=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:Kv,CloudsPassParameters:Yv,build:VS},Symbol.toStringTag,{value:"Module"}));let Jv=class eb extends $t{constructor(e,t){super(e,t,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,eb.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:sa(G.CONSTANT_COLOR,G.ONE_MINUS_CONSTANT_COLOR,Rv.ADD,this.configuration.writeTextureChannels===M_.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};Jv.shader=new Lt(zS,()=>ie(()=>import("./Clouds.glsl-3e6213ec.js"),["assets/Clouds.glsl-3e6213ec.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/interfaces-8918b36f.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));var Er;(function(i){i[i.Full=0]="Full",i[i.WeatherMap=1]="WeatherMap",i[i.COUNT=2]="COUNT"})(Er||(Er={}));let Dm=class extends Ts{constructor(){super(...arguments),this.mode=Er.Full}};h([I({count:Er.COUNT})],Dm.prototype,"mode",void 0);let tb=class extends ti{constructor(){super(...arguments),this.weatherTile=Cu(0,0)}};function qS(i){const e=new At;return e.include($r,!1),e.fragment.code.add(_`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),i.mode===Er.Full&&e.fragment.code.add(_`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${_.float(hs)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${_.float(8)});

      float worley0 = worley(p, ${_.float(2)} * 2.0);
      float worley1 = worley(p, ${_.float(2)} * 8.0);
      float worley2 = worley(p, ${_.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${_.float(2)});
      float worley1 = worley(p, ${_.float(2)} * 2.0);
      float worley2 = worley(p, ${_.float(2)} * 4.0);
      float worley3 = worley(p, ${_.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Si("weatherTile",t=>t.weatherTile)),e.fragment.code.add(_`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${_.float(pp)});

      // Get global coordinates of p
      p += weatherTile * ${_.float(pp)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${_.float(NS)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(_`void main() {`),i.mode===Er.Full&&e.fragment.code.add(_`
        float padWidth = 1.0;
        float paddedSize = ${_.float(zr)} + 2.0 * padWidth;
        float tileCount = ${_.float(hs)} * ${_.float(hs)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${_.float(zr)};
          }

          if (startPadY) {
            pixel.y += ${_.float(zr)};
          }

          if (endPadX) {
            pixel.x -= ${_.float(zr)};
          }

          if (endPadY) {
            pixel.y -= ${_.float(zr)};
          }

          uv = vec2(pixel.xy / ${_.float(zr)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${_.float(zr)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${_.float(hs)} * ${_.float(hs)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${_.float(hs)} * ${_.float(hs)});
        p = p_;
        p.z /= (${_.float(hs)} * ${_.float(hs)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(_`
      vec2 mapUV = ${_.float(pp)} * (gl_FragCoord.xy / ${_.float(_n)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${i.mode===Er.Full?_`fragColor.ba = vec2(0.0, map);`:_`fragColor = vec4(map);`};
    }
  `),e}const BS=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:tb,build:qS},Symbol.toStringTag,{value:"Module"}));let Lm=class ib extends $t{initializeProgram(e){return new Mt(e.rctx,ib.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:this.configuration.mode===Er.Full?sa(G.ONE,G.ZERO):nr(G.ZERO,G.ONE,G.ONE,G.ZERO),depthTest:{func:Pi.ALWAYS},colorWrite:tt})}};Lm.shader=new Lt(BS,()=>ie(()=>import("./NoiseTextureAtlas.glsl-fd8ef8ce.js"),["assets/NoiseTextureAtlas.glsl-fd8ef8ce.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/interfaces-8918b36f.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let pc=class extends ue{constructor(e){super(e),this._needsRender=!0,this._passParameters=new tb,this._frameBuffer=new Iu(e.context.renderContext.rctx,new Yr(_n)),this._vao=na(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(Er.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(Er.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(za(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=et(this._fullTechniqueCached),this._weatherMapTechniqueCached=et(this._weatherMapTechniqueCached),this._frameBuffer=De(this._frameBuffer),this._vao=De(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new Dm;e.mode=Er.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(Lm,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new Dm;e.mode=Er.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(Lm,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const t=e===Er.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,s=r.getViewport();r.setViewport(0,0,_n,_n),r.bindFramebuffer(this._frameBuffer);const a=r.bindTechnique(t,this._passParameters,null);return r.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}};h([u({constructOnly:!0})],pc.prototype,"context",void 0),h([u({readOnly:!0})],pc.prototype,"_techniqueRepository",null),pc=h([N("esri.views.3d.environment.NoiseTextureAtlas")],pc);let Xi=class extends ue{constructor(e){super(e),this._techniques=new Array,this._techniqueConfiguration=new xd,this._bindParameters=new D_(null,null),this._passParameters=new Yv,this._drawParameters=new Kv,this._weatherTile=yi(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=He(Mi.default.coverage[0],Mi.default.coverage[1],.5),this.density=He(Mi.default.density[0],Mi.default.density[1],.5),this.absorption=He(Mi.default.absorption[0],Mi.default.absorption[1],.5),this.cloudSize=He(Mi.default.cloudSize[0],Mi.default.cloudSize[1],.5),this.detailSize=He(Mi.default.detailSize[0],Mi.default.detailSize[1],.5),this.smoothness=He(Mi.default.smoothness[0],Mi.default.smoothness[1],.5),this.cloudHeight=He(Mi.default.cloudHeight[0],Mi.default.cloudHeight[1],.5),this.raymarchingSteps=Mi.default.raymarchingSteps,this._viewMatrix=nt(),this._dirty=!1,this.running=!1,this._vao=na(e.context.renderContext.rctx)}_getTechnique(e){const t=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=t===M_.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=t,this._techniqueConfiguration.steps=e,this._techniques[r]=new Jv({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;if(e==null||t==null)return;Gr(this._weatherTile,(e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let s=0,a=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const n=new Date(this.view.environment.lighting.date);n.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),s=31*n.getUTCMonth()+n.getUTCDate(),a=n.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+s)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+a%100)%(4*this._weatherTileCount),Fx(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Tt(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this.addHandles([this.view.resourceController.scheduler.registerTask(ci.CLOUDS_GENERATOR,this),D(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),si)])}destroy(){this._techniques.forEach(e=>et(e)),this._frameBufferCube=De(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=re(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case ar.SIXTEEN:return 1;case ar.HUNDRED:return 4;case ar.COUNT:case ar.TWOHUNDRED:return 8}}get usedMemory(){var e,t,r;return(((e=this._frameBufferCube)==null?void 0:e.gpuMemoryUsage)??0)+(((r=(t=this._passParameters.noiseTexture)==null?void 0:t.textureAtlas)==null?void 0:r.gpuMemoryUsage)??0)}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new pc({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const t=new Yr(e);t.target=Cm.TEXTURE_CUBE_MAP,t.wrapMode=ra.CLAMP_TO_EDGE,this._frameBufferCube=new Iu(this.context.renderContext.rctx,t)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=De(this._frameBufferCube)}applyPreset(e,t){const r=e.median,s=a=>{const n=He(a[0],a[1],r);return t<.5?He(a[0],n,2*t):He(n,a[1],2*(t-.5))};this.coverage=s(e.coverage),this.density=s(e.density),this.absorption=s(e.absorption),this.cloudSize=s(e.cloudSize),this.detailSize=s(e.detailSize),this.smoothness=s(e.smoothness),this.cloudHeight=s(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),za(this._passParameters.weatherTile,this._weatherTile));const t=this._getTechnique(this._passParameters.raymarchingSteps);if(!t.compiled)return yr.YIELD;if(this.context.renderContext.bindParameters.cloudsFade.fadeMode===nc.CROSS_FADE||!this._ensureNoiseTexture())return yr.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Tm.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,s=r.bindTechnique(t,this._passParameters,this._bindParameters);r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport(),n=t.configuration.cubeMapSize,o=n/this._tilesPerFace,l=this._tileIndex*o;r.setViewport(0,l,n,o);const c=this._ensureFrameBufferCube(n);r.bindFramebuffer(c);const d=HS[this._faceIndex],p=kS[this._faceIndex];Vx(this._viewMatrix,GS,d,p),c_(this._drawParameters.viewMatrix,this._viewMatrix);const m=Cm.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(m),s.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.running||(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Tm.FADING)):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),yr.YIELD}};h([u({constructOnly:!0})],Xi.prototype,"context",void 0),h([u({constructOnly:!0})],Xi.prototype,"view",void 0),h([u({constructOnly:!0})],Xi.prototype,"requestRender",void 0),h([u()],Xi.prototype,"coverage",void 0),h([u()],Xi.prototype,"density",void 0),h([u()],Xi.prototype,"absorption",void 0),h([u()],Xi.prototype,"cloudSize",void 0),h([u()],Xi.prototype,"detailSize",void 0),h([u()],Xi.prototype,"smoothness",void 0),h([u()],Xi.prototype,"cloudHeight",void 0),h([u()],Xi.prototype,"raymarchingSteps",void 0),h([u()],Xi.prototype,"running",void 0),Xi=h([N("esri.views.3d.environment.CloudsGenerator")],Xi);const HS=[qs(1,0,0),qs(-1,0,0),qs(0,1,0),qs(0,-1,0),qs(0,0,1)],kS=[qs(0,1,0),qs(0,1,0),qs(0,0,-1),qs(0,0,1),qs(0,1,0)],GS=G3();let rb=class extends ti{constructor(){super(...arguments),this.fogColor=b(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function jS(){const i=new At;i.attributes.add(se.POSITION,"vec2"),i.include(Lu,{textureCoordinateType:wn.Default}),i.varyings.add("worldRay","vec3"),i.varyings.add("eyeDir","vec3");const{vertex:e,fragment:t}=i;return e.uniforms.add(new Gi("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Gi("inverseViewMatrix",(r,s)=>Tu(WS,s.camera.viewMatrix))),e.code.add(_`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),t.uniforms.add(new Ue("atmosphereC",r=>r.atmosphereC),new Ci("cameraPosition",(r,s)=>s.camera.eye),new Si("nearFar",(r,s)=>s.camera.nearFar),new ke("depthTexture",r=>r.depthTexture),new Ue("fogStrength",r=>r.fogStrength),new Ue("fogAmount",r=>r.fogAmount),new Ci("fogColor",r=>r.fogColor)),i.include(A_),t.include(go),t.code.add(_`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),t.code.add(_`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),t.code.add(_`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),i}const WS=nt(),QS=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:rb,build:jS},Symbol.toStringTag,{value:"Module"}));let sb=class ab extends $t{constructor(e){super(e,new Ts,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,ab.shader.get().build(),It)}initializePipeline(){return Je({blending:nr(G.SRC_ALPHA,G.ZERO,G.ONE_MINUS_SRC_ALPHA,G.ONE),colorWrite:tt})}};sb.shader=new Lt(QS,()=>ie(()=>import("./Fog.glsl-4035c3a3.js"),["assets/Fog.glsl-4035c3a3.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const ZS=.95,XS=1;let Gn=class extends ue{constructor(e){super(e),this._passParameters=new rb;const t=e.context.renderContext.rctx;this._vao=na(t,$u),this._technique=new sb(e);const r=Tt(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+tn}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,t){if(this._update(e,t),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper;s.renderDepthDetached(()=>{this._passParameters.depthTexture=s.depthTexture;const a=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(a,e)})}_renderFog(e,t){const r=t.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(fi.TRIANGLE_STRIP,0,4)}_update(e,t){const r=e.bindParameters.camera;ye(Bf,r.eye);const s=Math.max(0,Ie(Bf,e.bindParameters.lighting.mainLight.direction)),a=t.color;J(Hf,a,.1),ws(this._passParameters.fogColor,Hf,a,s);const n=ve(r.eye),o=n*n;this._passParameters.atmosphereC=o-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-Hc(ZS*Pm,XS*Pm,Math.abs(n-this._planetRadius)))*t.amount,this._passParameters.fogStrength=t.strength}static isSupported(e){return e.capabilities.depthTexture}};h([u({constructOnly:!0})],Gn.prototype,"context",void 0),h([u({constructOnly:!0})],Gn.prototype,"view",void 0),h([u({constructOnly:!0})],Gn.prototype,"rctx",void 0),h([u({constructOnly:!0})],Gn.prototype,"viewingMode",void 0),Gn=h([N("esri.views.3d.environment.Fog")],Gn);let YS=class{constructor(){this.color=b(),this.strength=0,this.amount=0}};const Bf=b(),Hf=b();var aa;(function(i){i[i.Cone=0]="Cone",i[i.Cylinder=1]="Cylinder",i[i.Underground=2]="Underground",i[i.COUNT=3]="COUNT"})(aa||(aa={}));let N_=class extends S_{constructor(){super(...arguments),this.geometry=aa.Cone}};h([I({count:aa.COUNT})],N_.prototype,"geometry",void 0);let F_=class extends ti{constructor(){super(...arguments),this.texV=yi(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new nb}},nb=class{constructor(){this.center=b(),this.v1=b(),this.v2=b()}};function KS(i){const e=new At,{vertex:t,fragment:r}=e;if(P_(t),i.geometry===aa.Underground)e.attributes.add(se.POSITION,"vec2"),e.varyings.add("color","vec4"),t.uniforms.add(new Ci("cameraPosition",(s,a)=>a.camera.eye),new Ue("undergroundFadeAlpha",s=>s.undergroundFadeAlpha)),t.code.add(_`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(_`void main() {
fragColor = color;
}`);else{e.include(rv,i),e.attributes.add(se.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const s=i.geometry===aa.Cylinder;t.uniforms.add(new Gi("proj",(o,l)=>l.camera.projectionMatrix),new Gi("view",(o,l)=>l.camera.viewMatrix)),s||(e.varyings.add("innerFactor","float"),t.uniforms.add(new Ci("silCircleCenter",o=>o.silhouette.center)),t.uniforms.add(new Ci("silCircleV1",o=>o.silhouette.v1)),t.uniforms.add(new Ci("silCircleV2",o=>o.silhouette.v2)),t.uniforms.add(new Si("texV",o=>o.texV)),t.uniforms.add(new Ue("innerScale",o=>o.innerScale)));const a=6.2831853,n=1/128;t.code.add(_`
		void main(void) {
      ${s?_`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:_`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${_.float(a*n)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${_.float(n)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new ke("tex",o=>o.texture)),s||r.uniforms.add(new Ue("altitudeFade",o=>o.altitudeFade)),r.code.add(_`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${s?_`fragColor = atmosphereColor;`:_`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const JS=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:nb,SimpleAtmospherePassParameters:F_,build:KS},Symbol.toStringTag,{value:"Module"}));let lu=class ob extends $t{initializeProgram(e){return new Mt(e.rctx,ob.shader.get().build(this.configuration),It)}initializePipeline(){return this.configuration.geometry===aa.Cylinder?Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),culling:Ov,depthTest:{func:Pi.LEQUAL},colorWrite:tt}):Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};lu.shader=new Lt(JS,()=>ie(()=>import("./SimpleAtmosphere.glsl-d2161d80.js"),["assets/SimpleAtmosphere.glsl-d2161d80.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const eR=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);let tR=class{constructor(e,t){this.type=Di.Local,this._configuration=new N_,this._passParameters=new F_,this._configuration.geometry=aa.Cylinder,this._technique=t.techniqueRepository.acquire(lu,this._configuration);const r=t.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=La(this._vao,"geometry");const s=new Yr;s.wrapMode=ra.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Hi(r,s,eR)}destroy(){this._passParameters.texture=De(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const t=e.rctx,r=t.bindTechnique(this._technique,this._passParameters,e.bindParameters);iR(kf,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",kf),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(fi.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const t=l3(1,2,!1),{data:r,indices:s}=t[0][1],a=Gf.createBuffer(s.length),n=a.position;for(let o=0;o<s.length;++o){const l=3*s[o%3==0?o+2:o%3==2?o-2:o];n.set(o,0,r[l]),n.set(o,1,r[l+1]),n.set(o,2,r[l+2])}return new To(e,It,{geometry:Rn(Gf)},{geometry:Lr.createVertex(e,vs.STATIC_DRAW,a.buffer)})}};function iR(i,e){Dl(i,e),i[12]=0,i[13]=0,i[14]=0,i[15]=1}const kf=nt(),Gf=On().vec3f(se.POSITION),rR=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),Eh=128,jf=-Mm,Wf=0,mp=50,sR=()=>1-511/512,aR=fd([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let nR=class{constructor(e,t){this.view=e,this.type=Di.Mars,this._passParameters=new F_,this._vaoCount=0,this._texV1=1;const r=Tt(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+jf)/this._planetRadius,this._middleRimFactor=(this._planetRadius+Wf)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=Wf/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=t.techniqueRepository;const s=t.renderContext.rctx;this._cameraChangeHandle=D(()=>{var o;return(o=this.view.state)==null?void 0:o.camera},()=>t.requestRender(),yt),this._vao=this._createRibbon(s),this._vaoCount=La(this._vao,"geometry"),this._fadeVao=na(s),this._fadeVaoCount=La(this._fadeVao,"geometry");const a=new Yr;a.wrapMode=ra.CLAMP_TO_EDGE,a.flipped=!0,a.width=1,a.height=512,this._passParameters.texture=new Hi(s,a,rR);const n=new N_;n.geometry=aa.Cone,this._coneTechnique=this._techniqueRepository.acquire(lu,n),n.geometry=aa.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(lu,n)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=De(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const t=e.bindParameters.camera;this._update(t);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(fi.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(fi.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const t=b(),r=this._planetRadius,s=ve(e.eye),a=s-r;if(a<0){const g=Math.min(-a/5e3,1);this._passParameters.undergroundFadeAlpha=g}else this._passParameters.undergroundFadeAlpha=0;const n=Math.max(mp,a),o=r+jf;this._passParameters.innerScale=oR(r+n,r,o)-1,this._passParameters.altitudeFade=I_(a),J(t,e.eye,(r+mp)/s),Qf(t,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,t,e.up,this._passParameters.silhouette),c=sR(),d=aR(a);let p=this._texV0+c*this._texVScale,m=this._texV0+l*d*this._texVScale;if(a>mp){Qf(e.eye,e.center,e.up,r,this._passParameters.silhouette);const g=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),f=K((g-1.5)/(l-1.5),0,1);p=this._texV0+f*c*this._texVScale,m=this._texV0+He(this._texV1,l*d,f)*this._texVScale}Gr(this._passParameters.texV,p,m)}_createRibbon(e){const t=sv(3+3*Eh*3),r=new Uint32Array(3*Eh*5);t[0]=0,t[1]=0,t[2]=-1;for(let n=0;n<Eh;n++){const o=9*n+3;t[o]=n,t[o+1]=this._innerRimFactor,t[o+2]=-1,t[o+3]=n,t[o+4]=this._middleRimFactor,t[o+5]=0,t[o+6]=n,t[o+7]=this._outerRimFactor,t[o+8]=1;const l=3*n+1,c=n===Eh-1?1:l+3,d=15*n;r[d]=l,r[d+1]=l+1,r[d+2]=c+1,r[d+3]=c+1,r[d+4]=c,r[d+5]=l,r[d+6]=l+1,r[d+7]=l+2,r[d+8]=c+2,r[d+9]=c+2,r[d+10]=c+1,r[d+11]=l+1,r[d+12]=l,r[d+13]=c,r[d+14]=0}const s=Zf.createBuffer(r.length),a=s.position;for(let n=0;n<r.length;++n){const o=3*r[n];a.set(n,0,t[o]),a.set(n,1,t[o+1]),a.set(n,2,t[o+2])}return new To(e,It,{geometry:Rn(Zf)},{geometry:Lr.createVertex(e,vs.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(e,t,r,s){return me($o,s.center,s.v2),J(Ah,$o,this._outerRimFactor),Ux(_p,t,$o,r),Eg($o,_p,e.projectionMatrix,e.viewport,$o),Eg(Ah,_p,e.projectionMatrix,e.viewport,Ah),sr($o,Ah)/e.height}};function Qf(i,e,t,r,s){const a=ve(i),n=r*Math.sqrt(a*a-r*r)/a,o=Math.sqrt(r*r-n*n),l=s.v1,c=s.v2;return J(s.center,i,o/a),Wt(l,i,e),gs(l)<1&&Wt(l,i,t),J(l,l,n/ve(l)),Wt(c,l,i),J(c,c,n/ve(c)),n}const _p=nt(),$o=b(),Ah=b();function oR(i,e,t){return i*i/(Math.sqrt(i*i-e*e)*Math.sqrt(i*i-t*t)+e*t)}const Zf=On().vec3f(se.POSITION);var qa;(function(i){i[i.Rain=0]="Rain",i[i.Snow=1]="Snow",i[i.COUNT=2]="COUNT"})(qa||(qa={}));let $m=class extends Ts{constructor(){super(...arguments),this.type=qa.Rain}};h([I({count:qa.COUNT})],$m.prototype,"type",void 0);function lR(i){const e=new At;return e.attributes.add(se.POSITION,"vec3"),e.attributes.add(se.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new Ci("cameraPosition",(t,r)=>r.camera.eye)),e.vertex.uniforms.add(new Ci("offset",(t,r)=>cR(t,r))),e.vertex.uniforms.add(new Ue("width",t=>t.width)),e.vertex.uniforms.add(new Gi("proj",(t,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new Gi("view",(t,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new Ue("time",t=>t.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(_`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${i.type===qa.Rain?_`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:_`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ue("opacity",t=>t.opacity),new Ci("particleColor",(t,r)=>hR(r,i))),e.fragment.code.add(_`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${i.type===qa.Rain?_`d = 0.35 * smoothstep(0.5, 0.0, d);`:_`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function cR(i,e){const t=e.camera.eye,r=.5*i.width,s=1/i.width,a=zx(Im,Xt(Im,(t[0]+r)*s,(t[1]+r)*s,(t[2]+r)*s));return Bi(a,t,J(a,a,i.width))}function hR(i,e){const t=e.type===qa.Rain?uR:dR,r=J(Im,t,pR),s=i.camera.eye;ye(Xf,s);const a=Math.max(0,Ie(Xf,i.lighting.mainLight.direction));return ws(r,r,t,a)}const Im=b(),Xf=b(),dR=ft(1,1,1),uR=ft(.85,.85,.85),pR=.7,mR=Object.freeze(Object.defineProperty({__proto__:null,build:lR},Symbol.toStringTag,{value:"Module"}));let _R=class extends ti{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},Nm=class lb extends $t{initializeProgram(e){return new Mt(e.rctx,lb.shader.get().build(this.configuration),Td)}initializePipeline(){return Je({blending:nr(G.ONE,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};Nm.shader=new Lt(mR,()=>ie(()=>import("./Precipitation.glsl-a3441d12.js"),["assets/Precipitation.glsl-a3441d12.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const Td=new Map([[se.POSITION,0],[se.INSTANCEFEATUREATTRIBUTE,1]]);let jn=class extends ue{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new _R,this._animation=new L3,this._updatingTracking=new Nu,this._passParameters.time=0,this._passParameters.radius=Tt(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=et(this._snowTechniqueCached),this._rainTechniqueCached=et(this._rainTechniqueCached),this._vao=De(this._vao),this._instanceIdBuffer=De(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new $m;e.type=qa.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(Nm,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new $m;e.type=qa.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(Nm,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,t,r){const s=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!s.compiled)return void this.context.requestRender();const a=e.rctx;if(this._ensureResources(a),s==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=e.bindParameters.cloudsFade.opacity),this._passParameters.opacity<=0))return;const n=.35;t=t<.5?He(0,n,2*t):He(n,1,2*(t-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*fy(this._animation.time)%1e5;const o=a.bindTechnique(s,this._passParameters,e.bindParameters);a.bindVAO(this._vao),o.assertCompatibleVertexAttributeLocations(this._vao),Q3(a,Td,this._instanceIdBuffer,Yf,0),a.drawArraysInstanced(fi.TRIANGLES,0,3,this._numParticles*t),Z3(a,Td,this._instanceIdBuffer,Yf)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let r=0;r<this._numParticles;r++)t.push(r);return Lr.createVertex(e,vs.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new To(e,Td,{geometry:Rn(gR)},{geometry:Lr.createVertex(e,vs.STATIC_DRAW,t)})}};h([u({constructOnly:!0})],jn.prototype,"context",void 0),h([u({constructOnly:!0})],jn.prototype,"view",void 0),h([u({readOnly:!0})],jn.prototype,"updating",null),h([u()],jn.prototype,"_updatingTracking",void 0),jn=h([N("esri.views.3d.environment.Precipitation")],jn);const gR=On().vec3f(se.POSITION),Yf=Rn(On().f32(se.INSTANCEFEATUREATTRIBUTE),1);function fR(){const i=new At;return i.attributes.add(se.POSITION,"vec3"),i.attributes.add(se.COLOR,"vec4"),i.attributes.add(se.SIZE,"float"),i.varyings.add("vcolor","vec4"),i.varyings.add("vsize","float"),i.vertex.uniforms.add(new Gi("transform",(e,t)=>yR(e,t)),new Ma("viewport",(e,t)=>t.camera.fullViewport),new Ue("pixelRatio",(e,t)=>t.camera.pixelRatio)),i.vertex.code.add(_`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),i.fragment.code.add(_`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),i}function yR(i,e){return Dl(ka,e.camera.projectionMatrix),ka[10]=24e-8-1,ka[11]=-1,ka[14]=(24e-8-2)*e.camera.near,jr(ka,ka,e.camera.viewMatrix),jr(ka,ka,i.modelMatrix)}const ka=nt(),vR=Object.freeze(Object.defineProperty({__proto__:null,build:fR},Symbol.toStringTag,{value:"Module"}));let bR=class extends ti{constructor(){super(...arguments),this.modelMatrix=nt()}},cb=class hb extends $t{constructor(e){super(e,new Ts,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,hb.shader.get().build(),It)}initializePipeline(){return Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),depthTest:{func:Pi.LEQUAL},colorWrite:tt})}};cb.shader=new Lt(vR,()=>ie(()=>import("./Stars.glsl-4f494d3d.js"),["assets/Stars.glsl-4f494d3d.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let en=class extends ue{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new bR,this._updatingTracking=new Nu}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=wo(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=et(this._technique),this._vao=De(this._vao),Mn=null}render(e){const{rctx:t}=e;if(this._ensureResources(t),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(fi.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Mn==null)return;this._technique=new cb({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Mn.byteLength/Kf;const t=new Float32Array(Mn,0,2*this._numPoints),r=new Uint8Array(Mn,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,s=>this._update(s),si)}_computeDayDuration(e){const t=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),s=Dl(this._renderParameter.modelMatrix,TR);Ag(s,s,-r*Math.PI),jr(s,xR,s),Ag(s,s,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,r,s){const a=Jf.createBuffer(s),n=a.position,o=a.color,l=a.size;for(let c=0;c<s;c++){const d=t[2*c],p=t[2*c+1];n.set(c,0,-Math.cos(d)*Math.sin(p)),n.set(c,1,-Math.sin(d)*Math.sin(p)),n.set(c,2,-Math.cos(p));const m=this._unpackUint8Attributes(r[c]),g=this._hexToRGB(wR[m[1]]);o.set(c,0,255*g[0]),o.set(c,1,255*g[1]),o.set(c,2,255*g[2]),o.set(c,3,255),l.set(c,m[0])}return new To(e,It,{geometry:Rn(Jf)},{geometry:Lr.createVertex(e,vs.STATIC_DRAW,a.buffer)})}_createLoadDataTask(){if(Mn!=null)return null;const e=xu(async t=>{const{data:r}=await qx("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(r),Mn=r});return e.promise.catch(t=>{yn(t)||ce.getLogger(this).error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new Mr("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Kf;if(t%1!=0||t>5e4||t<5e3)throw new Mr("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};h([u({constructOnly:!0})],en.prototype,"view",void 0),h([u({constructOnly:!0})],en.prototype,"requestRender",void 0),h([u({readOnly:!0})],en.prototype,"updating",null),h([u()],en.prototype,"_loadDataTask",void 0),h([u()],en.prototype,"_updatingTracking",void 0),en=h([N("esri.views.3d.environment.Stars")],en);const wR=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],xR=yy(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),TR=yy(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Kf=9,Jf=On().vec3f(se.POSITION).vec4u8(se.COLOR).f32(se.SIZE);let Mn=null;var vl;(function(i){i[i.Immediate=0]="Immediate",i[i.Faded=1]="Faded"})(vl||(vl={}));var mc;let bi=mc=class extends gh{constructor(i){super(i),this.produces=new Map([[$.ENVIRONMENT_OPAQUE,()=>!(this._atmosphere===null&&this._stars===null)],[$.ENVIRONMENT_TRANSPARENT,()=>this._atmosphere!==null]]),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new gp,this._newWeatherParameters=new gp,this._fadedWeatherParameters=new gp,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(this)}destroy(){var i;this.removeHandles(),this.uninitializeRenderContext(),((i=this.view)==null?void 0:i._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Di.None}consumes(){return this._atmosphereType===Di.Realistic?av:nv}updateAnimation(i){return this._precipitation!=null&&this._precipitation.update(i)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return ve(this.view.state.camera.eye)-Tt(this.view.spatialReference).radius<=Pm}get usedMemory(){var i;return((i=this._clouds)==null?void 0:i.usedMemory)??0}get _stars(){var r;const i=this.view,e=((r=i.environment)==null?void 0:r.starsEnabled)??!1,t=this._get("_stars");return e&&this._context!=null?t??new en({view:i,requestRender:()=>this._setNeedsRender()}):(re(t),null)}get _precipitation(){const i=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return re(i),null;const e=this.view,t=this._context;return i!=null&&i.context===t?i:(re(i),new jn({context:t,view:e}))}get _clouds(){const i=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return re(i),null;if(i!=null)return i;const e=this.view,t=this._context;return re(i),new Xi({context:t,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const i=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return re(i),null;const e=this.view.state.viewingMode,t=this._context.renderContext.rctx,r=Tt(this.view.spatialReference).radius;return i!=null&&i.viewingMode===e&&i.planetRadius===r?i:(re(i),new kn({rctx:t,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const i=this._get("_fog");if(!this.weatherEnabled||this._context==null)return re(i),null;if(i!=null)return i;const e=this.view,t=this._context,r=this._context.renderContext.rctx,s=this.view.state.viewingMode;return new Gn({context:t,view:e,rctx:r,viewingMode:s})}get weatherEnabled(){var i,e;return!!((e=(i=this.view)==null?void 0:i.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(i=null){this._context=i;const e=()=>this._setNeedsRender();this.addHandles([D(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),t=>this._updateAtmosphere(t),yt),D(()=>this._stars,e),D(()=>this._precipitation,e),D(()=>this._clouds,()=>this._updateWeather(),si),D(()=>this._fog,()=>this._updateFogHaze(),si),D(()=>this.view.state.mode,()=>{this._setNeedsRender()},at),D(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},yt)])}uninitializeRenderContext(){this._context=null,this._atmosphere=re(this._atmosphere),this._set("_stars",re(this._stars)),this._set("_precipitation",re(this._precipitation)),this._set("_clouds",re(this._clouds)),this._set("_cloudsComposition",re(this._cloudsComposition)),this._set("_fog",re(this._fog))}prepareRender(i){var e;i.bindParameters.cloudsFade.data=c3(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=i.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(this._updateWeatherFading(i.bindParameters,i.time),i.bindParameters.cloudsFade.renderingStage===Tm.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),i.bindParameters.cloudsFade.data=null))}renderNode(i){var e,t,r,s,a,n,o;switch(i.bindParameters.slot){case $.ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(i),this.atmosphere!=null&&(this.atmosphere.render(i,(r=(t=(e=this.view)==null?void 0:e._stage)==null?void 0:t.renderer)==null?void 0:r.fullResolutionAtmosphere),this._cloudsComposition!=null&&i.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(i)),i.bindParameters.cloudsFade.isFading&&this._context!=null&&((s=i.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case $.ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(i,this._weatherParameters.hazeAmount,(o=(n=(a=this.view)==null?void 0:a._stage)==null?void 0:n.renderer)==null?void 0:o.fullResolutionAtmosphere),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(i,this._weatherParameters.fog),this._precipitation!=null)){const l=this.view.environment.weather;l.type!=="rainy"&&l.type!=="snowy"||this._precipitation.render(i,l.precipitation,l.type)}}}updateLightSources(i,e,t,r){if(this._context!=null){const s=this._context.renderContext;s.bindParameters.oldLighting.copyFrom(s.bindParameters.lighting),s.bindParameters.newLighting.noonFactor=e,s.bindParameters.newLighting.globalFactor=t,s.bindParameters.newLighting.set(i),r===vl.Faded||s.bindParameters.weatherFading?s.bindParameters.fadeLighting(0):s.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const i=this.weatherEnabled?this.view.environment.weather:null;return i==null?null:i.type==="rainy"||i.type==="snowy"?{type:i.type,weatherAdjustment:i.cloudCover,effect:i.precipitation}:{type:i.type,weatherAdjustment:i.type==="foggy"?i.fogStrength:i.cloudCover}}_updateWeatherFading(i,e){i.cloudsFade.updateFading(i.camera,this.view.state.mode,e,this.view.qualitySettings.fadeDuration),i.cloudsFade.updateParallax(i.camera),i.weatherFading&&(this._updateLighting(i),this._updateFogAtmoshpere(i))}_updateLighting(i){i.cloudsFade.fadeMode!==nc.CROSS_FADE&&i.cloudsFade.fadeMode!==nc.FADE_IN?i.fadeLighting(0):i.fadeLighting(i.cloudsFade.fadeFactor)}_updateFogAtmoshpere(i){i.cloudsFade.fadeMode!==nc.CROSS_FADE&&i.cloudsFade.fadeMode!==nc.FADE_IN?this._fadeWeather(0):this._fadeWeather(i.cloudsFade.fadeFactor)}_fadeWeather(i){const{_newWeatherParameters:e,_oldWeatherParameters:t}=this;i>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(t,e,i),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const i=this._weatherUpdateParameters;i!=null&&this._clouds!=null&&(this._clouds.applyPreset(Mi[i.type],i.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const i=this._weatherUpdateParameters;if(this._fog==null||i==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),i.type){case"foggy":this._newWeatherParameters.fog.strength=He(3e-5,.005,i.weatherAdjustment**3),ae(this._newWeatherParameters.fog.color,e0),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=He(4e-6,2e-4,(i.effect??0)**3),ae(this._newWeatherParameters.fog.color,CR),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=He(4e-6,2e-4,(i.effect??0)**3),ae(this._newWeatherParameters.fog.color,e0),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(i){const e=this._selectAtmosphereType(i);if(e!==Di.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=re(this._atmosphere);const t=this._getAtmosphereClass(e);t&&(this._atmosphere=new t(this.view,this._context))}}else this._atmosphere=re(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(i){switch(i){case Di.Realistic:return zf;case Di.Local:return tR;case Di.Mars:return nR;default:case Di.None:return null}}_selectAtmosphereType(i){const{enabled:e,viewingMode:t}=i;return!e||h_(this.view.spatialReference)?Di.None:t===Ne.Local?Di.Local:this._context!=null&&zf.isSupported(this._context)&&lm(this.view.spatialReference)?Di.Realistic:d_(this.view.spatialReference)?Di.Mars:Di.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:i=>{t0=mc.prototype._getAtmosphereClass,mc.prototype._getAtmosphereClass=i},restoreGetAtmosphereClass:()=>{mc.prototype._getAtmosphereClass=t0}}}};h([u({constructOnly:!0})],bi.prototype,"view",void 0),h([u({readOnly:!0})],bi.prototype,"atmosphere",null),h([u({readOnly:!0})],bi.prototype,"_atmosphereType",null),h([u({type:Boolean,readOnly:!0})],bi.prototype,"updating",null),h([u({readOnly:!0})],bi.prototype,"weatherVisible",null),h([u()],bi.prototype,"_context",void 0),h([u()],bi.prototype,"_atmosphere",void 0),h([u({readOnly:!0})],bi.prototype,"_stars",null),h([u({readOnly:!0})],bi.prototype,"_precipitation",null),h([u({readOnly:!0})],bi.prototype,"_clouds",null),h([u({readOnly:!0})],bi.prototype,"_cloudsComposition",null),h([u({readOnly:!0})],bi.prototype,"_fog",null),h([u({readOnly:!0})],bi.prototype,"weatherEnabled",null),h([u({readOnly:!0})],bi.prototype,"_precipitationEnabled",null),h([u({readOnly:!0})],bi.prototype,"_weatherUpdateParameters",null),bi=mc=h([N("esri.views.3d.environment.EnvironmentRenderer")],bi);let gp=class{constructor(){this.fog=new YS,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,ae(this.fog.color,e.fog.color)}lerp(e,t,r){this.fog.amount=He(e.fog.amount,t.fog.amount,r),this.hazeAmount=He(e.hazeAmount,t.hazeAmount,r),this.fog.strength=He(e.fog.strength,t.fog.strength,r),ws(this.fog.color,e.fog.color,t.fog.color,r)}};const CR=ft(.5,.5,.5),e0=ft(1.5,1.5,1.5);let t0,is=class extends Xr.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandlesKey="viewHandles",this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new $C,this._ambientLight=new IC,this._moonLight=new NC,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(t=this._view)==null?void 0:t.state)==null?void 0:r.viewingMode)===Ne.Global&&lm(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new bi({view:e});const t=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this.addHandles([D(()=>e.environment.lighting,s=>this._updateLightingHandler(s),at),D(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),at),D(()=>e.stationary,()=>this._interactingStationaryHandler()),D(()=>e.environment.lighting.directShadowsEnabled,t,at),D(()=>e.qualitySettings.ambientOcclusion,t,at),D(()=>e.qualitySettings.reflections,t,at),D(()=>e.spatialReference,()=>this._resetReferencePosition(!0),at),D(()=>e.environment.weather.type,()=>this._updateLighting(null,vl.Faded),at),D(()=>this.weatherEnabled,()=>this._updateLighting(null,vl.Faded),at),D(()=>e.viewingMode,()=>this._resetReferencePosition(!0),yt),D(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),yt),D(()=>e.state.camera,r,yt),D(()=>this.disableQueries,r)],this._viewHandlesKey),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this.removeHandles(this._viewHandlesKey),this._resetReferencePosition(),this._renderer=re(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)!=="virtual"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!Hd(r)){const s=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(s))return void this._requestReferencePositionUpdate(s)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const s=bf(this._referencePosWGS84Comparable,i0);s!=null&&(t.autoUpdate(null,s),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const r=t.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,t){const r=lm(this._view.spatialReference);if(r&&!Hd(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const s=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=b()),r?AC(s,this._referencePosWGS84Comparable):Xt(this._referencePosWGS84Comparable,s.longitude??0,s.latitude??0,s.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(t.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,t=vl.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const s=this._referencePosWGS84Comparable,a=s!=null?PR:SR,n=this.weatherVisible?r.environment.weather.type:"disabled";s!=null?Y3(e,s,r.state.viewingMode,n,r.state.camera,a):r.environment.lighting.type==="virtual"&&K3(r.state.camera,r.state.viewingMode,a.direct.directionToLightSource);const o=this._mainLight,l=a.direct;J(o.intensity,l.color,l.intensity*Math.PI),ae(o.direction,l.directionToLightSource),o.specularStrength=a.specularStrength,o.environmentStrength=a.environmentStrength;const c=this._ambientLight;J(c.intensity,a.ambient.color,a.ambient.intensity);const d=this._moonLight;ws(d.intensity,OR,ER,a.globalFactor);const p=(1-.5*a.globalFactor)*(1-.4*a.noonFactor*(1-a.globalFactor));J(d.intensity,d.intensity,p),ae(d.direction,l.directionToLightSource),this._renderer.updateLightSources([o,c,d],a.noonFactor,a.globalFactor,t),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=RR;r.setTime((t||this._view.environment.lighting.date).getTime());const s=bf(e,i0);if(s==null)return!1;let a=this._view.environment.lighting.positionTimezoneInfo;if(a.autoUpdated){if(a.hours===s.hours&&a.minutes===s.minutes&&a.seconds===s.seconds)return!1}else a=s;const n=r.getUTCHours()-(s.hours-a.hours),o=r.getUTCMinutes()-(s.minutes-a.minutes),l=r.getUTCSeconds()-(s.seconds-a.seconds);return r.setUTCHours(n),r.setUTCMinutes(o),r.setUTCSeconds(l),!t&&this._view.environment.lighting.autoUpdate(r,s)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=this._referencePosWGS84Comparable==null||J3(this._referencePosWGS84Comparable[2],this._view.state.viewingMode);e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=Mg(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const a=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(a)}}).catch(a=>{a.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),s=this._referencePosUpdateTimer=Mg(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===s&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[t[0],t[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};h([u({type:Boolean,readOnly:!0})],is.prototype,"updating",null),h([u()],is.prototype,"disableQueries",void 0),h([u()],is.prototype,"_disableWeather",void 0),h([u()],is.prototype,"weatherEnabled",null),h([u()],is.prototype,"weatherVisible",null),h([u()],is.prototype,"referencePositionWGS84Comparable",null),h([u()],is.prototype,"_renderer",void 0),h([u()],is.prototype,"_referencePosWGS84Comparable",void 0),is=h([N("esri.views.3d.environment.SceneViewEnvironmentManager")],is);const PR=new Av,SR=new Av,RR=new Date,i0={hours:0,minutes:0,seconds:0},OR=ft(.22,.22,.33),ER=ft(.22,.22,.22);var ht;(function(i){i[i.NONE=0]="NONE",i[i.TILT=1]="TILT",i[i.ALTITUDE=2]="ALTITUDE",i[i.DISTANCE=4]="DISTANCE",i[i.COLLISION=8]="COLLISION",i[i.ALL=15]="ALL",i[i.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(ht||(ht={}));var Se;(function(i){i[i.NONE=0]="NONE",i[i.ZOOM=1]="ZOOM",i[i.TUMBLE=2]="TUMBLE",i[i.LOOK_AROUND=3]="LOOK_AROUND",i[i.PAN=4]="PAN",i[i.ASCEND=5]="ASCEND"})(Se||(Se={}));var hi;(function(i){i[i.TUMBLE=0]="TUMBLE",i[i.LOOK_AROUND=1]="LOOK_AROUND"})(hi||(hi={}));function ih(i,e){return(i&e)!=0}function cu(i,e,t,r,s,a){i!==0&&(t?(a.min=Math.min(a.min,e),a.max=Math.max(a.max,e)):r!=null?(a.min-=Math.max(0,(e-a.min)*(1-r)),a.max+=Math.max(0,(e-a.max)*(1-r))):s&&(a.min-=Math.max(0,e-a.min-s),a.max+=Math.max(0,e-a.max-s)))}const Cn={selection:ht.NONE,interactionType:Se.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:hi.TUMBLE};function db(i,e,t,r){return e=e||i.viewForward,ae(r,e),J(r,r,Math.sign(Ie(e,t))),r}function AR(i,e,t=Cn){const r=V_(i,e,t);if(r===0)return!1;const s=i.renderCoordsHelper,a=s.getAltitude(e.eye)+r,n=db(e,t.interactionDirection,LR(i,e,Math.sign(r),FR),NR),o=ae(VR,e.viewForward),l=s.intersectInfiniteManifold(uo(e.eye,n),a,fp);return e.eye=l??s.setAltitude(fp,a,e.eye),e.center=lT(fp,e.eye,o,e.center),!0}function V_(i,e,t=Cn){if(!MR(i,t)||!i.state.constraints.altitude)return 0;const r=$R(i.state.constraints.altitude,IR);DR(i,t,r);const s=i.renderCoordsHelper.getAltitude(e.eye),a=K(s,r.min,r.max)-s;return Math.abs(a)<=1e-6?0:a}function MR(i,e){const t=i.state.constraints.altitude;return!(!i.state.isGlobal||!t)&&(e.interactionType!==Se.TUMBLE||!ih(e.selection,ht.TILT))}function DR(i,e,t){const r=e.interactionType;if(r===Se.NONE)return;const{min:s,max:a}=t,{interactionStartCamera:n,interactionFactor:o}=e;if(!n)return;const l=r===Se.TUMBLE||r===Se.ZOOM,c=V_(i,n),d=c===0?0:i.renderCoordsHelper.getAltitude(n.eye);t.min=s,t.max=a,cu(c,d,l,o,.05*d,t)}function LR(i,e,t,r){return i.renderCoordsHelper.worldUpAtPosition(e.eye,r),J(r,r,t),r}function $R(i,e){return e.min=i.min,e.max=i.max,e}const IR={min:0,max:0},NR=b(),FR=b(),VR=b(),fp=b();function U_(i,e,t=Cn){if(!i.state.isLocal)return 0;const r=i.state.constraints.distance;if(!i.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;Mh.min=0,Mh.max=r,zR(i,t,Mh);const s=z_(i,e),a=Mh.max-s;return a>=-1e-6?0:a}function UR(i,e,t=Cn){const r=U_(i,e,t);if(r===0)return!1;const s=i.pointsOfInterest.surfaceOrigin;if(!s.renderLocation)return!1;const a=z_(i,e)+r,n=ae(BR,e.eye),o=db(e,t.interactionDirection,qR(e,s.renderLocation,GR),kR);if(!Pu(Bx(s.renderLocation,a),uo(e.eye,o),Dh))return!1;e.eye=Dh;const l=pe(HR,e.eye,n);e.center=me(Dh,e.center,l);const c=i.renderCoordsHelper.getAltitude(e.center),d=i.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,Dh);return d!=null&&(e.center=d),!0}function zR(i,e,t){const r=e.interactionType;if(r===Se.NONE)return;const{min:s,max:a}=t,{interactionStartCamera:n,interactionFactor:o}=e;if(!n)return;const l=r===Se.ZOOM||r===Se.PAN,c=U_(i,n),d=c===0?0:z_(i,n);t.min=s,t.max=a,cu(c,d,l,o,.05*d,t)}function z_(i,e){const t=i.pointsOfInterest.surfaceOrigin;return t.renderLocation?sr(e.eye,t.renderLocation):0}function qR(i,e,t){return Su(t,i.eye,e)}const Mh={min:0,max:0},BR=b(),HR=b(),kR=b(),GR=b(),Dh=b();function Fl(i,e,t=kr.EYE){const r=i.state.constraints;if(!r.collision.enabled)return!1;const s=T_(i,e.eye),a=i.renderCoordsHelper.getAltitude(e.eye),n=s+r.collision.elevationMargin;if(a>=n)return!1;const o=ve(e.eye);if(pe(Lh,e.center,e.eye),e.eye=i.renderCoordsHelper.setAltitude(jR,n,e.eye),t===kr.EYE_AND_CENTER)e.center=me(Lh,e.eye,Lh);else if(t===kr.EYE_AND_CENTER_SCALE){const l=(o-a+n)/o;e.center=J(Lh,e.center,l)}return!0}var kr;(function(i){i[i.EYE=0]="EYE",i[i.EYE_AND_CENTER=1]="EYE_AND_CENTER",i[i.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(kr||(kr={}));const Lh=b(),jR=b();function Pn(i,e,t){i.worldUpAtPosition(e,r0),pe(yp,t,e);const r=ve(yp);return r===0?0:ea(Ie(yp,r0)/r)}const r0=b(),yp=b();function ub(i,e,t=Cn,r=!0){jl.eyeCenterDistance=0,jl.requiresTwoSteps=!1;const s=q_(i,e,t,void 0,jl);if(s===0)return!1;switch(po($h,-s,e.viewRight),t.tiltMode){case hi.LOOK_AROUND:Zt(Ga,e.viewForward,$h),J(Ga,Ga,jl.eyeCenterDistance),e.center=me(an,e.eye,Ga);break;case hi.TUMBLE:pe(Ga,e.center,e.eye),Zt(Ga,Ga,$h),e.eye=pe(an,e.center,Ga);break;default:fn(t.tiltMode)}return e.up=Zt(an,e.up,$h),!jl.requiresTwoSteps||!r||ub(i,e,t,!1)}function q_(i,e,t=Cn,r=Cn,s){if(!i.state.constraints.tilt)return 0;const a=e.distance,n=i.state.constraints.tilt(a,i5);return t5(i,t,n),r.interactionType===Se.TUMBLE&&ih(r.selection,ht.ALTITUDE)&&pb(i,r.interactionStartCamera,n),t.tiltMode===hi.LOOK_AROUND||r.tiltMode===hi.LOOK_AROUND?QR(i,e,n,s):WR(i,e,n)}function WR(i,e,t){const r=Pn(i.renderCoordsHelper,e.center,e.eye),s=r-K(r,t.min,t.max);return rh(s)?s:0}function QR(i,e,t,r){switch(r&&(r.requiresTwoSteps=!1),i.viewingMode){case"global":return XR(i,e,t,r);case"local":return ZR(i,e,t,r)}}function ZR(i,e,t,r){const s=Pn(i.renderCoordsHelper,e.center,e.eye),a=K(s,t.min,t.max),n=s-a;if(!rh(n))return 0;if(r){const o=i.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=i.renderCoordsHelper.getAltitude(e.eye)-o,c=Math.cos(a);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return n}function XR(i,e,t,r){const s=YR(i,e,r5),a=K(s.tiltAtCenter,t.min,t.max);if(!rh(s.tiltAtCenter-a))return 0;let n,o;return s.centerIsOnSurface?(n=KR(s),o=JR(s,n)):(n=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&n<Math.PI/2&&(r.requiresTwoSteps=!0,n=Math.PI/2-1e-5),o=e5(s,n)),r&&(r.eyeCenterDistance=Fm(s,n)),o}function YR(i,e,t){const r=i.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+Tt(i.spatialReference).radius,a=i.renderCoordsHelper.intersectManifold(e.ray,r,an);return t.eyeCenterDistance=e.distance,t.centerIsOnSurface=!1,a!=null?(t.eyeCenterDistance=sr(e.eye,a),t.tiltAtCenter=Pn(i.renderCoordsHelper,a,e.eye),t.centerIsOnSurface=!0):i.state.isLocal?t.tiltAtCenter=Pn(i.renderCoordsHelper,e.center,e.eye):(Ru(u_(p_,s),e.ray,an),t.eyeCenterDistance=sr(e.eye,an),t.tiltAtCenter=ea(-Ie(e.viewForward,ye(an,an)))),t.radius=s,t.eyeRadius=ve(e.eye),t.constraints=i.state.constraints,t}function rh(i){return Math.abs(i)>1e-9}function KR(i){const{constraints:e,eyeCenterDistance:t,tiltAtCenter:r}=i;let s=r,a=e.clampTilt(t,r);const n=Fm(i,a);if(e.clampTilt(n,r)===a)return a;let o=0;for(;o<10&&rh(a-s);){const l=(s+a)/2,c=Fm(i,l);rh(e.clampTilt(c,l)-l)?s=l:a=l,o++}return a}function Fm(i,e){if(!i.centerIsOnSurface)return i.eyeCenterDistance;const t=Math.PI-K(e,0,Math.PI),r=kc(i.radius/i.eyeRadius*Math.sin(t)),s=Math.PI-t-r,a=Math.sin(s)/Math.sin(t);if(i.eyeRadius<i.radius&&a>1){const n=Math.PI-r,o=Math.PI-t-n;return Math.sin(o)/Math.sin(t)*i.eyeRadius}return a*i.eyeRadius}function JR(i,e){const t=kc(i.radius/i.eyeRadius*Math.sin(i.tiltAtCenter)),r=kc(i.radius/i.eyeRadius*Math.sin(e));return i.eyeRadius>i.radius?t-r:r-t}function e5(i,e){return i.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function t5(i,e,t){if(e.interactionType===Se.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=e;if(!r)return;const{min:a,max:n}=t,o=q_(i,r,Cn,e),l=o===0?0:Pn(i.renderCoordsHelper,r.center,r.eye);t.min=a,t.max=n,e.interactionType===Se.TUMBLE?(ih(e.selection,ht.ALTITUDE)&&pb(i,r,t),cu(o,l,!0,s,s0,t)):cu(o,l,!1,s,s0,t)}function pb(i,e,t){const r=i.state.constraints;if(i.state.isLocal||!r.altitude||!e)return;const s=gs(e.center),a=Math.sqrt(s),n=e.distance,o=Tt(i.spatialReference).radius,l=r.altitude.min+o,c=r.altitude.max+o,d=(l*l-n*n-s)/(-2*a*n),p=(c*c-n*n-s)/(-2*a*n);t.min=Math.max(t.min,Math.min(Math.PI-ea(p),t.max)),t.max=Math.min(t.max,Math.PI-ea(d))}const Ga=b(),$h=nt(),an=b(),s0=Ht(5),i5={min:0,max:0},r5={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},jl={eyeCenterDistance:0,requiresTwoSteps:!1},s5=i=>i,Vu=i=>i*i,B_=i=>1-Vu(1-i),a5=i=>i<.5?Vu(2*i)/2:(B_(2*(i-.5))+1)/2,H_=i=>i*i*i,mb=i=>1-H_(1-i),_b=i=>i<.5?H_(2*i)/2:(mb(2*(i-.5))+1)/2,k_=i=>i*i*i*i,gb=i=>1-k_(1-i),n5=i=>i<.5?k_(2*i)/2:(gb(2*(i-.5))+1)/2,G_=i=>i*i*i*i*i,fb=i=>1-G_(1-i),o5=i=>i<.5?G_(2*i)/2:(fb(2*(i-.5))+1)/2,j_=i=>1-Math.cos(i*Math.PI/2),yb=i=>1-j_(1-i),l5=i=>i<.5?j_(2*i)/2:(yb(2*(i-.5))+1)/2,W_=i=>2**(10*(i-1)),fh=i=>1-W_(1-i),c5=i=>i<.5?W_(2*i)/2:(fh(2*(i-.5))+1)/2,Q_=i=>-(Math.sqrt(1-i*i)-1),vb=i=>1-Q_(1-i),h5=i=>i<.5?Q_(2*i)/2:(vb(2*(i-.5))+1)/2;function Kr(i){const e=2*(i-Math.sqrt((i-1)*i)),t=e/2/i;return r=>r<t?i*r*r:e*r-e+1}function Jr(i,e){return(t,r)=>t<e?e*i(t/e,r):1-i((1-t)/(1-e),r)*(1-e)}const d5=Jr(Kr(1),1),u5=Jr(Kr(1),0),bb=Jr(Kr(1),.5),p5=Jr(Kr(2),1),m5=Jr(Kr(2),0),_5=Jr(Kr(2),.5),g5=Jr(Kr(3),1),f5=Jr(Kr(3),0),y5=Jr(Kr(3),.5),v5=Jr(Kr(4),1),b5=Jr(Kr(4),0),w5=Jr(Kr(4),.5),x5={linear:s5,"in-quad":Vu,"out-quad":B_,"in-out-quad":a5,"in-coast-quad":d5,"out-coast-quad":u5,"in-out-coast-quad":bb,"in-cubic":H_,"out-cubic":mb,"in-out-cubic":_b,"in-coast-cubic":p5,"out-coast-cubic":m5,"in-out-coast-cubic":_5,"in-quart":k_,"out-quart":gb,"in-out-quart":n5,"in-coast-quart":g5,"out-coast-quart":f5,"in-out-coast-quart":y5,"in-quint":G_,"out-quint":fb,"in-out-quint":o5,"in-coast-quint":v5,"out-coast-quint":b5,"in-out-coast-quint":w5,"in-sine":j_,"out-sine":yb,"in-out-sine":l5,"in-expo":W_,"out-expo":fh,"in-out-expo":c5,"in-circ":Q_,"out-circ":vb,"in-out-circ":h5};function Ut(i,e,t=S5,r=e){r!==e&&r.copyFrom(e),r.computeUp(i.state.viewingMode);let s=!1;for(let o=0;o<R5;o++){let l=0;for(const c of P5)if(ih(t.selection,c.type)){const d=Math.abs(c.error(i,r,t));c.apply(i,r,t)&&(s=!0,l+=d)}if(l===0)break}const a=ih(t.selection,ht.COLLISION),n=T5(t.interactionType,i);return a&&Fl(i,r,n)&&(s=!0),s&&r.computeUp(i.state.viewingMode),s}function T5(i,e){switch(i){case Se.PAN:return kr.EYE_AND_CENTER;case Se.ASCEND:return e.state.isGlobal?kr.EYE_AND_CENTER_SCALE:kr.EYE_AND_CENTER;default:return kr.EYE}}function _s(i){const e=Math.min(1,i/150);return _b(e)}function C5(i,e,t){return q_(i,e,t)*e.distance}const P5=[{type:ht.TILT,error:C5,apply:ub},{type:ht.ALTITUDE,error:V_,apply:AR},{type:ht.DISTANCE,error:U_,apply:UR}],S5={selection:ht.ALL,interactionType:Se.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:hi.TUMBLE},R5=5,vr=b(),cr=b(),ja=b(),Ei=b(),Dn=b(),O5=b(),br={upward:ft(0,0,1),forward:ft(0,1,0),sideway:ft(1,0,0)},a0=Ua();let n0=class{constructor(e=Ne.Global){this.viewingMode=e,this.center=b(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=vn(br.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,t){if(t||(t={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ne.Global){const a=(ve(this.center)+ve(e.center))/2;t.pan=Yu(this.center,e.center)*a}else t.pan=sr(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(e.pitch-this.pitch);return t.rotate=Math.max(r,s),t.sourceZoom=this.distance,t.targetZoom=e.distance,t}interpolate(e,t,r){this.viewingMode===Ne.Global?Hx(e.center,t.center,r.pan,this.center):ws(this.center,e.center,t.center,r.pan),this.distance=isFinite(t.distance)?He(e.distance,t.distance,r.zoom):e.distance,this.pitch=He(e.pitch,t.pitch,r.rotate);let s=e.yaw;const a=t.yaw;Math.abs(a-s)>=Math.PI&&(s+=2*(s<a?1:-1)*Math.PI),this.yaw=He(s,a,r.rotate)}copyFrom(e){ae(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,ae(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const t=this._lookAtOrientation(e.center,a0);ae(this.center,e.center),pe(Ei,e.center,e.eye),cn(Ei,Ei,t),cn(Dn,e.up,t),this.distance=ve(Ei),this.distance!==0&&(Ei[0]/=this.distance,Ei[1]/=this.distance,Ei[2]/=this.distance),this.pitch=this._eyeUpToPitch(Ei),this.yaw=this._eyeUpToYaw(Ei,Dn),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const t=this._lookAtOrientation(this.center,a0);Ll(t,t),this._axisAngleVec3(br.sideway,this.pitch-Math.PI/2,br.forward,Ei),this._axisAngleVec3(br.upward,this.yaw,Ei),this._axisAngleVec3(br.sideway,this.pitch-Math.PI/2,br.upward,Dn),this._axisAngleVec3(br.upward,this.yaw,Dn),J(Ei,Ei,this.distance),cn(Ei,Ei,t),cn(Dn,Dn,t),e.center=this.center,e.eye=pe(Ei,this.center,Ei),e.up=Dn}_axisAngleVec3(e,t,r,s=r){const a=Math.cos(t),n=Math.sin(t);return J(vr,r,a),Wt(cr,e,r),J(cr,cr,n),J(ja,e,(1-a)*Ie(e,r)),me(s,me(s,vr,cr),ja)}_lookAtOrientation(e,t=Ua()){return this._upAtLookAt(e,ja),Wt(vr,this.lookAtDirection,ja),ye(vr,vr),vr[0]===0&&vr[1]===0&&vr[2]===0&&ae(vr,br.sideway),Wt(cr,ja,vr),ye(cr,cr),t[0]=vr[0],t[1]=cr[0],t[2]=ja[0],t[3]=vr[1],t[4]=cr[1],t[5]=ja[1],t[6]=vr[2],t[7]=cr[2],t[8]=ja[2],t}_upAtLookAt(e,t){return this.viewingMode===Ne.Local?ae(t,br.upward):ye(t,e)}_eyeUpToPitch(e){return Math.PI-Yu(br.upward,e)}_eyeUpToYaw(e,t){const r=O5;return Math.abs(t[2])<.5?(ae(r,t),e[2]>0&&J(r,r,-1)):ae(r,e),Wt(cr,r,br.upward),ye(cr,cr),Yu(br.sideway,cr,br.upward)}};const hu={desiredScreenFlow:2,minDuration:Oe(500),maxDuration:Oe(8e3)};let E5=class wb{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:hu.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new wb(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,t,r){this.source!==e&&this.source.copyFrom(e),this.target!==t&&this.target.copyFrom(t),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:hu.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const t=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/t}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},A5=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,t)=>ds(e+t.time),ds(0))}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,s=0;const a=this.definition;for(let n=0;n<this.segments.length;n++){const o=this.segments[n],l=o.definition;if(e<=o.time||n===this.segments.length-1){if(t=this.segmentInterpolateComponentsAt(o,o.time===0?0:e/o.time,t),a.hasPan&&!isNaN(t.pan)&&isFinite(a.compared.pan)?t.pan=(r+l.compared.pan*t.pan)/a.compared.pan:t.pan=1,a.hasRotate&&!isNaN(t.rotate)&&isFinite(a.compared.rotate)?t.rotate=(s+l.compared.rotate*t.rotate)/a.compared.rotate:t.rotate=1,a.hasZoom&&!isNaN(t.zoom)&&isFinite(l.compared.targetZoom)){const c=t.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;t.zoom=(c-d)/(p-d)}else t.zoom=1;return t}e-=o.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(e,t,r){return e.interpolateComponentsAt(t,r)}},vp=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,t=e.compared,r=t.sourceZoom,s=t.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=t.pan*e.source.pixelsPerPanAtZoom(r);const a=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=t.rotate*a}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,t=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:a}=this.definition;let n=0,o=0;r&&(s&&(n=(t/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),a&&(o=this._zoomSign*(Math.log(e/t)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&a){const c=n+o+n*o;this._zoomPixelFlow=n*o/c*l,this._panPixelFlow=o/c*l,this._rotatePixelFlow=n/c*l}else if(r&&s){const c=1+n;this._zoomPixelFlow=n/c*l,this._panPixelFlow=1/c*l}else if(r&&a){const c=1+o;this._zoomPixelFlow=o/c*l,this._rotatePixelFlow=1/c*l}else if(s&&a){const c=this._panPixelsAtSource/this._rotatePixels,d=1+c;this._panPixelFlow=c/d*l,this._rotatePixelFlow=1/d*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:a&&(this._rotatePixelFlow=l);this._time=a?this.rotateTime:r?this.zoomTime:s?this.panTime:ds(0)}get rotateTime(){return this.definition.hasRotate?ds(this._rotatePixels/this._rotatePixelFlow):ds(0)}get zoomTime(){return this.definition.hasZoom?ds(this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow):ds(0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,t=e*this._panPixelsAtSource;return ds(Math.log(t*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow))}return ds(this._panPixelsAtSource/this._panPixelFlow)}return ds(0)}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const t=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(t*(t/r)**-e-t)/(r-t)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(t*e*this._time)-1))/(t*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,t){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),s=this._interpolateComponentsPan(e),a=this._interpolateComponentsRotate(e);return t?(t.zoom=r,t.pan=s,t.rotate=a):t={zoom:r,pan:s,rotate:a},t}};function M5(i,e,t){const r=e-i.compared.sourceZoom,s=i.halfWindowPanAtZoom(r);return-i.halfWindowSize*(t.ascensionFactor*Math.LN2*i.compared.pan+s)*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2*s)}function D5(i,e,t){const r=1/e,s=Math.log(i.compared.sourceZoom*r),a=1/i.desiredPixelFlow,n=1/Math.LN2,o=e-i.compared.sourceZoom,l=1/o,c=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(o))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*r*a*n*l*c-i.halfWindowSize*s*a*n*l+i.halfWindowSize*s*a*n*c/(o*o)}function L5(i,e,t){const r=e-i.compared.sourceZoom,s=1/r,a=1/e,n=Math.log(i.compared.sourceZoom*a),o=(t.ascensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(r))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*s*(-2*s*a*o+2*s*n+2*a-2*n*o/(r*r)-o/(e*e))/(i.desiredPixelFlow*Math.LN2)}function $5(i,e){return-i.halfWindowSize*Math.log(i.compared.sourceZoom/e)/(i.desiredPixelFlow*Math.LN2)}function I5(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function N5(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function F5(i,e,t){return-i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e))}function V5(i,e,t){return i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e))}function U5(i,e,t){return-2*i.compared.pan*i.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(i.desiredPixelFlow*i.halfWindowPanAtZoom(e*e*e))}function z5(i,e,t){return i.halfWindowSize*(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*i.halfWindowPanAtZoom(-e+i.compared.targetZoom))}function q5(i,e,t){const r=Math.log(e/i.compared.targetZoom),s=1/i.desiredPixelFlow,a=1/Math.LN2,n=-e+i.compared.targetZoom,o=1/n,l=(-i.halfWindowPanAtZoom(e)-t.descensionFactor*Math.LN2*i.compared.pan+i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return-i.halfWindowSize*r*s*a*o+i.halfWindowSize*r*s*a*l/(n*n)+i.halfWindowSize*s*a*o*l/e}function B5(i,e,t){const r=e-i.compared.targetZoom,s=1/r,a=1/e,n=Math.log(e/i.compared.targetZoom),o=(i.halfWindowPanAtZoom(e)+t.descensionFactor*Math.LN2*i.compared.pan-i.halfWindowPanAtZoom(i.compared.targetZoom))/i.halfWindowPanAtZoom(1);return i.halfWindowSize*s*(-2*s*a*o-2*s*n+2*a+2*n*o/(r*r)-o/(e*e))/(i.desiredPixelFlow*Math.LN2)}function H5(i,e){return i.halfWindowSize*Math.log(e/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2)}function k5(i,e){return i.halfWindowSize/(e*i.desiredPixelFlow*Math.LN2)}function G5(i,e){return-i.halfWindowSize/(e*e*i.desiredPixelFlow*Math.LN2)}function j5(i){const e=Math.LN2*i.compared.pan,t=i.compared.sourceZoom-i.compared.targetZoom,r=i.halfWindowPanAtZoom(t),s=i.halfWindowSize*Math.log(i.compared.sourceZoom/i.compared.targetZoom)/(i.desiredPixelFlow*Math.LN2*r);return i.compared.sourceZoom<=i.compared.targetZoom?s*(e-r):s*(e+r)}function W5(i,e){let t=Q5(i,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},s=r.ascensionFactor===0,a=r.descensionFactor===0,n=s?$5:M5,o=s?I5:D5,l=s?N5:L5,c=a?H5:z5,d=a?k5:q5,p=a?G5:B5,m=C=>n(i,C,r)+F5(i,C,r)+c(i,C,r),g=C=>o(i,C,r)+V5(i,C,r)+d(i,C,r),f=C=>l(i,C,r)+U5(i,C,r)+p(i,C,r);let y=m(t);const v=j5(i);let T;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(T=0;T<w;T++){const P=(g(t)+1e-6)/f(t);if(isNaN(P)||t>=x&&P<0){if(!isFinite(x))return null;t=x,y=m(t);break}if(t-=P,t<i.compared.sourceZoom||t<i.compared.targetZoom)return null;const R=m(t);if(Math.abs(R-y)/y<=.005)break;y=R}return y>v*(1-.3)||t<i.compared.sourceZoom||t<i.compared.targetZoom?null:t}function Q5(i,e){const t=Math.max(i.compared.sourceZoom,i.compared.targetZoom),r=i.source.zoomAtPixelsPerPan(i.desiredPixelFlow/i.compared.pan)/2;return r<t?e.maximumDistance!=null?t+(e.maximumDistance-t)/2:1.5*t:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Z5=class extends A5{constructor(e,t){super(),this._preallocSegments=[new vp,new vp,new vp],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,t)}update(e,t){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;t!=null&&t.apex&&(r=W5(e,t.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,t==null?void 0:t.apex)}segmentInterpolateComponentsAt(e,t,r){return r=e.interpolateComponentsAt(t,r),e===this._ascensionSegment?r.zoom=B_(r.zoom):e===this._descensionSegment&&(r.zoom=Vu(r.zoom)),r}_updateWithApex(e,t){const[r,s,a]=this._preallocSegments,n=(t==null?void 0:t.ascensionFactor)??.5,o=Math.min(1-n,(t==null?void 0:t.ascensionFactor)!=null&&t.descensionFactor!=null?t.descensionFactor:.5),l=1-n-o;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*n,r.definition.compared.rotate=this.definition.compared.rotate*n,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=e,s.definition.compared.targetZoom=e,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),a.definition?a.definition.copyFrom(this.definition):a.definition=this.definition.clone(),a.definition.compared.sourceZoom=e,a.definition.compared.pan=this.definition.compared.pan*o,a.definition.compared.rotate=this.definition.compared.rotate*o,a.update(),this._descensionSegment=a,this.segments.push(a)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const X5={zoom:0,pan:0,rotate:0};let Y5=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=Oe(0),this.definition=new E5(e),this.path=new Z5}update(e,t,r){this.definition.update(e,t,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(vy(isFinite(this.path.time)?this.path.time:ds(0)),r),this._easing=r.easing??(this._time>=1e3?bb:fh)}cameraAt(e,t){t=t||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,X5);return t.interpolate(this.definition.source,this.definition.target,r),t}_normalizedEasing(e){const t=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-t)/(r-t)}_applyTimeSettings(e,t){const r=t.speedFactor!=null?t.speedFactor:1;t.duration!=null?e=t.duration:t.speedFactor!=null&&(e=Oe(e/r));const s=t.minDuration!=null?t.minDuration:hu.minDuration/r,a=t.maxDuration!=null?t.maxDuration:hu.maxDuration/r;return Oe(Math.min(Math.max(s,e),a))}};const K5=b();let J5=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=Oe(0),this._animation=new Y5(()=>new n0(e)),this._current=new n0(e)}update(e,t,r){const s=this._animation.definition.source,a=this._animation.definition.target,n=pe(K5,t.center,e.center),o=ve(n);o>=1e-5?(n[0]/=o,n[1]/=o,n[2]/=o):(n[0]=0,n[1]=1,n[0]=0),ae(s.lookAtDirection,n),ae(a.lookAtDirection,n),s.copyFromRenderCamera(e),a.copyFromRenderCamera(t),this._current.copyFrom(s),this._animation.update(s,a,r),this.currentTime=Oe(0),e.almostEquals(t)&&(this.currentTime=this._animation.time)}cameraAt(e,t){return this._animation.cameraAt(e,this._current),t=t||new gt,this._current.copyToRenderCamera(t),t}step(e,t){return this.finished||(this.currentTime=Oe(this.currentTime+vy(e)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,t)}};var wt;(function(i){i.Ready="ready",i.Rejected="rejected",i.Running="running",i.Stopped="stopped",i.Finished="finished"})(wt||(wt={}));let Ta=class extends ue{constructor(e){super(e),this.state=wt.Ready}get active(){return this.state===wt.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=wt.Stopped,!0)}finishController(){this.state=wt.Finished}get steppingFinished(){return!1}};h([u({constructOnly:!0})],Ta.prototype,"view",void 0),h([u({readOnly:!0})],Ta.prototype,"active",null),h([u()],Ta.prototype,"state",void 0),h([u({readOnly:!0})],Ta.prototype,"isInteractive",null),Ta=h([N("esri.views.3d.state.controllers.CameraController")],Ta);let sh=class extends Ta{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(ks()),this._asyncResult=null),this.state===wt.Finished||this.state===wt.Stopped?(kx(e),this.state===wt.Finished?e.resolve():e.reject(ks())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=wt.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==wt.Ready&&this.state!==wt.Running||(this.viewAnimation.state===Ol.State.FINISHED?this.finish():this.viewAnimation.state===Ol.State.STOPPED&&(this.state=wt.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===wt.Finished?this.viewAnimation.finish():this.state===wt.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===wt.Finished?this._asyncResult.resolve():this._asyncResult.reject(ks()))}finish(){this.finishController()}};sh=h([N("esri.views.3d.state.controllers.AnimationController")],sh);let Ra=class extends sh{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new J5(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new Ol}get isInteractive(){return this.mode==="interaction"}begin(e,t){this._hasTarget=!0;const r=this.animationSettings(t);Ih.copyFrom(this.view.state.camera);const s=xs(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Ih.ray,s,o0)&&(Ih.center=o0),this.animation.update(Ih,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,t){this._hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?x5[e.easing]:e.easing}}};h([u({constructOnly:!0})],Ra.prototype,"mode",void 0),h([u({readOnly:!0})],Ra.prototype,"isInteractive",null),Ra=h([N("esri.views.3d.state.controllers.PointToPointAnimationController")],Ra);const Ih=new gt,o0=b();function Uu(i=t4){return[i[0],i[1],i[2],i[3]]}function ah(i,e){return e4(i[0],i[1],i[2],e,Gx.get())}function e4(i,e,t,r,s=Uu()){return s[0]=i,s[1]=e,s[2]=t,s[3]=r,s}function Z_(i,e,t){return Wt(t,i,e),ye(t,t),t[3]=m_(i,e),t}const t4=[0,0,1,0];function X_(i,e,t,r){const s=Nl(e,t,i4);return Pu(i,s,r)}const i4=$l();var El;(function(i){i[i.Ellipsoid=0]="Ellipsoid",i[i.Silhouette=1]="Silhouette"})(El||(El={}));const xb=30,du=[1,3e8],zu=80,Tb=8,Cb=200,Pb=1508e5,Sb=5,Rb=50,r4=5,s4=10,bp=90,Co={exclude:new Set([sn])};function lo(i,e,t){return t[0]=e[0]/(i.fullWidth/i.pixelRatio),t[1]=e[1]/(i.fullHeight/i.pixelRatio),t}function Vm(i){for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;return i}function Sn(i,e,t){const r=po(jx.get(),t[3],t);r==null||Wx(r,Sc)||(pe(Ye,i.eye,e),Zt(Ye,Ye,r),i.eye=me(Ye,Ye,e),pe(Ye,i.center,e),Zt(Ye,Ye,r),i.center=me(Ye,Ye,e),i.up=Zt(Ye,i.up,r))}function a4(i,e,t,r){return __(i,Dv(e,t,J_),r)}function Um(i,e,t,r){return __(i,Nl(e,t,J_),r)}function Y_(i,e,t,r){const s=Rt.get();let a=1-t;pe(s,e,i.eye);const n=ve(s);let o=n*(1-a);a>=0&&o<r&&(o=r,a=-(o-n)/n),Math.abs(n-o)<1e-6||(J(s,s,a),i.eye=me(Ye,i.eye,s),i.center=ws(Ye,i.center,e,a))}function Ob(i,e,t){e.getScreenCenter(l0),X_(i,e,l0,Ye)&&(e.center=Ye);const r=e.distance,s=r*t;if(Math.abs(r-s)<1e-6)return;const a=J(Rt.get(),e.viewForward,s);e.eye=pe(Ye,e.center,a)}const l0=Dt();function wp(i,e){Xt(e,0,0,0);for(const t of i)me(e,e,t);J(e,e,1/i.length)}function Cd(i,e,t,r){return Math.sin(i/ve(e))*(t+r.radius)}function c0(i,e,t,r){return Cd(Math.PI/2,e,t,r)+(i-Math.PI/2)}var oi;(function(i){i[i.Vertical=0]="Vertical",i[i.Horizontal=1]="Horizontal"})(oi||(oi={}));const h0={Elevation:3e4,Angle:Ht(16)},Nh={Pole:.95,Angle:Ht(18),Tilt:45},Eb=Ht(80);function Ab(i,e,t,r,s,a){const n=b(),o=ta();let l=!0,c=!0;return i.intersectScreen(t,n,a)?o[3]=ve(n):(c=!1,e.aboveGround&&s!==El.Ellipsoid?o[3]=Math.max(ve(e.center),.9*r.radius):o[3]=ve(e.eye)-e.relativeElevation,s===El.Silhouette?nh(o,e,t,n):l=X_(o,e,t,n)),{sphere:o,scenePickPoint:l?n:null,hasGeometryIntersection:c}}function qu(i,e,t){return ve(i.eye)-t.radius>h0.Elevation?oi.Horizontal:(Nl(i,e,y0),-Math.sign(i.relativeElevation)*(.5*Math.PI+m_(i.eye,y0.direction))<h0.Angle?oi.Vertical:oi.Horizontal)}function Mb(i,e,t){pe(xp,t,e),i.eye=pe(Ye,i.eye,xp),i.center=pe(Ye,i.center,xp)}const xp=b();function nh(i,e,t,r){const s=Nl(e,t,J_);return s!=null&&(Ru(i,s,Fh),Pu(i,s,r)?!(un(Fh,s.origin)<un(r,s.origin))||(ae(r,Fh),!1):(pe(Io,e.eye,e.center),ye(Io,Io),by(Io,-Ie(ye(Io,Io),Fh),d0),__(d0,s,r),!1))}const Fh=b(),Io=b(),d0=mo();function Db(i,e,t,r,s,a){let n=0;if(Wt(mu,i,e),pe(qh,i,e),ve(i)<=s||!r.aboveGround){Wt(t,qh,r.eye);const o=Ie(i,e)/(ve(i)*ve(e));if(o<.9999)n=ea(o);else{const c=ve(Wt(b(),i,e))/(ve(i)*ve(e));n=kc(c)}const l=Math.cos(K(xn.normalize(Ht(a)),0,Eb));n=-n-Math.max(0,ve(e)-s)/(l*s)}else pe(u0,r.eye,r.center),Wt(t,qh,u0),n=-ve(qh)/s;return ye(t,t),J(t,t,ve(mu)),n}const u0=b();function p0(i,e,t,r){let s,a;const n=Math.cos(K(xn.normalize(Ht(r)),0,Eb));return s=e>t?-(e-t)/(n*t):e<-t?Math.PI-(e+t)/(n*t):ea(e/t),a=i>t?-(i-t)/(n*t):i<-t?Math.PI-(i+t)/(n*t):ea(i/t),(a-s)*t}function n4(i,e,t,r,s,a,n,o,l,c){const d=p0(i[2],e[2],a[3],o),p=l?p0(i[0],e[0],a[3],180):e[0]-i[0],m=Math.sin(n)*p-Math.cos(n)*d,g=Math.cos(n)*p+Math.sin(n)*d;ye(Ye,s);const f=l?m/Math.sqrt(Math.abs(a[3]**2-Ie(t,Ye)**2)):m/a[3],y=g/Math.sqrt(Math.abs(a[3]**2-Ie(t,r)**2));Gr(c,f,y)}function Lb(i,e,t,r,s,a,n,o,l,c){Wt(mu,i,e),_m(a.up,a.eye,Vh,Uh,zh),_m([0,0,1],a.eye,$a,gn,Fb),ae(t,gn),ae(r,$a),ye(t,t),J(t,t,ve(mu)),Kg(i,ye(Uh,Uh),ye(zh,zh),ye(Vh,Vh),m0),Kg(e,Uh,zh,Vh,_0),n4(m0,_0,i,$a,gn,n,o,l,c,s)}function o4(i,e,t,r,s,a,n){po(uu,s,r),po(pu,n,a),jr(ol,uu,pu),pe(e,i,t),Zt(e,e,ol),me(e,e,t)}function $b(i,e,t,r,s,a){po(uu,r,t),po(pu,a,s),jr(ol,uu,pu),pe(Ye,i.eye,e),Zt(Ye,Ye,ol),i.eye=me(Ye,Ye,e),pe(Ye,i.center,e),Zt(Ye,Ye,ol),i.center=me(Ye,Ye,e),pe(Ye,i.up,e),Zt(Ye,Ye,ol),i.up=me(Ye,Ye,e)}function K_(i,e,t,r,s,a){return(Math.abs(r)>Math.PI-Nh.Angle||Math.abs(r)<Nh.Angle)&&(Math.abs(i[2])<t*Nh.Pole||Math.abs(e)>t)&&a.aboveGround&&s<Nh.Tilt}function Ib(i,e,t,r,s,a){if(a)Z_(t,r,g0),Sn(e,i,g0);else{const n=Db(t,r,f0,e,i[3],s);Sn(e,i,ah(f0,n))}}function Nb(i,e,t,r,s,a,n){const o=n?20:1,l=1e-12;let c,d;ae(Ln,r),Bh.copyFrom(e);for(let p=0;p<o&&un(t,Ln)>l&&(c=un(t,Ln),Lb(t,Ln,gn,$a,Wl,Bh,i,s,a,n),$b(Bh,i,$a,Wl[1],gn,Wl[0]),o4(Ln,Ln,i,$a,Wl[1],gn,Wl[0]),d=un(t,Ln),d<c||p===0);p++)e.copyFrom(Bh)}function l4(i,e,t,r,s,a,n){K_(t,Ie(e.up,t),i[3],-xn.normalize(Ht(s)),a,e)?Nb(i,e,t,r,-xn.normalize(Ht(s)),a,n):Ib(i,e,t,r,a,n)}function c4(i,e,t,r,s,a){const{eye:n}=i;_m([0,0,1],n,$a,gn,Fb);const o=e.translation[0]*t.pan,l=s.mode==="zoom"?0:e.translation[1]*t.pan,c=Math.max(Math.sqrt(Math.abs(1-Ie(i.center,$a)**2/ve(i.center)**2)),.5),d=(Math.sin(a)*l+Math.cos(a)*o)/c,p=-Math.cos(a)*l+Math.sin(a)*o;switch(Pa(r.pan.matrix,r.pan.matrix,d,$a),r.pan.enabled=!0,s.mode){case"pan":Pa(r.pan.matrix,r.pan.matrix,p,gn),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*t.zoom}}function h4(i,e,t,r,s){const{eye:a,viewRight:n}=i,o=Wt(Rt.get(),n,a),l=e.translation[0]*t.pan;switch(l!==0&&(Pa(r.pan.matrix,r.pan.matrix,-l,o),r.pan.enabled=!0),s.mode){case"pan":{const c=e.translation[1]*t.pan;c!==0&&(Pa(r.pan.matrix,r.pan.matrix,c,n),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*t.zoom}}function d4(i,e,t,r,s,a,n,o,l){K_(i.center,Ie(i.up,i.center),ve(i.center),-xn.normalize(Ht(a)),n,e)?c4(e,t,r,o,l,-xn.normalize(Ht(s))):h4(e,t,r,o,l)}const $a=b(),gn=b(),Fb=b(),Vh=b(),Uh=b(),zh=b(),m0=b(),_0=b(),Wl=yi(),g0=Uu(),uu=nt(),pu=nt(),ol=nt(),Ln=b(),Ye=b(),qh=b(),Bh=new gt,mu=b(),f0=b(),J_={origin:b(),direction:b()},y0={origin:b(),direction:b()},v0=.6,Tp=4,u4=60;let _u=class extends Ra{constructor(){super(...arguments),this._zoomLocation=b(),this._tmpCamera=new gt,this._tmpViewDir=b(),this._tmpRayDir={origin:b(),direction:b()},this._targetOnSphere=b(),this._tmpCenter=b(),this._constraintOptions={selection:ht.ALL_EXCEPT_COLLISION,interactionType:Se.ZOOM,interactionFactor:null,interactionStartCamera:new gt,interactionDirection:null,tiltMode:hi.TUMBLE},this._sphere=ta()}initialize(){this._intersector=xs(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s));let a=!1,n=!1;this.intersectionHelper.intersectScreen(t,this._zoomLocation,this.view.map.ground.opacity===0?Co:{})&&(a=e>0,n=!0),this._tmpCamera.copyFrom(r.camera),a?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ae(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,t,n),this.begin(this._tmpCamera)}animationSettings(){return{duration:Oe(600),easing:fh}}_updateCamera(e,t,r,s,a){const n=Tt(this.view.spatialReference),o=qu(e,s,n),l=Math.abs(this.view.camera.position.z);ye(kh,e.eye),J(kh,kh,-1),Nl(e,s,this._tmpRayDir),ye(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=K(Math.min(Tb,1/Math.abs(Ie(kh,this._tmpRayDir.direction)))*l,Cb,Pb);if(o===oi.Horizontal){let d=v0**t;this._sphere[3]=ve(r),pe(this._tmpViewDir,e.center,e.eye);const p=Math.min(ve(this._tmpViewDir),c);let m=p*d;if(d<=1&&m<Tp&&(m=Tp,d=m/p),Math.abs(p-m)<1e-6)return;const g=ve(e.center);if(this._sphere[3]!==g){const f=this._sphere[3]+d*(g-this._sphere[3]);e.center=J(Hh,e.center,f/g)}J(this._tmpViewDir,this._tmpViewDir,-d),e.eye=me(Hh,e.center,this._tmpViewDir),Ut(this.view,e,this._constraintOptions),un(r,e.center)>1e-12&&X_(this._sphere,e,s,this._targetOnSphere)&&l4(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let d=v0**Math.abs(t);const p=t>0?1:-1;pe(this._tmpViewDir,r,e.eye);const m=ve(this._tmpViewDir),g=this.view._stage.renderView.getMinimalDepthForArea(null,s[0],s[1],this.view.state.camera,u4);let f=g??c;f=a&&t>0?Math.min(f,m):f,J(this._tmpRayDir.direction,this._tmpRayDir.direction,f),me(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=f*d;const v=Math.max(Tp,1.01*e.nearFar[0]);if(t>0&&y<v&&(y=v,d=y/f),Math.abs(f-y)<1e-6)return;J(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-d)),e.eye=me(Hh,e.eye,this._tmpRayDir.direction),e.center=me(Hh,e.center,this._tmpRayDir.direction)}Fl(this.view,e)}};_u=h([N("esri.views.3d.state.controllers.global.ZoomStepController")],_u);const Hh=b(),kh=b();let Pd,Sd=null;const bl=new Map;async function EL(i){Sd==null&&(Pd==null&&(Pd=ie(()=>import("./VoxelWasmPerSceneView-c394e277.js"),["assets/VoxelWasmPerSceneView-c394e277.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/coordinateSystem-38339d17.js","assets/boundedPlane-1da2f094.js","assets/frustum-f9d53cdf.js","assets/ViewingMode-5d7d590b.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/Intersector-fa865806.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/Intersector-2e1d9db3.js","assets/Intersector-a291e778.js","assets/RenderCoordsHelper-8f237859.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/projectVectorToPoint-fbaf5599.js","assets/projectVectorToVector-56c29b20.js","assets/ElevationProvider-abb53936.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/vec2f32-eaf29605.js","assets/NestedMap-1b5db22e.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/symbolColorUtils-3ca646c8.js","assets/RenderState-1d6218ee.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/floatRGBA-ca990bbb.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/ColorMaterial-bdf1f62a.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/fontUtils-56b88a2f.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"])),Sd=await Pd);const e=i.view;let t=bl.get(e);return t||(t=new Sd.default({view:e}),bl.set(e,t)),t.addVoxelLayer(i)}function oh(i){return bl.get(i)}function AL(i){const e=i.view,t=bl.get(e);t&&t.removeVoxelLayer(i)<1&&(bl.delete(e),bl.size===0&&(Pd=null,Sd=null))}const p4=.6,m4=4,_4=60;let gu=class extends Ra{constructor(){super(...arguments),this._zoomLocation=b(),this._tmpCamera=new gt,this._tmpRayDir=b(),this._tmpCenter=b(),this._constraintOptions={selection:ht.ALL,interactionType:Se.ZOOM,interactionFactor:null,interactionStartCamera:new gt,interactionDirection:null,tiltMode:hi.TUMBLE}}zoomStep(e,t){if(!this.active)return;const r=this.view.state,{interactionStartCamera:s}=this._constraintOptions;s&&(this.animation.finished?s.copyFrom(r.camera):this.animation.cameraAt(1,s)),this._tmpCamera.copyFrom(r.camera);const a=xs(this.view.state.viewingMode);let n=!1;e>0?(n=this.intersectionHelper.intersectScreenFreePointFallback(t,this._zoomLocation,this.view.map.ground.opacity===0?Co:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,a,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:ae(this._zoomLocation,this._tmpCamera.center);const o=p4**e;let l=this.view._stage.renderView.getMinimalDepthForArea(oh(this.view),t[0],t[1],this.view.state.camera,_4);pe(Gh,this._tmpCamera.eye,this._zoomLocation),ye(Gh,Gh);const c=K(Math.min(Tb,1/Math.abs(Ie(g4,Gh)))*Math.abs(this.view.camera.position.z),Cb,Pb);if(l=l??c,l){const d=b();pe(d,this._zoomLocation,this._tmpCamera.eye),(l<ve(d)||!n)&&(ye(d,d),me(this._zoomLocation,this._tmpCamera.eye,J(d,d,l)))}this._updateCamera(this._tmpCamera,o,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:Oe(600),easing:fh}}_updateCamera(e,t,r){pe(this._tmpRayDir,r,e.eye);const s=ve(this._tmpRayDir);let a=s*t;const n=t<=1,o=Math.max(m4,1.01*e.nearFar[0]);a!==0&&(n&&a<o&&(a=o,t=a/s),Math.abs(s-a)<1e-6||(J(this._tmpRayDir,this._tmpRayDir,t),e.eye=pe(b0,r,this._tmpRayDir),e.center=ws(b0,e.center,r,1-t),Ut(this.view,e,this._constraintOptions)))}};gu=h([N("esri.views.3d.state.controllers.local.ZoomStepController")],gu);const b0=b(),g4=ft(0,0,1),Gh=b();let f4=class extends Cs{constructor(e,t){super(!0),this._view=e,this.registerIncoming("double-click",t,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const t=e.data;if(DT(t,"primary")){const r=this._view.state.isGlobal?new _u({view:this._view,mode:"animation"}):new gu({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Dt(t.x,t.y)),e.stopPropagation()}}};function y4(i,e,t){return i===Ne.Global?new b4(t):new v4(e,t)}let v4=class{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=Tt(t),this._unitInMeters=wy(t,this._referenceEllipsoid.metersPerDegree)}compute(e,t,r,s,a){var x;a||(a={near:0,far:0});let n=e[2]*this._unitInMeters;const o=n,l=n-s,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(n=l>=0?o-this._unitInMeters*c.min:this._unitInMeters*c.max-o);const d={x:(r=r??new Us({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(d.x,d.y,d.z);pe($n,t,e),No[0]=$n[0]>0?r.xmax:r.xmin,No[1]=$n[1]>0?r.ymax:r.ymin,No[2]=$n[2]>0?p/2:-p/2,pe(No,No,e),ye($n,$n);const m=1.1*Ie(No,$n)*this._unitInMeters,g=Math.sqrt(n*(n+2*this._referenceEllipsoid.radius)),f=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),y=f*T4*this._unitInMeters,v=f*C4*this._unitInMeters,T=K((n-v)/(y-v),0,1)**3,w=Math.min(He(g,m,T),g)*Math.max(Math.log(Math.abs(l)),1);return Vb(Math.min(w,Math.max(34064e4,p))/this._unitInMeters,w4,this._unitInMeters,a)}},b4=class{constructor(e){this._referenceEllipsoid=Tt(e)}compute(e,t,r,s,a){a||(a={near:0,far:0});const n=ve(e),o=n-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,s),c=Math.abs(o-s),d=Math.max(c,Math.abs(o)),p=Math.sqrt(d*(d+2*l)),m=n+this._referenceEllipsoid.radius;return Vb(1.2*He(p,m,I_(d)),K(2e4-(Math.log(d)-7.983)/9.011*19e3,1e3,2e4),1,a)}};function Vb(i,e,t,r){const s=x4/t;return i/e>s?(r.far=i,r.near=r.far/e):(r.near=s,r.far=r.near*e),r}const w4=2e4,x4=2,T4=.001,C4=1e-4,No=b(),$n=b();let Rd=class extends ue{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;e.spatialReference!=null&&Zy(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>Fl(this.view,e,kr.EYE_AND_CENTER))}};h([u({constructOnly:!0})],Rd.prototype,"view",void 0),Rd=h([N("esri.views.3d.state.ElevationCollisionConstraint")],Rd);let _c=class extends ue{constructor(e){super(e),this.nearFarHeuristic=y4(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([D(()=>{var e,t,r,s;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(s=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:s.far]},()=>this._clipDistanceNearFarChanged()),D(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),D(()=>this.view.renderDataExtent,()=>this._updateNearFar(),at),D(()=>{var e,t,r,s;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(s=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:s.max]},()=>this._updateAltitude(),at),D(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),at),D(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),at),D(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),at),D(()=>{var e,t,r,s,a,n;return[(r=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:r.type,(n=(a=(s=this.view.state)==null?void 0:s.constraints)==null?void 0:a.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),at)]),this.view.state.isLocal&&this.addHandles(D(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),si)),this._updateNearFar(),this.view.state.viewingMode!==Ne.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Rd({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,T_(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var s,a,n;const e=(n=(a=(s=this.view.map)==null?void 0:s.ground)==null?void 0:a.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",r=this.view.state.constraints.collision;if(t!==r.enabled){r.enabled=t,t&&this._reapplyConstraints(ht.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ne.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Ht(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const r=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(om(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let t=Math.max(e.width,e.height);if(t<=0)return;e.zmax!=null&&e.zmin!=null&&(t=Math.max(t,e.zmax-e.zmin));const r=this.view.state,s=3*t/Math.atan(r.camera.fov/2);s!==r.constraints.distance&&(r.constraints.distance=s)}_reapplyConstraints(e=ht.ALL){this.view.state.updateCamera(t=>Ut(this.view,t,{selection:e,interactionType:Se.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:hi.TUMBLE}))}};h([u({constructOnly:!0})],_c.prototype,"view",void 0),h([u({readOnly:!0})],_c.prototype,"surfaceCollisionConstraint",void 0),_c=h([N("esri.views.3d.state.ConstraintsManager")],_c);let nn=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=su(),this._points=aP(),this.lines=new Array(12),this._origin=b(),this._direction=b(),this._altitude=null;for(let t=0;t<12;t++)this.lines[t]={origin:null,direction:b(),endpoint:null}}update(e){nP(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),ae(this._origin,e.eye),ae(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let t=0;t<this._points.length;t++)ae(this._points[t],e[t]);oP(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return Fu(this.frustum,e)}intersectsRay(e){return lP(this.frustum,e)}intersectsLineSegment(e,t){return cP(this.frustum,e,t)}intersectsPoint(e){return hP(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;Cp(this.lines[t],e[t],e[r]),Cp(this.lines[t+4],e[t],t===3?e[0]:e[t+1]),Cp(this.lines[t+8],e[r],t===3?e[4]:e[r+1])}}};function Cp(i,e,t){i.origin=e,i.endpoint=t,Su(i.direction,e,t)}nn.planePointIndices=dP,nn.nearFarLineIndices=[[pt.NEAR_BOTTOM_LEFT,pt.FAR_BOTTOM_LEFT],[pt.NEAR_BOTTOM_RIGHT,pt.FAR_BOTTOM_RIGHT],[pt.NEAR_TOP_RIGHT,pt.FAR_TOP_RIGHT],[pt.NEAR_TOP_LEFT,pt.FAR_TOP_LEFT]];let Dc=class extends Ta{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=wt.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Zy(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),Fl(this.view,e,kr.EYE_AND_CENTER)||this.constraintEnabled||(this.state=wt.Stopped)})}};h([u({constructOnly:!0})],Dc.prototype,"desiredCamera",null),Dc=h([N("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Dc);let P4=class{constructor(e,t,r){this.target=e,this.options=t,this.view=r,this.state="pending",this._animationController=null,this.promise=new Promise((s,a)=>{this._resolveCallback=s,this._rejectCallback=a;const n=new AbortController;this.options.signal!=null&&xy(this.options.signal,()=>{this.abort()}),this._abortController=n,this.waitForReady()})}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(ks())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await cm(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}async createViewPoint(){if(this.state!=="finished"){this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null;try{const e=await XT(this.view,this.target,this._abortController.signal);if(this.state==="finished")return;const t=e?this._getCameraFromViewpoint(e):null;if(t==null)return;if(this.options.animate){if(this._animationController==null)return;this.startAnimation(t,this._animationController)}else this.view.stateManager.setStateCamera(t.camera,{applyConstraints:!t.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()}catch(e){this.reject(e)}}}_getCameraFromViewpoint(e){var a;const t=!!(this.target instanceof Rl&&this.target.camera||this.target instanceof _o),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,l=o?o.wkid:"none",c=(a=this.view.spatialReference)==null?void 0:a.wkid;return this.reject(new Mr("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const s=Ka(this.view,r);return s==null?(this.reject(new Mr("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:s,isFullySpecified:t}}startAnimation(e,t){this.state="wait-for-animation-finish";const r=t.viewAnimation;if(r==null)return void this.reject(new Mr("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!t.active||t.viewAnimation==null||t.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==t)return this.abort();let s;e.isFullySpecified?(s=new Dc({view:this.view,desiredCamera:e.camera}),Fl(this.view,e.camera,kr.EYE_AND_CENTER)):Ut(this.view,e.camera),t.begin(e.camera,this.options);const a=()=>{const o=this.view.state.cameraController;s&&(o&&o.active?o instanceof Ra&&o.viewAnimation!=null&&o.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=s):t.viewAnimation!=null&&t.viewAnimation.target===e.viewpoint&&t.state==="finished"&&(this.view.state.cameraController=s))},n=o=>{if(this.view.state!=null)switch(t.state){case wt.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case wt.Ready:case wt.Rejected:case wt.Running:case wt.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(o)}}};r.when(a,o=>n(o)),t.asyncResult={resolve:()=>n(),reject:o=>n(o)}}_getAnimationController(){let e=null,t=null;const r=this.view.state.cameraController;return r instanceof Ra&&(r.updateStateFromViewAnimation(),r.active&&(e=r,t=e.viewAnimation)),e!=null||(e=new Ra({view:this.view,mode:"animation"}),t=e.viewAnimation,this.view.state.switchCameraController(e))?e:(t!=null&&t.stop(),this.reject(new Mr("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Kt=class extends ue{get camera(){const e=this._get("camera");if(!this.ready)return e;const t=tf(this.view,this.view.state.camera,Pp);return t&&e&&t.equals(e)?e:t.clone()}set camera(e){var t,r;this._updatePropertyBeforeReady("camera",e)||((t=this.view.elevationProvider)==null||t.enableElevationCache(!0),this.setStateCamera(Ka(this.view,e),{applyConstraints:!1})||ce.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=tf(this.view,this.view.state.contentCamera,Pp);return t&&e&&t.equals(e)?e:t.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Ka(this.view,e);t!=null?(this._updateElevation(t),this.view.state.contentCamera=t):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(Sp),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,r=this.view.state.camera.distance**2,s=Ty(this.view.state.camera.center),a=e.sticky?this.contentCamera.clone():null;return this.addHandles([D(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(Sp),this.test.contentCameraResetState.clear())}),D(()=>this.zoom,n=>{n!==void 0&&t!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a))}),D(()=>this.view.state.camera,n=>{const o=un(s,n.center);this.test.contentCameraResetState.set("camera.center",o/r),o>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=a)})],Sp),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var t;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ce.getLogger(this).error("#center=","Invalid center",e):ce.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):ce.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Qy(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return t??this._get("extent")}set extent(e){var t;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ce.getLogger(this).error("#extent=","Invalid extent",e):ce.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e):ce.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get _initialViewpoint(){var t;const e=this.view.map;return e&&"initialViewProperties"in e?(t=e.initialViewProperties)==null?void 0:t.viewpoint:void 0}get hasInitialView(){return!!this._initialViewpoint}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Xy(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ce.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,r=e.pixelRatio,s=this._get("padding"),a=Math.round(t[_r.TOP]/r),n=Math.round(t[_r.RIGHT]/r),o=Math.round(t[_r.BOTTOM]/r),l=Math.round(t[_r.LEFT]/r);return s!=null&&s.top===a&&s.right===n&&s.bottom===o&&s.left===l?s:{top:a,right:n,bottom:o,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,jh),this.view.state.updateCamera(t=>t.padding=jh))}_paddingToArray(e,t,r){e?Va(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Va(r,0,0,0,0);for(let s=0;s<4;s++)r[s]=Math.round(r[s]*t)}get screenCenter(){const e=this.padding;return Cy((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?YT(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var t;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ce.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,s=r!=null&&r.spatialReference;ce.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(s?s.wkid:"none")+", view: "+((t=this.view.spatialReference)==null?void 0:t.wkid)+")",e)}else ce.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?KT(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ce.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),t=(this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e)*this.view.resolutionScale;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*t),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*t);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return $_(this._tmpCanvasSize,r),this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth*.5+this._tmpCanvasSize.height/this.view.surface.clientHeight*.5:t,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,t;return((t=(e=this.view)==null?void 0:e._stage)==null?void 0:t.renderer.isFeatureEnabled(Ws.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var t,r;const e=(r=(t=this.view)==null?void 0:t._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(Ws.PhysicalPixelRendering,Ui.IDLE)||e.isFeatureEnabled(Ws.PhysicalPixelRendering,Ui.INTERACTING)||e.isFeatureEnabled(Ws.PhysicalPixelRendering,Ui.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._idleTimeout=w0,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},get updatingIgnoreRenderState(){return this.renderState!=null},get idleTimeoutEnabled(){return this.viewStateManager._idleTimeout>0},set idleTimeoutEnabled(t){this.viewStateManager._idleTimeout=t?w0:0}},this._propertiesPool=new Tn({frustum:nn},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new S4}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([Oa(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),D(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,t)=>this._cameraChangedHandler(e,t),at)]),Tl(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([Ou({prepare:()=>this._prepareFrame()}),D(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(Wh)}),Oa(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=re(this._propertiesPool)}init(){this.constraintsManager=new _c({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this._cameraSetByUser){const t=this._initialViewpoint||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ne.Local&&this.addHandles(Tl(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(Wh),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),Wh)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(Wh),this.constraintsManager=re(this.constraintsManager))}async goTo(e,t){const r={animate:!0,...t};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new P4(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation.promise}debugSetCameraOnContent(){this.setStateCamera(JT(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,r=t==null?void 0:t.cameraController;r&&(t.updateCamera(s=>r.stepController(e,s)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:r,overrides:s}of O4){const a=e.has(r),n=this._isOverridden(r);!a&&n&&t.push({name:r,value:this._get(r)}),this._clearOverride(r),(a||n)&&s.forEach(o=>e.add(o))}return t}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof _o)return void this.setStateCamera(Ka(this.view,e),{applyConstraints:!1});if(e instanceof Rl){if(e.targetGeometry instanceof Us){const a=ip(this.view,e.targetGeometry,0,.5,Ch.LOCKED);return void(a!=null&&this.setStateCamera(Ka(this.view,a),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},s=this._viewpointToCamera(e);return void this.setStateCamera(s,r)}const t=ip(this.view,e,0,.5,Ch.LOCKED);t!=null&&this.setStateCamera(Ka(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&R4.has(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Rl?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof _o?this.isCompatible(e.position):e.spatialReference&&Qx(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=E4){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,r=Wa){const{heading:s,tilt:a}=this._getPreservingHeadingTilt(),n=eC(this.view,s,a,e,t,Ch.ADJUST);return n==null?null:(r.copyFrom(this.view.state.camera),r.eye=n.eye,r.center=n.center,r.up=n.up,r)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:t,tilt:r}=this._getPreservingHeadingTilt(),s=ip(this.view,e,t,r,Ch.ADJUST,Pp);return s?Ka(this.view,s):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const r=t.renderLocation,s=t.location.latitude;if(s==null)return null;const a=tC(this.view,e,s);return this._centerPointAtDistanceToCamera(r,a)}_zoomToCamera(e){return this._scaleToCamera(iC(this.view,e))}_viewpointToCamera(e){return Ka(this.view,rC(this.view,e))}setStateCamera(e,t){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{t.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),t.applyConstraints&&Ut(this.view,r)}),t.applyConstraints||(this.view.state.cameraController=new Dc({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height),this.view.state)){const s=this.view.state.camera;s.fullWidth===r.width&&s.fullHeight===r.height&&s.pixelRatio===r.pixelRatio||(Wa.copyFrom(s),Wa.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,jh),Wa.padding=jh),Wa.fullWidth=r.width,Wa.fullHeight=r.height,Wa.pixelRatio=r.pixelRatio,this.view.state.camera=Wa),this._updateViewState()}}_updateElevation(e){var a,n;const t=(a=this.view.basemapTerrain)==null?void 0:a.spatialReference,r=((n=this.view.renderCoordsHelper)==null?void 0:n.getAltitude(e.eye))??0,s=t?T_(this.view,e.eye):0;e.relativeElevation=r-s}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ui.ANIMATING:this.view.interacting?this.view.state.mode=Ui.INTERACTING:(this.view.state.mode===Ui.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<this._idleTimeout?this.view.state.mode=Ui.INTERACTING:this.view.state.mode=Ui.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,t){e&&t&&e.almostEquals(t)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};h([u({type:_o,dependsOn:["view.state.camera","ready"]})],Kt.prototype,"camera",null),h([u({type:_o,dependsOn:["view.state.contentCamera","ready"]})],Kt.prototype,"contentCamera",null),h([u({type:Qr})],Kt.prototype,"center",null),h([u({type:Us})],Kt.prototype,"extent",null),h([u({readOnly:!0})],Kt.prototype,"frustum",null),h([u()],Kt.prototype,"_initialViewpoint",null),h([u({readOnly:!0})],Kt.prototype,"hasInitialView",null),h([u({readOnly:!0,type:Boolean})],Kt.prototype,"ready",void 0),h([u({type:Number})],Kt.prototype,"scale",null),h([u()],Kt.prototype,"padding",null),h([u({readOnly:!0})],Kt.prototype,"screenCenter",null),h([u({constructOnly:!0})],Kt.prototype,"view",void 0),h([u({type:Rl})],Kt.prototype,"viewpoint",null),h([u({type:Number})],Kt.prototype,"zoom",null),h([u({readOnly:!0})],Kt.prototype,"_rasterPixelRatio",null),h([u({readOnly:!0})],Kt.prototype,"_usePhysicalPixelRendering",null),h([u({readOnly:!0})],Kt.prototype,"_usePhysicalPixelRenderingAny",null),h([u()],Kt.prototype,"_windowDevicePixelRatio",void 0),h([u()],Kt.prototype,"_devicePixelRatioOverride",void 0),Kt=h([N("esri.views.3d.state.ViewStateManager")],Kt);let S4=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const R4=new Set(["camera","viewpoint","extent","scale","center","zoom"]),O4=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],E4={heading:0,tilt:0},Pp=new _o,Wa=new gt,jh=gi(),Wh="pending-initial-view",Sp="content-camera-reset",w0=300,x0=100;let Qs=class extends Ta{constructor(){super(...arguments),this.startCamera=new gt,this.currentCamera=new gt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<x0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=wt.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),x0),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};h([u({readOnly:!0})],Qs.prototype,"isInteractive",null),h([u()],Qs.prototype,"_lastInteraction",void 0),Qs=h([N("esri.views.3d.state.controllers.InteractiveController")],Qs);var gr;(function(i){i[i.CENTER=0]="CENTER",i[i.EYE=1]="EYE"})(gr||(gr={}));let Lc=class extends Qs{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=gr.CENTER,this._rotScale=0,this._lastPoint=yi(),this._tmpWorldUp=b(),this._tmpViewDir=b(),this._tmpRotCurPoint=yi(),this._tmpTransf=nt(),this._tmpAxis=b(),this._tmpPivotPoint=b(),this._pivotPos=b(),this._constraintOptions={selection:ht.ALL,interactionType:Se.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:hi.TUMBLE}}initialize(){this._rotScale=this.pivot===gr.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case gr.EYE:ae(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=Se.LOOK_AROUND,this._constraintOptions.tiltMode=hi.LOOK_AROUND,this._constraintOptions.selection=ht.NONE;break;case gr.CENTER:{const t=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Co:{});t||ae(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.tiltMode=hi.TUMBLE,this._constraintOptions.selection=ht.ALL&~ht.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,lo(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,t){const r=this.startCamera,s=b();pe(s,this._pivotPos,r.eye);const a=ve(s),n=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,T0);let o=Math.max(Math.min(r4,1/Math.abs(Ie(T0,r.viewForward)))*n,s4);t&&(o=Math.min(a,o));const l=Tt(this.view.spatialReference),c=Dt(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),d=qu(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(oh(this.view),r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*bp,bp),m=this.view._stage.renderView.getMinimalDepthForArea(oh(this.view),e[0],e[1],r,bp);p==null&&m==null||(p=p??m??0,m=m==null||d===oi.Horizontal?p:m,o=p>m?m:p,o=t?Math.min(o,a):o),ye(s,s),ae(this._pivotPos,me(this._tmpPivotPoint,r.eye,J(this._tmpPivotPoint,s,o)))}update(e){if(this.active){switch(this.pivot){case gr.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case gr.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Ut(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,t,r,s){this.view.renderCoordsHelper.worldUpAtPosition(s,this._tmpWorldUp),lo(e,t,this._tmpRotCurPoint);let a=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,n=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;pe(this._tmpViewDir,r,s);const o=ve(this._tmpViewDir),l=ea(Ie(this._tmpViewDir,this._tmpWorldUp)/o);if(this.pivot===gr.EYE){a*=-.5;const c=.5*Math.PI-l,d=.5*Math.PI*.99;a=c-Math.max(-d,Math.min(d,c+a))}return a=K(a+l,xi.min,xi.max)-l,Wt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===gr.CENTER&&(n=-n),po(this._tmpTransf,n,this._tmpWorldUp),Pa(this._tmpTransf,this._tmpTransf,a,this._tmpAxis),Zt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=Zt(Rp,e.up,this._tmpTransf),me(Rp,s,this._tmpViewDir),za(this._lastPoint,this._tmpRotCurPoint),Rp}};h([u()],Lc.prototype,"pivot",void 0),Lc=h([N("esri.views.3d.state.controllers.RotateController")],Lc);const Rp=b(),T0=b();let Op=class extends Cs{constructor(e,t,r,s){super(!0),this._view=e,this.pointerAction=t,this._pivot=r,this.registerIncoming("drag",s,a=>this._handleDrag(a))}_handleDrag(e){const t=e.data;if(t.pointers.size>1||!x_(e.data,this.pointerAction))return;const r=Dt(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new Lc({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},zm=class extends Qs{constructor(){super(...arguments),this._pickPoint=b(),this._tmpP0=yi(),this._panAxisAngle=Uu(),this._tmpRayDir=b(),this._tmpRayDirPick=b(),this._targetOnSphere=b(),this._navMode=oi.Horizontal,this._tmpRay={origin:b(),direction:b()},this.dragBeginPoint=Dt(),this._normalizedAnchorPoint=yi(),this._constraintOptions={selection:ht.ALL_EXCEPT_COLLISION,interactionType:Se.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:hi.TUMBLE},this._sphere=ta(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;za(this.dragBeginPoint,e),lo(this.startCamera,e,this._normalizedAnchorPoint);const t=Tt(this.view.spatialReference),r=Ab(this._intersectionHelper,this.startCamera,e,t,El.Ellipsoid,this.view.map.ground.opacity===0?Co:{});if(this._navMode=qu(this.startCamera,e,t),this._navMode===oi.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let s;Nl(this.startCamera,e,this._tmpRay),ye(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(pe(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),s=ve(this._tmpRayDirPick));const a=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,C0);let n=K(Math.min(xb,1/Math.abs(Ie(C0,this._tmpRay.direction)))*a,du[0],du[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,zu);n=o??n,n=s!=null?Math.min(n,s):n,this._hasPickPoint=!0,J(this._tmpRay.direction,this._tmpRay.direction,n),me(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===oi.Horizontal){pe(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=ve(this._tmpRayDir);lo(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=t*2**r;const a=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<a&&(s=a),Math.abs(t-s)<1e-6)return;if(this._hasPickPoint&&s<t){const n=1-(1-s/t)*(1-this._sphere[3]/ve(this.currentCamera.center));this.currentCamera.center=J(Qh,this.currentCamera.center,n)}J(this._tmpRayDir,this._tmpRayDir,-s/t),this.currentCamera.eye=me(Qh,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=_s(Gc(this.dragBeginPoint,e)),Ut(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(nh(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),Z_(this._pickPoint,this._targetOnSphere,this._panAxisAngle),Sn(this.currentCamera,this._sphere,this._panAxisAngle))}else{const t=ve(this._tmpRay.direction);lo(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let s=t*2**r;const a=this.view.state.constraints.minimumPoiDistance;if(r<0&&s<a&&(s=a),Math.abs(t-s)<1e-6)return;J(this._tmpRayDir,this._tmpRay.direction,1-s/t),this.currentCamera.eye=me(Qh,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=me(Qh,this.currentCamera.center,this._tmpRayDir)}Fl(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};zm=h([N("esri.views.3d.state.controllers.global.ZoomController")],zm);const Qh=b(),C0=b();let qm=class extends Qs{constructor(){super(...arguments),this._tmpP=b(),this._tmpDir=b(),this._tmpN=b(),this._tmpP0=yi(),this._tmpPoi=b(),this._tmpRayDir=b(),this.dragBeginPoint=Dt(),this._normalizedAnchorPoint=yi(),this._constraintOptions={selection:ht.ALL,interactionType:Se.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:b(),tiltMode:hi.TUMBLE},this._plane=mo()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;za(this.dragBeginPoint,e),lo(this.startCamera,e,this._normalizedAnchorPoint);const t=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Co:{});pe(this._tmpDir,this._tmpP,this.startCamera.eye);const r=ve(this._tmpDir);ye(this._tmpDir,this._tmpDir);const s=Math.abs(this.view.camera.position.z);let a=K(Math.min(xb,1/Math.abs(Ie(A4,this._tmpDir)))*s,du[0],du[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(oh(this.view),e[0],e[1],this.view.state.camera,zu);a=n??a,a=t?Math.min(a,r):a,J(this._tmpDir,this._tmpDir,a),me(this._tmpP,this.startCamera.eye,this._tmpDir),pe(this._tmpN,this.startCamera.eye,this.startCamera.center),ye(this._tmpN,this._tmpN),this._tmpN[1]<0&&pn(this._tmpN,this._tmpN),Py(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;a4(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||ae(this._tmpPoi,this.currentCamera.center),lo(this.currentCamera,e,this._tmpP0);let t=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);za(this._normalizedAnchorPoint,this._tmpP0),pe(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=ve(this._tmpRayDir);let s=r*(1-t);this._constraintOptions.interactionDirection&&(ae(this._constraintOptions.interactionDirection,this._tmpRayDir),J(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(t)/r));const a=this.view.state.constraints.minimumPoiDistance;t>=0&&s<a&&(s=a,t=-(s-r)/r),Math.abs(r-s)<1e-6||(J(this._tmpRayDir,this._tmpRayDir,t),this.currentCamera.eye=me(In,this.currentCamera.eye,this._tmpRayDir),ws(In,this.currentCamera.center,this._tmpPoi,t),this._tmpPoi[2]>this.startCamera.center[2]?In[2]=Math.max(this.startCamera.center[2],In[2]):In[2]=Math.min(this.startCamera.center[2],In[2]),this.currentCamera.center=In,this._constraintOptions.interactionFactor=_s(Gc(this.dragBeginPoint,e)),Ut(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};qm=h([N("esri.views.3d.state.controllers.local.ZoomController")],qm);const In=b(),A4=ft(0,0,1);let M4=class extends Cs{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){const t=e.data;if(t.pointers.size>1||!x_(e.data,this.pointerAction))return;const r=Dt(t.center.x,t.center.y);switch(t.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new zm({view:this._view}):this._cameraController=new qm({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},ao=class extends Qs{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new gt,this._headingStart=0,this._constraintOptions={selection:ht.ALL,interactionType:Se.NONE,interactionStartCamera:new gt,interactionFactor:0,interactionDirection:null,tiltMode:hi.LOOK_AROUND}}handleEventGamepad(e){const t=Jg(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||Ju(t))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,ef(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const t=ef(this._keysButtonState,this._transformation);Ju(t)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(t-this._filteredSurfaceElevation)*e}stepController(e,t){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Nn),this._applyDisabledMovementTypes(Nn),this._applyPan(Nn.pan),this._applyRotate(Nn.rotate),this._applyZoom(Nn.zoom),this._applyAscend(Nn.ascend),this._constraintOptions.interactionType=Se.NONE,this._constraintOptions.selection=ht.COLLISION,Ut(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,t)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Qi,t.center,t.eye),Zt(Qi,Qi,e.matrix),t.center=me(Qi,Qi,t.eye),t.up=Zt(Qi,t.up,e.matrix),this._constraintOptions.interactionType=Se.LOOK_AROUND,this._constraintOptions.selection=ht.ALL_EXCEPT_COLLISION,Ut(this.view,t,this._constraintOptions)}_applyPan(e,t=this.currentCamera){e.enabled&&(t.eye=Zt(Qi,t.eye,e.matrix),t.center=Zt(Qi,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Zt(Qi,t.up,e.matrix)),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.selection=ht.ALL,Ut(this.view,t,this._constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=me(Qi,this.currentCamera.eye,J(Rt.get(),t,e)),ae(Ql,t),pn(Ql,Ql),this._constraintOptions.interactionDirection=Ql,this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.selection=ht.ALL_EXCEPT_COLLISION,Ut(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Rt.get());if(this._constraintOptions.interactionDirection=ae(Ql,t),this.view.state.isGlobal){const r=ve(this.currentCamera.eye),s=(r+e)/r;this.currentCamera.eye=J(Qi,this.currentCamera.eye,s),this.currentCamera.center=J(Qi,this.currentCamera.center,s)}else{const r=J(Rt.get(),t,e);this.currentCamera.eye=me(Qi,this.currentCamera.eye,r),this.currentCamera.center=me(Qi,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=Se.ASCEND,this._constraintOptions.selection=ht.COLLISION,Ut(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=ht.ALL_EXCEPT_COLLISION,Ut(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,r){V4(r);const s=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(s,t,r):this._calculateControlTransformationGlobal(s,t,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(r,e,Qi)}_calculateControlTransformationLocal(e,t,r){const{viewRight:s,viewForward:a}=t,n=this._transformation,o=this.view.navigation.gamepad,l=Xt(Rt.get(),a[0],a[1],0);ye(l,l);const c=n.translation[0]*e.pan;if(c!==0){const y=J(Rt.get(),s,c);jc(r.pan.matrix,r.pan.matrix,y),r.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=J(Rt.get(),l,y);jc(r.pan.matrix,r.pan.matrix,v),r.pan.enabled=!0}r.zoom=n.zoom*e.zoom;break}case"zoom":r.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:fn(o.mode)}const d=n.translation[2]*e.ascend;r.ascend=d;const p=-n.heading*e.rotate;p!==0&&(Pa(r.rotate.matrix,r.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Rt.get())),r.rotate.enabled=!0);const m=n.tilt*e.rotate,g=Pn(this.view.renderCoordsHelper,t.center,t.eye),f=K(g+m,xi.min,xi.max)-g;f&&(Pa(r.rotate.matrix,r.rotate.matrix,f,s),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,r){const{eye:s,viewRight:a}=t,n=this._transformation,o=this.view.navigation.gamepad,l=Wt(Rt.get(),a,s);ye(l,l),pn(l,l),d4(this.startCamera,t,n,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,o),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Nn.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,d=n.translation[2]*e.ascend;r.ascend=d;const p=-n.heading*e.rotate;p!==0&&(Pa(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.eye),r.rotate.enabled=!0);const m=n.tilt*e.rotate,g=this._clampTiltDeltaGlobalToValidRange(m,t.ray,c);g!==0&&(Pa(r.rotate.matrix,r.rotate.matrix,g,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,r){const s=Tt(this.view.spatialReference),a=Cd(xi.min,t.origin,r,s);let n=0,o=0;const l=Rt.get();if(this.view.renderCoordsHelper.intersectManifold(t,r,l)){const c=Pn(this.view.renderCoordsHelper,l,t.origin);n=Cd(c,t.origin,r,s),o=Cd(xi.max,t.origin,r,s)}else{Ru(u_(p_,r+s.radius),t,l);const c=Math.PI+m_(t.direction,l);n=c0(c,t.origin,r,s),o=c0(xi.max,t.origin,r,s)}return K(n+e,a,o)-n}_getPointAbsoluteSurfaceElevation(e,t,r){const{renderCoordsHelper:s}=this.view,a=s.getAltitude(e),n=t+Math.abs(a-t);return s.setAltitude(r,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:r}=this.view,{camera:s}=this.view.state,{direction:a}=sC(this.view,t,0,Ub,F4),n=r.intersectManifoldClosestSilhouette(uo(t,a),e,Rt.get()),o=sr(t,n),l=r.intersectManifoldClosestSilhouette(uo(t,Su(Rt.get(),t,s.center)),e,Rt.get()),c=sr(t,l);return Math.min(o,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:r}=this.view,{camera:s,isGlobal:a}=r,n=t.intersectManifoldClosestSilhouette(s.ray,this._filteredSurfaceElevation,Rt.get());if(a){const o=pe(Rt.get(),e,n),l=ve(o);J(o,o,1/l);const c=ye(Rt.get(),e),d=ea(Ie(c,o));return l*Math.sin(Math.min(L4,d))}{const o=ae(Rt.get(),e);return t.setAltitude(o,this._filteredSurfaceElevation),sr(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:$4}_computeVelocities(e){const t=this._filteredSurfaceElevation,r=t+Tt(this.view.spatialReference).radius,{camera:s,isGlobal:a}=this.view.state,n=Rt.get(),o=this._getPointAbsoluteSurfaceElevation(s.eye,t,n),l=this._clampedDistanceToSurface(t,n),c=s.width/2,d=P0*s.width,p=P0*s.width,m=l*Math.tan(.5*s.fovX)/c,g=m/r,f=m/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(a?g:m)*d*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(d*e/c)*y-y),zoom:2**(d*e/c)*l-l,rotate:K(f*p,I4,N4)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&kd(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&kd(e.rotate.matrix))}static activatesFor(e,t){const r=Jg(t,e.navigation.gamepad,D4);return!(t.action==="end"||Ju(r))}};h([u({constructOnly:!0})],ao.prototype,"gamepadDevice",void 0),h([u({constructOnly:!0})],ao.prototype,"disableMovements",void 0),ao=h([N("esri.views.3d.state.controllers.GamepadKeyboardController")],ao);const D4={translation:[0,0,0],heading:0,tilt:0,zoom:0},Ub=80,L4=Ht(Ub),P0=.75,$4=5,I4=Ht(30),N4=Ht(80),Nn={zoom:0,ascend:0,pan:{enabled:!1,matrix:nt()},rotate:{enabled:!1,matrix:nt()}},Qi=b(),Ql=b(),F4=aC();function V4(i){i.zoom=0,i.ascend=0,i.pan.enabled=!1,kd(i.pan.matrix),i.rotate.enabled=!1,kd(i.rotate.matrix)}let U4=class extends Cs{constructor(e){super(!0),this._view=e,this._watchHandles=new ph,this._handle=this.registerIncoming("gamepad",t=>this._handleEventGamepad(t)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([D(()=>this._view.navigation.gamepad.enabled,t=>{t?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},si),D(()=>this._view.navigation.gamepad.device,t=>{this._cameraControllerGamepad&&t&&this._cameraControllerGamepad.gamepadDevice!==t&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const t=this._view.navigation.gamepad.device;if(t&&e.data.device!==t)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||ao.activatesFor(this._view,e.data)){if(!r){const s=new ao({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(s)&&(this._cameraControllerGamepad=s)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var dr;(function(i){i[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i[i.FORWARD=2]="FORWARD",i[i.BACKWARD=3]="BACKWARD",i[i.UP=4]="UP",i[i.DOWN=5]="DOWN",i[i.HEADINGLEFT=6]="HEADINGLEFT",i[i.HEADINGRIGHT=7]="HEADINGRIGHT",i[i.TILTUP=8]="TILTUP",i[i.TILTDOWN=9]="TILTDOWN",i[i.ZOOMIN=10]="ZOOMIN",i[i.ZOOMOUT=11]="ZOOMOUT"})(dr||(dr={}));let z4=class extends Cs{constructor(e,t){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ne.Local},this._keyToNumber={[t.left]:dr.LEFT,[t.right]:dr.RIGHT,[t.forward]:dr.FORWARD,[t.backward]:dr.BACKWARD,[t.up]:dr.UP,[t.down]:dr.DOWN,[t.headingLeft]:dr.HEADINGLEFT,[t.headingRight]:dr.HEADINGRIGHT,[t.tiltUp]:dr.TILTUP,[t.tiltDown]:dr.TILTDOWN,[t.zoomIn]:dr.ZOOMIN,[t.zoomOut]:dr.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleStop()),this._visibilityHandle=LT(r=>r?null:this._handleStop())}onUninstall(){var e;(e=this._visibilityHandle)==null||e.remove(),this._handleStop()}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];t!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new ao({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(t),e.stopPropagation()))}_handleStop(){var e;(e=this._cameraControllerKeyboard)!=null&&e.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const t=this._keyToNumber[e.data.key];t!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(t),e.stopPropagation())}},q4=class extends Cs{constructor(e,t){super(!0),this._view=e,this.registerIncoming("mouse-wheel",t,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const t=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new _u({view:this._view,mode:"interaction"}):new gu({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*t.deltaY,Dt(t.x,t.y)),e.preventDefault(),e.stopPropagation()}},fu=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},yo=class extends sh{constructor(){super(...arguments),this._beginCamera=new gt,this._elapsedTimeSec=0,this.constraintOptions={selection:ht.ALL,interactionType:Se.PAN,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:hi.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Ol}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,t),Ut(this.view,t,this.constraintOptions)}};yo=h([N("esri.views.3d.state.controllers.momentum.MomentumController")],yo);let $c=class extends yo{constructor(e){super(e),this.interactionType=Se.PAN,this._tmpPan=b()}momentumStep(e,t){const r=this.momentum.value(e);J(this._tmpPan,this.momentum.direction,r),t.eye=pe(S0,t.eye,this._tmpPan),t.center=pe(S0,t.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};h([u({constructOnly:!0})],$c.prototype,"momentum",void 0),$c=h([N("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],$c);const S0=b(),B4=b(),Zh=b();let Od=class extends yo{constructor(e){super(e),this.interactionType=Se.PAN}momentumStep(e,t){const r=this.momentum.value1(e),s=this.momentum.value2(e);ae(Zh,t.eye),ye(Zh,Zh),Wt(this.momentum.axis2,Zh,this.momentum.axis1),$b(t,B4,this.momentum.axis1,r,this.momentum.axis2,s)}};h([u({constructOnly:!0})],Od.prototype,"momentum",void 0),Od=h([N("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Od);let to=class extends yo{set center(e){this._set("center",vn(e))}set axis(e){this._set("axis",vn(e))}constructor(e){super(e),this.interactionType=Se.TUMBLE}momentumStep(e,t){const r=this.momentum.value(e);Sn(t,this.center,ah(this.axis,r))}};h([u({constructOnly:!0})],to.prototype,"momentum",void 0),h([u({constructOnly:!0})],to.prototype,"center",null),h([u({constructOnly:!0})],to.prototype,"axis",null),to=h([N("esri.views.3d.state.controllers.momentum.MomentumController")],to);let ll=class extends yo{set zoomCenter(e){this._set("zoomCenter",vn(e))}constructor(e){super(e),this.interactionType=Se.ZOOM,this.constraintOptions.interactionDirection=b()}momentumStep(e,t){const{interactionDirection:r}=this.constraintOptions;if(!r)return;ae(r,t.eye);const s=this.momentum.valueDelta(0,e);Y_(t,this.zoomCenter,s,this.view.state.constraints.minimumPoiDistance),Su(r,t.eye,r)}};h([u({constructOnly:!0})],ll.prototype,"momentum",void 0),h([u({constructOnly:!0})],ll.prototype,"zoomCenter",null),ll=h([N("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],ll);let Wn=class extends yo{set screenCenter(e){this._set("screenCenter",Dt(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",vn(e))}constructor(e){super(e),this.interactionType=Se.ZOOM,this.radius=0,this._tmpSceneCenter=b(),this._tmpZoomAxisAngle=Uu(),this._sphere=ta()}initialize(){this._sphere[3]=this.radius}momentumStep(e,t){const r=this.momentum.valueDelta(0,e);Ob(this._sphere,t,r),this.constraintOptions.interactionType=Se.ZOOM,Ut(this.view,t,this.constraintOptions),nh(this._sphere,t,this.screenCenter,this._tmpSceneCenter),Z_(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),Sn(t,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=Se.PAN}};h([u({constructOnly:!0})],Wn.prototype,"momentum",void 0),h([u({constructOnly:!0})],Wn.prototype,"screenCenter",null),h([u({constructOnly:!0})],Wn.prototype,"sceneCenter",null),h([u({constructOnly:!0})],Wn.prototype,"radius",void 0),Wn=h([N("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Wn);let R0=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const O0=1e-5;let H4=class extends TP{constructor(e,t,r,s,a,n=0,o){super(e,t,r),this._angularVelocity1=s,this.axis1=a,this.angularVelocity2=n,this.axis2=o}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},k4=class{constructor(e=300,t=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this.enabled=!0,this._tmpAxis1=b(),this._tmpAxis2=b(),this._tmpAngles=yi(),this._time=new lp(.3),this._screen=[new lp(.4),new lp(.4)],this._angle1=new R0(.6),this._angle2=new R0(.6),this._axis1=b(),this._axis2=b(),this._lastScene=b()}addMomentumDirectRotation(e,t,r,s,a,n){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let o=Db(this._lastScene,t,this._tmpAxis2,s,a,n);this._angle2.update(0),gs(this._tmpAxis2)<O0?o=0:ye(this._axis1,this._tmpAxis2),this._angle1.update(o),ae(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,t,r,s,a,n,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;Lb(this._lastScene,t,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,s,a,n,o,!1),gs(this._tmpAxis2)<O0?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),ye(this._axis1,this._tmpAxis1),ye(this._axis2,this._tmpAxis2)),ae(this._lastScene,t)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,r=e==null||t==null?null:Math.sqrt(e*e+t*t),s=this._time.filteredDelta,a=r==null||s==null?0:r/s;return Math.abs(a)<this._minimumInitialVelocity?null:this.createMomentum(a,this._stopVelocity,this._friction)}createMomentum(e,t,r){const s=this._time.filteredDelta,a=this._angle1.filteredValue,n=this._angle2.filteredValue,o=s==null||n==null?0:n/s;return new H4(e,t,r,s==null||a==null?0:a/s,this._axis1,o,this._axis2)}},Bm=class extends Qs{constructor(){super(...arguments),this._smoothRotation=new fu(.05),this._rotationAxis=b(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=mo(),this._beginRadius=0,this._smoothScaling=new fu(.05),this._zoomCenterScreen=Dt(),this._zoomMomentumEstimator=new Iv,this._rotationMomentumEstimator=new Nv,this._panSphericalMomentumEstimator=new k4,this._panPlanarMomentumEstimator=new Fv,this._adjustedSphere=ta(),this._tmp3d=b(),this._tmpScreenPointArray=Dt(),this._beginScreenPoint=Dt(),this._beginScenePoint=b(),this._screenPickPoint=Dt(),this._scenePickPoint=b(),this._mode=oi.Horizontal,this._sphere=ta(),this._pointerCount=0,this._tmpInteractionDirection=b(),this._constraintOptions={selection:ht.ALL,interactionType:Se.NONE,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:hi.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var a;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panPlanarMomentumEstimator.enabled=t,this._panSphericalMomentumEstimator.enabled=t,this._beginHeading=-xn.normalize(Ht(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),zs(e.center,this._screenPickPoint),za(this._beginScreenPoint,this._screenPickPoint);const r=Tt(this.view.spatialReference),s=Ab(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,El.Silhouette,this.view.map.ground.opacity===0?Co:{});s.scenePickPoint!=null&&(this._scenePickPoint=s.scenePickPoint,this._sphere=s.sphere,ae(this._beginScenePoint,this._scenePickPoint),this._mode=qu(this.startCamera,this._screenPickPoint,r),this._mode===oi.Vertical&&this._preparePlanarPanMode(e,s.hasGeometryIntersection),(a=this._constraintOptions.interactionStartCamera)==null||a.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this._mode===oi.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return this._mode===oi.Horizontal?new Wn({view:this.view,momentum:t,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new ll({view:this.view,momentum:t,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new to({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===oi.Horizontal){const s=this._panSphericalMomentumEstimator.evaluateMomentum();if(s)return new Od({view:this.view,momentum:s})}else{const s=this._panPlanarMomentumEstimator.evaluateMomentum();if(s)return new $c({view:this.view,momentum:s})}return null}_preparePlanarPanMode(e,t){const r=pn(this._tmp3d,this.startCamera.viewForward);Py(this._scenePickPoint,r,this._panningPlane);const s=Dt(this._screenPickPoint[0],0),a=b(),n=ve(this.startCamera.eye);this._adjustedSphere[3]=n<this._sphere[3]?n-100:this._sphere[3],nh(this._adjustedSphere,this.startCamera,s,a);const o=mh();this.startCamera.projectToRenderScreen(a,o);const l=b(),c=b(),d=b();pe(l,this._scenePickPoint,this.currentCamera.eye);const p=ve(l);ye(l,l);const m=Sb*Math.max(Math.abs(this.view.camera.position.z),Rb),g=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,zu);let f=g??m;f=t?Math.min(f,p):f,ae(d,me(c,this.currentCamera.eye,J(c,l,f))),this._panningPlane[3]=-Ie(Pl(this._panningPlane),d),this.startCamera.center=me(c,this.startCamera.eye,J(c,this.startCamera.viewForward,f));const y=zs(e.center,this._tmpScreenPointArray);Um(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),Ob(this._sphere,this.currentCamera,this._smoothScaling.value),zs(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=_s(e.radius-this._beginRadius),Ut(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const t=zs(e.center,this._tmpScreenPointArray);nh(this._sphere,this.currentCamera,t,this._tmp3d),K_(this._beginScenePoint,Ie(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Nb(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Ib(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(t,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=_s(Gc(this._screenPickPoint,t)),Ut(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){ye(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||pn(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value,r=t+Vm(e.angle-t),s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(r);const a=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(a,.001*e.timestamp),Sn(this.currentCamera,this._sphere,ah(this._rotationAxis,a)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=_s(e.radius*r),Ut(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const t=zs(e.center,this._tmpScreenPointArray);Um(this._panningPlane,this.currentCamera,t,this._tmp3d)&&(Mb(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(t,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=_s(Gc(this._beginScreenPoint,t)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Ut(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(t),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),Y_(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=_s(e.radius-this._beginRadius),Ut(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){ae(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||pn(this._rotationAxis,this._rotationAxis);const t=this._smoothRotation.value;let r=e.angle-t;r=Vm(r);const s=t+r,a=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=a,this._smoothRotation.update(s);const n=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(n,.001*e.timestamp),Sn(this.currentCamera,this._sphere,ah(this._rotationAxis,n)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=_s(e.radius*n),Ut(this.view,this.currentCamera,this._constraintOptions)}};Bm=h([N("esri.views.3d.state.controllers.global.PinchAndPanController")],Bm);const E0=ft(0,0,1),G4={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let Hm=class extends Qs{constructor(){super(...arguments),this._rotationValueSmooth=new fu(.05),this._scalingValueSmooth=new fu(.05),this._planeHorizontal=mo(),this._planeVertical=mo(),this._rotationMomentumEstimator=new Nv,this._panMomentumEstimator=new Fv(300,12,.9),this._zoomMomentumEstimator=new Iv,this._beginRadius=0,this._beginCenter=b(),this._beginAngle=0,this._tmpPoints=[],this._panMode=oi.Horizontal,this._beginCenterScreen=Dt(),this._tmpCentroid3d=b(),this._tmpCentroid2d=Dt(),this._tmp2d=Dt(),this._pointerCount=0,this._constraintOptions={selection:ht.ALL,interactionType:Se.NONE,interactionFactor:0,interactionStartCamera:new gt,interactionDirection:null,tiltMode:hi.TUMBLE}}begin(e){var f;if(!this.active)return;const t=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=t,this._rotationMomentumEstimator.enabled=t,this._panMomentumEstimator.enabled=t,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),zs(e.center,this._beginCenterScreen),by(E0,0,this._planeHorizontal);const r=b(),s=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Co:{}),a=b();pn(a,this.startCamera.viewForward);const n=b();ae(n,E0);const o=Ie(a,n),l=kc(o<0?-o:o);this._panMode=l>=G4.ANGLE_THRESHOLD?oi.Horizontal:oi.Vertical;const c=Math.min(Sb,1/Math.abs(Ie(n,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Rb);Dg(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||Zx(this._planeHorizontal,this._planeHorizontal);const d=b(),p=b(),m=b();pe(d,r,this.currentCamera.eye);const g=ve(d);if(ye(d,d),this._panMode===oi.Vertical){J(n,n,o),pe(this._planeVertical,a,n),ye(this._planeVertical,this._planeVertical),Dg(this._planeVertical,this._planeVertical,r);const y=this.view._stage.renderView.getMinimalDepthForArea(oh(this.view),this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,zu);let v=y??c;v=s?Math.min(v,g):v,ae(m,me(p,this.currentCamera.eye,J(p,d,v))),this._planeVertical[3]=-Ie(this._planeVertical,m),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),wp(this._tmpPoints,this._beginCenter)}else{const y=s?g:c;ae(m,me(p,this.currentCamera.eye,J(p,d,y))),this._planeHorizontal[3]=-Ie(Pl(this._planeHorizontal),m),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),wp(this._tmpPoints,this._beginCenter)}(f=this._constraintOptions.interactionStartCamera)==null||f.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,r=this._panMode===oi.Horizontal?this._planeHorizontal:this._planeVertical,s=this._beginCenter;if(t){const a=this._beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=n,this._scalingValueSmooth.update(a),Y_(this.currentCamera,s,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=Se.ZOOM,this._constraintOptions.interactionFactor=_s(Math.abs(e.radius-this._beginRadius)),Ut(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),wp(this._tmpPoints,this._tmpCentroid3d),zs(e.center,this._tmpCentroid2d),Mb(this.currentCamera,s,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=Se.PAN,this._constraintOptions.interactionFactor=_s(Gc(this._beginCenterScreen,this._tmpCentroid2d)),Ut(this.view,this.currentCamera,this._constraintOptions),t){const a=this._planeHorizontal,n=s,o=this._rotationValueSmooth.value,l=o+Vm(e.angle-o),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const d=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(d,.001*e.timestamp),Sn(this.currentCamera,n,ah(a,d)),this._constraintOptions.interactionType=Se.TUMBLE,this._constraintOptions.interactionFactor=_s(Math.abs(e.radius*d)),Ut(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const t=this._zoomMomentumEstimator.evaluateMomentum();if(t)return new ll({view:this.view,momentum:t,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new to({view:this.view,momentum:r,center:this._beginCenter,axis:Pl(this._planeHorizontal)});const s=this._panMomentumEstimator.evaluateMomentum();return s?new $c({view:this.view,momentum:s}):null}_computePlanePoints(e,t,r,s){s.length=e.size;const a=this._tmp2d;let n=0;return e.forEach(o=>{a[0]=o.x,a[1]=o.y,s[n]===void 0&&(s[n]=b()),Um(t,r,a,s[n]),n+=1}),s}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};Hm=h([N("esri.views.3d.state.controllers.local.PinchAndPanController")],Hm);let A0=class extends Cs{constructor(e,t,r){super(!0),this._view=e,this.pointerAction=t,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!x_(e.data,this.pointerAction))return;const t=e.timestamp-this._lastEndTimestamp,r=40,s=this._momentum&&this._momentum.active&&t<r;switch(e.data.action){case"start":case"update":if(s)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,t){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);t&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Bm({view:this._view}):new Hm({view:this._view})}},j4=class extends Cs{constructor(e,t){super(!0),this.view=e,this.registerIncoming("pointer-down",t,()=>this.view.state.stopActiveCameraController())}},zb=class extends Cs{constructor(e,t){super(!0),this.key=e,this.registerIncoming("key-down",t,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},W4=class extends zb{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},Q4=class extends zb{constructor(e,t,r){super(t,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},Z4=class extends Cs{constructor(e,t=!1){super(!0),this._view=e,this._invert=t,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var s,a,n;const t=this._invert?-1:1,r=Dt(0,e.data.delta*t);switch(e.data.action){case"begin":(s=this._cameraController)==null||s.end(),this._cameraController=new Lc({view:this._view,pivot:gr.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(a=this._cameraController)==null||a.update(r);break;case"end":(n=this._cameraController)==null||n.end(),this._cameraController=null}}},X4=class extends Cs{constructor(e=20,t=40){super(!1),this._threshold=e,this._maxDelta=t,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new $T({start:(r,s)=>this._observeStart(r,s),update:(r,s,a)=>this._observeUpdate(r,s,a),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,t){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),t.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,t,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void t.stopPropagation()):void(this._checkMovementWithinLimits(t.data,r.data)?this._checkVerticalThresholdReached(t.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=t.data.center,this._artificalDrag.emit({action:"end",button:t.data.button,buttons:t.data.buttons,pointerType:t.data.pointerType,timestamp:t.data.timestamp,pointers:t.data.pointers,pointer:t.data.pointer,angle:t.data.angle,radius:t.data.radius,center:t.data.center}),this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),t.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,t){let r=-1/0,s=1/0,a=-1/0,n=1/0;for(const{x:y,y:v}of t.pointers.values())r=Math.max(r,y),s=Math.min(s,y),a=Math.max(a,v),n=Math.min(n,v);let o=-1/0,l=1/0,c=-1/0,d=1/0;for(const{x:y,y:v}of e.pointers.values())o=Math.max(o,y),l=Math.min(l,y),c=Math.max(c,v),d=Math.min(d,v);const p=r-s,m=a-n,g=o-l,f=c-d;return Math.abs(e.center.x-t.center.x)<this._threshold&&Math.abs(g-p)<=this._maxDelta&&Math.abs(f-m)<=this._maxDelta}_checkVerticalThresholdReached(e,t){let r=Math.abs(e.center.y-t.center.y);return e.pointers.forEach((s,a)=>{const n=t.pointers.get(a);r=Math.min(r,Math.abs(s.y-n.y))}),r>=this._threshold}},rs=class extends ue{destroy(){this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=re(this._inputManager)}connect(){const e=this.view;this._source=new IT(this.view.surface,e.input);const t=[new NT,new FT,new VT,new UT(this.view.navigation),new X4],r=new sP({eventSource:this._source,recognizers:t});this._inputManager=r,r.installHandlers("prevent-context-menu",[new zT],Cf.INTERNAL),this._modeDragPan=new A0(e,"primary"),this._modeDragRotate=new Op(e,"secondary",gr.CENTER),this._modeDragZoom=new M4(e,"tertiary");const s={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new j4(e),new f4(e),new U4(e),new z4(e,s.pan),new q4(e),new Q4(e,s.resetTilt),new W4(e,s.resetHeading),new Op(e,"primary",gr.EYE,[s.lookAround]),new Op(e,"secondary",gr.CENTER,[s.lookAround]),new A0(e,"tertiary",[s.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Z4(e)],Cf.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this.addHandles(D(()=>{var a;return(a=this.view.navigation)==null?void 0:a.browserTouchPanEnabled},a=>{this._source.browserTouchPanningEnabled=!a},si))}_updateMode(){var s;const e=this.mode,t=this.primaryDragAction,r=(s=km.get(e))==null?void 0:s.get(t);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};h([u()],rs.prototype,"view",void 0),h([u({value:"pan"})],rs.prototype,"primaryDragAction",null),h([u({value:"default"})],rs.prototype,"mode",null),h([u({readOnly:!0})],rs.prototype,"updating",null),h([u()],rs.prototype,"latestPointerType",null),h([u()],rs.prototype,"latestPointerLocation",null),h([u()],rs.prototype,"multiTouchActive",null),h([u()],rs.prototype,"_inputManager",void 0),rs=h([N("esri.views.3d.input.SceneInputManager")],rs);const km=new Map,Ep=new Map,Ap=new Map;Ep.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Ep.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Ap.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Ap.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),km.set("default",Ep),km.set("pro",Ap);const Y4=rs;let Rr,wl,Gm=!1,jm=!1,Wm=!1,Qm=!1,Ic=null;function K4(i,e){if(!jm||!wl)return;qb();const t=wl;let r=0;for(let s=0;s<i.accBinsNumX;s++)for(let a=0;a<i.accBinsNumY;a++){const n=i.accBins[s][i.accBinsNumY-1-a];r+=n.length;const o=s*i.accBinsSizeX,l=(s+1)*i.accBinsSizeX,c=a*i.accBinsSizeY,d=(a+1)*i.accBinsSizeY;t.fillText(n.length.toFixed(),o+5,c+15),Bb(o,l,c,d,"blue")}t.fillText("total totalShownLabels: "+r,70,40),t.fillText("total visible labels: "+e.size,70,50),t.fillText("total numTests: "+i.accNumTests,70,30)}function J4(i){Wm=ki.DECONFLICTOR_SHOW_VISIBLE,Qm=ki.DECONFLICTOR_SHOW_INVISIBLE,Gm=Wm||Qm,jm=ki.DECONFLICTOR_SHOW_GRID,Ic=null,Gm||jm?Ic=()=>eO(i):Rr&&(Rr.parentElement.removeChild(Rr),Rr=null)}function qb(){Ic&&(Ic(),Ic=null)}function eO(i){Rr==null&&(Rr=document.createElement("canvas"),Rr.setAttribute("id","debugCanvas2d"),i.surface.parentElement.style.position="relative",i.surface.parentElement.appendChild(Rr));const{state:e}=i,{camera:t,pixelRatio:r}=e,{width:s,height:a}=t,n=s*r,o=a*r;Rr.setAttribute("width",`${n}px`),Rr.setAttribute("height",`${o}px`),Rr.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${a}px`),wl=Rr.getContext("2d"),wl.clearRect(0,0,s,a),wl.font="12px Arial"}function Bb(i,e,t,r,s){qb();const a=Rr.height,n=wl;n.beginPath(),n.lineWidth=1,n.strokeStyle=s,n.moveTo(i,a-t),n.lineTo(e,a-t),n.stroke(),n.lineTo(e,a-r),n.stroke(),n.lineTo(e,a-t),n.stroke(),n.lineTo(i,a-t),n.stroke(),n.lineTo(i,a-t),n.stroke(),n.closePath()}function tO(i,e){Gm&&(e&&Wm||!e&&Qm)&&Bb(i.aabr[0],i.aabr[2],i.aabr[1],i.aabr[3],e?"green":"red")}const Ss=b(),Fo=gi(),Zl=gi(),Mp=b(),iO=nt(),rO=ta(),Dp=$l(),sO=b(),aO=Yt();class nO{constructor(){this.aabr=Yt(),this.distance=0,this.culled=!1,this.visible=!1}}class oO{constructor(e,t){this.graphics3DGraphic=e,this.slicePlaneEnabled=t,this.info={}}}var ur;(function(i){i[i.Idle=0]="Idle",i[i.Process=1]="Process",i[i.Sort=2]="Sort",i[i.Deconflict=3]="Deconflict",i[i.NumStates=4]="NumStates"})(ur||(ur={}));class Hb{constructor(){this.camera=new gt,this.slicePlane=Mu(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),w_(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let cl=class extends ue{get dirty(){return this._dirty}get state(){return this._state}constructor(i){super(i),this._dirty=!1,this._runningViewState=new Hb,this._state=ur.Idle,this._active=new Map,this._visible=new Map,this._iterators=new dO,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ur.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const i=this._state/ur.NumStates;return this._dirty?.5*i:i}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(i){switch(this._state){case ur.Idle:this._startUpdate(),i.madeProgress();case ur.Process:if(this._state=ur.Process,!this._processActiveGraphics(i))return;case ur.Sort:if(this._state=ur.Sort,!this._sortVisibleGraphics(i))return;case ur.Deconflict:if(this._state=ur.Deconflict,!this._deconflictVisibleGraphics(i))return;default:K4(this,this._visible),this._state=ur.Idle,this.notifyChange("updating")}}modifyGraphics(i,e){e?i.forEach(t=>this.addToActiveGraphics(t)):i.forEach(t=>this.removeFromActiveGraphics(t)),this.setDirty()}layerSupportsDeconfliction(i){if(i==null||i.type!=="object3d")return!1;const e=i.stageObject;if(((e==null?void 0:e.geometries.length)??0)!==1)return!1;const t=e==null?void 0:e.geometries[0];return(t==null?void 0:t.material)instanceof Vv}_startUpdate(){J4(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:i,fullHeight:e}=this._runningViewState.camera;this._initBins(i,e),this._resetIterators()}addToActiveGraphics(i){i.info[this.visibilityGroup]=new nO,this._active.set(i.graphics3DGraphic.graphic.uid,i),this.setDirty()}removeFromActiveGraphics(i){this._visible.delete(i.graphics3DGraphic.graphic.uid),lO(i,this.visibilityGroup),delete i.info[this.visibilityGroup],this._active.delete(i.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(i){const e=this._ensureActiveGraphicsIterator(),t=Tu(iO,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?rO:null;let s=0;for(r!=null&&(Zt(r,Ea,this._runningViewState.camera.viewMatrix),r[3]=Tt(this.view.spatialReference).radius,s=Xx(r,Ea));!i.done;){i.madeProgress();const a=e.next();if(a.done===!0)return this._resetActiveGraphicsIterator(),!0;const n=a.value,o=n==null?void 0:n.info[this.visibilityGroup];o&&(this._collectGraphics3DGraphics(n,t,r,s),o.culled?this._visible.delete(n.graphics3DGraphic.graphic.uid):this._visible.set(n.graphics3DGraphic.graphic.uid,n))}return!1}_sortVisibleGraphics(i){const e=this._ensureSortGraphicsIterator();for(;!i.done;){const t=e.next();if(i.madeProgress(),t.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(i){const e=this._ensureVisibleGraphicsIterator(),t=this.visibilityGroup===Br.LABEL;for(;!i.done;){i.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,a=s.info[this.visibilityGroup];if(!a||a.culled){this._setGraphicVisibility(s,!1);continue}const n=s.graphics3DGraphic,o=!t||n.isVisible();a.visible=o&&!this._isConflicted(s),a.visible&&this._addToBins(s),this._setGraphicVisibility(s,a.visible),tO(a,a.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=M0(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=M0(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=cO(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(i,e,t,r){const s=i.graphics3DGraphic;if(s.destroyed)return;const a=i.info[this.visibilityGroup];if(!s.isVisible(Br.GRAPHIC,fs.DECONFLICTION))return void(a.culled=!0);const n=this.getGraphicsLayers(s);ia(a.aabr);let o=null;for(const l of n){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(o==null&&(o=mO,this._getProjectionInfo(l,e,o),o.isOutsideScreen||this._isCulledBySlice(i,Ss)||t!=null&&this._isCulledByHorizon(o,t,r)))return void(a.culled=!0);this._expandBoundingRect(a,l,c,o)}o==null?a.culled=!0:(a.distance=o.distance,a.culled=!1)}_getProjectionInfo(i,e,t){const r=this._runningViewState.camera,s=i.stageObject,a=s.geometries[0],n=a.material,o=Sy(s.boundingVolumeWorldSpace.bounds);Zt(Ss,o,r.viewMatrix);const l=a.attributes,c=l.get(se.NORMAL).data,d=l.get(se.AUXPOS1).data;n.applyShaderOffsetsView(Ss,c,s.transformation,d,r,t.scaleInfo,Ss),Va(Fo,Ss[0],Ss[1],Ss[2],1),hm(Zl,Fo,r.projectionMatrix),J(t.positionNDC,Zl,1/Zl[3]),n.applyShaderOffsetsNDC(t.positionNDC,d,r,t.positionNDC,Mp),t.distanceWithoutPolygonOffset=r.depthNDCToWorld(Mp[2]),t.distance=Mp[2]===t.positionNDC[2]?t.distanceWithoutPolygonOffset:r.depthNDCToWorld(t.positionNDC[2]),Va(Zl,t.positionNDC[0],t.positionNDC[1],t.positionNDC[2],1),hm(Fo,Zl,e),Ry(Fo,Fo,1/Fo[3]),Xt(t.positionView,Ss[0],Ss[1],Ss[2])}_isCulledByHorizon(i,e,t){return ae(Dp.direction,i.positionView),Xt(Dp.origin,0,0,0),!!Pu(e,Dp,sO)&&i.distanceWithoutPolygonOffset>t}_isCulledBySlice(i,e){return i.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&PT(this._runningViewState.slicePlane,e)}_expandBoundingRect(i,e,t,{positionNDC:r,scaleInfo:s}){const a=this._runningViewState.camera,n=e.getScreenSize(uO);$3(n,s.factor,n),n[0]*=a.pixelRatio,n[1]*=a.pixelRatio;const o=Oy(t.calculateRelativeScreenBounds(n,s.factorAlignment.scale,aO),He(0,a.fullWidth,.5+.5*r[0]),He(0,a.fullHeight,.5+.5*r[1])),l=this.marginFactor;if(l!==0){const c=l*Math.min(Yn(o),Wc(o));o[0]-=c,o[1]-=c,o[2]+=c,o[3]+=c}mn(i.aabr,o,i.aabr)}_isConflicted(i){const e=i.graphics3DGraphic.graphic.uid,t=i.info[this.visibilityGroup];let r=!0;for(let s=Math.floor(t.aabr[0]/this._accBinsSizeX);s<=Math.floor(t.aabr[2]/this._accBinsSizeX);s++)if(!(s<0||s>=this._accBinsNumX))for(let a=Math.floor(t.aabr[1]/this._accBinsSizeY);a<=Math.floor(t.aabr[3]/this._accBinsSizeY);a++){if(a<0||a>=this._accBinsNumY)continue;r=!1;const n=this._accBins[s][a];for(let o=0;o<n.length;o++){const l=n.data[o],c=l.info[this.visibilityGroup];if(c&&c.visible&&l.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,Eu(c.aabr,t.aabr)))return!0}}return r}_initBins(i,e){if(this._accBins==null){this._accBins=[];for(let t=0;t<this._accBinsNumX;t++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let s=0;s<this._accBinsNumY;s++)r.push(new Et)}}else for(let t=0;t<this._accBinsNumX;t++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[t][r].clear();this._accBinsSizeX=i/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(i){const e=i.info[this.visibilityGroup],t=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),s=Math.floor(e.aabr[1]/this._accBinsSizeY),a=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let n=t;n<=r;n++)if(!(n<0||n>=this._accBinsNumX))for(let o=s;o<=a;o++)o<0||o>=this._accBinsNumY||this._accBins[n][o].push(i)}_setGraphicVisibility(i,e){const t=i.graphics3DGraphic;t.destroyed||(t.setVisibilityFlag(this.visibilityGroup,fs.DECONFLICTION,e),this.visibilityGroup===Br.LABEL&&this.view.labeler.setLabelGraphicVisibility(t,e))}};function lO(i,e){const t=i.graphics3DGraphic;t.destroyed||t.setVisibilityFlag(e,fs.DECONFLICTION,!0)}function*M0(i){if(Map.prototype.entries){const e=i.entries();for(let t=e.next();!t.done;t=e.next())yield t.value[1]}else yield*i.values()}function*cO(i,e,t){e.clear(),i.forEach((s,a)=>{var l;const n=e.pushNew();n.id=a,n.visible=s.graphics3DGraphic.getVisibilityFlag(t,fs.DECONFLICTION);const o=(l=s.info)==null?void 0:l[t];n.prio=s.graphics3DGraphic.deconflictionPriority,n.distance=o?o.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((s,a)=>s.prio!==a.prio?a.prio-s.prio:s.distance!==a.distance?s.distance-a.distance:s.visible!==a.visible?s.visible?-1:1:s.id-a.id);for(let s=r.next();!s.done;s=r.next())yield;e.forAll(s=>{const a=i.get(s.id);a&&(i.delete(s.id),i.set(s.id,a))}),e.clear()}h([u({constructOnly:!0})],cl.prototype,"view",void 0),h([u({type:Boolean,readOnly:!0})],cl.prototype,"updating",null),cl=h([N("esri.views.3d.layers.graphics.Deconflictor")],cl);class hO{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class dO{constructor(e=null,t=null,r=null){this.active=e,this.visible=t,this.sort=r,this.sortArray=new Et({allocator:s=>s||new hO})}}const uO=yi();class pO{constructor(){this.positionView=b(),this.positionNDC=b(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new CP}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const mO=new pO,_O=2e3;let Ed=class extends cl{constructor(e){super(e),this.visibilityGroup=Br.LABEL,this.marginFactor=.05,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return yr.YIELD;const t=performance.now();if(e.state!==Ui.IDLE&&t-this._lastDeconfliction<_O)return yr.YIELD;super.runTask(e),this.state===ur.Idle&&(this._lastDeconfliction=t)}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};h([u({constructOnly:!0})],Ed.prototype,"parent",void 0),Ed=h([N("esri.views.3d.layers.graphics.LabelDeconflictor")],Ed);let Zm=class extends cl{constructor(){super(...arguments),this._contexts=new Map,this._viewState=new Hb,this.visibilityGroup=Br.GRAPHIC,this._marginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this.addHandles([D(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),D(()=>{var e,t,r;return(r=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:r.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),D(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},si)]),this._frameTask=this.view.resourceController.scheduler.registerTask(ci.GRAPHICS_DECONFLICTOR,this),this._labels=new Ed({view:this.view,parent:this})}destroy(){this._labels=re(this._labels),this._frameTask=Fa(this._frameTask)}get marginFactor(){return this._marginFactor}set marginFactor(e){this._marginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const r=!(this._graphicSupportsDeconfliction(t)&&Lp(e));t.setVisibilityFlag(Br.GRAPHIC,fs.DECONFLICTION,r)}_updateViewState(){var e;(e=this.view)!=null&&e.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&ST(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Gd(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const t=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,t,r),removeGraphic:r=>this._removeGraphic(t,r),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,r){const s=r.graphic.uid,a=new oO(r,e.symbolCreationContext.slicePlaneEnabled);t.set(s,a),Lp(e)&&this.addToActiveGraphics(a),e.labelsEnabled&&this._labels.addToActiveGraphics(a)}_removeGraphic(e,t){const r=t.graphic.uid,s=e.get(r);s&&(this.removeFromActiveGraphics(s),this._labels.removeFromActiveGraphics(s),e.delete(r),this.setDirty())}enabledChanged(e,t){const r=Lp(e);r||gO(e),this.modifyGraphics(t,r)}_slicePlaneEnabledChanged(e,t){const r=e.symbolCreationContext.slicePlaneEnabled;t.forEach(s=>s.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.layers;if(!(t!=null&&t.length))return!1;for(const r of t)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const t=this._contexts.get(e);if(t)return t;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function Lp(i){const e=i.layer;return!(!(e!=null&&e.featureReduction)||e.featureReduction.type!=="selection")}function gO(i){const e=i.graphics3DGraphics;e&&e.forEach(t=>t.setVisibilityFlag(Br.GRAPHIC,fs.DECONFLICTION,!0))}Zm=h([N("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Zm);function eg(i){return i instanceof cT?i.graphics3DSymbol:i instanceof hT?i:null}const lh=ce.getLogger("esri.views.3d.layers.graphics.labelPlacement");let fO=class{constructor(e,t,r,s=null){this.graphics3DGraphic=e,this.labelSymbol=t,this.labelClass=r,this.disablePlacement=s}};function D0(i){const e=SO(i);if(e==null)return null;const t=yO(i,e);if(t==null)return null;const r=t.anchor,s=!!e.hasLabelVerticalOffset,a=e.verticalOffset;return bO(new dT(a,r,s),t,i)}function yO(i,e){if(e.anchor)return e;const t=i.labelClass.labelPlacement,r=ys[t],s=r||yu(i);return t&&!r&&lh.warnOncePerTick(`the requested label placement '${t}' is currently unsupported in SceneView.`),vO(s,i)}function tg(i){const e=i.graphics3DGraphic.graphics3DSymbol,t=eg(e);return t!=null?t.symbol.symbolLayers.at(0):null}function vO(i,e){const t=e.graphics3DGraphic.graphic.geometry;if(t==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(lh.warnOncePerTick(L0(i==null?void 0:i.placement,e.disablePlacement.logEntityDescription)),yu(e)):i;const r=t.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return lh.warnOncePerTick(L0(i==null?void 0:i.placement,`'${r}' geometries`)),yu(e);break;case"point":case"mesh":return i}return i}function L0(i,e){return`the requested label placement '${i}' is currently unsupported for ${e} in SceneView.`}function yu(i){const e=i.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:Ea,anchor:"center"};case"polygon":{const t=tg(i);return t!=null&&t.type==="extrude"?ys["above-center"]:{placement:"center-center",normalizedOffset:Ea,anchor:"center"}}case"point":case"mesh":return ys["above-center"];default:return}}function bO(i,e,t){const r=t.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":xO(i,e,t);break;case"polygon":wO(i,e,t);break;case"mesh":ig(i,e,t.graphics3DGraphic.layers[0])}const s=uT-pT;return i.screenOffset[0]+=s*e.normalizedOffset[0],i.screenOffset[1]+=s*e.normalizedOffset[1],i}function wO(i,e,t){const r=tg(t);if(r!=null)switch(r.type){case"extrude":{const s=t.graphics3DGraphic.layers[0];s!=null?(s.getBoundingBoxObjectSpace(Nc),Yx(Nc,i.translation),i.translation[2]=Kx(Nc)/2):Xt(i.translation,0,0,0),ig(i,e,s);break}}}function xO(i,e,t){const r=tg(t);if(r==null)return;const s=t.graphics3DGraphic.layers[0];switch(s!=null?s.getCenterObjectSpace(i.translation):Xt(i.translation,0,0,0),r.type){case"icon":case"text":TO(i,e,t,s);break;case"object":ig(i,e,s)}}function TO(i,e,t,r){const{graphics3DGraphic:s}=t,a=r!=null?r.getScreenSize():null;if(s.isDraped||a==null)i.hasLabelVerticalOffset||i.anchor==="center"||(ys[t.labelClass.labelPlacement]&&lh.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),i.anchor="center");else{const n=CO(t);i.screenOffset[0]=a[0]/2*(e.normalizedOffset[0]-n[0]);const o=a[1]/2*(e.normalizedOffset[1]-n[1]);i.hasLabelVerticalOffset?(i.centerOffset[1]=o,i.centerOffsetUnits="screen"):i.screenOffset[1]=o}}function CO(i,e=RO){const{graphics3DGraphic:t}=i,r=t.layers[0],s=(r==null?void 0:r.stageObject.geometries[0].material)??null;if(s&&s instanceof Vv){const a=s.parameters.anchorPosition;e[0]=2*(a[0]-.5),e[1]=2*(a[1]-.5)}else e[0]=0,e[1]=0;return e}function ig(i,e,t){const r=t!=null?t.getBoundingBoxObjectSpace(Nc):Nc,s=ft(r[3]-r[0],r[4]-r[1],r[5]-r[2]),a=Math.sqrt(s[0]*s[0]+s[1]*s[1]);i.centerOffset[0]=a/2*e.normalizedOffset[0];const n=i.translation[2],o=s[2]/2*e.normalizedOffset[1];i.translation[2]=0,i.elevationOffset=n+o;const l=ve(s);i.centerOffset[2]=l/2*e.normalizedOffset[2]}function PO(i){return i==="above-center"}function SO(i){const e=i.labelClass.labelPlacement,{labelSymbol:t,graphics3DGraphic:r}=i,s=eg(r.graphics3DSymbol),a=(s==null?void 0:s.symbol.type)==="point-3d"?s.symbol:null,n=ys[e]||yu(i);return a!=null&&a.supportsCallout()&&a.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:$0(a.verticalOffset),anchor:null,normalizedOffset:null}:!t||!t.hasVisibleVerticalOffset()||a!=null&&a.supportsCallout()&&a.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:n&&PO(n.placement)?{placement:"above-center",verticalOffset:$0(t.verticalOffset),anchor:"bottom",normalizedOffset:[0,n.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(lh.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function $0(i){const{screenLength:e,minWorldLength:t,maxWorldLength:r}=i;return{screenLength:e,minWorldLength:t,maxWorldLength:r}}const ys={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},I0={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const i in I0){const e=I0[i],t=ys[i];e.forEach(r=>{ys[r]=t})}Object.freeze&&(Object.freeze(ys),Object.keys(ys).forEach(i=>{var e;Object.freeze(ys[i]),Object.freeze((e=ys[i])==null?void 0:e.normalizedOffset)}));const RO=[0,0],Nc=g_();let N0=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,t){this._materials.set(e,t),this._stage.add(t)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}},F0=class{constructor(e,t){this.labelingContext=e,this.graphics3DGraphic=t,this.hasGraphics3DResources=!1,this.visible=!1,this.addedToTextureAtlas=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},OO=class{constructor(e,t,r,s,a){this.labelClass=e,this.graphics3DSymbol=t,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=s,this.labelFunction=a,this.calloutSymbolLayerIndex=0}},EO=class{constructor(e,t,r,s,a,n,o,l){this.layer=t,this.graphics3DCore=r,this.scaleVisibility=s,this.emptySymbolLabelSupported=a,this.elevationInfoOverride=n,this.disablePlacement=o,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new h3(e,{pickable:!0,disableOctree:!0},t.uid)}destroy(){this.stageLayer.destroy()}},Qn=class extends ue{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this.addHandles([D(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),D(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(ci.LABELER,this)]),this._textTextureAtlas=new Xg({view:this.view}),this._hudMaterialCollection=new N0(this.view._stage),this._calloutMaterialCollection=new N0(this.view._stage)}dispose(){this.removeAllHandles(),this._textTextureAtlas=De(this._textTextureAtlas),this._hudMaterialCollection=De(this._hudMaterialCollection),this._calloutMaterialCollection=De(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear()}destroy(){this.dispose(),es.graphic=null,es.renderingInfo=null,es.layer=null}_activateLabelingContext(e){e.graphics.forEach((t,r)=>{const s=new F0(e,t);this._labels.set(r,s),e.labelsToInitialize.set(r,s),t.setVisibilityFlag(Br.LABEL,fs.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((t,r)=>{t.setVisibilityFlag(Br.LABEL,fs.USER,!1),this.setLabelGraphicVisibility(t,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r&&(this._textTextureAtlas.addTextTexture(r,t.stageObject),e.addedToTextureAtlas=!0)}}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelLayers){if(!t._labelClass)continue;const r=e.textRenderers[t._labelIndex];r!=null&&(this._textTextureAtlas.removeTextTexture(r,t.stageObject),e.addedToTextureAtlas=!1)}}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),yr.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(t.active)if($p(t))this._dirty=!0;else if(Ip(t.labelClassContexts)){if(t.labelClassContexts===null){this._deactivateLabelingContext(t);continue}this._createLabelClassContext(t),this._dirty=!0}else Gd(t.labelsToInitialize,(r,s)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(s,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(t.labelsToInitialize.delete(s),e.madeProgress()),e.done))&&(this._dirty=!0);this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var n,o;const t=(n=e.labelClassAbortController)==null?void 0:n.signal;e.layer.when&&await e.layer.when(),fr(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,s=r.layer,a=(o=s.labelingInfo)==null?void 0:o.filter(l=>!!l.symbol);!a||a.length===0||(await Jx(a,async(l,c)=>{const d=l.symbol,p=eg(r.getOrCreateGraphics3DSymbol(d));if(p==null)return void ce.getLogger(this).error("Failed to create Graphics3DSymbol for label");await p.load(),fr(t);let m=null;e2(d)&&d.hasVisibleCallout()&&(m=mT(d,r.symbolCreationContext),await m.load(),fr(t));const g=await t2(SP(l,e.layer.fieldsIndex,this.view.spatialReference));if(fr(t),g.ok===!0){const f=await this._createTextRenderParameters(p.symbol);fr(t),e.labelClassContexts[c]=new OO(l,p,m,f,g.value)}else ce.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),fr(t))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(yn(t))throw t;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.at(0);return(t==null?void 0:t.type)!=="text"?null:_T.fromSymbol(t,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,wo(t),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,r,s,a,n){const o=new gT(r,Yg(r.anchor),fT(r.anchor),e.text,Cu(e.displayWidth,e.displayHeight));return es.graphic=t,es.renderingInfo=null,es.layer=s,a.createLabel(es,o,this._hudMaterialCollection,this._textTextureAtlas,()=>{const l=D0(n);return l?l.elevationOffset:null})}_createLineCalloutGraphic(e,t,r,s,a){es.graphic=e,es.layer=a;const n=s.screenOffset[0];return es.renderingInfo=new yT(null,t,s.translation,s.centerOffset,n,s.centerOffsetUnits,s.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(es)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,s=r.labelClassContexts;if(Ip(s)||!r.emptySymbolLabelSupported&&t.layers.length===0)return!1;let a=!1;const n=t.graphic,o=r.layer,l=Xh(r.layer);for(let d=0;d<s.length;d++){const p=e.textRenderers[d],m=e.textLabelPlacements[d];if(p==null||m==null)continue;const g=s[d],f=g.graphics3DSymbol,y=f.symbol&&f.symbol.type==="label-3d"?f.symbol:null,v=f.symbolLayers[0];if(!v)continue;v.setElevationInfoOverride(r.elevationInfoOverride);const T=new fO(t,y,g.labelClass),w=this._createTextSymbolGraphic(p,n,m,o,v,T);if(w==null)return!1;w._labelClass=g.labelClass,w._labelIndex=d,t.addLabelGraphic(w,r.stageLayer),t.deconflictionPriority=((c=g.textRenderParameters)==null?void 0:c.definition.size)??0,t.setVisibilityFlag(Br.LABEL,fs.USER,l),t.setVisibilityFlag(Br.LABEL,fs.SCALE_RANGE,!0),t.setVisibilityFlag(Br.LABEL,fs.DECONFLICTION,!1),a=!0;const x=g.graphics3DCalloutSymbolLayer;if(x&&m.hasLabelVerticalOffset){x.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(n,y,x,m,o);C!=null&&(g.calloutSymbolLayerIndex=t.labelLayers.length,t.addLabelGraphic(C,r.stageLayer))}break}return r.scaleVisibility&&a&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const s=t[r._labelIndex].graphics3DSymbol.symbolLayers[0];s==null||s.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var a;if(e.textInitialized)return;const t=e.labelingContext,r=t.labelClassContexts;if(Ip(r))return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(e.textRenderers[n]=null,e.textLabelPlacements[n]=null,(o==null?void 0:o.textRenderParameters)==null)continue;const l=o.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?PP(s,t.layer):s;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(s);if(c==null||c===""||/^\s+$/.test(c))continue;const d=o.graphics3DSymbol,p=((a=d.symbol)==null?void 0:a.type)==="label-3d"?d.symbol:null;if(!d.symbolLayers[0])continue;const m=e.graphics3DGraphic,g=o.labelClass,f=t.disablePlacement,y=D0({graphics3DGraphic:m,labelSymbol:p,labelClass:g,disablePlacement:f});if(y==null)continue;const v=Yg(y.anchor),T=vT(v);e.textRenderers[n]=new bT(c,T,o.textRenderParameters,Xg.maxSize),e.textLabelPlacements[n]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,t){const r=t.graphic.uid;if(e.graphics.set(r,t),e.active){const s=new F0(e,t);this._labels.set(r,s),e.labelsToInitialize.set(r,s)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const r=t.graphic.uid,s=this._labels.get(r);e.graphics.delete(r),s&&(this._destroyGraphic(s,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.delete(t),e.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of t){const s=e.graphics.get(r);s&&(this._removeGraphic(e,s),this._addGraphic(e,s))}}_globalPropertyChanged(e,t){for(const r of t.labelClassContexts){const s=new Map;t.graphics.forEach(n=>s.set(n.graphic.uid,n));const a=n=>n.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,s,a),r.graphics3DCalloutSymbolLayer){const n=o=>o.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,s,n)}}}_visibilityInfoChange(e){const t=Xh(e.layer);t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((t,r)=>{const s=this._labels.get(r);s&&(this._destroyGraphic(s,r),s.visible=!1,e.labelsToInitialize.set(r,s))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,r){const s=r&&r.emptySymbolLabelSupported||!1,a=(r==null?void 0:r.elevationInfoOverride)||null,n=(r==null?void 0:r.disablePlacement)||null;if(this._findLabelingContext(e))return;const o=e.layer,l=new EO(this.view._stage,o,e,t,s,a,n,Xh(o));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>Xh(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const r=this._labelingContexts.indexOf(t);this._labelingContexts.splice(r,1),t.graphics.forEach(s=>this._removeGraphic(t,s)),t.destroy(),this.setDirty()}setLabelGraphicVisibility(e,t){const r=e.graphic.uid,s=this._labels.get(r);s&&s.visible!==t&&(t&&!s.addedToTextureAtlas?(this._addLabelTextureToAtlas(s),s.textInitialized||s.labelingContext.labelsToInitialize.set(r,s)):!t&&s.addedToTextureAtlas&&this._removeLabelTextureFromAtlas(s),s.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>$p(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,r)=>t+($p(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function $p(i){return!!i.labelClassPromise&&!!i.labelClassAbortController}function Ip(i){return!i||i.length===0}function Xh(i){var e;return i.labelsVisible===!0&&!!((e=i.labelingInfo)!=null&&e.some(t=>!!t.symbol))}h([u({constructOnly:!0})],Qn.prototype,"view",void 0),h([u({constructOnly:!0})],Qn.prototype,"deconflictor",void 0),h([u()],Qn.prototype,"_textTextureAtlas",void 0),h([u({type:Boolean,readOnly:!0})],Qn.prototype,"updating",null),Qn=h([N("esri.views.3d.layers.graphics.Labeler")],Qn);const es=new wT(null,null,null);let AO=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new nn(e),this._extendedFrustum=new nn(e),this._intersector=new xT({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,t){this._surfaceElevation=t,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>t,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return mr.INVISIBLE;const t=this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]>=MO&&e.lij[0]<DO,r=this._getOrCalculateSingleTileVisibility(e,!t);return r!==mr.INVISIBLE&&t?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const t=nn.nearFarLineIndices,r=e.mutablePoints;for(const s of t){const[a,n]=s,o=r[a],l=r[n];pe(wr,l,o),J(wr,wr,$O),me(r[n],o,wr)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let t=mr.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const s=q0.acquire();e.getChildren(s);for(const a of s){const n=this.calculate(a);if(n!==mr.INVISIBLE&&(t=n,n===mr.VISIBLE_ON_SURFACE))break}return q0.release(s),this._cache.set(e.id,t),t}_getOrCalculateSingleTileVisibility(e,t){const r=this._cache.get(e.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(e);return t&&this._cache.set(e.id,s),s}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ne.Global&&e.lij[0]<LO?this._calculateSingleTileVisibilitySided(e,!1)===mr.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,t){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,t);const r=Tt(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?mr.VISIBLE_ON_SURFACE:mr.VISIBLE_WHEN_EXTENDED:mr.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const t=this._renderCoordsHelper.worldUpAtPosition(e.eye,wr);this._aboveGround||pn(t,t);const r=ea(-Ie(t,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),a=this._extendedFrustum.mutablePoints;for(let n=0;n<4;n++){const o=s.pointIndices[n],l=a[o],c=this._renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,wr),o){case pt.FAR_BOTTOM_LEFT:case pt.FAR_TOP_LEFT:case pt.NEAR_BOTTOM_LEFT:case pt.NEAR_TOP_LEFT:Lg(this._extendedFrustum.planes[fl.LEFT],wr,wr);break;case pt.FAR_BOTTOM_RIGHT:case pt.FAR_TOP_RIGHT:case pt.NEAR_BOTTOM_RIGHT:case pt.NEAR_TOP_RIGHT:Lg(this._extendedFrustum.planes[fl.RIGHT],wr,wr)}J(wr,wr,s.direction),this._renderCoordsHelper.intersectInfiniteManifold(uo(l,wr),s.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(a),$g(a[pt.NEAR_BOTTOM_LEFT],a[pt.NEAR_BOTTOM_RIGHT],a[pt.NEAR_TOP_RIGHT],U0),$g(a[pt.NEAR_BOTTOM_RIGHT],a[pt.NEAR_TOP_RIGHT],a[pt.NEAR_TOP_LEFT],z0),Ie(Pl(U0),Pl(z0))<0){const n=this._extendedFrustum.mutablePoints;this._aboveGround?[n[pt.NEAR_BOTTOM_LEFT],n[pt.NEAR_BOTTOM_RIGHT]]=[n[pt.NEAR_BOTTOM_RIGHT],n[pt.NEAR_BOTTOM_LEFT]]:[n[pt.NEAR_TOP_LEFT],n[pt.NEAR_TOP_RIGHT]]=[n[pt.NEAR_TOP_RIGHT],n[pt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(n)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-V0;return{zWithMargin:e,pointIndices:nn.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:t=>t>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+V0;return{zWithMargin:e,pointIndices:nn.planePointIndices.top,direction:1,needsAltitudeAdjustment:t=>t<e}}};const MO=2,DO=6,LO=12,$O=.95,V0=1,wr=b(),U0=mo(),z0=mo(),q0=new bn(Array,i=>{i.length!==4&&(i[0]=new oc,i[1]=new oc,i[2]=new oc,i[3]=new oc)},i=>{i[0].release(),i[1].release(),i[2].release(),i[3].release()});let IO=class{constructor(e){this._camera=new gt,this._focusOnMap=[0,0],this._screenRect=Yt(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new AO(e.renderCoordsHelper)}begin(e,t,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=t.x,this._focusOnMap[1]=t.y,Ey(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=i2(e.extent,this._focusOnMap),e.measures.visibility!==mr.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const t=NO,r=1<<t,s=e.measures.screenRect;ia(s);let a=0;const n=e.lij[0]+t,o=e.lij[1]<<t,l=e.lij[2]<<t,c=this._tileSizeWithBias(e),d=c*c;for(let p=0;p<r;p++)for(let m=0;m<r;m++)if(a+=this._computeScreenArea(e,n,o+p,l+m,s),a>d)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===mr.VISIBLE_WHEN_EXTENDED?this._tileSize*FO:this._tileSize}_computeScreenArea(e,t,r,s,a){const n=e.measures.visibility===mr.VISIBLE_WHEN_EXTENDED;this._projectToScreen(t,r,s,n,Qa),ia(Np);for(let o=0;o<4;o++)Ay(Np,Qa[o]);return mn(a,Np,a),Ig(Qa[0],Qa[1],Qa[2])+Ig(Qa[0],Qa[2],Qa[3])}_projectToScreen(e,t,r,s,a){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,t,r,Xl),this._toRenderCoords(Xl,0,3,Za[0]),this._toRenderCoords(Xl,2,3,Za[1]),this._toRenderCoords(Xl,2,1,Za[2]),this._toRenderCoords(Xl,0,1,Za[3]),s&&(this._projectToPlane(Za,this._camera.frustum[fl.NEAR]),this._projectToPlane(Za,this._camera.frustum[fl.TOP]),this._projectToPlane(Za,this._camera.frustum[fl.BOTTOM]));for(let n=0;n<4;n++)this._camera.projectToRenderScreen(Za[n],B0),this._camera.renderToScreen(B0,a[n])}_projectToPlane(e,t){for(let s=0;s<4;s++)Kl[s]=dm(t,e[s]);const r=Math.max(Kl[0],Kl[1],Kl[2],Kl[3]);if(r>0){const s=J(Yl,Pl(t),-r);for(let a=0;a<4;a++)me(e[a],e[a],s)}}_toRenderCoords(e,t,r,s){return Yl[0]=e[t],Yl[1]=e[r],Yl[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(Yl,this._tilingScheme.spatialReference,s),s}};const Np=Yt(),NO=2,FO=5,Qa=[Dt(),Dt(),Dt(),Dt()],Xl=Yt(),Yl=b(),Za=[b(),b(),b(),b()],Kl=[0,0,0,0],B0=mh();let pi=class extends ue{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ce.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||t!=null&&e&&t.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=Yt();return ky(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new ho,this.tileSize=512,this._idToTile=new Map,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new Et}initialize(){this.addHandles([D(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),at),D(()=>{var e,t,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),yt)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(ci.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Fa(this._frameWorker)}addClient(){const e=r2();return this._clients.add(e),this._clients.size===1&&this._setDirty(),dn(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Bs))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=ci.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=ci.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new IO({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(t=>new oc(t[0],t[1],t[2],e))}_purgeHorizonTiles(e){e.sort((t,r)=>{const s=t.measures.screenRect,a=r.measures.screenRect;return s[1]+s[3]-(a[1]+a[3])}),ia(Yh);for(let t=0;t<e.length;t++)if(mn(Yh,e.data[t].measures.screenRect,Yh),Wc(Yh)>VO)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:t}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!Eu(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==mr.INVISIBLE&&(r.measures.shouldSplit?(t.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const s of this.tiles.items)s.used=!1;const t=e.filter(s=>{const a=this._idToTile.get(s.id);return a?(a.copyMeasurementsFrom(s),a.used=!0):this._idToTile.set(s.id,s),!a}),r=this.tiles.items.filter(s=>!s.used&&(this._idToTile.delete(s.id),!0));this.tiles.removeMany(r),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===mr.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};h([u({constructOnly:!0})],pi.prototype,"scheduler",void 0),h([u({constructOnly:!0})],pi.prototype,"renderCoordsHelper",void 0),h([u({constructOnly:!0})],pi.prototype,"tilingSchemeOwner",void 0),h([u({constructOnly:!0})],pi.prototype,"cameraOnSurface",void 0),h([u({constructOnly:!0})],pi.prototype,"focus",void 0),h([u({constructOnly:!0})],pi.prototype,"viewState",void 0),h([u({constructOnly:!0})],pi.prototype,"terrain",void 0),h([u()],pi.prototype,"tiles",void 0),h([u()],pi.prototype,"tileSize",void 0),h([u({readOnly:!0})],pi.prototype,"tilingScheme",null),h([u()],pi.prototype,"filterExtent",null),h([u({readOnly:!0})],pi.prototype,"_filterExtentRect",null),h([u({readOnly:!0})],pi.prototype,"_rootTileIds",null),h([u({value:!1})],pi.prototype,"suspended",null),h([u({readOnly:!0})],pi.prototype,"updating",null),pi=h([N("esri.views.3d.layers.support.FeatureTileTree3D")],pi);const Yh=Yt(),VO=10;let St=class extends ue{constructor(){super(...arguments),this._propertiesPool=new Tn({camera:gt},this),this._lastSeenCameraProjectionValues=new gt,this.mode=Ui.ANIMATING,this._cssCamera=new gt,this._camera=new gt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new Xr,this.viewingMode=Ne.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new _a({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Tn({camera:gt},this)}destroy(){var e;this.cameraController=null,(e=this._propertiesPool)==null||e.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ne.Global){const e=Tt(this.spatialReference).radius;this.camera=new gt({eye:ft(4*e,0,0),center:ft(e,0,0),up:ft(0,0,1)})}else this.camera=new gt({eye:ft(0,0,100),center:ft(0,0,0),up:ft(0,1,0)})}get animation(){return this.cameraController instanceof sh&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:t,width:r,pixelRatio:s}=this.camera;return e.pixelRatio=1,e.height=Math.round(t/s),e.width=Math.round(r/s),e}set camera(e){e!==Nr&&Nr.copyFrom(e),Nr.computeUp(this.viewingMode),this.events.emit("before-camera-change",Nr);const t=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Nr)&&(this._lastSeenCameraProjectionValues.copyFrom(Nr),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!t.equals(Nr)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Nr),this._cameraChanged=!t.almostEquals(Nr),this._cameraChanged)){const r=s2(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Ui.IDLE}get updating(){return this.mode!==Ui.IDLE}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ne.Global}get isLocal(){return this.viewingMode===Ne.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var t;this.stopActiveCameraController()?((t=this.cameraController)==null||t.destroy(),e&&(this.removeHandles(H0),this.addHandles(Tl(()=>e.state===wt.Finished||e.state===wt.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),H0),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=wt.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==wt.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Nr.copyFrom(this._get("camera")),e(Nr),this.camera=Nr,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[_r.TOP]!==t.padding[_r.TOP]||e.padding[_r.RIGHT]!==t.padding[_r.RIGHT]||e.padding[_r.BOTTOM]!==t.padding[_r.BOTTOM]||e.padding[_r.LEFT]!==t.padding[_r.LEFT]}};h([u()],St.prototype,"mode",void 0),h([u({readOnly:!0,type:Ol})],St.prototype,"animation",null),h([u({type:gt})],St.prototype,"camera",null),h([u({type:gt})],St.prototype,"cssCamera",null),h([u()],St.prototype,"_cssCamera",void 0),h([u()],St.prototype,"_camera",void 0),h([u({readOnly:!0})],St.prototype,"pixelRatio",null),h([u()],St.prototype,"rasterPixelRatio",void 0),h([u()],St.prototype,"contentPixelRatio",void 0),h([u({readOnly:!0})],St.prototype,"alignPixelEnabled",null),h([u({readOnly:!0})],St.prototype,"updating",null),h([u({})],St.prototype,"_contentCamera",void 0),h([u({type:gt})],St.prototype,"contentCamera",null),h([u({readOnly:!0})],St.prototype,"fixedContentCamera",null),h([u({readOnly:!0})],St.prototype,"constraints",void 0),h([u({readOnly:!0})],St.prototype,"events",void 0),h([u({readOnly:!0})],St.prototype,"isGlobal",null),h([u({readOnly:!0})],St.prototype,"isLocal",null),h([u({readOnly:!0})],St.prototype,"viewingMode",void 0),h([u({readOnly:!0})],St.prototype,"spatialReference",void 0),h([u()],St.prototype,"navigating",null),h([u()],St.prototype,"stationary",null),h([u()],St.prototype,"_cameraChanged",void 0),h([u()],St.prototype,"cameraController",null),St=h([N("esri.views.3d.state.ViewState")],St);const UO=St,Nr=new gt,H0="ViewStateHandles";let zO=class{constructor(e,t,r){this.viewingMode=e,this._forEachLayer=t,this._view=r,this._externalIntersectionHandlers=new Et,this._tolerance=ru,this._tmpRay=$l(),this._tmpRegion=Yt(),this._validateHUDIntersector=xs(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,t,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),k0(this.viewingMode),t,r)}intersectScreenFreePointFallback(e,t,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),t,r)}intersectRayFreePointFallback(e,t,r){return this.intersectRay(e,k0(this.viewingMode),t,r)||this._intersectRayFreePointLocal(e,t)}intersectRay(e,t,r,s){return t.options.selectionMode=!1,t.options.store=Xs.MIN,this.computeIntersection(e,t,s),!!t.results.min&&t.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,t,r=.5,s=.5){return e.getRenderCenter(ed,r,s),ed[0]+=.0466,ed[1]-=.0123,Lv(e,ed,t)}intersectIntersectorScreen(e,t,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),t,r)}intersectToolIntersectorScreen(e,t,r){const s=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(s,t,r)}intersectToolIntersectorRay(e,t,r){t.options.selectionMode=!0,this.computeIntersection(e,t,r);const s=t.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||Mv(s)&&s.intersector!==va.TERRAIN||(t.options.selectionMode=!1,this.computeIntersection(e,t,r))}setTolerance(e=ru){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((t,r)=>t.type===va.TERRAIN?1:r.type===va.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((t,r)=>t.type===va.TERRAIN?1:r.type===va.TERRAIN?-1:0)}_getPickRay(e,t){const r=this._view.state.camera;return Dv(r,e,t)}_intersectRayFreePointLocal(e,t){return this.viewingMode!==Ne.Local||e==null||me(t,e.origin,ye(Rt.get(),e.direction)),!1}intersectElevationFromScreen(e,t,r=0,s=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),t,r,s)}_intersectElevation(e,t,r=0,s=null){if(e==null)return null;const a=t!=null?t.mode:"absolute-height",n=(t==null?void 0:t.offset)??0,o=a!=="on-the-ground"?n+r:0,l=o/this._view.renderCoordsHelper.unitInMeters;if(a==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,o,Jh)){const w=this._view.computeMapPointFromVec3d(Jh);return w.z??(w.z=0),w.z-=n,w}return null}const c=this._view.state.camera,d=Ng(Rt.get());c.projectToRenderScreen(e.origin,d);const p=new G0(null,this._forEachLayer),m=this._view.slicePlane,g=m!=null?xf(m):null,f=xs(this.viewingMode);f.options.store=Xs.MIN,f.options.verticalOffset=l;const y=e.origin,v=me(Rt.get(),y,e.direction);f.reset(y,v,c),f.point=d;const T=s?"type"in s&&s.type==="graphics"?w=>w.layerUid!==s.uid:w=>w.graphicUid!==s.uid:null;switch(a){case"relative-to-scene":{const w=x=>(!T||T(x))&&!!x.lastValidElevationBB;f.intersect(p.layers,d,this._tolerance,null,w),this._externalIntersectionHandlers.forAll(x=>{if(x.type===va.I3S||x.type===va.TERRAIN){const C=x.slicePlaneEnabled?g:null;x.intersect(f,C,f.rayBegin,f.rayEnd,d)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(w=>{if(w.isGround){const x=w.slicePlaneEnabled?g:null;w.intersect(f,x,f.rayBegin,f.rayEnd,d)}})}if(f.results.min.getIntersectionPoint(Jh)){const w=this._view.computeMapPointFromVec3d(Jh);return w.z=r,w}return null}computeIntersection(e,t,r){var f;if(e==null)return;const s=this._view.state.camera,a=Ng(Rt.get());s.projectToRenderScreen(e.origin,a);const n=new G0(r,this._forEachLayer);t.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const o=e.origin,l=me(Rt.get(),e.origin,e.direction);t.reset(o,l,s),t.intersect(n.layers,a,this._tolerance);const c=this._view.slicePlane,d=c!=null?xf(c):null;t.intersect(n.sliceableLayers,a,this._tolerance,d);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const v=y.layerUid,T=Array.isArray(v),w=T?v:[v];T&&(t.options.filteredLayerUids=[]);let x=!1;for(const C of w)n.filterLayerUid(C)?x=!0:T&&t.options.filteredLayerUids.push(C);if(t.options.isFiltered=!x,y.isGround&&p||!t.options.isFiltered){const C=y.slicePlaneEnabled?d:null;y.intersect(t,C,o,l,a)}});const m=Rt.get(),g=this._view.basemapTerrain;if(r&&r.enableDraped&&g.spatialReference!=null&&t.results.ground.getIntersectionPoint(m)){const y=g.overlayManager.renderer,v=this._view.renderCoordsHelper.spatialReference,T=Rt.get();this._view.renderCoordsHelper.fromRenderCoords(m,T,g.spatialReference),T[2]=((f=this._view.elevationProvider)==null?void 0:f.getElevation(m[0],m[1],m[2],v,"ground"))??0,y.intersect(t,T,t.results.ground,w=>n.filterRenderGeometry(w))}t.sortResults(),this._processHUDResults(t)}_processHUDResults(e){const t=e.results.hud;um(this._tmpRegion,a2);const r=this._view.state.camera,s=[],a=this._tmpRegion,n=T=>{const w=new BO(T);r.projectToRenderScreen(T.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),s.push(w),Ay(a,w.screenPoint)};e.sortResults(t.all),t.min.dist!=null&&n(t.min);for(const T of t.all)t.min.target.object!==T.target.object&&t.max.target.object!==T.target.object&&n(T);if(t.max.dist!=null&&t.max.target.object!==t.min.target.object&&n(t.max),!s.length)return;a[0]===a[2]&&(a[2]+=1),a[1]===a[3]&&(a[3]+=1);const o=r.fullWidth,l=r.fullHeight,c=Math.max(0,a[0]-gc),d=Math.max(0,a[1]-gc),p=Math.min(Yn(a)+2*gc,o-c),m=Math.min(Wc(a)+2*gc,l-d),g=new Uint8Array(p*m*4);this._view._stage.renderer.readHUDVisibility(c,d,p,m,g);let f=!0;const y=e.results.max.dist==null;let v=0;for(const T of s)for(const w of qO)if(g[4*(Math.min(T.screenPoint[0]+w[0],o)-a[0]+(Math.min(T.screenPoint[1]+w[1],l)-a[1])*p)]){f&&(e.results.min.copy(T.result),f=!1),y&&e.results.max.copy(T.result),e.options.store===Xs.ALL&&e.results.all.splice(v++,0,T.result);break}}};const gc=1,qO=(()=>{const i=[],e=gc;for(let t=-e;t<=e;t++)for(let r=-e;r<=e;r++)i.push([r+e,t+e]);return i})();let BO=class{constructor(e){this.result=e,this.screenPoint=mh()}},Kh;function k0(i){return Kh&&Kh.viewingMode===i||(Kh=xs(i)),Kh}let G0=class{constructor(e,t){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,t(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:t,exclude:r}=this;return e==null?t==null&&r==null:(t==null||t.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function j0(i){return typeof i=="object"&&"intersect"in i}const Jh=b(),ed=mh();let fc=class extends Xr.EventedMixin(ue){get spatialReference(){var e,t;return(t=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:t.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=re(this._elevationQueryCached)}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,r,s,a){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&r===o.z&&Fg(s,o.spatialReference)&&a===o.queryContext)return o.result}let n=null;return n=td(n,this._im,e,t,r,s,a),n==null&&(n=td(n,this._ground,e,t,r,s,a)),a==="scene"&&(n=td(n,this._scene,e,t,r,s,a)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:r,spatialReference:s,queryContext:a,result:n}),n}getSphereElevationBounds(e,t){let r=1/0,s=-1/0;for(const a of[this._im,this._ground,this._scene])a.forEach(n=>{if(n.getSphereElevationBounds){const o=n.getSphereElevationBounds(e,t);o!=null&&(r=Math.min(r,o.min),s=Math.max(s,o.max))}});return{min:r,max:s}}getRootElevationBounds(){let e=1/0,t=-1/0;for(const r of[this._im,this._ground,this._scene])r.forEach(s=>{if(s.getRootElevationBounds){const a=s.getRootElevationBounds();a!=null&&(e=Math.min(e,a.min),t=Math.max(t,a.max))}});return{min:e,max:t}}async queryElevation(e,t,r,s,a,n=null,o=0){const l=this._getElevationQuery(s);try{const c=await l.queryElevation(e,t,n,o);return a==="scene"?td(c,this._scene,e,t,r,s,a):c}catch(c){return n2(c),this.getElevation(e,t,r,s,a)}}register(e,t){this.addHandles(t.on("elevation-change",r=>this.emit("elevation-change",r)),t),this._providersFromContext(e).push(t)}unregister(e){this.removeHandles(e);for(const t of[this._im,this._ground,this._scene]){const r=t.indexOf(e);r>-1&&t.splice(r,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}_getElevationQuery(e=this.view.spatialReference){const t=this._elevationQueryCached;if(t!=null&&Fg(e,t.spatialReference))return t;t==null||t.destroy({completeTasks:!0});const{wkid:r,wkt:s,wkt2:a,latestWkid:n}=e,o=new TT(this.view.resourceController.scheduler,new _i({wkid:r,wkt:s,wkt2:a,latestWkid:n}),()=>{var l;return(l=this.view.map)==null?void 0:l.ground},{maximumAutoTileRequests:4});return this._elevationQueryCached=o,o}};function td(i,e,t,r,s,a,n){for(const o of e){const l=o.getElevation(t,r,s,a,n);l!=null&&(i=i!=null?Math.max(l,i):l)}return i}h([u({constructOnly:!0})],fc.prototype,"view",void 0),h([u()],fc.prototype,"spatialReference",null),fc=h([N("esri.views.3d.support.CombinedElevationProvider")],fc);let ch=class Xm{static isValidProfile(e){return e in Xm.profiles}static getDefaultProfile(){return li("esri-iPhone")?"low":"medium"}static apply(e,t){const r=Xm.profiles[e];t.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,t.graphics3D.maxNumberOfDrawCalls=r.graphics3D.maxNumberOfDrawCalls,t.graphics3D.maxTotalNumberOfVertices=r.graphics3D.maxTotalNumberOfVertices,t.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,t.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,t.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,t.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods,t.graphics3D.uncompressedTextureDownsamplingEnabled=r.graphics3D.uncompressedTextureDownsamplingEnabled;const s=t.sceneService.object,a=r.sceneService.object;s.lodFactor=a.lodFactor,s.lodCrossfadeinDuration=a.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=a.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=a.lodCrossfadeUncoveredDuration,t.sceneService.point.lodFactor=r.sceneService.point.lodFactor,t.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,t.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,t.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,t.tiledSurface.lodBias=r.tiledSurface.lodBias,t.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,t.tiledSurface.vtlContentZoom=r.tiledSurface.vtlContentZoom,t.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,t.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,t.heatmap.pixelRatio=r.heatmap.pixelRatio,t.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,t.fadeDuration=r.fadeDuration,t.antialiasingEnabled=r.antialiasingEnabled,t.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,t.highQualityTransparency=r.highQualityTransparency,t.highResolutionAtmosphere=r.highResolutionAtmosphere,t.reflections=r.reflections,t.ambientOcclusion=r.ambientOcclusion,t.memoryLimit=r.memoryLimit,t.additionalCacheMemory=r.additionalCacheMemory,t.frameRate=r.frameRate,t.maximumPixelRatio=r.maximumPixelRatio}};ch.test={reset(){const i=kb();for(const e of Object.keys(i))ch.profiles[e]=i[e]}};const Jl={IPhone12Pro:120,GalaxyS20:200,FullHD:240,SurfacePro7:300,FullHDRetina:430};function kb(){const i=!!li("esri-mobile"),e=!!li("ios"),t=Oe(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxNumberOfDrawCalls:8e3,maxTotalNumberOfVertices:255e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0,uncompressedTextureDownsamplingEnabled:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:Oe(0),lodCrossfadeoutDuration:Oe(0),lodCrossfadeUncoveredDuration:Oe(0)},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,vtlContentZoom:.75,reduceTileLevelDifferences:!0,textureFadeDuration:Oe(0)},fadeDuration:Oe(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200+Jl.IPhone12Pro,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:625e4,polygonLodFactor:i?.8:1,polylineLodFactor:i?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:i},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:Oe(0),lodCrossfadeoutDuration:Oe(0),lodCrossfadeUncoveredDuration:t},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:i},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!li("disable-feature:reduce-map-tile-levels"),textureFadeDuration:t},fadeDuration:t,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:i?600+Jl.GalaxyS20:750+Jl.FullHD,additionalCacheMemory:i?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:1e5,maxNumberOfDrawCalls:17e3,maxTotalNumberOfVertices:125e5,polygonLodFactor:i?1.2:2,polylineLodFactor:i?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1,uncompressedTextureDownsamplingEnabled:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:Oe(0),lodCrossfadeoutDuration:Oe(0),lodCrossfadeUncoveredDuration:t},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,vtlContentZoom:1.5,reduceTileLevelDifferences:!li("disable-feature:reduce-map-tile-levels"),textureFadeDuration:t},fadeDuration:t,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:i?900+Jl.SurfacePro7:1500+Jl.FullHDRetina,additionalCacheMemory:i?-150:0,frameRate:0,maximumPixelRatio:i?1:1/0}}}(function(i){i.profiles=kb()})(ch||(ch={}));const Ad=ch,Gb=new no([0,255,255]),jb=1,Wb=.25,Qb=new no([0,0,0]),Zb=.4,Xb=.2;let Ms=class extends ue{constructor(){super(...arguments),this.color=Gb.clone(),this.haloColor=null,this.haloOpacity=jb,this.fillOpacity=Wb,this.shadowOpacity=Zb,this.shadowColor=Qb.clone(),this.shadowDifference=Xb}};h([u({type:no})],Ms.prototype,"color",void 0),h([u({type:no})],Ms.prototype,"haloColor",void 0),h([u()],Ms.prototype,"haloOpacity",void 0),h([u()],Ms.prototype,"fillOpacity",void 0),h([u()],Ms.prototype,"shadowOpacity",void 0),h([u({type:no})],Ms.prototype,"shadowColor",void 0),h([u()],Ms.prototype,"shadowDifference",void 0),Ms=h([N("esri.views.3d.support.HighlightOptions")],Ms);const Yb=Ms;let HO=class{constructor(e,t){this.spatialReference=t,this.unitInMeters=wy(this.spatialReference,Tt(this.spatialReference).metersPerDegree);const r=e&&"portalItem"in e?e.portalItem:void 0;this._geometryServiceURLPromise=RP(r).catch(()=>{throw new Mr("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const t=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],s=!1);const a=r.map(l=>l instanceof Qr?l:new Qr(l,this.spatialReference)),n=new OP({geometries:a,outSpatialReference:_i.WGS84}),o=(await EP(t,n)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return s?o:o[0]}},Sr=class extends ue{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxNumberOfDrawCalls=17e3,this.maxTotalNumberOfVertices=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1,this.uncompressedTextureDownsamplingEnabled=!1}};h([u()],Sr.prototype,"minTotalNumberOfFeatures",void 0),h([u()],Sr.prototype,"maxTotalNumberOfFeatures",void 0),h([u()],Sr.prototype,"maxNumberOfDrawCalls",void 0),h([u()],Sr.prototype,"maxTotalNumberOfVertices",void 0),h([u()],Sr.prototype,"snapshotAvailable",void 0),h([u()],Sr.prototype,"polygonLodFactor",void 0),h([u()],Sr.prototype,"polylineLodFactor",void 0),h([u()],Sr.prototype,"skipHighSymbolLods",void 0),h([u()],Sr.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Sr=h([N("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Sr);let Ys=class extends ue{constructor(){super(...arguments),this.lodFactor=1}};h([u()],Ys.prototype,"lodFactor",void 0),Ys=h([N("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Ys);let vu=class extends Ys{constructor(){super(...arguments),this.lodCrossfadeinDuration=Oe(0),this.lodCrossfadeoutDuration=Oe(0),this.lodCrossfadeUncoveredDuration=Oe(0)}};vu=h([N("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],vu);let wa=class extends ue{constructor(){super(...arguments),this.object=new vu,this.point=new Ys,this.integratedMesh=new Ys,this.pointCloud=new Ys,this.uncompressedTextureDownsamplingEnabled=!1}};h([u({type:vu})],wa.prototype,"object",void 0),h([u({type:Ys})],wa.prototype,"point",void 0),h([u({type:Ys})],wa.prototype,"integratedMesh",void 0),h([u({type:Ys})],wa.prototype,"pointCloud",void 0),h([u()],wa.prototype,"uncompressedTextureDownsamplingEnabled",void 0),wa=h([N("esri.views.3d.support.QualitySettings.SceneServiceSettings")],wa);let xa=class extends ue{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.vtlContentZoom=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=Oe(400)}};h([u()],xa.prototype,"lodBias",void 0),h([u()],xa.prototype,"angledSplitBias",void 0),h([u()],xa.prototype,"vtlContentZoom",void 0),h([u()],xa.prototype,"reduceTileLevelDifferences",void 0),h([u()],xa.prototype,"textureFadeDuration",void 0),xa=h([N("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],xa);let hl=class extends ue{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};h([u()],hl.prototype,"pixelRatio",void 0),h([u()],hl.prototype,"maxTotalNumberOfFeatures",void 0),hl=h([N("esri.views.3d.support.QualitySettings.HeatmapSettings")],hl);let wi=class extends ue{constructor(){super(...arguments),this.graphics3D=new Sr,this.sceneService=new wa,this.tiledSurface=new xa,this.heatmap=new hl,this.fadeDuration=Oe(400),this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};h([u({type:Sr})],wi.prototype,"graphics3D",void 0),h([u({type:wa})],wi.prototype,"sceneService",void 0),h([u({type:xa})],wi.prototype,"tiledSurface",void 0),h([u({type:hl})],wi.prototype,"heatmap",void 0),h([u()],wi.prototype,"fadeDuration",void 0),h([u()],wi.prototype,"antialiasingEnabled",void 0),h([u()],wi.prototype,"physicallyBasedRenderingEnabled",void 0),h([u()],wi.prototype,"highQualityTransparency",void 0),h([u()],wi.prototype,"highResolutionAtmosphere",void 0),h([u()],wi.prototype,"reflections",void 0),h([u()],wi.prototype,"ambientOcclusion",void 0),h([u()],wi.prototype,"memoryLimit",void 0),h([u()],wi.prototype,"additionalCacheMemory",void 0),h([u()],wi.prototype,"frameRate",void 0),h([u()],wi.prototype,"maximumPixelRatio",void 0),wi=h([N("esri.views.3d.support.QualitySettings.QualitySettings")],wi);const W0=wi;var Hs;(function(i){i[i.ELEVATION=0]="ELEVATION",i[i.BASEMAP=1]="BASEMAP",i[i.I3S_INDEX=2]="I3S_INDEX",i[i.I3S_DATA=3]="I3S_DATA",i[i.SYMBOLOGY=4]="SYMBOLOGY"})(Hs||(Hs={}));const kO=(()=>{const i=new Array;return i[Hs.ELEVATION]=10,i[Hs.BASEMAP]=10,i[Hs.I3S_INDEX]=10,i[Hs.I3S_DATA]=10,i[Hs.SYMBOLOGY]=5,i})(),GO=30;function Kb(i){return"usedMemory"in i&&"unloadedMemory"in i&&"ignoresMemoryFactor"in i}function jO(i){return new Fi({view:i})}const Q0=.1,id=1,Fp=1,WO=.75,QO=.6,Z0=1.3;let Fi=class extends ue{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new o2,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0,this.addHandles(Ou({prepare:()=>this._updateMemory()}))}destroy(){this._cacheStorage.destroy()}get maxMemory(){return this._maxMemory}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(id),this._maxMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}get usedCacheMemory(){return this._cacheStorage.size}newCache(e,t){return new l2(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<QO&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(id);else if(e)(this._memoryPredicted>1.1*Fp||this._usedMemory>Fp)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>Q0&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/Z0),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>Fp)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Z0),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<WO&&this._quality<id){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,Q0),id))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var n,o,l,c,d;if(!this.view)return;(o=(n=this.view._stage)==null?void 0:n.renderer)==null||o.tick();let e=(((l=this.view.basemapTerrain)==null?void 0:l.usedMemory)??0)+(((d=(c=this.view._stage)==null?void 0:c.renderer)==null?void 0:d.usedMemory)??0),t=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(p=>{if(Kb(p)){const m=p.ignoresMemoryFactor?this._quality:1;e+=p.usedMemory*m,t+=p.unloadedMemory*m}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const p=g=>(g/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",m=Math.round(100*this._quality);ce.getLogger(this).warn(`Memory Limit exceeded! Limit: ${p(s)} Current: ${p(e)} Projected: ${p(e+t)} Quality: ${m}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+t)/s;const a=s-e;this._cacheStorage.maxSize=Math.max(0,a+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};h([u({constructOnly:!0})],Fi.prototype,"view",void 0),h([u()],Fi.prototype,"maxMemory",null),h([u()],Fi.prototype,"additionalCacheMemory",null),h([u({readOnly:!0})],Fi.prototype,"memoryFactor",null),h([u({readOnly:!0})],Fi.prototype,"updating",null),h([u({readOnly:!0})],Fi.prototype,"usedMemory",null),h([u({readOnly:!0})],Fi.prototype,"usedCacheMemory",null),h([u()],Fi.prototype,"_quality",void 0),h([u()],Fi.prototype,"_usedMemory",void 0),h([u()],Fi.prototype,"_updating",void 0),h([u()],Fi.prototype,"_stableQuality",void 0),h([u()],Fi.prototype,"_maxMemory",void 0),h([u()],Fi.prototype,"_additionalCacheMemory",void 0),Fi=h([N("esri.views.3d.support.MemoryController")],Fi);let Md=class extends ue{constructor(){super(...arguments),this.updating=!1}};function ZO(i){return new ss({view:i})}h([u({readOnly:!0})],Md.prototype,"updating",void 0),Md=h([N("esri.views.3d.support.ResourceControllerMain")],Md);let ss=class extends Md{constructor(){super(...arguments),this._immediateTask=iu,this._normalTask=iu,this._updatingObjects=MP([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=X3(),this._memoryController=jO(this.view),this._streamDataLoader=new cC,this._streamDataLoader.setup(GO,kO,this._scheduler),this.addHandles([D(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},at),D(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Ou({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(ci.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(ci.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Fa(this._frameTask),this._streamDataLoader=re(this._streamDataLoader),this._memoryController=re(this._memoryController),this._scheduler=re(this._scheduler),this.view=null}get updating(){var e,t,r,s;return!!((e=this._memoryController)!=null&&e.updating||(t=this._streamDataLoader)!=null&&t.updating||(r=this._immediateTask)!=null&&r.updating)||((s=this._updatingObjects)==null?void 0:s.value.some(a=>a.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const t=this._streamDataLoader;return{request:(r,s,a)=>t.request(r,s,e,a),get busy(){return!t.hasDownloadSlots(e)}}}addUpdatingObject(e){const t=this._updatingObjects;return t.value=[...t.value,e],dn(()=>{t.value=t.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(fy(e.deltaTime)),!this._scheduler)||(this._memoryController.update(),this._scheduler.updateBudget(e)&&this._scheduler.frame())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};h([u()],ss.prototype,"view",void 0),h([u()],ss.prototype,"_scheduler",void 0),h([u()],ss.prototype,"_memoryController",void 0),h([u()],ss.prototype,"_streamDataLoader",void 0),h([u()],ss.prototype,"_immediateTask",void 0),h([u()],ss.prototype,"_normalTask",void 0),h([u()],ss.prototype,"_updatingObjects",void 0),h([u({readOnly:!0})],ss.prototype,"updating",null),ss=h([N("esri.views.3d.support.ResourceControllerImpl")],ss);function XO(i){return Kb(i)}function YO(i){return"performanceInfo"in i}let KO=class{constructor(e,t){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=Kc(e)?t.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,YO(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},JO=class{constructor(e){var t,r,s,a,n,o,l;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,this.cachedMemory=0,this.fboMemory=0,e.resourceController!=null){const c=e.resourceController.memoryController;this.totalMemory=(c.maxMemory??0)*c2.MEGABYTES,this.usedMemory=Math.round(c.usedMemory*this.totalMemory),this.quality=e.quality,this.load=e.resourceController.scheduler.load,this.cachedMemory=c.usedCacheMemory}this.terrainMemory=((t=e.basemapTerrain)==null?void 0:t.usedMemory)??0,this.edgesMemory=((a=(s=(r=e==null?void 0:e._stage)==null?void 0:r.renderer)==null?void 0:s.edgeView)==null?void 0:a.usedMemory)??0,this.fboMemory=((l=(o=(n=e==null?void 0:e._stage)==null?void 0:n.renderer)==null?void 0:o.memoryInfo)==null?void 0:l.fbos)??0,e.allLayerViews.items.forEach(c=>{(XO(c)||Kc(c))&&this.layerPerformanceInfos.push(new KO(c,e))}),this.layerPerformanceInfos.sort((c,d)=>d.memory-c.memory)}},eE=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,t,r){const s=r?`gltfPBR:${e}`:`gltf:${e}`,a=this._gltfMemCache.get(s);return a!=null?Promise.resolve(a):this._loadOnce(this._gltfLoading,this._gltfMemCache,s,n=>DP(new LP(n.streamDataRequester),e,n,r),t)}loadWOSR(e,t){const r=`wosr:${e}:${t.disableTextures}`,s=this._wosrMemCache.get(r);return s!=null?Promise.resolve(s):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,a=>pP(e,a),t)}async _loadOnce(e,t,r,s,a){fr(a);const n=xy(a,()=>this._abortLoad(e,r));let o=e.get(r);if(o)o.refCount++;else{const l=new AbortController;o={refCount:1,abortController:l,promise:s({...a,signal:l.signal})},e.set(r,o)}try{const l=await o.promise;return t.put(r,l,l.size),e.delete(r),fr(a),l}finally{Fa(n)}}_abortLoad(e,t){const r=e.get(t);r!=null&&--r.refCount>0||(e.delete(t),r!=null&&r.abortController.abort())}},dl=class extends ue{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(t==null?void 0:t.registerTask(ci.TEXTURE_UNLOAD))??iu}normalizeCtorArgs(){return{}}destroy(){var e,t,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(t=this._textureRequests)==null||t.forEach(s=>this._releaseTextureRequest(s)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,t){const r=this.makeUid(e);let s=this._textureRequests.get(r);if(!s){const a=new Jb;a.texture=t(),this._stage&&(a.texture.load(this._stage.renderView.renderingContext),this._stage.add(a.texture)),this._textureRequests.set(r,a),s=a}return s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){var r;if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||((r=t.texture)==null||r.unload(),this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return t!=null?`${e}.${t}px`:e}};h([u()],dl.prototype,"_frameTask",void 0),h([u()],dl.prototype,"updating",null),dl=h([N("esri.views.3d.support.TextureCollection")],dl);let Jb=class{constructor(){this.referenceCount=0}},tE=class extends dl{constructor(e,t,r){super(t,r),this._streamDataRequester=e}async fromUrl(e,t,r){fr(r);const s=r!=null?r.signal:null,a=this.makeUid(e,t);let n=this._textureRequests.get(a);if(!n){const o=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:a,signal:o.signal});n=new Jb,n.abortController=o;const c=n;this._textureRequests.set(a,n),n.textureAsync=l.then(async d=>{const p=this._createTexture(e,d,t);return c.texture=p,c.abortController=null,await p.load(this._stage.renderView.renderingContext),this._stage.add(p),{uid:a,texture:p,release:()=>this._release(a)}},d=>{throw c.abortController=null,d})}n.referenceCount++;try{return await h2(n.textureAsync,s)}catch(o){throw this._release(a),o}}_createTexture(e,t,r){var a;const s={width:t.width,height:t.height,wrap:{s:ra.CLAMP_TO_EDGE,t:ra.CLAMP_TO_EDGE},preMultiplyAlpha:!0,reloadable:!0};if(My(e)){if(r||t.width===0&&t.height===0){const n=t.width?t.height/t.width:1;r=r||64,n>1?(t.width=Math.round(r/n),t.height=r):(t.width=r,t.height=Math.round(r*n))}(a=this._stage.renderView)!=null&&a.renderingContext.driverTest.svgPremultipliesAlpha.result&&(s.preMultiplyAlpha=!1)}return new FC(t,s)}},iE=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Hs.SYMBOLOGY),this.objectResourceCache=new eE((r,s)=>e.resourceController.memoryController.newCache(r,s)),this.textures=new tE(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const t=Tt(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=Tv(e.viewingMode,t),this.screenSizePerspectiveSettingsLabels=I3(e.viewingMode,t)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return dn();this._graphicsOwners.push(e);const t=D(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),dn(()=>{t.remove(),d2(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(t=>{var r;return((r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new ph;const t=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([D(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,t,at),this._viewState.events.on("camera-projection-changed",t)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=re(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;rd.distance=e.centerOnSurfaceInfrequent.distance,rd.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(rd),this.screenSizePerspectiveSettingsLabels.update(rd),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const rd={distance:0,fovY:0};let el=class{constructor(e,t,r=""){this.graphics=e,this._symbol=new u2({symbolLayers:new ho([new p2({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new m2({text:r,halo:{color:"white",size:1/.75},material:{color:t},size:12})])})}show(e,t){if(t==null)return;this.hide();const r=new Qr({x:e[0],y:e[1],z:e[2],spatialReference:t});this._graphic=new Dy({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},on=class extends ue{constructor(e){super(e)}};h([u({constructOnly:!0})],on.prototype,"renderCoordsHelper",void 0),h([u({constructOnly:!0})],on.prototype,"surface",void 0),h([u({constructOnly:!0})],on.prototype,"state",void 0),on=h([N("esri.views.3d.support.PointOfInterest")],on);const rE=Array;let as=class extends on{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Tn({location:Qr,renderLocation:rE},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=b(),this._tmpPoint=new Qr}initialize(){if(this.scheduler&&this.addHandles(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.addHandles(Oa(()=>{var t,r;return(r=(t=this.map)==null?void 0:t.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=sr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Xy(r,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){var s;if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!((s=this.map)!=null&&s.ground))return this._updateSurfaceAltitude(0),yr.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const t=(this._tmpPoint.z??0)>sE&&this.renderCoordsHelper.viewingMode===Ne.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:t?aE:0}).then(a=>this._updateSurfaceAltitude(a.geometry.z??0)).catch(a=>{yn(a)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,yr.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Vp,this._estimatedSurfaceAltitude,this._camera.eye),f_(this._get("renderLocation"),Vp)||(this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),Vp)),this.notifyChange("renderLocation"))}};h([u({constructOnly:!0})],as.prototype,"scheduler",void 0),h([u({constructOnly:!0})],as.prototype,"cache",void 0),h([u({constructOnly:!0})],as.prototype,"task",void 0),h([u({readOnly:!0})],as.prototype,"location",null),h([u({constructOnly:!0})],as.prototype,"map",void 0),h([u({readOnly:!0})],as.prototype,"renderLocation",void 0),h([u({readOnly:!0})],as.prototype,"scale",null),h([u({readOnly:!0})],as.prototype,"updating",null),as=h([N("esri.views.3d.support.CameraOnSurface")],as);const Vp=b(),sE=1e5,aE=1e6,nE=Array;let Vr=class extends on{constructor(e){super(e),this._propertiesPool=new Tn({location:Qr,renderLocation:nE},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=b(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Fa(this._frameWorker),this._propertiesPool=re(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,yr.YIELD}_updateRenderLocation(){const e=lE;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&r&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const s=cE;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,s)&&(ae(e,s),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=sr(this._camera.eye,e):(J(e,this._camera.viewForward,this._get("distance")),me(e,e,this._camera.eye)),f_(this._get("renderLocation"),e)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){var s,a;const r=this._camera;if(!this.renderCoordsHelper.intersectInfiniteManifold(r.ray,e,t))return!1;if(this.state.isGlobal){const n=Tt(this.renderCoordsHelper.spatialReference).radius,o=n+e,l=gs(r.eye),c=l<o*o,d=sr(r.eye,t);if(c&&d>n/4){const p=o-Math.sqrt(l);return J(t,r.viewForward,p),me(t,t,r.eye),!0}}else{const n=(s=this.surface)!=null&&s.ready?this.surface.extent:null;n!=null&&Gy(n,(a=this.surface)==null?void 0:a.spatialReference,ec,this.renderCoordsHelper.spatialReference)&&(t[0]=K(t[0],ec[0],ec[2]),t[1]=K(t[1],ec[1],ec[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(ki.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,s=sr(r,e),a=sr(r,t);if(Math.abs(a-s)/s>oE)return!0}return!1}};h([u({constructOnly:!0})],Vr.prototype,"scheduler",void 0),h([u({constructOnly:!0})],Vr.prototype,"task",void 0),h([u()],Vr.prototype,"distance",void 0),h([u({constructOnly:!0})],Vr.prototype,"estimateSurfaceAltitudeAtCenter",void 0),h([u({readOnly:!0})],Vr.prototype,"location",null),h([u({readOnly:!0})],Vr.prototype,"renderLocation",void 0),h([u()],Vr.prototype,"updating",void 0),Vr=h([N("esri.views.3d.support.CenterOnSurface")],Vr);const oE=.05,lE=b(),cE=b(),ec=Yt();let hE=class{constructor(e){this._handles=new ph,this.events=new Xr,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",t=>this._layerViewsChanged(t))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=re(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(t=>{t.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(t.on("visible-geometry-changed",()=>this._contentChanged()),t.uid)}),e.removed.forEach(t=>this._handles.remove(t.uid))}_contentChanged(){this.events.emit("request-update",dE)}};const dE={},uE=Array;let Ds=class extends on{constructor(e){super(e),this._propertiesPool=new Tn({location:Qr,renderLocation:uE},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.addHandles([D(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),D(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.addHandles(this.scheduler.registerTask(ci.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=re(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,s=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(t,X0);const a=Math.max(0,(Math.acos(Ie(X0,s.viewForward))-.5*Math.PI)*(s.aboveGround?1:-1));if(Number.isNaN(a)){if(!e||!Qc(e,t)){const c=this._propertiesPool.get("renderLocation");ae(c,t),this._set("renderLocation",c)}return yr.YIELD}const n=1-K(a/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Y0);const l=this._propertiesPool.get("renderLocation");return ws(l,t,Y0,o),e&&Qc(e,l)||this._set("renderLocation",l),yr.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,r=t.getRenderCenter(mh());if(r[1]=t.aboveGround?t.padding[_r.BOTTOM]:t.fullHeight-t.padding[_r.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const s=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(r,tc)){pe(tc,tc,t.eye);const a=ye(tc,tc);if(this.renderCoordsHelper.intersectInfiniteManifold(uo(t.eye,a),s,e))return e}return this.renderCoordsHelper.setAltitude(e,s,t.eye)}updateRenderLocation(){this._dirty=!0}};h([u()],Ds.prototype,"_dirty",void 0),h([u({constructOnly:!0})],Ds.prototype,"scheduler",void 0),h([u({constructOnly:!0})],Ds.prototype,"centerOnSurface",void 0),h([u({constructOnly:!0})],Ds.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),h([u({readOnly:!0})],Ds.prototype,"updating",null),h([u({readOnly:!0})],Ds.prototype,"location",null),h([u({readOnly:!0})],Ds.prototype,"renderLocation",void 0),Ds=h([N("esri.views.3d.support.pointsOfInterest.Focus")],Ds);const X0=b(),tc=b(),Y0=b();let ga=class extends ue{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=b();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([D(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),Oa(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}_update(){var r;if(this._updateController&&(this._updateController.abort(),this._updateController=null),((r=this.surfaceView)==null?void 0:r.extent)==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=Ly(this.surfaceView.extent),t=new Qr({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(s=>{this._updateController=null,this._set("location",s.geometry)}).catch(s=>{yn(s)||s&&s.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",s)})):this._set("location",t)}};h([u({constructOnly:!0})],ga.prototype,"view",void 0),h([u({constructOnly:!0})],ga.prototype,"cache",void 0),h([u()],ga.prototype,"surface",null),h([u()],ga.prototype,"surfaceView",null),h([u({readOnly:!0})],ga.prototype,"location",void 0),h([u({readOnly:!0})],ga.prototype,"renderLocation",null),ga=h([N("esri.views.3d.terrain.StableSurfaceCenter")],ga);let fa=class extends ue{constructor(e){super(e),this._tileGeometryUpdateExtent=ia(),this._tileGeometryUpdateSpatialReference=null,this.events=new Xr,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(ci.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating?(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",pE),ia(this._tileGeometryUpdateExtent),this._set("updating",!1),yr.YIELD):yr.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,mn(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const r=this.centerOnSurfaces[t];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,t){const r=this.state.contentCamera.eye,s=mE,a=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,Fn,t),this.renderCoordsHelper.fromRenderCoords(a.renderLocation,Vn,t),Fn[0]<Vn[0]?(s[0]=Fn[0],s[2]=Vn[0]):(s[0]=Vn[0],s[2]=Fn[0]),Fn[1]<Vn[1]?(s[1]=Fn[1],s[3]=Vn[1]):(s[1]=Vn[1],s[3]=Fn[1]),Eu(s,e)}};h([u({constructOnly:!0})],fa.prototype,"state",void 0),h([u({constructOnly:!0})],fa.prototype,"centerOnSurfaces",void 0),h([u({constructOnly:!0})],fa.prototype,"renderCoordsHelper",void 0),h([u({constructOnly:!0})],fa.prototype,"scheduler",void 0),h([u({constructOnly:!0})],fa.prototype,"surface",void 0),h([u({readOnly:!0})],fa.prototype,"updating",void 0),fa=h([N("esri.views.3d.support.SurfaceGeometryUpdates")],fa);const pE={},Fn=b(),Vn=b(),mE=ia();let Ji=class extends ue{constructor(e){super(e),this._handles=new ph,this._tmpRay=$l(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Tn({renderPointOfView:_E},this),this.renderPointOfView=b(),this._pois=new Array,this._debugCenters=new Map}initialize(){var d;const{state:e,basemapTerrain:t,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=xs(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Xs.MIN,this._contentIntersector=xs(e.viewingMode);const a=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(d=this.view.basemapTerrain)==null?void 0:d.elevationQueryCache,l={state:e,scheduler:n,surface:t,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Vr({...l,task:ci.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:a})),this._set("centerOnSurfaceFrequent",new Vr({...l,task:ci.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:a})),this._set("centerOnContent",new Vr({...l,task:ci.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new as({...l,cache:o,task:ci.POINT_OF_INTEREST_INFREQUENT,map:s})),this._set("surfaceGeometryUpdates",new fa({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new hE({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new ga({cache:o,view:this.view})),this._set("focus",new Ds({state:e,scheduler:n,surface:t,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(p,m)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,m)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new el(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new el(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new el(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new el(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new el(c,"green","Focus")),this._handles.add([D(()=>e.contentCamera,p=>this._cameraChanged(p),at),D(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Tl(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),at),Oa(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Oa(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Tl(()=>ki.SHOW_POI,p=>this._setDebug(p),si)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Vo,fE)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Vo):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const t=e.origin,r=me(Vo,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,r),this._surfaceIntersector.results.min.getIntersectionPoint(Vo)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Vo)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,r){const s=Lv(t,e,gE);if(s==null)return null;const a=s.origin,n=me(Vo,s.origin,s.direction);return this._surfaceIntersector.resetWithRay(s,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,a,n),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;f_(this.renderPointOfView,t)||this._set("renderPointOfView",ae(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(D(()=>t.renderLocation,r=>{var s;return(s=this._debugCenters.get(t))==null?void 0:s.show(r,t.renderCoordsHelper.spatialReference)},si),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};h([u({readOnly:!0})],Ji.prototype,"centerOnContent",void 0),h([u({readOnly:!0})],Ji.prototype,"centerOnSurfaceFrequent",void 0),h([u({readOnly:!0})],Ji.prototype,"centerOnSurfaceInfrequent",void 0),h([u({readOnly:!0})],Ji.prototype,"cameraOnSurface",void 0),h([u({readOnly:!0})],Ji.prototype,"focus",void 0),h([u({readOnly:!0})],Ji.prototype,"renderPointOfView",void 0),h([u({readOnly:!0})],Ji.prototype,"surfaceOrigin",void 0),h([u({readOnly:!0})],Ji.prototype,"contentGeometryUpdates",void 0),h([u({readOnly:!0})],Ji.prototype,"surfaceGeometryUpdates",void 0),h([u({constructOnly:!0})],Ji.prototype,"view",void 0),h([u({readOnly:!0})],Ji.prototype,"updating",null),Ji=h([N("esri.views.3d.support.PointsOfInterest")],Ji);const _E=Array,Vo=b(),gE=$l(),fE={exclude:new Set([sn])},l$={value:.5,readOnly:!0},yE={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let ul=class{constructor(e=0,t=0){this.min=e,this.max=t,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},vE=class{constructor(e,t,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=t,this.samplerData=new lC(r,t)}computeMinMaxValue(e,t,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const a=e-this.level;if(a<=0)return s;const n=2**a;if(!(Math.floor(t/n)===this.i&&Math.floor(r/n)===this.j))return s;let o=1/0,l=-1/0;const c=this.samplerData.data.width,d=this.samplerData.data.values,p=.5*Yc;let m=(c-1)/n,g=(r-this.j*n)*m,f=(t-this.i*n)*m;if(m<1){const y=Math.floor(g),v=Math.floor(f),T=y+v*c,w=d[T],x=d[T+1],C=d[T+c],P=d[T+c+1];if(w+x+C+P<p){const R=g-y,O=f-v,L=xh(w,x,C,P,R,O),F=xh(w,x,C,P,R+m,O),U=xh(w,x,C,P,R,O+m),j=xh(w,x,C,P,R+m,O+m);return s.min=Math.min(L,F,U,j),s.max=Math.max(L,F,U,j),s}g=y,f=v,m=1}else g=Math.floor(g),f=Math.floor(f),m=Math.ceil(m);for(let y=g;y<=g+m;y++)for(let v=f;v<=f+m;v++){const T=d[y+v*c];T<p?(o=Math.min(o,T),l=Math.max(l,T)):s.hasNoDataValues=!0}return s.min=o,s.max=l,s}};const bE=.5*Yc;function xt(i,e,t){if(t==null)return null;for(const r of t){if(!r)continue;const s=r.safeWidth;let a=K(r.dy*(r.y1-e),0,s),n=K(r.dx*(i-r.x0),0,s);const o=Math.floor(a),l=Math.floor(n),c=r.data.width,d=o*c+l,p=r.data.values,m=p[d],g=p[d+1],f=d+c,y=p[f],v=p[f+1];if(m+y+g+v<bE){a-=o,n-=l;const T=m+(g-m)*n;return T+(y+(v-y)*n-T)*a}}return null}let Fr=class extends ue{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const s=ew(r.fullExtent,this.viewSpatialReference);s!=null&&e.push(_2(s))}}),e}};function wE(i,e){return i===Ne.Global?new Ym(e):new Km(e)}h([u({readOnly:!0})],Fr.prototype,"layerViewsExtent",null),h([u({readOnly:!0})],Fr.prototype,"tiledLayersExtent",null),h([u({readOnly:!0})],Fr.prototype,"stencilEnabledExtents",null),h([u()],Fr.prototype,"viewSpatialReference",void 0),h([u()],Fr.prototype,"tilingScheme",void 0),h([u()],Fr.prototype,"defaultTiledLayersExtent",void 0),h([u({constructOnly:!0})],Fr.prototype,"layers",void 0),h([u({constructOnly:!0})],Fr.prototype,"layerViews",void 0),Fr=h([N("esri.views.3d.terrain.ExtentHelper")],Fr);let Ym=class extends Fr{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?hC:dC}};Ym=h([N("esri.views.3d.terrain.ExtentHelperGlobal")],Ym);let Km=class extends Fr{_computeLayerViewsExtent(){const e=ia(),t=this.viewSpatialReference;this.layerViews.forEach(a=>{const n=a.layer;if(a.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=ew("fullExtentInLocalViewSpatialReference"in a&&a.fullExtentInLocalViewSpatialReference||a.layer.fullExtent,t);mn(e,o,e)}});const r=Vg(e)?e:null,s=this._get("layerViewsExtent");return oo(r,s)?s:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=ia();this.layers.forEach(n=>{if(n.loaded&&Rc(n)){const o=Du(n,t,Ne.Local);if(o==null)return;const{tileInfo:l,fullExtent:c}=o;l!=null&&c!=null&&(Yy(n)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&mn(r,c,r)}}),mn(r,this.defaultTiledLayersExtent,r);const s=Vg(r)?r:null,a=this._get("tiledLayersExtent");return oo(s,a)?a:s}};function ew(i,e){return i==null||i.spatialReference.equals(e)?i:g2(i,i.spatialReference,e)}Km=h([N("esri.views.3d.terrain.ExtentHelperLocal")],Km);var Ce;(function(i){i[i.ELEVATION=0]="ELEVATION",i[i.MAP=1]="MAP"})(Ce||(Ce={}));const Zn=[Ce.ELEVATION,Ce.MAP];function tw(){var e;const i=(e=globalThis.require)==null?void 0:e.modules;if(i){const t=Object.keys(i);for(const r of t)r.includes(".glsl")&&delete i[r]}}const iw=1.3,xE=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Xa,Yi=class extends ue{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ki.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Tt(this._spatialReference).metersPerDegree:1}get _overlayStretch(){return iw/this.view.resolutionScale}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=li("esri-mobile")?2048:4096,this._animationTimeLast=0}initialize(){const e=this.view;this.renderer=new d3({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),e._stage.renderer.renderPlugins.add(this.renderer);const t=()=>this.setDrawTexturesDirty();this._groundIntersector=xs(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this.addHandles([D(()=>this.renderer.hasHighlights,t),this.renderer.events.on("has-water",r=>{var s;return(s=e._stage)==null?void 0:s.renderer.setParameters({hasOverlayWater:r})}),this.renderer.events.on("renders-occluded",()=>{t(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",t),D(()=>e.state.camera.pixelRatio,t),D(()=>e.state.alignPixelEnabled,t),this.renderer.events.on("textures-disposed",()=>this.surface.requestRender()),D(()=>{var r,s,a;return[(r=e.pointsOfInterest)==null?void 0:r.renderPointOfView,(a=(s=e.pointsOfInterest)==null?void 0:s.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),D(()=>{var r,s;return[(r=e.state)==null?void 0:r.pixelRatio,(s=e.state)==null?void 0:s.contentPixelRatio]},()=>this.setPlacementDirty(),at),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(ci.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",r=>{this._updateOverlays(Bs,r.camera,Bt.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlays(Bt.BACKGROUND,r)})]),e._stage.renderer.renderOverlay=r=>this._renderOverlay(r)}_renderOverlay(e){if(this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays)return this._dispatchAnimationUpdate(e),this._drawOverlays(Bt.UPDATE,this.view.state)}destroy(){var e;(e=this.view)!=null&&e._stage&&(this.view._stage.renderer.renderPlugins.remove(this.renderer),this.view._stage.renderer.renderOverlay=()=>{}),Xa&&(Xa.hide(),Xa=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;e!=null&&t!=null?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Tf(-20037508342787e-6,20037508342787e-6):new Tf(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}registerDrapeSource(e,t,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this.renderer.createDrapeSourceRenderer(e,t,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),s}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,u3)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Bt.UPDATE)}_updateOverlays(e,t,r){if(!this._spatialReference)return yr.YIELD;const s=this._computeOverlayResolution(t);this._computeOverlayExtents(t,s,Rs),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources,Rs.stretch);const a=this._updateOverlay(Ir.INNER,Rs.inner,s,1*Rs.pixelRatioAdjustment,Rs.mapUnitsPerPixel),n=Yn(Rs.inner)/Yn(Rs.outer),o=this._updateOverlay(Ir.OUTER,Rs.outer,s,n*Rs.pixelRatioAdjustment,Rs.mapUnitsPerPixel);a!==$s.EXTENT&&o!==$s.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),a===$s.NONE&&o===$s.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const t=this.view.state.contentPixelRatio*this.view.resolutionScale,r=e.fullWidth/e.pixelRatio*t,s=e.fullHeight/e.pixelRatio*t,a=Math.ceil(1.5*Math.max(r,s));return Math.min(vm(a),this._maxResolution)}_updateOverlay(e,t,r,s,a){if(this.renderer.overlays.length===0)return $s.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=a,n.pixelRatio=s,TE(t,n.extent)&&r===n.resolution)return o===a?$s.NONE:$s.RERENDER_ONLY;um(n.extent,t),n.resolution=r;const l=Ly(n.extent);return n.renderLocalOrigin=p3(l[0],l[1],0,"OV_"+this._latestOriginId++),$s.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Ir.INNER],s=this.renderer.overlays[Ir.OUTER],a=e.extent;this._rectInsideRect(r.extent,a)||this._rectanglesOverlap(a,r.extent)||this._rectanglesOverlap(a,s.extent)?(this._setTileOverlayData(a,Ir.INNER,t),this._setTileOverlayData(a,Ir.OUTER,t)):(this._clearTileOverlayData(Ir.INNER,t),this._clearTileOverlayData(Ir.OUTER,t))}else this._clearTileOverlayData(Ir.INNER,t),this._clearTileOverlayData(Ir.OUTER,t)}overlayPixelSizeInMapUnits(e,t){if(this.renderer.overlays.length===0)return t();const r=this.renderer.overlays[Ir.INNER],s=this.renderer.overlays[Ir.OUTER],a=this._pointIsInExtent(e,r.extent)?r:s;return(a.extent[2]-a.extent[0])/a.resolution}_setTileOverlayData(e,t,r){if(this.renderer.overlays.length===0)return;const s=this.renderer.overlays[t].extent,a=Yn(s),n=Wc(s);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(s[0],o);const l=this._longitudeCyclical.minimalMonotonic(s[0],e[2]);o>l&&(o=l-(e[2]-e[0]))}r.setScale(t,Yn(e)/a,Wc(e)/n),r.setOffset(t,(o-s[0])/a,(e[1]-s[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){tw(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Bs)}_dispatchAnimationUpdate(e){const t=Oe(e-this._animationTimeLast);if(t>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=Oe(t/this.surface.view._stage.renderer.animationTimeDilation),s=new Cv(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(s)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,t,r,s){const a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,RE,t,r);if(a==null)return!1;const n=a.origin,o=me(sd,a.origin,a.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(s)}_findHorizonBasedPointOfInterest(e,t){let r=.5;const s=.55,a=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,l=K(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:a+o,e.aboveGround?a-o:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const d=sd;Ru(u_(p_,Tt(this.view.spatialReference).radius+l),uo(e.eye,e.viewForward),d),pe(d,d,e.eye);const p=xn.normalize(f2(e.viewForward,d,e.viewRight))/e.fovY+.5,m=p<=0||p>=1?.5:s;r=c?m*p:p+m*(1-p)}else{const d=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(d),m=Zr(0,p,1,0),g=hm(m,m,e.projectionMatrix)[1],f=K(.5+.5*g,0,1);r=f===1||f===0?.5:c?f*s:1-(1-f)*s}return!!this._intersectGroundFromView(e,.5,r,t)&&y2(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,r){const s=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,a=b();this._findHorizonBasedPointOfInterest(e,a)||ae(a,s),ki.OVERLAY_SHOW_CENTER?(Xa==null&&(Xa=new el(this.view.graphics,"red")),Xa.show(a,this._renderSR)):Xa!=null&&Xa.hide();const n=Math.max(.1,sr(e.eye,a)),o=Pn(this.view.renderCoordsHelper,s,e.eye);this._overlaySREqualsRenderSR||Aa(a,this._renderSR,a,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference&&this._spatialReference.isGeographic,d=c&&this._spatialReference?1/Tt(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,m=e.perScreenPixelRatio/p*n*d;r.mapUnitsPerPixel=m/this._worldToPCSRatio,r.stretch=this._overlayStretch;let g=t*m/2*r.stretch,f=!1,y=c?90:1/0;this._isSpherical&&l&&this._spatialReference&&(this._spatialReference.isWebMercator?(g/=Math.cos(v2(a[1])),y=l[3]):(f=!0,g/=Tt(this._spatialReference).metersPerDegree,y=90),g>=y&&(g=y,a[1]=0,this._spatialReference.isWebMercator&&(a[0]=0)));let v=1;f&&(v=1/Math.max(.2,Math.cos(Math.abs(Ht(a[1])))),g*v>180&&(v=180/g),r.mapUnitsPerPixel*=v);const T=Math.log(2)/12;g=Math.exp(Math.round(Math.log(g)/T)*T);const w=g*v,x=32,C=.5*t/(x*w),P=.5*t/(x*g);a[0]=Math.round(a[0]*C)/C,a[1]=Math.round(a[1]*P)/P;const R=r.inner;R[0]=a[0]-w,R[1]=a[1]-g,R[2]=a[0]+w,R[3]=a[1]+g,this._isSpherical&&this._shiftExtentToFitBounds(R,1/0,y);const O=r.outer;if(6*w>Yn(l))um(O,l);else if(Math.PI/2-Math.abs(o-Math.PI/2)<=.25*Math.PI)O[0]=R[0]-w,O[1]=R[1]-g,O[2]=R[2]+w,O[3]=R[3]+g;else{Aa(e.eye,this._renderSR,sd,this._spatialReference),b2(Un,a,sd);let F=-Math.atan2(Un[1],Un[0])+.125*Math.PI;F<0&&(F+=2*Math.PI);const U=Math.floor(F/(.25*Math.PI));Ry(Un,xE[U],2*g),Un[0]*=v,Un[2]*=v,w2(O,R,Un)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const F=pm(R,l,PE),U=pm(O,l,SE);Ug(F,U)&&(O[2]=O[0],O[3]=O[1])}const L=Math.abs(R[2]-R[0])/t;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,L),r.pixelRatioAdjustment=r.mapUnitsPerPixel/L}_drawOverlays(e,t){if(!this.renderer.hasOverlays)return;if(!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return this.renderer;const r=this._drawTexturesDirty;this._drawTexturesDirty=this._drawTexturesAnimateDirty=!1;const s=this.renderer.computeValidity();return this.renderer.releaseRenderTargets(),this.renderer.drawOverlays(t),s!==this.renderer.computeValidity()&&this.surface.updateTileOverlayParams(Bt.UPDATE),r?(this.surface.requestRender(e),e===Bt.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Bt.BACKGROUND),this.renderer}_rectanglesOverlap(e,t){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):Eu(e,t))}_rectInsideRect(e,t){return t!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:Ug(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const r=e.x,s=e.y;return r>t[0]&&r<t[2]&&s>t[1]&&s<t[3]}_shiftExtentToFitBounds(e,t,r){let s=0,a=0;e[0]<-t?s=e[0]+t:e[2]>t&&(s=t-e[2]),e[1]<-r?a=e[1]+r:e[3]>r&&(a=r-e[3]),Oy(e,s,a)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Bs)}}};function TE(i,e){const r=ki.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(i[2]-i[0],i[3]-i[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-i[0])<=r&&Math.abs(e[1]-i[1])<=r&&Math.abs(e[2]-i[2])<=r&&Math.abs(e[3]-i[3])<=r}h([u()],Yi.prototype,"_spatialReference",void 0),h([u({readOnly:!0})],Yi.prototype,"running",null),h([u()],Yi.prototype,"_placementDirty",void 0),h([u()],Yi.prototype,"_contentUpdated",void 0),h([u()],Yi.prototype,"_isSpherical",null),h([u()],Yi.prototype,"_worldToPCSRatio",null),h([u({autoDestroy:!0})],Yi.prototype,"renderer",void 0),h([u({constructOnly:!0})],Yi.prototype,"view",void 0),h([u({constructOnly:!0})],Yi.prototype,"surface",void 0),h([u()],Yi.prototype,"suspended",null),h([u()],Yi.prototype,"updating",null),h([u({type:Boolean})],Yi.prototype,"rendersOccluded",null),Yi=h([N("esri.views.3d.terrain.OverlayManager")],Yi);let CE=class{constructor(){this.inner=Yt(),this.outer=Yt(),this.mapUnitsPerPixel=0,this.pixelRatioAdjustment=1,this.stretch=iw}};const Un=gi(),sd=b(),Rs=new CE,PE=Yt(),SE=Yt(),RE=$l();var $s;(function(i){i[i.NONE=0]="NONE",i[i.EXTENT=1]="EXTENT",i[i.RERENDER_ONLY=2]="RERENDER_ONLY"})($s||($s={}));let OE=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Au(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}release(){this.vertexAttributes=et(this.vertexAttributes),this.indices=null}},K0=class{constructor(e,t,r,s,a){this.attributes=e,this.localOrigin=t,this.index0=r,this.stride=s,this.count=a}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return A(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,t){this.attributes.position.getVec(e,t)}getVertexPos(e,t){this._getVertexRaw(this.getAttributeIndex(t),e),me(e,e,this.localOrigin)}getNormal(e,t){const{typedBuffer:r,typedBufferStride:s}=this.attributes.normalCompressed;CT(e,r,this.getAttributeIndex(t),s)}_setNormal(e,t,r,s){const{typedBuffer:a,typedBufferStride:n}=this.attributes.normalCompressed;Xc(a,e,t,r,s,n)}_setUV(e,t,r){bs(this.attributes.uv0,e,t,r)}setNormalFromValues(e,t,r,s){this._setNormal(this.getAttributeIndex(e),t,r,s)}setVertexFromValuesRawPositionUV(e,t,r,s,a,n){const o=this.getAttributeIndex(e);this.attributes.position.setValues(o,t,r,s),this._setUV(o,a,n)}setVertexFromValuesRawPositionUVNormal(e,t,r,s,a,n,o,l,c){const d=this.getAttributeIndex(e);this.attributes.position.setValues(d,t,r,s),this._setUV(d,a,n),this._setNormal(d,o,l,c)}};const J0=16384;function bs(i,e,t,r){i.setValues(e,t*J0,r*J0)}function Wr(i,e,t,r){i<r[0]?r[0]=i:i>r[3]&&(r[3]=i),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),t<r[2]?r[2]=t:t>r[5]&&(r[5]=t)}let EE=class{constructor(){this.sinLonLUT=new Array(ac+1),this.cosLonLUT=new Array(ac+1),this.sinLatLUT=new Array(ac+1),this.cosLatLUT=new Array(ac+1)}update(e,t,r){const s=t[0],a=t[2];for(let n=0;n<=e;n++){const o=n/e,l=s*(1-o)+a*o;this.sinLonLUT[n]=Math.sin(l),this.cosLonLUT[n]=Math.cos(l);const c=r(o);this.sinLatLUT[n]=Math.sin(c),this.cosLatLUT[n]=Math.cos(c)}}},ad=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},AE=class{constructor(){this.cornerNeighborData=[new ad,new ad,new ad,new ad],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},ME=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new AE}},rw=class Dd{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=re(this._current),this._next=re(this._next),this._waiting=re(this._waiting),this._delayed=re(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const t=this._delayed||this._waiting||this._next||this._current;t!==this._current&&(this._current=null,this.clear(),this._current=t)}let e=Dd.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Ia.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const t=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,s=this._next.type!==ni.FADING,a=e-this._fadeStart>=t;(r||s||a)&&(re(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=Dd.test.fadeMoment||performance.now(),t=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return t>r?0:1-t/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,t=Ia.Immediate){this._delayed=re(this._delayed),this._push(e,t)}_push(e,t){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=Dd.test.fadeMoment||performance.now();return t!==Ia.Immediate?(this._delayed=e,void(this._delayedTime=r+t)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(re(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const t=this._getFadeDuration();return e+t-e%t}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Ia;rw.test={fadeMoment:0},function(i){i[i.Immediate=0]="Immediate",i[i.Delayed=5e3]="Delayed"}(Ia||(Ia={}));var Al;(function(i){i[i.BACK_TO_FRONT=-1]="BACK_TO_FRONT",i[i.NONE=0]="NONE",i[i.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(Al||(Al={}));let sw=class{constructor(){this._queue=new Et,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var t;const e=(t=this._last)==null?void 0:t.children;return e!=null&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},DE=class{constructor(){this._q=new Et}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let t=0;t<this._q.length;++t){const r=this._q.data[t];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function Fc(i,e,t){if((e==null?void 0:e.fullExtent)==null)return!1;const r=e.fullExtent,s=i.extent;if(t){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const a=i.surface.tilingScheme.levels[i.level].scale,n=e.minScale;if(n>0&&a>1.00000001*n)return!1;const o=e.maxScale;return!(o>0&&a<.99999999*o)}function Na(i,e){const t=i.lij,r=e.lij;return t[0]-r[0]||t[1]-r[1]||t[2]-r[2]}function aw(i,e,t=null){t==null||t.length===0?i===Al.BACK_TO_FRONT?e.sort(LE):e.sort($E):e.sort((r,s)=>IE(r,s,i,t))}function LE(i,e){const t=e.screenDepth-i.screenDepth;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function $E(i,e){const t=i.screenDepth-e.screenDepth;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function nw(i,e,t){const r=i.screenDepth,s=e.screenDepth;return r<s?-t:r>s?t:Na(i,e)}function IE(i,e,t,r){return e1(i,r)===e1(e,r)?nw(i,e,t):i?t:-t}function e1(i,e){for(const t of e)if(i.intersectsExtent(t))return!0;return!1}function NE(i,e){const t=i.distanceToPOI-e.distanceToPOI;if(t!==0)return t;const r=i.lij,s=e.lij;return r[0]-s[0]||r[1]-s[1]||r[2]-s[2]}function FE(i,e){const t=i.length;for(let r=0;r<t;++r)i.at(r).updateDistanceToPOI(e);i.sort(NE)}function VE(i,e,t){let r=1,s=0,a=0;for(;i!==e;)if(r*=.5,s*=.5,a*=.5,1&i.lij[2]&&(s+=.5),!(1&i.lij[1])&&(a+=.5),(i=i.parent)==null)throw new Error("tile was not a descendant of upsampleTile");t.init(e,s,a,r)}function UE(i){for(let e=0;e<i.length;e++){const t=i[e],r=t.parent;if(r)for(let s=0;s<4;s++){const a=r.children[s];if(a&&a!==t)return!0}}return!1}function C$(i,e){if(!i||!e||i[0]===e[0])return!1;const t=i[0]<e[0],r=t?i:e,s=t?e:i,a=1<<s[0]-r[0];return Math.floor(s[1]/a)===r[1]&&Math.floor(s[2]/a)===r[2]}let rg=class{get updating(){return!!this._tileRequested}init(e,t,r,s){this.tile=e,this._layerIdx=t,this._layerClass=r,this._suspended=s,this._tileLayerInfo=e.getLayerInfo(t,r),this._tileRequested=null;const a=this._findAncestorWithData();this._setUpsampleTile(a)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,t){this._setUpsampleTile(e,t),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,ni.FADING,t):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,t=this._layerClass,r=this.tile.surface.layerViewByIndex(e,t),s=gm(r),{minLevel:a,maxLevel:n}=r.dataLevelRange,o=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+o,c=this._scaleRangeEnabled?Fc:()=>!0;let d=this.tile;const p=d.level;let m;const g=this._tileLayerInfo.upsampleInfo,f=g!=null?g.tile.level:-1,y=g!=null&&f-p>=o,v=s==null?void 0:s.tilemapCache,T=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;d&&c(d,s,!1)&&d.level>=a;){const w=d.level,x=p-w,C=d.layerInfo[t][e];if(C.data&&x>=o){(!y||w>f)&&this._setUpsampleTile(d),C.dataInvalidated&&(m=d);break}const P=(T==null?void 0:T.getLevelRowColumn(d.lij))??d.lij;if((v==null?void 0:v.getAvailability(P[0],P[1],d.lij[2]))!=="unavailable"&&w<=n&&!C.data&&!C.dataMissing&&((!m||d.level===a||w%Ky==0||p-m.level<o)&&(m=d),x>=l))break;d=d.parent}if(m!=null&&p-m.level<o)if(g)m=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),m=w.layerInfo[t][e].dataInvalidated?w:null)}return m}_findAncestorWithData(){const e=this.tile.elevationLevel,t=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(e-s.level>=t)return s;r=s}return r}_setUpsampleTile(e,t){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,ni.FADING,t)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},zE=class extends rg{get _desiredMinLevelDelta(){throw t1}get _progressiveLevelModulo(){throw t1}dispose(){}};const t1=new Error("Abstract method called on TileAgent"),hr=new zE;let ow=class extends rg{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return fm(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},lw=class extends rg{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ky}};var co,vo;(function(i){i[i.Stretch=0]="Stretch",i[i.Lut=1]="Lut",i[i.Hillshade=2]="Hillshade",i[i.COUNT=3]="COUNT"})(co||(co={})),function(i){i[i.Noop=0]="Noop",i[i.PerBand=1]="PerBand",i[i.COUNT=2]="COUNT"}(vo||(vo={}));function qE(i){i.fragment.uniforms.add(new ke("u_colormap",e=>e.u_colormap),new Ue("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ue("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ue("u_opacity",e=>e.common.u_opacity)),i.fragment.code.add(_`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function BE(i){i.fragment.uniforms.add(new ke("u_transformGrid",e=>e.u_transformGrid),new Si("u_transformSpacing",e=>e.common.u_transformSpacing),new Si("u_targetImageSize",e=>e.common.u_targetImageSize)),i.fragment.code.add(_`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let cw=class extends ti{constructor(){super(...arguments),this.scale=1,this.offset=jd}};function hw(i){i.attributes.add(se.POSITION,"vec2"),i.attributes.add(se.UV0,"vec2"),i.vertex.uniforms.add(new Ue("scale",e=>e.scale)),i.vertex.uniforms.add(new Si("offset",e=>e.offset)),i.varyings.add("uv","vec2"),i.varyings.add("vuv","vec2"),i.vertex.code.add(_`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let HE=class extends cw{constructor(e,t,r){super(),this.common=e,this.u_image=t,this.u_transformGrid=r}};function kE(i,e){i.include(BE),i.fragment.uniforms.add(new ke("u_image",r=>r.u_image),new eh("u_flipY",r=>r.common.u_flipY),new eh("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:t}=e;t&&i.fragment.uniforms.add(new Si("u_srcImageSize",r=>r.common.u_srcImageSize)),i.fragment.code.add(_`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),t?i.fragment.code.add(_`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):i.fragment.code.add(_`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var z;(function(i){i[i.Normal=0]="Normal",i[i.Average=1]="Average",i[i.Lighten=2]="Lighten",i[i.Lighter=3]="Lighter",i[i.Plus=4]="Plus",i[i.Screen=5]="Screen",i[i.ColorDodge=6]="ColorDodge",i[i.Darken=7]="Darken",i[i.Multiply=8]="Multiply",i[i.ColorBurn=9]="ColorBurn",i[i.Overlay=10]="Overlay",i[i.SoftLight=11]="SoftLight",i[i.HardLight=12]="HardLight",i[i.VividLight=13]="VividLight",i[i.Hue=14]="Hue",i[i.Saturation=15]="Saturation",i[i.Luminosity=16]="Luminosity",i[i.Color=17]="Color",i[i.DestinationOver=18]="DestinationOver",i[i.DestinationAtop=19]="DestinationAtop",i[i.DestinationIn=20]="DestinationIn",i[i.DestinationOut=21]="DestinationOut",i[i.SourceAtop=22]="SourceAtop",i[i.SourceIn=23]="SourceIn",i[i.SourceOut=24]="SourceOut",i[i.Xor=25]="Xor",i[i.Difference=26]="Difference",i[i.Exclusion=27]="Exclusion",i[i.Minus=28]="Minus",i[i.Invert=29]="Invert",i[i.Reflect=30]="Reflect",i[i.COUNT=31]="COUNT"})(z||(z={}));const Jm={normal:z.Normal,average:z.Average,lighten:z.Lighten,lighter:z.Lighter,screen:z.Screen,plus:z.Plus,"color-dodge":z.ColorDodge,darken:z.Darken,multiply:z.Multiply,"color-burn":z.ColorBurn,overlay:z.Overlay,"soft-light":z.SoftLight,"hard-light":z.HardLight,"vivid-light":z.VividLight,hue:z.Hue,saturation:z.Saturation,luminosity:z.Luminosity,color:z.Color,difference:z.Difference,exclusion:z.Exclusion,minus:z.Minus,invert:z.Invert,reflect:z.Reflect,"destination-over":z.DestinationOver,"destination-atop":z.DestinationAtop,"destination-in":z.DestinationIn,"destination-out":z.DestinationOut,"source-atop":z.SourceAtop,"source-in":z.SourceIn,"source-out":z.SourceOut,xor:z.Xor};function GE(i){return i===z.DestinationOver||i===z.DestinationAtop||i===z.DestinationIn||i===z.DestinationOut||i===z.SourceAtop||i===z.SourceIn||i===z.SourceOut||i===z.Xor}function sg(i){i.code.add(_`
    float lineFactorAtPosition(float value) {
      float pos = value * ${_.float(257)};
      if(pos < 0.5 || pos > ${_.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function jE(i,e){const t=e.blendMode;t!==z.Normal&&(t===z.Reflect&&i.code.add(_`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),t!==z.ColorDodge&&t!==z.VividLight||i.code.add(_`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),t!==z.ColorBurn&&t!==z.VividLight||i.code.add(_`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),t===z.Overlay&&i.code.add(_`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),t===z.HardLight&&i.code.add(_`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),t===z.SoftLight&&i.code.add(_`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),t===z.VividLight&&i.code.add(_`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),t!==z.Hue&&t!==z.Saturation&&t!==z.Color&&t!==z.Luminosity||(i.code.add(_`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),t!==z.Hue&&t!==z.Saturation||i.code.add(_`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),i.code.add(_`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${t===z.Multiply?_`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Average?_`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Lighten?_`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Darken?_`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Lighter?_`return vec4(cl * ol + cb * ob, ol + ob);`:t===z.Plus?_`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:t===z.Minus?_`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:t===z.Screen?_`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Difference?_`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Invert?_`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:t===z.DestinationOver?_`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:t===z.DestinationAtop?_`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:t===z.DestinationOut?_`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:t===z.SourceAtop?_`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:t===z.SourceOut?_`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:t===z.Xor?_`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:t===z.DestinationIn?_`return vec4(cb * ob * ol, ol * ob);`:t===z.SourceIn?_`return vec4(cl * ol * ob, ol * ob);`:t===z.Hue?_`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Saturation?_`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Color?_`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Luminosity?_`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Exclusion?_`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Reflect?_`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.ColorDodge?_`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.ColorBurn?_`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.Overlay?_`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.SoftLight?_`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.HardLight?_`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:t===z.VividLight?_`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:_``}
    }
  `))}var jt,Dr,ps;(function(i){i[i.Composite=0]="Composite",i[i.ColorComposite=1]="ColorComposite",i[i.GridComposite=2]="GridComposite",i[i.GroupBackgroundComposite=3]="GroupBackgroundComposite",i[i.COUNT=4]="COUNT"})(jt||(jt={})),function(i){i[i.NotRequired=0]="NotRequired",i[i.Required=1]="Required",i[i.COUNT=2]="COUNT"}(Dr||(Dr={})),function(i){i[i.Off=0]="Off",i[i.On=1]="On",i[i.COUNT=2]="COUNT"}(ps||(ps={}));function dw(i,e){const t=e.output===jt.GridComposite,r=e.output===jt.ColorComposite,s=e.output===jt.GroupBackgroundComposite,a=e.output===jt.Composite;t&&i.fragment.include(sg),r&&i.fragment.uniforms.add(new Ci("backgroundColor",c=>c.backgroundColor));const n=e.baseOpacityMode===Dr.Required;n&&i.fragment.uniforms.add(new Ue("baseOpacity",c=>c.baseOpacity)),a&&i.fragment.uniforms.add(new ke("fboColor",c=>c.fboTexture));const o=e.blendMode!==z.Normal,l=e.premultipliedSource===ps.On;i.fragment.include(jE,e),i.fragment.code.add(_`
    vec4 getBackground(vec2 uv) {
      return ${n?_`baseOpacity *`:""} ${s?_`vec4(0.0, 0.0, 0.0, 0.0)`:r?_`vec4(backgroundColor, 1.0)`:t?_`vec4(gridColor(uv), 1.0)`:_`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${o?_`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:_`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(a&&!n||s)?_`colorLayer * opacity;`:_`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let Bu=class extends HE{constructor(e,t,r,s,a,n){super(e,s,a),this.colormap=t,this.symbolizer=r,this.u_colormap=n,this.backgroundColor=Ea,this.fboTexture=null,this.baseOpacity=1}},WE=class extends Bu{},QE=class extends Bu{};function ZE(i){const e=new At;return e.include(hw),e.include(kE,i),e.include(qE,i),e.include(dw,i),e.fragment.code.add(_`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),i.colorizerType===co.Stretch?YE(e,i):i.colorizerType===co.Lut?XE(e):i.colorizerType===co.Hillshade&&KE(e,i),e}function XE(i){i.fragment.code.add(_`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function YE(i,e){i.fragment.uniforms.add(new ov("u_bandCount",r=>r.symbolizer.u_bandCount),new Ca("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Ca("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Ca("u_factor",r=>r.symbolizer.u_factor,3),new Ue("u_minOutput",r=>r.symbolizer.u_minOutput),new Ue("u_maxOutput",r=>r.symbolizer.u_maxOutput),new eh("u_useGamma",r=>r.symbolizer.u_useGamma),new Ca("u_gamma",r=>r.symbolizer.u_gamma,3),new Ca("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new Ue("u_opacity",r=>r.common.u_opacity)),i.fragment.code.add(_`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const t=e.applyColormap?_`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:_`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;i.fragment.code.add(_`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===vo.Noop?_`
        fragColor = applyBackgroundBlend(currentPixel);`:_`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${t}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function KE(i,e){const t=i.fragment;t.uniforms.add(new ke("u_image",s=>s.u_image),new ov("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Ca("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Ca("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Ca("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Ca("u_weights",s=>s.symbolizer.u_weights,6),new Si("u_factor",s=>s.symbolizer.u_factor),new Ue("u_minValue",s=>s.symbolizer.u_minValue),new Ue("u_maxValue",s=>s.symbolizer.u_maxValue),new Si("u_srcImageSize",s=>s.common.u_srcImageSize)),t.include(iv),t.code.add(_`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),t.code.add(_`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?_`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:_`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;t.code.add(_`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const JE=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:QE,ColorizerStretchUniforms:WE,ColorizerUniforms:Bu,build:ZE},Symbol.toStringTag,{value:"Module"})),i1={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let eA=class{constructor(e,t,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=t,this.width=r||t.width,this.height=s||t.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=De(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...i1,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||i1}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((t,r)=>{var s;return!!((s=this._bandIds)!=null&&s[r])&&t===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const t=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(t==="bilinear"?Da.LINEAR:Da.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=De(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=zP(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:t,width:r,height:s,opacity:a}=this,n=qP(t,[r,s],[this.source.width,this.source.height],a),o=BP(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?HP(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?kP(this.symbolizerParameters):null;return new Bu(n,o,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(t=>t!=null?t.descriptor.width*t.descriptor.height*4:0).reduce((t,r)=>t+r,0)}return this._memoryUsed}release(){return this._rasterTexture=De(this._rasterTexture),this._transformGridTexture=De(this._transformGridTexture),this._colormapTexture=De(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,t){const r=this.source?this.source.extractBands(t):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=De(this._rasterTexture));const s=t==null&&this.bandIds==null||t!=null&&this.bandIds!=null&&t.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&s)return;this._rasterTexture=De(this._rasterTexture);const a=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=GP(e,r,a,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((s,a)=>s!==t[a])?(this._colormapTexture=De(this._colormapTexture),this._colormapTexture=Af(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Af(e,r),void(this._colormap=r)):(this._colormapTexture=De(this._colormapTexture),void(this._colormap=null))}},Ld=class{constructor(){this.waitingAgents=new Et,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const t=Up.acquire();return t._init(e),t}release(){this.dispose(),$d.delete(this),Up.release(this)}dispose(){this.loadingAgent=De(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=gl(this._data)}static prune(){Up.prune(0)}_init(e){this.waitingAgents.clear(),this._data=gl(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=wo(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,t){if(e!==t&&t!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData(),VE(e,t,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){gl(this._data),this._data=e}};const Up=new bn(Ld,null,()=>{}),$d=new Map;function tA(){$d.size>0&&(console.log(`${$d.size} live TilePerLayerInfo allocations:`),$d.forEach(i=>console.log(i,`
`)))}let yc=class{constructor(e,t){this._texture=e,this._cache=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){if(--this._refCount,this._refCount===0)if(this._cache){const e=`${this._texture.descriptor.width} ${this._texture.descriptor.pixelFormat}`;this._cache.put(e,this)}else this.dispose()}dispose(){this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get usedMemory(){return this._texture.gpuMemoryUsage}};var ne;(function(i){i[i.NONE=0]="NONE",i[i.SPLIT=1]="SPLIT",i[i.ELEVATION=2]="ELEVATION",i[i.MERGE=4]="MERGE",i[i.RENDERDATA=8]="RENDERDATA",i[i.GEOMETRY=16]="GEOMETRY",i[i.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",i[i.TEXTURE_FADING=64]="TEXTURE_FADING"})(ne||(ne={}));const iA=.1;let ag=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=Yt(),this._elevationBounds=yi(),this.layerInfo=[[],[]],this.extentInRadians=Yt(),this.centerAtSeaLevel=b(),this._center=[b(),ta(),b()],this.up=x2(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=b()}static prune(){ng.prune(0),og.prune(0),Ld.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[qt.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,t=(e==null?void 0:e.frustumVisibility)??rr.INTERSECTS;this._frustumVisibility=t===rr.INSIDE?rr.INSIDE:t===rr.OUTSIDE?rr.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==rr.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,t,r,s,a){this.lij[0]=e,this.lij[1]=t,this.lij[2]=r,this.ellipsoid=Tt(a.tilingScheme.spatialReference),a.tilingScheme.getExtent(e,t,r,this.extent),a.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,a.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[qt.MIDDLE][3]=0,this.elevationLevel=e,s&&s.elevationBounds?za(this._elevationBounds,s.elevationBounds):Gr(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=s,this.unsetChildren(),this._surface=a,this.updateVisibility();for(const n of Zn){const o=a.numLayers(n),l=this.layerInfo[n];for(const c of l)c.release();l.length=o;for(let c=0;c<o;c++)l[c]=Ld.acquire(this._surface.upsampleInfoPool),n===Ce.ELEVATION&&this.findElevationBoundsForLayer(c,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(a.tilingScheme.pixelSize,ac)}dispose(){Ns(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of Zn){for(const t of this.layerInfo[e])t.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Ce.MAP].reduce((e,t)=>e+(t instanceof cp?t.memoryUsed/t.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const t=this._surface.tilingScheme.pixelSize;return t*t*4}_ensureUsedMemory(){var r;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=this._baseUsedMemory,this._mapTileMemoryInternal=0;let e=0;for(const{data:s}of this.layerInfo[Ce.MAP])s instanceof cp?e+=this._getTerrainDataMemory(s):this._mapTileMemoryInternal+=this._getTerrainDataMemory(s);const t=this._cpuImageMemorySize;for(const s of this.layerInfo[Ce.ELEVATION])this._usedMemory+=s.data?t:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((r=this.renderData.texture)==null?void 0:r.usedMemory)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,t){const r=this.layerInfo[e][t];return r!=null&&r.data?e===Ce.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===Ce.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof yc?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof uC?this._cpuImageMemorySize:e instanceof eA?e.memoryUsage:e instanceof cp?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const t=this._center[qt.MIDDLE],r=e,s=t[0],a=t[1],n=t[2],o=r[2]*s+r[6]*a+r[10]*n+r[14];this.screenDepth=o<0?0:o/(r[3]*s+r[7]*a+r[11]*n+r[15])}shouldSplit(e,t,r){if(!this.visible||e.frustum&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===rr.OUTSIDE))return ne.NONE;const s=this.level;pe(od,this._center[qt.MIDDLE],t);let a=gs(od),n=od,o=qt.MIDDLE;pe(zp,this._center[qt.TOP],t);const l=gs(zp);l<a&&(a=l,n=zp,o=qt.TOP),pe(qp,this._center[qt.BOTTOM],t);const c=gs(qp);if(c<a&&(a=c,n=qp,o=qt.BOTTOM),this._edgeLen2>a&&s<e.maxLod)return ne.SPLIT;const d=r!=null?r-s:1/0,p=Math.sqrt(a),m=e.fovX*p*2,g=this._edgeLen/m,f=()=>{if(s<e.maxLod)return this.elevationLevel=s,ne.NONE;const O=s+Math.ceil(-Math.log2(e.relativeWidthLimit/g));return O!==this.elevationLevel?(this.elevationLevel=O,ne.ELEVATION):ne.NONE};if(d<=.5)return f();const y=Ie(this.up,od),v=this._elevationBounds[1]-this._elevationBounds[0],T=v/this.edgeLen;if(e.aboveGround&&y>0&&T<.001&&y/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-T>0)return ne.NONE;const w=r!=null?3-Math.min(d,2):1;if(g*w<e.relativeWidthLimit||s>=e.maxLod)return f();if(s<7)return ne.SPLIT;J(di,this.up,y),pe(di,di,n);const x=gs(di);if(x<=this.radius*this.radius)return ne.SPLIT;J(di,di,this.radius/Math.sqrt(x)),me(di,di,this._center[o]),pe(di,t,di);const C=Math.min(1,(Math.abs(Ie(di,this.up))+.5*v+this._curvatureHeight)/ve(di)),P=iA/e.angledSplitBias,R=e.fovY*p*2;return C*(this._edgeLen/R*w)<P*e.relativeHeightLimit?ne.NONE:ne.SPLIT}setChildren(e,t,r,s){Ns(!!(e&&t&&r&&s),"Null child passed"),this._children[0]=e,this._children[1]=t,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of Zn)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const t of Zn){const r=this.layerInfo[t];for(const s of r)s.loadingAgent&&s.loadingAgent!==hr&&(nd(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(ne.GEOMETRY),this.resetPendingUpdate(ne.TEXTURE_NOFADING),this.resetPendingUpdate(ne.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Ce.MAP];for(const t of e)t.loadingAgent&&t.loadingAgent!==hr&&(nd(t.loadingAgent),t.loadingAgent=null),t.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(oo(e,this._clippingArea))return!1;const t=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const s=r&&this._isWithinClippingArea,a=!(r||t||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||a||this.setPendingUpdate(ne.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,t){return this.layerInfo[t][e]}hasLayerData(e,t){const r=this.layerInfo[t][e];return!(!(r!=null&&r.data)||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of Zn){const t=this.layerInfo[e];for(const r of t)if(r.loadingAgent&&r.loadingAgent!==hr&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(ne.SPLIT)||e!==Ce.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===ne.SPLIT||e===ne.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,t,r){const s=this.layerInfo[t][e];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),t,e);const o=s.data&&"type"in s.data&&s.data.type==="vector-tile";return r.dataArrived(this,o),!0}if(s.requestPromise)return!0;wo(s.requestAbort),s.requestAbort=new AbortController;const a=this._surface.requestTileData(this,e,t,s.requestAbort);if(!a)return s.requestAbort=null,!1;const n=()=>{s.requestPromise===a&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=a,a.then(n,n),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const t=this._children;return t[0]?t[0].findByLij(e)||t[1].findByLij(e)||t[2].findByLij(e)||t[3].findByLij(e):null}distanceToSquared(e){return gs(pe(di,this._center[qt.MIDDLE],e))}containsPoint(e){const t=this.extent;return e[0]>=t[0]&&e[1]>=t[1]&&e[0]<=t[2]&&e[1]<=t[3]}containsPointXY(e,t){const r=this.extent;return e>=r[0]&&t>=r[1]&&e<=r[2]&&t<=r[3]}unrequestLayerData(e,t,r){const s=this.layerInfo[t][e],a=s.waitingAgents,n=a.removeUnordered(r)!=null;Ns(n,"agent has not requested this piece of map data"),a.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(e,t,r){const s=r!=null&&"type"in r&&r.type==="vector-tile",a=this.layerInfo[t][e];a.data=r,a.dataInvalidated=!1,a.waitingAgents.forAll(n=>n.dataArrived(this,s)),a.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,t,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${t}/${e} error ${r}`);const s=this.layerInfo[t][e];s.dataMissing=!0,s.waitingAgents.forAll(a=>a.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,t,r){switch(r&&this.forEachLoadedNeighbor(s=>s.updateRenderData(e,t)),e){case Ce.MAP:return this._updateTexture(t);case Ce.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===ni.FADING?ne.TEXTURE_NOFADING:ne.TEXTURE_FADING),this.setPendingUpdate(e===ni.FADING?ne.TEXTURE_FADING:ne.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(ne.GEOMETRY);for(const e of this.layerInfo[Ce.ELEVATION])e.pendingUpdates|=ne.GEOMETRY}invalidateLayerData(e,t){this.layerInfo[t][e].invalidateSourceData(),this.restartAgents(t)}computeElevationBounds(){const e=this._elevationBounds,t=e[0],r=e[1];Gr(e,1/0,-1/0);const s=this.layerInfo[Ce.ELEVATION];let a=!0;for(const n of s)n.elevationBounds!=null&&(e[0]=Math.min(e[0],n.elevationBounds.min),e[1]=Math.max(e[1],n.elevationBounds.max),n.elevationBounds.hasNoDataValues||(a=!1));a&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),t===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,t=.5*(e[0]+e[1]),r=this._center;J(di,this.up,t),me(r[qt.MIDDLE],this.centerAtSeaLevel,di),J(di,this.up,e[0]),me(r[qt.TOP],this.centerAtSeaLevel,di),J(di,this.up,e[1]),me(r[qt.BOTTOM],this.centerAtSeaLevel,di)}findElevationBoundsForLayer(e,t){const r=this.layerInfo[Ce.ELEVATION][e],s=fm(this.level),a=Math.max(this.elevationLevel-s,0),n=r.elevationBounds;if(n!=null&&n.level>=t&&n.level<=a)return;const o=this._surface.layerViewByIndex(e,Ce.ELEVATION),l=gm(o);if(!Fc(this,l,!1))return;const c=sA;let d=!1;const p=r.data;if(p&&p.level<=a){const m=r.data;c.min=m.samplerData.data.minValue,c.max=m.samplerData.data.maxValue,c.hasNoDataValues=m.samplerData.data.hasNoDataValues,c.level=this.level,d=!0}else{let m,g,f=0;for(let y=this._parent;y&&(!g||f<s)&&(f=this.elevationLevel-y.level,m=g||m,g=y.layerInfo[Ce.ELEVATION][e].data,!(!g&&m&&y.level<=a));y=y.parent);g=g||m,g&&(g.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=g.level,d=!0))}d&&(r.elevationBounds==null&&(r.elevationBounds=new ul),r.elevationBounds.copyFrom(c))}modifyLayers(e,t,r){const s=this.layerInfo[r];for(const o of s)o.loadingAgent&&o.loadingAgent!==hr&&(nd(o.loadingAgent),o.loadingAgent=null),o.waitingAgents.clear();for(let o=0;o<s.length;++o)e[o]===void 0&&s[o].release();const a=new Array(...s),n=t.length;s.length=n;for(let o=0;o<n;o++){const l=t[o];s[o]=l>-1?a[l]:Ld.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,ni.FADING))}updateAgents(e){if(this.renderData){const t=this.layerInfo[e];for(const r of t)r.loadingAgent===hr&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of Zn){const t=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==hr&&(r.loadingAgent.setSuspension(t),r.loadingAgent===hr&&this.updateRenderData(e,ni.FADING))}}removeLayerAgent(e,t){const r=this.layerInfo[t][e];r.loadingAgent&&r.loadingAgent!==hr&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,t){const r=this.layerInfo[t][e];r.loadingAgent=hr,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,t)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||Sl(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,t,r){var s,a,n;for(let o=e;o<t;++o){const l=this._surface.layerViewByIndex(o,r);if(Jc(l)&&((s=l==null?void 0:l.layer)==null?void 0:s.blendMode)!=="normal"||Sl((a=l==null?void 0:l.layer)==null?void 0:a.parent)&&this._hasBlendableAncestor((n=l==null?void 0:l.layer)==null?void 0:n.parent))return!0}return!1}_createOrUpdateAgents(e,t){const r=this.layerInfo[t];if(r.length===0)return;const s=this._isSuspended(t);for(let a=e;a<r.length;++a){const n=r[a];let o=!1;const l=this._surface.layerViewByIndex(a,t),c=gm(l);if(n.loadingAgent?Fc(this,c,!1)?(n.loadingAgent!==hr&&n.loadingAgent.setSuspension(s),n.loadingAgent!==hr&&(o=n.loadingAgent.update())):n.dispose():Fc(this,c,!1)&&(n.loadingAgent=rA(this,a,t,s),o=n.loadingAgent.startLoading(),o?n.loadingAgent===hr&&this.setPendingUpdate(ne.GEOMETRY):(nd(n.loadingAgent),n.loadingAgent=hr)),n.loadingAgent===hr&&this.updateRenderData(t,ni.FADING),!this._hasBlendModes(e,r.length,t)&&o&&l.isOpaque)return}}_isWithinExtent(e){const t=this.extent;return t[0]>=e[0]&&e[2]>=t[2]&&t[1]>=e[1]&&e[3]>=t[3]}intersectsExtent(e){const t=this.extent;return t[2]>=e[0]&&e[2]>=t[0]&&t[3]>=e[1]&&e[3]>=t[1]}getElevationVerticesPerSide(e){const t=this.elevationLevel-this.level,r=Math.max(this.level-e,fm(this.level)-t),s=K(1+(this.maxTesselation>>r),2,this.maxTesselation+1),a=this.getDefaultVerticesPerSide();return Math.max(s,a)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,t){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const s of r)if(aA(s,e)){let a=s,n=e[0]-a.level-1;for(;n>=0&&!a.isLeaf&&!t(a);){const o=e[1]>>n&1,l=e[2]>>n&1;a=a.children[2*o+l],n--}return t(a)?a:null}}return null}findNeighborTile(e,t){const r=this.lij,s=this.getNeighborLIJ(r,e);return s?nA(r,s)?t(this)?this:null:this._findLIJ(s,t):null}findCorner(e,t){const r=e===mt.NORTH_EAST?1:e===mt.NORTH_WEST?0:e===mt.SOUTH_WEST?2:3;let s=this;for(;s.children[0]&&(!t||!t(s));)s=s.children[r];return s}findNeighborCornerTileExact(e,t){var r;return((r=this.findNeighborTile(e,s=>t(s)||s.level===this.level))==null?void 0:r.findCorner(Xd(e),t))||null}forAllSubtreeOnSide(e,t){const r=e===mt.NORTH?[0,1]:e===mt.NORTH_EAST?[1]:e===mt.EAST?[1,3]:e===mt.SOUTH_EAST?[3]:e===mt.SOUTH?[2,3]:e===mt.SOUTH_WEST?[2]:e===mt.WEST?[0,2]:[0],s=a=>{const n=a.children;!t(a)&&n[0]&&r.forEach(o=>s(n[o]))};s(this)}getNeighborEdgeStartVertexIndex(e,t){if(!t)return 0;const r=this.level-t.level;if(A(!Ti||r>=0),r===0)return 0;const s=2**r,a=(1&e)==1,n=a?0:1,o=t.lij[n+1]*s,l=this.lij[n+1],c=l-o,d=a?s-1-c:c;return Ti&&(A(o<=l&&l<o+s),A(0<=d&&d<s)),d}forEachLoadedNeighbor(e){const t=this.level,r=s=>s.level===t||s.isLoaded;Sa.forEach(s=>{const a=this.findNeighborTile(s,r);a!=null&&a!==this&&a.forAllSubtreeOnSide(C_(s),n=>!!n.isLoaded&&(e(n,s),!0))}),Yd.forEach(s=>{var n;const a=(n=this.findNeighborTile(s,r))==null?void 0:n.findCorner(Xd(s),o=>o.isLoaded);A(!a||e_(this,a,s)),a!=null&&a.isLoaded&&e(a,s)})}getNeighborLIJ(e,t){const r=rf(t)?-1:sf(t)?1:0,s=af(t)?-1:nf(t)?1:0,a=[e[0],e[1]+r,e[2]+s];return a[1]<0?null:this.surface.isGlobal?this.wrapLIJ(a):a[2]<0?null:a}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,t=(e==null?void 0:e[1])??null;return t!=null&&this.extent[1]+T2()>=t}checkGeometryWaterproofness(){var e;ym&&(A(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const t=this.extent,r=this.surface.rootTilesExtent,s=.25*(t[2]-t[0]);if(rf(e)&&t[3]+s>=r[3]||sf(e)&&t[1]-s<=r[1])return!1;const a=this.surface.isGlobal;return!(!a&&af(e)&&t[0]-s<=r[0])&&!(!a&&nf(e)&&t[2]+s>=r[2])}updateDistanceToPOI(e){const t=this._lastPOI;if(this.distanceToPOI>=0&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return;ae(this._lastPOI,e);const r=this._center[qt.MIDDLE],s=e[0]-r[0],a=e[1]-r[1],n=e[2]-r[2];this.distanceToPOI=s*s+a*a+n*n}};function rA(i,e,t,r){const s=t===Ce.ELEVATION?og.acquire():ng.acquire();return s.init(i,e,t,r),s}function nd(i){i.dispose(),i instanceof ow?og.release(i):i instanceof lw&&ng.release(i)}const ng=new bn(lw),og=new bn(ow),sA=new ul;var qt;function aA(i,e){const t=i.level,r=e[0];if(t>r)return!1;const s=r-t,a=Math.floor(e[1]/2**s),n=Math.floor(e[2]/2**s);return a===i.lij[1]&&n===i.lij[2]}function nA(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}function oA(i,e,t){if(i==null||e==null)return!1;if(i.level===0&&e.level===0&&(i.isEastEnd&&e.isWestEnd&&t===mt.EAST||i.isWestEnd&&e.isEastEnd&&t===mt.WEST))return!0;const r=Math.max(1e-6*(i.extent[2]-i.extent[0]),1);switch(t){case mt.NORTH:return qr(i.extent[3],e.extent[1],r);case mt.SOUTH:return qr(i.extent[1],e.extent[3],r);case mt.EAST:return qr(i.extent[2],e.extent[0],r)||qr(i.extent[2],-e.extent[0],r);case mt.WEST:return qr(i.extent[0],e.extent[2],r)||qr(i.extent[0],-e.extent[2],r)}}function e_(i,e,t){return i!=null&&e!=null&&e!==i&&(i.level>=e.level?r1(i,e,t):r1(e,i,Xd(t)))}function r1(i,e,t){A(i.level>=e.level);const r=pC(t),s=mC(t),a=i.extent,n=e.extent,o=[r?a[0]:a[2],s?a[3]:a[1]],l=[r?n[2]:n[0],s?n[1]:n[3]],c=1e-5*(a[2]-a[0]),d=qr(o[0],l[0],c)||i.surface.isGlobal&&qr(o[0],-l[0],c),p=qr(o[1],l[1],c);if(d&&p)return!0;if(i.level===e.level)return A(!1),!1;if(!d&&!p)return A(!1),!1;const m=d?s1(n[1],n[3],a[1],a[3],c):s1(n[0],n[2],a[0],a[2],c);return A(m),m}function s1(i,e,t,r,s){return i-s<=t&&t<=r&&r<=e+s}(function(i){i[i.TOP=0]="TOP",i[i.MIDDLE=1]="MIDDLE",i[i.BOTTOM=2]="BOTTOM"})(qt||(qt={}));const od=b(),zp=b(),qp=b(),di=b();let lA=class{constructor(){this._scales=Zr(-1,-1,-1,-1),this._offsets=Zr(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,t,r){this._scales[2*e]=t,this._scales[2*e+1]=r}setOffset(e,t,r){this._offsets[2*e]=t,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function cA(i,e){i.varyings.add("tbnTangent","vec3"),i.varyings.add("tbnBiTangent","vec3"),e.spherical?i.vertex.code.add(_`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):i.vertex.code.add(_`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),i.fragment.code.add(_`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}var Zs;(function(i){i[i.LayerOnly=0]="LayerOnly",i[i.ColorComposite=1]="ColorComposite",i[i.GridComposite=2]="GridComposite",i[i.COUNT=3]="COUNT"})(Zs||(Zs={}));let hA=class extends R_{constructor(){super(...arguments),this.overlayOpacity=1}};function dA(i,e){const{vertex:t,fragment:r,varyings:s}=i;s.add("vtc","vec2"),t.uniforms.add(new a1("texOffsetAndScale")),r.uniforms.add(new n1("tex")),r.uniforms.add(new Bp("textureOpacities"));const a=e.textureFadingEnabled&&!e.renderOccluded;a&&(t.uniforms.add(new a1("nextTexOffsetAndScale")),s.add("nvtc","vec2"),r.uniforms.add(new n1("texNext")),r.uniforms.add(new Bp("nextTexOpacities")),r.uniforms.add(new uA("fadeFactor")));const n=e.tileBlendInput===Zs.ColorComposite,o=e.tileBlendInput===Zs.GridComposite;o&&r.include(sg),n&&r.uniforms.add(new Bp("backgroundColor")),t.code.add(_`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${a?_`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:_``}
  }`),r.code.add(_`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${o||n?_`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${n?_`backgroundColor`:_`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:_`return color;`}
    }`),a?r.code.add(_`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(_`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let uA=class extends Il{constructor(e){super(e,"float")}},Bp=class extends Il{constructor(e){super(e,"vec3")}},a1=class extends Il{constructor(e){super(e,"vec4")}},n1=class extends Il{constructor(e){super(e,"sampler2D")}},uw=class extends hA{};function pA(i){const e=new At,{vertex:t,fragment:r,varyings:s}=e;e.include(VC),e.include(UC,i),e.include(Lu,i);const a=()=>{e.include(m3,i),t.code.add(_`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};zC(t,i),e.include(rv,i);const n=i.overlayMode!==Jd.Disabled,o=n&&i.invisible;switch(i.output){case M.Color:{e.include(dA,i),e.include(au,i),n&&e.include(kl,{...i,pbrMode:i.pbrMode===Qt.Terrain?Qt.TerrainWithWater:Qt.Water});const l=i.overlayMode===Jd.EnabledWithWater;l&&e.include(cA,i),s.add("vnormal","vec3"),s.add("vpos","vec3"),s.add("vup","vec3"),a(),i.screenSizePerspective&&uf(t);const c=i.receiveShadows&&!i.renderOccluded;c&&e.include(cv,i),i.screenSizePerspective&&(s.add("screenSizeDistanceToCamera","float"),s.add("screenSizeCosAngle","float")),t.code.add(_`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?_`forwardVertexTangent(vnormal);`:_``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${n?_`setOverlayVTC(uv);`:""}
          ${i.tileBorders?_`forwardTextureCoordinates();`:""}

          ${i.screenSizePerspective?_`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?_`forwardLinearDepth();`:""}

        }
      `),e.include(hv,i),e.include(au,i),e.include(mP,i),e.include(dv,i),qC(r,i),_P(r),$v(r),r.uniforms.add(t.uniforms.get("localOrigin"),new Ci("viewDirection",(d,p)=>ye(o1,Xt(o1,p.camera.viewMatrix[12],p.camera.viewMatrix[13],p.camera.viewMatrix[14])))),l&&r.uniforms.add(new ke("ovWaterTex",(d,p)=>{var m;return(m=p.overlay)==null?void 0:m.getTexture(ms.WaterNormal)}),new BC("view",(d,p)=>jc(mA,p.camera.viewMatrix,d.origin))),r.code.add(_`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),P_(r),uv(r),r.code.add(_`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${i.receiveShadows&&!i.renderOccluded?"readShadowMap(vpos, linearDepth)":i.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${n?_`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${i.invisible?_`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${i.pbrMode===Qt.Terrain||i.pbrMode===Qt.TerrainWithWater?_`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:_`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?_`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${i.screenSizePerspective?_`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${i.visualizeNormals?i.spherical?_`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:_`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${i.tileBorders?_`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case M.Depth:o&&e.include(kl,i),e.include(wm,i),pf(e),mf(e),t.code.add(_`
              void main(void) {
                ${o?_`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(_`
              void main() {
                ${o?_`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case M.Shadow:case M.ShadowHighlight:case M.ShadowExcludeHighlight:e.include(wm,i),pf(e),mf(e),t.code.add(_`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(_`void main() {
outputDepth(linearDepth);
}`);break;case M.Normal:o&&e.include(kl,i),s.add("vnormal","vec3"),uf(t),a(),t.code.add(_`
            void main(void) {
              ${o?_`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(_`
            void main() {
              ${o?_`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case M.Highlight:n&&e.include(kl,i),t.code.add(_`
          void main() {
            ${n?_`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(lv,i),r.code.add(_`
          void main() {
            ${n?_`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return i.output===M.ObjectAndLayerIdColor&&(n?(e.include(kl,{...i,pbrMode:Qt.Disabled}),t.code.add(_`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(_`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)):(t.code.add(_`void main(void) {}`),r.code.add(_`void main() {
fragColor = vec4(0.0);
}`))),e}const mA=nt(),o1=b(),_A=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:uw,build:pA},Symbol.toStringTag,{value:"Module"}));let pw=class mw extends $t{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,t){t.spherical=e.viewingMode===Ne.Global}initializeProgram(e){return new Mt(e.rctx,mw.shader.get().build(this.configuration),_w)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const t=this.configuration,r=t.backfaceCullingEnabled&&!t.renderOccluded;return Je({blending:t.renderOccluded?sa(G.ONE,G.ONE_MINUS_SRC_ALPHA):null,culling:r?Ov:null,depthTest:t.renderOccluded?null:{func:Pi.LESS},depthWrite:t.renderOccluded?null:L_,colorWrite:tt,stencilTest:e?HC(Oc.IntegratedMeshMaskExcluded):null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}};pw.shader=new Lt(_A,()=>ie(()=>import("./Terrain.glsl-aff7f2a8.js"),["assets/Terrain.glsl-aff7f2a8.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/vec2f32-eaf29605.js","assets/VerticalOffset.glsl-5743f98e.js","assets/symbolColorUtils-3ca646c8.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/ColorMaterial-bdf1f62a.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const _w=new Map([[se.POSITION,0],[se.UV0,1],[se.NORMALCOMPRESSED,2]]);let gA=class{constructor(){this.geometry=new OE,this.intersectionData=null,this.geometryState=null,this._textureRef=new rw(()=>this.tile.surface.textureFadeDuration),this.overlay=new lA,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const t=this.geometry;t.indices=null,t.vertexAttributes=null,Au(t.boundingBox),t.indexCount=0,t.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ME,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ti&&this.tile.intersectsClippingArea)for(let t=0;t<4;++t)A(this.geometry.outerEdges[t].count===this.geometryState.neighborData.edgeResolutions[t]+1)}_calculateEdgeResolution(e,t){var l;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return s}const a=r.level,n=Sa[e];if(!t)return A(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(n)),s;if(t.isLoaded){const c=t,d=c.renderData.geometryState,p=a-c.level;if(A(p>=0),p===0){const f=d.numVerticesPerSide-1;return Math.max(f,s)}const m=2**p,g=d.neighborData.edgeResolutions[(e+2)%4]/m;return Math.max(1,g)}A(!t.isLeaf);let o=s;return t.forAllSubtreeOnSide(C_(n),c=>c===r||(c.isLoaded?(o=Math.max(o,2**(c.level-a)),!0):(A(!c.isLeaf),!1))),o}updateNeighborData(){var o;const e=this.tile;if(!e.intersectsClippingArea)return;const t=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),s=t.edgePeerNeighbors,a=t.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Sa[l],r),d=io(e,c),p=((o=d==null?void 0:d.renderData)==null?void 0:o.geometryState.samplerDataVersion)??-1,m=s[l],g=d!==io(e,m),f=a[l]!==p;s[l]=c,(g||f)&&(a[l]=p,this._markEdgeDirty(l));const y=t.edgeResolutions[l],v=this._calculateEdgeResolution(l,c);A(Zc(v)),A(v>=1),t.edgeResolutions[l]=v,y!==v&&this._markEdgeResolutionDirty(l)}const n=t.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(Yd[l],r);n[l]=c;const d=io(e,s[l]),p=io(e,s[(l+1)%4]),m=io(e,c);ts[l]=m,ts[(l+1)%4]=p,ts[(l+2)%4]=e,ts[(l+3)%4]=d,A(ts.some(v=>(v==null?void 0:v.isLoaded)||v===e));const g=ts.reduce((v,T)=>Math.min(v,(T==null?void 0:T.level)??1/0),1/0);ts.forEach((v,T)=>{v&&(v==null?void 0:v.level)>g&&(ts[T]=null)}),A(ts.some(v=>(v==null?void 0:v.isLoaded)||v===e));const f=t.cornerNeighborData[l].cornerTiles,y=t.cornerNeighborData[l].cornerTileSamplerVersions;for(let v=0;v<4;++v){const T=ts[v],w=(T==null?void 0:T.renderData.geometryState.samplerDataVersion)??-1,x=f[v]!==T,C=!x&&y[v]!==w;(x||C)&&(f[v]=T,y[v]=w,this._markCornerDirty(l))}A(f.some(v=>(v==null?void 0:v.isLoaded)||v===e))}Ti&&A(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)ts[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ti&&A(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const t=this.tile,r=this._vao,s=this.geometry.vertexAttributes,a=!r||!s||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,n=!a&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),o=!n&&this._dirtyCorners!==0;a?(this.releaseGeometry(),this._createGeometry(e)):n||o?t.updateEdgeElevations():o?t.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao=De(this._vao),this.geometry.release(),!0)}ensureTexture(e,t,r){const s=t?$i.RGBA:$i.RGB;return this._texture==null||this._texture.descriptor.width===e&&this._texture.descriptor.pixelFormat===s||this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const t=1<<e;this._dirtyCorners|=t}_markEdgeDirty(e){const t=1<<e;this._dirtyEdges|=t,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const t=1<<e;this._dirtyEdgeResolutions|=t,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),t=this.tile,r=e.samplerData?t.getElevationVerticesPerSide(e.maxTileLevel):t.getDefaultVerticesPerSide(),s=Math.max(r,5);let a=t.clippingArea;t.intersectsClippingArea&&!t.isWithinClippingArea||(a=null);const n=this.geometryState;let o=!1;n.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,n.numVerticesPerSide=s,n.samplerDataVersion++,o=!0),e.changed&&(this._samplerDataChanged=!0,n.samplerData=e.samplerData,n.samplerDataVersion++,o=!0),y_(n.clippingArea,a)||(this._clippingAreaChanged=!0,n.clippingArea=a,o=!0);const l=t.surface.wireframe;return n.wireframe!==l&&(this._wireframeChanged=!0,n.wireframe=l,o=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=o),o&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const t=this.geometry.vertexAttributes,r=this.geometry.indices,s=e.gl;this._vao=new To(e,_w,{geometry:Rn(t.layout)},{geometry:Lr.createVertex(e,s.STATIC_DRAW,t.buffer)},Lr.createIndex(e,s.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,t=Ia.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,t)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,t=this.tile.layerInfo[Ce.ELEVATION],r=t.length,s=new Array(r);let a=0,n=0,o=!1;for(let d=0;d<r;d++){const p=t[d];if(p.upsampleInfo!=null){const m=p.upsampleInfo.tile,g=m.layerInfo[Ce.ELEVATION][d].data,f=g&&g.samplerData;e&&e[a]===f||(o=!0),s[a++]=f,n=Math.max(n,m.lij[0])}else if(p.data){const m=this.tile.surface.layerViewByIndex(d,Ce.ELEVATION);if(Fc(this.tile,m.layer,!1)){const g=p.data;e&&e[a]===g.samplerData||(o=!0),s[a++]=g.samplerData,n=this.tile.level}}}e!=null&&e.length!==a&&(o=!0);const l=a>0,c=l?s:null;return l&&(s.length=a),{changed:o,samplerData:c,maxTileLevel:n}}get estimatedGeometryMemoryUsage(){var t,r,s;const e=((t=this.intersectionData)==null?void 0:t.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((s=this.geometry.vertexAttributes)==null?void 0:s.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ti)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void A(e==null?void 0:e.isLoaded);const t=e.surface.extent;if(t!=null&&!e.intersectsExtent(t))return;const r=Sa.map((o,l)=>t!=null&&(l<2?-1:1)*(e.extent[3-l]-t[3-l])<0),s=e.level;A(this._dirtyCorners===0),A(this._dirtyEdges===0),A(this._dirtyEdgeResolutions===0),A(!this._numVerticesPerSideChanged),A(!this._samplerDataChanged),A(!this._clippingAreaChanged),A(!this._wireframeChanged);const a=Yd.map(o=>e.findNeighborCornerTileExact(o,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(o=>o!=null&&o.intersectsClippingArea?o:null),n=this.geometryState.neighborData;for(let o=0;o<4;++o){const l=n.cornerPeerNeighbors[o],c=a[o];A(c===l,`Tile[${e.lij}].corner[${o}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Sa.forEach((o,l)=>{if(r[l])return;const c=e.findNeighborTile(o,oe=>(oe.level===s||(oe==null?void 0:oe.isLoaded))&&(oe==null?void 0:oe.intersectsClippingArea));if(!c){const oe=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(o);return void A(!oe)}A(c.isLoaded||c.level===e.level),A(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const d=s-c.level;if(!c.isLoaded)return A(!c.isLeaf),void A(d===0);const p=c.renderData;A(oA(e,c,o)),A(d>=0);const m=2**d;if(d<0)return void A(!1);const g=e.renderData,f=g.geometry,y=f.outerEdges[l],v=f.numVerticesPerSide-1,T=p.geometry;if(!T)return void A(!1);const w=this.geometryState.neighborData.edgePeerNeighbors[l];if(w!=null&&w.isLoaded){const oe=w.renderData;A(w==w),A(g.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===oe.geometryState.samplerDataVersion),A(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===oe.geometryState.samplerDataVersion)}const x=(l+2)%4,C=T.outerEdges[x],P=y.count-1,R=C.count-1;A(P*m===R,`Tile[${e.lij}]:e${l},res=${P} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${R} (expected:${P*m})`);const O=e.extent,L=o===mt.NORTH||o===mt.SOUTH,F=C.count-1,U=F/2**d,j=y.count-1;if(U<1)return void A(j===1);A(U===j),A(Zc(U));const k=T.numVerticesPerSide-1;A(d>0||U===Math.max(k,v));const W=e.getNeighborEdgeStartVertexIndex(l,c);A(0<=W&&W<m);const q=W*U;A(0<=q&&q<=F-U);let S=0,E=q;y.getVertexPos(Os,0),y.getVertexPos(Es,y.count-1);const Q=sr(Os,Es),ee=Math.max(fA,1e-4*Q);for(let oe=0;oe<=U;++oe){y.getVertexPos(Os,S),C.getVertexPos(Es,E);const be=oe/U,Fe=L?O[0]+be*(O[2]-O[0]):o===mt.WEST?O[0]:O[2],Pe=L?o===mt.SOUTH?O[1]:O[3]:O[1]+be*(O[3]-O[1]),Le=e.surface.extent;if(Le==null||C2(Le,Fe,Pe)){const Ee=$y(Os,Es),Qe=us(Os)-Fs.radius,Nt=us(Es)-Fs.radius,dt=Ee<ee;if(!dt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${S}/${y.count}] and [${c.lij}].edge${x}[${E}/${C.count}]`),Le!=null&&console.warn("  surface extent= ",Le," x,y=",Fe,",",Pe);const Xe=b();pe(Xe,g.localOrigin,p.localOrigin),us(Xe)>0&&console.warn(`   localOrigins: ${g.localOrigin} vs ${p.localOrigin} d=${us(Xe)} [${Xe}]`),(()=>{const Ae=vn(Os),B=vn(Es);e.updateEdgeElevations(),c.updateEdgeElevations(),y.getVertexPos(Os,S),C.getVertexPos(Es,E);const _e=b();Bi(_e,Os,Ae),us(_e)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ae} vs ${Os} d=${us(_e)} [${_e}]`),Bi(_e,Es,B),us(_e)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${B} vs ${Es} d=${us(_e)} [${_e}]`)})(),A(dt,`Mismatch in tile [${e.lij}].edge[${l}][${S}/${y.count}] vs neighbor [${c.lij}].edge[${x}][${E}/${C.count}] ${ha(Os)} vs ${ha(Es)}  dist=${Ee} h(t|n|d)=${Qe}|${Nt}|${Nt-Qe}`)}y.getNormal(Uo,S),C.getNormal(zo,E),ye(l1,Uo),ye(c1,zo);const ze=Ie(l1,c1),Ke=1-ze<.01||!1||e===c;if(!Ke){const Xe=b();Bi(Xe,Uo,zo);const Ae=()=>`Mismatch in tile edge normal ${of(e.lij)} (${S}/${y.count-1}) edge ${l} vs neighbor ${of(c.lij)}  (${E}/${C.count-1}) nedge ${x} :${ha(Uo)} vs ${ha(zo)}  dot = ${ze} : ${ha(Xe)}`;console.warn("Mismatch in tile edge normal: ",Ae());{e.updateEdgeElevations(),c.updateEdgeElevations();const B=b(),_e=b();y.getNormal(B,S),C.getNormal(_e,E),Qc(Uo,B)||console.warn("Missing update in tile normal: ",ha(Uo)," => ",ha(B)),Qc(zo,_e)||console.warn("Missing update in neighbor normal: ",ha(zo)," => ",ha(_e))}A(Ke,Ae())}}S+=1,E+=1}})}};const Os=b(),Es=b(),Uo=b(),zo=b(),l1=b(),c1=b(),fA=1,ts=[null,null,null,null];function io(i,e){return e!=null&&e.isLoaded||e===i?e:null}const yA=65536;function vA(i,e){const t=i.tile,{extent:r,extentInRadians:s,surface:a}=t,n=i.localOrigin,o=i.geometryState,l=a.isWebMercator,c=o.numVerticesPerSide,d=c-1,p=(c-2)**2,m=l&&(e===Vs.HAS_SOUTH_POLE||e===Vs.HAS_BOTH_POLES),g=l&&(e===Vs.HAS_NORTH_POLE||e===Vs.HAS_BOTH_POLES),f=6,y=((m?1:0)+(g?1:0))*f*(d+1),v=o.neighborData,T=v.edgeResolutions.reduce((L,F)=>L+F+1,0),w=p+y+T,x=a.renderer.tileGeometryCache.acquire(w),C=i.geometry;C.numVerticesPerSide=o.numVerticesPerSide,C.vertexAttributes=x;const P=C.boundingBox;Au(P);const R=lg(i);mi.update(d,s,R),bA(i),Pw(i,p),gw(i);const O=[];if((()=>{let L=p+T;const F=n[0],U=n[1],j=n[2],k=t.ellipsoid.radius,W=r[1],q=r[3],S=(E,Q)=>{const ee=Q*c;Wr(-F,-U,E*k-j,P),O.push({connectedRowOffset:ee,connectedOuterEdgeOffset:E===1?0:2,rowOffset:L,latitudeResolution:f});const oe=vw(E===-1?W:q,k),be=E*Math.PI/2-oe,Fe=.99*(E===1?1:-1),Pe=k+0,{position:Le,uv0:Ee}=x,{typedBuffer:Qe,typedBufferStride:Nt}=x.normalCompressed;for(let dt=1;dt<=f;++dt){const ze=oe+be*(dt/f),Ke=Math.cos(ze),Xe=Math.sin(ze);for(let Ae=0;Ae<=d;Ae++){const B=Ae/d,_e=mi.sinLonLUT[Ae],V=mi.cosLonLUT[Ae]*Ke,Y=_e*Ke,te=Xe,he=V*Pe-F,ge=Y*Pe-U,fe=te*Pe-j;Wr(he,ge,fe,P),Le.setValues(L,he,ge,fe),bs(Ee,L,B,Fe),Xc(Qe,L,V,Y,te,Nt),++L}}};m&&S(-1,0),g&&S(1,d)})(),Cw(C,o.numVerticesPerSide,O,[0,c-1],[0,c-1],o.wireframe),i.intersectionData=null,Ti)for(let L=0;L<4;++L)A(C.outerEdges[L].count===v.edgeResolutions[L]+1)}function bA(i){const e=i.tile;if(!e.intersectsClippingArea)return;const t=i.geometryState,r=t.numVerticesPerSide,s=r-2,a=r-1,n=i.geometry,o=n.vertexAttributes,l=o.position,c=o.uv0,{typedBuffer:d,typedBufferStride:p}=o.normalCompressed,m=e.extent,g=m[0],f=m[2],y=m[1],v=m[3],T=e.ellipsoid.radius,w=t.samplerData,x=i.localOrigin,C=x[0],P=x[1],R=x[2],O=l.typedBuffer,L=l.typedBufferStride,F=1/a,U=n.boundingBox;let j=0;if(1<=s){const k=F,W=y*(1-k)+v*k,q=mi.sinLatLUT[1],S=mi.cosLatLUT[1];for(let E=1;E<=s;E++){const Q=E*F,ee=g*(1-Q)+f*Q,oe=mi.sinLonLUT[E],be=mi.cosLonLUT[E],Fe=T+xt(ee,W,w),Pe=Fe*be*S-C,Le=Fe*oe*S-P,Ee=Fe*q-R;Wr(Pe,Le,Ee,U);const Qe=(E-1)*L;O[Qe]=Pe,O[Qe+1]=Le,O[Qe+2]=Ee,bs(c,E-1,Q,k)}}for(let k=1;k<=s;k++){const W=k*F,q=y*(1-W)+v*W,S=mi.sinLatLUT[k],E=mi.cosLatLUT[k],Q=k+1,ee=Q*F,oe=y*(1-ee)+v*ee,be=mi.sinLatLUT[Q],Fe=mi.cosLatLUT[Q],Pe=mi.sinLonLUT[0],Le=mi.cosLonLUT[0],Ee=T+xt(g,q,w);let Qe=Le*E*Ee-C,Nt=Pe*E*Ee-P,dt=S*Ee-R;const ze=j*L;let Ke=O[ze],Xe=O[ze+1],Ae=O[ze+2];for(let B=1;B<=s;B++){const _e=B*F,V=g*(1-_e)+f*_e,Y=mi.sinLonLUT[B],te=mi.cosLonLUT[B];let he=0,ge=0,fe=0;if(B<s){const je=(j+1)*L;he=O[je],ge=O[je+1],fe=O[je+2]}else{const je=mi.sinLonLUT[a],lt=mi.cosLonLUT[a],Ct=T+xt(f,q,w);he=lt*E*Ct-C,ge=je*E*Ct-P,fe=S*Ct-R}const it=Qe,H=Nt,we=dt;Qe=Ke,Nt=Xe,dt=Ae,Ke=he,Xe=ge,Ae=fe;const Z=he-it,le=ge-H,de=fe-we;let xe=0,$e=0,rt=0;if(k>1){const je=(j-s)*L;xe=O[je],$e=O[je+1],rt=O[je+2]}else{const je=mi.sinLatLUT[0],lt=mi.cosLatLUT[0],Ct=T+xt(V,y,w);xe=te*lt*Ct-C,$e=Y*lt*Ct-P,rt=je*Ct-R}const ut=T+xt(V,oe,w),st=te*Fe*ut-C,Re=Y*Fe*ut-P,Ge=be*ut-R;if(k<s){const je=j+s,lt=je*L;O[lt]=st,O[lt+1]=Re,O[lt+2]=Ge,Wr(st,Re,Ge,U),bs(c,je,_e,ee)}const Ze=xe-st,_t=$e-Re,vt=rt-Ge;let We=te*E,Be=Y*E,bt=S;bt*bt<.999&&(We=de*_t-le*vt,Be=Z*vt-de*Ze,bt=le*Ze-Z*_t);const ot=1/Math.sqrt(We*We+Be*Be+bt*bt);Xc(d,j,We*ot,Be*ot,bt*ot,p),++j}}}function wA(i){i.tile.intersectsClippingArea&&(gw(i),Hu(i))}function xA(i){i.tile.intersectsClippingArea&&(yw(i),fw(i,!0),Hu(i))}function gw(i){i.tile.intersectsClippingArea&&(yw(i),fw(i))}function fw(i,e=!1){const t=i.geometryState,r=i.geometry,s=t.neighborData,a=i.tile,n=a.level,o=a.extent,l=a.ellipsoid.radius,c=a.extentInRadians,d=c[0],p=c[2],m=c[1],g=c[3],f=t.samplerData,y=o[0],v=o[2],T=o[1],w=o[3],x=lg(i),C=r.boundingBox,P=i.localOrigin,R=P[0],O=P[1],L=P[2],F=r.vertexAttributes,U=F.position,j=U.typedBuffer,k=U.typedBufferStride,W=F.uv0;for(let q=0;q<4;++q){const S=q===1||q===3,E=s.edgeResolutions[q];A(Zc(E));const Q=E+1,ee=io(a,s.edgePeerNeighbors[q]);if(Ow(a,ee,q)){Sw(i,q,ee);continue}const oe=ee!=null;A(!oe||ee.level===a.level),A(!oe||Na(a,ee)<=0);const be=ee==null?void 0:ee.renderData,Fe=be==null?void 0:be.geometryState;if(Ti){const Z=a.surface;if(!ee&&Z&&!Z.updatingRootTiles){const le=Sa[q],de=a.findNeighborTile(le,xe=>xe.isLoaded||xe.isLeaf||xe.level===a.level);de?de.intersectsClippingArea&&(A(!de.isLoaded),A(!de.isLeaf),A(de.level===n)):A((Z==null?void 0:Z.rootTiles)==null||!a.shouldHaveNeighbor(le))}}const Pe=q===1?o[2]:o[0],Le=ee==null?void 0:ee.extent,Ee=Le&&S?q===1?Le[0]:Le[2]:Pe,Qe=q===0?o[3]:o[1],Nt=q===1?1:0,dt=q===0?1:0,ze=q===1?p:d,Ke=q===0?g:m,Xe=Math.sin(ze),Ae=Math.cos(ze),B=Math.sin(Ke),_e=Math.cos(Ke),V=Fe==null?void 0:Fe.samplerData,Y=oe?(Z,le,de)=>.5*(xt(Z,le,f)+xt(de,le,V)):(Z,le,de)=>xt(Z,le,f),te=r.outerEdges[q],he=e&&Q>3?Q-3:1,ge=f!=null&&f.some(Z=>Z!=null),fe=V!=null&&V.some(Z=>Z!=null),it=ge||fe,H=1/E,we=te.index0;A(!Le||qr(Le[2]-Le[0],o[2]-o[0])),(()=>{const Z=q===1?-1:q===3?1:0,le=q===0?-1:q===2?1:0,de=(o[2]-o[0])*H,xe=Z*de,$e=le*de,rt=S?Z*((p-d)*H):0,ut=S?0:le*H,st=dt,Re=S?ze+rt:ze,Ge=S?Math.sin(Re):Xe,Ze=S?Math.cos(Re):Ae,_t=S?ze-rt:ze,vt=S?Math.sin(_t):Xe,We=S?Math.cos(_t):Ae,Be=S?Ke:x(st+ut),bt=S?B:Math.sin(Be),ot=S?_e:Math.cos(Be),je=S?Ke:x(st-ut),lt=S?B:Math.sin(je),Ct=S?_e:Math.cos(je);let kt=0,Ri=0,Oi=0;{const qe=0*H,vi=S?Pe:y*(1-qe)+v*qe,Ii=S?Ee:vi,or=S?T*(1-qe)+w*qe:Qe,Wi=S?ze:d*(1-qe)+p*qe,Po=S?Xe:Math.sin(Wi),So=S?Ae:Math.cos(Wi),oa=S?x(qe):Ke,En=S?Math.sin(oa):B,la=S?Math.cos(oa):_e,ca=l+Y(vi,or,Ii);kt=So*la*ca,Ri=Po*la*ca,Oi=En*ca}let ji=0,zt=0,Pt=0;{const qe=1*H,vi=S?Pe:y*(1-qe)+v*qe,Ii=S?Ee:vi,or=S?T*(1-qe)+w*qe:Qe,Wi=S?ze:d*(1-qe)+p*qe,Po=S?Xe:Math.sin(Wi),So=S?Ae:Math.cos(Wi),oa=S?x(qe):Ke,En=S?Math.sin(oa):B,la=S?Math.cos(oa):_e,ca=l+Y(vi,or,Ii);ji=So*la*ca,zt=Po*la*ca,Pt=En*ca}for(let qe=1;qe<Q-1;qe+=he){let vi=0,Ii=0,or=0;{const lr=(qe+1)*H,Ps=S?Pe:y*(1-lr)+v*lr,Ba=S?Ee:Ps,Ni=S?T*(1-lr)+w*lr:Qe,Ha=S?ze:d*(1-lr)+p*lr,Mo=S?Xe:Math.sin(Ha),bh=S?Ae:Math.cos(Ha),zl=S?x(lr):Ke,wh=S?Math.sin(zl):B,ql=S?Math.cos(zl):_e,Do=l+Y(Ps,Ni,Ba);vi=bh*ql*Do,Ii=Mo*ql*Do,or=wh*Do}const Wi=vi,Po=Ii,So=or,oa=ji,En=zt,la=Pt;ji=Wi,zt=Po,Pt=So;{const lr=we+qe,Ps=lr*k,Ba=oa-R,Ni=En-O,Ha=la-L;j[Ps]=Ba,j[Ps+1]=Ni,j[Ps+2]=Ha,Wr(Ba,Ni,Ha,C);const Mo=qe*H;bs(W,lr,S?Nt:Mo,S?Mo:dt)}const ca=kt,Mx=Ri,Dx=Oi;kt=oa,Ri=En,Oi=la;const Vl=oa,Ul=En,Ro=la,vh=1/Math.sqrt(Vl*Vl+Ul*Ul+Ro*Ro),vg=Ro*vh;let Oo=0,Eo=0,Ao=0;if(it&&vg*vg<.999){let lr=0,Ps=0,Ba=0;{const Ni=q===0?-1:1;lr=Ni*(Wi-ca),Ps=Ni*(Po-Mx),Ba=Ni*(So-Dx)}{const Ni=qe*H,Ha=S?Pe:y*(1-Ni)+v*Ni,Mo=S?Ee:Ha,bh=S?T*(1-Ni)+w*Ni:Qe,zl=S?ze:d*(1-Ni)+p*Ni,wh=S?Xe:Math.sin(zl),ql=S?Ae:Math.cos(zl),Do=S?x(Ni):Ke,bg=S?Math.sin(Do):B,wg=S?Math.cos(Do):_e;let ju=Vl,Wu=Ul,Qu=Ro;if(oe){const An=l+xt(Mo-xe,bh-$e,V),Bl=S?wg:Ct;ju=(S?We:ql)*Bl*An,Wu=(S?vt:wh)*Bl*An,Qu=(S?bg:lt)*An}{const An=l+xt(Ha+xe,bh+$e,f),Bl=S?wg:ot,xg=(S?Ze:ql)*Bl*An,Tg=(S?Ge:wh)*Bl*An,Cg=(S?bg:bt)*An;oe||(ju=2*Vl-xg,Wu=2*Ul-Tg,Qu=2*Ro-Cg);const Zu=q===3?-1:1,Pg=Zu*(ju-xg),Sg=Zu*(Wu-Tg),Rg=Zu*(Qu-Cg);Oo=Ba*Sg-Ps*Rg,Eo=lr*Rg-Ba*Pg,Ao=Ps*Pg-lr*Sg;const Xu=1/Math.sqrt(Oo*Oo+Eo*Eo+Ao*Ao);Oo*=Xu,Eo*=Xu,Ao*=Xu}}}else Oo=Vl*vh,Eo=Ul*vh,Ao=Ro*vh;te.setNormalFromValues(qe,Oo,Eo,Ao)}})()}}function yw(i){Rw(i)}function vw(i,e){return Math.PI/2-2*Math.atan(Math.exp(-i/e))}function TA(i,e,t,r){return vw(i*(1-r)+e*r,t)}function CA(i,e,t){return i*(1-t)+e*t}function lg(i){const e=i.tile;if(e.surface.isWebMercator){const r=e.extent,s=e.ellipsoid.radius;return a=>TA(r[1],r[3],s,a)}const t=e.extentInRadians;return r=>CA(t[1],t[3],r)}function PA(i,e){const t=i.tile,{extent:r,surface:s}=t,a=i.geometryState,n=r[0],o=r[1],l=r[2]-n,c=r[3]-o,d=a.clippingArea,p=d!=null?Math.max(0,(d[0]-n)/l):0,m=d!=null?Math.max(0,(d[1]-o)/c):0,g=d!=null?Math.min(1,(d[2]-n)/l):1,f=d!=null?Math.min(1,(d[3]-o)/c):1,y=a.numVerticesPerSide,v=(y-2)**2,T=v+a.neighborData.edgeResolutions.reduce((P,R)=>P+R+1,0),w=s.renderer.tileGeometryCache.acquire(T),x=i.geometry,C=x.boundingBox;Au(C),x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=w,Va(x.uvRange,p,m,g,f),SA(i),Pw(i,v),bw(i),Cw(x,a.numVerticesPerSide,[],[0,y-1],[0,y-1],a.wireframe),i.intersectionData=null}function SA(i){const e=i.tile;if(!e.intersectsClippingArea)return;const t=e.surface,r=i.geometryState,s=r.samplerData,a=i.localOrigin,n=t.isWebMercatorOnPlateeCarree,o=r.clippingArea,l=o??cg,c=e.extent,d=c[0],p=c[1],m=c[2],g=c[3],f=Math.max(d,l[0]),y=Math.min(m,l[2]),v=Math.max(p,l[1]),T=Math.min(g,l[3]),w=e.ellipsoid.radius,x=e.horizontalScale,C=r.numVerticesPerSide,P=C-1,R=C-2,O=i.geometry,L=O.vertexAttributes,F=L.position,U=L.uv0,{typedBuffer:j,typedBufferStride:k}=L.normalCompressed,W=O.uvRange,q=W[0],S=W[1],E=W[2],Q=W[3],ee=O.boundingBox,oe=a[0],be=a[1],Fe=a[2],Pe=F.typedBuffer,Le=F.typedBufferStride;let Ee=0;const Qe=K(p,v,T),Nt=n?(Math.PI/2-2*Math.atan(Math.exp(-Qe/w)))*w:Qe*x,dt=1/P,ze=K(p*(1-dt)+g*dt,v,T);let Ke=Nt,Xe=n?(Math.PI/2-2*Math.atan(Math.exp(-ze/w)))*w:ze*x;for(let Ae=1;Ae<=R;Ae++){const B=Ae/P,_e=K(p*(1-B)+g*B,v,T),V=K(B,S,Q),Y=Xe,te=(Ae-1)/P,he=K(p*(1-te)+g*te,v,T),ge=Ke,fe=(Ae+1)/P,it=K(p*(1-fe)+g*fe,v,T),H=n?(Math.PI/2-2*Math.atan(Math.exp(-it/w)))*w:it*x,we=K(fe,S,Q);Ke=Xe,Xe=H;const Z=K(d,f,y);let le=Z*x,de=xt(Z,_e,s);const xe=1/P,$e=K(xe,q,E),rt=K(d*(1-$e)+m*$e,f,y);let ut=$e,st=rt,Re=rt*x,Ge=xt(rt,_e,s);if(Ae===1){const Ze=Re-oe,_t=Ke-be,vt=Ge-Fe,We=0*Le;Pe[We]=Ze,Pe[We+1]=_t,Pe[We+2]=vt,Wr(Ze,_t,vt,ee);const Be=K(xe,q,E);bs(U,Ee,Be,V)}for(let Ze=1;Ze<=R;Ze++){const _t=Re,vt=Ge,We=(Ze+1)/P,Be=K(We,q,E),bt=K(d*(1-We)+m*We,f,y),ot=st;st=bt;{const zt=Ee+1,Pt=zt*Le;if(Ae===1||Ze===R){const qe=bt*x,vi=xt(bt,_e,s);if(Ae===1&&Ze<R){const Ii=qe-oe,or=Y-be,Wi=vi-Fe;Pe[Pt]=Ii,Pe[Pt+1]=or,Pe[Pt+2]=Wi,Wr(Ii,or,Wi,ee),bs(U,zt,Be,V)}Re=qe,Ge=vi}else Re=Pe[Pt]+oe,Ge=Pe[Pt+2]+Fe}const je=Re,lt=Ge,Ct=le,kt=de;le=_t,de=vt;const Ri=(Ee-R)*Le,Oi=Ae===1?xt(ot,he,s):Pe[Ri+2]+Fe,ji=xt(ot,it,s);if(Ae<R){const zt=Ee+R,Pt=zt*Le,qe=_t-oe,vi=H-be,Ii=ji-Fe;Pe[Pt]=qe,Pe[Pt+1]=vi,Pe[Pt+2]=Ii,Wr(qe,vi,Ii,ee);const or=ut;ut=Be,bs(U,zt,or,we)}{const zt=je-Ct,Pt=ge-H,qe=Pt*(lt-kt),vi=zt*(Oi-ji),Ii=-Pt*zt,or=qe*qe+vi*vi+Ii*Ii;if(or===0)Xc(j,Ee,0,0,1,k);else{const Wi=1/Math.sqrt(or);Xc(j,Ee,qe*Wi,vi*Wi,Ii*Wi,k)}}++Ee}}}function RA(i,e){i.tile.intersectsClippingArea&&(xw(i),ww(i,!0),Hu(i))}function OA(i,e){i.tile.intersectsClippingArea&&(bw(i),Hu(i))}function bw(i,e){i.tile.intersectsClippingArea&&(xw(i),ww(i,!1))}function ww(i,e){const t=i.geometryState,r=t.neighborData,s=i.tile,a=s.surface,n=s.extent,o=t.clippingArea,l=o??cg,c=n[0],d=n[2],p=n[1],m=n[3],g=[m>l[3],d>l[2],p<l[1],c<l[0]],f=i.geometry,y=s.horizontalScale,v=Tw(a.isWebMercatorOnPlateeCarree,s.ellipsoid.radius,y),T=f.boundingBox,w=f.uvRange[0],x=f.uvRange[1],C=f.uvRange[2],P=f.uvRange[3],R=Math.max(c,l[0]),O=Math.min(d,l[2]),L=Math.max(p,l[1]),F=Math.min(m,l[3]),U=i.localOrigin,j=U[0],k=U[1],W=U[2],q=t.samplerData;for(let S=0;S<4;++S){const E=S===1||S===3,Q=r.edgeResolutions[S];A(Zc(Q));const ee=Q+1,oe=g[S],be=io(s,r.edgePeerNeighbors[S]);if(!oe&&Ow(s,be,S)){Sw(i,S,be);continue}const Fe=be!=null&&!oe,Pe=be==null?void 0:be.renderData,Le=Pe==null?void 0:Pe.geometryState;if(Ti&&(A(!Fe||be.level===s.level),A(!Fe||Na(s,be)<=0),s&&!be&&!a.updatingRootTiles)){const Z=Sa[S],le=s.findNeighborTile(Z,de=>de.isLoaded||de.isLeaf||de.level===s.level);a.updatingRootTiles||(le?le.intersectsClippingArea&&(A(!le.isLoaded),A(!le.isLeaf),A(le.level===s.level)):A((a==null?void 0:a.rootTiles)==null||!s.shouldHaveNeighbor(Z)))}const Ee=K(S===1?d:c,R,O),Qe=K(S===0?m:p,L,F),Nt=Le==null?void 0:Le.samplerData,dt=f.outerEdges[S],ze=e&&ee>3?ee-3:1,Ke=K(S===1?1:0,w,C),Xe=K(S===0?1:0,x,P),Ae=Fe?(Z,le)=>.5*(xt(Z,le,Nt)+xt(Z,le,q)):(Z,le)=>xt(Z,le,q),B=(d-c)/Q,_e=E?S===1?B:-B:0,V=E?0:S===0?B:-B,Y=-_e,te=-V;let he=0,ge=0,fe=0;{const Z=0/Q,le=E?Ee:K(c*(1-Z)+d*Z,R,O),de=E?K(p*(1-Z)+m*Z,L,F):Qe,xe=Ae(le,de);he=le*y,ge=v(de),fe=xe}let it=0,H=0,we=0;{const Z=1/Q,le=E?Ee:K(c*(1-Z)+d*Z,R,O),de=E?K(p*(1-Z)+m*Z,L,F):Qe,xe=Ae(le,de);it=le*y,H=v(de),we=xe}for(let Z=1;Z<ee-1;Z+=ze){const le=Z/Q,de=it,xe=H,$e=we;{const Be=E?Ke:K(le,w,C),bt=E?K(le,x,P):Xe,ot=de-j,je=xe-k,lt=$e-W;Wr(de,je,lt,T),dt.setVertexFromValuesRawPositionUV(Z,ot,je,lt,Be,bt)}{const Be=(Z+1)/Q,bt=E?Ee:K(c*(1-Be)+d*Be,R,O),ot=E?K(p*(1-Be)+m*Be,L,F):Qe,je=Ae(bt,ot);it=bt*y,H=v(ot),we=je}const rt=it,ut=we,st=he,Re=ge,Ge=fe;he=de,ge=xe,fe=$e;let Ze=0,_t=0,vt=0;if(E){const Be=H-xe,bt=ut-$e,ot=Re-xe,je=Ge-$e,lt=K(p*(1-le)+m*le,L,F),Ct=Ee+Y,kt=Ct*y-de,Ri=xt(Ct,lt,q)-$e,Oi=S===3?-1:1;if(Ze=Oi*(-ot+Be)*Ri,_t=Oi*kt*(-je+bt),vt=-Oi*kt*(-ot+Be),Fe){const ji=Ee+_e,zt=ji*y-de;Ze=(-ot+Be)*(Ri-(xt(ji,lt,Nt)-$e)),_t=(kt-zt)*(-je+bt),vt=-(kt-zt)*(-ot+Be)}}else{const Be=rt-de,bt=ut-$e,ot=st-de,je=Ge-$e,lt=K(c*(1-le)+d*le,R,O),Ct=Qe+te,kt=xt(lt,Ct,q)-$e,Ri=v(Ct)-xe,Oi=S===2?-1:1;if(Ze=Oi*Ri*(-je+bt),_t=Oi*(-ot+Be)*kt,vt=-Oi*Ri*(-ot+Be),Fe){const ji=lt,zt=Qe+V,Pt=v(zt)-xe;Ze=(-Ri+Pt)*(-je+bt),_t=(-ot+Be)*(-kt+(xt(ji,zt,Nt)-$e)),vt=-(-Ri+Pt)*(-ot+Be)}}const We=1/Math.sqrt(Ze*Ze+_t*_t+vt*vt);dt.setNormalFromValues(Z,Ze*We,_t*We,vt*We)}}}function xw(i,e){Rw(i)}function EA(i,e){return(Math.PI/2-2*Math.atan(Math.exp(-i/e)))*e}function AA(i,e){return i*e}function Tw(i,e,t){return i?r=>EA(r,e):r=>AA(r,t)}function Cw(i,e,t,r,s,a){const n=e-1,o=i.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,s[1])-Math.max(1,s[0])),c=Sa.map((x,C)=>C===0&&s[1]<e-2||C===1&&r[1]<e-2||C===2&&s[0]>1||C===3&&r[0]>1),d=i.outerEdges.reduce((x,C,P)=>x+(c[P]?0:n-2+C.count-1),0),p=t.reduce((x,C)=>x+n*(2*(C.latitudeResolution-1)+1),0),m=a?2:1,g=3*(l+d+p)*m,f=o>=yA?new Uint32Array(g):new Uint16Array(g);let y=0;const v=e-2,T=n-2;A(T>=0);const w=(x,C,P,R,O,L)=>{const F=x*O,U=L[F],j=L[F+1],k=L[F+2],W=C*O,q=L[W],S=L[W+1],E=L[W+2],Q=P*O,ee=L[Q],oe=L[Q+1],be=L[Q+2],Fe=R*O,Pe=L[Fe],Le=L[Fe+1],Ee=L[Fe+2];return(q-Pe)*(q-Pe)+(S-Le)*(S-Le)+(E-Ee)*(E-Ee)>(U-ee)*(U-ee)+(j-oe)*(j-oe)+(k-be)*(k-be)};if(a){const x=(P,R,O)=>{f[y++]=P,f[y++]=R,f[y++]=R,f[y++]=O,f[y++]=O,f[y++]=P,Ti&&(A(P<o),A(R<o),A(O<o),A(y<=g))};(()=>{for(let P=Math.max(s[0],1)-1;P<Math.min(s[1],e-2)-1;++P){const R=P*v;for(let O=Math.max(r[0],1)-1;O<Math.min(r[1],e-2)-1;++O){const L=P*v+O,F=L+1,U=F+v,j=U-1,k=R+O,W=k+1,q=W+v,S=q-1,E=i.vertexAttributes.position.typedBuffer,Q=i.vertexAttributes.position.typedBufferStride;w(k,W,q,S,Q,E)?(x(L,F,U),x(U,j,L)):(x(L,F,j),x(j,U,F))}}})(),A(y===3*l*m),(()=>{for(let P=0;P<4;++P){const R=y;if(c[P])continue;const O=i.outerEdges[P],L=i.innerEdges[P];let F=0,U=0;const j=O.count,k=L.count;A(k===n-1);let W=0;const q=P===1||P===2?(S,E,Q)=>x(S,E,Q):(S,E,Q)=>x(S,Q,E);for(;F<j-1||U<k-1;){const S=L.getVertexIndex(U),E=O.getVertexIndex(F),Q=F<j-1,ee=U<k-1;Q&&(!ee||(Q?0+n*(F+.5)/(j-1):0)<=(ee?1+T*(U+.5)/(k-1):0))?(++F,Ti&&A(F<j),q(S,E,O.getVertexIndex(F)),W++):(++U,Ti&&A(U<k),q(S,E,L.getVertexIndex(U)),W++)}Ti&&(A(F===j-1),A(U===k-1),A(W===j+k-2),A(W===n-2+O.count-1),A(y===R+3*W*m))}})(),A(y===3*(l+d)*m);const C=P=>{const R=i.outerEdges[P.connectedOuterEdgeOffset];let O=R.getVertexIndex(0),L=R.stride;for(let F=0;F<P.latitudeResolution;++F){const U=F===0?P.rowOffset:O+e;for(let j=0;j<n;j++)x(O,O+1,U+j),F<P.latitudeResolution-1&&x(O+1,U+j+1,U+j),O+=L;O=U,L=1}};t.forEach(C)}else{(()=>{const C=Math.max(s[0],1)-1,P=Math.min(s[1],e-2)-1,R=Math.max(r[0],1)-1,O=Math.min(r[1],e-2)-1;for(let L=C;L<P;++L){const F=L*v;for(let U=R;U<O;++U){const j=F+U,k=j+1,W=k+v,q=W-1,S=i.vertexAttributes.position.typedBuffer,E=i.vertexAttributes.position.typedBufferStride;w(j,k,W,q,E,S)?(f[y]=j,f[y+1]=k,f[y+2]=W,f[y+3]=W,f[y+4]=q,f[y+5]=j):(f[y]=j,f[y+1]=k,f[y+2]=q,f[y+3]=q,f[y+4]=k,f[y+5]=W),y+=6}}})(),A(y===3*l*m),(()=>{for(let C=0;C<4;++C){if(c[C])continue;const P=i.outerEdges[C],R=i.innerEdges[C];let O=0,L=0;const F=P.count,U=R.count;A(U===n-1);const j=C===1||C===2,k=j?1:2,W=j?2:1,q=P.index0,S=P.stride,E=R.index0,Q=R.stride;for(;O<F-1||L<U-1;){const ee=E+L*Q,oe=q+O*S,be=O<F-1,Fe=L<U-1,Pe=be&&(!Fe||(be?0+n*(O+.5)/(F-1):0)<=(Fe?1+T*(L+.5)/(U-1):0));Pe?++O:++L;const Le=Pe?oe+S:ee+Q;f[y]=ee,f[y+k]=oe,f[y+W]=Le,y+=3}}})(),A(y===3*(l+d)*m);const x=C=>{const P=i.outerEdges[C.connectedOuterEdgeOffset];let R=P.getVertexIndex(0),O=P.stride;for(let L=0;L<C.latitudeResolution;++L){const F=L===0?C.rowOffset:R+e;for(let U=0;U<n;U++){const j=F+U;f[y]=R,f[y+1]=R+1,f[y+2]=j,L<C.latitudeResolution-1?(f[y+3]=R+1,f[y+4]=j+1,f[y+5]=j,y+=6):y+=3,R+=O}R=F,O=1}};t.forEach(x)}A(y===g),i.indices=f,i.indexCount=g}function Pw(i,e){const t=i.localOrigin,r=i.geometry,s=i.geometryState.neighborData.edgeResolutions,a=r.numVerticesPerSide-2,n=r.vertexAttributes;let o=e;for(let l=0;l<4;++l){{const c=l===0||l===2,d=(l===0?a-1:0)*a+(l===1?a-1:0),p=(c?0:1)*a+(c?1:0);r.innerEdges[l]=new K0(n,t,d,p,a)}{const c=o,d=s[l]+1;r.outerEdges[l]=new K0(n,t,c,1,d),o+=d}}}function Sw(i,e,t){const r=(e+2)%4,s=i.geometryState,a=i.tile,n=s.neighborData,o=a.level-t.level,l=e===1||e===3,c=n.edgeResolutions[e];A(Zc(c));const d=c+1,p=i.geometry,m=p.boundingBox,g=p.outerEdges[e],f=p.uvRange[0],y=p.uvRange[1],v=p.uvRange[2],T=p.uvRange[3],w=K(e===1?1:0,f,v),x=K(e===0?1:0,y,T),C=t.renderData,P=C.geometryState,R=C.geometry.outerEdges[r],O=a.getNeighborEdgeStartVertexIndex(e,t)*c,L=c*2**o;A(P.neighborData.edgeResolutions[r]===L),A(R.count-1===L);const F=C.localOrigin[0]-i.localOrigin[0],U=C.localOrigin[1]-i.localOrigin[1],j=C.localOrigin[2]-i.localOrigin[2],k=g.attributes,W=g.index0,q=g.stride,S=k.position.typedBuffer,E=k.position.typedBufferStride,Q=k.normalCompressed.typedBuffer,ee=k.normalCompressed.typedBufferStride,oe=k.uv0,be=R.attributes,Fe=R.index0,Pe=R.stride,Le=be.position.typedBuffer,Ee=be.position.typedBufferStride,Qe=be.normalCompressed.typedBuffer,Nt=be.normalCompressed.typedBufferStride;for(let dt=1;dt<d-1;++dt){const ze=W+q*dt,Ke=Fe+Pe*(O+dt),Xe=ze*E,Ae=Ke*Ee,B=Le[Ae]+F,_e=Le[Ae+1]+U,V=Le[Ae+2]+j;S[Xe]=B,S[Xe+1]=_e,S[Xe+2]=V,Wr(B,_e,V,m);const Y=ze*ee,te=Ke*Nt;Q[Y]=Qe[te],Q[Y+1]=Qe[te+1];const he=dt/c,ge=l?w:K(he,f,v),fe=l?K(he,y,T):x;bs(oe,ze,ge,fe)}}function Rw(i){var Ae;const e=i.geometryState,t=e.neighborData,r=i.localOrigin,s=t.cornerNeighborData,a=i.geometry,n=a.outerEdges,o=a.boundingBox,l=i.tile,c=((Ae=i.tile.surface.view)==null?void 0:Ae.viewingMode)==="local",d=l.ellipsoid.radius,p=l.extentInRadians,m=l.horizontalScale;let g=0,f=0,y=0;const v=(B,_e,V)=>{const Y=p[_e===0?1:3],te=p[B===0?0:2],he=Math.cos(Y),ge=Math.sin(Y),fe=Math.sin(te),it=Math.cos(te),H=d+V;g=it*he*H,f=fe*he*H,y=ge*H},T=c?(()=>{const B=i.geometryState.clippingArea,_e=l.extent,V=B!=null&&(_e[3]>B[3]||_e[2]>B[2]||_e[1]<B[1]||_e[0]<B[0]),Y=Tw(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,m);return(te,he,ge)=>{const fe=te===0?W[0]:W[2],it=he===0?W[1]:W[3],H=V?K(fe,B[0],B[2]):fe,we=V?K(it,B[1],B[3]):it,Z=ge;g=H*m,f=Y(we),y=Z}})():v;let w=0,x=0,C=0,P=0,R=0,O=0,L=0,F=0,U=0;const j=c&&i.tile.surface.isWebMercatorOnPlateeCarree,k=(B,_e,V,Y,te)=>{let he=0,ge=0,fe=0;if(c){const it=_e*m,H=j?(Math.PI/2-2*Math.atan(Math.exp(-V/d)))*d:V*m;he=it-g,ge=H-f,fe=Y-y}else{const it=lg(B),H=B.tile,we=H.extent,Z=H.extentInRadians,le=(_e-we[0])/(we[2]-we[0]),de=(V-we[1])/(we[3]-we[1]),xe=Z[0]*(1-le)+Z[2]*le,$e=it(de),rt=Math.cos($e),ut=Math.sin($e),st=Math.sin(xe),Re=Math.cos(xe),Ge=d+Y;he=Re*rt*Ge-g,ge=st*rt*Ge-f,fe=ut*Ge-y}switch(te){case 0:L+=he,F+=ge,U+=fe;break;case 1:P-=he,R-=ge,O-=fe;break;case 2:L-=he,F-=ge,U-=fe;break;case 3:P+=he,R+=ge,O+=fe}},W=l.extent,q=e.clippingArea??cg,S=W[0],E=W[2],Q=W[1],ee=W[3],oe=[ee>q[3],E>q[2],Q<q[1],S<q[0]],be=Math.max(S,q[0]),Fe=Math.min(E,q[2]),Pe=Math.max(Q,q[1]),Le=Math.min(ee,q[3]),Ee=B=>Math.max(q[0],Math.min(q[2],B)),Qe=B=>Math.max(q[1],Math.min(q[3],B)),Nt=a.uvRange[0],dt=a.uvRange[1],ze=a.uvRange[2],Ke=a.uvRange[3],Xe=B=>{var it;const _e=s[B].cornerTiles;w=0,x=0,C=1,P=0,R=0,O=0,L=0,F=0,U=0;let V=1/0;for(let H=0;H<4;++H)V=Math.min(V,((it=_e[H])==null?void 0:it.level)??1/0);for(let H=0;H<4;++H){const we=_e[H];ic[H]=(we==null?void 0:we.level)===V?we:null}let Y=1,te=0;for(let H=0;H<4;++H){const we=ic[H];we&&(Y=Math.max(Y,we==null?void 0:we.renderData.geometryState.numVerticesPerSide),te=we.extent[2]-we.extent[0])}const he=te,ge=Y;A(ge>1);const fe=he/ge;for(let H=0;H<4;++H){const we=ic[(H+3)%4],Z=ic[H%4];if(!we&&!Z)continue;const le=H===0?1:H===1?2:H===2?3:0,de=H===0?2:H===1?3:H===2?0:1;if(we&&Z){const xe=Hp[H][0]*fe,$e=Hp[H][1]*fe,rt=we.extent,ut=Ee(rt[le===0||le===1?2:0]+xe),st=Qe(rt[le===0||le===3?3:1]+$e),Re=Z.extent,Ge=Ee(Re[de===0||de===1?2:0]+xe),Ze=Qe(Re[de===0||de===3?3:1]+$e),_t=we.renderData,vt=Z.renderData,We=xt(ut,st,_t.geometryState.samplerData),Be=xt(Ge,Ze,vt.geometryState.samplerData);k(_t,ut,st,.5*(We+Be),H)}else{const xe=we??Z,$e=we?le:de,rt=xe.extent,ut=Hp[H],st=Ee(rt[$e===0||$e===1?2:0]+ut[0]*fe),Re=Qe(rt[$e===0||$e===3?3:1]+ut[1]*fe),Ge=xe.renderData,Ze=xt(st,Re,Ge.geometryState.samplerData);k(Ge,st,Re,Ze,H)}}if(!c){const H=Math.sqrt(g*g+f*f+y*y);w=g/H,x=f/H,C=y/H}if(c||C*C<.999){const H=Math.sqrt(P*P+R*R+O*O);P/=H,R/=H,O/=H;const we=Math.sqrt(L*L+F*F+U*U);L/=we,F/=we,U/=we,w=O*F-R*U,x=P*U-O*L,C=R*L-P*F;const Z=1/Math.sqrt(w*w+x*x+C*C);w*=Z,x*=Z,C*=Z}};for(let B=0;B<4;++B){const _e=B,V=(B+1)%4,Y=B===0||B===1?1:0,te=B===0||B===3?1:0,he=K(Y,Nt,ze),ge=K(te,dt,Ke),fe=n[_e],it=B===0||B===3?fe.count-1:0,H=n[V],we=B===0||B===1?H.count-1:0,Z=s[B].cornerTiles;let le=-1;for(let $e=0;$e<4;++$e){const rt=Z[$e];rt&&(le===-1||Na(Z[le],rt)>0)&&(le=$e)}const de=le,xe=Z[de];if(xe!==l){const $e=l.level-xe.level,rt=2**$e,ut=[xe.lij[0]+$e,xe.lij[1]*rt,xe.lij[2]*rt],st=[ut[1]+rt===l.lij[1],B===0&&(de===1||de===0&&xe!==Z[3])||B===1&&(de===0||de===1&&xe!==Z[2]),ut[1]===l.lij[1]+1,B===2&&(de===3||de===2&&xe!==Z[1])||B===3&&(de===2||de===3&&xe!==Z[0])],Re=st.reduce((We,Be)=>We+(Be?1:0),0);A(Re===1||Re===2);let Ge=-1,Ze=-1;const _t=xe.renderData;if(Re===1){const We=st.findIndex(bt=>bt);A(0<=We&&We<=3),Ge=(We+2)%4;const Be=i.geometryState.neighborData.edgeResolutions[We];Ze=l.getNeighborEdgeStartVertexIndex(We,xe)*Be+Be*(We===0&&B===0||We===1&&B===0||We===2&&B===1||We===3&&B===3?1:0)}else{A(st[1]||st[3]),Ge=st[1]?3:1;const We=_t.geometryState.neighborData.edgeResolutions[Ge];Ze=B===0||B===3?0:We}const vt=_t.geometry.outerEdges[Ge];{const We=fe.index0+it*fe.stride,Be=H.index0+we*H.stride,bt=vt.index0+Ze*vt.stride;{const ot=vt.attributes.position,je=ot.typedBuffer,lt=bt*ot.typedBufferStride,Ct=i.localOrigin,kt=vt.localOrigin,Ri=je[lt]+kt[0]-Ct[0],Oi=je[lt+1]+kt[1]-Ct[1],ji=je[lt+2]+kt[2]-Ct[2];Wr(Ri,Oi,ji,o);{const zt=fe.attributes.position,Pt=zt.typedBuffer,qe=We*zt.typedBufferStride;Pt[qe]=Ri,Pt[qe+1]=Oi,Pt[qe+2]=ji}{const zt=H.attributes.position,Pt=zt.typedBuffer,qe=Be*zt.typedBufferStride;Pt[qe]=Ri,Pt[qe+1]=Oi,Pt[qe+2]=ji}}bs(fe.attributes.uv0,We,he,ge),bs(H.attributes.uv0,Be,he,ge);{const ot=vt.attributes.normalCompressed.typedBuffer,je=bt*vt.attributes.normalCompressed.typedBufferStride;{const lt=fe.attributes.normalCompressed,Ct=lt.typedBuffer,kt=We*lt.typedBufferStride;Ct[kt]=ot[je],Ct[kt+1]=ot[je+1]}{const lt=H.attributes.normalCompressed,Ct=lt.typedBuffer,kt=Be*lt.typedBufferStride;Ct[kt]=ot[je],Ct[kt+1]=ot[je+1]}}}}else{const $e=oe[_e],rt=oe[V];let ut;if($e||rt){const Ze=K(S*(1-Y)+E*Y,be,Fe),_t=K(Q*(1-te)+ee*te,Pe,Le),vt=e.samplerData;ut=xt(Ze,_t,vt)}else ut=MA(Z);T(Y,te,ut),Xe(B);const st=g-r[0],Re=f-r[1],Ge=y-r[2];Wr(st,Re,Ge,o),fe.setVertexFromValuesRawPositionUVNormal(it,st,Re,Ge,he,ge,w,x,C),H.setVertexFromValuesRawPositionUVNormal(we,st,Re,Ge,he,ge,w,x,C)}}for(let B=0;B<4;++B)ic[B]=null}function MA(i){var a,n;const e=i.reduce((o,l)=>Math.min(o,(l==null?void 0:l.level)??1/0),1/0);Ti&&(A(!i[0]||!i[2]||e_(i[0],i[2],mt.SOUTH_WEST)),A(!i[1]||!i[3]||e_(i[1],i[3],mt.NORTH_WEST)));let t=0,r=0;for(let o=0;o<4;++o){const l=i[o];if(l&&l.level===e){const c=o===0||o===1,d=o===0||o===3,p=l.extent,m=p[c?0:2],g=p[d?1:3],f=(n=(a=l.renderData)==null?void 0:a.geometryState)==null?void 0:n.samplerData;r+=xt(m,g,f),t++}}const s=t?r/t:0;return A(s!=null),s}function Hu(i){const e=i.vao,t=i.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(t,0,0,t.length)}const Hp=[[0,1],[1,0],[0,-1],[-1,0]],mi=new EE,cg=Ey(-1/0,-1/0,1/0,1/0),ic=[null,null,null,null];function Ow(i,e,t){if(!e)return!1;const r=Na(i,e);return r>0||r===0&&t>=2}let DA=class extends ag{constructor(e,t,r,s,a){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=Yt(),this._baseUsedMemory=900,this.init(e,t,r,s,a)}init(e,t,r,s,a){super.init(e,t,r,s,a);const n=a.view.renderSpatialReference,o=a.spatialReference,l=n!=null&&Iy(n)&&o!=null&&o.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=l;const c=this.surface.isWebMercatorOnPlateeCarree,d=this._extentInRenderSR,p=this.extent;if(c){const m=ft(p[0],p[1],0);Aa(m,_i.WebMercator,m,_i.PlateCarree);const g=ft(p[2],p[3],0);Aa(g,_i.WebMercator,g,_i.PlateCarree),d[0]=m[0],d[1]=m[1],d[2]=g[0],d[3]=g[1]}else for(let m=0;m<4;++m)d[m]=p[m]*l;this.centerAtSeaLevel[0]=.5*(d[0]+d[2]),this.centerAtSeaLevel[1]=.5*(d[1]+d[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(d[2]-d[0],d[3]-d[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,t=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),s=Math.sqrt(t*t+r*r),a=.5*(this.elevationBounds[0]-this.elevationBounds[1]),n=Math.max(s,a);this._center[qt.MIDDLE][3]=n}_calculateFrustumVisibilityStatus(e){const t=this._aabb(),r=t[0],s=t[1],a=t[2],n=t[3],o=t[4],l=t[5];let c=!0;for(let d=0;d<6;d++){const p=e[d],m=p[0],g=p[1],f=p[2],y=p[3];if(m*(m>0?r:n)+g*(g>0?s:o)+f*(f>0?a:l)+y>=0)return rr.OUTSIDE;c=c&&m*(m<0?r:n)+g*(g<0?s:o)+f*(f<0?a:l)+y<=0}return c?rr.INSIDE:rr.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return P2(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,t,r,s){return ld[0]=1/t[0],ld[1]=1/t[1],ld[2]=1/t[2],Pv(this._aabb(),e,ld,r,s)}createGeometry(){PA(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){RA(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){OA(this.renderData,this._horizontalScaleFactor)}get horizontalScale(){return this._horizontalScaleFactor}};const ld=b();let LA=class{constructor(){this.extent=gi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},Id=class extends ue{constructor(){super(...arguments),this._queries=new Et({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Et({initialSize:30}),this._queryPool=new bn(LA)}queryVisibleLevelRange(e,t,r,s){const a=this._queryPool.acquire();Ny(a.extent,e),a.minLevel=t??-Number.MAX_VALUE,a.maxLevel=r??Number.MAX_VALUE,a.callback=s,this._queryQueue.push(a),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const t=this._queries.data[e];this._queryPool.release(t),t.callback(e>=this._queriesInvPtr),t.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const t=e.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],a=s.extent;t>=s.minLevel&&t<=s.maxLevel&&a[0]<=e.extent[2]&&a[2]>=e.extent[0]&&a[1]<=e.extent[3]&&a[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};h([u()],Id.prototype,"updating",null),Id=h([N("esri.views.3d.terrain.ScaleRangeQueries")],Id);function $A(i,e,t,r){const s=Math.cos(t);i[0]=Math.cos(e)*s*r,i[1]=Math.sin(e)*s*r,i[2]=Math.sin(t)*r}let IA=class extends ag{constructor(e,t,r,s,a){super(),this._convexHull=new Array(24),this._boundingSphere=ta(),this._baseUsedMemory=1816,this.init(e,t,r,s,a)}init(e,t,r,s,a){super.init(e,t,r,s,a);const n=this.ellipsoid.radius,o=this.extentInRadians[0],l=this.extentInRadians[1],c=this.extentInRadians[2],d=this.extentInRadians[3],p=He(l,d,.5),m=He(o,c,.5),g=e===0?0:Math.min(Math.abs(l),Math.abs(d));this._edgeLen=(c-o)*Math.cos(g)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),$A(this.centerAtSeaLevel,m,p,this.ellipsoid.radius),ye(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)Xt(e[qt.MIDDLE],0,0,0),Xt(e[qt.TOP],0,0,0),Xt(e[qt.BOTTOM],0,0,0),e[qt.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=e[qt.MIDDLE],r=this.convexHull;let s=0;for(let a=0;a<8;++a)s=Math.max(s,NA(t,r,3*a));e[qt.MIDDLE][3]=Math.sqrt(s)}}_calculateFrustumVisibilityStatus(e){if(!Fu(e,this._boundingSphere))return rr.OUTSIDE;if(this.lij[0]<10)return rr.INTERSECTS;const t=this.convexHull,r=this.surface.view.state.camera.near;let s=!0;for(let a=0;a<uP;a++){const n=a===fl.NEAR,o=e[a],l=o[0],c=o[1],d=o[2],p=o[3]-(n?r:0);let m=!1;for(let g=0;g<8;++g){const f=3*g;if(l*t[f]+c*t[f+1]+d*t[f+2]+p<0){if(m=!0,!s)break}else s=!1}if(!m)return rr.OUTSIDE}return s?rr.INSIDE:rr.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){vA(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ti&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,t=e,r=this.elevationBounds,s=this.ellipsoid.radius,a=r[1];if(this.level===0)Xt(t,0,0,0),e[3]=s+a;else{const n=this.extentInRadians,o=.5*(n[0]+n[2]),l=n[1],c=n[3];zn(u1,o,l,s),zn(p1,o,c,s),me(t,u1,p1);const d=.5*(r[0]+r[1]);J(t,t,(s+d)/us(t));const p=this.convexHull;let m=0;const g=(y,v)=>{const T=y[0]-p[3*v],w=y[1]-p[3*v+1],x=y[2]-p[3*v+2];return Math.sqrt(T*T+w*w+x*x)};for(let y=0;y<8;++y){const v=g(t,y);m=Math.max(m,v)}const f=m;e[3]=f+2}}_updateConvexHull(){const e=this.extentInRadians,t=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,s=this._getPatchType(),a=this.surface.isWebMercator,n=a&&s===Vs.HAS_NORTH_POLE,o=a&&s===Vs.HAS_SOUTH_POLE,l=o||n,c=Math.PI/2,d=e[0],p=e[2],m=o?-c:e[1],g=n?c:e[3],f=.5*(d+p),y=r[0],v=t+(l?Math.min(0,y-1):y),T=(E,Q,ee)=>zn(E,Q,ee,v),w=b(),x=b(),C=b(),P=b();T(w,d,m),T(x,d,g),T(C,p,g),T(P,p,m);const R=(E,Q)=>{for(let ee=0;ee<3;++ee)this._convexHull[3*Q+ee]=E[ee]};R(w,0),R(x,1),R(C,2),R(P,3);const O=r[1],L=t+(l?Math.max(0,O+1):O),F=b(),U=b(),j=b();zn(U,f,g,v),zn(j,f,m,v),me(F,U,j),ye(F,F);const k=b(),W=b(),q=(E,Q)=>{Bi(W,E,Q),ye(W,W);const ee=-Ie(E,k)/Ie(W,k);A(ee>=0),J(W,W,ee),me(E,E,W)};if(2**this.lij[0]>2*this.lij[1]){const E=j,Q=b();Wt(Q,d1,E),ye(Q,Q),Wt(k,E,Q),ye(k,k),A(qr(Ie(k,E)/us(E),0)),q(w,x),q(P,C),R(w,0),R(P,3)}else if(2**this.lij[0]!==2*this.lij[1]){const E=U,Q=b();Wt(Q,d1,E),ye(Q,Q),Wt(k,Q,E),ye(k,k),q(x,w),q(C,P),R(x,1),R(C,2)}const S=(E,Q)=>{const ee=L/Ie(Q,F);for(let oe=0;oe<3;++oe)this._convexHull[3*E+oe]=Q[oe]*ee};S(4,w),S(5,x),S(6,C),S(7,P)}_getPatchType(){const e=this.lij[1],t=e===0,r=e===(1<<this.level)-1;return t?r?Vs.HAS_BOTH_POLES:Vs.HAS_NORTH_POLE:r?Vs.HAS_SOUTH_POLE:Vs.REGULAR}intersectsRay(e,t,r,s){const a=this._boundingSphere,n=a[3]+r,o=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],l=a[0]-e[0],c=a[1]-e[1],d=a[2]-e[2],p=(l*t[0]+c*t[1]+d*t[2])/o,m=t[0]*p-l,g=t[1]*p-c,f=t[2]*p-d;return m*m+g*g+f*f<n*n}getDefaultVerticesPerSide(){return this.level<h1.length?h1[this.level]+1:2}updateCornerElevations(){xA(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){wA(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var _e;if(!Ti||this.level<=2)return;const e=this._boundingSphere,t=e[3],r=e,s=b(),a=this.ellipsoid.radius,n=this.elevationBounds;n[1],n[0];const o=a+n[0],l=1,c=0,d=this._center[qt.MIDDLE][3],p=this.convexHull,m=(V,Y)=>{for(let te=0;te<3;++te)V[te]=p[3*Y+te]};{const V=b(),Y=b(),te=b(),he=b(),ge=b(),fe=(it,H,we,Z)=>{m(Y,it),m(te,H),m(he,we),Bi(Y,Y,te),Bi(he,he,te),Wt(V,Y,he),ye(V,V);const le=Ie(V,te);m(ge,Z);const de=Ie(V,ge),xe=Math.abs(de-le);A(qr(xe,0),`Non coplanar ${it},${H},${we},${Z} diff = ${xe}`)};fe(0,1,2,3),fe(4,5,6,7),fe(0,1,4,5),fe(1,2,5,6),fe(2,3,6,7),fe(3,0,7,4)}const g=S2(24),f=(V,Y,te)=>{const he=4*V;for(let ge=0;ge<3;++ge)g[he+ge]=Y[ge];g[he+3]=te},y=b(),v=b(),T=b(),w=b(),x=(V,Y,te,he)=>{m(y,Y),m(v,te),m(T,he),Bi(y,y,v),ye(y,y),Bi(T,T,v),ye(T,T),Wt(w,y,T),ye(w,w);const ge=Ie(w,v);f(V,w,ge)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const C=1,P=(V,Y,te,he)=>{const ge=4*V;return g[ge]*Y+g[ge+1]*te+g[ge+2]*he-g[ge+3]},R=(V,Y,te,he)=>P(V,Y,te,he)>=-C,O=(V,Y)=>R(V,Y[0],Y[1],Y[2]),L=2**this.lij[0]>2*this.lij[1],F=(V,Y,te)=>Math.sqrt(Ew(V,Y,te,r[0],r[1],r[2]))<t,U=V=>F(V[0],V[1],V[2]),j=(V,Y)=>F(V[Y],V[Y+1],V[Y+2]),k=this.extentInRadians,W=.5*(k[0]+k[2]),q=k[1],S=k[3],E=b(),Q=b();zn(E,W,S,o),zn(Q,W,q,o);const ee=L?"Upper":"Lower";let oe=!0;for(let V=0;V<6;++V){for(let Y=0;Y<8;++Y){const te=3*Y,he=R(V,p[te],p[te+1],p[te+2]);oe&&(oe=he),A(he,`Tile[${this.lij}] Convex hull point ${Y} outside of plane ${V}`)}A(O(V,Q),`Tile[${this.lij}] (${ee}) bottom mid outside of plane ${V}`),A(O(V,E),`Tile[${this.lij}] (${ee}) top mid outside of plane ${V}`)}A(oe,"Not all convex hull points are inside  convex hull polyhedron"),A(U(Q),`Tile[${this.lij}] (${ee}) bottom mid outside of bounding sphere`),A(U(E),`Tile[${this.lij}] (${ee}) top mid outside of bounding sphere`);for(let V=0;V<8;++V){const Y=j(p,3*V);A(Y,`Tile[${this.lij}] Convex hull point ${V} outside of bounding sphere`)}for(let V=0;V<6;++V)for(let Y=0;Y<8;++Y){const te=3*Y;R(V,p[te],p[te+1],p[te+2])||console.error(`Tile[${this.lij}] Convex hull point ${Y} outside of plane ${V}`)}const be=this.extentInRadians,Fe=Math.max(be[2]-be[0],be[3]-be[1]),Pe=Math.round(Fe*a),Le=this.renderData;if(!Le)return;const{geometry:Ee,localOrigin:Qe}=Le,Nt=(_e=Ee.vertexAttributes)==null?void 0:_e.position;if(!Nt)return;const dt=Nt.count,ze=b(),Ke=Ee.numVerticesPerSide-2,Xe=Ke*Ke,Ae=Le.geometryState.neighborData,B=Ae.edgeResolutions.reduce((V,Y)=>V+Y+1,0);for(let V=0;V<dt;++V){const Y=V<Xe,te=!Y&&V<Xe+B;let he=!1,ge=-1;if(te){let Re=Xe;for(let Ge=0;Ge<4;++Ge){const Ze=Ae.edgeResolutions[Ge];if(V===Re||V===Re+Ze-1){he=!0;break}if(Re+=Ze,V<Re){ge=Ge;break}}}const fe=te?Ae.edgePeerNeighbors[ge]:null,it=te&&fe&&Na(this,fe)>0;Nt.getVec(V,s),me(ze,s,Qe);const H=us(ze)-a;let we=0,Z=!1;const le=n[0]-H,de=H-n[1],xe=le>l,$e=de>l,rt=xe||$e,ut=()=>{const Re=Y?"internal":te&&!he?"edge":he?"corner":"pole";return`Tile[${this.lij}].vertex[${V}]:${Re}`+(xe?"(below)":$e?"(above)":"")+(it?"(Neighbor)":"")},st=$y(ze,r);if(st>=t+c){const Re=st-t;rt||(console.error(`${ut()} is out of the bounding sphere by ${Re.toFixed(0)} / ${t.toFixed(0)}[tol=${c}] h=${H.toFixed(0)} / [${n[0].toFixed(0)}..${n[1].toFixed(0)}] (${(Re/t).toFixed(0)})`),Z=!0)}for(let Re=0;Re<6;++Re)if(!R(Re,ze[0],ze[1],ze[2])){const Ge=P(Re,ze[0],ze[1],ze[2]),Ze=V%Ke,_t=(V-Ze)/Ke;Re===0&&le||Re===5&&de||(console.error(`${ut()} (${Ze},${_t})|${Ke}] is out of the bounding trapezoid plane ${Re} h=${Math.round(H)} / [${Math.round(n[0])}..${Math.round(n[1])}] dist=${Math.round(Ge)} radii = ${Math.round(t)}/${Math.round(d)}} : maxL = ${Pe}`),++we)}if(Z||we>0)break}}get convexHull(){return this._convexHull}};const h1=[128,64,64,32,16,8,8,4];function NA(i,e,t){return Ew(i[0],i[1],i[2],e[t],e[t+1],e[t+2])}function Ew(i,e,t,r,s,a){const n=r-i,o=s-e,l=a-t;return n*n+o*o+l*l}const zn=(i,e,t,r)=>{const s=Math.cos(e),a=Math.sin(e),n=Math.cos(t),o=Math.sin(t);i[0]=r*n*s,i[1]=r*n*a,i[2]=r*o},d1=[0,0,1],u1=b(),p1=b();let ns=class extends ue{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};h([u()],ns.prototype,"fovX",void 0),h([u()],ns.prototype,"fovY",void 0),h([u()],ns.prototype,"relativeWidthLimit",void 0),h([u()],ns.prototype,"relativeHeightLimit",void 0),h([u()],ns.prototype,"maxLod",void 0),h([u()],ns.prototype,"angledSplitBias",void 0),h([u()],ns.prototype,"aboveGround",void 0),h([u()],ns.prototype,"frustum",void 0),ns=h([N("esri.views.3d.terrain.SplitLimits")],ns);const FA=On().vec3f(se.POSITION).vec2i16(se.UV0).vec2i16(se.NORMALCOMPRESSED,{glNormalized:!0});let VA=class{constructor(e){this._storage=new O_((t,r)=>e.newCache(t,r),"TileGeometry")}acquire(e){const r=Math.ceil(e/4)*4,s=this._storage.pop(m1(r));if(s)return s;const a=FA.createBuffer(r);return a.release=()=>this._release(a),a}_release(e){const t=e.count;this._storage.put(m1(t),e)}clear(){this._storage.clear()}destroy(){this._storage.destroy()}};function m1(i){return i.toString()}let Aw=class extends Ts{constructor(){super(...arguments),this.blendMode=z.Normal}};h([I({count:z.COUNT})],Aw.prototype,"blendMode",void 0);let Vc=class extends Aw{constructor(){super(...arguments),this.output=jt.Composite,this.baseOpacityMode=Dr.NotRequired,this.premultipliedSource=ps.Off}};h([I({count:jt.COUNT})],Vc.prototype,"output",void 0),h([I({count:Dr.COUNT})],Vc.prototype,"baseOpacityMode",void 0),h([I()],Vc.prototype,"premultipliedSource",void 0);var bo;function UA(i){const e=new At;if(e.include(hw),i.background===bo.Only){const t=i.output===jt.ColorComposite;return t?e.fragment.uniforms.add(new Ci("backgroundColor",r=>r.backgroundColor)):e.fragment.include(sg),e.fragment.code.add(_`
    void main() {
      fragColor = vec4(${t?_`backgroundColor`:_`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(dw,i),e.fragment.uniforms.add(new ke("tex",t=>t.texture)),e.fragment.uniforms.add(new Ue("opacity",t=>t.opacity)),e.fragment.code.add(_`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(i){i[i.BelowLayer=0]="BelowLayer",i[i.Only=1]="Only",i[i.COUNT=2]="COUNT"})(bo||(bo={}));const zA=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return bo},build:UA},Symbol.toStringTag,{value:"Module"}));let qA=class extends cw{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Ea}},Mw=class Dw extends $t{initializeProgram(e){return new Mt(e.rctx,Dw.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:sa(G.ONE,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt})}};Mw.shader=new Lt(zA,()=>ie(()=>import("./BlendLayers.glsl-1b244a13.js"),["assets/BlendLayers.glsl-1b244a13.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let Lw=class extends Vc{constructor(){super(...arguments),this.background=bo.BelowLayer}};h([I()],Lw.prototype,"background",void 0);let kp=class{constructor(e,t,r,s,a,n){this.texture=e,this.type=t,e.retain(),this.offsetAndScale=Zr(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=ft(s,a,n)}destroy(){this.texture.release()}};const BA=.125;let HA=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new qT({viewpoint:new Rl({targetGeometry:new Qr(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null,stencilSymbols:!0,is3D:!0,backgroundColor:null},this._backgroundTile=new VP(new jP(0,0,0,0),0,0,0,512,512,4096,4096)}dispose(){this._renderParams=null}renderBackground(e,t,r,s,a,n,o,l,c,d){const p=this._backgroundTile;this._updateRenderParams(e,t,p,r,a,n,o,l,c,d),this._renderParams.stencilSymbols=!1,r.drawBackground(this._renderParams,p,s)}renderContent(e,t,r,s,a,n,o,l,c,d,p,m){this._stencilSymbols(e,t,r,s,a,n,o,Math.round(1/l),c,d,p,m);let g=1;r.stencilRef=g++,e.setStencilFunction(Pi.EQUAL,r.stencilRef,255),this._render(e,t,r,a,n,o,l,c,d,p,m),s.forAll(f=>{f.sourceLayerInfo.data.stencilRef=g++,this._renderSymbols(e,f.sourceLod,f.sourceLayerInfo.data,a,n,o,Math.round(1/l),f.offset,d,p,m)})}_stencilSymbols(e,t,r,s,a,n,o,l,c,d,p,m){let g=1;r.stencilRef=g++,e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(np.KEEP,np.KEEP,np.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(Pi.ALWAYS,r.stencilRef,255),this._stencilTileSymbols(e,t,r,a,n,o,l,c,d,p,m);for(const f of s.toArray()){const{sourceLod:y,offset:v,sourceLayerInfo:T}=f;T.data.stencilRef=g++,e.setStencilFunction(Pi.ALWAYS,T.data.stencilRef,255),this._stencilTileSymbols(e,y,T.data,a,n,o,l,v,d,p,m)}e.setStencilWriteMask(0),e.setBlendingEnabled(!0),e.setDepthTestEnabled(!0),e.setColorMask(!0,!0,!0,!0)}_renderSymbols(e,t,r,s,a,n,o,l,c,d,p){e.setStencilFunction(Pi.EQUAL,r.stencilRef,255),this._render(e,t,r,s,a,n,o,l,c,d,p,WP.SYMBOL)}_render(e,t,r,s,a,n,o,l,c,d,p,m){this._updateRenderParams(e,t,r,s,n,o,l,c,d,p),this._renderParams.stencilSymbols=!1,s.drawTile(this._renderParams,r,a,m)}_stencilTileSymbols(e,t,r,s,a,n,o,l,c,d,p){this._updateRenderParams(e,t,r,s,n,o,l,c,d,p),this._renderParams.stencilSymbols=!0,r.triangleCount=0,s.drawSymbols(this._renderParams,r,a)}_updateRenderParams(e,t,r,s,a,n,o,l,c,d){"type"in r&&r.type==="vector-tile"&&!r.stage&&r.attachWithContext(e);const p=t[0]-a.getLevelShift(t[0]),m=this._renderParams;m.context=e,m.painter=s,m.glyphMosaic=s.glyphMosaic,m.spriteMosaic=s.spriteMosaic,m.pixelRatio=c*d,m.displayLevel=p,m.requiredLevel=p;const g=a.getScale(t[0]),[f,y]=a.getOffset(t,n*g),v=BA*n*g/l,T=r.transforms.dvs;T[0]=v,T[4]=-v,T[6]=-1-f-o[0]*n*2,T[7]=1+y+(1-o[1])*n*2-2,m.state.size[0]=l/d,m.state.size[1]=l/d,m.state.pixelRatio=d}},$w=class Iw extends $t{initializeProgram(e){return new Mt(e.rctx,Iw.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:sa(G.ONE,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt})}};$w.shader=new Lt(JE,()=>ie(()=>import("./RasterColorizer.glsl-b081d859.js"),["assets/RasterColorizer.glsl-b081d859.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let vc=class extends Vc{constructor(){super(...arguments),this.colorizerType=co.Stretch,this.stretchType=vo.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};h([I({count:co.COUNT})],vc.prototype,"colorizerType",void 0),h([I({count:vo.COUNT})],vc.prototype,"stretchType",void 0),h([I()],vc.prototype,"applyColormap",void 0),h([I()],vc.prototype,"requireBilinearWithNN",void 0);let _1=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const t=this._fbos.get(e);if(t)return t;const r=new Iu(this._rctx,new Yr(e),new W3(U3.DEPTH24_STENCIL8,e));return this._fbos.set(e,r),r}};const kA=ce.getLogger("esri.views.3d.terrain");let GA=class{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._fbos=[],this._vectorTileHelper=new HA,this._bindParameters=new D_(null,null),this._blendLayersTechniqueConfig=new Lw,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=na(this._rctx,$u)}dispose(){this._fbos.forEach(De),this._fbos=null,this._vtFBO=De(this._vtFBO),this._vaoQuad=De(this._vaoQuad),this._vectorTileHelper=De(this._vectorTileHelper),this._backgroundTechnique=et(this._backgroundTechnique),this._applyOpacityTechnique=et(this._applyOpacityTechnique),this._blendLayersTechnique=et(this._blendLayersTechnique)}_getBlendLayersTechnique(e,t,r,s=ps.Off,a=bo.BelowLayer){return this._blendLayersTechniqueConfig.output=t,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechniqueConfig.background=a,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Mw,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,t){const r=this._getBlendLayersTechnique(z.Normal,t?jt.ColorComposite:jt.GridComposite,Dr.NotRequired,ps.Off,bo.Only),s=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(s)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(fi.TRIANGLE_STRIP,0,La(this._vaoQuad,"geometry"))}drawGroup(e,t,r,s,a,n=ps.On){t===jt.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const o=this._getBlendLayersTechnique(s,t,a,n),l=this._rctx.bindTechnique(o,e,this._bindParameters);this._render(l)}drawRasterData(e,t,r,s,a,n=ps.Off){if(e.texture==null)return;e.fboTexture=t===jt.GroupBackgroundComposite||s===z.Normal&&a===Dr.NotRequired&&n===ps.Off?null:this.switch(r).colorTexture;const o=this._getBlendLayersTechnique(s,t,a,n),l=this._rctx.bindTechnique(o,e,this._bindParameters);this._render(l)}drawImageryTileData(e,t,r,s,a,n){const o=n.sourceLayerInfo.data;if(!o.source||(n.tile.surface.layerViewByIndex(n.layerIndex,Ce.MAP).ensureSymbolizerParameters(o),!o.bind(this._rctx)))return;e.fboTexture=s===z.Normal&&a===Dr.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(o,t,s,a);o.opacity=e.opacity;const c=o.getUniforms();c.scale=n.scale,c.offset=n.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const d=this._rctx.bindTechnique(l,c,null);this._render(d)}_getRasterColorizerTechnique(e,t,r,s){const a=e.symbolizerParameters,n=["stretch","lut","hillshade"].indexOf(a.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new vc,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=t,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s,this._rasterColorizerConfig.colorizerType=n,this._rasterColorizerConfig.applyColormap=!!a.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?vo.Noop:vo.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire($w,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,t,r,s,a,n,o,l,c){const d=this._rctx,p=n.sourceLayerInfo.data,m=n.tile.surface.layerViewByIndex(n.layerIndex,Ce.MAP),g=a===Dr.Required||e.opacity<1||s!==z.Normal||t!==jt.Composite,f=g?ps.On:ps.Off,y=this._getBlendLayersTechnique(s,t,a,f);d.setPipelineState(y.getPipeline());let v=null,T=null;g?(T=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new _1(this._rctx)),v=this._vtFBO.get(r),d.bindFramebuffer(v),this._clearCurrentFBO()):c&&d.clearSafe(ii.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.renderBackground(d,n.sourceLod,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/n.scale),n.offset,l,o,m.contentZoom),p&&this._vectorTileHelper.renderContent(d,n.sourceLod,p,n.vtlNeighborInfos,m.painter,m.layer.styleRepository,m.schemaHelper,Math.round(1/n.scale),n.offset,l,o,m.contentZoom)}catch(w){kA.warnOnce("A render call containing vector tiles did not resolve correctly.",w)}return v==null||(d.bindFramebuffer(T),e.texture=v.colorTexture,e.offset=jd,e.scale=1,this.drawRasterData(e,t,r,s,a,f),c)}copyFBOToTexture(e){const t=this._rctx,r=t.bindTexture(e.texture,Hi.TEXTURE_UNIT_FOR_UPDATES),s=e.descriptor;t.gl.copyTexImage2D(Cm.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),e.generateMipmap(),t.bindTexture(r,Hi.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setStencilWriteMask(255),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.setClearStencil(0),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT)}_initFBO(e,t,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,t,t),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,t=0,r=!0){if(this._current=t,t>=this._fbos.length)for(let s=this._fbos.length;s<=t;s++)this._fbos.push(new _1(this._rctx));this._initFBO(this._fbos[t].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const t=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),t}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const t=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(t),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},jA=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.isVTLBackground=!1,this.vtlNeighborInfos=new Et({allocator:e=>e||new WA})}},WA=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},QA=class{constructor(e,t,r,s,a,n){this.start=e,this.end=t,this.blendMode=r,this.opacity=s,this.output=a,this.baseOpacity=n}},ZA=class{constructor(e,t,r,s){this._rctx=e,this.tileSize=t,this._techniques=r,this._cache=s,this._passParameters=new qA,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new GA(this._rctx,this._techniques),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=De(this._composition),this._backgroundTexture=et(this._backgroundTexture)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,t){if(!e.renderData)return;const r=e.surface,s=r.baseOpacity;let a=0,n=0,o=this.tileSize,l=!1,c=!1;const d=r.view.state.contentPixelRatio;let p=!1;bu.clear(),qo.length=0;const m=e.layerInfo[Ce.MAP];let g=0,f=null;for(;g<m.length;g++){const v=r.layerViewByIndex(g,Ce.MAP),T=v.layer.opacity,w=v.fullOpacity;if(c=c||yd(v.layer),Jc(v)){let P=v.layer.blendMode!=="normal";if(Sl(v.layer.parent)){const R=t_(v.layer.parent);R!=null&&R!==""&&(P=Nw(v.layer.parent)||P)}P&&(p=P,l=!1)}if(T===0&&!p){m[g].pendingUpdates&=~(ne.TEXTURE_NOFADING&ne.TEXTURE_FADING);continue}++n;const x=Kd(v),C=Gp(e,g,x);if(C){if(m[g].pendingUpdates&=~(ne.TEXTURE_NOFADING&ne.TEXTURE_FADING),Sl(v.layer.parent)){const P=t_(v.layer.parent);P!=null&&P!==""&&Fw(v.layer.parent,g)}x?o=Math.max(o,this.tileSize*d):s===1&&w===1&&(v.isOpaque||this._dataToTexture(C)&&C.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++a,f===null&&(f=g)}}const y=o/this.tileSize;a!==0&&f!==null?a===1&&!p&&this._useLayerTexture(e,f)||this._composeMapLayers(e,t,g-1,c,o,y,!l||p,bu,p):this._useBackgroundTexture(e,n)}_ensureBackgroundTexture(e){return this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e,!1),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=jd,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1),this._backgroundTexture}_useBackgroundTexture(e,t){const r=this._ensureBackgroundTexture(this.tileSize);let s=Ia.Immediate;(e.surface.view.layerViewManager.updating||t>0)&&(s=Ia.Delayed);const a=e.renderData;a.textureReference==null&&(s=Ia.Immediate),a.setTextureReference(new kp(r,ni.FADING,g1,e.surface.baseOpacity,0,1),s)}_useLayerTexture(e,t){const r=e.surface.layerViewByIndex(t,Ce.MAP),s=yd(r.layer),a=s?e.surface.baseOpacity:1,n=s?1:e.surface.baseOpacity,o=r.fullOpacity,l=Gp(e,t,!1);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new kp(l.sourceLayerInfo.data,ni.FADING,l,a,n,o)),!0)}_composeMapLayers(e,t,r,s,a,n,o,l,c){this._composition.ensureBuffer(a);const d=e.surface.baseOpacity;let p=!1,m=Da.LINEAR_MIPMAP_LINEAR,g=!1,f=0;for(let w=r;w>=0;w--){const x=e.surface.layerViewByIndex(w,Ce.MAP),C=Kd(x),P=Gp(e,w,C),R=x.layer.opacity;if(!P||R===0&&!c)continue;const O=!yd(x.layer)&&!p;O&&(p=!0);let L=!1;l.forEach(W=>{W.start===w&&(W.output=s?jt.Composite:o&&O?this.backgroundIsGrid?jt.GridComposite:jt.ColorComposite:jt.Composite,W.baseOpacity=O?d:1,qo.push(W),this._composition.openGroup(a),L=!0)}),this._passParameters.baseOpacity=O&&!L&&d<1?d:1;const F=this._passParameters.baseOpacity<1?Dr.Required:Dr.NotRequired,U=f===0,j=L?jt.GroupBackgroundComposite:o&&U?this.backgroundIsGrid?jt.GridComposite:jt.ColorComposite:jt.Composite,k=Jm[Jc(x)?x.layer.blendMode:"normal"];for(this._passParameters.opacity=R,_C(P)?g=this._composition.drawVectorData(this._passParameters,j,a,k,F,P,n,this.tileSize,g):gC(P)?(this._composition.drawImageryTileData(this._passParameters,j,a,k,F,P),this._hasNearestInterpolation(P)&&(m=Da.NEAREST)):this._dataToTexture(P)&&(this._passParameters.texture=P.sourceLayerInfo.data.texture,this._passParameters.offset=P.offset,this._passParameters.scale=P.scale,this._composition.drawRasterData(this._passParameters,j,a,k,F));qo.length>0&&qo[qo.length-1].end===w;){const W=qo.pop();this._passParameters.baseOpacity=W.baseOpacity;const q=this._passParameters.baseOpacity<1?Dr.Required:Dr.NotRequired;this._passParameters.opacity=W.opacity,this._passParameters.offset=jd,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,W.output,a,Jm[W.blendMode],q)}f++}const y=e.renderData,v=c||p&&d<1,T=y.ensureTexture(a,v,()=>this._buildTexture(a,v,m));this._composition.copyFBOToTexture(T),this._composition.unbind(),y.setTextureReference(new kp(T,t,g1,p?1:d,0,1))}_hasNearestInterpolation(e){const t=e.sourceLayerInfo.data;return!!t.source&&t.interpolation==="nearest"}_dataToTexture(e){if(fC(e)){const t=e.sourceLayerInfo;t.data=this._buildTexture(t.data,!0),e.tile.setMemoryDirty()}return yC(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,t,r=Da.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const s=new Yr;s.wrapMode=ra.CLAMP_TO_EDGE,s.samplingMode=r,s.maxAnisotropy=this._maxAnisotropy,s.preMultiplyAlpha=!0,s.flipped=!0,s.hasMipmap=!0,t||(s.pixelFormat=$i.RGB);const a=this._rctx;let n;if(typeof e=="number"){s.width=s.height=e;const l=`${e} ${s.pixelFormat}`;n=this._cache.pop(l),n?n.retain():n=new yc(new Hi(a,s),this._cache)}else if(vC(e)){s.isOpaque=e.isOpaque,s.isOpaque&&(s.pixelFormat=$i.RGB);const l=`${e} ${s.pixelFormat}`;n=this._cache.pop(l),n?(n.retain(),n.texture.setData(e.image)):n=new yc(new Hi(a,s,e.image),this._cache),e.release()}else try{s.width=e.width,s.height=e.height,n=new yc(new Hi(a,s,e))}catch{n=new yc(vv(a)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=a.bindTexture(n.texture,Hi.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),a.bindTexture(o,Hi.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}};function Gp(i,e,t){Ai.layerIndex=e,Ai.vtlNeighborInfos.clear();const r=i.layerInfo[Ce.MAP][e];if(Gr(Ai.offset,0,0),Ai.tile=i,Ai.scale=1,Ai.sourceLod=i.lij,Ai.sourceLayerInfo=r,Ai.isVTLBackground=t,r.data)return t&&i.forEachLoadedNeighbor((a,n)=>{if(a.level!==i.level)return;const o=a.layerInfo[Ce.MAP][e];if(!bC(o)||r.data===o.data)return;const l=Ai.vtlNeighborInfos.pushNew();l.offset=ya[n],l.sourceLod=a.lij,l.sourceLayerInfo=o}),Ai;const s=r.upsampleInfo;if(s){const a=s.tile.layerInfo[Ce.MAP][e];return Ai.tile=s.tile,za(Ai.offset,s.offset),Ai.scale=s.scale,Ai.sourceLod=s.tile.lij,Ai.sourceLayerInfo=a,Ai}return t?Ai:null}function t_(i){return i.uid}function Nw(i){let e=i.blendMode!=="normal";return Sl(i.parent)&&(e=Nw(i.parent)||e),e}function Fw(i,e){Sl(i.parent)&&Fw(i.parent,e);const t=t_(i);if(t!=null&&t!==""){const r=bu.get(t);r?r.start=e:bu.set(t,new QA(e,e,i.blendMode,i.opacity,jt.Composite,1))}}const bu=new Map,qo=new Array,Ai=new jA,g1={offset:[0,0],scale:1},ya=new Array;ya[mt.NORTH]=[0,-1],ya[mt.NORTH_EAST]=[-1,-1],ya[mt.EAST]=[-1,0],ya[mt.SOUTH_EAST]=[-1,1],ya[mt.SOUTH]=[0,1],ya[mt.SOUTH_WEST]=[1,1],ya[mt.WEST]=[1,0],ya[mt.NORTH_WEST]=[1,-1];const Vw=200,jp=40,XA=.8,YA=10,bc=1e-6;function KA(i,e,t){const r=e,s=t;let a=0,n=1/0;for(let o=0;o<3;++o){{const l=i[o];if(r[o]<l){if(s[o]<=bc)return!1;const c=(l-r[o])/s[o];a=Math.max(a,c)}else if(s[o]<=-bc){const c=(l-r[o])/s[o];n=Math.min(n,c)}if(a>n)return!1}{const l=i[o+3];if(r[o]>l){if(s[o]>=-bc)return!1;const c=(l-r[o])/s[o];a=Math.max(a,c)}else if(s[o]>=bc){const c=(l-r[o])/s[o];n=Math.min(n,c)}if(a>n)return!1}}return!0}let f1=class{constructor(e,t,r,s,a){this.aabb=e,this.axis=t,this.d=r,this.midStartIndex=s,this.rightStartIndex=a}},hg=class i_{constructor(e,t,r,s){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=t,this.positions=s,this._rayDirection=b(),this.bspNodeTree=new Array;const a=r-t,n=a<=Uw?new Uint16Array(a):new Uint32Array(a);this.indices=n;for(let o=0;o<a;++o)n[o]=o;{const o=r9(e,t,r,s.data,s.stride),l=K(Math.log2(a/jp),2,YA),c=(d,p,m)=>{const g=t9(n,o,d,p),f=p-d;if(f<=jp){const C=new f1(g,void 0,0,d,p);return this.bspNodeTree.push(C),C}const{axis:y,midValue:v}=i9(g),T=e9(n,o,d,p,y,v),w=(C,P)=>{if(m>l)return;const R=P-C;return R<jp||R>=XA*f?void 0:c(C,P,m+1)},x=new f1(g,y,v,T.next,T.mid);return this.bspNodeTree.push(x),x.leftNode=w(d,T.next),x.rightNode=w(T.mid,p),x};c(0,a,0),this.triangleVertexIndices=s9(n,e,t,r)}}intersectRayTriangleRange(e,t){{if(e>=t)return;const r=this.triangleVertexIndices,s=this.positions.data,a=this.positions.stride,n=this._rayOrigin,o=n[0],l=n[1],c=n[2],d=this._rayDirection,p=d[0],m=d[1],g=d[2];for(let f=e,y=3*e;f<t;++f){let v=r[y++]*a;const T=s[v++],w=s[v++],x=s[v];v=r[y++]*a;const C=s[v++],P=s[v++],R=s[v];v=r[y++]*a;const O=C-T,L=P-w,F=R-x,U=s[v++]-T,j=s[v++]-w,k=s[v]-x,W=m*k-j*g,q=g*U-k*p,S=p*j-U*m,E=O*W+L*q+F*S;if(Math.abs(E)<=Number.EPSILON)continue;const Q=o-T,ee=l-w,oe=c-x,be=Q*W+ee*q+oe*S;if(E>0){if(be<0||be>E)continue}else if(be>0||be<E)continue;const Fe=ee*F-L*oe,Pe=oe*O-F*Q,Le=Q*L-O*ee,Ee=p*Fe+m*Pe+g*Le;if(E>0){if(Ee<0||be+Ee>E)continue}else if(Ee>0||be+Ee<E)continue;const Qe=(U*Fe+j*Pe+k*Le)/E;if(Qe>=0){const Nt=this.indices[f]+this.firstTriangleIndex,dt=N3(O,L,F,U,j,k,JA);this._callback(Qe,dt,Nt,!1)}}}i_.numFacesTested+=t-e}intersectRay(e,t){i_.numFacesTested=0;const r=ft(e.r0[0],e.r0[1],e.r0[2]),s=ft(e.r1[0],e.r1[1],e.r1[2]),a=s[0]-r[0],n=s[1]-r[1],o=s[2]-r[2];if(a*a+n*n+o*o<bc)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=a,l[1]=n,l[2]=o;const c=this.triangleVertexIndices.length/3;this._callback=t;const d=this.bspNodeTree[0];this.intersectRayBSP(d,0,c)}intersectRayBSP(e,t,r){const s=this._rayOrigin,a=this._rayDirection;if(!KA(e.aabb,s,a))return;const n=e.axis,o=e.d;if(s[n]<o||a[n]<0){const l=t,c=e.midStartIndex;if(l<c){const d=e.leftNode;d!==void 0?this.intersectRayBSP(d,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),s[n]>o||a[n]>0){const l=e.rightStartIndex,c=r;if(l<c){const d=e.rightNode;d!==void 0?this.intersectRayBSP(d,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};hg.numFacesTested=0;const JA=b(),Bo=[1/0,1/0,1/0],Ho=[-1/0,-1/0,-1/0];function e9(i,e,t,r,s,a){let n=t,o=r;for(;n<o;){const c=i[n];e[6*c+s+3]<=a?++n:(--o,i[n]=i[o],i[o]=c)}let l=n;for(o=r;l<o;){const c=i[o-1];e[6*c+s]>=a?--o:(i[o-1]=i[l],i[l]=c,++l)}return{next:n,mid:l}}function t9(i,e,t,r){if(r<=t)return zg(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*i[t];for(let a=0;a<3;++a)Bo[a]=e[s+0+a],Ho[a]=e[s+3+a]}for(let s=t+1;s<r;++s){const a=6*i[s];for(let n=0;n<3;++n)Bo[n]=Math.min(Bo[n],e[a+0+n]),Ho[n]=Math.max(Ho[n],e[a+3+n])}return zg(Bo[0],Bo[1],Bo[2],Ho[0],Ho[1],Ho[2])}function i9(i){const e=i[3]-i[0],t=i[4]-i[1],r=i[5]-i[2],s=e>t?e>r?0:t>r?1:2:t>r?1:r>e?2:0;return{axis:s,midValue:(i[s]+i[s+3])/2}}function r9(i,e,t,r,s){const a=t-e,n=new Float32Array(6*a);for(let o=0;o<a;++o){const l=3*(o+e),c=i[l]*s,d=i[l+1]*s,p=i[l+2]*s;for(let m=0;m<3;++m){const g=r[c+m],f=r[d+m],y=r[p+m];n[6*o+m]=Math.min(g,f,y),n[6*o+3+m]=Math.max(g,f,y)}}return n}function s9(i,e,t,r){const s=r-t;let a=0;for(let o=t;o<r;++o)for(let l=0;l<3;++l)a=Math.max(e[3*o+l],a);const n=a<=Uw?new Uint16Array(3*s):new Uint32Array(3*s);for(let o=0;o<s;++o){const l=3*(i[o]+t);for(let c=0;c<3;++c){const d=e[l+c];n[3*o+c]=d}}return n}const Uw=65535;let Ft=class extends S_{constructor(){super(...arguments),this.output=M.Color,this.overlayMode=Jd.Disabled,this.tileBlendInput=Zs.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Qt.Terrain}};h([I({count:M.COUNT})],Ft.prototype,"output",void 0),h([I({count:Jd.COUNT})],Ft.prototype,"overlayMode",void 0),h([I({count:Zs.COUNT})],Ft.prototype,"tileBlendInput",void 0),h([I()],Ft.prototype,"spherical",void 0),h([I()],Ft.prototype,"doublePrecisionRequiresObfuscation",void 0),h([I()],Ft.prototype,"receiveShadows",void 0),h([I()],Ft.prototype,"hasSlicePlane",void 0),h([I()],Ft.prototype,"backfaceCullingEnabled",void 0),h([I()],Ft.prototype,"textureFadingEnabled",void 0),h([I()],Ft.prototype,"renderOccluded",void 0),h([I()],Ft.prototype,"hasScreenSpaceReflections",void 0),h([I()],Ft.prototype,"hasCloudsReflections",void 0),h([I()],Ft.prototype,"invisible",void 0),h([I()],Ft.prototype,"tileBorders",void 0),h([I()],Ft.prototype,"visualizeNormals",void 0),h([I()],Ft.prototype,"screenSizePerspective",void 0),h([I()],Ft.prototype,"receiveAmbientOcclusion",void 0),h([I({count:Qt.COUNT})],Ft.prototype,"pbrMode",void 0),h([I({constValue:Hr.Compressed})],Ft.prototype,"normalType",void 0),h([I({constValue:wn.Compressed})],Ft.prototype,"textureCoordinateType",void 0),h([I({constValue:!1})],Ft.prototype,"highStepCount",void 0),h([I({constValue:!1})],Ft.prototype,"useCustomDTRExponentForWater",void 0),h([I({constValue:!1})],Ft.prototype,"useFillLights",void 0),h([I({constValue:!0})],Ft.prototype,"hasColorTexture",void 0);const Wp=7,a9=10,Qp=g_();var qi;(function(i){i[i.Opaque=0]="Opaque",i[i.Semitransparent=1]="Semitransparent",i[i.TransparentWithDraped=2]="TransparentWithDraped",i[i.Empty=3]="Empty"})(qi||(qi={}));let os=class extends kC{get _isGlobal(){return this._stage.viewingMode===Ne.Global}get _techniques(){return this._context.techniqueRepository}get _rctx(){return this._context.renderContext.rctx}constructor(e,t,r,s,a){super({}),this._overlayRenderer=e,this._stage=t,this._allTiles=r,this._ellipsoidRadius=s,this.type=va.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ft,this._passParameters=new uw,this._renderDataPool=new bn(gA),this._visiblePatchesByOrigin=new Map,this._allPatchesByOrigin=new Map,this._patchesByOriginDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new sw,this._transparencyState=qi.Opaque,this._castShadows=!1,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.renderOccludedFlags=er.Occlude,this.produces=new Map([[$.OPAQUE_TERRAIN,()=>this._produces()],[$.TRANSPARENT_TERRAIN,()=>this._produces()],[$.OCCLUDED_TERRAIN,()=>this._produces()]]),this._tileTextureCache=new O_((n,o)=>a.newCache(n,o),"TileTexture"),this.tileGeometryCache=new VA(a)}normalizeCtorArgs(){return{}}initialize(){this._stage.addRenderPlugin(this)}destroy(){this._stage.removeRenderPlugin(this),this._tileTextureCache.destroy(),this.tileGeometryCache.destroy()}_produces(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}consumes(){return this._overlayRenderer.hasWater?av:nv}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set visible(e){this._set("visible",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===qi.TransparentWithDraped||e===qi.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return sn}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?gf:er.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,ne.TEXTURE_FADING)}updateTileTexture(e,t){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,t===ne.TEXTURE_FADING?ni.FADING:ni.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){for(const r of e.layerInfo[Ce.ELEVATION])r.pendingUpdates&=~ne.GEOMETRY;e.resetPendingUpdate(ne.GEOMETRY);const t=e.renderData.updateGeometryState();return t&&this.setDirty(),t}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this._renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const t=a9-Wp,r=Math.max(0,Math.floor((e.level-t)/Wp)*Wp);if(this._isGlobal&&r===0)return Ea;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Bt.UPDATE){this._patchesByOriginDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Bt.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Bt.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._tileRenderer=new ZA(this._rctx,this._tileSize,this._techniques,this._tileTextureCache),this.updateTileBackground(),this._emptyTex=vv(this._rctx)}uninitializeRenderContext(){this._emptyTex=De(this._emptyTex),this._tileRenderer=De(this._tileRenderer)}intersect(e,t,r,s){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==qi.Opaque)return;const a=n9,n=o9;pe(a,s,r),Xt(n,1/a[0],1/a[1],1/a[2]);const o=e.results.min,l=e.results.max,c=e.results.ground,d=e.options.store===Xs.MIN,p=!!e.results.ground.target,m=iP(e.verticalOffset),g=e.tolerance;let f,y=d&&o.dist!=null?o.dist:1/0;const v=w=>{const x=w.renderData;if(!(x!=null&&x.vao))return;const C=x.geometry;R2(Qp,C.boundingBox);const P=x.localOrigin;m!=null&&(m.localOrigin=P,m.applyToAabb(Qp));const R=Qp;if(ko[0]=r[0]-P[0],ko[1]=r[1]-P[1],ko[2]=r[2]-P[2],!Pv(R,ko,n,g,y))return;const O=(S,E,Q)=>{S.set(this.type,w,E,Q,Sc),y=d&&o.dist!=null?o.dist:1/0},L=(S,E)=>{if(E!=null&&S>=0&&(e.options.backfacesTerrain||Ie(E,a)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(r,s,S))){if((c.dist==null||S<c.dist)&&O(c,S,E),e.options.isFiltered)return;e.options.store===Xs.ALL&&(f==null?(f=tP(e.ray),O(f,S,E),e.results.all.push(f)):S<f.dist&&O(f,S,E)),(o.dist==null||S<o.dist)&&O(o,S,E),e.options.store!==Xs.MIN&&(l.dist==null||S>l.dist)&&O(l,S,E)}},F=l9;pe(F,s,P);const U=C.indices,j=C.vertexAttributes,k=j.getField(se.POSITION,O2),W=new Fy(k.typedBuffer,3,j.stride/4),q=C.indexCount/3;if(!m&&q>Vw){const S=w.renderData;S.intersectionData==null&&(S.intersectionData=new hg(U,0,q,W)),S.intersectionData.intersectRay({r0:ko,r1:F},L)}else Sv(ko,F,0,q,U,W,null,m,L)},T=this._rootTiles;T!=null&&(()=>{const w=this._tileIterator;w.reset(T);const x=e.options.invisibleTerrain;for(let C=w.next();C;C=w.next())!(C.visible||x&&C.intersectsClippingArea)||m==null&&!C.intersectsRay(r,a,g,y)||p&&this._useStencilForTile(C)?w.skipSubtree():v(C)})()}processScaleRangeQueries(e,t){var r;if(!t.done)for(this._updatePatchGroups();e.updating&&!t.done;){e.prepare();for(const s of this._visiblePatchesByOrigin.values())for(const a of s)((r=a.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(a);e.process(),t.madeProgress()}}prepareTechnique(e){const t=li("enable-feature:terrain-shadows")&&e.bindParameters.shadowMap.enabled;if(t!==this._castShadows&&(this._castShadows=t,this._patchesByOriginDirty=!0),e.bindParameters.slot===$.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&gf))return null}else{const r=this.transparency===qi.Opaque?$.OPAQUE_TERRAIN:$.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}if(this.transparency===qi.Empty)return null;switch(e.output){case M.Color:return this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.lastFrameColor!=null,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssao!=null,this._techniqueConfiguration.overlayMode=this._overlayRenderer.mode,this._updateTechnique(M.Color,e.bindParameters.slot===$.OCCLUDED_TERRAIN);case M.Shadow:case M.ShadowExcludeHighlight:return this._castShadows?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.Shadow,!1)):null;case M.Depth:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.Depth,!1);case M.Normal:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.Normal,!1);case M.ObjectAndLayerIdColor:return this._updateTechnique(M.ObjectAndLayerIdColor,!1);case M.Highlight:return this._overlayRenderer.hasHighlights?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.Highlight,!1)):null}return null}renderNode(e,t){switch(this._updatePatchGroups(),t.useStencil=!1,e.output){case M.Color:{const r=e.bindParameters.slot===$.OCCLUDED_TERRAIN?ms.Occluded:ms.Color;this._renderMaterialPass(e,t,r);break}case M.Depth:case M.Normal:this._renderAuxiliaryPass(e,t,ms.Color,this._visiblePatchesByOrigin);break;case M.Highlight:this._renderAuxiliaryPass(e,t,ms.Highlight,this._visiblePatchesByOrigin);break;case M.Shadow:case M.ShadowExcludeHighlight:this._renderAuxiliaryPass(e,t,null,this._allPatchesByOrigin);break;case M.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,t,ms.ObjectAndLayerIdColor,this._visiblePatchesByOrigin)}}updateTileBackground(e){if(this._tileRenderer==null)return;const t=this._tileRenderer;let r;if(e!=null){const s=no.toUnitRGBA(e);r=ft(s[0]||0,s[1]||0,s[2]||0)}t.setBackground(r),this._allTiles.forAll(s=>t.updateTileTexture(s,ni.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Zs.GridComposite:t.backgroundColor!=null?Zs.ColorComposite:Zs.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchesByOriginDirty&&(this._rebuildPatchGroups(),this._patchesByOriginDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==Al.NONE){const e=Array.from(this._visiblePatchesByOrigin.values()),t=this._stencilEnabledLayerExtents;for(const r of e)aw(this.renderOrder,r,t);e.sort((r,s)=>nw(r[0],s[0],this.renderOrder)),this._visiblePatchesByOrigin=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(e!=null){(t=e[0])==null||t.surface.checkAllTilesWaterproofness(),this._visiblePatchesByOrigin.clear(),this._allPatchesByOrigin.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const t=this._tileIterator;for(t.resetOne(e);!t.done;){const r=t.next(),s=r.renderData;if(!s){this._numTilesCulled++;continue}const a=s.localOrigin;if(this._castShadows){let o=this._allPatchesByOrigin.get(a);o||(o=new Array,this._allPatchesByOrigin.set(a,o)),o.push(r)}if(!r.visible){this._numTilesCulled++,t.skipSubtree();continue}let n=this._visiblePatchesByOrigin.get(a);n||(n=new Array,this._visiblePatchesByOrigin.set(a,n)),n.push(r),t.skipSubtree()}}_useStencilForTile(e){for(const t of this._stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderAuxiliaryPass(e,t,r,s){const a=e.rctx;this._passParameters.overlayContent=r,a.bindTechnique(t,this._passParameters,e.bindParameters);const n=this._stencilEnabledLayerExtents.length>0;s.forEach(o=>{const l=o[0].renderData.localOrigin;t.program.bindDraw(new ff(l),e.bindParameters,this._passParameters);for(let c=0;c<o.length;c++)this._renderPatch(e,t,o[c],fi.TRIANGLES,n,r)}),e.rctx.bindVAO(null)}_renderMaterialPass(e,t,r){var m;const{rctx:s}=e;this._passParameters.overlayContent=r,s.bindTechnique(t,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0;const a=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const g=Tv(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;g.update({distance:f,fovY:a.fovY})}const o=this._stencilEnabledLayerExtents.length>0,l=r===ms.Occluded;l&&(n.bindTexture("tex",this._emptyTex),n.setUniform3fv("textureOpacities",Ea),n.setUniform4fv("texOffsetAndScale",l_));const c=((m=this._tileRenderer)==null?void 0:m.backgroundColor)!=null?this._tileRenderer.backgroundColor:Ea;this._techniqueConfiguration.tileBlendInput===Zs.ColorComposite&&n.setUniform3fv("backgroundColor",c);const d=this.wireframe?fi.LINES:fi.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this._emptyTex);const p=this._visiblePatchesByOrigin;for(const g of p.values()){const f=g[0].renderData.localOrigin;t.program.bindDraw(new ff(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of g){const v=y.renderData,T=v.textureReference;if(T!=null){if(!l){n.setUniform4fv("texOffsetAndScale",T.offsetAndScale),n.bindTexture("tex",T.texture.texture);const w=v.textureFadeFactor,x=w<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&x!=null&&w<1?(n.setUniform1f("fadeFactor",w),n.setUniform4fv("nextTexOffsetAndScale",x.offsetAndScale),n.setUniform3fv("nextTexOpacities",x.opacities),n.bindTexture("texNext",x.texture.texture)):n.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",T.opacities)}this._renderPatch(e,t,y,d,o,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,t,r,s,a,n){const o=r.renderData,l=o.vao,c=l==null?void 0:l.indexBuffer;if(c==null)return void(Ti&&console.error("Rendered tile with no indices: ",r.lij," : ",o));const d=t.program;n==null||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(d,o.overlay),a&&(t.useStencil=this._useStencilForTile(r),e.rctx.setPipelineState(t.getPipeline()));const p=o.geometry.indexCount;e.rctx.bindVAO(l),d.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(s,p,c.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=t,this._shaderTechnique=this._techniques.releaseAndAcquire(pw,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};h([u({readOnly:!0})],os.prototype,"_isGlobal",null),h([u({value:!1})],os.prototype,"renderingDisabled",null),h([u({value:!0})],os.prototype,"visible",null),h([u()],os.prototype,"renderPatchBorders",null),h([u()],os.prototype,"visualizeNormals",null),h([u()],os.prototype,"cullBackFaces",null),h([u({value:Al.FRONT_TO_BACK})],os.prototype,"renderOrder",null),h([u()],os.prototype,"wireframe",null),os=h([N("esri.views.3d.terrain.TerrainRenderer")],os);const n9=b(),o9=b(),ko=b(),l9=b();let c9=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},Ls=class extends ue{constructor(e){super(e)}initialize(){this.addHandles([this.layers.on("change",()=>this._update()),D(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())]),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!Rc(t)||t.isRejected())&&!(t.isFulfilled()&&!h9(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||Yy(t)))),e)if(e.isResolved()){const t=Du(e,this.viewSpatialReference,this.viewingMode);if(t!=null){const r=new Lo(t.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ne.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Lo.makeWebMercatorAuxiliarySphere(t):Hd(e.spatialReference)&&(e=Lo.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this.removeAllHandles(),this.addHandles(D(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ne.Global){const e=this.extentHelper.viewSpatialReference,t=Hd(e)||d_(e)||h_(e);e.isWebMercator?this.tilingScheme=Lo.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Lo.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||oo(e,this.extent)||(this.tilingScheme=Lo.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function h9(i,e,t){return Du(i,e,t)!=null}h([u()],Ls.prototype,"tilingScheme",void 0),h([u({readOnly:!0})],Ls.prototype,"extent",void 0),h([u({value:!1})],Ls.prototype,"tilingSchemeLocked",void 0),h([u({constructOnly:!0})],Ls.prototype,"viewSpatialReference",void 0),h([u({constructOnly:!0})],Ls.prototype,"layers",void 0),h([u({constructOnly:!0})],Ls.prototype,"extentHelper",void 0),h([u({constructOnly:!0})],Ls.prototype,"viewingMode",void 0),Ls=h([N("esri.views.3d.terrain.TilingSchemeLogic")],Ls);let d9=class{constructor(){this.offset=yi(),this.scale=0,this.tile=null}init(e,t,r,s){this.tile=e,this.offset[0]=t,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}};var Nd;let Te=Nd=class extends Xr.EventedMixin(ue){constructor(i){var e,t;super(i),this._scaleRangeQueries=new Id,this._iteratorPool=new bn(sw,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new DE,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._usedMemory=null,this._performanceInfo=new c9,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=b(),this._eyePosSurfaceSR=b(),this._splitLimits=new ns,this._frustum=su(),this._viewProjectionMatrix=nt(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._watchUpdatingTracking=new Nu,this._frameTask=iu,this._allTiles=new Et,this._upsampleInfoPool=new bn(d9),this._shouldEmitChangeEvent=!1,this._rootTilesExtent=Yt(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=_i.WebMercator,this.visibleElevationBounds=new ul(1/0,-1/0),this.rootTileElevationBounds=new ul(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Yi({...i,surface:this}),this._isGlobal=!((t=(e=i.view)==null?void 0:e.state)!=null&&t.isLocal),this._tileConstructor=this._isGlobal?IA:DA}initialize(){const i=this.view,e=i.resourceController;this._lercDecoder=NP(e);const t=e.memoryController;this._tileCache=new O_((l,c)=>t.newCache(l,c),"terrain-tile"),this._upsampleMapCache=t.newCache("terrain-upsample",l=>l.unloadMapData()),this._elevationQueryCache=new IP(t.newCache("elevation-query"));const r=this.overlayManager;this._renderer=new os(r.renderer,i._stage,this._allTiles,Tt(i.spatialReference).radius,t),this.addHandles([D(()=>r.rendersOccluded,l=>this._renderer.setRenderOccludedOverlay(l)),D(()=>r.renderer.isEmpty,()=>this._evaluateTransparency()),D(()=>this.renderer.visible,l=>this.suspended=!l)],"overlayManager"),this.addHandles([D(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?ni.UNFADED:ni.IMMEDIATE)},yt),D(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?ni.UNFADED:ni.IMMEDIATE),yt),D(()=>this.backgroundColor,(l,c)=>{l!=null&&l.equals(c)||(this._handleLayerViewChanges(),this._renderer.updateTileBackground(l))},at),D(()=>this.snapLevel,()=>this._viewChanged=!0,at),D(()=>this.view.pointsOfInterest,l=>{this._renderer.pointsOfInterest=l,this._watchUpdatingTracking.removeAll(),l&&this._watchUpdatingTracking.add(()=>l.focus.renderLocation,()=>this._allTilesSorted=!1)}),D(()=>ki.TERRAIN_TILE_TREE_SHOW_TILES,l=>{l&&!this._treeDebugger?ie(()=>import("./TerrainTileTree3DDebugger-e12fcd81.js"),["assets/TerrainTileTree3DDebugger-e12fcd81.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/TileTreeDebugger-7b374a11.js"]).then(({TerrainTileTree3DDebugger:c})=>{!this._treeDebugger&&ki.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new c({view:i}))}):l||(this._treeDebugger=re(this._treeDebugger))},si)]);const{spatialReference:s}=i;this._extentHelper=wE(this.viewingMode,{layers:i.map.allLayers,layerViews:i.allLayerViews,viewSpatialReference:s});const a=new $P({getCollections:()=>{var l,c;return(c=(l=i.defaultsFromMap)==null?void 0:l.mapCollections)==null?void 0:c.map(({layers:d})=>d)},getChildrenFunction:l=>l&&"layers"in l?l.layers:null}),n=new Ls({layers:a,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:s});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=e.createStreamDataRequester(Hs.ELEVATION),this._mapDataRequester=e.createStreamDataRequester(Hs.BASEMAP);const o=e.scheduler;this._frameTask=o.registerTask(ci.TERRAIN_SURFACE,this),this.addHandles([D(()=>this._extentHelper.stencilEnabledExtents,l=>this._renderer.setStencilEnabledLayerExtents(l),si),D(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),at),D(()=>this.extent,()=>this._updateRootTiles(),si),i.on("resize",()=>this._viewChangeUpdate()),D(()=>{const l=i.state;return[this._lodBias,this.lodSnapping,i.quality,l.camera,l.contentCamera,l.fixedContentCamera]},()=>this._viewChangeUpdate(),yt),D(()=>{var l,c;return(c=(l=i.qualitySettings)==null?void 0:l.tiledSurface)==null?void 0:c.textureFadeDuration},l=>this._renderer.textureFadingEnabled=l>0,si),D(()=>{var l;return(l=i.qualitySettings)==null?void 0:l.physicallyBasedRenderingEnabled},l=>this._renderer.pbrMode=l?Qt.Terrain:Qt.Disabled,si),D(()=>this._userClippingExtent,()=>this._updateClippingExtent(),at)]),this.addHandles(i.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges(),this._renderer.updateTileBackground(this.backgroundColor)}destroy(){this._frameTask.remove(),this._watchUpdatingTracking.destroy(),this._lercDecoder=et(this._lercDecoder),this._removeAllTiles(),this._set("tilingSchemeLogic",re(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((i,e)=>this._unregisterTiledLayerView(e)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",re(this.overlayManager)),this._tileCache=re(this._tileCache),ag.prune(),this._treeDebugger=re(this._treeDebugger),this._renderer=re(this._renderer),this._iteratorPool=re(this._iteratorPool),this._upsampleMapCache=re(this._upsampleMapCache),this._elevationQueryCache=re(this._elevationQueryCache),this._set("view",null),this._extentHelper=re(this._extentHelper),this._upsampleInfoPool=re(this._upsampleInfoPool),UP(),tA()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var i,e;if(this.lodSnapping===sp.ON){const t=this.view,r=this.tilingScheme,s=(e=(i=t.pointsOfInterest)==null?void 0:i.cameraOnSurface)==null?void 0:e.scale;if(r&&s){const a=t.state.contentCamera;let n=nC(t,a.eye,a.viewForward,a.up).tilt;n>90&&(n=180-n);const o=2*(n/90)**2,l=r.levelAtScale(s)-o,c=Math.min(l+t.qualitySettings.tiledSurface.lodBias,this._splitLimits.maxLod||1/0);return c<=0?null:c}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?sp.ON:sp.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:i}=this,{clippingArea:e}=this.view;if(e==null||i==null)return null;const t=Yt(),r=ky(e,t,i)?t:null,s=this._get("extent");return oo(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const i=pm(this.groundExtent,this._userClippingExtent,Yt()),e=this._get("extent");return oo(i,e)?e:i}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var i;return(i=this.tilingSchemeLogic)==null?void 0:i.extent}get updating(){var i,e;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(i=this._watchUpdatingTracking)!=null&&i.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(e=this.overlayManager)!=null&&e.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var i,e,t;return((t=(e=(i=this.view)==null?void 0:i.map)==null?void 0:e.ground)==null?void 0:t.opacity)??1}set baseOpacity(i){this.view.map.ground.opacity=i}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(i){this._renderer.renderOrder=i,this._set("renderOrder",i)}get rootTiles(){return this._rootTiles}get spatialReference(){var i;return((i=this.tilingScheme)==null?void 0:i.spatialReference)??null}get backgroundColor(){var i,e,t;return(t=(e=(i=this.view)==null?void 0:i.map)==null?void 0:e.ground)==null?void 0:t.surfaceColor}set backgroundColor(i){this.view.map.ground.surfaceColor=i}set slicePlaneEnabled(i){this._renderer.slicePlaneEnabled=i,this._set("slicePlaneEnabled",i),this._evaluateTransparency()}get tilingSchemeLocked(){var i;return((i=this.tilingSchemeLogic)==null?void 0:i.tilingSchemeLocked)??!1}get wireframe(){var i;return(i=this._renderer)==null?void 0:i.wireframe}set wireframe(i){i!==this._renderer.wireframe&&(this._renderer.wireframe=i,this._updateAllTileGeometries())}get opaque(){return this._renderer.transparency===qi.Opaque}set suspended(i){this._set("suspended",i),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(i,e,t,r){this._renderer.intersect(i,e,t,r)}getElevation(i,e,t,r){const s=this._rootTiles;if(!(s!=null&&s.length)||s[0].layerInfo[Ce.ELEVATION].length===0)return null;const a=Zi;return a[0]=i,a[1]=e,a[2]=t,Aa(a,r,a,this._spatialReference)?v1(s,a[0],a[1]):(ce.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(i,e,t){const r=this._rootTiles,s=r?r[0].layerInfo[Ce.ELEVATION].length:0;if(r!=null&&r.length&&s!==0)for(let a=0;a<e;++a){const n=3*a;t(a,v1(r,i[n],i[n+1]))}else for(let a=0;a<e;++a)t(a,null)}getScale(i){if(!this.tilingScheme)return null;if(!Wd(i,Zi,this.spatialReference))return ce.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const e=this._rootTiles;if(e!=null){for(const t of e)if(t!=null&&t.containsPoint(Zi)){let r=t;for(;r.children[0]&&!r.rendered;){const s=r.children[0].extent;let a=0;Zi[0]>s[2]&&(a+=1),Zi[1]<s[1]&&(a+=2),r=r.children[a]}return this._getLodBiasCorrectedScale(r.level)}}return 1/0}getSphereElevationBounds(i,e){var n;if(Zi[0]=i[0],Zi[1]=i[1],Zi[2]=i[2],Zi[3]=i[3],!Aa(Zi,e,Zi,(n=this.tilingScheme)==null?void 0:n.spatialReference))return ce.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let t=1/0,r=-1/0;const s=o=>{if(o&&qg(o.extent,Zi))if(o.isLeaf||o.rendered)t=Math.min(t,o.elevationBounds[0]),r=Math.max(r,o.elevationBounds[1]);else for(const l of o.children)s(l)},a=this._rootTiles;if(a!=null)for(const o of a)s(o);return{min:t,max:r}}getRootElevationBounds(){return{min:this.rootTileElevationBounds.min,max:this.rootTileElevationBounds.max}}getSphereScale(i,e){if(!this.tilingScheme)return null;if(!Wd(i,Zi,this.spatialReference))return ce.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Zi[3]=e;let t=null;const r=a=>{if(a&&qg(a.extent,Zi)){const n=a.children;if(n[0]&&!a.rendered)for(const o of n)r(o);else{const o=this._getLodBiasCorrectedScale(a.level);t=t==null?o:Math.min(t,o)}}},s=this._rootTiles;if(s!=null)for(const a of s)r(a);return t}queryVisibleScaleRange(i,e,t,r){const s=e?this.tilingScheme.levelAtScale(e):0,a=t?this.tilingScheme.levelAtScale(t):1/0,n=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(i,s+n,a+n,r)}_evaluateTransparency(){var a,n;const i=this.baseOpacity,e=this.overlayManager.renderer.isEmpty,t=this._renderer.transparency,r=this._allSurfaceLayersTransparent()?e?qi.Empty:qi.TransparentWithDraped:i>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?qi.Opaque:qi.Semitransparent,s=t!==r;return s&&(this._renderer.transparency=r,(n=(a=this.view)==null?void 0:a._stage)==null||n.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var t,r,s;const i=this.tilingSchemeLogic.tilingScheme;if(i===this.tilingScheme)return;Ns(!!i,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((r=(t=this.view)==null?void 0:t.state)!=null&&r.isLocal),this.tilingScheme&&this._removeAllTiles();const e=(i==null?void 0:i.spatialReference)??_i.WebMercator;this._spatialReference=e,this._isWebMercator=!!(e!=null&&e.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&Iy((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",i),this._updateClippingExtent(),i&&(this._updateTiledLayers(),this._renderer.setTileSize(i.pixelSize),this.overlayManager.setSpatialReference(i.spatialReference),this._updateRootTiles())}_acquireTile(i,e,t,r){const s=this._tileCache.pop(Nd._tileMemcacheKey);return s?(s.init(i,e,t,r,this),s):new this._tileConstructor(i,e,t,r,this)}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:i,tilingScheme:e}=this;if(!e)return;const t=m9;let r=e.rootTilesInExtent(i,t,5*Ph);if(this._rootTiles!=null){if(r.length>Ph)return void ce.getLogger(this).warn(wC);const s=this._rootTiles.map(n=>n.lij),a=E2(s,r,y1);if(this._updatingRootTiles=!0,a.removed.length>0||a.added.length>0){const n=this._rootTiles.filter(o=>!(a.removed.findIndex(l=>y1(l,o.lij))>-1)||(this._purgeTile(o),!1));a.added.forEach(o=>n.push(this._newRootTile(o))),this._setRootTiles(n)}}else this._updatingRootTiles=!0,r.length>Ph&&(ce.getLogger(this).warn(xC),r=e.rootTilesInExtent(i,t,Ph)),this._setRootTiles(r.map(s=>this._newRootTile(s)));oo(t,this._rootTilesExtent)||(this._rootTilesExtent=Yt(t)),this.renderer.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const i=this._allTiles.filter(e=>e.isLoaded&&e.intersectsClippingArea);i.forEach(e=>this._renderer.updateTileGeometryState(e)),i.forEach(e=>e.renderData.updateNeighborData()),this._updateTilesGeometries(i),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(i){if(i.length===0)return;i.sort(Na);const e=this.renderer;i.forEach(t=>e.updateGeometryIfNeeded(t)),i.forEach(t=>this._pendingTilesForElevationUpdateEvent.add(t))}_shouldSplit(i){return i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===ne.SPLIT}_newRootTile(i){const e=this._acquireTile(0,i[1],i[2],null);return this._shouldSplit(e)&&e.setPendingUpdate(ne.SPLIT),this._loadTile(e),this._markTileToUpdate(e),this._updateRootTileElevationBounds(),e}_setRootTiles(i){if(this._rootTiles=i,this._allTiles.clear(),i!=null){const e=this._iteratorPool.acquire();for(e.reset(i);!e.done;)this._allTiles.push(e.next());e.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(i)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this.renderer.visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(i){i.updateClippingStatus(this.extent)&&i.resetPendingUpdate(ne.GEOMETRY)&&this._updateTileGeometryState(i)}_updateTilesVisibility(i){if(i==null)return;const e=UE(i),t=this.visibleElevationBounds;let r=e?t.min:1/0,s=e?t.max:-1/0;const a=this.extent,n=this._viewProjectionMatrix;this.setTileTreeDirty();const o=this._iteratorPool.acquire();for(o.reset(i);!o.done;){const l=o.next();l.updateClippingStatus(a)&&l.resetPendingUpdate(ne.GEOMETRY)&&this._updateTileGeometryState(l),l.setPendingUpdate(ne.RENDERDATA),l.computeVisibility(),l.updateScreenDepth(n),l.renderData&&(r=Math.min(l.elevationBounds[0],r),s=Math.max(l.elevationBounds[1],s))}o.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._updatePendingTileGeometries(),isFinite(r)&&isFinite(s)&&(t.min!==r||t.max!==s)&&(this.visibleElevationBounds=new ul(r,s))}_updateRootTileElevationBounds(){let i=1/0,e=-1/0;const t=this._rootTiles;t!=null&&t.forEach(({elevationBounds:s})=>{i=Math.min(i,s[0]),e=Math.max(e,s[1])});const r=this.rootTileElevationBounds;r.min===i&&r.max===e||(this.rootTileElevationBounds=new ul(i,e))}_updateViewDependentParameters(){const{camera:i,contentCamera:e}=this.view.state,t=Math.tan(.5*e.fovX),r=Math.tan(.5*e.fovY),s=this.tilingScheme.pixelSize,a=2**-this._lodBias*i.pixelRatio;this._splitLimits.aboveGround=i.aboveGround,this._splitLimits.fovX=t,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/i.width*this.maxTextureScale*a,this._splitLimits.relativeHeightLimit=s/i.height*this.maxTextureScale*a,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?this._splitLimits.frustum=Sm(this._splitLimits.frustum??su(),e.frustum):this._splitLimits.frustum=null,Sm(this._frustum,i.frustum),jr(this._viewProjectionMatrix,e.projectionMatrix,e.viewMatrix),ae(this._eyePosRenderSR,e.eye),Aa(i.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(i){i.rendered&&!i.shouldLoad&&(zw(i)?this._loadChildren(i):p9(i)&&this._loadParent(i))}_updateTileGeometryState(i){i.updateVisibility(),this._renderer.updateTileGeometryState(i)&&this._markTileToUpdate(i),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(i){i.forEachLoadedNeighbor(e=>this._pendingTilesToUpdate.add(e))}_updateTileTexture(i,e){const t=i.resetPendingUpdate(ne.TEXTURE_FADING)?ne.TEXTURE_FADING:!!i.resetPendingUpdate(ne.TEXTURE_NOFADING)&&ne.TEXTURE_NOFADING;t&&(this._renderer.updateTileTexture(i,t),this._usedMemory=null,e.madeProgress())}_emitElevationUpdateEventForTiles(){if(!this._shouldEmitChangeEvent)return;const i=Xp.extent;ia(i),this._pendingTilesForElevationUpdateEvent.forEach(e=>mn(i,e.extent,i)),this._pendingTilesForElevationUpdateEvent.clear(),Xp.spatialReference=this.spatialReference,this.emit("elevation-change",Xp),this._shouldEmitChangeEvent=!1}runTask(i){this._handleLayerViewChanges(i),this._frameTask.processQueue(i),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,i),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(i),this._sortTiles(i);const e=!this.view.state.fixedContentCamera;this._mergeAndSplit(i,e),this._updateElevation(i),this._updateTextures(i),e||this._mergeAndSplit(i,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._updatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),i.done&&i.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(i){if(!this._viewChanged||!this._rootTiles||i.done)return;this._viewChanged=!1;const e=this._iteratorPool.acquire();e.reset(this._rootTiles);const t=this.snapLevel,r=this._splitLimits,s=this._eyePosRenderSR;for(;!e.done;){const a=e.next(),n=a.shouldSplit(r,s,t);if(n!==ne.SPLIT){if(a.resetPendingUpdate(ne.SPLIT)&&a.updateAgentSuspension(),n===ne.ELEVATION&&a.updateAgents(Ce.ELEVATION),e.skipSubtree(),!a.isLeaf){a.setPendingUpdate(ne.MERGE),a.resetPendingUpdate(ne.SPLIT);const o=this._iteratorPool.acquire();o.resetOne(a);const l=this._viewProjectionMatrix;for(let c=o.next();!o.done;c=o.next())this._updateClippingStatus(c),c.updateVisibility(),c.updateScreenDepth(l);o.remove()}}else a.resetPendingUpdate(ne.MERGE),a.isLeaf&&(a.setPendingUpdate(ne.SPLIT),e.skipSubtree()),a.rendered&&a.setPendingUpdate(ne.RENDERDATA)}e.remove(),this.requestUpdate(),(this._shortBatches||!this._oneBatchPerFrameTask)&&this._updatePendingTileGeometries(),i.madeProgress()}_sortTiles(i){i.done||this._allTilesSorted||(FE(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),i.madeProgress())}_markTileToUpdate(i){A(i.isLoaded),i.intersectsClippingArea&&(this._pendingTilesToUpdate.add(i),this._markAllTileNeighborsForGeometryUpdate(i))}_updatePendingTileGeometries(){const i=this._pendingTilesToUpdate,e=Array.from(i.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea);if(e.length===0)return void i.clear();const t=(s,a)=>{!(a!=null&&a.isLoaded)||!a.intersectsClippingArea||a.level<s.level||i.has(a)||(i.add(a),e.push(a),a.renderData.updateNeighborData())};e.sort(Na);const r=e.length;for(let s=0;s<r;++s){const a=e[s];A(a.isLoaded),A(a.intersectsClippingArea);const n=a.renderData;n.updateNeighborData();const o=n._dirtyEdgeResolutions,l=n.geometryState.neighborData.cornerPeerNeighbors,c=d=>{var m;const p=Yd[d];t(a,(m=l[d])==null?void 0:m.findCorner(Xd(p),g=>g.isLoaded))};for(let d=0;d<4;++d)if(o&1<<d){const p=n.geometryState.neighborData.edgePeerNeighbors[d];p&&(p==null?void 0:p.level)>=a.level&&p.forAllSubtreeOnSide(C_(Sa[d]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(A(i.has(m)||Na(a,m)<0),t(a,m),!0)),c((d+1)%4),c(d)}}i.clear(),this._updateTilesGeometries(e),this._shouldEmitChangeEvent=!0,Ti&&ym&&this.checkAllTilesWaterproofness()}_mergeAndSplit(i,e){if(this.suspended||i.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let t=!1;const r=this.view.state.fixedContentCamera;let s=!1;for(;!i.done;){s=!0;let a=!1;const n=!this._allTiles.some(o=>{var c;if(!t&&!r&&!o.visible)return i.done;let l=o;if(o.resetPendingUpdate(ne.MERGE)){if(!e)return o.setPendingUpdate(ne.MERGE),i.done;for(;(c=l.parent)!=null&&c.resetPendingUpdate(ne.MERGE);)l=l.parent;this._mergeTile(l),a=!0,i.madeProgress()}else o.resetPendingUpdate(ne.SPLIT)&&(this._splitTile(o),a=!0,i.madeProgress());return!i.done&&l===o&&o.resetPendingUpdate(ne.RENDERDATA)&&(this._updateRenderData(o),i.madeProgress()),i.done});if(a&&(this._allTilesSorted=!1,this._allTilesDirty=!0),n){if(!t){t=!0;continue}if(!a)break}else this._allTilesDirty=!0}s?i.madeProgress():this._allTilesDirty=!0,!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries(),this._sortTiles(i)}_updateElevation(i){i.done||(this._allTiles.some(e=>(e.resetPendingUpdate(ne.GEOMETRY)&&(this._updateTileGeometryState(e),this._updateTileTexture(e,i),this._shortBatches&&this._updatePendingTileGeometries(),i.madeProgress()),i.done)),!this._oneBatchPerFrameTask&&this._updatePendingTileGeometries())}_updateTextures(i){i.done||this._allTiles.some(e=>(this._updateTileTexture(e,i),i.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Bt.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const i=this.view.quality;return this.view.qualitySettings.tiledSurface.lodBias-(1-i)*TC}_getLodBiasCorrectedScale(i){const e=this.tilingScheme.levels,t=K(i-this._lodBias,0,e.length-1),r=t-Math.floor(t);return e[Math.floor(t)].scale*(1-r)+e[Math.ceil(t)].scale*r}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(i=>this._purgeTile(i)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.renderer.visible=!1}_purgeDescendantTiles(i){if(!i.children[0])return!1;let e=!1;for(let t=0;t<4;++t)e=this._purgeTile(i.children[t])||e;return i.unsetChildren(),e}_purgeTile(i){const e=this._purgeDescendantTiles(i)||i.rendered;return this._allTiles.removeUnordered(i),this._unloadTile(i),this._tileCache.put(Nd._tileMemcacheKey,i),e}_unloadTile(i){this._pendingTilesToUpdate.delete(i),this._pendingTilesForElevationUpdateEvent.delete(i),i.unload(this._renderer)}_splitTile(i){Ns(i.isLeaf,"tile that is already split should not be split again!");const e=i.level+1,t=2*i.lij[1],r=2*i.lij[2];i.setChildren(this._createTile(e,t,r,i),this._createTile(e,t,r+1,i),this._createTile(e,t+1,r,i),this._createTile(e,t+1,r+1,i)),i.setPendingUpdate(ne.RENDERDATA),i.updateAgentSuspension(),this._allTiles.pushArray(i.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(i,e=i.level){cd.spatialReference=this.spatialReference,cd.extent=i.extent,cd.scale=this._getLodBiasCorrectedScale(e),this.emit("scale-change",cd)}_createTile(i,e,t,r){Ns(!!r,"_createTile sanity check");const s=this._acquireTile(i,e,t,r);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(ne.SPLIT),s}get _shortBatches(){return this.view.state.mode!==Ui.IDLE}_mergeTile(i){Ns(!i.hasPendingUpdate(ne.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(i)&&(Ns(!i.renderData,"_mergeTile sanity check"),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i),this._shortBatches&&this._updatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(i){Ns(i.rendered,"parent should be rendered"),this._unloadTile(i);const e=i.children;e.forEach(t=>this._loadTile(t)),e.forEach(t=>this._pendingTilesToUpdate.add(t)),this._markAllTileNeighborsForGeometryUpdate(i),this._emitTileScaleChange(i,i.level+1),this._shortBatches&&this._updatePendingTileGeometries()}_loadParent(i){const e=i.parent;this._unloadChildren(e),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e,e.level),this._shortBatches&&this._updatePendingTileGeometries()}_unloadChildren(i){const e=i.children;if(e[0])for(let t=0;t<4;++t){const r=e[t];this._unloadChildren(r),this._unloadTile(r)}}_loadTile(i){i.load(),i.setPendingUpdate(ne.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(i)}_elevationDataArrived(i,e,t){const r=new vE(i.lij,i.extent,t);i.dataArrived(e,Ce.ELEVATION,r);const s=[i],a=i.level,n=this._iteratorPool.acquire();for(n.reset(s);!n.done;){const o=n.next();o.findElevationBoundsForLayer(e,a),o.computeElevationBounds()}a===0&&this._updateRootTileElevationBounds(),n.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(i=Bs){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let e=!1;const t=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(t.add(s.uid),Kc(s)||Hl(s))if(this._basemapLayerViewHandles.has(s.uid)&&!Hl(s)){const a=this._layerClassFromLayerView(s),n=this._getLayerIdxByUID(a,s.uid);n!=null&&((n<r||r==null)&&(e=!0),r=n)}else this._registerTiledLayerView(s),s.layer.loaded&&(e=!0);this._basemapLayerViewHandles.forEach((s,a)=>{t.has(a)||(this._unregisterTiledLayerView(a),e=!0)}),e&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),i.madeProgress()}_allSurfaceLayersTransparent(){var e,t;let i=((t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.opacity)===0;for(const r of this.view.allLayerViews.items)if(lf(r)&&!yd(r.layer)&&r.fullOpacity!==0)return i=!1,i;return i}_hasCompositeBlendMode(){for(const i of this.view.allLayerViews.items)if((Jc(i)||Hl(i))&&GE(Jm[i.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(i){return cf(i)?Ce.ELEVATION:Ce.MAP}_registerTiledLayerView(i){const e=[];if((Jc(i)||Hl(i))&&e.push(D(()=>i.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(ni.UNFADED)})),!Hl(i)){const t=this._layerClassFromLayerView(i);e.push(D(()=>i.suspended,()=>this._updateTiledLayers())),e.push(D(()=>i.fullOpacity,()=>this._updateTileTextures(ni.UNFADED))),e.push(D(()=>"effectiveScaleRange"in i.layer?i.layer.effectiveScaleRange:null,()=>this._restartAllAgents(t))),e.push(i.on("data-changed",()=>{const r=this._getLayerIdxByUID(t,i.uid);r!=null&&this._invalidateLayerData(r,t)}))}this._unregisterTiledLayerView(i.uid),this._basemapLayerViewHandles.set(i.uid,e)}_unregisterTiledLayerView(i){const e=this._basemapLayerViewHandles.get(i);if(e){for(const t of e)t.remove();this._basemapLayerViewHandles.delete(i)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const i=this.view.allLayerViews,e=[[],[]];let t=null;i.forEach(r=>{if(!r.layer||r.suspended||!Kc(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Ce.MAP){const a=r.displayLevelRange.maxLevel;a!==1/0&&(t===null||a>t)&&(t=a)}e[s].push(r)});for(const r of Zn){const s=this._layerViews[r],a=e[r];a.reverse();const n=a.length;let o=s.length!==n;const l=new Array(n),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let d=0;d<n;d++){const p=a[d].uid;this._layerIndexByUid[r].set(p,d);const m=s.indexOf(a[d]);l[d]=m,d!==m&&(o=!0),m>-1&&(c[m]=d)}if(o){const d=this._postorderIterator;for(d.reset(this._rootTiles);!d.done;)d.next().modifyLayers(c,l,r);this._layerViews[r]=a,this._restartAllAgents(r),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(t)&&this._viewChangeUpdate()}_restartAllAgents(i){const e=this._postorderIterator;for(e.reset(this._rootTiles);!e.done;){const t=e.next();t.restartAgents(i),i===Ce.ELEVATION&&t.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(i,e){return this._layerViews[e][i]}numLayers(i){return this._layerViews[i].length}_updateTileTextures(i){this._allTiles.forAll(e=>{e.updateAgents(Ce.MAP),i===ni.IMMEDIATE?this.renderer.updateTileTexture(e,ne.TEXTURE_NOFADING):e.updateRenderData(Ce.MAP,i)}),this._evaluateTransparency()}_invalidateLayerData(i,e){this._allTiles.forAll(t=>t.removeLayerAgent(i,e)),this._allTiles.forAll(t=>t.invalidateLayerData(i,e))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(i=Bt.UPDATE){this.renderer.setNeedsRender(i)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(i,e,t,r){const s=this.layerViewByIndex(e,t),a=s.layer;return!a.tilemapCache||Kd(s)?this._requestTileData(i,t,s,r):(++this._asyncWorkItems,a.tilemapCache.fetchAvailability(i.lij[0],i.lij[1],i.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(n=>{throw--this._asyncWorkItems,fr(r),yn(n)||this._dataMissing(i,t,s,{notInTilemap:!0}),n}).then(()=>this._frameTask.schedule(()=>this._requestTileData(i,t,s,r),r.signal)))}_requestTileData(i,e,t,r){return e===Ce.ELEVATION?cf(t)?this._requestElevationTileData(i,t,r):Promise.reject():lf(t)?this._requestMapTileData(i,t,r):Promise.reject()}_requestElevationTileData(i,e,t){++this._asyncWorkItems;const r=n=>{if(rn(t))return;const o=this._layerIndexByUid[Ce.ELEVATION].get(e.uid);o!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(i,o,n)):ce.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Ce.ELEVATION,i.lij.toString())},s=n=>{yn(n)||(this._dataMissing(i,Ce.ELEVATION,e,n),this.requestUpdate())};if(hf(e.layer))return e.layer.fetchTile(i.lij[0],i.lij[1],i.lij[2],{noDataValue:Yc,signal:t.signal}).then(n=>{if(!rn(t))return this._frameTask.schedule(()=>r(n),t.signal,s);ce.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const a=e.getTileUrl(i.lij[0],i.lij[1],i.lij[2]);return this._elevationDataRequester.request(a,"binary",t).then(n=>this._lercDecoder.decode(n,{noDataValue:Yc},t.signal)).then(n=>{n?r(new FP(n)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(i,e,t){++this._asyncWorkItems;const r=(c,d)=>{--this._asyncWorkItems,gl(d),rn(t)||(this._dataMissing(i,Ce.MAP,e,c),this.requestUpdate())},s=c=>d=>r(d,c),a=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),rn(t)?gl(c):this._mapTileDataArrived(i,e,c)},t.signal,s(c)).catch(s(c)),n=(c,d=null)=>this._frameTask.schedule(()=>r(c,d));if(Kd(e)){const c=e.schemaHelper.getLevelRowColumn(i.lij);return e.fetchTile(c[0],c[1],c[2],t).then(a,n)}if(CC(e))return e.fetchTile(i.lij[0],i.lij[1],i.lij[2],t).then(a,n);if(PC(e)&&hf(e.layer))return e.layer.fetchTile(i.lij[0],i.lij[1],i.lij[2],t).then(c=>{if(rn(t))return ce.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void n(ks());a(c)},n);let o=e.getTileUrl(i.lij[0],i.lij[1],i.lij[2]);A2(e.layer)&&e.layer.refreshTimestamp&&(o+=`${o.includes("?")?"&":"?"}_ts=${e.layer.refreshTimestamp}`);const l=e.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(o,l,t).then(a,n)}_mapTileDataArrived(i,e,t){const r=this._getLayerIdxByUID(Ce.MAP,e.uid);r!=null?i.dataArrived(r,Ce.MAP,t):(gl(t),ce.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(i,e){return this._layerIndexByUid[i].get(e)}_dataMissing(i,e,t,r){const s=this._getLayerIdxByUID(e,t.uid);s!=null?i.dataMissing(s,e,r):ce.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(i){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(e=>{e.renderData&&this.overlayManager.setTileParameters(e)}),this._renderer.setNeedsRender(i))}get performanceInfo(){const i=this._performanceInfo;return i.numNodes=this._allTiles.length,i.numLeaves=i.numVisible=i.numRendered=i.numLoadedPerLevel.length=i.numRenderedPerLevel.length=0,this._allTiles.forAll(e=>{e.isLeaf&&i.numLeaves++;const t=e.level;e.renderData&&(i.numLoadedPerLevel[t]=(i.numLoadedPerLevel[t]||0)+1),e.visible&&(i.numVisible++,e.rendered&&(i.numRenderedPerLevel[t]=(i.numRenderedPerLevel[t]||0)+1,i.numRendered++))}),i}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory??0):0}_recalculateUsedMemory(){return this.tilingScheme?Math.round(this._allTiles.reduce((i,e)=>i+e.usedMemory,0)):null}getUsedMemoryForLayerView(i){let e=0;const t=this._layerClassFromLayerView(i),r=this._getLayerIdxByUID(t,i.uid);return r!=null&&this._allTiles.forAll(s=>e+=s.getUsedMemoryForLayer(t,r)),e}getTile(i){if(i==null||this._rootTiles==null)return null;const e=i.split("/").map(n=>+n);if(e[0]===0)return this._rootTiles.find(n=>n.lij[1]===e[1]&&n.lij[2]===e[2]);const t=2**e[0],r=Math.floor(e[1]/t),s=Math.floor(e[2]/t);let a;if(this._rootTiles.some(n=>n.lij[1]===r&&n.lij[2]===s&&(a=n,!0)),a){let n=1<<e[0]-1;for(;a.lij[0]<e[0];){let o=e[1]&n?2:0;if((e[2]&n)>0&&o++,!a.children[o])return null;a=a.children[o],n>>=1}return Ns(a.lij[0]===e[0]&&a.lij[1]===e[1]&&a.lij[2]===e[2],"not the right tile?"),a}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(i){this._renderer.renderPatchBorders=i}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(i){this._renderer.visualizeNormals=i}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(i){this._renderer.renderingDisabled=i}get test(){const i=this;return{renderer:i._renderer,lercDecoder:i._lercDecoder,forceReload:()=>{i._rootTiles!=null&&i._rootTiles.length>0&&(i._mergeTile(i._rootTiles[0]),i._viewChangeUpdate())},getTiles:()=>i._allTiles.toArray(),getRenderedTiles(){Zp.clear(),i._allTiles.forAll(t=>{t.visible&&t.rendered&&Zp.push(t)});const e=Zp.toArray();return aw(i.renderOrder,e),e},lockTilingScheme(e,t){i._extentHelper.defaultTiledLayersExtent=t,i.tilingSchemeLogic.test.lockTilingScheme(e)}}}checkAllTilesWaterproofness(){if(!ym)return;const i=this._rootTiles;if(i==null)return;const e=a=>{var n,o,l;return((l=(o=(n=a==null?void 0:a.renderData)==null?void 0:n.geometry)==null?void 0:o.indices)==null?void 0:l.length)>0},t=(a,n)=>{e(a)&&console.error("Tile[",a.lij,"] has geometry although parent[",n.lij,"] has geom")},r=a=>{var n,o;if(a.intersectsClippingArea)if(a.renderData&&!a.renderData.geometryState&&console.error("Tile[",a.lij,"] has renderData but not geometryState"),a.renderData&&!a.renderData.geometry&&console.error("Tile[",a.lij,"] has renderData but not geometryInfo"),!((n=a.renderData)!=null&&n.geometry)||(((o=a.renderData.geometry.indices)==null?void 0:o.length)??0)>0||console.error("Tile[",a.lij,"] has renderData but no indices - geometryInfo: ",a.renderData.geometry),e(a)){a.checkGeometryWaterproofness();for(const l of a.children)t(l,a)}else if(a.isLeaf)console.error("Tile[",a.lij,"] has no geometry and no children, from root to leaf");else for(const l of a.children)r(l)},s=a=>{var c;const n=((c=a.parent)==null?void 0:c.visible)??!0,o=a.visible;a.computeVisibility();const l=a.visible;if(o!==l&&n&&console.error(" Tile[",a.lij,"] has out of date visibility: ",o," instead of ",l),!a.isLeaf)for(const d of a.children)s(d)};for(const a of i)r(a),s(a)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(i){return this.isGlobal&&i[2]===this.lijEastEnd(i[0])-1}isWestEndWrap(i){return this.isGlobal&&i[2]===0}lijEastEnd(i){return 2**(i+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(i){const e=this.lijEastEnd(i[0]),t=i[2];if(0<=t&&t<e)return i;if(!this.isGlobal)return null;const r=(t+(t<0?e:0))%e;return[i[0],i[1],r]}enableInternalChecks(i){SC(i)}enableWaterproofnessChecks(i){RC(i)}};Te._tileMemcacheKey="TerrainTileMemcache",h([u()],Te.prototype,"_renderer",void 0),h([u({constructOnly:!0})],Te.prototype,"_scaleRangeQueries",void 0),h([u({constructOnly:!0})],Te.prototype,"view",void 0),h([u({constructOnly:!0})],Te.prototype,"overlayManager",void 0),h([u()],Te.prototype,"_hasPendingUpdates",void 0),h([u()],Te.prototype,"_asyncWorkItems",void 0),h([u()],Te.prototype,"_allTilesDirty",void 0),h([u()],Te.prototype,"_allTilesSorted",void 0),h([u()],Te.prototype,"_viewChanged",void 0),h([u()],Te.prototype,"_splitLimits",void 0),h([u({readOnly:!0})],Te.prototype,"_watchUpdatingTracking",void 0),h([u()],Te.prototype,"_frameTask",void 0),h([u({readOnly:!0})],Te.prototype,"snapLevel",null),h([u({readOnly:!0})],Te.prototype,"lodSnapping",null),h([u()],Te.prototype,"_userClippingExtent",null),h([u()],Te.prototype,"_rootTilesExtent",void 0),h([u({readOnly:!0})],Te.prototype,"extent",null),h([u({readOnly:!0})],Te.prototype,"groundExtent",null),h([u({readOnly:!0})],Te.prototype,"_tilingSchemeExtent",null),h([u({readOnly:!0})],Te.prototype,"updating",null),h([u({readOnly:!0})],Te.prototype,"running",null),h([u(yE)],Te.prototype,"updatingProgress",void 0),h([u({readOnly:!0})],Te.prototype,"updatingProgressValue",null),h([u()],Te.prototype,"_maxNumUpdating",void 0),h([u()],Te.prototype,"baseOpacity",null),h([u()],Te.prototype,"hasCompositeBlendMode",void 0),h([u({readOnly:!0})],Te.prototype,"viewingMode",null),h([u()],Te.prototype,"maxTextureScale",void 0),h([u({readOnly:!0})],Te.prototype,"ready",null),h([u({value:Al.FRONT_TO_BACK})],Te.prototype,"renderOrder",null),h([u({readOnly:!0})],Te.prototype,"rootTiles",null),h([u()],Te.prototype,"_rootTiles",void 0),h([u({readOnly:!0})],Te.prototype,"spatialReference",null),h([u({type:no})],Te.prototype,"backgroundColor",null),h([u({value:!1})],Te.prototype,"slicePlaneEnabled",null),h([u({readOnly:!0})],Te.prototype,"tilingScheme",void 0),h([u({readOnly:!0})],Te.prototype,"tilingSchemeLocked",null),h([u({readOnly:!0})],Te.prototype,"tilingSchemeLogic",void 0),h([u()],Te.prototype,"wireframe",null),h([u({value:!1})],Te.prototype,"suspended",null),h([u()],Te.prototype,"textureFadeDuration",null),h([u()],Te.prototype,"visibleElevationBounds",void 0),h([u()],Te.prototype,"rootTileElevationBounds",void 0),h([u()],Te.prototype,"_layerViewsDirty",void 0),h([u()],Te.prototype,"renderPatchBorders",null),h([u()],Te.prototype,"visualizeNormals",null),h([u()],Te.prototype,"renderingDisabled",null),Te=Nd=h([N("esri.views.3d.terrain.TerrainSurface")],Te);const u9=Te;function y1(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}function zw(i){const e=i.children;if(!e[0])return!1;for(const t of e)if(t.shouldLoad)return!0;for(const t of e)if(zw(t))return!0;return!1}function p9(i){var e;return i.isLeaf&&(((e=i.parent)==null?void 0:e.shouldLoad)??!1)}const Zi=gi(),m9=Yt(),Zp=new Et,Xp={spatialReference:null,extent:Yt(),context:"ground"},cd={spatialReference:null,extent:null,scale:0};function v1(i,e,t){var r;for(const s of i){if(!s.containsPointXY(e,t))continue;let a=s;for(;a&&!a.renderData;){const o=(e>a.extentMidX?1:0)+(t<a.extentMidY?2:0);a=a.children[o]}const n=((r=a==null?void 0:a.renderData)==null?void 0:r.geometryState.samplerData)??null;return xt(e,t,n)}return null}let _9=class{constructor(e,t,r,s){this.operation=e,this.geometry=t,this.states=r,this.sync=s}},wc=class extends ue{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,t){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((s,a)=>{const n=this._ensureGeomRecord(e,a);s.forEach(({geometry:o,operation:l,states:c},d)=>{let p=!1;if(l===Gt.UPDATE){const m=n.get(d);if(m){if(c&da.TRANSFORMATION){const g=this.model.getObject(a);this.model.updateRenderGeometryTransformation(g,o,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:c})}else Gs(!1,"ModelDirtySet.commitLayer: invalid update")}if(l===Gt.REMOVE||p){const m=n.get(d);m?(t.removes.push(m),n.delete(d)):l===Gt.REMOVE&&Gs(!1,"ModelDirtySet.commitLayer: invalid remove")}if(l===Gt.ADD||p){const m=this.model.getObject(a);if(m!=null){const g=this.model.getRenderGeometry(m,o);t.adds.push(g),n.set(d,g)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(a)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}commitSyncUpdates(e,t){const r=this._dirtyGeomRecords.get(e);r&&r.forEach((s,a)=>{const n=this._ensureGeomRecord(e,a);s.forEach(({geometry:o,operation:l,states:c,sync:d},p)=>{let m=!1;if(l===Gt.UPDATE&&d){const g=n.get(p);if(g){if(c&da.TRANSFORMATION){const f=this.model.getObject(a);this.model.updateRenderGeometryTransformation(f,o,g)&&(m=!0)}m||t.updates.push({renderGeometry:g,updateType:c})}else Gs(!1,"ModelDirtySet.commitSyncUpdates: invalid update")}})})}getResidentRenderGeometries(e,t){const r=this._residentGeomRecords.get(e);r&&r.forEach(s=>s.forEach(a=>t.push(a)))}_objectStateChanged(e,t){for(const r of t.geometries)this._updateOrCreateDirtyRecord(t,r,null,Gt.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(da.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(da.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(da.OCCLUDEE,e)}attributesChanged({object:e,geometry:t,sync:r}){this._updateOrCreateDirtyRecord(e,t,null,Gt.UPDATE,da.GEOMETRY,r)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const r=e.id;for(const s of t.geometries)this._geometryAdded(t,s,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const r=e.id;for(const s of t.geometries)this._geometryRemoved(t,s,r)}transformationChanged(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(s=>{this._updateOrCreateDirtyRecord(e,s.geometry,t,Gt.UPDATE,da.TRANSFORMATION)})}shaderTransformationChanged(e){const t=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(t,r).forEach(s=>{s.objectShaderTransformationChanged(e.shaderTransformation)})}geometryAdded(e){this._geometryAdded(e.object,e.geometry)}_geometryAdded(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Gt.ADD)}geometryRemoved(e){this._geometryRemoved(e.object,e.geometry)}_geometryRemoved(e,t,r=null){this._updateOrCreateDirtyRecord(e,t,r,Gt.REMOVE)}_updateOrCreateDirtyRecord(e,t,r,s,a=da.NONE,n=!1){r=r??this._getParentLayerId(e);const o=e.id,l=t.id,c=this._ensureDirtyRecord(r,o),d=c.get(l);if(d){const p=d.operation;p===Gt.REMOVE&&s===Gt.ADD&&d.states!==da.NONE?d.operation=Gt.UPDATE:p===Gt.REMOVE&&s===Gt.ADD||p===Gt.ADD&&s===Gt.REMOVE?c.delete(l):p!==Gt.UPDATE||s!==Gt.REMOVE&&s!==Gt.UPDATE?(Gs((p===Gt.REMOVE||p===Gt.ADD)&&s===Gt.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),d.states|=a):(d.operation=s,d.states|=a),d.sync=d.sync||n}else c.set(l,new _9(s,t,a,n));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let s=r.get(t);return s||(s=new Map,r.set(t,s)),s}get _hasDirtyGeometryRecords(){return Gd(this._dirtyGeomRecords,e=>Gd(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let s=r.get(t);return s||(s=new Map,r.set(t,s)),s}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:M2}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((r,s)=>{r.forEach((a,n)=>{t.length>0&&(t+=`
`),t+=s+"."+n;const o=[];a.forEach(l=>{const c=l.operation;o[c]||(o[c]=[]),o[c].push(l.geometry.id)});for(let l=0;l<o.length;l++)if(o[l]){t+=" "+e[l-1]+": ";for(let c=0;c<o[l].length;c++)t+=o[l][c]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,r)=>t+r.size,0)},commit:t=>e._dirtyGeomRecords.forEach((r,s)=>e.commitLayer(s,t))}}};h([u({constructOnly:!0})],wc.prototype,"model",void 0),h([u()],wc.prototype,"dirty",void 0),wc=h([N("esri.views.3d.webgl-engine.lib.ModelDirtySet")],wc);const g9=wc;let Fd=class extends ue{constructor(){super(...arguments),this.dirtySet=new g9({model:this}),this._content=new Map,this._originFactory=new bv(null)}getObject(e){return this._content.get(e)}add(e){const t=e.id;Gs(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),eu(e)&&this.dirtySet.layerAdded(e)}remove(e){return!!this._content.has(e.id)&&(this._content.delete(e.id),eu(e)&&this.dirtySet.layerRemoved(e),!0)}addMany(e){for(const t of e)t&&(Gs(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)t&&(Gs(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id))}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(r=>{r.type===e&&t(r)})}getRenderGeometry(e,t){const r=new _3(t,{castShadow:e.castShadow,objectShaderTransformation:e.shaderTransformation});r.transformation=e.getCombinedStaticTransformation(t,b1);const{localOrigin:s}=t;return r.localOrigin=s??this._originFactory.getOrigin(r.boundingSphere),r}updateRenderGeometryTransformation(e,t,r){if(e==null)return!1;r.transformation=e.getCombinedStaticTransformation(t,b1);const s=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==s}getStats(){const e={},t=Array.from(this._content.values());for(let r=0;r<Vy.COUNT;++r)e[r]=t.filter(s=>s.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};h([u({constructOnly:!0})],Fd.prototype,"dirtySet",void 0),Fd=h([N("esri.views.3d.webgl-engine.parts.Model")],Fd);const b1=nt();let f9=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let t=0;for(let r=0;r<e.length;r+=2)t+=e[r+1];return t}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=y9(e)}forEachComponent(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const s=t[r],a=s+t[r+1];for(let n=s;n<a;n++)if(!e(n))return!1}return!0}forEachComponentRange(e){const t=this._indexRanges;for(let r=0;r<t.length;r+=2){const s=t[r];if(!e(s,s+t[r+1]))return!1}return!0}computeOffsetRanges(e){const t=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const a=r[s],n=a+r[s+1],o=e[a],l=e[n];t[s]=o,t[s+1]=l-o}return t}};function y9(i){const e=new Array;if(i.length===0)return e;let t=i[0],r=1;for(let s=1;s<i.length;s++){const a=i[s];t+r===a?r+=1:(e.push(t),e.push(r),t=a,r=1)}return e.push(t),e.push(r),e}let v9=class{constructor(e,t){this.offsets=t,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new f9(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:t}=b9(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=t}}};function b9(i,e,t){const r=[],s=[];let a=t.length,n=t.length;return e.forEachComponent(o=>(i[o]>0?(a!==o-1&&(r.length&&r.push(t[a+1]-r[r.length-1]),r.push(t[o])),a=o):(n!==o-1&&(s.length&&s.push(t[n+1]-s[s.length-1]),s.push(t[o])),n=o),!0)),r.length&&r.push(t[a+1]-r[r.length-1]),s.length&&s.push(t[n+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}let xc=class extends ue{constructor(){super(...arguments),this.visible=xl.Hidden}destroy(){this.intersectionGeometry=re(this.intersectionGeometry)}};var xl;h([u({autoDestroy:!0})],xc.prototype,"renderable",void 0),h([u({autoDestroy:!0})],xc.prototype,"components",void 0),xc=h([N("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],xc),function(i){i[i.Hidden=0]="Hidden",i[i.Visible=1]="Visible"}(xl||(xl={}));function w9(i,e,t,r){if(t>=e)return i;i==null&&(i=x9());const s=i.isVisibleBit;let a=i.data;const n=Bw(a),o=t/n|0,l=t-n*o,c=(e-1)/n|0,d=a,p=r===s;if(!(t<d.length*n)&&p){const m=o+1,g=Math.ceil(d.length*D2),f=c+1;let y=Math.max(m,g);y=Math.min(y,f),a=new Uint32Array(y),a.set(d)}return o<a.length&&(a[o]=C9(a[o],l,p)),i.data=a,i}function qw(i,e){if(i==null)return!0;const{isVisibleBit:t,data:r}=i,s=Bw(r);return e<r.length*s?T9(t,r,e,s):!i.isVisibleBit}function x9(i=!0){return{isVisibleBit:!i,data:new Uint32Array(0)}}function T9(i,e,t,r){const s=t/r|0,a=t-s*r;return P9(e[s],a)===i}function Bw(i){return i.BYTES_PER_ELEMENT*8}function C9(i,e,t){return i&~(1<<e)|(t?1:0)<<e}function P9(i,e){return(i&1<<e)!=0}let S9=class{constructor(e,t){this._components=t,this._indices=e.indices?Uy(e.indices):L2(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(t.count)}destroy(){this._positions=null,this._indices=null,this._componentIntersectionData.length=0,this._perComponentAabbs=null}getComponentAabb(e,t){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let r=0;r<6;r++)t[r]=this._perComponentAabbs[6*e+r];return t}getComponentPositions(e,t){t.indices=this._indices,t.data=this._positions,t.stride=3,t.startIndex=this._components.offsets[e],t.endIndex=this._components.offsets[e+1]}intersect(e,t,r,s,a,n,o){const l=new Fy(this._positions,3),c=this._indices,d=this._components.offsets,p=F3(e,t,R9),m=e[2],g=t[2];this._components.visibility.forEachComponent(f=>{if(!qw(this._components.pickability,f))return!0;const y=this.getComponentAabb(f,O9);if(n!=null){const x=n[f];a!=null?a.componentOffset=x:(e[2]=m-x,t[2]=g-x)}if(a!=null&&a.applyToAabb(y),!V3(y,e,p,r))return!0;const v=d[f]/3,T=d[f+1]/3,w=(x,C,P)=>o(f,x,cn(C,C,s),P);return a==null&&T-v>Vw?(this._componentIntersectionData[f]==null&&(this._componentIntersectionData[f]=new hg(this._indices,v,T,l)),this._componentIntersectionData[f].intersectRay({r0:e,r1:t},w)):Sv(e,t,v,T,c,l,void 0,a,w),!0})}_computePerComponentAabbs(){const e=this._components.count,t=sv(6*e),r=this._indices,s=this._positions,a=this._components.offsets;let n=0;for(let o=0;o<e;o++){const l=a[o],c=a[o+1];let d=1/0,p=1/0,m=1/0,g=-1/0,f=-1/0,y=-1/0;for(let v=l;v<c;v++){const T=3*r[v],w=s[T],x=s[T+1],C=s[T+2];d=Math.min(d,w),p=Math.min(p,x),m=Math.min(m,C),g=Math.max(g,w),f=Math.max(f,x),y=Math.max(y,C)}t[n++]=d,t[n++]=p,t[n++]=m,t[n++]=g,t[n++]=f,t[n++]=y}return t}get positions(){return this._positions}get indices(){return this._indices}};const R9=b(),O9=g_();let E9=class{constructor(e,t,r){this.material=e,this.geometry=t,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},A9=class{constructor(e,t,r,s){this.vao=e,this.primitiveType=t,this.parameters=r,this.indexed=s}dispose(){this.vao.dispose()}},dg=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function M9(i,e){return{near:i,far:e}}function yh(i){return i?hh(i,1/0,-1/0):M9(1/0,-1/0)}function hh(i,e,t){return i.near=e,i.far=t,i}function Ml(i,e){e!=null&&(i.near=Math.min(i.near,e.near),i.far=Math.max(i.far,e.far))}function hd(i,e){return i.near<=e&&e<=i.far}const r_={near:0,far:0};function D9(i,e){const t=yh(),{eye:r,frustum:s,viewForward:a}=i;e.forAll(n=>{const o=n.offsetObb!=null?n.offsetObb:n.obb,l=Ie(Bi(Tr,o.center,r),a),c=XP(o,a);if(hd(t,l-c)&&hd(t,l+c))return;const d=F9(o,s);if(d===-1)return;if(d===0)return pa.far=l+c,pa.near=l-c,void Ml(t,pa);const p=dd.pushNew();p.near=l-c,p.far=l+c,p.mask=d,p.object=n});for(let n=0;n<dd.length;n++){const o=dd.data[n];if(hd(t,o.near)&&hd(t,o.far))continue;pa.far=o.far,pa.near=1/0,N9(o.object.offsetObb!=null?o.object.offsetObb:o.object.obb,r,L9,c=>{let d=$9;for(let p=0;p<Hw&&c.length>0;p++){if(!(o.mask&1<<p))continue;I9(s[p],c,d);const m=c;c=d,d=m}for(let p=0;p<c.length;p+=3){Xt(tr,c.data[p],c.data[p+1],c.data[p+2]);const m=Ie(Bi(tr,tr,r),a);pa.near=Math.min(pa.near,m)}})===0&&(pa.near=0),Ml(t,pa)}return dd.length=0,t}const dd=new Et({allocator:i=>i||{near:1/0,far:-1/0,mask:0,object:null},deallocator:i=>(i.object=null,i)}),pa=yh(),tr=b(),qn=b(),L9=new Et({deallocator:null}),$9=new Et({deallocator:null});function I9(i,e,t){t.length=0;const r=e.length-3;Yp(tr,e,r);const s=dm(i,tr);s<=0&&(t.push(tr[0]),t.push(tr[1]),t.push(tr[2]));let a=0,n=s;for(;a<r;a+=3){Yp(qn,e,a);const o=dm(i,qn);n*o<0&&(ws(tr,qn,tr,o/(o-n)),ir(t,tr)),o<=0&&ir(t,qn),n=o,ae(tr,qn)}n*s<0&&(Yp(qn,e,r),ws(tr,qn,tr,s/(s-n)),ir(t,tr))}function Yp(i,e,t){return Xt(i,e.data[t],e.data[t+1],e.data[t+2])}function ir(i,e){i.push(e[0]),i.push(e[1]),i.push(e[2])}function N9(i,e,t,r){$2(x1,i.quaternion),Bi(Tr,e,i.center),I2(Tr,Tr,x1);const s=8*((Tr[0]<-i.halfSize[0]?-1:Tr[0]>i.halfSize[0]?1:0)+3*(Tr[1]<-i.halfSize[1]?-1:Tr[1]>i.halfSize[1]?1:0)+9*(Tr[2]<-i.halfSize[2]?-1:Tr[2]>i.halfSize[2]?1:0)+13),a=w1[s];if(a===0)return a;N2(ud,i.quaternion),F2(ud,ud,i.halfSize);const n=(o,l)=>{const c=w1[s+l+1];return Xt(o,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),cn(o,o,ud),me(o,i.center,o)};return t.length=0,ir(t,n(Kp,0)),ir(t,n(T1,1)),ir(t,n(Tr,2)),ir(t,n(C1,3)),r(t),a===1||(t.length=0,ir(t,Kp),ir(t,C1),ir(t,n(Tr,4)),ir(t,n(P1,5)),r(t),a===2||(t.length=0,ir(t,Kp),ir(t,P1),ir(t,n(Tr,6)),ir(t,T1),r(t))),a}const w1=(()=>{const i=new Array(216);let e=0;const t=r=>{for(let s=0;s<r.length;s++)i[e+s]=r[s];e+=8};return t([3,0,6,2,3,1,5,4]),t([2,0,2,3,1,5,4,0]),t([3,1,0,2,3,7,5,4]),t([2,0,1,3,2,6,4,0]),t([1,0,1,3,2,0,0,0]),t([2,1,5,7,3,2,0,0]),t([3,2,0,1,3,7,6,4]),t([2,2,0,1,3,7,6,0]),t([3,3,0,1,5,7,6,2]),t([2,0,1,5,4,6,2,0]),t([1,0,1,5,4,0,0,0]),t([2,1,3,7,5,4,0,0]),t([1,0,2,6,4,0,0,0]),t([0,0,0,0,0,0,0,0]),t([1,1,3,7,5,0,0,0]),t([2,2,3,7,6,4,0,0]),t([1,2,3,7,6,0,0,0]),t([2,3,1,5,7,6,2,0]),t([3,4,0,1,5,7,6,2]),t([2,5,7,6,4,0,1,0]),t([3,5,0,1,3,7,6,4]),t([2,4,5,7,6,2,0,0]),t([1,4,5,7,6,0,0,0]),t([2,5,1,3,7,6,4,0]),t([3,6,0,2,3,7,5,4]),t([2,6,2,3,7,5,4,0]),t([3,7,6,2,3,1,5,4]),i})(),Hw=4;function F9(i,e){let t=0;for(let r=0;r<Hw;r++){const s=YP(i,e[r]);if(s>0)return-1;s===0&&(t|=1<<r)}return t}const ud=Ua(),x1=V2(),Tr=b(),Kp=b(),T1=b(),C1=b(),P1=b();let V9=class{constructor(e){this._objects=e}submit(e,t){this._objects.preSubmit(t),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,t,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?D9(e,this._objects.visibleObjects):null}};function U9(i){const e=On().vec3f(se.POSITION);return i.normals&&e.vec2i16(se.NORMALCOMPRESSED,{glNormalized:!0}),i.textureCoordinates===wn.Default?e.vec2f(se.UV0):i.textureCoordinates===wn.Atlas&&(e.vec2f(se.UV0),e.vec4u16(se.UVREGION,{glNormalized:!0})),i.colors&&e.vec4u8(se.COLOR,{glNormalized:!0}),e}let z9=class{constructor(){this.externalColor=gi(),this.externalColorMixMode=nu.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},q9=class extends Il{constructor(e,t){super(e,"int",pv.Draw,(r,s,a)=>r.setUniform1i(e,t(s,a)))}};var Ks;(function(i){i[i.Uniform=0]="Uniform",i[i.Varying=1]="Varying",i[i.COUNT=2]="COUNT"})(Ks||(Ks={}));const ug=429496.7296;function kw(i,e){Rm(i/ug*.5+.5,e)}function B9(i,e){switch(e.componentData){case Ks.Varying:return H9(i,e);case Ks.Uniform:return k9(i);case Ks.COUNT:return;default:fn(e.componentData)}}function H9(i,e){const{vertex:t,fragment:r}=i;t.include(xo),t.uniforms.add(new fo("componentColorTex",a=>a.componentParameters.texture.texture)),i.attributes.add(se.COMPONENTINDEX,"float"),i.varyings.add("vExternalColorMixMode","mediump float"),i.varyings.add("vExternalColor","vec4");const s=e.output===M.ObjectAndLayerIdColor;s&&i.varyings.add("vObjectAndLayerIdColor","vec4"),i.include(gP),t.constants.add("elevationScale","float",2*ug),t.constants.add("stride","float",li("enable-feature:objectAndLayerId-rendering")?3:2),t.code.add(_`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),t.code.add(_`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${s?_`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:_`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(_`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${s?_`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function k9(i){const{vertex:e,fragment:t}=i;e.uniforms.add(new wv("externalColor",r=>r.componentParameters.externalColor)),t.uniforms.add(new q9("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),i.varyings.add("vExternalColor","vec4"),e.code.add(_`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),t.code.add(_`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Ar;function G9(i,e){const t=i.vertex;switch(t.code.add(_`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Ar.None:t.code.add(_`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Ar.Opaque:t.code.add(_`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Ar.Transparent:t.code.add(_`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Ar.COUNT:break;default:fn(e.vertexDiscardMode)}}(function(i){i[i.None=0]="None",i[i.Transparent=1]="Transparent",i[i.Opaque=2]="Opaque",i[i.COUNT=3]="COUNT"})(Ar||(Ar={}));var Js;function AI(i){return i&&d_(i)?Js.Mars:i&&h_(i)?Js.Moon:Js.Earth}(function(i){i[i.Earth=1]="Earth",i[i.Mars=2]="Mars",i[i.Moon=3]="Moon",i[i.COUNT=4]="COUNT"})(Js||(Js={}));var Or;(function(i){i[i.None=0]="None",i[i.NoOverlay=1]="NoOverlay",i[i.ColorOverlay=2]="ColorOverlay",i[i.ColorOverlayWithWater=3]="ColorOverlayWithWater",i[i.COUNT=4]="COUNT"})(Or||(Or={}));let Me=class extends Ts{constructor(){super(...arguments),this.output=M.Color,this.textureCoordinateType=wn.None,this.componentData=Ks.Uniform,this.cullFace=v_.Back,this.vertexDiscardMode=Ar.None,this.doubleSidedMode=hn.WindingOrder,this.alphaDiscardMode=_l.Opaque,this.integratedMeshMode=Or.None,this.transparencyPassType=Jt.NONE,this.ellipsoidMode=Js.Earth,this.pbrMode=Qt.Disabled,this.normalType=Hr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};h([I({count:M.COUNT})],Me.prototype,"output",void 0),h([I({count:wn.COUNT})],Me.prototype,"textureCoordinateType",void 0),h([I({count:Ks.COUNT})],Me.prototype,"componentData",void 0),h([I({count:v_.COUNT})],Me.prototype,"cullFace",void 0),h([I({count:Ar.COUNT})],Me.prototype,"vertexDiscardMode",void 0),h([I({count:hn.COUNT})],Me.prototype,"doubleSidedMode",void 0),h([I({count:_l.COUNT})],Me.prototype,"alphaDiscardMode",void 0),h([I({count:Or.COUNT})],Me.prototype,"integratedMeshMode",void 0),h([I({count:Jt.COUNT})],Me.prototype,"transparencyPassType",void 0),h([I({count:Js.COUNT})],Me.prototype,"ellipsoidMode",void 0),h([I({count:Qt.COUNT})],Me.prototype,"pbrMode",void 0),h([I({count:Hr.COUNT})],Me.prototype,"normalType",void 0),h([I()],Me.prototype,"spherical",void 0),h([I()],Me.prototype,"doublePrecisionRequiresObfuscation",void 0),h([I()],Me.prototype,"hasVertexColors",void 0),h([I()],Me.prototype,"hasNormals",void 0),h([I()],Me.prototype,"hasSlicePlane",void 0),h([I()],Me.prototype,"hasColorTexture",void 0),h([I()],Me.prototype,"receiveAmbientOcclusion",void 0),h([I()],Me.prototype,"receiveShadows",void 0),h([I()],Me.prototype,"blendingEnabled",void 0),h([I()],Me.prototype,"hasScreenSpaceReflections",void 0),h([I()],Me.prototype,"hasPolygonOffset",void 0),h([I()],Me.prototype,"hasMetallicRoughnessTexture",void 0),h([I()],Me.prototype,"hasEmissionTexture",void 0),h([I()],Me.prototype,"hasOcclusionTexture",void 0),h([I()],Me.prototype,"hasNormalTexture",void 0),h([I()],Me.prototype,"hasOccludees",void 0),h([I()],Me.prototype,"multipassEnabled",void 0),h([I()],Me.prototype,"cullAboveGround",void 0),h([I()],Me.prototype,"hasCloudsReflections",void 0),h([I()],Me.prototype,"snowCover",void 0),h([I()],Me.prototype,"objectAndLayerIdColor",void 0),h([I({constValue:!1})],Me.prototype,"occlusionPass",void 0),h([I({constValue:pv.Draw})],Me.prototype,"pbrTextureBindType",void 0),h([I({constValue:!0})],Me.prototype,"hasSliceHighlight",void 0),h([I({constValue:!1})],Me.prototype,"hasSliceInVertexProgram",void 0),h([I({constValue:!1})],Me.prototype,"useCustomDTRExponentForWater",void 0),h([I({constValue:!1})],Me.prototype,"hasVertexTangents",void 0),h([I({constValue:!0})],Me.prototype,"supportsTextureAtlas",void 0),h([I({constValue:!1})],Me.prototype,"highStepCount",void 0),h([I({constValue:!1})],Me.prototype,"instancedDoublePrecision",void 0),h([I({constValue:!1})],Me.prototype,"hasModelTransformation",void 0),h([I({constValue:!0})],Me.prototype,"useFillLights",void 0),h([I({constValue:!1})],Me.prototype,"objectAndLayerIdColorInstanced",void 0);function S1(i,e){i.include(qv,e),i.fragment.include(fP);const t=i.fragment;t.uniforms.add(new wv("baseColor",r=>r.baseColor)),t.uniforms.add(new yl("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?t.code.add(_`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):t.code.add(_`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),t.code.add(_`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function R1(i,e){const t=i.fragment;switch(e.doubleSidedMode){case hn.None:t.code.add(_`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case hn.View:i.include(vd,e),t.code.add(_`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case hn.WindingOrder:t.code.add(_`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:fn(e.doubleSidedMode);case hn.COUNT:}switch(e.normalType){case Hr.Attribute:case Hr.Compressed:i.include(mv,e),t.code.add(_`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Hr.ScreenDerivative:i.include(vd,e),t.code.add(_`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Hr.Ground:e.spherical?(i.include(vd,e),t.code.add(_`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):t.code.add(_`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),t.code.add(_`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:fn(e.normalType);case Hr.COUNT:}}function j9(i,e){const t=i.fragment;if(e.hasColorTexture&&(e.output===M.Color||e.alphaDiscardMode!==_l.Opaque)){i.include(GC,e);const r=e.textureCoordinateType===wn.Atlas;t.uniforms.add(new fo("baseColorTexture",s=>s.texture)),r?(i.include(jC),t.code.add(_`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):t.code.add(_`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else t.code.add(_`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function W9(i){const e=new At;e.include(vd,i),e.include(mv,i),e.include(qv,i),e.include(Lu,i),e.include(cv,i),e.include(B9,i),e.include(yP,i),e.include(WC,i),e.include(j9,i),e.include(G9,i);const{vertex:t,fragment:r}=e;i.pbrMode!==Qt.Normal&&i.pbrMode!==Qt.Schematic||(e.include(QC,i),i.hasNormalTexture&&e.include(vP,i));const s=i.output===M.Shadow||i.output===M.ShadowHighlight||i.output===M.ShadowExcludeHighlight;s&&i.componentData===Ks.Varying?t.code.add(_`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):t.code.add(_`#define discardShadows(castShadows) {}`);const a=i.integratedMeshMode===Or.ColorOverlay||i.integratedMeshMode===Or.ColorOverlayWithWater,n=a&&i.output===M.Color&&i.pbrMode===Qt.WaterOnIntegratedMesh;return a&&(e.include(au,i),e.include(g3,i),i.spherical?t.code.add(_`
      const float invEllipsoidRadius = ${_.float(1/(i.ellipsoidMode===Js.Earth?Fs.radius:i.ellipsoidMode===Js.Mars?U2.radius:z2.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):t.code.add(_`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),t.code.add(_`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${i.output===M.ObjectAndLayerIdColor?_`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${_.float(ZC)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${i.output===M.ObjectAndLayerIdColor?_`forwardObjectAndLayerIdColor();`:""}
      ${n?i.spherical?_`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:_`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${a?_`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),i.output===M.Alpha&&(r.include(go),e.include(xm,i),e.include(S1,i),a&&r.uniforms.add(new ke("ovColorTex",(o,l)=>yf(o,l))),r.code.add(_`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${i.multipassEnabled?_`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${a?_`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),i.output===M.Color&&(r.include(go),e.include(xm,i),e.include(S1,i),e.include(R1,i),e.include(au,i),i.receiveShadows?(e.include(_v,i),r.code.add(_`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(_`float evaluateShadow() { return 0.0; }`),a&&r.uniforms.add(new ke("ovColorTex",(o,l)=>yf(o,l))),r.code.add(_`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${i.multipassEnabled?_`terrainDepthTest(vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${a?_`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),i.pbrMode===Qt.Normal||i.pbrMode===Qt.Schematic?(uv(r),r.code.add(_`
        ${i.pbrMode===Qt.Normal?_`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),i.hasNormalTexture?r.code.add(_`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(_`vec3 shadingNormal = normalVertex;`),r.code.add(_`${i.spherical?_`vec3 normalGround = normalize(positionWorld());`:_`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(_`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * evaluateAmbientOcclusionInverse();

        ${i.snowCover?_`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${a?_` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(i.receiveShadows?r.code.add(_`float shadow = evaluateShadow();`):i.spherical?($v(r),r.code.add(_`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(_`float shadow = 0.0;`),n&&r.uniforms.add(new ke("ovNormalTex",(o,l)=>{var c;return(c=l.overlay)==null?void 0:c.getTexture(ms.WaterNormal)})),i.snowCover&&r.code.add(_`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(_`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${a?_` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?_`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(_`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${i.transparencyPassType===Jt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(i.output===M.Depth||s)&&(e.include(wm,i),r.code.add(_`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),i.output===M.Normal&&(e.include(R1,i),r.code.add(_`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material to influence ambient occlusion,
        // see the ssao fragment shader
        float alpha = ${i.normalType===Hr.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),i.output===M.ObjectAndLayerIdColor&&e.fragment.code.add(_`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?_`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),i.output===M.Highlight&&(e.include(lv),r.code.add(_`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${a?_`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}const Q9=Object.freeze(Object.defineProperty({__proto__:null,build:W9},Symbol.toStringTag,{value:"Module"}));let Gw=class jw extends $t{initializeConfiguration(e,t){t.spherical=e.viewingMode===Ne.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Mt(e.rctx,jw.shader.get().build(this.configuration),Ww)}_setPipelineState(e){const t=this.configuration,r=t.integratedMeshMode!==Or.None,s=e===Jt.NONE,a=e===Jt.FrontFace;return Je({blending:t.output!==M.Color&&t.output!==M.Alpha||!t.blendingEnabled?null:s?Ev:q3(e),culling:B3(t.cullFace),depthTest:{func:H3(e)},depthWrite:s||a?L_:null,colorWrite:tt,stencilWrite:r||t.hasOccludees?XC:null,stencilTest:r?YC(Oc.IntegratedMeshMaskExcluded):t.hasOccludees?KC:null,polygonOffset:s||a?t.hasPolygonOffset?{factor:2,units:2}:null:k3})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Gw.shader=new Lt(Q9,()=>ie(()=>import("./ComponentShader.glsl-1fb2b0bb.js"),["assets/ComponentShader.glsl-1fb2b0bb.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/symbolColorUtils-3ca646c8.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/vec2f32-eaf29605.js","assets/VerticalOffset.glsl-5743f98e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/ColorMaterial-bdf1f62a.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const Ww=new Map([[se.POSITION,0],[se.NORMAL,1],[se.NORMALCOMPRESSED,1],[se.COLOR,2],[se.UV0,3],[se.UVREGION,4],[se.COMPONENTINDEX,5]]);let Z9=class extends ti{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},pg=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function Ot(i={}){return(e,t)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,i.vectorOps){const s=i.vectorOps;Object.defineProperty(e,t,{get(){return this[r]},set(a){const n=this[r];if(n==null)this[r]=a;else{if(s.equals(n,a))return;s.copy(n,a)}this._setDirty()}})}else Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(i.dispose&&this[r]&&this[r].dispose(),this[r]=s,this._setDirty())}})}}function O1(){return(i,e)=>{const t=i._parameterCount??0;i._parameterCount=t+1,i._parameterBlocks=i._parameterBlocks||[],i._parameterBlocks.push(t),Object.defineProperty(i,e,{get(){return this[t]},set(r){this[t]!==r&&(this[t]=r,this._setDirty())}})}}let ku=class{constructor(e){this._low=b(),this._high=b(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){ae(this._low,ae(E1,e));const t=Bi(E1,e,this._low);ae(this._high,t)}get(e){return me(e,this._low,this._high)}getLowScaled(e){return J(e,this._low,1)}};const E1=j3();let ai=class extends Z9{constructor(e,t){super(),this.toMapSpace=t,this.baseColor=Zr(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ty(bP),this.emissiveFactor=ft(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new Vd,this.componentParameters=new Uc,this.textureAlphaCutoff=JC,this.alphaDiscardMode=_l.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Js.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Me;const r=new ku(e.position),s=QP(e.rotationScale);_h(s,s),this.transformNormalGlobalFromModel=q2(Ll(s,s)),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=et(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,t,r,s){const a=this._techniqueConfiguration;a.hasVertexColors=s.colors,a.hasNormals=s.normals,a.textureCoordinateType=s.textureCoordinates,a.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,a.hasEmissionTexture=this.emissionTexture!=null,a.hasOcclusionTexture=this.occlusionTexture!=null,a.hasNormalTexture=this.normalTexture!=null,a.transparencyPassType=t.identifier===Zo.Material&&r.transparencyPassType!=null?r.transparencyPassType:Jt.NONE,a.multipassEnabled=t.identifier===Zo.Material&&r.multipassEnabled,a.cullAboveGround=t.identifier===Zo.Material&&r.multipassTerrain.cullAboveGround,a.ellipsoidMode=this.ellipsoidMode,a.componentData=this.componentParameters.type,a.cullFace=this.commonMaterialParameters.cullFace,a.doubleSidedMode=this.commonMaterialParameters.doubleSided?hn.View:hn.None,a.hasColorTexture=this.baseColorTexture!=null;const n=this._computeWhichMaterialPass();if(a.blendingEnabled=n===Vi.Transparent||n===Vi.OpaqueAndTransparent,a.alphaDiscardMode=this.alphaDiscardMode,a.integratedMeshMode=this.isIntegratedMesh?K9(r)?Y9(r)?Or.ColorOverlayWithWater:Or.ColorOverlay:Or.NoOverlay:Or.None,a.hasPolygonOffset=this.polygonOffsetEnabled,a.pbrMode=a.integratedMeshMode===Or.ColorOverlayWithWater?Qt.WaterOnIntegratedMesh:this.usePBR?this.hasParametersFromSource?Qt.Schematic:Qt.Normal:Qt.Disabled,a.normalType=a.integratedMeshMode===Or.None?a.hasNormals?Hr.Compressed:Hr.ScreenDerivative:Hr.Ground,a.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,t.identifier===Zo.ShadowMap)a.output=M.Shadow,a.vertexDiscardMode=Ar.None;else if(t.identifier===Zo.Highlight)a.output=M.Highlight,a.vertexDiscardMode=Ar.None;else{switch(n===Vi.OpaqueAndTransparent?a.vertexDiscardMode=t.transparent?Ar.Opaque:Ar.Transparent:a.vertexDiscardMode=Ar.None,a.output=t.output,a.receiveAmbientOcclusion=!1,a.receiveShadows=!1,t.output){case M.Color:a.receiveAmbientOcclusion=r.ssao!=null,a.hasOccludees=r.hasOccludees,a.receiveShadows=r.shadowMap.ready,a.hasScreenSpaceReflections=r.ssr.lastFrameColor!=null,a.hasCloudsReflections=r.cloudsFade.data!=null;break;case M.Alpha:a.hasOccludees=r.hasOccludees;break;case M.ObjectAndLayerIdColor:a.objectAndLayerIdColor=!0}a.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(Gw,a,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,t,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,a=r.components,n=r.renderable.meta.cameraDepthSquared,o=a.geometryRanges,l=a.highlightRanges,c=a.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Vi.Opaque:e.materialOpaque.submitDraw(this,s,o,n);break;case Vi.Transparent:e.materialTransparent.submitDraw(this,s,o,n);break;case Vi.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,s,o,n),e.materialTransparent.submitDraw(this,s,o,n);break;case Vi.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,s,o,n),X9(t)&&e.highlightIntegratedMesh.submitDraw(this,s,o,n)}const d=this.componentParameters.castShadows!==ri.None;d&&e.shadowMap.submitDraw(this,s,o,n),l!=null&&(e.highlight.submitDraw(this,s,l,n),d&&e.highlightShadowMap.submitDraw(this,s,l,n)),d&&c!=null&&e.defaultShadowMap.submitDraw(this,s,c,n)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Vi.IntegratedMesh:this.objectOpacity<1?Vi.Transparent:this.componentParameters.opaqueOverride===ri.All?Vi.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===_l.Blend||this.alphaDiscardMode===_l.MaskBlend?Vi.Transparent:this.componentParameters.transparent===ri.None?Vi.Opaque:this.componentParameters.transparent===ri.All?Vi.Transparent:Vi.OpaqueAndTransparent}};var Vi,ri;h([Ot({vectorOps:zy})],ai.prototype,"baseColor",void 0),h([Ot()],ai.prototype,"usePBR",void 0),h([Ot()],ai.prototype,"hasParametersFromSource",void 0),h([Ot({vectorOps:Bg})],ai.prototype,"mrrFactors",void 0),h([Ot({vectorOps:Bg})],ai.prototype,"emissiveFactor",void 0),h([Ot({dispose:!0})],ai.prototype,"baseColorTexture",void 0),h([Ot({dispose:!0})],ai.prototype,"metallicRoughnessTexture",void 0),h([Ot({dispose:!0})],ai.prototype,"emissionTexture",void 0),h([Ot({dispose:!0})],ai.prototype,"occlusionTexture",void 0),h([Ot({dispose:!0})],ai.prototype,"normalTexture",void 0),h([Ot()],ai.prototype,"objectOpacity",void 0),h([O1()],ai.prototype,"commonMaterialParameters",void 0),h([O1()],ai.prototype,"componentParameters",void 0),h([Ot()],ai.prototype,"textureAlphaCutoff",void 0),h([Ot()],ai.prototype,"alphaDiscardMode",void 0),h([Ot()],ai.prototype,"isIntegratedMesh",void 0),h([Ot()],ai.prototype,"polygonOffsetEnabled",void 0),h([Ot()],ai.prototype,"ellipsoidMode",void 0),h([Ot()],ai.prototype,"hasOccludees",void 0),function(i){i[i.Opaque=0]="Opaque",i[i.Transparent=1]="Transparent",i[i.OpaqueAndTransparent=2]="OpaqueAndTransparent",i[i.IntegratedMesh=3]="IntegratedMesh"}(Vi||(Vi={}));let Vd=class extends pg{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=v_.Back,this.hasSlicePlane=!0}};h([Ot()],Vd.prototype,"doubleSided",void 0),h([Ot()],Vd.prototype,"cullFace",void 0),h([Ot()],Vd.prototype,"hasSlicePlane",void 0);let Uc=class extends pg{constructor(){super(...arguments),this.externalColor=Zr(1,1,1,1),this.externalColorMixMode=nu.Multiply,this.castShadows=ri.All}get transparent(){return this.externalColor[3]<1?ri.All:ri.None}get opaqueOverride(){return this.externalColorMixMode===nu.Replace&&this.externalColor[3]===1?ri.All:ri.None}get visible(){return this.externalColor[3]>0?ri.All:ri.None}get type(){return Ks.Uniform}};h([Ot({vectorOps:zy})],Uc.prototype,"externalColor",void 0),h([Ot()],Uc.prototype,"externalColorMixMode",void 0),h([Ot()],Uc.prototype,"castShadows",void 0),function(i){i[i.All=0]="All",i[i.Some=1]="Some",i[i.None=2]="None"}(ri||(ri={}));let Tc=class extends pg{constructor(){super(...arguments),this.texture=null,this.transparent=ri.None,this.opaqueOverride=ri.None,this.castShadows=ri.None}get type(){return Ks.Varying}};function X9(i){var e;return((e=i.overlay)==null?void 0:e.getTexture(ms.Highlight))!=null}function Y9(i){var e;return((e=i.overlay)==null?void 0:e.getTexture(ms.WaterNormal))!=null}function K9(i){var e;return((e=i.overlay)==null?void 0:e.getTexture(ms.ColorNoRasterImage))!=null}h([Ot()],Tc.prototype,"texture",void 0),h([Ot()],Tc.prototype,"transparent",void 0),h([Ot()],Tc.prototype,"opaqueOverride",void 0),h([Ot()],Tc.prototype,"castShadows",void 0);let J9=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},eM=class{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this.textureWidth=4096,this._dirty=!0;const r=new Yr(this.textureWidth,1);r.samplingMode=Da.NEAREST,r.wrapMode=ra.CLAMP_TO_EDGE,this._texture=new Hi(this._rctx,r),this._data=new Qd(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,t,r,s,a,n){const o=e*this._fieldCount+t;this._dirty=!0,this._data.set(o,0,r),this._data.set(o,1,s),this._data.set(o,2,a),this._data.set(o,3,n)}setDataElement(e,t,r,s){const a=e*this._fieldCount+t;this._dirty=!0,this._data.set(a,r,s)}getDataElement(e,t,r){const s=e*this._fieldCount+t;return this._dirty=!0,this._data.get(s,r)}resizeToFit(e){const t=(e+1)*this._fieldCount;if(t>this._data.count){const r=Math.ceil(t/this.textureWidth)*this.textureWidth,s=new Qd(new ArrayBuffer(4*r));s.typedBuffer.set(this._data.typedBuffer),this._data=s}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,t=this._texture.descriptor.height;this._data.count>e*t&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const Qw=65536;let tM=class{constructor(e,t=1){this.textureBuffer=new eM(e,t),this._indexManager=new J9(Qw)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Zw=class{constructor(e,t=1){this._rctx=e,this._fieldCount=t,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>Qw)return null;const t=new tM(this._rctx,this._fieldCount);return this._buffers.push(t),t}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const A1=ce.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let iM=class{constructor(e,t){this._renderManager=e,this._viewingMode=t,this._objects=[new Et,new Et],this._renderSubmit=new V9(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=li("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new Zw(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){Gs(this._objects[xl.Hidden].length===0&&this._objects[xl.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(t=>t.toArray());for(const t of e)t==null||t.destroy()}createObject(e){const t=new xc;return t.toMapSpace=e.toMapSpace,t.transform=e.transform,t.obb=Mf(e.obb),t.components=new v9(this._componentBufferManager,Uy(e.geometry.componentOffsets)),t.renderable=this._createRenderable(e,t.components),t.intersectionGeometry=new S9(e.geometry.positionData,t.components),this._objects[t.visible].push(t),t}destroyObject(e){const t=e;this._objects[t.visible].removeUnordered(t),t.destroy(),this._notifyDirty()}setObjectVisibility(e,t){const r=e;t!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[t].push(r),r.visible=t,this._notifyDirty())}preSubmit(e){const t=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=un(t,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,t){const r=e.renderable.material;t(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,t){const r=e;r.components.visibility.reset(t),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,t){return e.components.visibility.forEachComponent(t)}getComponentCount(e){const t=e,r=t.components.visibility.componentCount();return{visible:r,invisible:t.components.count-r}}setComponentData(e,t){const r=e,s=r.renderable.material,a=r.components,n=a.materialDataBuffer,o=a.materialDataIndices,l=new z9,c=n.textureBuffer,d=new Uint8Array(4),p=new Uint32Array(d.buffer);let m=0,g=0,f=0,y=a.verticalOffsets,v=1/0,T=-1/0,w=!1,x=!1,C=0;for(let P=0;P<a.count;P++){t(P,l),m+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===nu.Replace&&l.externalColor[3]===1),f+=+l.castShadows,ZP(l.externalColor,l.externalColorMixMode,d),d[2]=254&d[2]|+l.castShadows,c.setData(o[P],0,d[0],d[1],d[2],d[3]),w||(w=P>0&&C!==p[0]),C=p[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(P).fill(0)),y!=null&&(y[P]=l.elevationOffset),v=Math.min(v,l.elevationOffset),T=Math.max(T,l.elevationOffset),kw(l.elevationOffset,d),c.setData(o[P],1,d[0],d[1],d[2],d[3]);const R=l.objectAndLayerIdColor;R!=null&&c.setData(o[P],2,R[0],R[1],R[2],R[3]),l.pickable!==qw(a.pickability,P)&&(a.pickability=w9(a.pickability,a.count,P,l.pickable))}a.verticalOffsets=x?y:null,r.offsetObb=x?KP(r.obb,v,T,this._viewingMode,r.offsetObb!=null?r.offsetObb:Mf(r.obb)):null,w||x||this._hasObjectAndLayerId?(s.componentParameters=new Tc,s.componentParameters.castShadows=Jp(f,a.count),s.componentParameters.transparent=Jp(m,a.count),s.componentParameters.opaqueOverride=Jp(g,a.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new Uc,s.componentParameters.castShadows=l.castShadows?ri.All:ri.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,t,r,s=!1){e.intersectionGeometry.getComponentAabb(t,r);const a=e,n=a.components.verticalOffsets;if(s||n==null)return r;const o=n[t];if(this._viewingMode===Ne.Local||o===0)return r[2]+=o,r[5]+=o,r;const l=rP(o);return l.localOrigin=a.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,t,r){return e.intersectionGeometry.getComponentPositions(t,r)}intersect(e,t,r,s,a,n){const o=e;a!=null&&(a.localOrigin=o.transform.position);const l=_h(M1,o.transform.rotationScale);Bi(pd,t,o.transform.position),Bi(md,r,o.transform.position),cn(pd,pd,l),cn(md,md,l);const c=Ll(M1,l);return o.intersectionGeometry.intersect(pd,md,s,c,a,o.components.verticalOffsets,n)}addEdges(e,t,r,s){const a=e,{indices:n,positions:o}=a.intersectionGeometry,l=a.components.offsets;return t.addComponentObject(e,a.transform,{center:a.obb.center,radius:JP(a.obb)},o,n,l,r,s)}async extractEdgeInformation(e,t,r){const s=e,a=s.components.visibility;if(a.allInvisible())return{buffer:tS.createBuffer(0),origin:[0,0,0]};const{indices:n,positions:o}=s.intersectionGeometry,l=s.components.offsets,c=Om.createBuffer(o.length/3);Uv(c.position.typedBuffer,o,c.position.typedBufferStride,3),B2(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,n,l);const d=c.count,p=this._computeVisibilityIndices(n,a,l,d);return{origin:vn(s.transform.position),buffer:await t.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,t,r){let s=0;for(let a=0;a<r.length-1;a++){const n=r[a],o=r[a+1];for(let l=n;l<o;l++){const c=t?t[l]:l;e.set(c,s)}s++}}_computeVisibilityIndices(e,t,r,s){if(e&&t.allVisible())return e;let a=0;t.forEachComponentRange((l,c)=>(a+=r[c]-r[l],!0));const n=H2(e)?new Array(a):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(a):new Uint32Array(a);let o=0;return t.forEachComponentRange((l,c)=>{const d=r[l],p=r[c];for(let m=d;m<p;m++)n[o++]=e?e[m]:m;return!0}),n}addComponentHighlight(e,t){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[t]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,t){const r=e.components;if(r.highlightCounts==null)return void A1.warn("Removing non-existing highlight.");const s=r.highlightCounts[t],a=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[t]=s-1,void(r.highlightCounts[r.count]=a-1);r.highlightCounts[t]=0,r.highlightsDirty(),this._notifyDirty(),a===1?r.highlightCounts=null:r.highlightCounts[r.count]=a-1}else A1.warn("Removing non-existing highlight.")}clearHighlights(e){const t=e.components;t.highlightCounts!=null&&(t.highlightCounts=null,t.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[xl.Visible]}_createRenderable(e,t){const r=this._renderManager.rctx,s=e.geometry,a=s.vertices.layoutParameters,n=Lr.createVertex(r,vs.STATIC_DRAW,s.vertices.data),o=s.indices?Lr.createIndex(r,vs.STATIC_DRAW,s.indices):null,l=Rn(U9(a)),c=new Uint16Array(s.vertices.count);for(let y=0;y<t.count;y++){const v=t.offsets[y],T=t.offsets[y+1],w=t.materialDataIndices[y];if(s.indices!=null)for(let x=v;x<T;x++)c[s.indices[x]]=w;else for(let x=v;x<T;x++)c[x]=w}const d=Lr.createVertex(r,vs.STATIC_DRAW,c.buffer),p=new ai(e.transform,e.toMapSpace),m=new nS(r,Ww,{data:l,componentIndices:rM},{data:n,componentIndices:d},o),g=new A9(m,fi.TRIANGLES,a,o!=null),f={cameraDepthSquared:.5,gpuMemoryEstimate:n.byteLength+d.byteLength+(o!=null?o.byteLength:0)};return new E9(p,g,f)}_notifyDirty(){this._renderManager.notifyDirty()}};const rM=Rn(On().u16(se.COMPONENTINDEX));function Jp(i,e){return i===e?ri.All:i===0?ri.None:ri.Some}const M1=zv(),pd=b(),md=b();let mg=class extends ti{constructor(){super(...arguments),this.opacity=1}};function sM(i){const e=new At;return e.include($r),e.fragment.uniforms.add(new ke("tex",t=>t.texture)),i.hasOpacityFactor&&e.fragment.uniforms.add(new Ue("opacity",t=>t.opacity)),e.fragment.code.add(_`
    void main() {
      fragColor = texture(tex, uv) ${i.hasOpacityFactor?"* opacity":""};
    }`),e}const aM=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:mg,build:sM},Symbol.toStringTag,{value:"Module"}));var Li;(function(i){i[i.None=0]="None",i[i.Alpha=1]="Alpha",i[i.PremultipliedAlpha=2]="PremultipliedAlpha",i[i.COUNT=3]="COUNT"})(Li||(Li={}));let wu=class extends Ts{constructor(){super(...arguments),this.alphaMode=Li.None,this.hasOpacityFactor=!1}};h([I({count:Li.COUNT})],wu.prototype,"alphaMode",void 0),h([I()],wu.prototype,"hasOpacityFactor",void 0);let _g=class Xw extends $t{initializeProgram(e){return new Mt(e.rctx,Xw.shader.get().build(this.configuration),It)}initializePipeline(){switch(this.configuration.alphaMode){case Li.None:return Je({colorWrite:tt});case Li.Alpha:return Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt});case Li.PremultipliedAlpha:case Li.COUNT:return Je({blending:sa(G.ONE,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt})}}};_g.shader=new Lt(aM,()=>ie(()=>import("./Compositing.glsl-739329ff.js"),["assets/Compositing.glsl-739329ff.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let Yw=class extends ti{};function nM(){const i=new At;return i.include($r),i.fragment.uniforms.add(new ke("tex",e=>e.texture)),i.fragment.code.add(_`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),i}const oM=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Yw,build:nM},Symbol.toStringTag,{value:"Module"}));let Kw=class Jw extends $t{initializeProgram(e){return new Mt(e.rctx,Jw.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};Kw.shader=new Lt(oM,()=>ie(()=>import("./HUDCompositing.glsl-07a666cb.js"),["assets/HUDCompositing.glsl-07a666cb.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let ex=class extends ti{};function lM(){const i=new At;return i.include($r),i.fragment.uniforms.add(new ke("colorTexture",e=>e.colorTexture),new ke("alphaTexture",e=>e.alphaTexture),new ke("frontFaceTexture",e=>e.frontFaceTexture)),i.fragment.code.add(_`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),i}const cM=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:ex,build:lM},Symbol.toStringTag,{value:"Module"}));let tx=class ix extends $t{initializeProgram(e){return new Mt(e.rctx,ix.shader.get().build(),It)}initializePipeline(){return Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt})}};tx.shader=new Lt(cM,()=>ie(()=>import("./OITCompositing.glsl-0f522c9f.js"),["assets/OITCompositing.glsl-0f522c9f.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let hM=class{constructor(e,t){this._rctx=e,this._techniqueRepository=t,this._configuration=new wu,this._passParameters=new mg,this._oitParameters=new ex,this._hudParameters=new Yw}compositeOIT(e,t,r,s){this._oitParameters.colorTexture=t,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=s;const a=this._techniqueRepository.acquire(tx);this._rctx.bindTechnique(a,this._oitParameters,e),this._rctx.screen.draw(),a.release()}compositeHUD(e,t){this._hudParameters.texture=t;const r=this._techniqueRepository.acquire(Kw);this._rctx.bindTechnique(r,this._hudParameters,e),this._rctx.screen.draw(),r.release()}composite(e,t,r=Li.None,s=1){this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=s!==1,this._passParameters.texture=t,this._passParameters.opacity=s;const a=this._techniqueRepository.acquire(_g,this._configuration);this._rctx.bindTechnique(a,this._passParameters,e),this._rctx.screen.draw(),a.release()}};const dM=1e4,s_=100,uM=500,pM=500,mM=.1;function _M(i,e,t){return eS(e,i)*(t[1]-t[0])+t[0]}function gM(i,e,t){let r=0;if(!e.some(a=>(r+=a.numGeometries,r>=dM)))return CM.compute(i,e);const s=yh();return t.forAll(a=>Ml(s,fM(i,a))),s}function fM(i,e){if(!e.visible)return;const t=yh(),r=e.getSpatialQueryAccelerator();return r?yM(t,i,r):vM(t,i,e.objects),t}function yM(i,e,t){const r=e.eye,s=e.viewForward,a=e.frustum,n=l=>l.visible,o=t.objectCount;if(o<uM)hh(Ur,e.near,Math.min(i.near,e.far)),t.forEachInDepthRange(r,s,so.DepthOrder.FRONT_TO_BACK,Ur,(l,c)=>{a_(i,e,l),Ur.far=i.near,c.setRange(Ur)},a,n),hh(Ur,Math.max(i.far,e.near),e.far),t.forEachInDepthRange(r,s,so.DepthOrder.BACK_TO_FRONT,Ur,(l,c)=>{a_(i,e,l),Ur.near=i.far,c.setRange(Ur)},a,n);else{const l=Math.max(Math.min(o,pM),Math.ceil(o*mM)),c=t.findClosest(s,so.DepthOrder.FRONT_TO_BACK,a,n,l),d=t.findClosest(s,so.DepthOrder.BACK_TO_FRONT,a,n,l);c&&d&&(D1(i,e,c.boundingVolumeWorldSpace.bounds),D1(i,e,d.boundingVolumeWorldSpace.bounds))}}function vM(i,e,t){Go.clear(),t.forAll(r=>{r.visible&&r.geometries.length!==0&&Go.add(r)}),Go.empty||(Go.sort(e),hh(Ur,e.near,Math.min(i.near,e.far)),Go.forEachInDepthRange(Ur,so.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<i.near&&a_(i,e,r)}),hh(Ur,Math.max(i.far,e.near),e.far),Go.forEachInDepthRange(Ur,so.DepthOrder.BACK_TO_FRONT,(r,s,a)=>{i.far=Math.max(i.far,a)}))}function a_(i,e,t){if(!t.visible||!Fu(e.frustum,t.boundingVolumeWorldSpace.bounds))return;const r=t.transformation,s=TM;t.geometries.forEach(a=>{jr(s,r,a.transformation);const n=mm(s);rx(i,e,a.boundingInfo,s,n)})}function rx(i,e,t,r,s){if(t==null)return;Zt(zi,t.center,r);const{eye:a,viewForward:n}=e,o=n[0]*(zi[0]-a[0])+n[1]*(zi[1]-a[1])+n[2]*(zi[2]-a[2]);if(zi[3]=t.radius*s,!(o-zi[3]>i.near&&o+zi[3]<i.far)&&Fu(e.frustum,zi))if(t.radius>s_&&t.getChildren())for(const l of t.getChildren())rx(i,e,l,r,s);else n_.unionDepthRangeWithAABB(i,e.viewProjectionMatrix,r,t.bbMin,t.bbMax)}function D1(i,e,t){const r=e.eye,s=e.viewForward,a=(t[0]-r[0])*s[0]+(t[1]-r[1])*s[1]+(t[2]-r[2])*s[2];i.near=Math.min(i.near,a-t[3]),i.far=Math.max(i.far,a+t[3])}class bM{constructor(){this._items=new Et({allocator:e=>e||{object:null,distance:0,near:0,far:0},deallocator:e=>(e.object=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().object=e}sort(e){const t=e.eye,r=e.viewForward;this._items.forAll(s=>{const a=s.object.boundingVolumeWorldSpace.bounds,n=(a[0]-t[0])*r[0]+(a[1]-t[1])*r[1]+(a[2]-t[2])*r[2];s.distance=n,s.near=n-a[3],s.far=n+a[3]}),this._items.sort((s,a)=>s.distance-a.distance)}forEachInDepthRange(e,t,r){if(t===so.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const a=this._items.data[s];a.far<e.near||a.near>e.far||r(a.object,a.near,a.far)}else for(let s=this._items.length-1;s>=0;--s){const a=this._items.data[s];a.far<e.near||a.near>e.far||r(a.object,a.near,a.far)}}}let wM=class{constructor(){this._view=nt(),this._viewProj=nt(),this._frustum=su(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,t){this._reset(),Dl(this._view,e.viewMatrix),jr(this._viewProj,e.projectionMatrix,this._view),Sm(this._frustum,e.frustum);const r=this._view,s=r[2],a=r[6],n=r[10],o=r[14];t.forAll(m=>m.forEachGeometry(g=>{if(!g.visible||!g.castShadow)return;const f=g.boundingSphere,y=s*f[0]+a*f[1]+n*f[2]+o,v=y-f[3],T=y+f[3];this._geometries.push(g),this._near.push(-T),this._far.push(-v)}));const l=new dg;if(this._geometries.length===0)return l;for(let m=0;m<this._geometries.length;++m)this._near[m]>l.far&&(l.far=this._near[m]),this._near[m]>2&&this._far[m]<l.near&&(l.near=this._far[m]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let d=0,p=0;for(let m=0;m<this._geometries.length;++m)this._near[m]<l.near&&(this._near[m]>=c.near?l.near=this._near[m]:this._nearCandidates[d++]=m),this._far[m]>l.far&&(this._far[m]<=c.far?l.far=this._far[m]:this._farCandidates[p++]=m);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((m,g)=>this._near[m]<this._near[g]?-1:this._near[m]>this._near[g]?1:0),this._farCandidates.sort((m,g)=>this._far[m]<this._far[g]?1:this._far[m]>this._far[g]?-1:0);for(let m=0;m<this._nearCandidates.length;++m){const g=this._nearCandidates[m];if(this._near[g]<l.near){const f=this._geometries[g],y=f.boundingInfo;this._includeNearBoundingInfoRec(y,f.shaderTransformation,l)}}for(let m=0;m<this._farCandidates.length;++m){const g=this._farCandidates[m];if(this._far[g]>l.far){const f=this._geometries[g],y=f.boundingInfo;this._includeFarBoundingInfoRec(y,f.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,t,r){if(e==null)return;const s=e.center;Zt(zi,s,t);const a=mm(t),n=zi[0],o=zi[1],l=zi[2],c=e.radius*a,d=this._frustum;if(d[0][0]*n+d[0][1]*o+d[0][2]*l+d[0][3]>c||d[1][0]*n+d[1][1]*o+d[1][2]*l+d[1][3]>c||d[2][0]*n+d[2][1]*o+d[2][2]*l+d[2][3]>c||d[3][0]*n+d[3][1]*o+d[3][2]*l+d[3][3]>c)return;const p=this._view[2]*n+this._view[6]*o+this._view[10]*l+this._view[14],m=p+c;if(!(-(p-c)<2||-m>=r.near))if(-m>this._looseRange.near)r.near=-m;else{if(c>s_){const g=e.getChildren();if(g!==void 0){for(const f of g)this._includeNearBoundingInfoRec(f,t,r);return}}n_.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,t,r){if(e==null)return;let s=e.radius;const a=e.center;Zt(zi,a,t);const n=mm(t),o=zi[0],l=zi[1],c=zi[2];s*=n;const d=this._frustum;if(d[0][0]*o+d[0][1]*l+d[0][2]*c+d[0][3]>s||d[1][0]*o+d[1][1]*l+d[1][2]*c+d[1][3]>s||d[2][0]*o+d[2][1]*l+d[2][2]*c+d[2][3]>s||d[3][0]*o+d[3][1]*l+d[3][2]*c+d[3][3]>s)return;const p=this._view[2]*o+this._view[6]*l+this._view[10]*c+this._view[14]-s;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(s>s_){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeFarBoundingInfoRec(g,t,r);return}}n_.unionDepthRangeWithAABB(r,this._viewProj,t,e.bbMin,e.bbMax)}}},xM=class{constructor(){this._modelViewProj=nt(),this._clipPosition=[gi(),gi(),gi(),gi(),gi(),gi(),gi(),gi()]}unionDepthRangeWithAABB(e,t,r,s,a){const n=this._modelViewProj;jr(n,t,r);let o=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],d=l===0||l===3||l===4||l===7?s[0]:a[0],p=l===0||l===1||l===4||l===5?s[1]:a[1],m=l<4?s[2]:a[2];c[0]=n[0]*d+n[4]*p+n[8]*m+n[12],c[1]=n[1]*d+n[5]*p+n[9]*m+n[13],c[2]=n[2]*d+n[6]*p+n[10]*m+n[14],c[3]=n[3]*d+n[7]*p+n[11]*m+n[15]}for(let l=0;l<12;++l){const c=this._clipPosition[em[l][0]],d=this._clipPosition[em[l][1]],p=this._clipPosition[em[l][2]],m=this._clipTriangle(c,d,p);let g=!0;for(let f=0;f<m.length;++f)if(m[f][3]>=2){g=!1;break}if(!g){o=!0;for(let f=0;f<m.length;++f){const y=m[f][3];Number.isFinite(y)&&(e.near=Math.min(y,e.near),e.far=Math.max(y,e.far))}}}return o}_inside(e,t){return t===0?e[0]>=-e[3]:t===1?e[1]>=-e[3]:t===2?e[0]<=e[3]:t===3?e[1]<=e[3]:void Gs(!1)}_intersect(e,t,r){let s=0;return r===0?s=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):r===1?s=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):r===2?s=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):r===3&&(s=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),k2(gi(),e,t,s)}_clipTriangle(e,t,r){let s=[e,t,r];for(let a=0;a<4;++a){const n=s;s=[];for(let o=0;o<n.length;++o){const l=n[o],c=n[(o+1)%n.length];this._inside(c,a)?(this._inside(l,a)||s.push(this._intersect(l,c,a)),s.push(c)):this._inside(l,a)&&s.push(this._intersect(l,c,a))}}return s}};const em=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],zi=ta(),TM=nt(),Ur=yh(),Go=new bM,CM=new wM,n_=new xM;let PM=class{},SM=class extends ti{constructor(){super(...arguments),this.textures=new PM}};function RM(){const i=new At;return i.attributes.add(se.POSITION,"vec2"),i.vertex.uniforms.add(new Ma("drawPosition",(e,t)=>OM(e,t))),i.varyings.add("vUV","vec2"),i.vertex.code.add(_`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),i.fragment.uniforms.add(new ke("textureInput",e=>e.textures.input)),i.fragment.uniforms.add(new ke("textureMask",e=>e.textures.mask)),i.fragment.uniforms.add(new ke("textureOverlay",e=>e.textures.overlay)),i.fragment.uniforms.add(new eh("maskEnabled",e=>e.magnifier.maskEnabled)),i.fragment.uniforms.add(new eh("overlayEnabled",e=>e.magnifier.overlayEnabled)),i.fragment.code.add(_`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),i}function OM(i,e){const t=e.camera.pixelRatio,r=i.magnifier.offset.x*t,s=i.magnifier.offset.y*t;zs(i.magnifier.position,L1);const a=e.camera.screenToRender(L1,EM),n=Math.ceil(t*i.magnifier.size),o=e.camera.fullWidth,l=e.camera.fullHeight;return Va(AM,(a[0]+r)/o*2-1,(a[1]-s)/l*2-1,n/o*2,n/l*2)}const L1=Dt(),EM=qy(),AM=gi();let tl=class extends ue{constructor(){super(...arguments),this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new SM,this.events=new Xr,this.attributeLocations=new Map([[se.POSITION,0]]),this._tmpScreenPoint=Dt(),this._tmpRenderPoint=qy()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this.removeAllHandles(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this.addHandles(D(()=>{var r;return(r=this._magnifier)==null?void 0:r.version},t)),t()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const r=this._validMagnifier;if(r==null)return;const s=t.camera.pixelRatio,a=Math.ceil(s*r.size);if(this._updateResources(e,a),this._resources==null)return;const n=this._passParameters.textures,o=Math.ceil(1/this._factor*a);n.input.resize(o,o),zs(r.position,this._tmpScreenPoint);const l=t.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=t.camera.fullWidth,d=t.camera.fullHeight,p=.5*o,m=.5*o;l[0]=K(l[0],p,c-p-1),l[1]=K(l[1],m,d-m-1);const g=Math.floor(l[0]-p),f=Math.floor(l[1]-m),y=this._resources.program;y.bindTexture("textureInput",n.input),e.gl.copyTexImage2D(n.input.descriptor.target,0,n.input.descriptor.pixelFormat,g,f,o,o,0),this._passParameters.magnifier=r,e.useProgram(y),y.bindPass(this._passParameters,t),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(fi.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const t=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:t,overlayUrl:r,task:xu(async s=>{const a=t==null||r==null?oS(s):null,n=t!=null?th(t,{signal:s}):a.then(l=>l.mask),o=r!=null?th(r,{signal:s}):a.then(l=>l.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==t){const s=this._createTextureResources(e,t);if(s==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=s}return}const r=this._createTextureResources(e,t);r!=null&&(this._resources={program:this._createProgram(e),vao:na(e,f3,this.attributeLocations,0,1),pipelineState:Je({blending:sa(G.ONE,G.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:tt})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(this._imageSources==null)return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const r=new Yr;r.internalFormat=$i.RGBA,r.wrapMode=ra.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!My(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const s=new Hi(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=$i.ALPHA,r.preMultiplyAlpha=!1;const a=new Hi(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=$i.RGBA,r.flipped=!1,{input:new Hi(e,r),mask:a,overlay:s,size:t}}_createProgram(e){return new Mt(e,RM(),this.attributeLocations)}};h([u()],tl.prototype,"_imageSources",void 0),h([u()],tl.prototype,"_imageLoadTask",void 0),h([u({readOnly:!0})],tl.prototype,"updating",null),tl=h([N("esri/views/3d/webgl-engine/lib/MagnifierHelper")],tl);let MM=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Qd(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,t,r,s,a,n=null,o=null,l=null){if(!(e&&t&&r&&s)||(this._layerUidToId.set(s,r),this._layerUidToPopupEnabled.set(s,a),!a))return;let c=this._layerUidToGraphicsUidToObjectId.get(s);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(s,c)),c.set(t,{objectId:e,attributeNodeId:n,attributeIndex:o,subLayerId:l})}getObjectAndLayerIdColor(e){const t=this.getObjectAndLayerIdColorArray(e);return Zr(t.get(0,1),t.get(0,2),t.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const t=this._layerUidToPopupEnabled.get(e.layerUid);if(t===void 0)return ce.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(t===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let s=r.get(e.graphicUid);if(!s){for(;!s;){const n=Math.floor(16777214*Math.random())+1;this._colorToUID.has(n)||(s=n)}if(s>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,s),this._colorToUID.set(s,e)}const a=new ArrayBuffer(4);return new DataView(a).setUint32(0,s,!1),new Qd(a)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[t,r]of this._colorToUID.entries()){const s=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let a=null;s?(a=s.get(r.graphicUid),a||ce.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):ce.getLogger(this).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const n=this._layerUidToId.get(r.layerUid);n||ce.getLogger(this).warn("no layerId found for uid "+r.layerUid),a&&n&&e.set(t,a.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:a.objectId,lid:n,attrId:a.attributeNodeId,attrIdx:a.attributeIndex,subLayerId:a.subLayerId}:{type:"object-and-layer-id",oid:a.objectId,lid:n})}return e}};var dh;(function(i){i[i.FrontToBack=0]="FrontToBack",i[i.BackToFront=1]="BackToFront"})(dh||(dh={}));let Ya=class{constructor(e,t,r=dh.FrontToBack){this._rctx=e,this._techniqueRepository=t,this._sorting=r,this._draws=new Et({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,r,s){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=r,a.material=e,a.depthSquaredHint=s,a.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0}prepare(e,t){return this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,t,r.geometry.parameters))}dispatch(e,t,r){const s=this._rctx;this._previouslyBoundDraw.clear();let a=null;const n=this._draws.length;for(let o=0;o<n;o++){const l=r[o];l===a&&l.configuration.transparencyPassType===Jt.NONE||(s.bindTechnique(l,e,t),a=l);const c=this._draws.data[o],d=c.geometry;s.bindVAO(d.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,t,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,m=p.length;if(c.indexType!==0){const g=Ud.get(c.indexType);for(let f=0;f<m;f+=2){const y=p[f],v=p[f+1];s.drawElements(d.primitiveType,v,c.indexType,y*g)}}else for(let g=0;g<m;g+=2){const f=p[g],y=p[g+1];s.drawArrays(d.primitiveType,f,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===dh.FrontToBack?1:-1;this._draws.sort((t,r)=>{const s=e*(t.depthSquaredHint-r.depthSquaredHint);return s!==0?s:t.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const Ud=new Map;Ud.set(Ec.UNSIGNED_BYTE,1),Ud.set(Ec.UNSIGNED_SHORT,2),Ud.set(Ec.UNSIGNED_INT,4);let o_=class extends e3{constructor(){super({}),this._passes=null,this.produces=new Map([[$.OPAQUE_MATERIAL,e=>this._produces(e)],[$.TRANSPARENT_MATERIAL,e=>!!(this._passes&&this._passes.materialTransparent.count>0)&&this._produces(e)],[$.INTEGRATED_MESH,e=>this._produces(e)]]),this._materialPassParameters=new y3,this._shadowPassParameters=new v3,this._highlightPassParameters=new b3,this._systems=new Set}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx,r=e.techniqueRepository;this._passes={materialOpaque:new Ya(t,r),materialTransparent:new Ya(t,r,dh.BackToFront),materialIntegratedMesh:new Ya(t,r),shadowMap:new Ya(t,r),highlight:new Ya(t,r),highlightIntegratedMesh:new Ya(t,r),highlightShadowMap:new Ya(t,r),defaultShadowMap:new Ya(t,r)}}get rctx(){return this._context.renderContext.rctx}uninitializeRenderContext(){}dispose(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}_produces(e){return this._systems.size!==0&&this._passes!==null&&(e===M.Highlight?this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0:e!==M.ShadowHighlight||this._passes.highlight.count>0)}prepareRender(e){if(this._systems.size!==0&&this._passes!==null){for(const t of Object.values(this._passes))t.prepareSubmit();this._systems.forEach(t=>t.submit(this._passes,e.bindParameters));for(const t of Object.values(this._passes))t.finishSubmit();this._context.techniqueRepository.frameUpdate()}}prepareTechniques(e){if(this._systems.size===0)return null;const t=e.output===M.Shadow||e.output===M.ShadowHighlight||e.output===M.ShadowExcludeHighlight?this._shadowPassParameters:e.output===M.Highlight?this._highlightPassParameters:this._materialPassParameters,r=e.bindParameters;return this._updateParameters(r.camera,t,r.slot===$.TRANSPARENT_MATERIAL),this._materialPassParameters.output=e.output,this._invoke(e,(s,a)=>s.prepare(a,e.bindParameters))}renderNode(e,t){this._invoke(e,(r,s)=>r.dispatch(s,e.bindParameters,t))}_invoke(e,t){if(this._passes===null)return null;switch(e.bindParameters.slot){case $.OPAQUE_MATERIAL:switch(e.output){case M.Color:case M.Depth:case M.Normal:case M.ObjectAndLayerIdColor:return t(this._passes.materialOpaque,this._materialPassParameters);case M.Highlight:return t(this._passes.highlight,this._highlightPassParameters);case M.Shadow:return t(this._passes.shadowMap,this._shadowPassParameters);case M.ShadowHighlight:return t(this._passes.highlightShadowMap,this._shadowPassParameters);case M.ShadowExcludeHighlight:return t(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case $.TRANSPARENT_MATERIAL:switch(e.output){case M.Color:case M.Alpha:case M.Depth:case M.Normal:case M.ObjectAndLayerIdColor:return t(this._passes.materialTransparent,this._materialPassParameters)}break;case $.INTEGRATED_MESH:switch(e.output){case M.Color:case M.Depth:case M.Normal:case M.ObjectAndLayerIdColor:return t(this._passes.materialIntegratedMesh,this._materialPassParameters);case M.Highlight:return t(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}queryDepthRange(e){const t=new dg;return this._systems.forEach(r=>Ml(t,r.queryShadowCasterDepthRange(e))),t}_updateParameters(e,t,r){const s=e.viewInverseTransposeMatrix;Xt(tm,s[3],s[7],s[11]),im.set(tm),ae(t.transformWorldFromViewTH,im.high),ae(t.transformWorldFromViewTL,im.low),ae(t.slicePlaneLocalOrigin,tm),c_(t.transformViewFromCameraRelativeRS,e.viewMatrix),Dl(t.transformProjFromView,e.projectionMatrix),t.identifier===Zo.Material&&(this._materialPassParameters.transparent=r,Ll($1,t.transformViewFromCameraRelativeRS),_h(t.transformNormalViewFromGlobal,$1))}};o_=h([N("esri.views.3d.webgl-engine.core.renderPasses.RenderPassManager")],o_);const tm=b(),$1=Ua(),im=new ku;let DM=class{constructor(e=null,t=null,r=null){this.composite=e,this.normal=t,this.highlight=r}},zd=class extends ue{constructor(e){super({}),this._context=e,this._renderPlugins=new Et,this._slots=new Array;for(let t=0;t<$.MAX_SLOTS;++t)this._slots[t]=[]}normalizeCtorArgs(){return{}}add(e,t){const r=()=>{if(t!=null&&t.aborted)throw e.uninitializeRenderContext(),ks();this._renderPlugins.push(e),e.produces.forEach((a,n)=>{this._slots[n].push(e)}),this._context.requestRender(),this.notifyChange("updating")},s=e.initializeRenderContext(this._context,t);if(b_(s))return s.then(r);r()}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("updating")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let t=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(t=r.updateAnimation(e)||t)}),t}renderFeatureChanged(){this._renderPlugins.forAll(e=>{e.renderFeatureChanged&&e.renderFeatureChanged()})}prepare(e){this._context.renderContext.bindParameters.slot=e,this._slots[e].forEach(t=>{const r=t.produces.get(e);r&&r(M.Color)&&(I1(t)&&t.prepareTechnique(this._context.renderContext),N1(t)&&t.prepareTechniques(this._context.renderContext))})}_getRenderables(e){this._context.renderContext.bindParameters.slot=e;const t=new Map;return this._slots[e].forEach(r=>{const s=r.produces.get(e);if(s&&s(M.Color)&&(!r.isDecoration||this._context.renderContext.bindParameters.decorations!==js.OFF))if(I1(r)){const a=r.prepareTechnique(this._context.renderContext);a!=null&&t.set(r,a)}else if(N1(r)){const a=r.prepareTechniques(this._context.renderContext);a!=null&&t.set(r,a)}else t.set(r,null)}),t}render(e,t=null,r=null){return this._getRenderables(e).forEach((s,a)=>r=a.renderNode(this._context.renderContext,s,t,r)),r}renderComposition(e,t){const r=this._getRenderables(e);let s=null;return r.forEach((a,n)=>{const o=n.renderNode(this._context.renderContext,a,t,null);s==null||s.release(),s=o,t.composite=s}),s}queryDepthRange(e){const t=new dg;return this._renderPlugins.forAll(r=>{var a;const s=(a=r.queryDepthRange)==null?void 0:a.call(r,e);Ml(t,s)}),t}get updating(){return this._renderPlugins.some(e=>e.running)}produces(e,t=M.Color){return this._slots[e].some(r=>{const s=r.produces.get(e);return!!s&&s(t)})}consumes(e){return this._renderPlugins.some(t=>t.consumes().required.includes(e))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,t)=>e|t.renderOccludedFlags,er.None)}get usedMemory(){return this._renderPlugins.reduce((e,t)=>e+(t.usedMemory??0),0)}};function I1(i){return"prepareTechnique"in i}function N1(i){return"prepareTechniques"in i}h([u({readOnly:!0})],zd.prototype,"updating",null),zd=h([N("esri.views.3d.webgl-engine.lib.RenderPluginManager")],zd);let il=class extends gh{constructor(e){super(e),this._context=null,this.opacity=1,this.alphaMode=Li.None,this._blitConfiguration=new wu,this._blitParameters=new mg,this.produces=new Map([[$.BLIT,()=>this._context!=null]])}consumes(){return gv}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){this._context=null}destroy(){}renderNode(e,t,r,s){var o;const a=(o=r==null?void 0:r.composite)==null?void 0:o.colorTexture;if(!this._context||!a)return s;const n=this._context.techniqueRepository.acquire(_g,this._blitConfiguration);return n!=null&&n.compiled?(e.rctx.bindFramebuffer(s==null?void 0:s.fbo),this._blitParameters.texture=a,this._blitParameters.opacity=this.opacity,e.rctx.bindTechnique(n,this._blitParameters,e.bindParameters),e.rctx.screen.draw(),n.release(),s):(this._context.requestRender(),s)}};h([u()],il.prototype,"_context",void 0),h([u()],il.prototype,"opacity",void 0),h([u()],il.prototype,"alphaMode",void 0),il=h([N("esri.views.3d.webgl-engine.effects.blit.Blit")],il);let sx=class extends ti{};function LM(){const i=new At,{outputs:e,fragment:t}=i;return i.include($r),t.uniforms.add(new fo("textureInput",r=>r.input)),t.constants.add("outlineSize","int",Math.ceil(gg/2)),e.add("fragGrid","vec2"),t.code.add(_`
    void main() {
      float red = 0.0;
      float green = 1.0;
      int cellSize = ${_.int(Is)};
      vec2 texelSize = 1.0 / vec2(textureSize(textureInput, 0));
      vec2 offset = floor(gl_FragCoord.xy) * vec2(float(cellSize));

      for(int x = -outlineSize; x < cellSize + outlineSize; x += 2) {
        for(int y = -outlineSize; y < cellSize + outlineSize; y += 2) {
          vec2 coord = (offset + vec2(float(x), float(y))) * texelSize;
          vec4 value = texture(textureInput, coord);
          float mx = floor(max(value.g, value.b));

          red = max(red, ceil(value.r));
          green = min(green, mx);
          if(red == 1.0 && green == 0.0) {
            fragGrid = vec2(red, green);
            return;
          }
        }
      }
      fragGrid = vec2(red, green);
    }`),i}const Is=32,gg=9,ax=.4,$M=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:sx,blurSize:ax,build:LM,gridCellPixelSize:Is,outlineSize:gg},Symbol.toStringTag,{value:"Module"}));function IM(){const i=new At,{vertex:e,fragment:t}=i,r=e.code,s=t.code;return i.attributes.add(se.POSITION,"vec2"),i.varyings.add("uv","vec2"),i.attributes.add(se.UV0,"vec2"),e.uniforms.add(new ke("coverageTex",a=>a.coverageTexture),new Si("coverageRounding",a=>a.coverageRounding)),r.add(_`void main() {
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),t.uniforms.add(new ke("tex",a=>a.blurTexture),new ke("highlightTexture",a=>a.highlightTexture),new Ma("uColor",a=>a.color),new Ma("haloColor",a=>a.haloColor),new Ma("opacities",a=>Va(NM,a.haloOpacity,a.haloOpacityOccluded,a.fillOpacity,a.fillOpacityOccluded))),t.constants.add("outlineSize","float",gg),t.constants.add("blurSize","float",ax),s.add(_`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(highlightTexture, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - (outlineSize - blurSize) / outlineSize;
float outlineFactor = smoothstep(0.0, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),i}const NM=gi(),FM=Object.freeze(Object.defineProperty({__proto__:null,build:IM},Symbol.toStringTag,{value:"Module"}));let nx=class ox extends $t{initializeProgram(e){return new Mt(e.rctx,ox.shader.get().build(),It)}initializePipeline(){return Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt})}};nx.shader=new Lt(FM,()=>ie(()=>import("./HighlightApply.glsl-954d2e42.js"),["assets/HighlightApply.glsl-954d2e42.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let lx=class extends ti{constructor(){super(...arguments),this.blurSize=yi()}};function VM(){const i=new At,{attributes:e,varyings:t,vertex:r,fragment:s}=i;return e.add(se.POSITION,"vec2"),e.add(se.UV0,"vec2"),t.add("blurCoordinate","vec3"),r.uniforms.add(new ke("coverageTex",a=>a.coverageTexture),new Si("coverageRounding",a=>a.coverageRounding)),r.code.add(_`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0 * coverageRounding);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), cov.g);
}`),s.uniforms.add(new wP("blurSize",a=>a.blurSize),new fo("tex",a=>a.blurInputTexture)),s.code.add(_`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),i}const UM=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:lx,build:VM},Symbol.toStringTag,{value:"Module"}));let cx=class hx extends $t{initializeProgram(e){return new Mt(e.rctx,hx.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:tt})}};cx.shader=new Lt(UM,()=>ie(()=>import("./HighlightBlur.glsl-5968a4e7.js"),["assets/HighlightBlur.glsl-5968a4e7.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let dx=class ux extends $t{initializeProgram(e){return new Mt(e.rctx,ux.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:tt})}};dx.shader=new Lt($M,()=>ie(()=>import("./HighlightDownsample.glsl-bf0fedd4.js"),["assets/HighlightDownsample.glsl-bf0fedd4.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let zM=class extends ti{constructor(){super(...arguments),this.color=Zr(1,0,1,1),this.haloColor=Zr(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.coverageRounding=Cu(1,1)}},Cc=class extends gh{constructor(e){super(e),this._context=null,this._passParameters=new zM,this._downsampleDrawParameters=new sx,this._blurDrawParameters=new lx,this._blurColorFormat=li("mac")?Vt.RGBA:Vt.RGBA4,this._grid={coverage:null,vao:null,verticalCellCount:0,horizontalCellCount:0,viewportWidth:0,viewportHeight:0},this.produces=new Map([[$.HIGHLIGHT,()=>!0]])}consumes(){return fv}initializeRenderContext(e){this._context=e,this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(cx)),this._downsampleTechnique==null&&(this._downsampleTechnique=this._context.techniqueRepository.acquire(dx)),this._applyTechnique==null&&(this._applyTechnique=this._context.techniqueRepository.acquire(nx)),this.addHandles([D(()=>this.view.highlightOptions.color,t=>{this._passParameters.color=Bc(t??Gb),this.view.highlightOptions.haloColor||(this._passParameters.haloColor=this._passParameters.color),this._context.requestRender()},yt),D(()=>this.view.highlightOptions.haloColor,t=>{this._passParameters.haloColor=t!=null?Bc(t):this._passParameters.color,this._context.requestRender()},yt),D(()=>this.view.highlightOptions.haloOpacity,t=>{this._passParameters.haloOpacity=t??jb,this._passParameters.haloOpacityOccluded=.25*this._passParameters.haloOpacity,this._context.requestRender()},yt),D(()=>this.view.highlightOptions.fillOpacity,t=>{this._passParameters.fillOpacity=t??Wb,this._passParameters.fillOpacityOccluded=.25*this._passParameters.fillOpacity,this._context.requestRender()},yt)])}uninitializeRenderContext(){this._context=null}dispose(){this._blurTechnique=et(this._blurTechnique),this._downsampleTechnique=et(this._downsampleTechnique),this._applyTechnique=et(this._applyTechnique),this._grid.coverage=et(this._grid.coverage),this._grid.vao=De(this._grid.vao)}renderNode(e,t,r,s){var C,P;const a=(C=r==null?void 0:r.highlight)==null?void 0:C.colorTexture;if(!this._context||!a)return;if(!(this._blurTechnique.compiled&&this._downsampleTechnique.compiled&&this._applyTechnique.compiled))return void this._context.requestRender();const n=e.bindParameters.camera,o=n.fullWidth,l=n.fullHeight,c=n.pixelRatio,d=Math.ceil(o/c),p=Math.ceil(l/c),m=this._context.fbos,g=m.rctx;this._gridUpdateResources(a),this._gridComputeCoverage(a,e.bindParameters),this._passParameters.highlightTexture=a,this._passParameters.coverageTexture=(P=this._grid.coverage)==null?void 0:P.colorTexture;const{width:f,height:y}=a.descriptor;Gr(this._passParameters.coverageRounding,f/(Math.ceil(f/Is)*Is),y/(Math.ceil(y/Is)*Is));const v=g.bindTechnique(this._blurTechnique,this._passParameters,e.bindParameters),T=this._grid.vao;g.bindVAO(T);const w=m.acquire(this._blurColorFormat,d,p);g.bindFramebuffer(w.fbo),g.setViewport(0,0,d,p),g.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=a,Gr(this._blurDrawParameters.blurSize,1/d,0),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),g.drawArrays(this._blurTechnique.primitiveType,0,La(T,"geometry"));const x=m.acquire(this._blurColorFormat,d,p);g.bindFramebuffer(x.fbo),g.clear(ii.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=w.colorTexture,Gr(this._blurDrawParameters.blurSize,0,1/p),v.bindDraw(this._blurDrawParameters,e.bindParameters,this._passParameters),g.drawArrays(this._blurTechnique.primitiveType,0,La(T,"geometry")),g.bindFramebuffer(s==null?void 0:s.fbo),g.setViewport4fv(n.fullViewport),this._passParameters.blurTexture=x.colorTexture,g.bindTechnique(this._applyTechnique,this._passParameters,e.bindParameters),g.drawArrays(this._applyTechnique.primitiveType,0,La(T,"geometry")),x.release(),w.release()}_gridUpdateResources(e){var m;if(!this._context)return;const t=this._context.fbos.rctx,r=this._grid,s=Math.ceil(e.descriptor.height/Is),a=Math.ceil(e.descriptor.width/Is);if(r.vao&&r.verticalCellCount===s&&r.horizontalCellCount===a)return;r.verticalCellCount=s,r.horizontalCellCount=a;const n=s+1,o=a+1,l=1/s,c=1/a,d=new Float32Array(6*4*n*o);let p=0;for(let g=0;g<n;g++)for(let f=0;f<o;f++)d[p++]=(f-.5)*c*2-1,d[p++]=(g-.5)*l*2-1,d[p++]=f*c,d[p++]=g*l,d[p++]=(f+.5)*c*2-1,d[p++]=(g-.5)*l*2-1,d[p++]=f*c,d[p++]=g*l,d[p++]=(f-.5)*c*2-1,d[p++]=(g+.5)*l*2-1,d[p++]=f*c,d[p++]=g*l,d[p++]=(f-.5)*c*2-1,d[p++]=(g+.5)*l*2-1,d[p++]=f*c,d[p++]=g*l,d[p++]=(f+.5)*c*2-1,d[p++]=(g-.5)*l*2-1,d[p++]=f*c,d[p++]=g*l,d[p++]=(f+.5)*c*2-1,d[p++]=(g+.5)*l*2-1,d[p++]=f*c,d[p++]=g*l;(m=r.vao)==null||m.dispose(),r.vao=new To(t,It,{geometry:$u},{geometry:Lr.createVertex(t,vs.STATIC_DRAW,d)})}_gridComputeCoverage(e,t){var l;if(!this._context)return;const r=this._context.fbos.rctx,s=this._grid,a=e.descriptor,n=Math.ceil(a.width/Is),o=Math.ceil(a.height/Is);(l=s.coverage)==null||l.release(),s.coverage=this._context.fbos.acquire(Vt.RG,n,o),this._downsampleDrawParameters.input=e,r.bindFramebuffer(s.coverage.fbo),r.bindTechnique(this._downsampleTechnique,this._passParameters,t).bindDraw(this._downsampleDrawParameters,t,this._passParameters),r.setViewport(0,0,n,o),r.screen.draw()}get test(){return{coverage:this._grid.coverage}}};h([u()],Cc.prototype,"_context",void 0),h([u()],Cc.prototype,"view",void 0),Cc=h([N("esri.views.3d.webgl-engine.effects.highlight.Highlight")],Cc);let fg=class extends Ts{constructor(){super(...arguments),this.receiveShadows=!0}};h([I()],fg.prototype,"receiveShadows",void 0);const qM=.99999,BM=.025;function HM(i){const e=new At;e.include(dv,i),e.include(E_),e.include($r);const t=e.fragment;return t.include(xo),t.include(go),t.uniforms.add(new ke("defaultDepthTex",(r,s)=>s.shadowMap.getSnapshot(tu.Default)),new ke("highlightDepthTex",(r,s)=>s.shadowMap.getSnapshot(tu.Highlight)),new ke("depthMap",(r,s)=>{var a;return(a=s.linearDepth)==null?void 0:a.colorTexture}),new ke("highlightTexture",r=>r.highlight),new Ma("uColor",r=>r.shadowColor),new Si("nearFar",(r,s)=>s.camera.nearFar),new Ue("opacity",r=>r.shadowOpacity),new Ue("occludedOpacity",r=>r.occludedShadowOpacity),new Ue("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new Ci("lightingMainDirectionView",(r,s)=>ye(V1,Zt(V1,s.lighting.mainLight.direction,s.camera.viewInverseTransposeMatrix))),new Gi("inverseViewMatrix",(r,s)=>Zd(F1,jc(F1,s.camera.viewMatrix,s.camera.center)))),t.constants.add("unoccludedHighlightFlag","vec4",t3),t.code.add(_`
    vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, ivec2 iuv) {
      float leftPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(-1, 0), 0), nearFar);
      float rightPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(1, 0), 0), nearFar);
      float bottomPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, -1), 0), nearFar);
      float topPixelDepth = linearDepthFromRGBA(texelFetch(depthMap, iuv + ivec2(0, 1), 0), nearFar);

      bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
      bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);

      vec3 fragCoordHorizontal = pickLeft
                                  ? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
                                  : vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
      vec3 fragCoordVertical = pickBottom
                                  ? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
                                  : vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);

      vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
      vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);

      vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
      // Flip normal depending on triangle winding order for consistency
      return pickLeft == pickBottom ? normal : -normal;
    }

    void main(void) {
      vec4 highlightInfo = texture(highlightTexture, uv);
      float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
      if (visiblyHighlighted > ${_.float(qM)}) {
        discard;
      }

      ivec2 iuv = ivec2(uv * vec2(textureSize(depthMap, 0)));
      float depth = rgba2float(texelFetch(depthMap, iuv, 0));
      // 0.0 is the clear value of depthMap, which means nothing has been drawn there and we should discard
      if (depth == 0.0) {
        discard;
      }

      float currentPixelDepth = linearDepthFromFloat(depth, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        discard;
      }

      vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
      vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;

      mat4 shadowMatrix;
      float linearDepth = -currentPixelDepth;
      int i = chooseCascade(linearDepth, shadowMatrix);

      if (i >= numCascades) {
        discard;
      }

      vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
        discard;
      }

      ivec2 texSize = textureSize(highlightDepthTex, 0);
      ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));

      float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
      bool shadowHighlight = depthHighlight < lvpos.z;

      if (!shadowHighlight) {
        discard;
      }

      float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
      bool shadowDefault = depthDefault < lvpos.z;

      vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, iuv);
      bool shaded = dot(normal, lightingMainDirectionView) < ${_.float(BM)};

      float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
      fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
    }
  `),e}const F1=nt(),V1=b(),kM=Object.freeze(Object.defineProperty({__proto__:null,build:HM},Symbol.toStringTag,{value:"Module"}));let GM=class extends R_{constructor(){super(...arguments),this.shadowColor=Zr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},px=class mx extends $t{constructor(e){super(e,new fg,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,mx.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:nr(G.SRC_ALPHA,G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ONE_MINUS_SRC_ALPHA),colorWrite:tt,depthTest:null,depthWrite:null})}get primitiveType(){return fi.TRIANGLE_STRIP}};px.shader=new Lt(kM,()=>ie(()=>import("./ShadowHighlight.glsl-ab780dc5.js"),["assets/ShadowHighlight.glsl-ab780dc5.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/interfaces-8918b36f.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const jM=.001953125,WM=4e4,QM=5e4;let rl=class extends gh{constructor(e){super(e),this._maxOpacity=1,this._passParameters=new GM,this._drawParameters=new i3,this._shadowDifference=.2,this._context=null,this.produces=new Map([[$.SHADOW_HIGHLIGHT,()=>this._isVisible]])}consumes(){return fv}initializeRenderContext(e){this._context=e,this.addHandles([D(()=>this.view.highlightOptions.shadowOpacity,t=>{this._passParameters.shadowOpacity=t??Zb,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},yt),D(()=>this.view.highlightOptions.shadowDifference,t=>{this._shadowDifference=t??Xb,this._updateOccludedShadowOpacity(),this._updateMaxOpacity()},yt),D(()=>this.view.highlightOptions.shadowColor,t=>{this._passParameters.shadowColor=Bc(t??Qb),this._updateMaxOpacity()},yt)])}_updateOccludedShadowOpacity(){this._passParameters.occludedShadowOpacity=this._passParameters.shadowOpacity*(1-this._shadowDifference)}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}uninitializeRenderContext(){this._context=null}enable(){this._context&&this._technique==null&&(this._technique=this._context.techniqueRepository.acquire(px))}renderNode(e,t,r,s){var c,d;const a=(c=r==null?void 0:r.highlight)==null?void 0:c.colorTexture;if(!(this._context&&r&&a&&this._isVisible))return;if(!((d=this._technique)!=null&&d.compiled))return void this._context.requestRender();const n=e.bindParameters;if(!n.shadowMap.enabled||!n.linearDepth)return;const o=e.rctx,l=this._technique;this._passParameters.highlight=a,this._drawParameters.origin=n.camera.center,o.bindFramebuffer(s==null?void 0:s.fbo),o.bindTechnique(l,this._passParameters,n).bindDraw(this._drawParameters,n,this._passParameters),o.screen.draw()}updateParameters(e,t){this._passParameters.opacityElevation=1-Hc(WM,QM,e.relativeElevation);const r=this.viewingMode===Ne.Global?ye(U1,e.center):Xt(U1,0,0,1),s=Ie(r,t);this._passParameters.dayNightTerminator=Hc(0,1,K(30*s,0,1)),this._isVisible&&this.enable()}get _isVisible(){const{opacityElevation:e,dayNightTerminator:t}=this._passParameters;return this._maxOpacity*e*t>=jM}};h([u()],rl.prototype,"_context",void 0),h([u()],rl.prototype,"view",void 0),h([u()],rl.prototype,"viewingMode",void 0),rl=h([N("esri.views.3d.webgl-engine.effects.highlight.ShadowHighlight")],rl);const U1=b(),jo={maxSearchSteps:8,maxDistanceAreaTex:16};function ZM(){const i=new At;return i.include($r),i.fragment.uniforms.add(new ke("edgesTexture",e=>e.inputTexture)),i.fragment.uniforms.add(new ke("areaTexture",e=>e.areaTexture)),i.fragment.uniforms.add(new ke("searchTexture",e=>e.searchTexture)),i.fragment.code.add(_`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset, vec2 resolution) {
        return texture(tex, coord + offset.x * resolution, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${_.int(jo.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${_.int(jo.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${_.int(jo.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end, vec2 resolution ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${_.int(jo.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${_.int(jo.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        vec2 size = vec2(textureSize(edgesTexture, 0));
        vec2 resolution = 1.0 / size;
        vec2 pixelCoord = uv * size;
        vec4 offsets[2];
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        vec4 maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${_.int(jo.maxSearchSteps)} );

        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x, resolution );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y, resolution );
          d.y = coords.x;
          d = d * size.x - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ), resolution).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z, resolution );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w, resolution );
          d.y = coords.y;
          d = d * size.y - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0), resolution).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),i}const XM=Object.freeze(Object.defineProperty({__proto__:null,build:ZM},Symbol.toStringTag,{value:"Module"}));let _x=class gx extends $t{initializeProgram(e){return new Mt(e.rctx,gx.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:tt})}};_x.shader=new Lt(XM,()=>ie(()=>import("./BlendWeights.glsl-467f7802.js"),["assets/BlendWeights.glsl-467f7802.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));function YM(){const i=new At;return i.include($r),i.fragment.uniforms.add(new ke("blendWeightsTexture",e=>e.inputTexture),new ke("colorTexture",e=>e.color)),i.fragment.code.add(_`void main() {
vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
vec4 offsets = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets.zw).g;
a.a = texture(blendWeightsTexture, offsets.xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),i}const KM=Object.freeze(Object.defineProperty({__proto__:null,build:YM},Symbol.toStringTag,{value:"Module"}));let fx=class yx extends $t{initializeProgram(e){return new Mt(e.rctx,yx.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:tt})}};fx.shader=new Lt(KM,()=>ie(()=>import("./Blur.glsl-1b9d980a.js"),["assets/Blur.glsl-1b9d980a.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const z1={threshold:.05,localConstrastAdaption:2};function JM(){const i=new At;return i.include($r),i.fragment.uniforms.add(new ke("colorTexture",e=>e.color)),i.outputs.add("fragEdges","vec2"),i.fragment.code.add(_`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      vec2 resolution = 1.0 / vec2(textureSize(colorTexture, 0));
      vec4 offsets[3];
      offsets[0] = vec4(uv.x - resolution.x, uv.y, uv.x, uv.y + resolution.y);
      offsets[1] = vec4(uv.x + resolution.x, uv.y, uv.x, uv.y - resolution.y);
      offsets[2] = vec4(uv.x - 2.0 * resolution.x, uv.y, uv.x, uv.y + 2.0 * resolution.y);

      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${_.float(z1.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges *= step(maxDelta, float(${_.float(z1.localConstrastAdaption)}) * delta.xy);

      fragEdges = edges;
    }
  `),i}const eD=Object.freeze(Object.defineProperty({__proto__:null,build:JM},Symbol.toStringTag,{value:"Module"}));let vx=class bx extends $t{initializeProgram(e){return new Mt(e.rctx,bx.shader.get().build(),It)}initializePipeline(){return Je({colorWrite:tt})}};vx.shader=new Lt(eD,()=>ie(()=>import("./EdgeDetect.glsl-66dd73a8.js"),["assets/EdgeDetect.glsl-66dd73a8.js","assets/interfaces-8918b36f.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let tD=class extends ti{},Xn=class extends gh{constructor(i){super(i),this._context=null,this._areaTexture=null,this._searchTexture=null,this._isEnabled=!1,this._smaaParameters=new tD,this.produces=new Map([[$.ANTIALIASING,()=>this._isEnabled&&this._context!=null]])}consumes(){return gv}get updating(){return this._abortController!=null}initializeRenderContext(i){this._context=i,this.addHandles([D(()=>this.view.qualitySettings.antialiasingEnabled,e=>{var t;return e||(t=this._context)!=null&&t.isFeatureEnabled(Ws.Antialiasing)?this.enable():this.disable()},yt)])}renderFeatureChanged(){var i;this.view.qualitySettings.antialiasingEnabled||(i=this._context)!=null&&i.isFeatureEnabled(Ws.Antialiasing)?this.enable():this.disable()}uninitializeRenderContext(){this.disable(),this._context=null}enable(){if(this._isEnabled||!this._context||this._abortController)return;if(this._edgeTechnique==null&&(this._edgeTechnique=this._context.techniqueRepository.acquire(vx)),this._blendTechnique==null&&(this._blendTechnique=this._context.techniqueRepository.acquire(_x)),this._blurTechnique==null&&(this._blurTechnique=this._context.techniqueRepository.acquire(fx)),this._areaTexture&&this._searchTexture)return void(this._isEnabled=!0);this._abortController=new AbortController;const i=this._abortController.signal;ie(()=>import("./SMAAData-660b7d34.js"),[]).then(e=>this._loadTextures(this._context,e,i)).then(()=>{var e;(e=this._context)==null||e.requestRender(),this._abortController=null}).catch(e=>{yn(e)||this._disposeTextures()})}_loadTextures(i,e,t){return fr(t),i?Promise.all([th(e.areaTexture).then(r=>q1(i.fbos.rctx,Da.LINEAR,$i.RGB,r)),th(e.searchTexure).then(r=>q1(i.fbos.rctx,Da.NEAREST,$i.LUMINANCE,r))]).then(([r,s])=>{rn(t)?(r.dispose(),s.dispose(),fr(t)):(this._areaTexture=r,this._searchTexture=s,this._isEnabled=!0)}):Promise.reject()}_disposeTextures(){this._areaTexture=De(this._areaTexture),this._searchTexture=De(this._searchTexture)}disable(){this._abortController=wo(this._abortController),this._isEnabled=!1}destroy(){this.disable(),this._disposeTextures()}renderNode(i,e,t,r){var p,m,g,f;const s=(p=t==null?void 0:t.composite)==null?void 0:p.colorTexture;if(!(this._isEnabled&&this._context&&t&&s))return r;if(!((m=this._edgeTechnique)!=null&&m.compiled&&((g=this._blendTechnique)!=null&&g.compiled)&&((f=this._blurTechnique)!=null&&f.compiled)))return this._context.requestRender(),r;const a=s.descriptor.width,n=s.descriptor.height,o=this._context.fbos,l=i.rctx;l.setViewport(0,0,a,n);const c=o.acquire(Vt.RG,a,n);l.bindFramebuffer(c.fbo),l.setClearColor(0,0,0,1),l.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.color=s,l.bindTechnique(this._edgeTechnique,this._smaaParameters),l.screen.draw();const d=o.acquire(Vt.RGBA,a,n);return l.bindFramebuffer(d.fbo),l.setClearColor(0,0,1,1),l.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=c.colorTexture,this._smaaParameters.areaTexture=this._areaTexture,this._smaaParameters.searchTexture=this._searchTexture,l.bindTechnique(this._blendTechnique,this._smaaParameters),l.screen.draw(),l.bindFramebuffer(r==null?void 0:r.fbo),c.release(),l.setClearColor(0,1,0,1),l.clear(ii.COLOR_BUFFER_BIT),this._smaaParameters.inputTexture=d.colorTexture,l.bindTechnique(this._blurTechnique,this._smaaParameters),l.screen.draw(),d.release(),r}};function q1(i,e,t,r){const s=new Yr;return s.pixelFormat=t,s.wrapMode=ra.CLAMP_TO_EDGE,s.width=r.width,s.height=r.height,s.samplingMode=e,new Hi(i,s,r)}h([u()],Xn.prototype,"view",void 0),h([u()],Xn.prototype,"_context",void 0),h([u()],Xn.prototype,"_abortController",void 0),h([u({readOnly:!0})],Xn.prototype,"updating",null),Xn=h([N("esri.views.3d.webgl-engine.effects.smaa.SMAA")],Xn);let iD=class{constructor(){this._step=k1,this._dilation=1,this._firstIdleTime=Oe(0)}frame(e,t){if(t?this._firstIdleTime===0&&(this._firstIdleTime=Oe(performance.now())):this._firstIdleTime=Oe(0),li("disable-feature:high-quality-idle"))this._dilation=1;else{const s=t?performance.now()-this._firstIdleTime:0;if(s>=B1+sD)return this._step=Oe(1/0),void(this._dilation=1);this._dilation=s>=B1?aD:1}const r=K(e/rD,k1,oD);this._step===1/0?this._step=Oe(r):this._step=Oe(this._step*H1+r*(1-H1))}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=Oe(0)}};const rD=.5,B1=Oe(12e4),sD=Oe(1e4),aD=10,H1=.9,nD=30,k1=Oe(1e3/1),oD=Oe(1e3/nD);let lD=class{constructor(e,t){this._fbos=e,this.compositingHelper=t,this._width=4,this._height=4}dispose(){this._color=et(this._color),this.releaseBuffers()}get framebuffer(){return this.color.detachDepth(),this.color.attachDepth(this.depth),this.color.fbo}get colorTexture(){return this.color.colorTexture}get depthTexture(){return this.depth.attachment}initializeFrame(e,t,r){this._fbos.interactive=!r;const s=this._fbos.rctx;this._width=e.fullWidth,this._height=e.fullHeight,$_(this,s.parameters.maxTextureSize);const a=this._color;return this._color=null,this.releaseBuffers(),this.bindFbo(),s.setClearStencil(0),s.setClearColor(t[0],t[1],t[2],t[3]),s.clearSafe(ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT),a}releaseBuffers(){var e;(e=this._color)==null||e.detachDepth(),this._depth=et(this._depth)}renderHUDVisibility(e,t,r){return(e==null?void 0:e.fbo.width)===this._width&&(e==null?void 0:e.fbo.height)===this._height||(e==null||e.release(),e=this._fbos.acquire(Vt.RGBA4,this._width,this._height)),e.attachDepth(r||this.depth),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(t,cD),e.detachDepth(),e}compositeToHUDVisibility(e,t){var r;this._fbos.rctx.bindFramebuffer((r=e.hudVisibility)==null?void 0:r.fbo),this.compositingHelper.compositeHUD(e,t)}renderOITPass(e,t,r){let s,a;switch(t){case Jt.Color:s=this._fbos.acquire(Vt.RGBA16F,this._width,this._height),a=[0,0,0,0];break;case Jt.Alpha:s=this._fbos.acquire(Vt.R16F,this._width,this._height),a=[1,1,1,1];break;case Jt.FrontFace:s=this._fbos.acquire(Vt.RGBA,this._width,this._height),a=[0,0,0,0]}return r?(s.acquireDepth(pr.DEPTH16_BUFFER),this._fbos.rctx.bindFramebuffer(s.fbo),this.renderToFBO(e,a,!0,!0),s.releaseDepth()):(s.attachDepth(this.depth),this._fbos.rctx.bindFramebuffer(s.fbo),this.renderToFBO(e,a),s.detachDepth()),s}compositeToFramebuffer(e,t,r,s){this.bindFbo(),this.compositingHelper.composite(e,t,r,s)}compositeTransparentOntoOpaque(e,t,r,s,a){a?(this._fbos.rctx.bindFramebuffer(a.fbo),this._fbos.rctx.setClearColor(0,0,0,1e-13),this._fbos.rctx.clearSafe(ii.COLOR_BUFFER_BIT)):this.bindFbo(),this.compositingHelper.compositeOIT(e,t.colorTexture,r.colorTexture,s.colorTexture)}renderDepthDetached(e){this._bindTarget(this.color),e(),this._bindTarget(this.color,this.depth)}renderToCachedFBO(e,t,r,s=Vt.RGBA,a=pr.DEPTH16_BUFFER,n=this._width,o=this._height,l=null){return(e==null?void 0:e.fbo.width)===n&&(e==null?void 0:e.fbo.height)===o||(e=et(e)),e=e??this._fbos.acquire(s,n,o),a!=null&&e.acquireDepth(a),l==null||l.forEach(c=>{e.acquireColor(c.format,c.attachment)}),this._fbos.rctx.bindFramebuffer(e.fbo),this.renderToFBO(t,r,!0,!0),e}renderToFBO(e,t,r=!1,s=!1){const a=this._fbos.rctx;let n=0;if(t){const l=Math.max(1e-13,t[3]);a.setClearColor(t[0],t[1],t[2],l),n|=ii.COLOR_BUFFER_BIT}r&&(n|=ii.DEPTH_BUFFER_BIT),s===!1?s=0:(s===!0&&(s=255),n|=ii.STENCIL_BUFFER_BIT),n&&a.clearSafe(n,s),e(),a.gl.flush()}renderToTargets(e,t,r,s,a=!1,n=!1){this._bindTarget(t,r),this.renderToFBO(e,s,a,n),t.detachDepth()}bindFbo(){this._bindTarget(this.color,this.depth)}_bindTarget(e,t){e.detachDepth(),e.attachDepth(t),this._fbos.rctx.bindFramebuffer(e.fbo)}get width(){return this._width}get height(){return this._height}get color(){return this._color||(this._color=this._fbos.acquire(Vt.RGBA,this._width,this._height)),this._color}get depth(){return this._depth||(this._depth=this._fbos.acquireDepth(pr.DEPTH_STENCIL_TEXTURE,this._width,this._height)),this._depth}};const cD=[0,1,0,1],Gu=255,hD=1/Gu;function dD(i){const e=new At,t=e.fragment;return t.include(xo),t.include(go),e.include(E_),e.include($r),e.include(_v,i),t.uniforms.add(new ke("depthMap",(r,s)=>{var a;return(a=s.linearDepth)==null?void 0:a.colorTexture}),new Gi("inverseViewMatrix",(r,s)=>Zd(G1,jc(G1,s.camera.viewMatrix,s.camera.center))),new Si("nearFar",(r,s)=>s.camera.nearFar)),t.constants.add("sampleValue","float",hD),e.outputs.add("sampleCount","float"),t.code.add(_`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
ivec2 texSize = textureSize(shadowMapTex, 0);
ivec2 uvShadow = ivec2(cascadeCoordinates(i, texSize, lvpos) * vec2(texSize));
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
sampleCount = sampleValue;
}`),e}const G1=nt(),uD=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastMaxSamples:Gu,build:dD},Symbol.toStringTag,{value:"Module"}));let wx=class extends ti{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=By(pD),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const pD=Zr(.01,0,.25,1);function mD(i){const e=new At,t=e.fragment;t.include(xo),t.include(go),e.include(E_),e.include($r);const{visualization:r,bandsEnabled:s}=i;t.constants.add("inverseSampleValue","float",Gu),t.uniforms.add(new ke("shadowCastMap",o=>o.shadowCastMap),new Ue("sampleScale",o=>o.sampleScale),new Ue("opacityFromElevation",o=>o.opacityFromElevation),new Ma("uColor",o=>o.color));const a=r===wf.Gradient,n=r===wf.Threshold;return a&&s?t.uniforms.add(new Ue("bandSize",o=>o.bandSize)):n&&t.uniforms.add(new Ue("threshold",o=>o.threshold)),t.code.add(_`
      void main(void) {
        float record = texture(shadowCastMap, uv).r;
        float pixelSamples = record * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${n?_`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${a&&s?_`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${a?_`* strength`:""});
      }
    `),e}const _D=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:wx,build:mD},Symbol.toStringTag,{value:"Module"}));let xx=class Tx extends $t{constructor(e,t){super(e,t,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,Tx.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:Ev,colorWrite:tt,depthTest:null,depthWrite:null})}get primitiveType(){return fi.TRIANGLE_STRIP}};xx.shader=new Lt(_D,()=>ie(()=>import("./ShadowCastVisualize.glsl-bd79700c.js"),["assets/ShadowCastVisualize.glsl-bd79700c.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/interfaces-8918b36f.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));const gD=4e4,fD=5e4,Cx=1/512;let qd=class extends ue{constructor(e,t,r,s){super({}),this._techniqueRepository=e,this._rctx=t,this._data=r,this._requestRender=s,this._passParameters=new wx(this._data),this._techniqueConfig=new eP,this._enabled=!1,this._vao=na(t)}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=De(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(xx,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const t=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,La(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Cx}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;G2(e,t)||(Ny(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};h([u()],qd.prototype,"opacityFromElevation",null),qd=h([N("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],qd);let Px=class Sx extends $t{constructor(e){super(e,new fg,()=>this.destroy())}initializeProgram(e){return new Mt(e.rctx,Sx.shader.get().build(this.configuration),It)}initializePipeline(){return Je({blending:nr(G.ONE,G.ONE,G.ONE,G.ONE),colorWrite:tt,depthTest:null,depthWrite:null})}get primitiveType(){return fi.TRIANGLE_STRIP}};Px.shader=new Lt(uD,()=>ie(()=>import("./ShadowCastAccumulate.glsl-3c6599da.js"),["assets/ShadowCastAccumulate.glsl-3c6599da.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/interfaces-8918b36f.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let Ki=class extends ue{constructor(i,e,t,r,s,a){super({}),this.fbos=i,this._stage=t,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=a,this._progress=0,this._sampleCount=0,this._passParameters=new R_,this._cachedLightDirections=[],this._depthRange=r_,this._previewing=!1,this._cameraForcedForScreenshot=!1,this._shadowAccumulatorKey="shadowAccumulator",this._rctx=i.rctx,this._bindParameters=new D_(new xv(i,t.viewingMode),null),this._bindParameters.shadowMap.enabled=!0,this._vao=na(this._rctx),this._accumulationRenderer=new qd(e,this._rctx,this,a);const n=this._stage.view.resourceController.scheduler;this.addHandles([n.registerTask(ci.SHADOW_ACCUMULATOR,this),D(()=>t.renderView,o=>{this.removeHandles(j1),o!=null&&this.addHandles(o.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),j1)},yt),D(()=>this._previewing,()=>this._requestRenderIfEnabled(),at)],this._shadowAccumulatorKey)}normalizeCtorArgs(){return{}}dispose(){this._disable(),this.removeHandles(this._shadowAccumulatorKey),this._accumulationRenderer=De(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=De(this._fbo),this._vao=De(this._vao),this._accumulationTechniqueCached=et(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var i;return(i=this._fbo)==null?void 0:i.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const i={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Px(i)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){var i;return((i=this._bindParameters.linearDepth)==null?void 0:i.colorTexture)!==null&&this._depthRange!==r_&&this._opacityFromElevation>Cx}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(i){const e=this._cachedLightDirections;if(y_(e,i,Qc))return;const t=Math.min(Gu,i.length);e.length=t,this._sampleCount=t;for(let r=0;r<t;++r)e[r]=ae(e[r]??b(),i[r]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(i){this._accumulationRenderer.opacityFromElevation=i}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(i){for(this._prepareForShadowMapPass(this._bindParameters);!i.done&&!this._isDoneAccumulating;)this._accumulateShadow(),i.madeProgress();this._requestRender()}renderAccumulation(i,e,t,r){if(this._depthRange=e,this._updateCamera(t),this._bindParameters.contentCamera=r,this._bindParameters.linearDepth=i,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(yD,this._sampleCount-this._progress);for(let a=0;a<s;++a)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(i){this._accumulationRenderer.render(i)}setOptions(i){if(i.enabled!==void 0){const e=this._fbo!=null;i.enabled!==e&&(i.enabled?this._enable():this._disable())}i.previewing!==void 0&&(this._previewing=i.previewing),i.lightDirections!==void 0&&(this._lightDirections=i.lightDirections),this._accumulationRenderer.setOptions(i)}readAccumulatedShadow(i,e){return!this._isActive||!this._fbo||this._progress<1||i<0||i>=this._fbo.width||e<0||e>=this._fbo.height?0:(this._fbo.readPixels(i,e,1,1,$i.RED,bd.UNSIGNED_BYTE,W1),W1[0]/this._progress)}_enable(){this._progress=0;const i=new Yr;i.pixelFormat=$i.RED,i.internalFormat=z3.R8,i.wrapMode=ra.CLAMP_TO_EDGE,this._fbo=new Iu(this._rctx,i)}_disable(){this._fbo=De(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ii.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress++],this._depthRange);const i=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(i,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,La(this._vao,"geometry"))}_updateCamera(i){!i.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(i),this._fbo.resize(i.fullWidth,i.fullHeight),this._opacityFromElevation=1-Hc(gD,fD,i.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const i=this;return{lightDirections:this._lightDirections,get isDone(){return i._isDoneAccumulating},get isActive(){return i._isActive}}}};h([u()],Ki.prototype,"_progress",void 0),h([u()],Ki.prototype,"_sampleCount",void 0),h([u()],Ki.prototype,"_fbo",void 0),h([u()],Ki.prototype,"_depthRange",void 0),h([u()],Ki.prototype,"_previewing",void 0),h([u()],Ki.prototype,"_accumulationRenderer",void 0),h([u()],Ki.prototype,"_isRefining",null),h([u()],Ki.prototype,"_isActive",null),h([u()],Ki.prototype,"canAccumulate",null),h([u()],Ki.prototype,"_isDoneAccumulating",null),h([u()],Ki.prototype,"_opacityFromElevation",null),h([u()],Ki.prototype,"running",null),Ki=h([N("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Ki);const yD=6,j1="renderView",W1=new Uint8Array(1),Q1=Mu();let vD=class{constructor(){this._plane=Mu()}get isEnabled(){return!RT(this.plane,Q1)}get plane(){return this._plane}set plane(e){w_(e||Q1,this._plane)}};function bD(i,e){const t=-i[0],r=-i[1],s=-i[2],a=e[3],n=e[7],o=e[11],l=e[15];e[0]+=a*t,e[1]+=a*r,e[2]+=a*s,e[4]+=n*t,e[5]+=n*r,e[6]+=n*s,e[8]+=o*t,e[9]+=o*r,e[10]+=o*s,e[12]+=l*t,e[13]+=l*r,e[14]+=l*s}function wD(i,e){const t=i[0],r=i[1],s=i[2];e[12]+=t*e[0]+r*e[4]+s*e[8],e[13]+=t*e[1]+r*e[5]+s*e[9],e[14]+=t*e[2]+r*e[6]+s*e[10],e[14]+=t*e[3]+r*e[7]+s*e[11]}let xD=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const t=this._originData.get(e.id)||new TD(e);return t.refCount++,this._originData.has(t.origin.id)||this._originData.set(t.origin.id,t),t}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(t=>{Dl(t.viewMatrix,e),wD(t.origin.vec3,t.viewMatrix)})}},TD=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=nt()}},CD=class extends r3{constructor(e,t){super(),this.distanceFalloffFactor=e,this.transparency=t,this.transformNormalViewFromGlobal=Ua()}},PD=class extends s3{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Ua(),this.slicePlaneLocalOrigin=b(),this.transformNormalGlobalFromModel=Ua()}};function SD(i){const e=_`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;i.code.add(e)}const RD=Cu(.5,-4e-4);function OD(i,e){const t=i.vertex;t.include(SD),t.constants.add("depthBias","vec2",RD),t.uniforms.add(new Si("inverseViewport",(r,s)=>s.inverseViewport)),e.legacy?(t.uniforms.add(new Gi("proj",(r,s)=>s.camera.projectionMatrix)),t.code.add(_`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(t.uniforms.add(new yv("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal),new Gi("transformProjFromView",r=>r.transformProjFromView)),t.code.add(_`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),t.code.add(_`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function ED(i,e){const t=i.fragment;t.constants.add("coverageTestThreshold","float",.01),e.antialiasing?t.code.add(_`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):t.code.add(_`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function AD(i,e){const t=i.vertex;e.silhouette?(t.code.add(_`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?t.code.add(_`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):t.code.add(_`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):t.code.add(_`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function MD(i,e){const t=i.vertex;t.include(xo),t.uniforms.add(new Ue("distanceFalloffFactor",r=>r.distanceFalloffFactor)),t.code.add(_`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),t.uniforms.add(new fo("componentDataTex",r=>r.componentDataTexture)),i.attributes.add(se.COMPONENTINDEX,"float"),t.constants.add("componentColorFieldOffset","float",0),t.constants.add("componentOtherFieldOffset","float",1),t.constants.add("componentVerticalOffsetFieldOffset","float",2),t.constants.add("componentFieldCount","float",3),t.constants.add("lineWidthFractionFactor","float",8),t.constants.add("extensionLengthOffset","float",128),t.constants.add("verticalOffsetScale","float",2*ug),t.code.add(_`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?t.code.add(_`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(t.uniforms.add(new bm("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),t.code.add(_`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(i.attributes.add(se.NORMALA,"vec3"),i.attributes.add(se.NORMALB,"vec3"),t.code.add(_`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(i.attributes.add(se.NORMAL,"vec3"),t.code.add(_`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?t.code.add(_`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(t.include(a3,e),t.uniforms.add(new yv("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new bm("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new _f("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new _f("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Ci("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Ci("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),t.code.add(_`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?_`normalize(transformWorldFromModelTL + rotatedModelPosition);`:_`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),t.uniforms.add(new Gi("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),t.code.add(_`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),t.code.add(_`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function DD(i){return i.mode===ei.SKETCH||i.mode===ei.MIXED}var ei,ro;(function(i){i[i.SOLID=0]="SOLID",i[i.SKETCH=1]="SKETCH",i[i.MIXED=2]="MIXED",i[i.COUNT=3]="COUNT"})(ei||(ei={})),function(i){i[i.REGULAR=0]="REGULAR",i[i.SILHOUETTE=1]="SILHOUETTE"}(ro||(ro={}));function yg(i,e){const t=i.vertex;switch(i.attributes.add(se.SIDENESS,"vec2"),e.mode===ei.MIXED?t.code.add(_`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):t.code.add(_`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case ei.MIXED:t.code.add(_`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case ei.SKETCH:t.code.add(_`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ei.SOLID:t.code.add(_`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ei.COUNT:break;default:fn(e.mode)}}function LD(i,e){const t=i.vertex;switch(i.include(yg,e),e.mode){case ei.SOLID:t.code.add(_`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case ei.SKETCH:t.uniforms.add(new yl("strokesAmplitude",r=>r.strokesTexture.amplitude)),t.code.add(_`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case ei.MIXED:t.uniforms.add(new yl("strokesAmplitude",r=>r.strokesTexture.amplitude)),t.code.add(_`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function $D(i,e){i.include(yg,e);const{vertex:t,fragment:r}=i;switch(DD(e)&&(t.uniforms.add(new fo("strokesTexture",s=>s.strokesTexture.texture)),t.uniforms.add(new yl("strokesLog2Resolution",s=>Math.log2(s.strokesTexture.resolution)),new yl("strokeVariants",s=>s.strokesTexture.variants)),i.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new fo("strokesTexture",s=>s.strokesTexture.texture),new yl("strokesNormalizationScale",s=>s.strokesTexture.normalizationScale)),t.code.add(_`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),i.fragment.include(xo),r.code.add(_`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case ei.SOLID:t.code.add(_`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(_`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case ei.SKETCH:t.code.add(_`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(_`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case ei.MIXED:i.varyings.add("vType","float"),t.code.add(_`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(_`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function ID(i){const e=new At,{vertex:t,fragment:r}=e;return i.legacy&&t.uniforms.add(new Z1("model"),new Z1("localView")),e.include(OD,i),e.include(MD,i),e.include(LD,i),e.include(yg,i),e.include($D,i),e.include(hv,i),e.include(AD,i),e.include(ED,i),e.include(xm,i),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),i.multipassEnabled&&e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),t.uniforms.add(new Si("pixelToNDC",(s,a)=>Gr(ND,2/a.camera.fullViewport[2],2/a.camera.fullViewport[3])),new Ma("viewport",(s,a)=>a.camera.fullViewport),new Ue("pixelRatio",(s,a)=>a.camera.pixelRatio)),e.attributes.add(se.POSITION0,"vec3"),e.attributes.add(se.POSITION1,"vec3"),e.attributes.add(se.VARIANTOFFSET,"float"),e.attributes.add(se.VARIANTSTROKE,"float"),e.attributes.add(se.VARIANTEXTENSION,"float"),t.code.add(_`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      ${i.multipassEnabled?"vViewPos = viewPos;":""}

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${i.antialiasing?_`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:_`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${i.mode===ei.SKETCH?_`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:i.mode===ei.MIXED?_`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(_`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${i.multipassEnabled?"terrainDepthTest(vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const ND=yi();class Z1 extends Il{constructor(e){super(e,"mat4")}}const FD=Object.freeze(Object.defineProperty({__proto__:null,build:ID},Symbol.toStringTag,{value:"Module"}));let Rx=class Ox extends $t{initializeProgram(e){return new Mt(e.rctx,Ox.shader.get().build(this.configuration),Bv)}initializePipeline(e){return e.blendMinMax?Je({blending:nr(G.ONE,G.ONE,G.ZERO,G.ONE,Rv.ADD,e.blendMinMax.MAX),depthTest:{func:Pi.LEQUAL},colorWrite:tt}):Je({depthTest:{func:Pi.LEQUAL},depthWrite:L_,colorWrite:tt})}};Rx.shader=new Lt(FD,()=>ie(()=>import("./EdgeShader.glsl-3563284d.js"),["assets/EdgeShader.glsl-3563284d.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/Viewpoint-f83262d0.js","assets/Cyclical-4c223a04.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/HeightModelInfo-b816d32b.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/coordinateSystem-38339d17.js","assets/scaleUtils-72744379.js","assets/LayerConstants-d3ac1b7a.js","assets/DefaultUI-af7068c2.js","assets/UpdatingHandles-7949a657.js","assets/screenUtils-8dc4a7f9.js","assets/Map-1ad4186f.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/Ground-ed93a93a.js","assets/CollectionFlattener-193451da.js","assets/editableLayers-856f2cb4.js","assets/basemapUtils-6ec10a55.js","assets/TablesMixin-292d1d89.js","assets/IViewEvents-9a85f53d.js","assets/interfaces-0421c5e6.js","assets/heightModelInfoUtils-0dd2b6e4.js","assets/mat2d-d4af8487.js","assets/mat2df32-fb26a8c9.js","assets/mat2df64-4d1a9198.js","assets/capabilities-9d56a1da.js","assets/themeUtils-7dcf5b71.js","assets/globalCss-94006b67.js","assets/accessibleHandler-e91101b2.js","assets/Compass-b37d7d1d.js","assets/GoTo-4d856ce0.js","assets/NavigationToggle-57c00adb.js","assets/Zoom-73b5f25a.js","assets/resources-d4afed0c.js","assets/viewpointUtils-245ed782.js","assets/projectPointToVectorWithEngine-f608a34a.js","assets/projectVectorToPoint-fbaf5599.js","assets/earthUtils-ef4b5643.js","assets/spatialReferenceSupport-5aeb751c.js","assets/ElevationSamplerData-9f34f589.js","assets/terrainUtils-b6b761ab.js","assets/Environment-91bfea7d.js","assets/projectPointToWGS84ComparableLonLat-1ba40d40.js","assets/projectVectorToWGS84ComparableLonLat-5675a9f4.js","assets/ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js","assets/ray-8da55042.js","assets/ZoomMomentumEstimator-7437d26a.js","assets/labelFormatUtils-d440367f.js","assets/labelUtils-b29175f3.js","assets/FeatureTileDescriptor3D-27dbeac7.js","assets/geometryServiceUtils-3e048225.js","assets/project-1bd91657.js","assets/RenderCoordsHelper-8f237859.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/LercDecoder-b49c0e9c.js","assets/WorkerHandle-9433ab9a.js","assets/RenderableTile-52f61d09.js","assets/enums-fb086c25.js","assets/config-1337d16e.js","assets/TiledDisplayObject-e7d105ae.js","assets/DisplayObject-9a6e3923.js","assets/TileKey-4b1303ff.js","assets/rasterUtils-15abcc11.js","assets/TileInfoView-ce4d65fb.js","assets/TileStrategy-a729431f.js","assets/QueueProcessor-4b9d43d3.js","assets/StyleDefinition-29c49b98.js","assets/enums-f1a6a48a.js","assets/edgeProcessing-82213448.js","assets/resources-15104e7a.js","assets/EdgeWorkerHandle-7d97defa.js","assets/workerHelper-d1cc0cda.js","assets/testSVGPremultipliedAlpha-f5e92e14.js","assets/DefaultVertexAttributeLayouts-8962d8eb.js","assets/RenderingContext-c0ea7a49.js","assets/ProgramCache-891c4b8d.js","assets/Program-96bc94ed.js","assets/hitTestSelectUtils-d512707e.js","assets/layerViewUtils-6ebe90f4.js"]));let ls=class extends S_{constructor(){super(...arguments),this.mode=ei.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.spherical=!1}};h([I({count:ei.COUNT})],ls.prototype,"mode",void 0),h([I()],ls.prototype,"hasSlicePlane",void 0),h([I()],ls.prototype,"silhouette",void 0),h([I()],ls.prototype,"legacy",void 0),h([I()],ls.prototype,"antialiasing",void 0),h([I()],ls.prototype,"doublePrecisionRequiresObfuscation",void 0),h([I()],ls.prototype,"multipassEnabled",void 0),h([I()],ls.prototype,"cullAboveGround",void 0),h([I()],ls.prototype,"spherical",void 0),h([I({constValue:!1})],ls.prototype,"occlusionPass",void 0);const VD=8,rm=128,UD={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},zD={solid:ei.SOLID,sketch:ei.SKETCH,uber:ei.MIXED};class zc{constructor(e,t,r){this._rctx=e,this._shaderTechniqueRepository=t,this._configuration=new ls,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[Ve.TRANSPARENT]:{[Ve.TRANSPARENT]:new Et,[Ve.OPAQUE]:new Et},[Ve.OPAQUE]:{[Ve.TRANSPARENT]:new Et,[Ve.OPAQUE]:new Et}},this._renderablesDirty=!1,this._drawParameters=new PD,this._settings={...UD,...r},this.key=zc.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ki.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=zD[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=et(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,t){this._renderablesDirty&&this._sortRenderables();const r=this._sortedRenderables[t];r[Ve.TRANSPARENT].forAll(e),r[Ve.OPAQUE].forAll(e)}updateTechnique(e,t){return this._configuration.multipassEnabled=!!e.multipassEnabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=t,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(Rx,this._configuration,this._technique),this._technique}bindRegularEdges(e,t){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(t,!1),e,t)}bindSilhouetteEdges(e,t){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(t,!0),e,t)}renderRegularEdges(e,t,r,s,a){this._render(e,t,t.regular.vao,r,s,a)}renderSilhouetteEdges(e,t,r,s,a){this._render(e,t,t.silhouette.vao,r,s,a)}_render(e,t,r,s,a,n){n>0&&(this._bindDraw(e,t,s,a),this._rctx.bindVAO(r),this._rctx.drawArraysInstanced(fi.TRIANGLE_FAN,0,4,n))}_bindDraw(e,t,r,s){if(this._drawParameters.componentDataTexture=t.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in t.transform)this._lastOriginId!==t.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",t.transform.origin.viewMatrix),this._lastOriginId=t.transform.origin.origin.id),e.setUniformMatrix4fv("model",t.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=t.transform.origin.origin.vec3;else{const a=new ku(t.transform.position),n=Ll(X1,_h(X1,t.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=a.low,this._drawParameters.transformWorldFromModelTH=a.high,this._drawParameters.transformWorldFromModelRS=t.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=n;const o=s.camera.viewInverseTransposeMatrix;Xt(this._drawParameters.slicePlaneLocalOrigin,o[3],o[7],o[11])}e.bindDraw(this._drawParameters,s,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[Ve.TRANSPARENT][Ve.TRANSPARENT].clear(),this._sortedRenderables[Ve.TRANSPARENT][Ve.OPAQUE].clear(),this._sortedRenderables[Ve.OPAQUE][Ve.TRANSPARENT].clear(),this._sortedRenderables[Ve.OPAQUE][Ve.OPAQUE].clear(),this._renderables.forEach(t=>{t.objectTransparency!==Ve.INVISIBLE&&t.edgeTransparency!==Ve.INVISIBLE&&this._sortedRenderables[t.objectTransparency][t.edgeTransparency].push(t)});const e=(t,r)=>"origin"in t.transform?"origin"in r.transform?t.transform.origin.origin.id<r.transform.origin.origin.id?-1:t.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[Ve.TRANSPARENT][Ve.TRANSPARENT].sort(e),this._sortedRenderables[Ve.TRANSPARENT][Ve.OPAQUE].sort(e),this._sortedRenderables[Ve.OPAQUE][Ve.TRANSPARENT].sort(e),this._sortedRenderables[Ve.OPAQUE][Ve.OPAQUE].sort(e)}static getKey(e,t,r){return`edges-t:${e}:${t}:${r}`}}const X1=zv();function qD(i){const t=rc.resolution,r=t/2,s=new Uint8Array(4*t*t),a=4*t*r,n=rc.amplitude,o=2*n,l=4*t,c=Math.log2(t)+1,d=rc.strokes.length;let p=(c-1)*d*l;for(const{distance:g,pressure:f}of rc.strokes){let y=g,v=f,T=p;for(let w=0;w<c;w++){w!==0&&(y=Y1(y,uh.DISTANCE),v=Y1(v,uh.PRESSURE));for(let x=0;x<rc.resolution;x++){const C=.5+(y?y[x%y.length]/o:0),P=v?v[x%v.length]:1;Rm(C,s,T),Rm(P,s,T+a),T+=4}T-=l*(d+1)}p+=l}const m=new Hi(i,new Yr(t),s);return new HD(t,o,n,d,m)}function Y1(i,e){if(!i)return null;const t=i.length/2,r=BD*t,s=new Array(t);let a=0;const n=e===uh.PRESSURE;for(let o=0;o<i.length;o+=2){const l=(i[o]+i[o+1])/2;s[a++]=n?Math.min(r,1-(1-l)*K1):Math.min(r,l*K1)}return s}var uh;(function(i){i[i.DISTANCE=0]="DISTANCE",i[i.PRESSURE=1]="PRESSURE"})(uh||(uh={}));const BD=.1,K1=.5;let HD=class{constructor(e,t,r,s,a){this.resolution=e,this.normalizationScale=t,this.amplitude=r,this.variants=s,this.texture=a}dispose(){this.texture=De(this.texture)}};const rc={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function J1(i){let e=null;for(const t of i){const r=t.type;if(kD(t)){if(e==null)e=r;else if(e!==r)return"uber"}}return e??"uber"}function ey(i){let e=Ve.INVISIBLE;for(const{material:t}of i)if(Ex(t)){if(t.color[3]*t.opacity<1)return Ve.TRANSPARENT;e=Ve.OPAQUE}return e}function ty(i){let e=Ve.INVISIBLE;for(const{material:t}of i)if(Ex(t)){switch(t.objectTransparency){case Ve.TRANSPARENT:case Ve.INVISIBLE:return Ve.TRANSPARENT;case Ve.OPAQUE:if(t.opacity<1)return Ve.TRANSPARENT}e=Ve.OPAQUE}return e}function Ex(i){return i.size*i.color[3]*i.opacity>0}function kD(i){return i.size*i.color[3]>0}function iy(i,e,t,r){for(let s=0;s<i.length;s++){const a=i[s].index,n=e[s],o=e[s+1];if(r)for(let l=n;l<o;l++){const c=r[l];t.set(c,a)}else for(let l=n;l<o;l++)t.set(l,a)}}let cs=class extends ue{constructor(i){super(i),this._updatingHandles=new Nu,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=b(),this._localOrigins=new xD(new bv(i.renderSR))}initialize(){this._worker=new lS(this.schedule),this._componentColorManager=new Zw(this.rctx,3);const i=iS.createBuffer(4);for(let e=0;e<4;e++)i.sideness.set(e,0,e===0||e===3?0:1),i.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Lr.createVertex(this.rctx,vs.STATIC_DRAW,i.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(i=>this._discardObjectEntry(i)),this._perObjectData.clear(),this._strokesTexture=De(this._strokesTexture),this._componentColorManager=re(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=De(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",ZD))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(i,e,t,r,s,a,n,o){if(this.hasObject(i))return this.getObjectMemoryUsage(i);let l;const c=new sy(new Promise(p=>l=p),t.center,t.radius);this._perObjectData.set(i,c);const d=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,s,a,n,o));return this.setNeedsRender(),l(),d}async addOrUpdateObject3D(i,e,t,r){if(this.destroyed)return void ce.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(i);let a;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const n=i.boundingVolumeWorldSpace.bounds,o=new sy(new Promise(c=>a=c),Sy(n),j2(n));this._perObjectData.set(i,o);const l=new Array;if(t.mergeGeometries&&i.geometries.length>1&&GD(i))l.push(this._addObjectMergedGeometries(i,o,e,t,r));else for(let c=0;c<i.geometries.length;c++){const d=i.geometries[c];d.material.supportsEdges&&l.push(this._addGeometry(i,o,d,e[0],t,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(o),this._discardObjectEntry(s),this.setNeedsRender(),a()}fastUpdateObject3DEdgesTransform(i){if(this.destroyed)return!1;const e=this._perObjectData.get(i);if(!e)return!1;const{geometries:t}=i,{renderables:r}=e;if(t.length===0||r.length===0)return!0;if(r.length>1)return!1;const[s]=r,a=s.transform;if(!(a instanceof sm))return!1;const[n]=t;if(n.localOrigin!==a.origin.origin)return!1;const o=nt(),l=this._computeModelTransformWithLocalOrigin(i,n,o);return s.transform=new sm(o,l),this.setNeedsRender(),!0}_discardObjectEntry(i){i&&(i.renderables.length&&(i.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),i.loaded=null)}hasObject(i){return this._perObjectData.has(i)}async updateAllComponentOpacities(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));if(t==null)return;const r=e instanceof Array?s=>e[s]:()=>e;t.renderables.forEach(s=>{const a=s.components.meta.length;for(let n=0;n<a;n++){const o=r(n),l=s.components.meta[n],c=l.index;l.material.opacity=o,s.components.buffer.textureBuffer.setDataElement(c,1,3,255*o)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(i){const e=await this._getObjectEntry(i);return e!=null?e.renderables.reduce((t,r)=>t+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(i,e,t,r){const s=i instanceof w3,a=!!t.hasSlicePlane,n=J1(e),o=zc.getKey(n,a,s),l=await this._updatingHandles.addPromise(this._getObjectEntry(i));l!=null&&(l.renderables.forEach(c=>{if(o!==c.rendererKey){const d=this._renderers.get(c.rendererKey),p=this._acquireRenderer(n,a,s);d.removeRenderable(c),--d.refCount,c.rendererKey=o,p.addRenderable(c)}for(let d=0;d<e.length;d++)c.components.meta[d].material=e[d];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));t!=null&&(t.renderables.forEach(r=>{const s=r.components.meta;for(let a=0;a<s.length;a++)r.components.meta[a].verticalOffset=(e==null?void 0:e[a])??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(i,e){const t=await this._updatingHandles.addPromise(this._getObjectEntry(i));t!=null&&(t.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(i){const e=this._perObjectData.get(i);e&&(this._perObjectData.delete(i),this._discardObjectEntry(e))}async _getObjectEntry(i){const e=this._perObjectData.get(i);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(i,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(i.camera.viewMatrix);const t=i.camera.viewInverseTransposeMatrix,r=b(),s=new ku;let a=0,n=0;if(this._renderers.forEach(l=>{if(l.refCount===0)return this._renderers.delete(l.key),void l.dispose();let c=!0,d=!0;l.forEachRenderable(p=>{p.visible&&(a+=p.statistics.averageEdgeLength,n++,c&&p.regular&&(l.updateTechnique(i,!1),c=!1),d&&p.silhouette&&(l.updateTechnique(i,!0),d=!1))},e)}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),n===0)return;const o=new CD(40*a/n,e);Xt(r,t[3],t[7],t[11]),s.set(r),ae(o.transformWorldFromViewTH,s.high),ae(o.transformWorldFromViewTL,s.low),c_(o.transformViewFromCameraRelativeRS,i.camera.viewMatrix),Ll(ly,o.transformViewFromCameraRelativeRS),_h(o.transformNormalViewFromGlobal,ly),o.transformProjFromView=i.camera.projectionMatrix,this._updateObjectCameraDistances(i),this._renderers.forEach(l=>{this._renderRegularEdges(l,i,o),this._renderSilhouetteEdges(l,i,o)})}_updateTransparency(i){const e=ey(i.components.meta),t=ty(i.components.meta);e===i.edgeTransparency&&t===i.objectTransparency||(i.edgeTransparency=e,i.objectTransparency=t,this._renderers.get(i.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(i,e,t){i.getCombinedShaderTransformation(e,t);const r=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(Xt(this._tmpModelPosition,t[12],t[13],t[14]));return e.localOrigin=r.origin,bD(r.origin.vec3,t),r}_updateComponentBuffer(i){const{meta:e,buffer:t}=i,r=new Uint8Array(4);for(let s=0;s<e.length;s++){const a=e[s].material,n=e[s].index,o=K(Math.round(a.size*VD),0,255),l=K(a.extensionLength,-rm,255-rm)+rm,c=a.type==="solid"?Df.SOLID:Df.SKETCH,d=255*a.opacity,p=a.color,m=255*p[0],g=255*p[1],f=255*p[2],y=255*p[3];t.textureBuffer.setData(n,0,m,g,f,y),t.textureBuffer.setData(n,1,o,l,c,d),kw(e[s].verticalOffset,r),t.textureBuffer.setData(n,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(i){if(this._componentColorManager==null)return null;const e=new Array,t=this._componentColorManager.getBuffer(i.length);for(let s=0;s<i.length;s++){const a=i[s],n=t.acquireIndex();e.push({index:n,verticalOffset:0,material:a})}const r=new jD(t,e);return this._updateComponentBuffer(r),r}_extractEdges(i,e,t,r,s,a=s.length){return this._worker.process({data:e,indices:s,indicesLength:a,writerSettings:i,skipDeduplicate:t},this._workerAbort.signal,r)}_createRenderable(i,e,t,r,s){const a=c=>this._verticesBufferObject!=null?new WD(new To(this.rctx,Bv,{vertices:rS,instances:c===ro.REGULAR?sS.glLayout:aS.glLayout},{vertices:this._verticesBufferObject,instances:Lr.createVertex(this.rctx,vs.STATIC_DRAW,c===ro.REGULAR?i.regular.instancesData.buffer:i.silhouette.instancesData.buffer)}),c===ro.REGULAR?i.regular.lodInfo:i.silhouette.lodInfo):null,n=i.regular.lodInfo.lengths.length>0?a(ro.REGULAR):null,o=i.silhouette.lodInfo.lengths.length>0?a(ro.SILHOUETTE):null,l=((n==null?void 0:n.vao.usedMemory)??0)+((o==null?void 0:o.vao.usedMemory)??0);return new QD(n,o,{gpuMemoryUsage:l,externalMemoryUsage:s,averageEdgeLength:i.averageEdgeLength},t,ey(e.meta),ty(e.meta),e,r)}async _addGeometry(i,e,t,r,s,a){if(t.edgeIndicesLength<=0)return;const n=t.attributes.get(se.POSITION),o=nt(),l=this._computeModelTransformWithLocalOrigin(i,t,o),c=new oy(n,o,l);return this._addPositionData(e,c,t.edgeIndicesLength,r,s,a)}async _addPositionData(i,e,t,r,s,a=!1){if(i.loaded==null)return;const n=this._createComponentBuffers([r]);if(n==null)return;const o=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,d=e.position.indices,p=e.position,m=p.data.length/p.size,g=Om.createBuffer(m);for(let v=0;v<m;v++)g.position.set(v,0,p.data[v*p.size]),g.position.set(v,1,p.data[v*p.size+1]),g.position.set(v,2,p.data[v*p.size+2]);iy(n.meta,[0,g.componentIndex.count],g.componentIndex);const f=await this._updatingHandles.addPromise(this._extractEdges(o.writerSettings,g,!1,a,d,t));if(i.loaded==null)return;const y=this._createRenderable(f,n,new sm(l,c),o.key,!1);i.renderables.push(y),o.addRenderable(y),this._gpuMemoryUsage+=y.statistics.gpuMemoryUsage}async _addComponentGeometry(i,e,t,r,s,a,n){if(e.loaded==null)return 0;const o=this._createComponentBuffers(a);if(o==null)return 0;const l=J1(a),c=this._acquireRenderer(l,n.hasSlicePlane||!1,!1),d=Om.createBuffer(t.length/3);Uv(d.position.typedBuffer,t,d.position.typedBufferStride,3),iy(o.meta,s,d.componentIndex,r);const p=!0,m=c.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(m,d,p,!1,r));if(e.loaded==null)return 0;const f=this._createRenderable(g,o,i,c.key,!0);return e.renderables.push(f),c.addRenderable(f),f.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(i,e,t,r,s){const a=new Map;let n=0,o=null,l=0;const c=i.geometries.filter(w=>{if(w.edgeIndicesLength<=0||!w.material.supportsEdges)return!1;!o&&w.localOrigin&&(o=w);const x=w.attributes.get(se.POSITION);return l+=x.data.length/x.size,n+=w.edgeIndicesLength,!0});if(c.length===0)return;const d=l>=65536?Uint32Array:Uint16Array,p=n?new d(n):null,m=[];let g=0;c.forEach(w=>{const x=w.attributes.get(se.POSITION),C=x.indices;let P=a.get(x.data);if(P==null){P=m.length/3;for(let R=0;R<x.data.length;R+=x.size)m.push(x.data[R]),m.push(x.data[R+1]),m.push(x.data[R+2]);a.set(x.data,P)}for(let R=0;R<w.edgeIndicesLength;R++)p[g++]=P+C[R]});const f=o||i.geometries[0],y=nt(),v=this._computeModelTransformWithLocalOrigin(i,f,y);for(let w=0;w<i.geometries.length;w++)i.geometries[w].localOrigin=v.origin;const T=new oy(new W2(m,p,3),y,v);await this._updatingHandles.addPromise(this._addPositionData(e,T,p.length,t[0],r,s))}_acquireRenderer(i,e,t){const r=zc.getKey(i,e,t);let s=this._renderers.get(r);return this._strokesTexture==null&&(this._strokesTexture=qD(this.rctx)),s||(s=new zc(this.rctx,this.techniqueRepository,{type:i,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:t,spherical:this.viewingMode===Ne.Global}),this._renderers.set(r,s)),++s.refCount,s}_removeRenderable(i){ry(i.regular),ry(i.silhouette);const e=this._renderers.get(i.rendererKey);if(e){e.removeRenderable(i),--e.refCount,"origin"in i.transform&&this._localOrigins.release(i.transform.origin),this._gpuMemoryUsage-=i.statistics.externalMemoryUsage?0:i.statistics.gpuMemoryUsage;for(const t of i.components.meta)i.components.buffer.releaseIndex(t.index)}}_updateObjectCameraDistances(i){const e=i.camera.eye,t=i.camera.viewForward,r=b(),s=a=>{Bi(r,a.center,e);const n=Ie(r,t),o=a.radius,l=n<-o?1/0:n<o?0:n-o;a.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(i,e,t){const r=i.bindRegularEdges(t,e),s=t.transparency,a=e.camera.perScreenPixelRatio;i.forEachRenderable(n=>{if(!ay(n)||!n.visible)return;const o=_d(n.regular.lod.lengths,n.distanceToCamera,a);i.renderRegularEdges(r,n,t,e,o)},s)}_renderSilhouetteEdges(i,e,t){const r=i.bindSilhouetteEdges(t,e),s=t.transparency,a=e.camera.perScreenPixelRatio;i.forEachRenderable(n=>{if(!ny(n)||!n.visible)return;const o=_d(n.silhouette.lod.lengths,n.distanceToCamera,a);i.renderSilhouetteEdges(r,n,t,e,o)},s)}get test(){return{hasRenderedPrimitives:i=>{let e=!1;const t=i.perScreenPixelRatio,r=(s,a)=>s.forEachRenderable(n=>{n.visible&&!e&&(ay(n)&&(e=_d(n.regular.lod.lengths,n.distanceToCamera,t)>0),!e&&ny(n)&&(e=_d(n.silhouette.lod.lengths,n.distanceToCamera,t)>0))},a);return this._renderers.forEach(s=>{e||(r(s,Ve.OPAQUE),r(s,Ve.TRANSPARENT))}),e},getObjectData:i=>this._perObjectData.get(i)}}};function ry(i){i!=null&&(i.vao.vertexBuffers.instances.dispose(),i.vao.disposeVAOOnly(),i.vao=null)}function GD(i){let e=null,t=null;for(let r=0;r<i.geometries.length;r++){const s=i.geometries[r];if(s.material.supportsEdges){if(e){if(!y_(e,s.transformation))return!1}else e=s.transformation;if(t||s.localOrigin==null){if((t==null?void 0:t.localOrigin)!=null&&s.localOrigin!=null&&t.localOrigin.id!==s.localOrigin.id)return!1}else t=s}}return!0}h([u({constructOnly:!0})],cs.prototype,"rctx",void 0),h([u({constructOnly:!0})],cs.prototype,"renderSR",void 0),h([u({constructOnly:!0})],cs.prototype,"viewingMode",void 0),h([u({constructOnly:!0})],cs.prototype,"techniqueRepository",void 0),h([u({constructOnly:!0})],cs.prototype,"setNeedsRender",void 0),h([u({constructOnly:!0})],cs.prototype,"schedule",void 0),h([u({readOnly:!0})],cs.prototype,"_updatingHandles",void 0),h([u({readOnly:!0})],cs.prototype,"updating",null),cs=h([N("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],cs);class sy{constructor(e,t,r){this.center=t,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}class jD{constructor(e,t){this.buffer=e,this.meta=t}}class WD{constructor(e,t){this.vao=e,this.lod=t}}let sm=class{constructor(e,t){this.modelMatrix=e,this.origin=t}};class QD{constructor(e,t,r,s,a,n,o,l){this.regular=e,this.silhouette=t,this.statistics=r,this.transform=s,this.edgeTransparency=a,this.objectTransparency=n,this.components=o,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}}function ay(i){return i.regular!=null}function ny(i){return i.silhouette!=null}function _d(i,e,t){const r=e*t,s=Q2(i,r,!0);return s===-1?r<i[0]?i.length:0:i.length-s}class oy{constructor(e,t,r){this.position=e,this.modelTransform=t,this.origin=r}}const ly=Ua(),ZD=()=>Promise.reject();function XD(i,e){const t=i.capabilities.disjointTimerQuery;return t==null?null:new YD(t,e)}class YD{constructor(e,t){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,t.forEach(r=>{const s=this._timer.createQuery(),a=this._timer.createQuery();this._queryPool.push(s,a),this._queryResults.set(r,null)})}start(){cS||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const t=this._queryResults.get(e);if(t==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(t))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(t)/1e6;return this._queryPool.unshift(t),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}}var ct;(function(i){i.OVERLAY="overlay",i.PREPARE="prepare",i.SHADOW_MAP="shadow map",i.LINEAR_DEPTH="linear depth",i.ACCUMULATED_SHADOWS="accumulated shadows",i.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",i.SSAO="SSAO",i.OPAQUE="opaque",i.OPAQUE_EDGES="opaque edges",i.VOXEL="voxel",i.TRANSPARENT="transparent",i.TRANSPARENT_EDGES="transparent edges",i.HUD_VISIBILITY="HUD visibility",i.TRANSPARENT_TERRAIN="transparent terrain",i.ENVIRONMENT="environment",i.LASER_LINES="laser lines",i.OCCLUDED="occluded",i.ANTIALIASING="antialiasing",i.HIGHLIGHTS="highlights",i.HUD="HUD",i.HUD_OCCLUDED="HUD occluded",i.FINISH="finish"})(ct||(ct={}));const cy="Total";let KD=class{constructor(e){this._rctx=e,this._startTimeStampCPU=Oe(0),this._lastTimeStampCPU=Oe(0),this._totalCPUTime=new Th(cy),this._cpuTimeSamplers=new Map(Object.values(ct).map(t=>[t,new Th(t)])),this._enableGPUTimer=0,this._totalGPUTime=new Th("GPU"),this._gpuTimeSamplers=new Map(Object.values(ct).map(t=>[t,new Th(t)])),this._totalTime=Oe(0),this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return Oe(performance.now()-this._startTimeStampCPU)}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const t=[...Object.values(ct),cy];this._gpuTimerPool=XD(this._rctx,t)}if(this._gpuTimerPool==null)return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;let e=!1;return{hasGPUTimerSupport:!0,remove:()=>{e||(e=!0,--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=De(this._gpuTimerPool)))}}}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=Oe(performance.now()),this._gpuTimerPool&&this._gpuTimerPool.start()}advance(e){const t=Oe(performance.now());if(this._cpuTimeSamplers.get(e).record(t-this._lastTimeStampCPU),this._lastTimeStampCPU=t,this._gpuTimerPool){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool){const t=this._gpuTimerPool.stop(ct.FINISH);this._gpuTimeSamplers.get(ct.FINISH).record(t),this._rctx.gl.flush()}const e=Oe(performance.now()-this._startTimeStampCPU);this._totalTime=Oe(this._totalTime+e),this._totalCPUTime.record(e),this._gpuTimerPool&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((t,r)=>t+(r.last||0),0)),++this._totalFrameCount}},Cr=class extends ue{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeatures(i=null,e=!li("disable-feature:high-quality-idle")){this._renderStateFeatures=op(e,i),this.notifyChange("_renderStateFeatures"),this._renderPlugins.renderFeatureChanged(),this._requestRender()}isFeatureEnabled(i,e=this._state){return this._renderStateFeatures.get(e,i)??!1}setFeatureEnabled(i,e,t){this._renderStateFeatures.set(e,i,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(Ws.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(Ws.WaterReflection))}get hasDecorations(){return this._materialRenderersHas.decorations||this._renderPlugins.hasDecorations}get hasHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces($.OPAQUE_MATERIAL,M.Highlight)||this._renderPlugins.produces($.DRAPED_MATERIAL,M.Highlight)}get hasShadowHighlights(){return this._materialRenderersHas.highlights||this._renderPlugins.produces($.OPAQUE_MATERIAL,M.ShadowHighlight)}get _magnifierEnabled(){return this._bindParameters.decorations===js.ON&&this._magnifierHelper.enabled}get fullResolutionAtmosphere(){return this._stage.view.qualitySettings.highResolutionAtmosphere||this.isFeatureEnabled(Ws.HighResolutionAtmosphere)}get hasWater(){return this._materialRenderersHas.water||this._hasOverlayWater}constructor(i,e,t,r,s,a,n,o){super({}),this._stage=i,this._techniqueRepository=r,this._rctx=s,this._compositingHelper=a,this._magnifierHelper=n,this._requestRender=o,this._materialRenderers=new Et,this._needsTransparentPass=!1,this._materialRenderersHas={hudElements:!1,highlights:!1,water:!1,decorations:!1,occludees:!1},this._hasOverlayWater=!1,this.renderOverlay=l=>{},this._isRendering=!1,this._backgroundColor=Zr(0,0,0,1),this._sliceHelper=new vD,this._state=Ui.IDLE,this._highQualityTransparencyEnabled=!0,this._terrainTransparency=qi.Opaque,this._ssrEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new iD,this._renderHiddenTransparentEdges=()=>{},this._pluginInput=new DM,this._releaseGeometryLinearDepth=l=>l==null?void 0:l.release(),this._geometryLinearDepthFormat=pr.DEPTH16_BUFFER,this.fboCache=new n3(s),this._renderStateFeatures=op(!li("disable-feature:high-quality-idle"),i.view.qualityProfile),this._offscreen=new lD(this.fboCache,this._compositingHelper),this.performanceInfo=new KD(this._rctx),this._shadowMap=new xv(this.fboCache,i.viewingMode),this._highlight=new Cc({view:i.view}),this._shadowHighlight=new rl({view:i.view,viewingMode:i.viewingMode}),this._shadowAccumulator=new Ki(this.fboCache,r,i,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,d)=>{l.shadowMap.start(l.camera,c,d,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(M.Shadow,l.shadowMap),l.shadowMap.finish(),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},o),this._ssao=new xP({view:this._stage.view}),this._renderContext=new x3(this._rctx,this._offscreen,this._shadowMap,this._sliceHelper),this._renderPlugins=new zd({renderContext:this._renderContext,techniqueRepository:r,textureRepository:t,materialRepository:e,requestRender:o,controller:i,fbos:this.fboCache,isFeatureEnabled:l=>this.isFeatureEnabled(l)}),this.renderPassManager=new o_,this._renderPlugins.add(this.renderPassManager),this._smaa=new Xn({view:this._stage.view}),this._renderPlugins.add(this._smaa),this._blit=new il({opacity:1,alphaMode:Li.None}),this._renderPlugins.add(this._blit),this._renderPlugins.add(this._ssao),this._renderPlugins.add(this._highlight),this._renderPlugins.add(this._shadowHighlight),this.addHandles([D(()=>this._stage.view.state.camera,()=>o(),yt),D(()=>ki.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(Ve.TRANSPARENT):()=>{},o()},si),D(()=>{var l;return(l=this._stage.view.environment.background)==null?void 0:l.color},l=>{const c=l?Bc(l):l_;Va(this._backgroundColor,c[0]*c[3],c[1]*c[3],c[2]*c[3],c[3]),o()},yt)])}normalizeCtorArgs(){return{}}destroy(){this._smaa.destroy(),this._blit.destroy(),this._gpuTimerHandle=Fa(this._gpuTimerHandle),this._materialRenderers.forAll(i=>i.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._shadowMap.dispose(),this._ssao.destroy(),this._highlight.dispose(),this._shadowHighlight.destroy(),this._shadowAccumulator.dispose(),this._edgeView=re(this._edgeView),this.renderPassManager.dispose(),this._releaseFBOs(),this._disposeOffscreenBuffers(),this.fboCache.destroy(),Z2.prune()}_releaseFBOs(){this._bindParameters.ssr.lastFrameColor=et(this._bindParameters.ssr.lastFrameColor),this._bindParameters.multipassTerrain.linearDepth=et(this._bindParameters.multipassTerrain.linearDepth),this._bindParameters.multipassGeometry.linearDepth=et(this._bindParameters.multipassGeometry.linearDepth)}_disposeOffscreenBuffers(){this._offscreen.dispose(),this._disposeBindBuffers()}_disposeBindBuffers(){this._shadowMap.disposeOffscreenBuffers(),this._bindParameters.linearDepth=et(this._bindParameters.linearDepth),this._bindParameters.hudVisibility=et(this._bindParameters.hudVisibility)}get updating(){return this._smaa.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const i=this._stage.view.resourceController;this._edgeView=new cs({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:JD(i)}),this.addHandles(D(()=>{var e;return(e=this._edgeView)==null?void 0:e.updating},()=>this._requestRender(),at)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return X2(this._bindParameters.ssr.reprojectionMatrix,Sc)}set _reprojectionMatrix(i){Y2(this._bindParameters.ssr.reprojectionMatrix,i)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var i;return!!((i=this._shadowMap)!=null&&i.enabled)}setParameters(i){var r;const{_shadowMap:e,_bindParameters:t}=this;if(((r=i.qualitySettings)==null?void 0:r.reflections)!==void 0&&this._ssrEnabled!==i.qualitySettings.reflections&&(this._ssrEnabled=i.qualitySettings.reflections,this._requestRender()),i.shadowMap!==void 0&&this._shadowMap.enabled!==i.shadowMap&&(this._shadowMap.enabled=i.shadowMap,this._requestRender()),i.shadowMapMaxCascades!==void 0&&e.maxCascades!==i.shadowMapMaxCascades&&(e.maxCascades=i.shadowMapMaxCascades,this._requestRender()),i.environment!=null){i.environment.weather!=null&&(this._bindParameters.weather=i.environment.weather,this._bindParameters.weatherVisible=!!i.weatherVisible);const s=i.environment.lighting.type!=="virtual";t.enableFillLights!==s&&(t.enableFillLights=s,this._requestRender())}i.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==i.highQualityTransparency&&(this._highQualityTransparencyEnabled=i.highQualityTransparency,this._requestRender()),i.hasOverlayWater!==void 0&&this._hasOverlayWater!==i.hasOverlayWater&&(this._hasOverlayWater=i.hasOverlayWater,this._requestRender()),i.slicePlane!==void 0&&this._sliceHelper.plane!==i.slicePlane&&(this._sliceHelper.plane=i.slicePlane,this._requestRender()),i.terrainTransparency!==void 0&&this._terrainTransparency!==i.terrainTransparency&&(this._terrainTransparency=i.terrainTransparency,this._requestRender()),i.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(i.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(i,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:r,updates:s}=i;if(t.length===0&&r.length===0&&s.length===0)return;const a=T3(i);let n=!1;a.forEach((o,l)=>{if(e.done)return;let c=this._materialRenderers.find(d=>d.material===l);if(c==null&&o.adds.length>0){const d=new C3({material:l});d.initializeRenderContext(this._renderPlugins._context),c=d,this._materialRenderers.push(c)}c&&(c.modify(o),c.isEmpty&&(n=!0)),o.removes.forEach(d=>i.removes.removeUnordered(d)),o.adds.forEach(d=>i.adds.removeUnordered(d)),o.updates.forEach(d=>i.updates.removeUnordered(d)),e.madeProgress()}),n&&this._materialRenderers.filterInPlace(o=>!o.isEmpty||(o.dispose(),!1)),this._updateHasFlags(),this._requestRender()}_updateHasFlags(){const i=this._materialRenderersHas;i.decorations=!1,i.highlights=!1,i.hudElements=!1,i.water=!1,i.occludees=!1,this._materialRenderers.forAll(e=>{i.highlights||(i.highlights=e.hasHighlights),i.occludees||(i.occludees=e.hasOccludees),i.water||(i.water=e.hasWater),i.decorations||(i.decorations=e.isDecoration),i.hudElements||(i.hudElements=e.material.produces($.LINE_CALLOUTS_HUD_DEPTH,M.Color)||e.material.produces($.HUD_MATERIAL,M.Color)||e.material.produces($.LABEL_MATERIAL,M.Color))}),this._bindParameters.hasOccludees=i.occludees}updateAnimation(i){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(t=>this._hasAnimations=t.updateAnimation(i)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(i)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Fa(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}tick(){this.fboCache.clean()}render(i,e,t,r,s){const a=i!=null;this._isRendering=!0,this.performanceInfo.startFrame(),this.fboCache.frame(),this._disposeBindBuffers();const n=this._offscreen,{camera:o,contentCamera:l,mode:c,alignPixelEnabled:d}=t;this._state=c,this._bindParameters.overlay=this.renderOverlay(s),this.performanceInfo.advance(ct.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=Jt.NONE,this._bindParameters.alignPixelEnabled=d,this._bindParameters.decorations=r;const p=Mu(this._sliceHelper.plane);r===js.OFF&&(this._sliceHelper.plane=null),o.setGLViewport(this._rctx);const m=n.initializeFrame(o,this._backgroundColor,a);this.hasReflections?this._bindParameters.ssr.lastFrameColor=m:m==null||m.release(),this._prepare(o,l),this._renderPlugins.prepareRender(),this.performanceInfo.advance(ct.PREPARE);const g=this._computeDepthRange(o);this._renderShadowMap(o,this._bindParameters.lighting.mainLight.direction,g),this.performanceInfo.advance(ct.SHADOW_MAP),this._ensureBindParameters(o,l);const f=this._renderPlugins.produces($.OPAQUE_TERRAIN)&&(this._terrainTransparency===qi.Semitransparent||this._terrainTransparency===qi.TransparentWithDraped),y=this._highQualityTransparency&&f,v=this._needsTransparentPass||this._renderPlugins.produces($.TRANSPARENT_MATERIAL);this._prepareShaders(y,v),this._renderLinearDepth(),this.performanceInfo.advance(ct.LINEAR_DEPTH),this._renderShadowAccumulation(g,o,l),this.performanceInfo.advance(ct.ACCUMULATED_SHADOWS),this._ensureBindParametersSSR(s),this._renderSSAO(),this.performanceInfo.advance(ct.SSAO),this._renderContext.output=M.Color,n.bindFbo(),this._renderOpaqueGeometry(),this._renderPlugins.render($.ENVIRONMENT_OPAQUE),this.performanceInfo.advance(ct.OPAQUE),this._renderTerrainLinearDepth(y),this._setMultipassTerrain(y),this._renderEdges(Ve.OPAQUE),this.performanceInfo.advance(ct.OPAQUE_EDGES),n.bindFbo(),this._renderPlugins.render($.VOXEL),this.performanceInfo.advance(ct.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(pl.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(ct.TRANSPARENT);const T=this._renderGeometryLinearDepth(y);this._renderHUDVisibility(T),y||this._renderInternalSlot($.LINE_CALLOUTS),this.performanceInfo.advance(ct.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(ct.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(Ve.TRANSPARENT,T),this._releaseGeometryLinearDepth(T),this.performanceInfo.advance(ct.TRANSPARENT_EDGES);const w=f?this._renderTransparentTerrain():null;w&&this._bindParameters.hudVisibility&&(y?this._renderLineCallouts(ua.Occluded):n.compositeToHUDVisibility(this._bindParameters,w.colorTexture),this._renderHUD(ua.Occluded,n.color),this.performanceInfo.advance(ct.HUD_OCCLUDED)),this.performanceInfo.advance(ct.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),w&&(n.compositeToFramebuffer(this._bindParameters,w.colorTexture,Li.PremultipliedAlpha,1),w.release(),y&&(this._renderEdges(Ve.OPAQUE),this.performanceInfo.advance(ct.OPAQUE_EDGES),v&&(this._oitEnabled?this._renderOITPass(pl.Geometry):this._renderTransparentMaterial()),this.performanceInfo.advance(ct.TRANSPARENT),this._renderEdges(Ve.TRANSPARENT),this.performanceInfo.advance(ct.TRANSPARENT_EDGES))),this._bindParameters.ssao=et(this._bindParameters.ssao),y&&this._renderLineCallouts(ua.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),n.bindFbo(),this._renderInternalSlot($.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.render($.ENVIRONMENT_TRANSPARENT),this.performanceInfo.advance(ct.ENVIRONMENT),this._renderLaserlines(),this.performanceInfo.advance(ct.LASER_LINES),this._renderOccluded(),this.performanceInfo.advance(ct.OCCLUDED);const x=this._magnifierEnabled&&i==null?this.fboCache.acquire(Vt.RGBA,this._offscreen.width,this._offscreen.height):null,C=this._renderComposite(x??i,this._offscreen.color)??i;this.performanceInfo.advance(ct.ANTIALIASING),this._renderHUD(ua.NotOccluded,C),this.performanceInfo.advance(ct.HUD),this._renderHighlights(C,this._bindParameters),this.performanceInfo.advance(ct.HIGHLIGHTS),this._magnifierEnabled&&this._magnifierHelper.render(this._rctx,this._bindParameters),C!==i&&(this._rctx.bindFramebuffer(i==null?void 0:i.fbo),this._compositingHelper.composite(this._bindParameters,x==null?void 0:x.colorTexture,Li.None)),x!==i&&(x==null||x.release()),this.onPostRender&&this.onPostRender(),this._releaseFBOs(),this._offscreen.releaseBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=p,this._isRendering=!1,this.performanceInfo.finishFrame(),a&&(this._releaseFBOs(),this._disposeOffscreenBuffers())}_prepareShaders(i,e){this._renderContext.output=M.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(i),this._renderPlugins.prepare($.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),i||this._prepareInternalSlots(this._materialRenderers,$.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,$.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderPlugins.prepare($.ENVIRONMENT_TRANSPARENT),this._renderPlugins.prepare($.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(i){if(i==null||!li("enable-feature:objectAndLayerId-rendering"))return;const e=this._renderContext.output;this._rctx.bindFramebuffer(i.fbo),this._offscreen.renderToFBO(()=>this._renderAllGeometry(M.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(i.fbo),this._offscreen.renderToFBO(()=>{this._bindParameters.hudRenderStyle=ua.NotOccluded,this._renderInternalSlot($.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}finish(i){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,t=i===Bt.BACKGROUND;if(t||e){const r=t?this.performanceInfo.elapsedTime:0,s=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),a=Math.max(r,s);this._animationTimestep.frame(a,t)}}readDepthPixels(i,e,t){var n;const r=(n=this._bindParameters.linearDepth)==null?void 0:n.fbo;if(r!=null&&r.colorTexture)return void r.readPixels(e[0],e[1],e[2],e[3],$i.RGBA,bd.UNSIGNED_BYTE,t);const s=this.fboCache.acquire(Vt.RGBA,this._offscreen.width,this._offscreen.height).acquireDepth(pr.DEPTH16_BUFFER);this._rctx.bindFramebuffer(s.fbo),this._ensureBindParameters(i,i),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const a=ii.COLOR_BUFFER_BIT|ii.DEPTH_BUFFER_BIT|ii.STENCIL_BUFFER_BIT;this._rctx.clearSafe(a),this._renderAllGeometry(M.Depth),s.fbo.readPixels(e[0],e[1],e[2],e[3],$i.RGBA,bd.UNSIGNED_BYTE,t),s.release()}readHUDVisibility(i,e,t,r,s){var a;(a=this._bindParameters.hudVisibility)==null||a.fbo.readPixels(i,e,t,r,$i.RGBA,bd.UNSIGNED_BYTE,s)}readAccumulatedShadow(i){return this._shadowAccumulator.readAccumulatedShadow(i[0],i[1])}_setMultipassTerrain(i){this._setMultipassEnabled(i),this._setTerrainCulling(i)}_setMultipassEnabled(i){this._bindParameters.multipassEnabled=i}_setTerrainCulling(i){this._bindParameters.multipassTerrain.cullAboveGround=i}_renderEdges(i,e){const t=this._edgeView;if(t!=null&&t.shouldRender()){const{width:r,height:s,depth:a}=this._offscreen,n=this.fboCache.acquire(Vt.RGBA,r,s),o=()=>t.render(this._bindParameters,i);this._offscreen.renderToTargets(o,n,e??a,hy),this._offscreen.compositeToFramebuffer(this._bindParameters,n.colorTexture,Li.Alpha,1),n.release()}}_renderShadowMap(i,e,t){const r=this._shadowMap;r.enabled&&(r.start(i,e,t,this.isFeatureEnabled(Ws.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(i,e),this._needsShadowHighlight?(this._renderShadowCascades(M.ShadowHighlight,this._shadowMap),r.moveSnapshot(tu.Highlight),r.clear(),this._renderShadowCascades(M.ShadowExcludeHighlight,this._shadowMap),r.copySnapshot(tu.Default),this._renderShadowCascades(M.ShadowHighlight,this._shadowMap)):this._renderShadowCascades(M.Shadow),r.finish(),i.setGLViewport(this._rctx))}_renderShadowCascades(i,e=this._shadowMap){for(const t of e.cascades)t.camera.setGLViewport(this._rctx),this._prepare(t.camera,t.camera),this._renderAllGeometry(i)}get _needsLinearDepth(){return this._renderPlugins.consumes(M.Depth)||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?(this._bindParameters.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.linearDepth,()=>this._renderAllGeometry(M.Depth),[0,0,0,0],Vt.RGBA,pr.DEPTH_STENCIL_BUFFER),this._bindParameters.linearDepth.releaseDepth(),this._offscreen.bindFbo()):this._bindParameters.linearDepth=et(this._bindParameters.linearDepth)}_renderTerrainLinearDepth(i){if(i){const e=this._renderContext.output;this._renderContext.output=M.Depth,this._bindParameters.multipassTerrain.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassTerrain.linearDepth,()=>this._renderTransparentTerrain(),[-1e10,-1e10,-1e10,1]),this._bindParameters.multipassTerrain.linearDepth.releaseDepth(),this._renderContext.output=e}else this._bindParameters.multipassTerrain.linearDepth=et(this._bindParameters.multipassTerrain.linearDepth)}_renderGeometryLinearDepth(i){if(!i)return void(this._bindParameters.multipassGeometry.linearDepth=et(this._bindParameters.multipassGeometry.linearDepth));const e=this._renderContext.output;return this._bindParameters.multipassGeometry.linearDepth=this._offscreen.renderToCachedFBO(this._bindParameters.multipassGeometry.linearDepth,()=>this._renderOpaqueGeometryAndTransparentMaterial(M.Depth),[1,1,1,1],Vt.RGBA,this._geometryLinearDepthFormat),this._renderContext.output=e,this._bindParameters.multipassGeometry.linearDepth.detachDepth()}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(i){if(!this._needsDepthRange)return r_;const e=gM(i,this._materialRenderers,this._stage.layers);return Ml(e,this._renderPlugins.queryDepthRange(i)),e.near=Math.max(i.near,e.near),e.far=Math.min(i.far,e.far),e}_renderAllGeometry(i){this._renderContext.output=i,this._renderPlugins.prepare($.TRANSPARENT_TERRAIN),this._renderOpaqueGeometryAndTransparentMaterial(i),this._renderTransparentTerrain()}_renderOpaqueGeometryAndTransparentMaterial(i){this._renderContext.output=i,this._renderPlugins.prepare($.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentMaterial()}_renderSSAO(){if(!this._renderPlugins.produces($.SSAO))return;const i=this._offscreen.renderToCachedFBO(null,()=>this._renderAllGeometry(M.Normal),[0,0,0,0],Vt.RGBA4,pr.DEPTH24_BUFFER);i.releaseDepth(),this._offscreen.bindFbo(),this._pluginInput.normal=i,this._bindParameters.ssao=this._renderPlugins.render($.SSAO,this._pluginInput),i.release()}_prepareOpaqueGeometrySlots(){this._renderPlugins.prepare($.INTEGRATED_MESH),this._renderPlugins.prepare($.OPAQUE_TERRAIN),this._renderPlugins.prepare($.OPAQUE_MATERIAL),this._renderPlugins.prepare($.ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,$.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderPlugins.render($.INTEGRATED_MESH),this._renderPlugins.render($.OPAQUE_TERRAIN),this._renderInternalSlot($.OPAQUE_MATERIAL),this._renderPlugins.render($.OPAQUE_MATERIAL)}_renderTransparentMaterial(){this._renderInternalSlot($.TRANSPARENT_MATERIAL),this._renderPlugins.render($.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){if(!this._renderPlugins.produces($.TRANSPARENT_TERRAIN))return;const i=()=>this._renderPlugins.render($.TRANSPARENT_TERRAIN,null);if(this._renderContext.output!==M.Color)return void i();const{width:e,height:t,depth:r}=this._offscreen,s=this.fboCache.acquire(Vt.RGBA,e,t);return this._offscreen.renderToTargets(i,s,r,[0,0,0,0]),s}_renderHUDVisibility(i){this._shouldRenderInternalSlot(this._materialRenderers,$.OCCLUSION_PIXELS)?(this._bindParameters.hudVisibility=this._offscreen.renderHUDVisibility(this._bindParameters.hudVisibility,()=>this._renderInternalSlot($.OCCLUSION_PIXELS),i),this._offscreen.bindFbo()):this._bindParameters.hudVisibility=et(this._bindParameters.hudVisibility)}_renderLineCallouts(i){if(this._bindParameters.hudRenderStyle=i,i===ua.Occluded){const e=()=>this._renderInternalSlot($.LINE_CALLOUTS),{width:t,height:r,color:s}=this._offscreen,a=this.fboCache.acquireDepth(pr.DEPTH16_BUFFER,t,r);this._offscreen.renderToTargets(e,s,a,void 0,!0,!0),a.release()}else this._renderInternalSlot($.LINE_CALLOUTS)}_renderLaserlines(){if(this._renderPlugins.render($.LASERLINES),this._renderPlugins.produces($.LASERLINES_CONTRAST_CONTROL)){const i=this._offscreen,{width:e,height:t,depth:r}=i,s=this.fboCache.acquire(Vt.RGBA,e,t),a=()=>this._renderPlugins.render($.LASERLINES_CONTRAST_CONTROL);i.renderToTargets(a,s,r,hy),i.compositeToFramebuffer(this._bindParameters,s.colorTexture,Li.PremultipliedAlpha,1),s.release()}}_renderHUD(i,e){if(this._materialRenderersHas.hudElements)if(this._oitEnabled){const t=this._renderOITPass(pl.HUD,i);this._rctx.bindFramebuffer(e==null?void 0:e.fbo),this._compositingHelper.composite(this._bindParameters,t.colorTexture,Li.PremultipliedAlpha),t.release()}else if(i===ua.Occluded){const t=()=>this._renderHUDElements(i),{width:r,height:s,color:a}=this._offscreen,n=this.fboCache.acquireDepth(pr.DEPTH16_BUFFER,r,s);this._offscreen.renderToTargets(t,a,n,void 0,!0,!0),n.release()}else this._rctx.bindFramebuffer(null),e==null||e.acquireDepth(pr.DEPTH16_BUFFER),this._rctx.bindFramebuffer(e==null?void 0:e.fbo),this._renderHUDElements(i),e==null||e.releaseDepth()}_renderHUDElements(i){this._bindParameters.hudRenderStyle=i,this._prepareInternalSlots(this._materialRenderers,$.LINE_CALLOUTS_HUD_DEPTH,$.HUD_MATERIAL,$.LABEL_MATERIAL),this._renderInternalSlot($.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot($.HUD_MATERIAL),this._renderInternalSlot($.LABEL_MATERIAL)}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._renderPlugins.produces($.SHADOW_HIGHLIGHT)&&this.hasShadowHighlights}_renderHighlights(i,e){if(!this.hasHighlights||e.decorations===js.OFF)return;const t=()=>{this._renderAllGeometry(M.Highlight),this._rctx.clearSafe(ii.DEPTH_BUFFER_BIT),this._renderHUDElements(ua.Both)},r=this._offscreen.renderToCachedFBO(null,t,[0,0,0,0],Vt.RGBA4,pr.DEPTH_STENCIL_BUFFER);r.releaseDepth(),this._needsShadowHighlight&&(this._pluginInput.highlight=r,this._renderPlugins.render($.SHADOW_HIGHLIGHT,this._pluginInput,i)),this._renderPlugins.produces($.HIGHLIGHT)&&(this._pluginInput.composite=null,this._pluginInput.normal=null,this._pluginInput.highlight=r,this._renderPlugins.render($.HIGHLIGHT,this._pluginInput,i)),r.release()}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_renderShadowAccumulation(i,e,t){var r;this._needsShadowCast&&((r=this._bindParameters.linearDepth)!=null&&r.colorTexture)&&this._shadowAccumulator.renderAccumulation(this._bindParameters.linearDepth,i,e,t)}_prepareTransparencySlots(){this._renderContext.output=M.Alpha,this._bindParameters.transparencyPassType=Jt.Alpha,this._prepareInternalSlots(this._materialRenderers,$.TRANSPARENT_MATERIAL),this._renderPlugins.prepare($.TRANSPARENT_MATERIAL),this._renderContext.output=M.Color,this._bindParameters.transparencyPassType=Jt.Color,this._prepareInternalSlots(this._materialRenderers,$.TRANSPARENT_MATERIAL),this._renderPlugins.prepare($.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Jt.FrontFace,this._prepareInternalSlots(this._materialRenderers,$.TRANSPARENT_MATERIAL),this._renderPlugins.prepare($.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=Jt.NONE}_renderOITPass(i,e=ua.Both){const t=i===pl.HUD,r=t?this.fboCache.acquire(Vt.RGBA,this._offscreen.width,this._offscreen.height):null,s=t?()=>this._renderHUDElements(e):()=>this._renderTransparentMaterial(),a=this._renderContext.output;this._renderContext.output=M.Alpha,this._bindParameters.transparencyPassType=Jt.Alpha;const n=this._offscreen.renderOITPass(s,Jt.Alpha,t);this._renderContext.output=M.Color,this._bindParameters.transparencyPassType=Jt.Color;const o=this._offscreen.renderOITPass(s,Jt.Color,t);this._bindParameters.transparencyPassType=Jt.FrontFace;const l=this._offscreen.renderOITPass(s,Jt.FrontFace,t);return this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,o,n,l,r),r==null||r.releaseDepth(),l.release(),o.release(),n.release(),this._bindParameters.transparencyPassType=Jt.NONE,this._renderContext.output=a,r}_renderOccluded(){let i=0;xr.clear(),this._materialRenderers.forAll(a=>{a.material&&a.material.isVisible()&&a.material.parameters.renderOccluded===er.OccludeAndTransparentStencil&&(i|=a.material.parameters.renderOccluded,xr.push(a))});const e=this._offscreen,t=(a,n,o,l,c)=>{if(!(i&n))return;const{width:d,height:p,depth:m}=e,g=this.fboCache.acquire(Vt.RGBA,d,p);e.renderToTargets(o,g,m,[0,0,0,0],l,c),e.compositeToFramebuffer(this._bindParameters,g.colorTexture,Li.PremultipliedAlpha,a),g.release()};xr.length!==0&&(this._prepareInternalSlots(xr,$.OCCLUDER_MATERIAL,$.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot($.OCCLUDER_MATERIAL,xr),t(.5,er.OccludeAndTransparentStencil,()=>this._renderInternalSlot($.TRANSPARENT_OCCLUDER_MATERIAL,xr),!1,!1)),xr.clear(),this._materialRenderers.forAll(a=>{a.material&&a.material.isVisible()&&(a.material.parameters.renderOccluded===er.OccludeAndTransparent||a.material.parameters.renderOccluded===er.Transparent||a.material.parameters.renderOccluded===er.Opaque)&&(i|=a.material.parameters.renderOccluded,xr.push(a))});const r=this._renderPlugins.renderOccludedFlags;if(i|=r,!i)return;const s=a=>{this._renderContext.renderOccludedMask=a,this._prepareInternalSlots(xr,$.OPAQUE_MATERIAL,$.TRANSPARENT_MATERIAL,$.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),r>er.Occlude&&this._renderPlugins.render($.OCCLUDED_TERRAIN),this._renderInternalSlot($.OPAQUE_MATERIAL,xr),this._renderInternalSlot($.TRANSPARENT_MATERIAL,xr),this._renderInternalSlot($.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,xr),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=M.Color,t(.5,er.OccludeAndTransparent,()=>s(er.OccludeAndTransparent),!0,Oc.OutlineVisualElementMask),t(.5,er.Transparent,()=>s(er.Transparent),!0,Oc.OutlineVisualElementMask),t(1,er.Opaque,()=>s(er.Opaque),!0,Oc.OutlineVisualElementMask),xr.clear()}_renderComposite(i,e){this._renderPlugins.consumes(M.CompositeColor)&&(this._pluginInput.composite=e);let t=null;const r=this._renderPlugins.produces($.COMPOSITE);r&&(t=this._renderPlugins.renderComposition($.COMPOSITE,this._pluginInput),this._pluginInput.composite=t);const s=this._renderPlugins.produces($.ANTIALIASING),a=this._renderPlugins.render(s?$.ANTIALIASING:$.BLIT,this._pluginInput,i);return r&&(t==null||t.release()),a}_prepare(i,e){this._needsTransparentPass=this._materialRenderers.some(t=>t.material.produces($.TRANSPARENT_MATERIAL,M.Color)),this._bindParameters.camera=i,this._bindParameters.contentCamera=e}_ensureBindParameters(i,e){this._bindParameters.camera=i,this._bindParameters.contentCamera=e;const t=this._renderContext.offscreenRenderingHelper;this._bindParameters.mainColor=t.colorTexture,this._bindParameters.mainDepth=t.depthTexture}_ensureBindParametersSSR(i){if(this._bindParameters.ssr.lastFrameColor){this._ssrEnableTime==null&&(this._ssrEnableTime=i),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Sc:(Zd(uy,this._bindParameters.camera.viewMatrix),Zd(dy,this._bindParameters.camera.projectionMatrix),jr(Wo,uy,dy),jr(Wo,this._renderContext.lastFrameCamera.viewMatrix,Wo),jr(Wo,this._renderContext.lastFrameCamera.projectionMatrix,Wo),this._reprojectionMatrix=Wo);const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,i-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Sc,this._ssrEnableTime=null}_shouldRenderInternalSlot(i,e){return this._bindParameters.slot=e,i.some(t=>t.prepareTechnique(this._renderContext)!=null)}_prepareInternalSlots(i,...e){for(const t of e)this._bindParameters.slot=t,i.forAll(r=>r.prepareTechnique(this._renderContext)!=null)}_renderInternalSlot(i,e=this._materialRenderers){this._bindParameters.slot=i,e.forAll(t=>{const r=t.prepareTechnique(this._renderContext);r&&t.renderNode(this._renderContext,r)})}get memoryInfo(){return{fbos:this.fboCache.usedMemory,vaos:this._materialRenderers.reduce((i,e)=>i+e.usedMemory,0),plugins:this._renderPlugins.usedMemory}}getMemoryForMaterial(i){if(i==null)return 0;const e=this._materialRenderers.find(t=>t.material===i);return(e==null?void 0:e.usedMemory)??0}get usedMemory(){var i;return this.fboCache.usedMemory+(((i=this.edgeView)==null?void 0:i.usedMemory)??0)+this._renderPlugins.usedMemory}get test(){const i=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{i._renderStateFeatures=op(),this._renderPlugins.renderFeatureChanged(),this._requestRender()},releaseGeometryLinearDepth(e){i._releaseGeometryLinearDepth=e??(t=>t==null?void 0:t.release()),i._geometryLinearDepthFormat=e?pr.DEPTH_STENCIL_TEXTURE:pr.DEPTH16_BUFFER},getFramebufferTexture:e=>{var t,r;switch(e){case ml.Color:return i._offscreen.colorTexture;case ml.LinearDepth:return(t=i._bindParameters.linearDepth)==null?void 0:t.colorTexture;case ml.ShadowMap:return i._shadowMap.depthTexture;case ml.HudVisibility:return(r=i._bindParameters.hudVisibility)==null?void 0:r.colorTexture}}}}};var pl,ml;h([u()],Cr.prototype,"_renderPlugins",void 0),h([u()],Cr.prototype,"_shadowAccumulator",void 0),h([u()],Cr.prototype,"_state",void 0),h([u()],Cr.prototype,"_renderStateFeatures",void 0),h([u({readOnly:!0})],Cr.prototype,"fullResolutionAtmosphere",null),h([u()],Cr.prototype,"_smaa",void 0),h([u()],Cr.prototype,"_blit",void 0),h([u({autoDestroy:!0})],Cr.prototype,"_edgeView",void 0),h([u()],Cr.prototype,"updating",null),h([u()],Cr.prototype,"isCameraFinal",null),Cr=h([N("esri.views.3d.webgl-engine.lib.Renderer")],Cr),function(i){i[i.Geometry=0]="Geometry",i[i.HUD=1]="HUD"}(pl||(pl={})),function(i){i[i.Color=0]="Color",i[i.LinearDepth=1]="LinearDepth",i[i.ShadowMap=2]="ShadowMap",i[i.HudVisibility=3]="HudVisibility"}(ml||(ml={}));const hy=[0,0,0,0],xr=new Et,dy=nt(),uy=nt(),Wo=nt();function JD(i){return e=>i.immediate.schedule(e)}let e8=class{constructor(e){this._rctx=e,this._vao=P3(e)}destroy(){this._vao=De(this._vao)}draw(){this._vao!=null&&(this._rctx.bindVAO(this._vao),this._rctx.drawArrays(fi.TRIANGLES,0,3))}get test(){var e,t,r,s;return{cachedWebGLObjects:am((e=this._vao)==null?void 0:e.glName)+am((r=(t=this._vao)==null?void 0:t.indexBuffer)==null?void 0:r.glName)+am((s=this._vao)==null?void 0:s.vertexBuffers.geometry)}}};function am(i){return i!=null?1:0}class t8 extends hS{constructor(e,t,r){super(e,t),this.gl=e,this.newCache=r,this._appleAmdDriverHelper=null,this._refCount=1,this.screen=new e8(this)}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose(),this.screen.destroy()}bindTechnique(e,t,r,s){return this.useProgram(e.program),this.setPipelineState(e.getPipeline(!!s)),e.program.bindPass(t,r),e.program}runAppleAmdDriverHelper(){this.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper??(this._appleAmdDriverHelper=new dS(this)),this._appleAmdDriverHelper.run())}get test(){var e;return{cachedWebGLObjects:this.programCache.test.cachedWebGLProgramObjects+this.screen.test.cachedWebGLObjects+(((e=this._appleAmdDriverHelper)==null?void 0:e.test.cachedWebGLObjects)??0)}}}function py(i){return!!i.frameUpdate}let sl=class extends ue{constructor(i,e,t){super({}),this._stage=i,this._techniqueRepository=e,this._rctx=t,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Xr,this._frameTask=i.view.resourceController.scheduler.registerTask(ci.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Vy.Texture,i=>i.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(S3,new R3)),this._textureTechnique}acquire(i){const e=this._textures.get(i);return e?(e.ref(),e.loadingPromise??e):this._createNewRef(i)}update(){let i=!1;this._frameUpdates.forEach(e=>{const t=e.texture.frameUpdate(e.previousToken);t>=0&&t!==e.previousToken&&(e.previousToken=t,i=!0)}),i&&this.events.emit("changed",Bt.BACKGROUND)}_createNewRef(i){const e=this._stage.getObject(i);if(e==null)return Gs(e!==void 0),null;const t=e.events.on("unloaded",()=>{t.remove(),this._onTextureUnloaded(i)}),r=new i8(i,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&e.unload()})});return this._textures.set(i,r),r.ref(),e.glTexture?(this._updateGLTexture(r,e.glTexture),py(e)&&this._frameUpdates.set(i,{texture:e,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=e.load(this._rctx),a=o=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,o),py(e)&&this._frameUpdates.set(i,{texture:e,previousToken:-1}),r),n=o=>(this._loadingCount--,r.loadingPromise=null,yn(o)||ce.getLogger(this).error(o),null);return b_(s)?s.then(a,n):a(s)}),r.loadingPromise)}_updateGLTexture(i,e){i.glTexture=e,this.events.emit("changed",Bt.UPDATE)}_onTextureUnloaded(i){this._textures.delete(i),this._frameUpdates.delete(i)}};h([u()],sl.prototype,"_loadingCount",void 0),h([u()],sl.prototype,"_frameTask",void 0),h([u()],sl.prototype,"updating",null),sl=h([N("esri.views.3d.webgl-engine.lib.TextureRepository")],sl);let i8=class{constructor(e,t){this.id=e,this._release=t,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ce.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function r8(i,e){return new O3(t=>E3(t,i),t=>t,e)}let Pc=class extends ue{constructor(){super(...arguments),this._passParameters=new s8,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=wo(this._resourcesTask),this._passParameters.waveNormal=De(this._passParameters.waveNormal),this._passParameters.wavePerturbation=De(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(i){return this._resourcesTask||(this._resourcesTask=xu(async e=>{await Promise.allSettled([this._loadImageResource(i,Hg("esri/images/materials/water/normals.jpg"),t=>this._passParameters.waveNormal=t,e),this._loadImageResource(i,Hg("esri/images/materials/water/perturbation.jpg"),t=>this._passParameters.wavePerturbation=t,e)])})),this._resourcesTask.finished?kg.LOADED:kg.LOADING}async _loadImageResource(i,e,t,r){try{const s=await th(e,{signal:r});fr(r);const a=new Yr(s.width,s.height);a.pixelFormat=$i.RGB,a.samplingMode=Da.LINEAR_MIPMAP_LINEAR,a.hasMipmap=!0,a.maxAnisotropy=8,t(new Hi(i,a,s))}catch(s){ce.getLogger(this).error("Failed to load water material normal texture.",s)}}};h([u()],Pc.prototype,"_resourcesTask",void 0),h([u({type:Boolean,readOnly:!0})],Pc.prototype,"updating",null),Pc=h([N("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],Pc);class s8 extends ti{}class a8{constructor(e,t,r){this.parameters=e,this.frameHasDecorations=t,this.fbos=r}}class n8{constructor(e,t,r){this._rctx=e,this._renderFunctions=t,this._forceCameraHook=r,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Bt.BACKGROUND);const t=gy();return this._screenshotQueue.push({settings:e,resolver:t}),t.promise}update(e,t){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const s={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},a=this._renderScreenshot(e,s,t);r.resolver(a)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,t,r){e.width=t.width,e.height=t.height;const s=e.getContext("2d"),a=r.pixelRatio;return s.save(),s.translate(0,t.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(a,a),t=this._renderFunctions.renderOverlay(e,r.disableDecorations?js.OFF:js.ON,t),s.restore(),t}_readbackScreenshot(e,t){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},t):this._readbackScreenshotImmediate(e,t)}_readbackScreenshotResampled(e,t){const{framebufferWidth:r,framebufferHeight:s,region:a,resample:n}=e,o=this._ensureScreenshotEncodeCanvas();let l=Ku(r,s,o);this._rctx.gl.readPixels(0,0,r,s,$i.RGBA,Ec.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),t(),l=this._renderScreenshotOverlay(o,l,{...e,region:void 0});const c=Ku(a.width,a.height,o);return BT(l,c,!0,n.region.x,s-(n.region.y+n.region.height),n.region.width,n.region.height)}_readbackScreenshotImmediate(e,t){const{framebufferHeight:r,region:s}=e,a=this._ensureScreenshotEncodeCanvas(),n=Ku(s.width,s.height,a);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,$i.RGBA,Ec.UNSIGNED_BYTE,new Uint8Array(n.data.buffer)),t(),this._renderScreenshotOverlay(a,n,e)}_renderScreenshot(e,t,r){const s=e.parameters.camera,a={width:t.framebufferWidth,height:t.framebufferHeight};$_(a,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let n=!1;const o=t.disableDecorations&&e.frameHasDecorations,l=a.width!==s.fullWidth||a.height!==s.fullHeight,c=t.ignorePadding&&s.pixelRatio!==t.pixelRatio,d=l||o||c||t.objectAndLayerIdColor;let p=null;t.objectAndLayerIdColor&&(p=e.fbos.acquire(Vt.RGBA,a.width,a.height),p.acquireDepth(pr.DEPTH_STENCIL_BUFFER));let m=null;if(d){const v=s.clone();if(t.ignorePadding){const P=By(v.padding);for(let R=0;R<4;R++)P[R]=Math.round(P[R]/v.pixelRatio*t.pixelRatio);v.padding=P}v.fullWidth=a.width,v.fullHeight=a.height,v.pixelRatio=t.pixelRatio;const T=s.fovX-v.fovX,w=s.fovY-v.fovY;T<0&&T<w?v.fovX=s.fovX:w<0&&w<T&&(v.fovY=s.fovY);const x={camera:v,contentCamera:v,mode:Ui.IDLE,alignPixelEnabled:!0,contentPixelRatio:v.pixelRatio};this._forceCameraHook(x),n=!0,m=e.fbos.acquire(Vt.RGBA,a.width,a.height);const C=t.disableDecorations?js.OFF:js.ON;this._renderFunctions.renderScene(m,p,x,C,r)}const g=()=>{this._rctx.bindFramebuffer(null),m==null||m.release()};this._rctx.bindFramebuffer(m==null?void 0:m.fbo);const f=this._readbackScreenshot(t,g);let y=null;if(t.objectAndLayerIdColor){const v=()=>{this._rctx.bindFramebuffer(null),p==null||p.release()};this._rctx.bindFramebuffer(p==null?void 0:p.fbo),y=this._readbackScreenshot(t,v),this._rctx.bindFramebuffer(null)}if(d&&!this._rctx.contextAttributes.alpha)for(let v=3;v<f.data.length;v+=4)f.data[v]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let v=3;v<y.data.length;v+=4)y.data[v]=255;return n&&this._forceCameraHook(e.parameters),[f,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}let ui=class extends ue{constructor(i){super({}),this.events=new Xr,this.waterTextureRepository=new Pc,this._magnifierHelper=new tl,this.objectAndLayerIdRenderHelper=li("enable-feature:objectAndLayerId-rendering")?new MM:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=i.container,this._viewingMode=i.viewingMode,this._initializeContext(i),this.addHandles([D(()=>{var r;return(r=this.waterTextureRepository)==null?void 0:r.updating},()=>this.requestRender(),si),D(()=>i.view.qualityProfile,r=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeatures(r)},yt),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:e}=i.view.resourceController;this.stippleTextureRepository=A3(this._rctx,e),this.markerTextureRepository=r8(this._rctx,e),this._shaderTechniqueRepository=new M3({rctx:this._rctx,viewingMode:i.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new sl(i,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",r=>this.requestRender(r))),this._materialRepository=new D3(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new hM(this._rctx,this._shaderTechniqueRepository),this.renderer=new Cr(i,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,r=>this.requestRender(r));const t={renderScene:(r,s,a,n,o)=>this.renderer.render(r,s,a,n,o),requestRenderScene:r=>this.requestRender(r),prepareOverlay:()=>i.options.screenshot.prepareOverlay(),renderOverlay:(r,s,a)=>i.options.screenshot.renderOverlay(r,s,a)};this._screenshotManager=new n8(this._rctx,t,r=>this.events.emit("force-camera-for-screenshot",r)),this._registerFrameTask(i)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Fa(this._frameTask),this._shaderTechniqueRepository=re(this._shaderTechniqueRepository)}requestRender(i=Bt.UPDATE){this._needsRender=!0,i===Bt.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(i){this._magnifierHelper.magnifier=i}setIdleSuspend(i){this._idleSuspend!==i&&(this._idleSuspend=i,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(i){return this._screenshotManager.takeScreenshot(i).then(e=>e[0])}takeScreenshotWithOID(i){return i.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(i)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(i,e,t,r,s,a=s){const n=r.constrainWindowSize(e,t,s*r.pixelRatio,a*r.pixelRatio),o=this._ensureDepthBuffer(n);this.renderer.readDepthPixels(r,n,o);let l=Number.MAX_VALUE;for(let c=0;c<n[2]*n[3];c++){const d=_M(4*c,o,r.nearFar);l>d&&d!==r.nearFar[0]&&d!==r.nearFar[1]&&(l=d)}if(i){const c=i.pickDepth(e*r.pixelRatio,t*r.pixelRatio,r);c!=null&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(i){const e=4*i[2]*i[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<e)&&(this._tmpDepthBuffer=new Uint8Array(e)),this._tmpDepthBuffer}async reloadShaders(){tw(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(i){const e=i.view.state;let t=!1,r=Bt.BACKGROUND,s=!1;const a={preRender:({time:n})=>{t=this.updating,r=this._needsUpdate?Bt.UPDATE:Bt.BACKGROUND,i.commitSyncLayers();const o=Oe(n-this._lastAnimationUpdate);if(o>this.renderer.animationTimestep||e.forcedAnimationTime!=null||t||this._needsRender){const l=Oe(o/this.renderer.animationTimeDilation),c=new Cv(e.camera,l,e.forcedAnimationTime);this.renderer.updateAnimation(c)&&this.requestRender(Bt.BACKGROUND),this._lastAnimationUpdate=n}},render:({time:n})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&e.camera.fullWidth>0&&e.camera.fullHeight>0){const o=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,e,js.ON,n),s=!0,o&&this.renderer.hasReflections&&(this.requestRender(Bt.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:n})=>{const o=this.renderer.hasSlicePlane||this._magnifierHelper.enabled||this.renderer.hasDecorations||this.renderer.hasHighlights,l=new a8(e,o,this.renderer.fboCache);this._textureRepository.update(),this._screenshotManager.update(l,n)},finish:()=>{s&&(this.renderer.finish(e.mode===Ui.IDLE?r:Bt.UPDATE),s=!1)}};this._frameTask=Ou(a)}_initializeContext(i){const e=i.options;this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:e.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:e.preserveDrawingBuffer??!1},r=uS("3d",this._canvas,t);r!=null&&pS(r)?(this._rctx=this._newRenderingContext(r,i),this._loadShaderOnlyExtensions(),!e.alpha&&this._rctx.contextAttributes.alpha&&ce.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&li("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ce.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(i,e){const t={disabledExtensions:e.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:e.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,a)=>e.view.resourceController.memoryController.newCache(s,a);return new t8(i,t,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(i){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(i):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new iM(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(i){this._componentObjectCollection=i}};h([u({type:Boolean,readOnly:!0})],ui.prototype,"updating",null),h([u({autoDestroy:!0})],ui.prototype,"_rctx",void 0),h([u({autoDestroy:!0})],ui.prototype,"_container",void 0),h([u({autoDestroy:!0})],ui.prototype,"_canvas",void 0),h([u({autoDestroy:!0})],ui.prototype,"stippleTextureRepository",void 0),h([u({autoDestroy:!0})],ui.prototype,"markerTextureRepository",void 0),h([u({autoDestroy:!0})],ui.prototype,"waterTextureRepository",void 0),h([u({autoDestroy:!0})],ui.prototype,"_magnifierHelper",void 0),h([u({readOnly:!0})],ui.prototype,"objectAndLayerIdRenderHelper",void 0),h([u({autoDestroy:!0})],ui.prototype,"_textureRepository",void 0),h([u({autoDestroy:!0,readOnly:!0})],ui.prototype,"renderer",void 0),h([u({autoDestroy:!0})],ui.prototype,"_screenshotManager",void 0),h([u()],ui.prototype,"componentObjectCollection",null),h([u({autoDestroy:!0})],ui.prototype,"_componentObjectCollection",void 0),h([u()],ui.prototype,"_needsUpdate",void 0),h([u()],ui.prototype,"_needsWaterReflectionUpdate",void 0),ui=h([N("esri.views.3d.webgl-engine.parts.RenderView")],ui);let Pr=class extends ue{constructor(e){super(e),this._model=new Fd,this._layers=new Et,this._asyncChangeSet=new vf,this._syncChangeSet=new vf,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ui(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(ci.STAGE,this),this.addHandles(this._frameTask)}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),eu(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e!=null&&!this.destroyed&&this._model.remove(e)&&(eu(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var t,r;e!=null&&((t=this._model)==null||t.removeMany(e),(r=this.renderView)==null||r.requestRender())}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const t=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const s=this._layerSyncSet.has(r.id)||r.updatePolicy===ap.SYNC,a=s?this._syncChangeSet:this._asyncChangeSet;t.commitLayer(r.id,a),this._layerSyncSet.delete(r.id),a.empty||(this.renderer.modify(a,s?Bs:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Bs),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==ap.ASYNC||(t.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{this._layerSyncSet.has(t.id)||t.updatePolicy===ap.SYNC?(e.commitLayer(t.id,this._syncChangeSet),this._layerSyncSet.delete(t.id)):e.commitSyncUpdates(t.id,this._syncChangeSet)});for(const t of this._layerSyncSet)e.commitLayer(t,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Bs),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Bs),this.renderView.requestRender())}schedule(e,t){return this._frameTask.schedule(e,t)}reschedule(e,t){return this._frameTask.reschedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Bs))}addRenderPlugin(e,t){const r=this.renderer.renderPlugins.add(e,t),s=()=>{j0(e)&&this.view.sceneIntersectionHelper.addIntersectionHandler(e)};if(b_(r))return r.then(s);s()}removeRenderPlugin(e){this.destroyed||(j0(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return this._model.getStats()}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(r=>r.type===t).length,model:e._model}}};Pr.DebugSettings={endFrameContentValidation:!1},h([u({constructOnly:!0})],Pr.prototype,"view",void 0),h([u({constructOnly:!0})],Pr.prototype,"options",void 0),h([u({readOnly:!0})],Pr.prototype,"viewingMode",null),h([u({constructOnly:!0})],Pr.prototype,"container",void 0),h([u({readOnly:!0})],Pr.prototype,"updating",null),h([u({constructOnly:!0})],Pr.prototype,"_model",void 0),h([u({autoDestroy:!0})],Pr.prototype,"renderView",void 0),h([u({readOnly:!0})],Pr.prototype,"renderer",null),h([u({readOnly:!0})],Pr.prototype,"running",null),Pr=h([N("esri.views.3d.webgl-engine.Stage")],Pr);let Bd=class extends jy{constructor(i){super(i),this.components=["attribution","zoom","navigation-toggle","compass"]}};h([u()],Bd.prototype,"components",void 0),Bd=h([N("esri.views.ui.3d.DefaultUI3D")],Bd);const Ax=Bd;let X=class extends HT(kT(GT(ZT))){constructor(i){super(i),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Tn({slicePlane:OT},this),this._resourceController=ZO(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Zm({view:this}),this.labeler=new Qn({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new Wy,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new eo,this.environmentManager=new is,this.floors=new ho,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new vS({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new UO,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new Ax,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new Yb,K2(),i!=null&&i.environment||(this._defaults.environment=new Jo,this.environment=this._defaults.environment);const e=(t=null)=>{t!=null&&t.type===Zg.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([Oa(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",t=>e(t),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",t=>this._updateUpdatingMonitors(t)),D(()=>this.map,t=>{t&&"load"in t&&t.load&&t.load().catch(()=>{})})]),this.inputManager=new Y4({view:this}),this.stateManager=new Kt({view:this})}initialize(){this.groundView=new fS({view:this}),this._updateUpdatingMonitors();const i=()=>this._updateDefaultToMapOptions();this.addHandles(Oa(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",i,{onListenerAdd:i,onListenerRemove:i})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},si),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},si),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>J2(e>0?1e3/Math.ceil(e):0),si),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},i,yt),this.updatingHandles.add(()=>{var e,t;return(t=(e=this.map)==null?void 0:e.ground)==null?void 0:t.opacity},()=>this._updateDefaultHitTestOptions(),yt),this.addHandles(D(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),at))}destroy(){var i;this.destroyed||(this.updatingHandles.removeAll(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=re(this.sharedSymbolResources),this._set("labeler",re(this.labeler)),this._set("deconflictor",re(this.deconflictor)),this._resourceController=re(this._resourceController),this._set("stateManager",re(this.stateManager)),this._set("inputManager",re(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",re(this.environmentManager)),this._set("environment",re(this.environment)),this.groundView=re(this.groundView),this._exitBasemapTerrain(),(i=this._stage)==null||i.destroy())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var i;return(i=this.basemapTerrain)==null?void 0:i.spatialReference}get animation(){var i;return(i=this.state)==null?void 0:i.animation}get camera(){var i;return(i=this.stateManager)==null?void 0:i.camera}set camera(i){this.stateManager&&(this.stateManager.camera=i)}get contentCamera(){var i;return(i=this.stateManager)==null?void 0:i.contentCamera}set contentCamera(i){this.stateManager&&(this.stateManager.contentCamera=i)}installContentCameraReset(i={sticky:!1}){return this.stateManager.installContentCameraReset(i)}get center(){var i;return(i=this.stateManager)==null?void 0:i.center}set center(i){this.stateManager&&(this.stateManager.center=i)}get clippingArea(){if(this.viewingMode==="global")return null;const i=this.map;let e=this._userClippingArea||Gg(i,"clippingArea");return!this._userClippingArea&&!Gg(i,"clippingEnabled")||e==null?(this._clippingArea=null,null):e instanceof Us?this.spatialReference&&(e=gd(e,this.spatialReference),e==null)?(ce.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),e.intersection(this._groundAndLayersExtent)==null&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ce.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(i){this.ready&&this.viewingMode==="global"&&i!=null?ce.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=i}get renderDataExtent(){if(this.state.viewingMode===Ne.Global)return null;const i=this.renderSpatialReference,e=this.dataExtent;return e==null||i==null||e.spatialReference.equals(i)?e:gd(e,i)}get dataExtent(){let i=this._groundAndLayersExtent;const e=this.spatialReference||_i.WGS84,t=gd(this.clippingArea,e);t!=null&&(i=i!=null?i.intersection(t):t);const r=this._get("dataExtent");return i!=null&&i.equals(r)?r:i}get _groundAndLayersExtent(){const i=this.spatialReference||_i.WGS84;let e;const t=a=>{const n=gd(a,i);n!=null&&(e!=null?e.union(n):e=n.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const a=r.groundExtent;t(new Us({xmin:a[0],ymin:a[1],zmin:0,xmax:a[2],ymax:a[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const a=n=>{n.fullExtent==null||n.type==="graphics"&&n.internal||t(n.fullExtent)};this.map.allLayers.forEach(n=>a(n))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const s=this._get("_groundAndLayersExtent");return e.equals(s)?s:e}set environment(i){i!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",i)}castEnvironment(i){return i?i instanceof Jo?i:i instanceof tv?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(i):Jo.fromWebsceneEnvironment(i):eT(Jo,i):new Jo}get extent(){var i;return(i=this.stateManager)==null?void 0:i.extent}set extent(i){this.stateManager&&(this.stateManager.extent=i)}get screenCenter(){var i;return(i=this.stateManager)==null?void 0:i.screenCenter}get frustum(){var i;return(i=this.stateManager)==null?void 0:i.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var i;return this.navigating||(((i=this.toolViewManager)==null?void 0:i.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var i;return((i=this.state)==null?void 0:i.navigating)??!1}get padding(){var i;return(i=this.stateManager)==null?void 0:i.padding}set padding(i){this.stateManager&&(this.stateManager.padding=i)}set qualityProfile(i){Ad.isValidProfile(i)&&(Ad.apply(i,this.qualitySettings),this._set("qualityProfile",i))}get qualityProfile(){return this._get("qualityProfile")||Ad.getDefaultProfile()}set slicePlane(i){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:i}),i==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");w_(i,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?AT(this.scale,this.spatialReference):0}get scale(){var i;return(i=this.stateManager)==null?void 0:i.scale}set scale(i){this.stateManager&&(this.stateManager.scale=i)}get heightModelInfo(){const i=this.getDefaultHeightModelInfo();return i!=null?oT.deriveUnitFromSR(i,this.spatialReference):null}get updating(){var s,a,n,o;if(this.destroyed)return!1;let i=0,e=this.layerViewManager.updating,t=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(l=>{if(l.isFulfilled()){if(l.updating){if(e=!0,l.suspended||Kc(l))return;++t,i+=l.updatingProgress}}else++t});for(const l of this._updatingObjects)l!=null&&l.updating&&(t+=.1,i+=.5*.1);for(const l of this._updatingObjectsWithProgress)l!=null&&l.updating&&(++t,i+=l.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||t>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(s=this.inputManager)!=null&&s.updating||(n=(a=this.map)==null?void 0:a.allLayers)!=null&&n.some(l=>!l.isFulfilled())||(o=this.textures)!=null&&o.updating),e?(this._numUpdating=Math.max(t,this._numUpdating),i+=this._numUpdating-t):this._numUpdating=0,this._numUpdating>0?i/=this._numUpdating:i=e?0:1,this._get("updatingProgress")!==i){const l=performance.now();if(i<1){const c=Math.min((l-this._lastUpdateTime)/2e3,1);i=this.updatingProgress*(1-c)+i*c}this._set("updatingProgress",i),this._lastUpdateTime=e&&i<1?l:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var t;const i=this._predeterminedViewingMode;if(i!=null)return rp(i);const e=this.spatialReference;return e?((t=this.defaultsFromMap)==null?void 0:t.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?rp(this.defaultsFromMap.viewingMode):Lf(e,Ne.Global)?"global":"local":"global"}set viewingMode(i){this.ready?ce.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",i)}get viewpoint(){var i;return(i=this.stateManager)==null?void 0:i.viewpoint}set viewpoint(i){this.stateManager&&(this.stateManager.viewpoint=i)}get zoom(){return this.stateManager.zoom}set zoom(i){this.stateManager&&(this.stateManager.zoom=i)}get resourceController(){return this._resourceController}get quality(){var i,e;return((e=(i=this._resourceController)==null?void 0:i.memoryController)==null?void 0:e.memoryFactor)??1}get resolutionScale(){return Math.sqrt(Math.min(1,this.quality/.75))}get performanceInfo(){return new JO(this)}on(i,e,t,r){return this.viewEvents.on(i,e,t,r)||super.on(i,e)}hasEventListener(i){return super.hasEventListener(i)||this.viewEvents.hasHandler(i)}toMap(i,e){if(!this.ready)return ce.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const t=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=t.graphics!=null&&(t.graphics.include!=null||t.graphics.exclude!=null),s=Pf(i)?Sf(this,i):i,a=zs(s);t.enableDraped=t.include&&!t.include.has(sn)||t.exclude&&t.exclude.has(sn);const n=this.sceneIntersectionHelper,o=xs(this.state.viewingMode);if(o.options.selectionMode=!0,o.options.store=r?Xs.ALL:Xs.MIN,n.intersectIntersectorScreen(a,o,t),r){for(const l of o.results.all){const c=Of(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(t.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(o.results.min)}toScreen(i){if(!this.ready)return ce.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(i.z==null?Rf(this.elevationProvider,i):null)??0;return Wd(i,Qo,this.renderSpatialReference,e),this.state.camera.projectToScreen(Qo,nm),Cy(nm[0],nm[1])}pixelSizeAt(i){return this.ready?i?(Wd(i,Qo,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Qo)):0:(ce.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(i){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(i,()=>this.pixelSizeAt(i)):1}hitTest(i,e){if(!this.ready)return ce.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const t=Pf(i)?Sf(this,i):i,r=Dt(t.x,t.y),s=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const a=xs(this.state.viewingMode);a.options.selectionMode=!0,a.options.store=Xs.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,a,s);const n=this._intersectResultsToHits(a.results.all,s.graphics),o=a.results.ground,l=Ef(o,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,d={screenPoint:t,results:n,ground:{mapPoint:this._intersectResultToMapPoint(o),distance:Mv(o)?o.distanceInRenderSpace:0,layer:c}};return ki.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(d.intersector=a),Promise.resolve(d)}async popupHitTest(i){const{results:e,ground:t}=await mS(this,i);let r=null;return!(e.length===0||Math.abs((e[0].distance??0)-t.distance)<1e-5)||t.layer&&t.layer.type==="integrated-mesh"||(r=t.mapPoint),{results:e,screenPoint:i,mapPoint:r}}goTo(i,e){return this.updatingHandles.addPromise(this.stateManager.goTo(i,e))}async whenAnalysisView(i){if(i.parent==null)throw new Mr("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:i});switch(i.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(i.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(i)}}whenLayerView(i){return super.whenLayerView(i)}async takeScreenshot(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshot(e);return ep(t,e,this._pixelFormat())}async _takeScreenshot(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshot(e);return tp(t,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(i){const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshotWithOID(e);return[tp(t[0],this._pixelFormat()),tp(t[1],this._pixelFormat())]}_completeSettings(i){const e=jT(i,this);return e.pixelRatio/=this.state.pixelRatio,WT(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:i=>this._takeScreenshot(i),takeScreenshotWithObjectAndLayerId:i=>this._takeScreenshotWithObjectAndLayerId(i)}}async takeScreenshotWithObjectAndLayerId(i){if(!li("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(i);await this.whenReady();const t=await this._stage.renderView.takeScreenshotWithOID(e),r=ep(t[0],e,this._pixelFormat()),s=this._completeSettings(i);return s.format="png",[r,ep(t[1],s,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(i){return this.updatingHandles.addPromise(i)}importLayerView(i){return Nf.importLayerView(i)}hasLayerViewModule(i){return Nf.hasLayerViewModule(i)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var i,e,t;return this.map&&"initialViewProperties"in this.map&&((i=this.map.initialViewProperties)==null?void 0:i.spatialReference)||((e=this.defaultsFromMap)==null?void 0:e.spatialReference)||((t=this.defaultsFromMap)==null?void 0:t.ready)&&this._initialDefaultSpatialReference||null}async validate(){let i=QT(this.type);const e=li("safari");if(e&&e<9&&(i=new Mr("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),i!=null)throw ce.getLogger(this).warn("#validate()",i.message),i}get _predeterminedViewingMode(){var e;const i=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return i!=null?df(i):null}getSpatialReferenceSupport({spatialReference:i,layer:e}){const t=this._predeterminedViewingMode;if(t!=null)return this._validateSpatialReferenceForViewingMode(i,e,t)?{constraints:this._makeSpatialReferenceConstraints(i,e,t)}:null;const r=this._validateSpatialReferenceForViewingMode(i,e,Ne.Local),s=this._validateSpatialReferenceForViewingMode(i,e,Ne.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(i,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(i,e,Ne.Local)}:{constraints:this._makeSpatialReferenceConstraints(i,e,Ne.Global)}:null}_validateSpatialReferenceForViewingMode(i,e,t){return!!Lf(i,t)&&(e==null||!!jg(e)||(!Rc(e)||Du(e,i,t)!=null)&&(!Wg(e)||t!==Ne.Global))}_makeSpatialReferenceConstraints(i,e,t){if(e==null)return[{spatialReference:i,viewingMode:t}];const r=i.isWebMercator,s=i.isWGS84;return jg(e)&&(r||s)?!s||t===Ne.Local||OC(e.tileInfo,e.fullExtent,i,Ne.Global)===null?[{spatialReference:i,viewingMode:t},{spatialReference:_i.WebMercator,viewingMode:t}]:[{spatialReference:r?_i.WGS84:_i.WebMercator,viewingMode:t}]:Rc(e)||Wg(e)||!r&&!s?Rc(e)&&r&&t!==Ne.Global?[{spatialReference:i,viewingMode:t},{spatialReference:_i.WGS84,viewingMode:Ne.Local}]:[{spatialReference:i,viewingMode:t}]:[{spatialReference:i,viewingMode:t},{spatialReference:r?_i.WGS84:_i.WebMercator,viewingMode:t}]}_validateSpatialReference(i){const e=this.getSpatialReferenceSupport({spatialReference:i})!=null,t=this._predeterminedViewingMode;return e||(t!=null?ce.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${rp(t)} viewing mode.`):i.isGeographic&&ce.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(i=>{this.ready?i(this):this._resolveWhenReady.push(i)})}computeMapPointFromVec3d(i,e){let t=this.spatialReference||_i.WGS84;return Aa(i,this.renderSpatialReference,i,t)||(t=_i.WGS84,Aa(i,this.renderSpatialReference,i,t)),e?(e.x=i[0],e.y=i[1],e.z=i[2],e.spatialReference=t):e=new Qr(i,t),e}trackGraphicState(i){if(!i.graphic)return ce.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(i.graphic);let t=null,r=!1;const s=a=>{var n;!r&&a!=null&&"processor"in a&&((n=a.processor)==null?void 0:n.type)==="graphics-3d"&&a.processor.graphicsCore&&(t=a.processor.graphicsCore.trackGraphicState(i))};return e!=null?s(e):this.whenViewForGraphic(i.graphic,{waitForLayer:!0}).then(a=>s(a),()=>{}).catch(()=>{}),dn(()=>{r=!0,t!=null&&(t.remove(),t=null)})}highlight(i){if(Array.isArray(i))return Qg(i.map(t=>this.highlight(t)));if(ho.isCollection(i))return Qg(i.toArray().map(t=>this.highlight(t)));const e=this.getViewForGraphic(i);return e&&"highlight"in e?e.highlight(i):dn()}maskOccludee(i){if(!i)return ce.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(i);let t=null,r=!1;const s=a=>{!r&&a!=null&&_S(a)&&(t=a.maskOccludee(i))};return e!=null?s(e):this.whenViewForGraphic(i,{waitForLayer:!0}).then(a=>s(a),()=>{}).catch(()=>{}),dn(()=>{r=!0,t!=null&&(t.remove(),t=null)})}getViewForGraphic(i){return i.layer===this.graphics?this.graphicsView:i.layer?this.allLayerViews.find(e=>e.layer===i.layer):null}graphicChanged(i){this.graphicsView!=null&&this.graphicsView.graphicChanged(i)}async whenViewForGraphic(i,e){if(i.layer===this)return await cm(()=>this.graphicsView),this.graphicsView;if(!i.layer||!this.map)throw new Mr("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(i.layer)?new Promise((t,r)=>{const s=this.map.allLayers.on("change",a=>{a.added.includes(i.layer)&&(s.remove(),this.whenLayerView(i.layer).then(t,r))})}):this.whenLayerView(i.layer)}externalToInternalIntersectOptions(i){const e=this._externalToInternalRenderItems(i.include,qc.INCLUDE),t=this._externalToInternalRenderItems(i.exclude,qc.EXCLUDE);return{include:e.layerUids,exclude:t.layerUids,graphics:{include:e.graphicUids,exclude:t.graphicUids}}}_intersectResultToMapPoint(i,e){return i.getIntersectionPoint(Qo)?(e=this.computeMapPointFromVec3d(Qo,e),i.intersector===va.TERRAIN&&this.basemapTerrain&&(e.z=Rf(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(i,e){const t=new Array;let r=null;for(let s=0;s<i.length;s++){const a=i[s],n=Ef(a,this);if(n!=null&&(n===this.map.ground||"type"in n&&n.type==="integrated-mesh"))break;const o=Of(a,this);if(o==null)continue;if(o.type==="graphic"){if(r==null&&s!==i.length-1&&(r=new Set),r!=null){const d=this._getGraphicFilterUid(o.graphic);if(r.has(d))continue;r.add(d)}if(!this._testGraphicUidFilter(e,o.graphic))continue}const l=this._intersectResultToMapPoint(a),c=a.distanceInRenderSpace;if(o.type==="media"){const d=o.element.toSource(l);t.push({...o,mapPoint:l,distance:c,sourcePoint:d})}else t.push({...o,mapPoint:l,distance:c})}return t}_getGraphicFilterUid(i){var s;const e=i.sourceLayer,t=i.layer,r=e&&"objectIdField"in e?e:t&&"objectIdField"in t?t:e;if(r){const a=r.objectIdField??MT,n=(s=i.attributes)==null?void 0:s[a];if(n)return`o-${r.id}-${n}`}return`u-${i.uid}`}_testGraphicUidFilter(i,e){const t=this._getGraphicFilterUid(e);return i==null||(i.include==null||i.include.has(t))&&(i.exclude==null||!i.exclude.has(t))}_externalToInternalRenderItems(i,e,t={layerUids:void 0,graphicUids:void 0}){if(!i)return t;if(i instanceof Dy)o8(t,this._getGraphicFilterUid(i)),e===qc.INCLUDE&&(this.graphicsView!=null&&i.layer===this?sc(t,this.graphicsView.processor.layer.id):i.layer&&sc(t,i.layer.uid));else if(tT(i))for(const r of i)r===this.graphics&&this.graphicsView!=null?sc(t,this.graphicsView.processor.layer.id):r===this.map.ground?sc(t,sn):this._externalToInternalRenderItems(r,e,t);else"uid"in i&&sc(t,i.uid);return t}_initBasemapTerrain(){this._set("basemapTerrain",new u9({view:this})),this._set("elevationProvider",new fc({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Ji({view:this})),this._set("featureTiles",new pi({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const i=()=>{var t;const e=(t=this.basemapTerrain)==null?void 0:t.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?Hy(_y(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>ki.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(ie(()=>import("./FeatureTileTree3DDebugger-b881d387.js"),["assets/FeatureTileTree3DDebugger-b881d387.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/UpdatingHandles-7949a657.js","assets/TileTreeDebugger-7b374a11.js"])).then(({FeatureTileTree3DDebugger:t})=>{!this._featureTreeDebugger&&ki.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new t({view:this}))}):e||!this._featureTreeDebugger||ki.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},yt),this.updatingHandles.add(()=>this.clippingArea,i,yt),this.updatingHandles.add(()=>this.basemapTerrain.extent,i,yt)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const i=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(i)||this._set("mapCoordsHelper",new HO(this.map,i));const e=this.state.isGlobal,t=ET(e,i);t!==this.renderSpatialReference&&(this._set("renderCoordsHelper",AP.create(this.state.viewingMode,t)),e||this.addHandles(D(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!Gy(r,this.basemapTerrain.spatialReference,my,s)||(this.renderCoordsHelper.extent=my)},at),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(ru/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(i=null){i!=null&&i.type===Zg.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(D(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),at),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(i,e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const r=i.getContext("2d");return r.putImageData(t,0,0),this.overlay.renderCanvas(i,{disableDecorations:e===js.OFF}),r.getImageData(0,0,t.width,t.height)}_initStage(){const i={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(r,s,a)=>this._renderScreenshotOverlay(r,s,a)}},e=new zO(this.state.viewingMode,r=>this._stage.layers.forAll(r),this);this._set("sceneIntersectionHelper",e);const t=nT(this.surface);this._stage=new Pr({view:this,options:i,container:t}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,r=>this._stage.renderer.setParameters({highQualityTransparency:r}),si),D(()=>this.magnifier,r=>this._stage.renderView.magnifier=r,yt),this.on("pointer-move",()=>{var r;return(r=this._stage)==null?void 0:r.renderer.resetAnimation()}),iT(this._stage.renderView.canvas,"webglcontextlost",r=>this.fatalError=new Mr("webgl-context-lost",r.statusMessage))],"stage"),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(ru/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=re(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(i){this._exitSurface(),this.state.init(i,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new iE({view:this,viewingMode:i,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const i=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(i,i),this._updatingChanged()}async _createGraphicsViewAsync(i){const e=(await ie(()=>import("./GraphicsView3D-0c6ed216.js"),["assets/GraphicsView3D-0c6ed216.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/GraphicsProcessor-c903d185.js","assets/UpdatingHandles-7949a657.js","assets/hydratedFeatures-2365c307.js","assets/dehydratedPoint-5a1dfed5.js","assets/ElevationQuery-a3eaf0a0.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/frustum-f9d53cdf.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/vec2f32-eaf29605.js","assets/ColorMaterial-bdf1f62a.js","assets/VerticalOffset.glsl-5743f98e.js","assets/dehydratedFeatures-2a3f0608.js","assets/quantizationUtils-17105106.js","assets/featureConversionUtils-09cf00ff.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/OptimizedGeometry-196224d4.js","assets/edgeUtils-6e4a97fb.js","assets/SnappingCandidate-970faec6.js","assets/objectResourceUtils-003803db.js","assets/devEnvironmentUtils-4eab2a99.js","assets/DefaultMaterial_COLOR_GAMMA-101ea40c.js","assets/Version-1f969b2a.js","assets/resourceUtils-1d03d2fe.js","assets/mat3f32-6c416b1c.js","assets/symbolColorUtils-3ca646c8.js","assets/callExpressionWithFeature-36423058.js","assets/lineStippleUtils-0688e06c.js","assets/projectVectorToDehydratedPoint-e30a7ff8.js","assets/interfaces-1a80c8eb.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/Intersector-a291e778.js","assets/fontUtils-56b88a2f.js","assets/projectVectorToVector-56c29b20.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/Graphics3DObjectStates-511adea3.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/HeatmapColorStop-3fff4333.js","assets/heatmapUtils-7f42325f.js","assets/rendererConversion-b2429202.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/optimizedFeatureQueryEngineAdapter-1fecea41.js","assets/PooledRBush-fa11eac4.js","assets/quickselect-bc0541de.js","assets/screenUtils-8dc4a7f9.js","assets/popupUtils-e4ebc84a.js","assets/layerViewUtils-6ebe90f4.js"])).default;fr(i),await cm(()=>{var t;return(t=this.basemapTerrain)==null?void 0:t.ready},i),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){var t;const i=df(this.viewingMode);if(i===Ne.Global&&(this._clippingArea=null),this._initSurface(i),this._set("ready",!0),this.addHandles(Oa(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const{map:r}=this,s=r&&"initialViewProperties"in r?(t=r.initialViewProperties)==null?void 0:t.environment:void 0;s&&(this.environment=s)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect(),this._set("textures",new dl(this._stage,this.resourceController.scheduler));const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._set("textures",re(this.textures)),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(sn);for(const i of this.map.allLayers.items)i.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(i.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(sn);for(const i of this.map.allLayers.items)i.type==="integrated-mesh"&&i.opacity<1&&this._defaultHitTestOptions.exclude.add(i.uid)}}};function sc(i,e){i.layerUids||(i.layerUids=new Set),i.layerUids.add(e)}function o8(i,e){i.graphicUids||(i.graphicUids=new Set),i.graphicUids.add(e)}function gd(i,e){return i!=null&&rT(i.spatialReference,e)?Hy(i,e):null}var qc;X.type="3d",h([u()],X.prototype,"_userClippingArea",void 0),h([u()],X.prototype,"_resourceController",void 0),h([u()],X.prototype,"_stage",void 0),h([u({readOnly:!0})],X.prototype,"deconflictor",void 0),h([u({readOnly:!0})],X.prototype,"labeler",void 0),h([u(sT(Wy,"analyses"))],X.prototype,"analyses",void 0),h([u({type:Ol,readOnly:!0})],X.prototype,"animation",null),h([u({readOnly:!0})],X.prototype,"basemapTerrain",void 0),h([u({readOnly:!0})],X.prototype,"elevationProvider",void 0),h([u()],X.prototype,"camera",null),h([u({type:_o})],X.prototype,"contentCamera",null),h([u({readOnly:!0})],X.prototype,"canvas",void 0),h([u({type:Qr})],X.prototype,"center",null),h([u({type:Us})],X.prototype,"clippingArea",null),h([u({type:eo})],X.prototype,"constraints",void 0),h([u({type:Us,readOnly:!0})],X.prototype,"renderDataExtent",null),h([u({type:Us,readOnly:!0})],X.prototype,"dataExtent",null),h([u({type:Us,readOnly:!0})],X.prototype,"_groundAndLayersExtent",null),h([u({value:null,type:Jo})],X.prototype,"environment",null),h([Cl("environment")],X.prototype,"castEnvironment",null),h([u({readOnly:!0})],X.prototype,"environmentManager",void 0),h([u({type:Us})],X.prototype,"extent",null),h([u()],X.prototype,"floors",void 0),h([u()],X.prototype,"screenCenter",null),h([u()],X.prototype,"frustum",null),h([u({type:Number,readOnly:!0})],X.prototype,"fullOpacity",void 0),h([u({readOnly:!0})],X.prototype,"graphicsView",void 0),h([u({readOnly:!0})],X.prototype,"analysisViewManager",void 0),h([u()],X.prototype,"groundView",void 0),h([u({type:Boolean})],X.prototype,"initialExtentRequired",null),h([u()],X.prototype,"_defaultsFromMapSettings",null),h([u()],X.prototype,"interacting",null),h([u()],X.prototype,"stationary",null),h([u()],X.prototype,"navigating",null),h([u()],X.prototype,"map",void 0),h([u({readOnly:!0})],X.prototype,"mapCoordsHelper",void 0),h([u()],X.prototype,"padding",null),h([u({type:Ji,readOnly:!0})],X.prototype,"pointsOfInterest",void 0),h([u({type:pi,readOnly:!0})],X.prototype,"featureTiles",void 0),h([u()],X.prototype,"_featureTreeDebugger",void 0),h([u({type:Boolean})],X.prototype,"screenSizePerspectiveEnabled",void 0),h([u({constructOnly:!0})],X.prototype,"deactivatedWebGLExtensions",void 0),h([u({constructOnly:!0})],X.prototype,"debugWebGLExtensions",void 0),h([u({constructOnly:!0})],X.prototype,"renderCanvas",void 0),h([u({constructOnly:!0})],X.prototype,"state",void 0),h([u({readOnly:!0})],X.prototype,"inputManager",void 0),h([u({readOnly:!0})],X.prototype,"stateManager",void 0),h([u({type:["low","medium","high"]})],X.prototype,"qualityProfile",null),h([u({type:W0,get(){let i=this._get("qualitySettings");return i||(i=new W0,Ad.apply(this.qualityProfile,i)),i}})],X.prototype,"qualitySettings",void 0),h([u()],X.prototype,"slicePlane",null),h([u({readOnly:!0})],X.prototype,"typeSpecificPreconditionsReady",null),h([u({readOnly:!0})],X.prototype,"renderCoordsHelper",void 0),h([u({readOnly:!0})],X.prototype,"sceneIntersectionHelper",void 0),h([u({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],X.prototype,"resolution",null),h([u({type:Number})],X.prototype,"scale",null),h([u()],X.prototype,"heightModelInfo",null),h([u()],X.prototype,"spatialReference",void 0),h([u({type:Boolean,constructOnly:!0})],X.prototype,"alphaCompositingEnabled",void 0),h([u({constructOnly:!0})],X.prototype,"preserveDrawingBufferEnabled",void 0),h([u({type:Boolean})],X.prototype,"supersampleScreenshotsEnabled",void 0),h([u({readOnly:!0})],X.prototype,"type",void 0),h([u(),Cl(i=>i instanceof jy?i:aT(Ax,i))],X.prototype,"ui",void 0),h([u({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating","textures.updating"]})],X.prototype,"updating",null),h([u()],X.prototype,"_updatingObjects",null),h([u()],X.prototype,"_updatingObjectsWithProgress",null),h([u({type:Number,readOnly:!0,dependsOn:["updating"]})],X.prototype,"updatingProgress",void 0),h([u({type:["global","local"]})],X.prototype,"viewingMode",null),h([u({type:Rl})],X.prototype,"viewpoint",null),h([u({type:Number})],X.prototype,"zoom",null),h([u({type:Yb})],X.prototype,"highlightOptions",void 0),h([u({readOnly:!0})],X.prototype,"quality",null),h([u({readOnly:!0})],X.prototype,"resolutionScale",null),h([u()],X.prototype,"textures",void 0),X=h([N("esri.views.SceneView")],X),function(i){i[i.INCLUDE=0]="INCLUDE",i[i.EXCLUDE=1]="EXCLUDE"}(qc||(qc={}));const Qo=b(),nm=Dt(),my=Yt(),l8=X,AN=Object.freeze(Object.defineProperty({__proto__:null,default:l8},Symbol.toStringTag,{value:"Module"}));export{AL as $,WE as A,Bu as B,ZE as C,IM as D,lx as E,VM as F,sx as G,ax as H,W9 as I,LM as J,Is as K,gg as L,HM as M,ZM as N,YM as O,JM as P,Gu as Q,dD as R,PS as S,wx as T,mD as U,ID as V,yE as W,l$ as X,EL as Y,oh as Z,uw as _,jv as a,eA as a0,nn as a1,l8 as a2,Hn as a3,cc as a4,Hs as a5,Xh as a6,U9 as a7,xl as a8,AI as a9,GO as aa,Q0 as ab,C$ as ac,AN as ad,MS as b,Kv as c,nb as d,lR as e,fR as f,F_ as g,jS as h,UA as i,mg as j,pA as k,bo as l,sM as m,ES as n,nM as o,lM as p,tb as q,qS as r,ex as s,Yw as t,rb as u,KS as v,Yv as w,VS as x,Mc as y,QE as z};

import{aY as w,ie as O,aZ as v}from"./index-b516d057.js";import{b as j,n as g}from"./cimAnalyzer-ce1886a0.js";import{CIMSymbolRasterizer as G}from"./CIMSymbolRasterizer-cb18d049.js";import{t as b,l as R}from"./symbolUtils-b4f6caa2.js";import"./fontUtils-56b88a2f.js";import"./BidiEngine-9a40f2f4.js";import"./labelPoint-96433514.js";import"./OptimizedGeometry-196224d4.js";import"./GeometryUtils-984e8446.js";import"./enums-f1a6a48a.js";import"./alignmentUtils-ae955d28.js";import"./definitions-5366d472.js";import"./mat2d-d4af8487.js";import"./mat2df32-fb26a8c9.js";import"./vec2f32-eaf29605.js";import"./number-e491b09e.js";import"./Rect-ea14f53a.js";import"./callExpressionWithFeature-36423058.js";import"./quantizationUtils-17105106.js";import"./floatRGBA-ca990bbb.js";import"./CIMResourceManager-5475f36b.js";import"./Rasterizer-81c172dd.js";import"./rasterizingUtils-364392eb.js";import"./jsxFactory-92036771.js";import"./uuid-709b6c67.js";import"./webStyleSymbolUtils-4761c8f2.js";import"./devEnvironmentUtils-4eab2a99.js";const u=new G(null,!0),c=w(b.size),S=w(b.maxSize),C=w(b.lineWidth),V=1;async function $(o,e,a){const i=e==null?void 0:e.size;let t=i!=null&&typeof i=="object"&&"width"in i?i.width:i,l=i!=null&&typeof i=="object"&&"height"in i?i.height:i;if(t==null||l==null)if(a==="esriGeometryPolygon")t=c,l=c;else{const r=await q(o,e,a);r&&(t=r.width,l=r.height),a==="esriGeometryPolyline"&&(t=C),t=t!=null&&isFinite(t)?Math.min(t,S):c,l=l!=null&&isFinite(l)?Math.max(Math.min(l,S),V):c}return e.style==="legend"&&a==="esriGeometryPolyline"&&(t=C),{width:t,height:l}}async function q(o,e,a){const{feature:i,fieldMap:t,viewParams:l}=e.cimOptions||e,r=await j.resolveSymbolOverrides(o.data,i,null,t,a,null,l);if(!r)return null;(o=o.clone()).data={type:"CIMSymbolReference",symbol:r},o.data.primitiveOverrides=void 0;const n=[];return g.fetchResources(r,u.resourceManager,n),g.fetchFonts(r,u.resourceManager,n),n.length>0&&await Promise.all(n),g.getEnvelope(r,null,u.resourceManager)}async function pe(o,e={}){var M;const{node:a,opacity:i,symbolConfig:t}=e,l=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,r=e.cimOptions||e,n=r.geometryType||O((M=o==null?void 0:o.data)==null?void 0:M.symbol),f=await $(o,e,n),{feature:P,fieldMap:I}=r,L=l||n!=="esriGeometryPolygon"?"preview":"legend",h=await u.rasterizeCIMSymbolAsync(o,P,f,L,I,n,null,r.viewParams,r.allowScalingUp);if(!h)return null;const{width:x,height:z}=h,s=document.createElement("canvas");s.width=x,s.height=z,s.getContext("2d").putImageData(h,0,0);const y=v(f.width),d=v(f.height),m=new Image(y,d);m.src=s.toDataURL(),m.ariaLabel=e.ariaLabel??null,m.alt=e.ariaLabel??"",i!=null&&(m.style.opacity=`${i}`);let p=m;if(e.effectView!=null){const F={shape:{type:"image",x:0,y:0,width:y,height:d,src:m.src},fill:null,stroke:null,offset:[0,0]};p=R([[F]],[y,d],{effectView:e.effectView,ariaLabel:e.ariaLabel})}return a&&p&&a.appendChild(p),p}export{pe as previewCIMSymbol};

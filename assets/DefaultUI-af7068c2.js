import{a5 as l,a6 as h,a9 as v,cb as w,h3 as U,kY as Ie,bA as $,V as R,k as Ce,kl as xi,b9 as Z,an as L,n1 as dt,gk as ye,iu as un,gs as xt,km as dn,s1 as Kt,_ as mt,s as I,r8 as mn,cn as Mt,y as Me,sY as gn,bn as Tt,cf as yn,kf as Qe,cd as Pt,dr as fn,iL as Mi,lO as Ct,al as Ti,ib as Je,gQ as le,cg as _n,dA as je,ao as Pi,fM as vn,b0 as Ue,dh as wn,n0 as Ke,eI as $t,eh as Et,di as Dt,eJ as It,gj as gt,gt as bn,bg as Ci,hF as kn,iN as xn,hE as $i,ce as Mn,kj as Tn,U as Zt,bm as St,lF as Yt,aI as Pn,cc as Ei,M as $e,sZ as Qt,ah as Rt,dX as Cn,qL as $n,hj as En,bs as Di,ez as Dn,B as Vt,s_ as Ii,lS as In,gr as Ze,jM as C,gg as Jt,gR as Xt,gh as Sn,gn as Rn,gq as ei,ra as Si,lf as Vn,s8 as j,fZ as yt,hh as Ln,s$ as An,gi as x,oi as Ri,eN as On,gp as Nn,ae as Hn,g0 as Gn,kt as Fn,ku as ti,kw as zn,g1 as qn,d1 as jn,aR as Xe,eU as Vi,aP as Un,bh as Wn,x as Bn,gW as Kn,cD as Zn,pe as Yn}from"./index-b516d057.js";import{W as ii,Z as Li,_ as ni,$ as Ai,Q as Qn,a0 as ai,e as Jn,O as Xn,n as Se,i as ea}from"./jsxFactory-92036771.js";import{h as Ye}from"./UpdatingHandles-7949a657.js";import{_ as Lt,i as fe,n as B,b as ta,f as ia}from"./screenUtils-8dc4a7f9.js";import{g as na}from"./Map-1ad4186f.js";import{l as aa}from"./CollectionFlattener-193451da.js";import{v as sa}from"./HeightModelInfo-b816d32b.js";import{n as et}from"./TablesMixin-292d1d89.js";import"./IViewEvents-9a85f53d.js";import{o as ft}from"./interfaces-0421c5e6.js";import{g as ra,l as oa}from"./heightModelInfoUtils-0dd2b6e4.js";import{l as si}from"./ViewingMode-5d7d590b.js";import{l as Te}from"./Viewpoint-f83262d0.js";import{f as Oi,e as At,c as Ni,i as We,h as la,M as ha,r as Hi}from"./mat2d-d4af8487.js";import{n as pa}from"./mat2df32-fb26a8c9.js";import{e as oe}from"./mat2df64-4d1a9198.js";import{e as tt}from"./mat3f32-6c416b1c.js";import{t as ri}from"./vec2f32-eaf29605.js";import{n as ca}from"./capabilities-9d56a1da.js";import{n as ua}from"./contextUtils-81fda295.js";import{n as da}from"./themeUtils-7dcf5b71.js";import{e as oi}from"./globalCss-94006b67.js";import{t as ma}from"./accessibleHandler-e91101b2.js";import ga from"./Compass-b37d7d1d.js";import ya from"./NavigationToggle-57c00adb.js";import fa from"./Zoom-73b5f25a.js";const Ne={widthBreakpoint:{getValue(i){const e=i.viewSize[0],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(i){const e=i.viewSize[1],t=i.breakpoints,n=this.values;return e<=t.xsmall?n.xsmall:e<=t.small?n.small:e<=t.medium?n.medium:e<=t.large?n.large:n.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(i){const e=i.viewSize,t=e[0],n=e[1],a=this.values;return n>=t?a.portrait:a.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},it={xsmall:544,small:768,medium:992,large:1200};function _a(i){const e=i;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function nt(i,e){return e?Ne[i].valueToClassName[e].split(" "):[]}const hr=i=>{let e=class extends i{constructor(...t){super(...t),this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=it}initialize(){this.addHandles(w(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),U))}destroy(){this.destroyed||this._removeActiveClassNames()}set breakpoints(t){if(t===this._get("breakpoints"))return;const n=_a(t);if(!n){const a=JSON.stringify(it,null,2);console.warn("provided breakpoints are not valid, using defaults:"+a)}t=n?t:it,this._set("breakpoints",{...t})}_updateClassNames(){if(!this.container)return;const t=Ie.acquire(),n=Ie.acquire();let a,s=!1;for(a in Ne){const r=this[a],o=Ne[a].getValue({viewSize:this.size,breakpoints:this.breakpoints});r!==o&&(s=!0,this[a]=o,nt(a,r).forEach(p=>n.push(p)),nt(a,o).forEach(p=>t.push(p)))}s&&(this._applyClassNameChanges(t,n),Ie.release(t),Ie.release(n))}_applyClassNameChanges(t,n){const a=this.container;a&&(n.forEach(s=>a.classList.remove(s)),t.forEach(s=>a.classList.add(s)))}_removeActiveClassNames(){const t=this.container;if(!t)return;let n;for(n in Ne)nt(n,this[n]).forEach(a=>t.classList.remove(a))}};return l([h()],e.prototype,"breakpoints",null),l([h()],e.prototype,"orientation",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),l([h()],e.prototype,"heightBreakpoint",void 0),e=l([v("esri.views.BreakpointsOwner")],e),e};let X=class extends ${constructor(){super(...arguments),this.items=new R,this._watchUpdatingTracking=new Ye,this._callbacks=new Map,this._projector=ii(),this._hiddenProjector=ii()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const n of t.added){const a=()=>n.render();this._callbacks.set(n,a),this._projector.append(this.surface,a)}for(const n of t.removed){const a=this._projector.detach(this._callbacks.get(n));this.surface.removeChild(a.domNode),this._callbacks.delete(n)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,n=this._hiddenProjector;let a;const s=()=>(a=e.render(),a);n.append(t,s),n.renderNow();const r={left:0,top:0,right:0,bottom:0};if(a!=null&&a.domNode){const o=a.domNode.getBoundingClientRect();r.left=o.left,r.top=o.top,r.right=o.right,r.bottom=o.bottom}for(n.detach(s);t.firstChild;)t.removeChild(t.firstChild);return r}overlaps(e,t){const n=this.computeBoundingRect(e),a=this.computeBoundingRect(t);return Math.max(n.left,a.left)<=Math.min(n.right,a.right)&&Math.max(n.top,a.top)<=Math.min(n.bottom,a.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e,t){const n=!!(t!=null&&t.disableDecorations);if(!this.items.some(s=>s.visible&&!(n&&s.isDecoration)))return;const a=e.getContext("2d");a.save(),a.font=this._fontString(),this.items.forEach(s=>{n&&s.isDecoration||(a.save(),s.renderCanvas(a),a.restore())}),a.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};l([h({readOnly:!0})],X.prototype,"surface",void 0),l([h({readOnly:!0})],X.prototype,"items",void 0),l([h({readOnly:!0})],X.prototype,"needsRender",null),l([h({readOnly:!0})],X.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],X.prototype,"updating",null),X=l([v("esri.views.overlay.ViewOverlay")],X);const li=X,at=[0,0];function va(i){const e=(i.ownerDocument||window.document).defaultView,t=i.getBoundingClientRect();return at[0]=t.left+((e==null?void 0:e.pageXOffset)??0),at[1]=t.top+((e==null?void 0:e.pageYOffset)??0),at}function hi(i){i&&(Ai(i),i.parentNode&&i.parentNode.removeChild(i))}function wa(i){const e=document.createElement("div");return i.appendChild(e),e}const ve=16,Re=750,ba=512,ka=2,cr=i=>{let e=class extends i{constructor(...t){super(...t),this._freqInfo={freq:ve,time:Re},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([w(()=>this.cursor,n=>{const{surface:a}=this;a&&a.setAttribute("data-cursor",n)}),w(()=>this.navigating,n=>{const{surface:a}=this;a&&a.setAttribute("data-navigating",n.toString())})])}initialize(){const t=Ce("mac"),n=async()=>{t&&(await xt(()=>this.ready),this.messagesCommon=await dn("esri/t9n/common").catch(()=>{}))};n(),this.addHandles([w(()=>this.ui,(a,s)=>this._handleUIChange(a,s),U),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused")),xi(n)])}destroy(){this.destroyed||(this.ui=Z(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(t){const n=this._get("container"),a=Li(t);if(a||typeof t!="string"||L.getLogger(this).error("#container",`element with id '${t}' not found`),n===a)return;if(this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(hi(this.root),this._set("root",null)),this.userContent&&(ni(this.userContent,n),hi(this.userContent),this._set("userContent",null))),!a)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);a.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",ni(a,s),a.appendChild(s),this._set("userContent",s);const r=document.createElement("div");r.className="esri-view-root",a.insertBefore(r,a.firstChild),this._set("root",r);const o=document.createElement("div");o.className="esri-view-surface",o.setAttribute("role","application"),o.tabIndex=0,r.appendChild(o),this._set("surface",o);const p=new li;r.appendChild(p.surface),this._set("overlay",p),this.addHandles(w(()=>p.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=dt({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=ye(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",a),this._startMeasuring()}get focused(){const t=document.activeElement===this.surface;return document.hasFocus()&&t}get size(){return[this.width,this.height]}blur(){var t;(t=this.surface)==null||t.blur()}focus(){var t;(t=this.surface)==null||t.focus()}pageToContainer(t,n,a){const s=this.position;return t-=s?s[0]:0,n-=s?s[1]:0,a?(a[0]=t,a[1]=n):a=[t,n],a}containerToPage(t,n,a){const s=this.position;return t+=s?s[0]:0,n+=s?s[1]:0,a?(a[0]=t,a[1]=n):a=[t,n],a}_handleUIChange(t,n){this.removeHandles("ui"),n&&n!==t&&n.destroy(),t&&(t.view=this,this.addHandles(w(()=>this.root,a=>{t.container=a?wa(a):null},U),"ui")),this._set("ui",t)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const t=this._freqInfo;t.freq=ve,t.time=Re,this.addHandles([un(window,"resize",()=>{t.freq=ve,t.time=Re}),dt({prepare:n=>{const a=this._measure(),s=this._freqInfo;if(s.time+=n.deltaTime,a&&(s.freq=ve,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const r=this._position();s.freq=r||a?ve:Math.min(Re,s.freq*ka),!a&&s.freq>=ba&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const t=this.container,n=t?t.clientWidth:0,a=t?t.clientHeight:0;if(n===0||a===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,r=this.height;return n===s&&a===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",n),this._set("height",a),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:r,width:n,height:a}),!0)}_position(){const t=this.container,n=this.position,a=t&&va(t);return!!a&&(!n||a[0]!==n[0]||a[1]!==n[1])&&(this._set("position",[a[0],a[1]]),!0)}forceDOMReadyCycle(){}};return l([h()],e.prototype,"container",null),l([h({readOnly:!0})],e.prototype,"focused",null),l([h({readOnly:!0})],e.prototype,"height",void 0),l([h()],e.prototype,"messagesCommon",void 0),l([h({type:li})],e.prototype,"overlay",void 0),l([h({readOnly:!0})],e.prototype,"position",void 0),l([h({readOnly:!0})],e.prototype,"resizing",void 0),l([h({readOnly:!0})],e.prototype,"root",void 0),l([h({value:null,readOnly:!0})],e.prototype,"size",null),l([h({readOnly:!0})],e.prototype,"surface",void 0),l([h({readOnly:!0})],e.prototype,"suspended",void 0),l([h()],e.prototype,"ui",void 0),l([h({readOnly:!0})],e.prototype,"userContent",void 0),l([h({readOnly:!0})],e.prototype,"width",void 0),l([h()],e.prototype,"widthBreakpoint",void 0),e=l([v("esri.views.DOMContainer")],e),e};function F(i){return i!=null&&"open"in i&&"declaredClass"in i}function pi(i){return i!=null&&"declaredClass"in i&&"dockOptions"in i}const ur=i=>{let e=class extends i{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([w(()=>[this.ui,this.popup],([t,n],a)=>{const s="popup",r="manual";if(a){const[o,p]=a;o&&F(p)&&(p.view=null,pi(p)&&o.remove(p,s))}t&&F(n)&&(n.view=this,pi(n)&&t.add(n,{key:s,position:r,internal:!0}))},U),this.on("click",t=>{this.popup&&this.popupEnabled&&(t.pointerType!=="mouse"||t.button===0)&&(!F(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(F(this.popup)?this.popup.viewModel.handleViewClick(t):t.async(async()=>{await this.setupPopup(),F(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(t)})))},Lt.WIDGET)]),xt(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{mt(()=>import("./Popup-0d6c66f1.js"),["assets/Popup-0d6c66f1.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/Features-637f842c.js","assets/throttle-7bf02de9.js","assets/Feature-6b48db78.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/Attachments-ef3101ea.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/AttachmentInfo-3d2302be.js","assets/AttachmentQuery-bede5a71.js","assets/featureUtils-73b624d6.js","assets/utils-1a995f8e.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/globalCss-94006b67.js","assets/Heading-92f210ca.js","assets/widget-826a6ea9.js","assets/uriUtils-dead790b.js","assets/utils-6ca5af6f.js","assets/HeatmapColorStop-3fff4333.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/executeQueryJSON-eec0ecca.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/OptimizedGeometry-196224d4.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-d7a48772.js","assets/featureConversionUtils-09cf00ff.js","assets/RelationshipQuery-2c9e4485.js","assets/TopFeaturesQuery-6d0bf5f5.js","assets/themeUtils-7dcf5b71.js","assets/FeatureLayer-c4c5819f.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/Version-1f969b2a.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/heatmapUtils-7f42325f.js","assets/FeatureLayerBase-0746b503.js","assets/HeightModelInfo-b816d32b.js","assets/featureLayerUtils-16361d1f.js","assets/featureQueryAll-40af0622.js","assets/LayerFloorInfo-4234db4d.js","assets/serviceCapabilitiesUtils-42d4d20c.js","assets/editsZScale-e45bb69c.js","assets/APIKeyMixin-bfb00271.js","assets/EditBusLayer-caf9fed8.js","assets/FeatureEffectLayer-1948d1a0.js","assets/FeatureEffect-c80bb16d.js","assets/FeatureFilter-55dd341e.js","assets/FeatureReductionLayer-443167bc.js","assets/clusterUtils-50a66940.js","assets/MD5-715f37cd.js","assets/FeatureReductionSelection-d84c375a.js","assets/LabelClass-c3c309a8.js","assets/labelUtils-b29175f3.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-32293fe1.js","assets/FeatureTemplate-d1d1c7be.js","assets/FeatureType-f30c4b8b.js","assets/fieldProperties-8c831c84.js","assets/labelingInfo-aae625ac.js","assets/versionUtils-5892620e.js","assets/styleUtils-a3d96bf6.js","assets/FeatureRelationshipViewModel-9f00674c.js","assets/featureFormUtils-24147792.js","assets/resources-d4afed0c.js","assets/Spinner-2d11b064.js","assets/AnchorElementViewModel-8d35dd28.js","assets/ReactiveSet-7afb73d5.js","assets/LayerConstants-d3ac1b7a.js","assets/symbolUtils-b4f6caa2.js","assets/mat2df32-fb26a8c9.js","assets/mat2d-d4af8487.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/devEnvironmentUtils-4eab2a99.js","assets/layerViewUtils-6ebe90f4.js","assets/actions-713d334d.js","assets/GoTo-4d856ce0.js","assets/vmEvent-d773b6c5.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(t){if(F(this.popup))return this.popup.open(t);try{if(await this.setupPopup(),!this.popup)return void L.getLogger(this).error(new I("view:null-popup","Popup is null and can't be opened"));this.popup.open(t)}catch{}}closePopup(){var t;(t=this._popupSetupTask)==null||t.abort(),F(this.popup)&&this.popup.close()}async fetchPopupFeatures(t,n){await this.when();const{location:a,queryArea:s,layerViewsAndGraphics:r,clientOnlyGraphics:o}=await this._prepareFetchPopupFeatures(t,n),p=Promise.resolve(o),c=this._queryLayerPopupFeatures(s,r,n),u=c.map(d=>d.promise);return{location:a,clientOnlyGraphics:o,allGraphicsPromise:mn([p,...u]).then(d=>Array.from(new Set(d.flat()))),promisesPerLayerView:c}}async setupPopup(){var t;if((t=this._popupSetupTask)==null||t.abort(),this.popup&&!F(this.popup))return this._popupSetupTask=Mt(async n=>{const{default:a}=await mt(()=>import("./Popup-0d6c66f1.js"),["assets/Popup-0d6c66f1.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/Features-637f842c.js","assets/throttle-7bf02de9.js","assets/Feature-6b48db78.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/Attachments-ef3101ea.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/AttachmentInfo-3d2302be.js","assets/AttachmentQuery-bede5a71.js","assets/featureUtils-73b624d6.js","assets/utils-1a995f8e.js","assets/basemapUtils-6ec10a55.js","assets/Basemap-8d62c69e.js","assets/loadAll-5e767cfa.js","assets/writeUtils-e226a8aa.js","assets/globalCss-94006b67.js","assets/Heading-92f210ca.js","assets/widget-826a6ea9.js","assets/uriUtils-dead790b.js","assets/utils-6ca5af6f.js","assets/HeatmapColorStop-3fff4333.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/executeQueryJSON-eec0ecca.js","assets/query-351887b5.js","assets/pbfQueryUtils-b37a842c.js","assets/pbf-2651fe50.js","assets/OptimizedGeometry-196224d4.js","assets/OptimizedFeature-e90b69df.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-d7a48772.js","assets/featureConversionUtils-09cf00ff.js","assets/RelationshipQuery-2c9e4485.js","assets/TopFeaturesQuery-6d0bf5f5.js","assets/themeUtils-7dcf5b71.js","assets/FeatureLayer-c4c5819f.js","assets/jsonUtils-52514725.js","assets/DictionaryLoader-e327eff9.js","assets/Version-1f969b2a.js","assets/FieldsIndex-e8db657f.js","assets/UnknownTimeZone-a05df022.js","assets/heatmapUtils-7f42325f.js","assets/FeatureLayerBase-0746b503.js","assets/HeightModelInfo-b816d32b.js","assets/featureLayerUtils-16361d1f.js","assets/featureQueryAll-40af0622.js","assets/LayerFloorInfo-4234db4d.js","assets/serviceCapabilitiesUtils-42d4d20c.js","assets/editsZScale-e45bb69c.js","assets/APIKeyMixin-bfb00271.js","assets/EditBusLayer-caf9fed8.js","assets/FeatureEffectLayer-1948d1a0.js","assets/FeatureEffect-c80bb16d.js","assets/FeatureFilter-55dd341e.js","assets/FeatureReductionLayer-443167bc.js","assets/clusterUtils-50a66940.js","assets/MD5-715f37cd.js","assets/FeatureReductionSelection-d84c375a.js","assets/LabelClass-c3c309a8.js","assets/labelUtils-b29175f3.js","assets/defaults-4faa92e6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-32293fe1.js","assets/FeatureTemplate-d1d1c7be.js","assets/FeatureType-f30c4b8b.js","assets/fieldProperties-8c831c84.js","assets/labelingInfo-aae625ac.js","assets/versionUtils-5892620e.js","assets/styleUtils-a3d96bf6.js","assets/FeatureRelationshipViewModel-9f00674c.js","assets/featureFormUtils-24147792.js","assets/resources-d4afed0c.js","assets/Spinner-2d11b064.js","assets/AnchorElementViewModel-8d35dd28.js","assets/ReactiveSet-7afb73d5.js","assets/LayerConstants-d3ac1b7a.js","assets/symbolUtils-b4f6caa2.js","assets/mat2df32-fb26a8c9.js","assets/mat2d-d4af8487.js","assets/webStyleSymbolUtils-4761c8f2.js","assets/devEnvironmentUtils-4eab2a99.js","assets/layerViewUtils-6ebe90f4.js","assets/actions-713d334d.js","assets/GoTo-4d856ce0.js","assets/vmEvent-d773b6c5.js"]);if(Me(n),!this.popup||F(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new a(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(t,n,a){return n.map(({layerView:s,graphics:r})=>{const o={clientGraphics:r,event:a!=null?a.event:void 0,signal:a!=null?a.signal:void 0,defaultPopupTemplateEnabled:a!=null&&!!a.defaultPopupTemplateEnabled},p=s.fetchPopupFeatures(t,o);return{layerView:s,promise:p}})}_isValidPopupGraphic(t,n){return t&&!!t.getEffectivePopupTemplate(n!=null&&n.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(t,n){const{clientGraphics:a,queryArea:s,location:r}=await this._popupHitTestGraphics(t,n),o=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:p,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(a,o);return{clientOnlyGraphics:c,layerViewsAndGraphics:p,queryArea:s,location:r}}async _popupHitTestGraphics(t,n){const a=await this.popupHitTest(t),s=a.results,r=a.mapPoint,o=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,n)),p=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(c=>c.graphic),queryArea:r,location:r||p}}_getFetchPopupLayerViews(){const t=[];return this.allLayerViews.forEach(n=>{this._isValidPopupLayerView(n)&&t.push(n)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}_isValidPopupLayerView(t){return t!=null&&(!("layer"in t)||!t.suspended)&&"fetchPopupFeatures"in t}_graphicsPerFetchPopupLayerView(t,n){const a=[],s=new Map,r=n.map(o=>{const p=[];return"layer"in o?s.set(o.layer,p):s.set(o.graphics,p),{layerView:o,graphics:p}});for(const o of t){const p=s.get(o.layer)||s.get(o.sourceLayer)||null;p?p.push(o):a.push(o)}return{layerViewsAndGraphics:r,clientOnlyGraphics:a}}};return l([h({cast(t){return!t||F(t)||typeof t=="object"&&(t.open=n=>(Kt(L.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(n)),t.close=()=>(Kt(L.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),t}})],e.prototype,"popup",void 0),l([h()],e.prototype,"popupEnabled",void 0),e=l([v("esri.views.PopupView")],e),e};let Be=class extends gn{constructor(e){super(e),this.addHandles(this.on("before-add",t=>{t.item!=null&&t.item.parent===this.owner&&(L.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};Be=l([v("esri.support.AnalysesCollection")],Be);let ee=class extends ${constructor(e){super(e),this.view=null,this.baseLayerViews=new R,this.referenceLayerViews=new R,this._loadingHandle=w(()=>{var t,n;return(n=(t=this.view)==null?void 0:t.map)==null?void 0:n.basemap},t=>{t&&t.load().catch(()=>{})},U)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var t,n;if(this.view&&this.view.suspended)return!1;const e=(n=(t=this.view)==null?void 0:t.map)==null?void 0:n.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(a=>a.updating)||this.referenceLayerViews.some(a=>a.updating))}};l([h({constructOnly:!0})],ee.prototype,"view",void 0),l([h({readOnly:!0})],ee.prototype,"baseLayerViews",void 0),l([h({readOnly:!0})],ee.prototype,"referenceLayerViews",void 0),l([h({readOnly:!0})],ee.prototype,"suspended",null),l([h({type:Boolean,readOnly:!0})],ee.prototype,"updating",null),ee=l([v("esri.views.BasemapView")],ee);function xa(i){return"tryRecycleWith"in i}class Ma{constructor(e,t,n){this.layer=e,this.view=t,this.layerViewImporter=n,this._controller=new AbortController,this._deferred=Tt(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Je(this._controller.signal,()=>{const a=new I("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(a)})}tryRecycle(e){if(!this.done||!this.layerView||!xa(this.layerView))return null;const t=this.layer.type,n=this._controller.signal;for(let a=0;a<e.length;a++){const s=e[a];if(s.type!==t)continue;const r=this.layerView.tryRecycleWith(s,{signal:n});if(r){e.splice(a,1),this.layer=s;const o=this.layerView,p=o.view;return this.promise=Promise.race([r.then(()=>(Me(this._controller.signal),s.emit("layerview-destroy",{view:p,layerView:o}),p.emit("layerview-destroy",{view:p,layerView:o}),s.emit("layerview-create",{view:p,layerView:o}),p.emit("layerview-create",{view:p,layerView:o}),o)),new Promise((c,u)=>Je(this._controller.signal,()=>u(Mi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:t,view:n}=this;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var a,s;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:n}=this;this._map=n.map;try{let r,o;if(await t.load({signal:e}),t.prefetchResources&&await t.prefetchResources({signal:e}),Pa(t))r=await t.createLayerView(n,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new I("layer:view-not-supported","No layerview implementation was found");const u=await this.layerViewImporter.importLayerView(t);Me(e),r="default"in u?new u.default({layer:t,view:n}):new u({layer:t,view:n})}const p=()=>{o=ye(o),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};o=Je(e,p),Me(e);try{await r.when()}catch(u){throw p(),u}if(!((s=(a=this._map)==null?void 0:a.allLayers)==null?void 0:s.includes(t)))return p(),void this._deferred.reject(new I("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:n,layerView:r}),n.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(r){t.emit("layerview-create-error",{view:n,error:r}),n.emit("layerview-create-error",{layer:t,error:r}),this.done=!0,this._deferred.reject(new I("layerview:create-error","layerview creation failed",{layer:t,error:r}))}}}let O=class extends ${constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Ye,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var n;const t=(n=this.view.map)==null?void 0:n.allLayers;if(t)for(const a of t)this.layerViewImporter.hasLayerViewModule(a)&&this.layerViewImporter.importLayerView(a)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Tt(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(yn(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var p,c,u;if(this.destroyed)return;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const n=new Set,a=[],s=this.view.ready,r=d=>{if(d!=null){for(const m of d)if(m){n.add(m);const y=this._layerLayerViewInfoMap.get(m);y&&s?y.start():y||this._recyclingInfoMap.has(m)||a.push(m),"layers"in m&&m.layers&&r(m.layers)}}};for(const d of this._rootCollectionNames)r(Qe(this,d));for(const[d,m]of this._layerLayerViewInfoMap)if(!n.has(d)){this._layerLayerViewInfoMap.delete(m.layer);const y=m.tryRecycle(a);y?(this.notifyChange("updating"),this._recyclingInfoMap.set(m.layer,m),y.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(m.layer),this._layerLayerViewInfoMap.set(m.layer,m),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(m.layer),m.destroy(),this._reschedule()})):m.destroy()}for(const[d,m]of this._recyclingInfoMap)n.has(d)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(m.layer),m.destroy());for(const d of a)this._createLayerView(d);this._refreshCollections();const o=[(p=t==null?void 0:t.ground)==null?void 0:p.layers,(c=t==null?void 0:t.basemap)==null?void 0:c.baseLayers,(u=t==null?void 0:t.basemap)==null?void 0:u.referenceLayers,t==null?void 0:t.layers].filter(d=>!!d);n.forEach(d=>"layers"in d&&o.push(d.layers)),this.addHandles(o.map(d=>this._watchUpdatingTracking.addOnCollectionChange(()=>d,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.addHandles([Pt(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),w(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),fn)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),et(this._recyclingInfoMap),et(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Mi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Ct(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){this.destroyed||(et(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new I("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(Qe(this,e),Qe(this,t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,n){if(!e||!t)return void(t&&t.removeAll());let a=0;for(const s of e){const r=this._layerLayerViewInfoMap.get(s);if(!(r!=null&&r.layerView))continue;const o=r.layerView;o.layer=s,o.parent=n,t.at(a)!==o&&t.splice(a,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),a+=1}a<t.length&&t.splice(a,t.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new Ma(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),n=>{n&&(Ti(n)||n.name==="cancelled:layerview-create")||L.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:n}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};l([h()],O.prototype,"_workPromise",void 0),l([h({readOnly:!0})],O.prototype,"_watchUpdatingTracking",void 0),l([h({readOnly:!0})],O.prototype,"_layersToLayerViews",null),l([h({readOnly:!0})],O.prototype,"_rootCollectionNames",null),l([h()],O.prototype,"layerViewImporter",void 0),l([h()],O.prototype,"supportsGround",void 0),l([h({readOnly:!0})],O.prototype,"updating",null),l([h({readOnly:!0})],O.prototype,"updatingRemaining",null),l([h({constructOnly:!0})],O.prototype,"view",void 0),O=l([v("esri.views.LayerViewManager")],O);const Ta=O;function Pa(i){return"createLayerView"in i&&i.createLayerView!=null}let V=class extends ${constructor(e){super(e),this.factor=1.5,this.offset=le(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};l([h({type:Number})],V.prototype,"factor",void 0),l([h({nonNullable:!0})],V.prototype,"offset",void 0),l([h()],V.prototype,"position",void 0),l([h({type:Number,range:{min:0}})],V.prototype,"size",void 0),l([h()],V.prototype,"maskUrl",void 0),l([h()],V.prototype,"maskEnabled",void 0),l([h()],V.prototype,"overlayUrl",void 0),l([h()],V.prototype,"overlayEnabled",void 0),l([h({readOnly:!0})],V.prototype,"version",null),l([h({type:Boolean})],V.prototype,"visible",void 0),V=l([v("esri.views.Magnifier")],V);const Gi=V;let we=class extends _n($){constructor(e){super(e),this.accentColor=new je([255,127,0]),this.textColor=new je([255,255,255])}};l([h({type:je,nonNullable:!0})],we.prototype,"accentColor",void 0),l([h({type:je,nonNullable:!0})],we.prototype,"textColor",void 0),we=l([v("esri.views.Theme")],we);const _t=we,Fi=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],zi={};function qi(i){return!!zi[i]}function Ca(i){for(const e of i)if(!qi(e))return!1;return!0}Fi.forEach(i=>{zi[i]=!0});let $a=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:t,priority:n},a)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(a,[t],n)})}disconnect(){this.inputManager&&this._handlers.forEach((e,t)=>{var n;return(n=this.inputManager)==null?void 0:n.uninstallHandlers(t)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,t,n,a){const s=Array.isArray(e)?e:e.split(",");if(!Ca(s))return s.some(qi)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let r,o;Array.isArray(t)?o=t:(r=t,o=[]),typeof n=="function"?r=n:a=n,a=a??Lt.DEFAULT;const p=this._createUniqueGroupName(),c=new Ea(this.view,s,o,r);this._handlers.set(p,{handler:c,priority:a});for(const u of s){const d=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,d+1)}return this.inputManager&&this.inputManager.installHandlers(p,[c],a),Pi(()=>this._removeHandler(p,s))}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,t){if(this._handlers.has(e)){this._handlers.delete(e);for(const n of t){const a=this._handlerCounts.get(n);a===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",n):a===1?this._handlerCounts.delete(n):this._handlerCounts.set(n,a-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},Ea=class extends fe{constructor(e,t,n,a){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of t)switch(s){case"click":this.registerIncoming("click",n,r=>a(this._wrapClick(r)));break;case"double-click":this.registerIncoming("double-click",n,r=>a(this._wrapDoubleClick(r)));break;case"immediate-click":this.registerIncoming("immediate-click",n,r=>a(this._wrapImmediateClick(r)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",n,r=>a(this._wrapImmediateDoubleClick(r)));break;case"hold":this.registerIncoming("hold",n,r=>a(this._wrapHold(r)));break;case"drag":this.registerIncoming("drag",n,r=>{const o=this._wrapDrag(r);o&&a(o)});break;case"key-down":this.registerIncoming("key-down",n,r=>a(this._wrapKeyDown(r)));break;case"key-up":this.registerIncoming("key-up",n,r=>a(this._wrapKeyUp(r)));break;case"pointer-down":this.registerIncoming("pointer-down",n,r=>a(this._wrapPointer(r,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",n,r=>a(this._wrapPointer(r,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",n,r=>a(this._wrapPointer(r,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",n,r=>a(this._wrapPointerDrag(r)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",n,r=>a(this._wrapMouseWheel(r)));break;case"pointer-enter":this.registerIncoming("pointer-enter",n,r=>a(this._wrapPointer(r,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",n,r=>a(this._wrapPointer(r,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",n,r=>{a(this._wrapGamepad(r))});break;case"focus":this.registerIncoming("focus",n,r=>{a(this._wrapFocus(r))});break;case"blur":this.registerIncoming("blur",n,r=>{a(this._wrapBlur(r))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:t,button:n,buttons:a,x:s,y:r,native:o,eventId:p}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:t,button:n,buttons:a,x:s,y:r,native:o,timestamp:u,screenPoint:le(s,r),mapPoint:this._getMapPoint(s,r),eventId:p,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:t,button:n,buttons:a,x:s,y:r,native:o,eventId:p}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:t,button:n,buttons:a,x:s,y:r,native:o,timestamp:u,mapPoint:this._getMapPoint(s,r),eventId:p,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:d=>e.async(d),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:t,button:n,buttons:a,x:s,y:r,native:o,eventId:p}=e.data,c=o.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-click",pointerId:c,pointerType:t,button:n,buttons:a,x:s,y:r,native:o,timestamp:d,mapPoint:this._getMapPoint(s,r),eventId:p,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:t,button:n,buttons:a,x:s,y:r,native:o,eventId:p}=e.data,c=o.pointerId,{cancelable:u,timestamp:d}=e;return{type:"immediate-double-click",pointerId:c,pointerType:t,button:n,buttons:a,x:s,y:r,native:o,timestamp:d,mapPoint:this._getMapPoint(s,r),eventId:p,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:t,button:n,buttons:a,x:s,y:r,native:o}=e.data,{cancelable:p,timestamp:c}=e;return{type:"hold",pointerType:t,button:n,buttons:a,x:s,y:r,native:o,timestamp:c,mapPoint:this._getMapPoint(s,r),cancelable:p,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,t){return this.view.toMap(le(e,t),{exclude:[]})}_wrapDrag(e){const t=e.data,{x:n,y:a}=t.center,{action:s,pointerType:r,button:o}=t;if(s==="start"&&(this._latestDragStart=t),!this._latestDragStart)return;const p=t.pointer.native,c=t.buttons,{cancelable:u,timestamp:d}=e,m={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:n,y:a,origin:m,pointerType:r,button:o,buttons:c,radius:t.radius,angle:vn(t.angle),native:p,timestamp:d,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:t,repeat:n,native:a}=e.data,{cancelable:s,timestamp:r}=e;return{type:"key-down",key:t,repeat:n,native:a,timestamp:r,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:t,native:n}=e.data,{cancelable:a,timestamp:s}=e;return{type:"key-up",key:t,native:n,timestamp:s,cancelable:a,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,t){const{x:n,y:a,button:s,buttons:r,native:o,eventId:p}=e.data,c=o.pointerId,u=o.pointerType,{cancelable:d,timestamp:m}=e;return{type:t,x:n,y:a,pointerId:c,pointerType:u,button:s,buttons:r,native:o,timestamp:m,eventId:p,cancelable:d,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:t,y:n,buttons:a,native:s,eventId:r}=e.data.currentEvent,{button:o}=e.data.startEvent,p=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:m,timestamp:y}=e;return{type:"pointer-drag",x:t,y:n,pointerId:p,pointerType:c,button:o,buttons:a,action:u,origin:d,native:s,timestamp:y,eventId:r,cancelable:m,stopPropagation:()=>e.stopPropagation(),async:M=>e.async(M),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:t,data:n,timestamp:a}=e,{x:s,y:r,deltaY:o,native:p}=n;return{type:"mouse-wheel",x:s,y:r,deltaY:o,native:p,timestamp:a,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:t,state:n,device:a}=e.data,{cancelable:s,timestamp:r}=e,{buttons:o,axes:p}=n;return{type:"gamepad",device:a,timestamp:r,action:t,buttons:o,axes:p,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};function Da(i){return[i.on("before-add",e=>{const t=e.item;if(t==null||i.includes(t))return L.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();t.onAdd()}),i.on("after-remove",e=>{const t=e.item;t.active&&(t.view.activeTool=null),t.destroy()})]}function vt(i){return i.visible&&i.getEditableFlag!=null&&i.getEditableFlag(ft.USER)&&i.getEditableFlag(ft.MANAGER)}let Ia=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,t){const n=()=>e.stopPropagation();switch(e.type){case"pointer-move":ci(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!ui(e))break;const a=B(e),s=this._intersect(a,e.pointerType,t.forEachTool);if(s==null)break;const r=s.manipulator,o=s.tool;r==null||o==null||!r.interactive||r.grabbable&&r.grabbableForEvent(e)||!r.grabbing||r.dragging||this._ungrabManipulatorBeforeDragging(r,e,t),r!=null&&o!=null&&r.interactive&&r.grabbable&&r.grabbableForEvent(e)&&!r.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:r,tool:o,start:a,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&t.activeTool==null&&(this._revertToNullActiveTool=!0,t.setActiveTool(s.tool)),r.grabbing=!0,r.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:a}),n());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!ui(e))break;const a=this._grabbedManipulators.get(e.pointerId),s=a==null?void 0:a.manipulator,r=a==null?void 0:a.tool;if(s==null||r==null)break;const o=B(e);o.x=Ue(o.x,0,t.view.width),o.y=Ue(o.y,0,t.view.height);const p=a.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:p,screenPoint:o}):s.events.emit("drag",{action:"start",start:p,screenPoint:o,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:r,manipulator:s,start:p}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:p,screenPoint:o}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break}case"immediate-click":{const a=B(e),s=this._intersect(a,e.pointerType,t.forEachTool);if(Sa(e)||t.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:d})=>{d.selected&&(d.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:r,tool:o}=s;if(!r.interactive)break;r.selectable&&o.automaticManipulatorSelection&&(r.selected=!r.selected,o.onManipulatorSelectionChanged&&o.onManipulatorSelectionChanged());const p=e.native.shiftKey;r.events.emit("immediate-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:p,stopPropagation:n}),st(r,n);break}case"click":{const a=B(e),s=this._intersect(a,e.pointerType,t.forEachTool),r=s==null?void 0:s.manipulator;if(r==null||!r.interactive)break;const o=e.native.shiftKey;r.events.emit(e.type,{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:o}),n();break}case"double-click":{const a=B(e),s=this._intersect(a,e.pointerType,t.forEachTool),r=s!=null?s.manipulator:null;if(r==null||!r.interactive)break;const o=e.native.shiftKey;r.events.emit("double-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:n}),st(r,n);break}case"immediate-double-click":{const a=B(e),s=this._intersect(a,e.pointerType,t.forEachTool),r=s!=null?s.manipulator:null;if(r==null||!r.interactive)break;const o=e.native.shiftKey;r.events.emit("immediate-double-click",{screenPoint:a,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:n}),st(r,n);break}}this._onFocusChange(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,n){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:B(t)}),this._grabbedManipulators.forEach(({manipulator:a},s)=>{a===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(n.setActiveTool)}_handlePointerEnd(e,t){var a;const n=(a=this._grabbedManipulators.get(e.pointerId))==null?void 0:a.manipulator;n!=null&&n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:B(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(t.setActiveTool))}_cursorFromMap(e){let t=null;return Ct(e,({manipulator:n})=>!(n==null||!n.interactive)&&(n.grabbing&&n.grabCursor?(t=n.grabCursor,!0):!!n.cursor&&(t=n.cursor,!0))),t}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set,n=new Set;this._grabbedManipulators.forEach(({tool:a})=>{t.add(a)}),this._hoveredManipulators.forEach(({tool:a})=>{n.add(a)}),e(a=>{a.hasGrabbedManipulators=t.has(a),a.hasHoveredManipulators=n.has(a);const s=this._grabbedManipulators.values(),r=wn(s,({tool:o})=>o===a);a.firstGrabbedManipulator=r!=null?r.manipulator:null})}clearPointers(e,{forEachTool:t,setActiveTool:n},a=!0,s){const r=(o,p)=>o===e&&(s==null||s===p);this._grabbedManipulators.forEach(({tool:o,manipulator:p,pointerType:c},u)=>{r(o,p)&&(this._grabbedManipulators.delete(u),p.grabbing=!1,p.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:o,manipulator:p},c)=>{r(o,p)&&(this._draggedManipulators.delete(c),p.dragging=!1,p.events.emit("drag",{action:"cancel"}))}),a&&this._hoveredManipulators.forEach(({tool:o,manipulator:p},c)=>{r(o,p)&&(this._hoveredManipulators.delete(c),p.hovering=!1)}),this._afterManipulatorUngrab(n),this._onFocusChange(t)}_intersect(e,t,n){let a=null;return n(s=>{if(s.manipulators==null||!vt(s))return!1;const r=s.manipulators.intersect(e,t);return r!=null&&(a={tool:s,manipulator:r},!0)}),a}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((t,n)=>{this._updateHoveredStateForPointerAtScreenPosition(le(t.x,t.y),n,t.pointerType,e)})}handleHoverEvent(e,t){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!ci(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(B(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,n,a){var o;let s=this._intersect(e,n,a);const r=(o=this._hoveredManipulators.get(t))==null?void 0:o.manipulator;s==null||s.manipulator.interactive||(s=null),s!=null&&r===s.manipulator||(r!=null&&(r.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(t,s)):this._hoveredManipulators.delete(t),this._onFocusChange(a))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function ci(i){return i==="mouse"}function ui(i){return i.pointerType!=="mouse"||i.button===0}function Sa(i){return!!i.native.shiftKey}function st(i,e){i!=null&&i.consumesClicks&&e()}const di="attached",rt="tools",mi=1e3;let z=class extends ${constructor(e){super(e),this._updatingHandles=new Ye,this._clock=Ke,this._manipulatorState=new Ia,this.tools=new R,this.cursor=null,this._interacting=!1,this._interactingTimeout=mi,this._interactingTimeoutHandle=null,this._forEachTool=t=>{for(const n of this.tools.items)if(t(n))return}}initialize(){this.addHandles([this.view.on(Fi,e=>{this._handleInputEvent(e)},Lt.TOOL),...Da(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.activeTool=null,this.tools.drain(e=>e.destroy()),this._clearInteractingTimeout(),this._interacting=!1,this._updatingHandles.destroy()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void L.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),t!=null&&t.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const n of this.tools){this._updateToolEditableFlag(n);const a=vt(n);this.activeTool!=null&&a||this._manipulatorState.clearPointers(n,this._manipulatorStateEventArgs,!a)}this._updateCursor()}get updating(){return this._updatingHandles.updating||this.tools.some(e=>e.updating)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeoutHandle=ye(this._interactingTimeoutHandle)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeoutHandle=this._clock.setTimeout(()=>this._interacting=!1,this._interactingTimeout)}attach(){var e;this.view.type==="3d"?this.addHandles([w(()=>{const{state:t}=this.view;return"camera"in t&&t.camera},()=>this._forEachManipulator(t=>t.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",t=>this._forEachManipulator(n=>n.onElevationChange(t)))],di):this.addHandles(w(()=>this.view.extent,()=>this._forEachManipulator(t=>t.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.removeHandles(di),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:n})=>e(n,t))})}_handleInputEvent(e){let t=!1;const n={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(n):this._forEachTool(a=>{!t&&a.visible&&a.handleInputEvent(n)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(n,this._manipulatorStateEventArgs),t||this.activeTool==null||this.activeTool.handleInputEventAfter(n),this._manipulatorState.handleHoverEvent(n,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.removeHandles(rt),this._forEachTool(e=>{if(e instanceof $){const t=w(()=>[e.cursor,e.visible,e.editable],()=>{vt(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.addHandles(t,rt)}e.manipulators&&this.addHandles([e.manipulators.on("after-remove",t=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,t.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],rt)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var t;(t=e.setEditableFlag)==null||t.call(e,ft.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(t=>!(t.cursor==null||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(e==null||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}get test(){const e=this;return{setClock:t=>this._clock=t,set interactingTimeoutEnabled(t){e._interactingTimeout=t?mi:0},get interactingTimeoutEnabled(){return e._interactingTimeout!==0}}}};l([h({constructOnly:!0,nonNullable:!0})],z.prototype,"view",void 0),l([h({value:null})],z.prototype,"activeTool",null),l([h({readOnly:!0,type:R})],z.prototype,"tools",void 0),l([h({readOnly:!0})],z.prototype,"cursor",void 0),l([h({readOnly:!0})],z.prototype,"updating",null),l([h()],z.prototype,"_interacting",void 0),l([h({readOnly:!0})],z.prototype,"interacting",null),z=l([v("esri.views.ToolViewManager")],z);let me=class extends ${constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Ra.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Va[this.deviceType]}};l([h({nonNullable:!0,readOnly:!0})],me.prototype,"nativeIndex",void 0),l([h({type:String,readOnly:!0})],me.prototype,"deviceType",null),l([h({type:Number,readOnly:!0})],me.prototype,"axisThreshold",null),me=l([v("esri.views.input.gamepad.GamepadInputDevice")],me);const Ra=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Va={standard:.15,spacemouse:.025,unknown:0},Ot=me;let be=class extends ${constructor(...e){super(...e),this.devices=new R,this.enabledFocusMode="document"}};l([h({type:R.ofType(Ot),readOnly:!0})],be.prototype,"devices",void 0),l([h({type:["document","view","none"]})],be.prototype,"enabledFocusMode",void 0),be=l([v("esri.views.input.gamepad.GamepadSettings")],be);const La=be;let He=class extends ${constructor(){super(...arguments),this.gamepad=new La}};l([h({readOnly:!0})],He.prototype,"gamepad",void 0),He=l([v("esri.views.input.Input")],He);const Aa=He;let te=class extends ${constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};l([h({type:Boolean,nonNullable:!0})],te.prototype,"enabled",void 0),l([h({type:Ot})],te.prototype,"device",void 0),l([h({type:["pan","zoom"],nonNullable:!0})],te.prototype,"mode",void 0),l([h({type:["forward-down","forward-up"],nonNullable:!0})],te.prototype,"tiltDirection",void 0),l([h({type:Number,nonNullable:!0})],te.prototype,"velocityFactor",void 0),te=l([v("esri.views.navigation.gamepad.GamepadSettings")],te);const ji=te;let se=class extends ${constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ji,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};l([h({type:Boolean})],se.prototype,"browserTouchPanEnabled",void 0),l([h({type:ji,nonNullable:!0})],se.prototype,"gamepad",void 0),l([h({type:Boolean})],se.prototype,"momentumEnabled",void 0),l([h({type:Boolean})],se.prototype,"mouseWheelZoomEnabled",void 0),se=l([v("esri.views.navigation.Navigation")],se);const Ui=se;let wt,ot=null;async function Oa(i){ot||(ot=mt(()=>import("./geometryServiceUtils-3e048225.js"),["assets/geometryServiceUtils-3e048225.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/project-1bd91657.js"]).then(e=>wt=e)),await ot,Me(i)}async function Wi(i,e,t,n){if(!i)return null;const a=i.spatialReference;return $t()||Et(a,e)?Dt(i,e):wt?wt.projectGeometry(i,e,t,n):(await Promise.race([Oa(n),It(n)]),Wi(i,e,t,n))}let _=class extends ${constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=gt(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var n,a,s,r;const e=(n=this.map)==null?void 0:n.call(this),t=[];return this.priorityCollection!=null&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(a=e==null?void 0:e.basemap)==null?void 0:a.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let n=null;for(const s of e){const r=this._getSupportedSpatialReferences(s);if(r.length>0){const o=this._narrowDownSpatialReferenceCandidates(n,r);o!=null&&(n=o)}if(n!=null&&n.length===1)break}if(t&&(n==null||n.length!==1))return{updating:!0};const a=this._pickSpatialReferenceCandidate(n);return{spatialReference:a!=null?a.spatialReference:null,viewingMode:a!=null?a.viewingMode:null,updating:!1}}get _tileInfoTask(){var n,a,s,r,o,p,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(a=(n=this.map)==null?void 0:n.call(this))==null?void 0:a.basemap,layers:(o=(r=(s=this.map)==null?void 0:s.call(this))==null?void 0:r.basemap)==null?void 0:o.baseLayers},{layers:(c=(p=this.map)==null?void 0:p.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var n,a,s;if(!this.required.heightModelInfo||this.suspended&&((n=this._get("_heightModelInfoTask"))!=null&&n.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const r of e)if(ra(r)){const o=oa(r);if(o)return{heightModelInfo:o,vcsWkid:(a=r.spatialReference)==null?void 0:a.vcsWkid,latestVcsWkid:(s=r.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,n=[];for(const a of e.layers){const s="fullExtents"in a&&a.fullExtents||(a.fullExtent!=null?[a.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:s[0],o=s.find(p=>p.spatialReference.equals(this.spatialReference))??r;if(o)return{candidates:[{extent:o,layer:a}],updating:!1};if(this._getSupportedSpatialReferences(a).length>0)for(const p of s)n.push({extent:p,layer:a})}return{candidates:n,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const n=this._pickExtentCandidate(e),a=this.spatialReference;return n.extent.equals(this._projectExtentTask.input)&&a.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=gt(this._projectExtentTask.task)),this._projectExtentTask={input:n.extent.clone(),output:null,spatialReference:a.clone(),task:Mt(async s=>{try{const r=await Wi(n.extent,a,"portalItem"in n.layer?n.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:r}}catch{if(bn(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(e==null)return t;const n=[],a=(s,r)=>s!=null?r!=null?s===r&&s:s:r;for(const s of e)for(const r of t){if(!s.spatialReference.equals(r.spatialReference))continue;const o=a(s.viewingMode,r.viewingMode);if(o!==!1){n.push({spatialReference:s.spatialReference,viewingMode:o});break}}return n.length>0?n:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return e==null||e.length<1?t!=null?{spatialReference:t,viewingMode:null}:null:(t!=null&&e.length>1&&e.some(({spatialReference:n})=>n.equals(t))&&(e=e.filter(({spatialReference:n})=>n.equals(t))),e.length>1&&e.some(({viewingMode:n})=>n!==si.Local)&&(e=e.filter(({viewingMode:n})=>n!==si.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const n=[];for(const a of t){const s=this.getSpatialReferenceSupport({spatialReference:a,layer:e});if(s!=null){const r=s.constraints!=null?s.constraints:[{spatialReference:a,viewingMode:null}];for(const{spatialReference:o,viewingMode:p}of r)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!o.equals(this.userSpatialReference)||n.push({spatialReference:o,viewingMode:p})}}return n}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:n})=>t.equals(n.spatialReference))||e[0]}_collectLayers(e){var n;if(this._loadMaybe((n=this.map)==null?void 0:n.call(this))!=="loaded")return{layers:[],updating:!0};const t=new Na;for(const a of e)if(this._collectCollection(a,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const n of e.layers){switch(this._loadMaybe(n)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(n),"layers"in n&&this._collectCollection({layers:n.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(t=>{Ti(t)||console.log(t)}),"loading"):e.loadStatus:"loaded"}};l([h()],_.prototype,"required",void 0),l([h({constructOnly:!0})],_.prototype,"map",void 0),l([h({constructOnly:!0})],_.prototype,"getSpatialReferenceSupport",void 0),l([h()],_.prototype,"defaultSpatialReference",void 0),l([h()],_.prototype,"userSpatialReference",void 0),l([h()],_.prototype,"sourcePreloadCount",void 0),l([h()],_.prototype,"priorityCollection",void 0),l([h()],_.prototype,"requiresExtentInSpatialReference",void 0),l([h()],_.prototype,"suspended",void 0),l([h({readOnly:!0})],_.prototype,"ready",null),l([h({readOnly:!0})],_.prototype,"heightModelInfoReady",null),l([h({readOnly:!0})],_.prototype,"spatialReference",null),l([h({readOnly:!0})],_.prototype,"extent",null),l([h({readOnly:!0})],_.prototype,"heightModelInfo",null),l([h({readOnly:!0})],_.prototype,"vcsWkid",null),l([h({readOnly:!0})],_.prototype,"latestVcsWkid",null),l([h({readOnly:!0})],_.prototype,"viewingMode",null),l([h({readOnly:!0})],_.prototype,"tileInfo",null),l([h({readOnly:!0})],_.prototype,"mapCollections",null),l([h({readOnly:!0})],_.prototype,"_allLayers",null),l([h({readOnly:!0})],_.prototype,"_spatialReferenceTask",null),l([h({readOnly:!0})],_.prototype,"_tileInfoTask",null),l([h({readOnly:!0})],_.prototype,"_heightModelInfoTask",null),l([h({readOnly:!0})],_.prototype,"_extentCandidatesTask",null),l([h()],_.prototype,"_extentTask",null),l([h()],_.prototype,"_projectExtentTask",void 0),_=l([v("esri.views.support.DefaultsFromMap")],_);let Na=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var ke;let g=ke=class extends Ci.EventedMixin(kn($)){constructor(i){super(i),this._userSpatialReference=null,this._cursor=null,this.handles=new xn,this.updatingHandles=new Ye,this.allLayerViews=new aa({getCollections:()=>{var e,t,n;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(t=this.groundView)==null?void 0:t.layerViews,this.layerViews,(n=this.basemapView)==null?void 0:n.referenceLayerViews]},getChildrenFunction:Ha}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new $i,this.analyses=new Be,this.typeSpecificPreconditionsReady=!0,this.layerViews=new R,this.magnifier=new Gi,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Aa,this.navigation=new Ui,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new $a(this),this.persistableViewModels=new R,this._isValid=!1,this._readyCycleForced=!1,this._lockedSpatialReference=null,this._userTimeZone=null,this._lockedTimeZone=null,this.theme=null,this.handles.add(w(()=>this.preconditionsReady,e=>{var t,n;e?(this._lockedSpatialReference=this.spatialReference,this._lockedTimeZone=this.timeZone,ke.views.add(this)):(this._lockedSpatialReference=null,ke.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((t=this.toolViewManager)==null||t.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(n=this.layerViewManager)==null||n.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Mn))}initialize(){this.addResolvingPromise(Promise.all([this.loadAsyncDependencies(),this.validate()]).then(()=>(this._isValid=!0,xt(()=>this.ready)))),this.basemapView=new ee({view:this}),this.layerViewManager=new Ta({view:this,layerViewImporter:{importLayerView:i=>this.importLayerView(i),hasLayerViewModule:i=>this.hasLayerViewModule(i)},supportsGround:this.supportsGround}),this.toolViewManager=new z({view:this}),this._setupSpatialReferenceLogger(),this.addHandles([w(()=>this.initialExtentRequired,i=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:i},{sync:!0,initial:!0}),w(()=>this.ready,i=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=i,this.defaultsFromMap.userSpatialReference=i?this.spatialReference:this._userSpatialReference)},{sync:!0}),w(()=>this._userSpatialReference,i=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=i)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let i=null;this.addHandles([w(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var n;const t=((n=this.map)==null?void 0:n.allLayers.length)>0;if(e&&!this.spatialReference&&t){if(i!=null)return;const a=Pi(()=>i=gt(i));i=Mt(async s=>{try{await Tn(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{i=null}L.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.addHandles(a,"spatial-reference-logger-task")}else this.removeHandles("spatial-reference-logger-task")},{sync:!0})])}destroy(){var i,e;this.destroyed||(ke.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Z(this.graphics),this.analyses=Z(this.analyses),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Z(this.analysisViewManager),this.toolViewManager=Z(this.toolViewManager),this.layerViewManager=Z(this.layerViewManager),this.basemapView=Z(this.basemapView),(i=this.groundView)==null||i.destroy(),(e=this.layerViews)==null||e.forEach(t=>t.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.destroy(),this.map=Z(this.map),this.updatingHandles.destroy())}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return L.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var i;return(i=this.toolViewManager)==null?void 0:i.activeTool}set activeTool(i){this.toolViewManager&&(this.toolViewManager.activeTool=i)}get animation(){return this._get("animation")}set animation(i){this._set("animation",i)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:i=>this.getSpatialReferenceSupport(i),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(i){this._set("extent",i)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var i;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Zt.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._lockedSpatialReference&&!((i=this.defaultsFromMap)!=null&&i.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(i){i!==this._get("map")&&(i!=null&&i.destroyed&&(L.getLogger(this).warn("#map","The provided map is already destroyed",{map:i}),i=null),Zt.isLoadable(i)&&i.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._lockedSpatialReference=null),this._set("map",i))}get spatialReference(){var e,t;let i=this._userSpatialReference||this._lockedSpatialReference||this.getDefaultSpatialReference()||null;return i&&((t=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&t.heightModelInfo)&&(i=i.clone(),i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),i}set spatialReference(i){const e=!St(i,this._get("spatialReference"));this._set("_userSpatialReference",i),e&&(this._set("spatialReference",i),this._spatialReferenceChanged(i))}_spatialReferenceChanged(i){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get timeZone(){return this._userTimeZone??this._lockedTimeZone??this.getDefaultTimeZone()??Yt}set timeZone(i){const e=new Set(["etc/utc","etc/gmt","gmt"]),t=new Set(Intl.supportedValuesOf("timeZone").map(n=>n.toLowerCase()));this._userTimeZone=i,i===Yt||i===Pn||e.has(i.toLowerCase())||t.has(i.toLowerCase())||L.getLogger(this).warn("#timeZone",`the parsed value '${i}' may not be a valid IANA time zone`)}get tools(){var i;return(i=this.toolViewManager)==null?void 0:i.tools}get initialExtent(){var i;return(i=this.defaultsFromMap)==null?void 0:i.extent}get cursor(){var i;return((i=this.toolViewManager)==null?void 0:i.cursor)??this._cursor??"default"}set cursor(i){this._cursor=i,this.notifyChange("cursor")}get size(){return[this.width,this.height]}get effectiveTheme(){return this.theme??new _t}whenLayerView(i){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(i))??Promise.reject()}getDefaultSpatialReference(){var i;return(i=this.defaultsFromMap)==null?void 0:i.spatialReference}getDefaultHeightModelInfo(){var i;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)??null}getDefaultTimeZone(){return null}importLayerView(i){throw new I("importLayerView() not implemented")}hasLayerViewModule(i){return!1}async validate(){}async loadAsyncDependencies(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(i){return this.getSpatialReferenceSupport({spatialReference:i})!=null}when(i,e){return this.isResolved()&&!this.ready&&L.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(i,e)}forceReadyCycle(){this.ready&&(Ei(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(i){this.toolViewManager.tools.add(i),this.activeTool=i}tryFatalErrorRecovery(){this.fatalError=null}};g.views=new R,l([h()],g.prototype,"_userSpatialReference",void 0),l([h()],g.prototype,"activeTool",null),l([h({readOnly:!0})],g.prototype,"allLayerViews",void 0),l([h()],g.prototype,"groundView",void 0),l([h()],g.prototype,"animation",null),l([h()],g.prototype,"basemapView",void 0),l([h()],g.prototype,"center",null),l([h({readOnly:!0})],g.prototype,"_defaultsFromMapSettings",null),l([h()],g.prototype,"defaultsFromMap",null),l([h()],g.prototype,"fatalError",void 0),l([h({type:$e})],g.prototype,"extent",null),l([h(Qt($i,"graphics"))],g.prototype,"graphics",void 0),l([h(Qt(Be,"analyses"))],g.prototype,"analyses",void 0),l([h({readOnly:!0,type:sa})],g.prototype,"heightModelInfo",null),l([h({readOnly:!0})],g.prototype,"interacting",null),l([h({readOnly:!0})],g.prototype,"navigating",null),l([h({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_lockedSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],g.prototype,"preconditionsReady",null),l([h({readOnly:!0})],g.prototype,"typeSpecificPreconditionsReady",void 0),l([h({type:R,readOnly:!0})],g.prototype,"layerViews",void 0),l([h()],g.prototype,"resolution",null),l([h({type:Gi})],g.prototype,"magnifier",void 0),l([h({value:null,type:na})],g.prototype,"map",null),l([h()],g.prototype,"padding",void 0),l([h({readOnly:!0})],g.prototype,"ready",void 0),l([h({type:Rt})],g.prototype,"spatialReference",null),l([h()],g.prototype,"spatialReferenceWarningDelay",void 0),l([h()],g.prototype,"stationary",null),l([h({readOnly:!0})],g.prototype,"supportsGround",void 0),l([h({type:Cn})],g.prototype,"timeExtent",void 0),l([h({type:String,nonNullable:!0})],g.prototype,"timeZone",null),l([h()],g.prototype,"tools",null),l([h()],g.prototype,"toolViewManager",void 0),l([h({readOnly:!0})],g.prototype,"type",void 0),l([h({type:Number})],g.prototype,"scale",void 0),l([h({readOnly:!0})],g.prototype,"updating",void 0),l([h({readOnly:!0})],g.prototype,"initialExtentRequired",void 0),l([h({readOnly:!0})],g.prototype,"initialExtent",null),l([h()],g.prototype,"cursor",null),l([h({readOnly:!0})],g.prototype,"input",void 0),l([h({type:Ui,nonNullable:!0})],g.prototype,"navigation",void 0),l([h()],g.prototype,"layerViewManager",void 0),l([h()],g.prototype,"analysisViewManager",void 0),l([h()],g.prototype,"width",void 0),l([h()],g.prototype,"height",void 0),l([h({readOnly:!0})],g.prototype,"resizing",void 0),l([h({value:null,readOnly:!0})],g.prototype,"size",null),l([h({readOnly:!0})],g.prototype,"suspended",void 0),l([h({readOnly:!0})],g.prototype,"viewEvents",void 0),l([h({readOnly:!0})],g.prototype,"persistableViewModels",void 0),l([h()],g.prototype,"_isValid",void 0),l([h()],g.prototype,"_readyCycleForced",void 0),l([h()],g.prototype,"_lockedSpatialReference",void 0),l([h()],g.prototype,"_userTimeZone",void 0),l([h()],g.prototype,"_lockedTimeZone",void 0),l([h({type:_t})],g.prototype,"theme",void 0),l([h({readOnly:!0,type:_t})],g.prototype,"effectiveTheme",null),g=ke=l([v("esri.views.View")],g);const Er=g;function Ha(i){return i.layerViews}let ie=class extends $n{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Tt(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new I("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,t){t||(t=En(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};l([h({readOnly:!0})],ie.prototype,"done",null),l([h({readOnly:!0,type:String})],ie.prototype,"state",void 0),l([h()],ie.prototype,"target",void 0),ie=l([v("esri.views.ViewAnimation")],ie),function(i){i.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(ie||(ie={}));const Ir=ie,Bi=96,Ki=39.37,Ga=180/Math.PI;function Zi(i){return i.wkid?i:i.spatialReference||Rt.WGS84}function Nt(i,e){return e.type?C(i,e.x,e.y):yt(i,e)}function Yi(i){return Dn(i)}function Ge(i,e){const t=Math.max(1,e[0]),n=Math.max(1,e[1]);return Math.max(i.width/t,i.height/n)*Ba(i.spatialReference)}async function xe(i,e,t,n){var o,p;let a,s;if(!i||Array.isArray(i)&&!i.length)return null;if(R.isCollection(i)&&(i=i.toArray()),Array.isArray(i)&&i.length&&typeof i[0]=="object"){const c=i.every(m=>"attributes"in m),u=i.some(m=>!m.geometry);let d=i;if(c&&u&&e&&e.allLayerViews){const m=new Map;for(const k of i){const b=k.layer,E=m.get(b)||[],f=k.attributes[b.objectIdField];f!=null&&E.push(f),m.set(b,E)}const y=[];m.forEach((k,b)=>{const E=e.allLayerViews.find(f=>f.layer.id===b.id);if(E&&"queryFeatures"in E){const f=b.createQuery();f.objectIds=k,f.returnGeometry=!0,y.push(E.queryFeatures(f))}});const M=await Promise.all(y),G=[];for(const k of M)if(k&&k.features&&k.features.length)for(const b of k.features)b.geometry!=null&&G.push(b.geometry);d=G}for(const m of d)n=await xe(m,e,t,n);return n}if(Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number")a=new Vt(i);else if(i instanceof Ln)a=i;else if("geometry"in i){if(i.geometry)a=i.geometry;else if(i.layer){const c=i.layer,u=e.allLayerViews.find(d=>d.layer.id===c.id);if(u&&"queryFeatures"in u){const d=c.createQuery();d.objectIds=[i.attributes[c.objectIdField]],d.returnGeometry=!0;const m=await u.queryFeatures(d);a=(p=(o=m==null?void 0:m.features)==null?void 0:o[0])==null?void 0:p.geometry}}}if(a==null)return null;switch(a.type){case"point":s=new $e({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":s=An(a);break;default:s=a.extent}if(!s)return null;$t()||Et(s.spatialReference,t)||await It();const r=Dt(s,t);return r?n=n?n.union(r):r:null}function Fa(i){var e;if(i&&(!Array.isArray(i)||typeof i[0]!="number")&&(typeof i=="object"||Array.isArray(i)&&typeof i[0]=="object")){if("layer"in i&&((e=i.layer)==null?void 0:e.minScale)!=null&&i.layer.maxScale!=null){const t=i.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(i)&&i.length&&i.every(t=>"layer"in t)){let t=0,n=0;for(const a of i){const s=a.layer;s!=null&&s.minScale&&s.maxScale&&(t=s.minScale<t?s.minScale:t,n=s.maxScale>n?s.maxScale:n)}return t&&n?{min:t,max:n}:null}}}function lt(i,e){return St(Zi(i),e)?i:Dt(i,e)}async function Sr(i,e){var G;if(!i||!e)return new Te({targetGeometry:new Vt,scale:0,rotation:0});let t=e.spatialReference;const{constraints:n,padding:a,viewpoint:s,size:r}=e,o=[a?r[0]-a.left-a.right:r[0],a?r[1]-a.top-a.bottom:r[1]];let p=null;i instanceof Te?p=i:i.viewpoint?p=i.viewpoint:i.target&&i.target.declaredClass==="esri.Viewpoint"&&(p=i.target);let c=null;p!=null&&p.targetGeometry?c=p.targetGeometry:i instanceof $e?c=i:(i||i&&("center"in i||"extent"in i||"target"in i))&&(c=await xe(i.center,e,t)||await xe(i.extent,e,t)||await xe(i.target,e,t)||await xe(i,e,t)),!c&&(s!=null&&s.targetGeometry)?c=s.targetGeometry:!c&&e.extent&&(c=e.extent),t||(t=Zi(e.spatialReference||e.extent||c)),$t()||St(c.spatialReference,t)||Et(c.spatialReference,t)||await It();const u=lt("center"in c?c.center:c,t);e.pickClosestTarget!==!1&&u.type==="point"&&((G=s.targetGeometry)==null?void 0:G.type)==="point"&&(u.x=Ii(u.x,s.targetGeometry.x,u.spatialReference));let d=0;if((p==null?void 0:p.targetGeometry)!=null&&p.targetGeometry.type==="point")d=p.scale;else if("scale"in i&&i.scale)d=i.scale;else if("zoom"in i&&i.zoom!==-1&&n&&n.effectiveLODs)d=n.zoomToScale(i.zoom);else if(Array.isArray(c)||c.type==="point"||c.type==="extent"&&c.width===0&&c.height===0){const k=lt(e.extent,t);d=k!=null?Ge(k,o):e.extent?Ge(e.extent,o):s.scale}else d=Ge(lt(c.extent,t),o);const m=Fa(i.target??i);m&&(m.min&&m.min<d?d=m.min:m.max&&m.max>d&&(d=m.max));let y=0;p?y=p.rotation:i.hasOwnProperty("rotation")?y=i.rotation:s&&(y=s.rotation);let M=new Te({targetGeometry:u,scale:d,rotation:y});return n&&(M=n.fit(M),n.constrainByGeometry(M),n.rotationEnabled||(M.rotation=s.rotation)),M}function Y(i,e){const t=i.targetGeometry,n=e.targetGeometry;return t.x=n.x,t.y=n.y,t.spatialReference=n.spatialReference,i.scale=e.scale,i.rotation=e.rotation,i}function za(i,e,t){return t?C(i,.5*(e[0]-t.right+t.left),.5*(e[1]-t.bottom+t.top)):Ze(i,e,.5)}const qa=function(){const i=x();return function(e,t,n){const a=t.targetGeometry;Nt(i,a);const s=.5*_e(t);return e.xmin=i[0]-s*n[0],e.ymin=i[1]-s*n[1],e.xmax=i[0]+s*n[0],e.ymax=i[1]+s*n[1],e.spatialReference=a.spatialReference,e}}();function Rr(i,e,t,n,a){var s;return Ja(i,e,t.center),i.scale=Ge(t,n),(s=a==null?void 0:a.constraints)==null||s.constrain(i),i}function ja(i,e,t,n){return Ft(i,e,t,n),Hi(i,i)}const Qi=function(){const i=x();return function(e,t,n){return Si(e,Ka(e,t),za(i,t,n))}}(),Ua=function(){const i=oe(),e=x();return function(t,n,a,s){const r=_e(n),o=Ht(n);return C(e,r,r),ha(i,e),At(i,i,o),We(i,i,Qi(e,a,s)),We(i,i,[0,s.top-s.bottom]),C(t,i[4],i[5])}}();function _e(i){return i.scale*Wa(i.targetGeometry)}function Wa(i){return i!=null&&Di(i.spatialReference)?1/(Yi(i.spatialReference)*Ki*Bi):1}function Ht(i){return Ri(i.rotation)||0}function Ba(i){return Di(i)?Yi(i)*Ki*Bi:1}function Ka(i,e){return Ze(i,e,.5)}const Gt=function(){const i=x(),e=x(),t=x();return function(n,a,s,r,o,p){return In(i,a),Ze(e,s,.5*p),C(t,1/r*p,-1/r*p),Oi(n,e),o&&At(n,n,o),Ni(n,n,t),We(n,n,i),n}}(),Ft=function(){const i=x();return function(e,t,n,a){const s=_e(t),r=Ht(t);return Nt(i,t.targetGeometry),Gt(e,i,n,s,r,a)}}(),Za=function(){const i=x();return function(e,t,n,a){const s=_e(t);return Nt(i,t.targetGeometry),Gt(e,i,n,s,0,a)}}();function Ya(i){const e=On(i);return e?e.valid[1]-e.valid[0]:0}function Qa(i,e){return Math.round(Ya(i)/e)}const Vr=function(){const i=x(),e=x(),t=[0,0,0];return function(n,a,s){Jt(i,n,a),Xt(i,i),Jt(e,n,s),Xt(e,e),Sn(t,i,e);let r=Math.acos(Rn(i,e)/(ei(i)*ei(e)))*Ga;return t[2]<0&&(r=-r),isNaN(r)&&(r=0),r}}(),Lr=function(){const i=x();return function(e,t,n,a){const s=e.targetGeometry;return Y(e,t),Ua(i,t,n,a),s.x+=i[0],s.y+=i[1],e}}(),Ja=function(i,e,t){Y(i,e);const n=i.targetGeometry;return n.x=t.x,n.y=t.y,n.spatialReference=t.spatialReference,i},Ar=function(){const i=x();return function(e,t,n,a,s){s||(s="center"),Si(i,n,a),Ze(i,i,.5);const r=i[0],o=i[1];switch(s){case"center":C(i,0,0);break;case"left":C(i,-r,0);break;case"top":C(i,0,o);break;case"right":C(i,r,0);break;case"bottom":C(i,0,-o);break;case"top-left":C(i,-r,o);break;case"bottom-left":C(i,-r,-o);break;case"top-right":C(i,r,o);break;case"bottom-right":C(i,r,-o)}return zt(e,t,i),e}}();function Or(i,e,t){return Y(i,e),i.rotation+=t,i}function Nr(i,e,t){return Y(i,e),i.rotation=t,i}const Xa=function(){const i=x();return function(e,t,n,a,s){return Y(e,t),isNaN(n)||n===0||(Ji(i,a,t,s),e.scale=t.scale*n,Xi(i,i,e,s),zt(e,e,C(i,i[0]-a[0],a[1]-i[1]))),e}}();function Hr(i,e,t){return Y(i,e),i.scale=t,i}const es=function(){const i=x();return function(e,t,n,a,s,r){return Y(e,t),isNaN(n)||n===0||(Ji(i,s,t,r),e.scale=t.scale*n,e.rotation+=a,Xi(i,i,e,r),zt(e,e,C(i,i[0]-s[0],s[1]-i[1]))),e}}(),Gr=function(){const i=x(),e=x();return function(t,n,a,s,r,o,p){return Qi(e,o,p),Nn(i,r,e),s?es(t,n,a,s,i,o):Xa(t,n,a,i,o)}}(),Ji=function(){const i=oe();return function(e,t,n,a){return j(e,t,ja(i,n,a,1))}}(),Xi=function(){const i=oe();return function(e,t,n,a){return j(e,t,Ft(i,n,a,1))}}(),zt=function(){const i=x(),e=oe();return function(t,n,a){Y(t,n);const s=_e(n),r=t.targetGeometry;return la(e,Ht(n)),Ni(e,e,Vn(s,s)),j(i,a,e),r.x+=i[0],r.y+=i[1],t}}();function ts(i){return i instanceof Float32Array&&i.length>=2}function is(i){return Array.isArray(i)&&i.length>=2}function Ve(i){return ts(i)||is(i)}var bt;const T=[0,0];let ne=bt=class extends Hn{constructor(i){super(i),this._viewpoint2D={center:x(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new $e,this.id=0,this.inverseTransform=oe(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=oe(),this.transformNoRotation=oe(),this.displayMat3=tt(),this.displayViewMat3=tt(),this.viewMat3=tt(),this.viewMat2d=pa(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(i){this._set("pixelRatio",i),this._update()}set size(i){this._set("size",i),this._update()}set viewpoint(i){if(i){const e=this._viewpoint2D,t=i.targetGeometry;e.center[0]=t.x,e.center[1]=t.y,e.rotation=i.rotation,e.scale=i.scale,e.spatialReference=t.spatialReference}this._update()}copy(i){const e=this.size,t=this.viewpoint;return t&&e?(this.viewpoint=Y(t,i.viewpoint),this._set("size",yt(e,i.size))):(this.viewpoint=i.viewpoint.clone(),this._set("size",[i.size[0],i.size[1]])),this._set("pixelRatio",i.pixelRatio),this}clone(){return new bt({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(i,e,t){return Ve(e)?j(i,e,this.inverseTransform):(T[0]=e,T[1]=t,j(i,T,this.inverseTransform))}toScreen(i,e,t){return Ve(e)?j(i,e,this.transform):(T[0]=e,T[1]=t,j(i,T,this.transform))}toScreenNoRotation(i,e,t){return Ve(e)?j(i,e,this.transformNoRotation):(T[0]=e,T[1]=t,j(i,T,this.transformNoRotation))}toScreenClosest(i,e,t){Ve(e)?(T[0]=e[0],T[1]=e[1]):(T[0]=e,T[1]=t);const[n]=T,{center:a,extent:s,spatialReference:r,transform:o}=this;return(n<s.xmin||n>s.xmax)&&(T[0]=Ii(n,a[0],r)),j(i,T,o)}getScreenTransform(i,e){const{center:t}=this._viewpoint2D,n=this._get("pixelRatio")||1,a=this._get("size");return Gt(i,t,a,e,0,n),i}_update(){const{center:i,spatialReference:e,scale:t,rotation:n}=this._viewpoint2D,a=this._get("pixelRatio")||1,s=this._get("size"),r=new Te({targetGeometry:new Vt(i[0],i[1],e),scale:t,rotation:n});if(this._set("viewpoint",r),!s||!e||!t)return;this.resolution=_e(r),this.rotation=n,this.scale=t,this.spatialReference=e,yt(this.center,i);const o=s[0]!==0?2/s[0]:0,p=s[1]!==0?-2/s[1]:0;Gn(this.displayMat3,o,0,0,0,p,0,-1,1,1);const c=Fn(this.viewMat3),u=ri(s[0]/2,s[1]/2),d=ri(-s[0]/2,-s[1]/2),m=Ri(n);ti(c,c,u),zn(c,c,m),ti(c,c,d),qn(this.displayViewMat3,this.displayMat3,c);const y=Oi(this.viewMat2d,u);return At(y,y,m),We(y,y,d),qa(this.extent,r,s),Ft(this.transform,r,s,a),Hi(this.inverseTransform,this.transform),Za(this.transformNoRotation,r,s,a),this.worldScreenWidth=Qa(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};l([h({readOnly:!0})],ne.prototype,"id",void 0),l([h({value:1,json:{write:!0}})],ne.prototype,"pixelRatio",null),l([h({json:{write:!0}})],ne.prototype,"size",null),l([h()],ne.prototype,"spatialReference",void 0),l([h({type:Te,json:{write:!0}})],ne.prototype,"viewpoint",null),ne=bt=l([v("esri.views.2d.ViewState")],ne);const Fr=ne;function zr(i,e){switch(e){case"primary":return i.pointerType==="touch"||i.button===0;case"secondary":return i.pointerType!=="touch"&&i.button===2;case"tertiary":return i.pointerType!=="touch"&&i.button===1}}function qr(i,e){if(i.pointerType==="touch")return!1;switch(e){case"primary":return i.button===0;case"secondary":return i.button===2;case"tertiary":return i.button===1}}let jr=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const t=e.data,n=t.pointers.size;switch(t.action){case"start":this._currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var t,n;this._startEvent=e,(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var t,n;(n=(t=this._callbacks).condition)!=null&&n.call(t,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}};function H(i){let e=i*i;return i<0&&(e*=-1),e}function Wr(i){return i.translation[0]=0,i.translation[1]=0,i.translation[2]=0,i.heading=0,i.tilt=0,i}function Br(i,e,t){const n=t,a=i.state,s=i.device,r=e.tiltDirection==="forward-down"?1:-1,o=1;return s.deviceType==="standard"?(n.translation[0]=H(a.axes[0]),n.translation[1]=H(a.axes[1]),n.translation[2]=H(a.buttons[7])-H(a.buttons[6]),n.heading=H(a.axes[2]),n.tilt=H(a.axes[3])):s.deviceType==="spacemouse"&&(n.translation[0]=1.2*H(a.axes[0]),n.translation[1]=1.2*H(a.axes[1]),n.translation[2]=2*-H(a.axes[2]),n.heading=1.2*H(a.axes[5]),n.tilt=1.2*H(a.axes[3])),n.tilt*=r,jn(n.translation,n.translation,o),n}function Kr(i,e){const t=e;return t.translation[0]=i[1]-i[0],t.translation[1]=i[3]-i[2],t.translation[2]=i[4]-i[5],t.heading=i[7]-i[6],t.tilt=i[8]-i[9],t.zoom=i[10]-i[11],t}function Zr(i){return i.translation[0]===0&&i.translation[1]===0&&i.translation[2]===0&&i.heading===0&&i.tilt===0&&i.zoom===0}function Yr(i){const e=()=>i(document.visibilityState==="visible");return document.addEventListener("visibilitychange",e),{remove:()=>document.addEventListener("visibilitychange",e)}}function gi(i){const e=i.native;return e?{buttons:e.buttons.map(t=>t.pressed?t.value||1:0),axes:e.axes.map(t=>ss(t,i.axisThreshold))}:{buttons:[],axes:[]}}function ns(i,e){if(i.axes.length!==e.axes.length||i.buttons.length!==e.buttons.length)return!1;for(let t=0;t<i.axes.length;t++)if(i.axes[t]!==e.axes[t])return!1;for(let t=0;t<i.buttons.length;t++)if(i.buttons[t]!==e.buttons[t])return!1;return!0}function as(i){for(let e=0;e<i.axes.length;e++)if(i.axes[e]!==0)return!1;for(let e=0;e<i.buttons.length;e++)if(i.buttons[e]!==0)return!1;return!0}function ss(i,e){const t=Math.abs(i);return t<e?0:Math.sign(i)*(t-e)/(1-e)}let rs=class{constructor(e,t){this._element=e,this._input=t,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const r=s.gamepad,o=r.index,p=this._inputDevices[o];p&&(this._emitGamepadEvent(r,gi(p),!1),this._inputDevices.splice(o,1),this._latestUpdate.splice(o,1),this._input.gamepad.devices.remove(p),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const n="getGamepads"in window.navigator,a=window.isSecureContext;this.supported=n&&a,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const t=new Ot(e);t.deviceType!=="unknown"&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=dt({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),t=this._element.contains(document.activeElement),n=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!t;this._forEachGamepad(a=>{const s=this._inputDevices[a.index];if(!s)return;const r=this._latestUpdate[a.index],o=gi(s),p=n||as(o);r&&(r.timestamp===a.timestamp||!r.active&&p||ns(r.state,o))||this._emitGamepadEvent(a,o,!p)})}_forEachGamepad(e){const t=window.navigator.getGamepads();for(let n=0;n<t.length;n++){const a=t[n];this._validate(a)&&e(a)}}_emitGamepadEvent(e,t,n){const a=this._latestUpdate[e.index],s=a&&a.active;if(!s&&!n)return;const r=!s&&n?"start":s&&n?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:r})}_validate(e){if(!e||!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}};const yi=Ce("edge"),os=Ce("chrome"),ls=Ce("ff"),hs=Ce("safari"),fi="esri-view-surface",ue={touchNone:`${fi}--touch-none`,touchPan:`${fi}--touch-pan`};let ps=class en{constructor(e,t){this._input=t,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new rs(e,this._input),this._gamepadSource.onEvent=n=>this._callback("gamepad",n)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Z(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const n=this._active[t];this._element.removeEventListener(ht[t],n),delete this._active[t]}e&&e.forEach(t=>{if(!this._active[t]&&ht[t]){const n=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(ht[t],n),this._active[t]=n}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,t){t?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?ue.touchNone:ue.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?ue.touchPan:ue.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(ue.touchNone),this._element.classList.remove(ue.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,t){const n=ta(this._element,e);return en.test.disableSubpixelCoordinates&&(n.x=Math.round(n.x),n.y=Math.round(n.y)),t.x=n.x,t.y=n.y,t}_handleKey(e,t){const n=ia(t);n&&e==="key-up"&&this._keyDownState.delete(n);const a={native:t,key:n,repeat:!!n&&this._keyDownState.has(n)};n&&e==="key-down"&&this._keyDownState.add(a.key),this._callback(e,a)}_handlePointer(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}_handlePointerPreventDefault(e,t){const n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}_handleMouseWheel(e,t){let n=t.deltaY;switch(t.deltaMode){case 0:yi&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}yi?n*=.7:os||hs?n*=.6:ls&&(n*=1.375);const a=100,s=Math.abs(n);s>a&&(n=n/s*200/(1+Math.exp(-.02*(s-a))));const r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,r)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const n={native:t};t.preventDefault(),this._callback(e,n)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};ps.test={disableSubpixelCoordinates:!1};const ht={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let Jr=class extends fe{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};const A={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500,maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};function kt(i,e){return Math.abs(e.x-i.x)+Math.abs(e.y-i.y)}function cs(i,e){const t=e.x-i.x,n=e.y-i.y;return Math.sqrt(t*t+n*n)}function us(i,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:le()},i.length===0)return e;if(i.length===1)return e.center.x=i[0].x,e.center.y=i[0].y,e;if(i.length===2){const[f,D]=i,[N,W]=[D.x-f.x,D.y-f.y];return e.radius=Math.sqrt(N*N+W*W)/2,e.center.x=(f.x+D.x)/2,e.center.y=(f.y+D.y)/2,e}let t=0,n=0;for(let f=0;f<i.length;f++)t+=i[f].x,n+=i[f].y;t/=i.length,n/=i.length;const a=i.map(f=>f.x-t),s=i.map(f=>f.y-n);let r=0,o=0,p=0,c=0,u=0,d=0,m=0;for(let f=0;f<a.length;f++){const D=a[f],N=s[f],W=D*D,he=N*N;r+=W,o+=he,p+=D*N,c+=W*D,u+=he*N,d+=D*he,m+=N*W}const y=.5*(c+d),M=.5*(u+m),G=r*o-p*p,k=(y*o-M*p)/G,b=(r*M-p*y)/G,E=le(k+t,b+n);return{radius:Math.sqrt(k*k+b*b+(r+o)/i.length),center:E}}function Pe(i){const{native:e}=i,{pointerId:t,button:n,pointerType:a}=e;return a==="mouse"?`${t}:${n}`:`${a}`}let eo=class extends fe{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,t,n,a){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:a,pointers:ds(this._activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}_addPointer(e){const t=e.native.pointerId,n=Le(this._activePointerMap).angle,a={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,a);const s=Fe(a,tn(this._activePointerMap));a.initialAngle=s,a.lastAngle=s,this._updatePointerAngles(n)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const t=e.native.pointerId,n=this._activePointerMap.get(t);n?n.event=e:this._addPointer(e)}_removePointer(e){const t=Le(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}_updatePointerAngles(e){const t=Le(this._activePointerMap);this._activePointerMap.forEach(n=>{n.initialAngle=Fe(n,t)-e,n.lastAngle=Fe(n,t)-e})}_emitEvent(e,t,n){const a=Le(this._activePointerMap);this._drag.emit(this._createPayload(e,t,a,n),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,n=Xe(e.timestamp);this._activePointerMap.get(t)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,Xe(e.timestamp))))}_handlePointerDrag(e){const t=e.data,n=t.currentEvent,a=Xe(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,a)):(this._addPointer(n),this._emitEvent("added",n,a),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,a))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function tn(i){const e=[];return i.forEach(t=>{e.push(le(t.event.x,t.event.y))}),us(e)}function Le(i){const e=tn(i);let t=0;return i.forEach(n=>{let a=Fe(n,e),s=a-n.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;a=n.lastAngle+s,n.lastAngle=a;const r=a-n.initialAngle;t+=r}),t/=i.size||1,{angle:t,radius:e.radius,center:e.center}}function ds(i){const e=new Map;return i.forEach((t,n)=>e.set(n,t.event)),e}function Fe(i,e){const t=i.event,n=t.x-e.center.x,a=t.y-e.center.y;return Math.atan2(a,n)}var _i;(function(i){i[i.Left=0]="Left",i[i.Middle=1]="Middle",i[i.Right=2]="Right",i[i.Back=3]="Back",i[i.Forward=4]="Forward",i[i.Undefined=-1]="Undefined"})(_i||(_i={}));let io=class extends fe{constructor(e=A.maximumDoubleClickDelay,t=A.maximumDoubleClickDistance,n=A.maximumDoubleTouchDelay,a=A.maximumDoubleTouchDistance,s=Ke){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=a,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=Pe(t);if(!this._pointerState.has(n)){const a={downButton:t.native.button,x:t.x,y:t.y,immediateDoubleClick:null};this._pointerState.set(n,a),this.startCapturingPointer(t.native)}}_handlePointerUp(e){const t=e.data,n=Pe(t),a=this._pointerState.get(n);if(a&&a.downButton===t.native.button){const s=a.immediateDoubleClick,r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;s?(s.timeoutHandle.remove(),kt(s,e.data)>r?this._startImmediateDoubleClick(e,a):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(t))):kt(a,e.data)>r?this._removeState(t):this._startImmediateDoubleClick(e,a)}}_startImmediateDoubleClick(e,t){const n=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),n)}}_removeState(e){const t=Pe(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}},ao=class extends fe{constructor(e=A.maximumClickDelay,t=A.movementUntilMouseDrag,n=A.movementUntilPenDrag,a=A.movementUntilTouchDrag,s=A.holdDelay,r=Ke){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=t,this._movementUntilPenDrag=n,this._movementUntilTouchDrag=a,this._holdDelay=s,this._clock=r,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=ye(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const t=e.data,n=t.native.pointerId;let a=null;this._pointerState.size===0&&(a=this._clock.setTimeout(()=>{const r=this._pointerState.get(n);if(r){if(!r.isDragging){const o=r.previousEvent;this._pointerHold.emit(o,void 0,e.modifiers),r.holdEmitted=!0}r.holdTimeout=null}},this._holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:a,modifiers:new Set};this._pointerState.set(n,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,t,n){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:n}}_handlePointerMove(e){const t=e.data,n=t.native.pointerId,a=this._pointerState.get(n);a&&(a.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",a,t),void 0,a.modifiers):cs(t,a.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),a.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const t=e.data,n=t.native.pointerId;this._pointerState.forEach(a=>{a.holdTimeout!=null&&(a.holdTimeout.remove(),a.holdTimeout=null),a.isDragging||(a.modifiers=e.modifiers,a.isDragging=!0,n===a.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",a,t)):this._pointerDrag.emit(this._createPointerDragData("start",a,a.previousEvent),e.timestamp))})}_handlePointerLoss(e,t){const n=e.data,a=n.native.pointerId,s=this._pointerState.get(a);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,t==="pointer-up"?n:s.previousEvent),void 0,s.modifiers):t==="pointer-up"&&s.downButton===n.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(a),this.stopCapturingPointer(n.native),this._pointerState.size===0&&this._moveHandle.pause())}},ro=class extends fe{constructor(e=A.maximumDoubleClickDelay,t=A.maximumDoubleClickDistance,n=A.maximumDoubleTouchDelay,a=A.maximumDoubleTouchDistance,s=Ke){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=t,this._maximumDoubleTouchDelay=n,this._maximumDoubleTouchDistance=a,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=ye(e.doubleClickTimer))}get hasPendingInputs(){return Ct(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,t){const n=this._pointerState.get(e);n&&(n.doubleClickTimer=ye(n.doubleClickTimer),t&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);t.pointerDownCount===1&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:t,pointerType:n,button:a}=e.native;return n==="mouse"?`${t}:${a}`:`${n}`}_handleImmediateClick(e){const t=e.data,{pointerType:n}=t.native,a=this._getPointerId(t);if(!this._pointerState.has(a))return void this._startClick(e);const s=this._pointerState.get(a),{data:r,modifiers:o}=s.event,p=n==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;kt(r,t)>p?(this._clearDoubleClickTimer(a,!0),this._startClick(e)):(this._clearDoubleClickTimer(a,!1),s.pointerDownCount===2&&this._doubleClick.emit(r,void 0,o))}_handlePointerDown(e){const t=Pe(e.data),n=this._pointerState.get(t);n&&(n.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:n}}=t,a=Pe(t),s=n==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,r=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(a),s),o=1;this._pointerState.set(a,{event:e,doubleClickTimer:r,pointerDownCount:o}),this.refreshHasPendingInputs()}};const vi=2048,ms=1.5,gs=8;function ys(i,e){const{format:t,quality:n,rotation:a,disableDecorations:s}=i||{},r=qt(i,e.padding),o=ws(i,{width:e.width-r.left-r.right,height:e.height-r.top-r.bottom}),{width:p,height:c}=vs(i,o),u=sn(t),d=rn[u];return{format:u,quality:Ue(n??d,0,100),area:o,width:p,height:c,rotation:a,disableDecorations:!!s,ignoreBackground:!!(i!=null&&i.ignoreBackground),ignorePadding:!!(i!=null&&i.ignorePadding)}}function lo(i,e){const t=ys(i,e),n=t.area,a=t.width/n.width,s=qt(t,e.padding),r=s.left+s.right,o=s.top+s.bottom,p=e.width-r,c=e.height-o,u=Math.floor(p*a+r),d=Math.floor(c*a+o),m=(i==null?void 0:i.layers)??[],y=t.ignoreBackground,M=t.ignorePadding;return{framebufferWidth:u,framebufferHeight:d,region:{x:Math.floor(n.x*a)+s.left,y:Math.floor(n.y*a)+s.top,width:t.width,height:t.height},format:t.format,quality:t.quality,rotation:t.rotation,pixelRatio:a,layers:m,disableDecorations:t.disableDecorations,ignoreBackground:y,ignorePadding:M,objectAndLayerIdColor:!1}}function ho(i,e,t){const{ctx:n,canvas:a}=nn(i,t),s=n.getImageData(0,0,i.width,i.height),r=_s(a,e);return an(a),{dataUrl:r,data:s}}function po(i,e){const{ctx:t,canvas:n}=nn(i,e),a=t.getImageData(0,0,i.width,i.height);return an(n),a}function nn(i,e){const t=fs();e.premultipliedAlpha&&Ms(i),t.width=i.width,t.height=i.height;const n=t.getContext("2d",{willReadFrequently:!0});return n.putImageData(i,0,0),e.flipY&&xs(n),{ctx:n,canvas:t}}function an(i){i.width=0,i.height=0}function fs(){return pt==null&&(pt=document.createElement("canvas")),pt}let pt=null;function _s(i,e){const t=Ts[e.format],n=e.quality/100;return i.toDataURL(t,n)}function co(i,e){const t=sn(i),n=rn[t];return{format:t,quality:Ue(e??n,0,100)}}function uo(i,e){return e/Math.max(i[0],i[1])}function mo(i,e,t,n=0,a=0,s=i.width-n,r=i.height-a,o=!1){const{data:p}=i,{width:c,height:u,data:d}=e,m=s/c,y=r/u,M=Math.ceil(m/2),G=Math.ceil(y/2),k=i.width;for(let b=0;b<u;b++)for(let E=0;E<c;E++){const f=4*(E+(o?u-b-1:b)*c);let D=0,N=0,W=0,he=0,jt=0,Ut=0;const hn=(b+.5)*y;for(let Ee=Math.floor(b*y);Ee<(b+1)*y;Ee++){const Wt=Math.abs(hn-(Ee+.5))/G,pn=(E+.5)*m,cn=Wt*Wt;for(let De=Math.floor(E*m);De<(E+1)*m;De++){const Bt=Math.abs(pn-(De+.5))/M,pe=Math.sqrt(cn+Bt*Bt);if(pe>=1)continue;let Q=2*pe*pe*pe-3*pe*pe+1;const ce=4*(n+De+(a+Ee)*k);Ut+=Q*p[ce+3],N+=Q,!t&&p[ce+3]<255&&(Q=Q*p[ce+3]/255),W+=Q*p[ce],he+=Q*p[ce+1],jt+=Q*p[ce+2],D+=Q}}d[f]=W/D,d[f+1]=he/D,d[f+2]=jt/D,d[f+3]=Ut/N}return e}function go(i,e,t){if(!e)return i;const{framebufferWidth:n,framebufferHeight:a,pixelRatio:s,region:r}=i,o=qt(i,t),p=o.left+o.right,c=o.top+o.bottom,u=n-p,d=a-c,m=Math.min(gs,Math.min((vi-p)/u,(vi-c)/d));return m<ms?i:{...i,framebufferWidth:Math.round(u*m)+p,framebufferHeight:Math.round(d*m)+c,pixelRatio:s*m,resample:{region:{x:Math.round((r.x-o.left)*m)+o.left,y:Math.round((r.y-o.top)*m)+o.top,width:Math.round(r.width*m),height:Math.round(r.height*m)},width:n,height:a}}}function vs(i,e){if(!i)return e;const t=i.width,n=i.height;if(t!=null&&n!=null)return{width:Math.floor(t),height:Math.floor(n)};if(t==null&&n==null)return e;const a=e.width/e.height;return n==null?{width:Math.floor(t),height:Math.floor(t/a)}:{width:Math.floor(n*a),height:Math.floor(n)}}function ws(i,e){const t={x:0,y:0,width:e.width,height:e.height};if(i!=null&&i.area){i.area.x!=null&&(t.x=Math.floor(i.area.x)),i.area.y!=null&&(t.y=Math.floor(i.area.y));const n=i.area.width!=null?Math.floor(i.area.width):null,a=i.area.height!=null?Math.floor(i.area.height):null;if(t.width=e.width-t.x,t.height=e.height-t.y,n!=null&&a!=null)t.width=Math.min(t.width,n),t.height=Math.min(t.height,a);else if(n==null&&a!=null){const s=Math.min(t.width,n);t.height=s/t.width*t.height,t.width=s}else if(n!=null&&a==null){const s=Math.min(t.height,a);t.width=s/t.height*t.width,t.height=s}}return bs(ks(t,i),e)}function bs(i,e){const t=Math.floor(Math.max(i.x,0)),n=Math.floor(Math.max(i.y,0)),a={x:t,y:n,width:Math.floor(Math.min(i.width,e.width-t)),height:Math.floor(Math.min(i.height,e.height-n))},s=a.width/a.height,r=i.width/i.height;if(r===s)return a;if(r>s){const c=Math.floor(a.width/r),u=a.height-c;return{x:a.x,y:Math.floor(a.y+u/2),width:a.width,height:c}}const o=Math.floor(a.height*r),p=a.width-o;return{x:Math.floor(a.x+p/2),y:a.y,width:o,height:a.height}}function ks(i,e){if((e==null?void 0:e.width)==null||e.height==null)return i;const t=e.width/e.height,n=i.width/i.height;if(n===t)return i;if(n<t){const s=Math.floor(i.height*t);return i.x-=(s-i.width)/2,i.width=s,i}const a=Math.floor(i.width/t);return i.y-=(a-i.height)/2,i.height=a,i}function qt(i,e){return!e||i&&i.ignorePadding?Cs:e}function sn(i){switch(i){case"png":case"jpg":case"jpeg":return i;default:return Ps}}function xs(i){i.save(),i.globalCompositeOperation="copy",i.scale(1,-1),i.translate(0,-i.canvas.height),i.drawImage(i.canvas,0,0),i.restore()}function Ms(i){const e=i.data,t=e.length;for(let n=0;n<t;n+=4){const a=e[n+3];if(a!==255&&a>0){const s=255/a;e[n]=e[n]*s,e[n+1]=e[n+1]*s,e[n+2]=e[n+2]*s}}}const Ts={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},wi=98,Ps="png",rn={png:100,jpg:wi,jpeg:wi},Cs={top:0,right:0,bottom:0,left:0};function yo(i){const e=ca(i);if(!e.available)return new I("webgl:required",i==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(i==="3d"&&e.majorPerformanceCaveat)return new I("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new I("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new I("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===ua.WEBGL1){if(!e.supportsElementIndexUint)return new I("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new I("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new I("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function $s(i){return i&&"nodeType"in i}function Es(i){return i&&typeof i.render=="function"}const bi={component:"esri-component"};let re=class extends ${constructor(){super(...arguments),this.widget=null}destroy(){var i;this.node=null,(i=this.widget)==null||i.destroy()}get id(){var i,e;return this._get("id")??((i=this.widget)==null?void 0:i.id)??((e=this.node)==null?void 0:e.id)}set id(i){this._set("id",i)}set node(i){const e=this._get("node");i!==e&&(i&&i.classList.add(bi.component),e&&e.classList.remove(bi.component),this._set("node",i))}castNode(i){var e;return(e=this.widget)==null||e.destroy(),i?typeof i=="string"||$s(i)?(this._set("widget",null),Li(i)):(Es(i)&&!i.domNode&&(i.domNode=document.createElement("div")),this._set("widget",i),i.domNode):(this._set("widget",null),null)}};l([h()],re.prototype,"id",null),l([h()],re.prototype,"node",null),l([Vi("node")],re.prototype,"castNode",null),l([h({readOnly:!0})],re.prototype,"widget",void 0),re=l([v("esri.views.ui.Component")],re);const ze=re,Ds={left:0,top:0,bottom:0,right:0},on={bottom:30,top:15,right:15,left:15},K="esri-ui",S={ui:K,corner:`${K}-corner`,innerContainer:`${K}-inner-container`,manualContainer:`${K}-manual-container`,cornerContainer:`${K}-corner-container`,topLeft:`${K}-top-left`,topRight:`${K}-top-right`,bottomLeft:`${K}-bottom-left`,bottomRight:`${K}-bottom-right`};function Is(i){return i&&!i._started&&typeof i.postMixInProperties=="function"&&typeof i.buildRendering=="function"&&typeof i.postCreate=="function"&&typeof i.startup=="function"}function Ae(i){return i===0?"0":`${i}px`}function ct(i){const e=typeof i=="object"&&i!==null&&Object.getPrototypeOf(i);return(e===null||e===Object.prototype)&&("component"in i||"index"in i||"position"in i)?i:null}function ut(i,{top:e,bottom:t,left:n,right:a}){i.style.top=e,i.style.bottom=t,i.style.left=n,i.style.right=a}let q=class extends Ci.EventedAccessor{constructor(i){super(i),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Un(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&ut(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&ut(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([w(()=>{var i;return[(i=this.view)==null?void 0:i.padding,this.container]},this._applyViewPadding,U),w(()=>this.padding,this._applyUIPadding,U),w(()=>[this.container,this._locale],([i,e])=>{i&&i.setAttribute("lang",e)},U),xi(i=>{this._locale=i})])}destroy(){this.container=null;for(const i of this._components)i.destroy();this._components.length=0,this._componentMap.clear()}set container(i){const e=this._get("container");i!==e&&(i&&(i.classList.add(S.ui),da(i),this._attachContainers(i)),e&&(e.classList.remove(S.ui),ut(e,{top:"",bottom:"",left:"",right:""}),Ai(e)),this._set("container",i))}get height(){var a;const i=((a=this.view)==null?void 0:a.height)??0;if(i===0)return i;const e=this._getViewPadding(),{top:t,bottom:n}=e;return Math.max(i-t-n,0)}get padding(){return this._get("padding")}set padding(i){this._overrideIfSome("padding",i)}castPadding(i){return typeof i=="number"?{bottom:i,top:i,right:i,left:i}:{...on,...i}}get width(){var a;const i=((a=this.view)==null?void 0:a.width)??0;if(i===0)return i;const e=this._getViewPadding(),{left:t,right:n}=e;return Math.max(i-t-n,0)}add(i,e){let t,n,a;if(Array.isArray(i))return void i.forEach(r=>this.add(r,e));const s=ct(i);s&&({index:t,position:e,component:i,key:n}=s),e&&typeof e=="object"&&({index:t,key:n,position:e,internal:a}=e),!i||e&&!this._isValidPosition(e)||this._add(i,e,t,n,a)}remove(i,e){var n;if(!i)return;if(Array.isArray(i))return i.map(a=>this.remove(a,e));const t=this._find(i);if(t){if(this._componentMap.has(t)&&((n=this._componentMap.get(t))==null?void 0:n.key)!==e)return;const a=this._components.indexOf(t),s=t.node.parentNode;return s==null||s.removeChild(t.node),this._componentMap.delete(t),this._components.splice(a,1)[0]}}empty(i,e={removeInternal:!1}){if(Array.isArray(i)){for(const a of i)this.empty(a,e);return}const t=this._positionNameToContainerLookup[i??"manual"],n=Array.prototype.slice.call(t.children).map(a=>this._findByNode(a)).filter(a=>{var s;return a==null?!1:!(((s=this._componentMap.get(a))==null?void 0:s.internal)??!1)||e.removeInternal});for(const a of n)this.remove(a)}move(i,e){if(Array.isArray(i)&&i.forEach(s=>this.move(s,e)),!i)return;let t;const n=ct(i)||ct(e);if(n&&(t=n.index,e=n.position,i=n.component||i),e&&!this._isValidPosition(e))return;const a=this.remove(i);a&&this.add(a,{position:e,index:t})}find(i){if(!i)return null;const e=this._findById(i);return e&&(e.widget||e.node)}getComponents(i,e={includeInternal:!1}){return i?Array.isArray(i)?i.flatMap(t=>this._getComponentsAtPosition(t,e)):this._getComponentsAtPosition(i,e):this._components.filter(t=>{var n;return e.includeInternal||!((n=this._componentMap.get(t))!=null&&n.internal)}).map(({widget:t,node:n})=>t??n)}getPosition(i){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(i))return e;return null}_add(i,e,t,n,a){i instanceof ze||(i=new ze({node:i})),this._place({component:i,position:e,index:t}),this._components.push(i),this._componentMap.set(i,{key:n,internal:a})}_find(i){return i?i instanceof ze?this._findByComponent(i):typeof i=="string"?this._findById(i):this._findByNode(i.domNode||i):null}_getViewPadding(){var i;return((i=this.view)==null?void 0:i.padding)??Ds}_attachContainers(i){i.appendChild(this._innerContainer),i.appendChild(this._manualContainer)}_initContainers(){const i=document.createElement("div");i.classList.add(S.innerContainer,S.cornerContainer);const e=document.createElement("div");e.classList.add(S.innerContainer,S.manualContainer);const t=document.createElement("div");t.classList.add(S.topLeft,S.corner),i.appendChild(t);const n=document.createElement("div");n.classList.add(S.topRight,S.corner),i.appendChild(n);const a=document.createElement("div");a.classList.add(S.bottomLeft,S.corner),i.appendChild(a);const s=document.createElement("div");s.classList.add(S.bottomRight,S.corner),i.appendChild(s),this._innerContainer=i,this._manualContainer=e;const r=Qn();this._cornerNameToContainerLookup={"top-left":t,"top-right":n,"bottom-left":a,"bottom-right":s,"top-leading":r?n:t,"top-trailing":r?t:n,"bottom-leading":r?s:a,"bottom-trailing":r?a:s},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(i){return!!this._positionNameToContainerLookup[i]}_place(i){const e=i.position??"manual",{component:t,index:n}=i,a=this._positionNameToContainerLookup[e],s=n!=null&&n>-1;if(Is(t.widget)&&t.widget.startup(),!s)return void a.appendChild(t.node);const r=Array.from(a.children);if(n===0)return void(a.firstChild?ai(t.node,a.firstChild):a.appendChild(t.node));n>=r.length?a.appendChild(t.node):ai(t.node,r[n])}_toPixelPosition(i){return{top:Ae(i.top),left:Ae(i.left),right:Ae(i.right),bottom:Ae(i.bottom)}}_findByComponent(i){return this._components.find(e=>e===i)??null}_findById(i){return this._components.find(({id:e})=>e===i)??null}_findByNode(i){return this._components.find(({node:e})=>e===i)??null}_getComponentsAtPosition(i,e){const t=this._positionNameToContainerLookup[i];return Array.prototype.slice.call(t.children).map(n=>this._findByNode(n)).filter(Wn).filter(n=>{var a;return e.includeInternal||!((a=this._componentMap.get(n))!=null&&a.internal)}).map(({widget:n,node:a})=>n??a)}};l([h()],q.prototype,"_locale",void 0),l([h()],q.prototype,"container",null),l([h()],q.prototype,"height",null),l([h({value:on})],q.prototype,"padding",null),l([Vi("padding")],q.prototype,"castPadding",null),l([h()],q.prototype,"view",void 0),l([h()],q.prototype,"width",null),q=l([v("esri.views.ui.UI")],q);const Ss=q;function ki(i,e){return i&&"copyright"in i&&(!e||typeof i.originOf=="function"&&i.originOf("copyright")==="user")}function Rs(i,e){return i.length!==e.length||i.some((t,n)=>t.text!==e[n].text)}function Oe(i,e,t){!t||!e||i.find(n=>n.layerView===e&&n.text===t)||i.push({text:t,layerView:e})}function Vs(i){return i.type==="bing-maps"}const J=[];let ge=class extends ${constructor(i){super(i),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.removeHandles("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new R,this.view=null,this._allLayerViewsChange=e=>{var n;this.removeHandles("suspension");const t=(n=this.view)==null?void 0:n.allLayerViews;t&&this.addHandles(t.map(a=>w(()=>{var s;return[a.suspended,(s=a.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())).toArray(),"suspension"),e!=null&&e.removed&&e.removed.forEach(a=>{this._pendingAttributions.delete(a),this._fetchedAttributionData.delete(a)}),this._updateAttributionItems()},this.addHandles([Pt(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Ei(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){var i;return(i=this.view)!=null&&i.ready?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const i=this.view,e=i==null?void 0:i.allLayerViews;J.length=0,i&&e?(e.forEach(t=>{var s,r;if(t.suspended||!((s=t.layer)!=null&&s.attributionVisible))return;const n=t.layer;if(ki(n,"user"))return void Oe(J,t,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(t)){const o=this._fetchedAttributionData.get(t);return void(o?Oe(J,t,this._getDynamicAttribution(o,i,n)):ki(n)&&Oe(J,t,n.copyright))}return void this._fetchAttributionData(t)}const a="portalItem"in n?(r=n.portalItem)==null?void 0:r.accessInformation:void 0;Oe(J,t,a||n.copyright)}),Rs(this.items,J)&&(this.items.removeAll(),this.items.addMany(J)),J.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(i){if(this._pendingAttributions.has(i))return;this._pendingAttributions.add(i);const e=await Bn(i.layer.fetchAttributionData());if(this._pendingAttributions.has(i)){const t=e.ok?this._createContributionIndex(e.value,Vs(i.layer)):null;this._pendingAttributions.delete(i),this._fetchedAttributionData.set(i,t)}this._updateAttributionItems()}_createContributionIndex(i,e){const t=i.contributors,n={};if(!t)return n;for(let a=0;a<t.length;a++){const s=t[a],r=s.coverageAreas;if(!r)return;for(const o of r){const p=o.bbox,c=o.zoomMin-(e&&o.zoomMin?1:0),u=o.zoomMax-(e&&o.zoomMax?1:0),d=new $e({xmin:p[1],ymin:p[0],xmax:p[3],ymax:p[2],spatialReference:Rt.WGS84}),m={extent:Kn(d),attribution:s.attribution||"",score:o.score!=null?o.score:100,id:a};for(let y=c;y<=u;y++)n[y]??(n[y]=[]),n[y].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(i,e,t){var c;const{extent:n,scale:a}=e;let s=((c=t.tileInfo)==null?void 0:c.scaleToZoom(a))??0;if(s=Math.min(i.maxKey??0,Math.round(s)),!n||s==null||s<=-1)return"";const r=i[s],o=Zn(n.center.clone().normalize(),e.spatialReference),p=new Set;return r?r.filter(u=>{const d=u.id,m=!p.has(d)&&o&&u.extent&&Yn(u.extent,o);return m&&p.add(d),m}).sort((u,d)=>d.score-u.score||u.objectId-d.objectId).map(u=>u.attribution).join(", "):""}};l([h({readOnly:!0,type:R})],ge.prototype,"items",void 0),l([h({readOnly:!0})],ge.prototype,"state",null),l([h()],ge.prototype,"view",void 0),ge=l([v("esri.widgets.Attribution.AttributionViewModel")],ge);const ln=ge,de="esri-attribution",ae={base:de,poweredBy:`${de}__powered-by`,sources:`${de}__sources`,open:`${de}--open`,sourcesOpen:`${de}__sources--open`,link:`${de}__link`,widgetIcon:ea.description};let P=class extends Xn{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(n=>n.forEach(({target:a})=>this._checkSourceTextOverflow(a))),this.iconClass=ae.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new ln}initialize(){this.addHandles(Pt(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[ae.open]:this._isOpen};return Se("div",{bind:this,class:this.classes(ae.base,oi.widget,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),this._renderPoweredBy())}_renderPoweredBy(){return Se("div",{class:ae.poweredBy},"Powered by"," ",Se("a",{class:ae.link,href:"http://www.esri.com/",rel:"noreferrer",target:"_blank"},"Esri"))}_renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,n=t?0:void 0,{attributionText:a}=this,s={[ae.sourcesOpen]:e,[oi.interactive]:t};return Se("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(ae.sources,s),innerHTML:a,tabIndex:n})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:n,clientWidth:a,scrollWidth:s}=e,r=s>a,o=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,o&&(t=!0),this._isOpen){const p=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,p&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};l([h()],P.prototype,"_isOpen",void 0),l([h()],P.prototype,"_isInteractive",null),l([h()],P.prototype,"_attributionTextOverflowed",void 0),l([h()],P.prototype,"_prevSourceNodeHeight",void 0),l([h({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],P.prototype,"attributionText",null),l([h()],P.prototype,"iconClass",void 0),l([h()],P.prototype,"icon",void 0),l([h()],P.prototype,"itemDelimiter",void 0),l([h()],P.prototype,"label",null),l([h(),Jn("esri/widgets/Attribution/t9n/Attribution")],P.prototype,"messages",void 0),l([h()],P.prototype,"view",null),l([h({type:ln})],P.prototype,"viewModel",void 0),l([ma()],P.prototype,"_toggleState",null),P=l([v("esri.widgets.Attribution")],P);const Ls=P;function As(i){return(i==null?void 0:i.view)!==void 0}let qe=class extends Ss{constructor(i){super(i),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(t=>{const n=this._find(t),a=n==null?void 0:n.widget;As(a)&&(a.view=e)})},this._componentsWatcher=(e,t)=>{this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([w(()=>this.components,this._componentsWatcher,U),w(()=>this.view,this._updateViewAwareWidgets,U)])}_add(i,e,t,n,a){let s=i;if(typeof i=="string"&&this._defaultPositionLookup[i]){if(this._find(i))return;s=this._createComponent(i)}super._add(s,e,t,n,a)}_removeComponents(i){i.forEach(e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())})}_adjustPadding(i){if(!i.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(i){this.constructed&&i.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(i){const e=this._createWidget(i);return new ze({id:i,node:e})}_createWidget(i){const{view:e}=this;switch(i){case"attribution":return new Ls({view:e});case"compass":return new ga({view:e});case"navigation-toggle":return new ya({view:e});case"zoom":return new fa({view:e})}}};l([h()],qe.prototype,"components",void 0),qe=l([v("esri.views.ui.DefaultUI")],qe);const _o=qe;export{zt as A,eo as B,Jr as C,co as D,ho as E,po as F,Gr as G,uo as H,_o as I,hr as J,ur as K,cr as L,yo as M,Er as N,qr as O,Kr as P,Be as Q,lo as R,go as S,Fr as W,Sr as X,Y,za as Z,Rr as _,Ir as a,Nr as b,Ge as c,Hr as d,Qi as e,jr as f,Ja as g,Or as h,Wr as i,es as j,Br as k,Ya as l,Yr as m,A as n,kt as o,Lr as p,ps as q,io as r,Zr as s,zr as t,Pe as u,ao as v,mo as w,Ar as x,Vr as y,ro as z};

import{a5 as r,a6 as i,eC as P,a9 as j,hO as E,hP as V,s as T,eH as F}from"./index-b516d057.js";import{p as L}from"./popupUtils-e4ebc84a.js";const _=b=>{let e=class extends b{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return E(this.layer.rasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return V(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(o){return!!E(this.layer.rasterInfo,o)}async fetchPopupFeatures(o,R){const{layer:t}=this;if(!o)throw new T("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:t});const{popupEnabled:c}=t,h=L(t,R);if(!c||h==null)throw new T("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:c,popupTemplate:h});const m=[],{value:l,magdirValue:n,processedValue:y}=await t.identify(o,{timeExtent:this.timeExtent});let u="";if(l&&l.length){u=t.type==="imagery-tile"&&t.hasStandardTime()&&l[0]!=null?l.map(d=>t.getStandardTimeValue(d)).join(", "):l.join(", ");const s={ObjectId:0},g="Raster.ServicePixelValue";s[g]=(y==null?void 0:y.join(", "))??u,s[g+".Raw"]=u;const w=t.rasterInfo.attributeTable;if(w!=null){const{fields:d,features:I}=w,x=d.find(({name:a})=>a.toLowerCase()==="value"),f=x?I.find(a=>String(a.attributes[x.name])===u):null;if(f)for(const a in f.attributes)f.attributes.hasOwnProperty(a)&&(s[this._rasterFieldPrefix+a]=f.attributes[a])}const v=t.rasterInfo.dataType;v!=="vector-magdir"&&v!=="vector-uv"||(s["Raster.Magnitude"]=n==null?void 0:n[0],s["Raster.Direction"]=n==null?void 0:n[1]);const p=new F(this.fullExtent.clone(),null,s);p.layer=t,p.sourceLayer=p.layer,m.push(p)}return m}};return r([i()],e.prototype,"layer",void 0),r([i(P)],e.prototype,"timeExtent",void 0),r([i()],e.prototype,"view",void 0),r([i()],e.prototype,"fullExtent",null),r([i()],e.prototype,"tileInfo",void 0),r([i({readOnly:!0})],e.prototype,"hasTilingEffects",null),r([i()],e.prototype,"datumTransformation",null),e=r([j("esri.views.layers.ImageryTileLayerView")],e),e};export{_ as p};

import{gj as y,gk as _,cn as $,y as E,cb as p,i0 as D,hQ as R,a5 as c,a6 as f,a9 as b,bA as H,dr as h,kJ as L,dA as P,D as k,iN as T,b9 as u}from"./index-b516d057.js";import{n as z,t as v}from"./ElevationProfile-d4733872.js";import{a as V}from"./HoveredPoints-5a66c77c.js";import{s as A}from"./elevationInfoUtils-be36d866.js";import{z as G,w}from"./OutlineVisualElement-75d7e05b.js";import{e as O}from"./GraphicState-0d3046df.js";import{d as S}from"./Material-5f4156ac.js";import{n as I}from"./layerViewUtils-6ebe90f4.js";import{e as M}from"./throttle-7bf02de9.js";import"./memoize-3e55df82.js";import"./jsxFactory-92036771.js";import"./uuid-709b6c67.js";import"./intersectorUtilsConversions-d05d75a3.js";import"./Intersector-fa865806.js";import"./ViewingMode-5d7d590b.js";import"./boundedPlane-1da2f094.js";import"./verticalOffsetUtils-e5214af9.js";import"./orientedBoundingBox-67c5cd22.js";import"./Intersector-2e1d9db3.js";import"./Intersector-a291e778.js";import"./defaultUnit-414db021.js";import"./getDefaultUnitForView-d1ffbf16.js";import"./geodesicUtils-822c19ca.js";import"./QueueProcessor-4b9d43d3.js";import"./signal-51ed66f5.js";import"./Scheduler-ff5943a4.js";import"./debugFlags-9a30f077.js";import"./RenderState-1d6218ee.js";import"./traversalUtils-bbdec2e9.js";import"./Ground-ed93a93a.js";import"./loadAll-5e767cfa.js";import"./ElevationQuery-4be4efe0.js";import"./ElevationSamplerData-9f34f589.js";import"./SketchViewModel-fedf7932.js";import"./layerUtils-437666a3.js";import"./screenUtils-8dc4a7f9.js";import"./snappingUtils-93e84fbe.js";import"./dehydratedPoint-5a1dfed5.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./SketchTooltipOptions-cc43c059.js";import"./SnappingManager-aa70fdd4.js";import"./UpdatingHandles-7949a657.js";import"./geometry2dUtils-a99dcf3d.js";import"./FeatureFilter-55dd341e.js";import"./floorFilterUtils-080a7cd2.js";import"./viewUtils-9f810d02.js";import"./hitTestSelectUtils-d512707e.js";import"./unitFormatUtils-67047561.js";import"./Cyclical-4c223a04.js";import"./UnitSelect-52961079.js";import"./globalCss-94006b67.js";import"./AnchorElementViewModel-8d35dd28.js";import"./ExtendedLineVisualElement-451ab04d.js";import"./vec4f32-0d1b2306.js";import"./frustum-f9d53cdf.js";import"./EngineVisualElement-43f3e8cb.js";import"./RenderGeometry-5dbc1699.js";import"./vec3f32-bac7ea57.js";import"./DefaultTechniqueConfiguration-b4dbe32f.js";import"./requestImageUtils-b142708c.js";import"./enums-bdecffa2.js";import"./Texture-bcb6d63f.js";import"./contextUtils-81fda295.js";import"./interfaces-8918b36f.js";import"./FramebufferObject-123b7c8d.js";import"./ShaderTechniqueConfiguration-2502462e.js";import"./ElevationProvider-abb53936.js";import"./hydratedFeatures-2365c307.js";import"./weather-2eb64924.js";import"./NestedMap-1b5db22e.js";import"./VertexElementDescriptor-2925c6af.js";import"./VertexArrayObject-d19dab8d.js";import"./Octree-7cea9440.js";import"./InterleavedLayout-d76b0d59.js";import"./types-1305598a.js";import"./OrderIndependentTransparency-755f7dcc.js";import"./floatRGBA-ca990bbb.js";import"./glUtil-ce5ee52b.js";import"./VisualElement-187372ae.js";import"./LaserlineVisualElement-c0026af2.js";import"./lineStippleUtils-0688e06c.js";let x=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new G({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!g(t))return;const i=t.layer;this._highlightTask=$(async e=>{const s=await this._params.view.whenLayerView(i);E(e),I(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const i=this._params.view,e=new w({view:i,geometry:g(t)?t.geometry:null,attached:!1,elevationInfo:A(t),renderOccluded:S.OccludeAndTransparentStencil,isDecoration:!0}),s=new O({graphic:t}),o=[p(()=>s.isDraped,a=>{e.isDraped=a}),s.on("changed",()=>{e.geometry=g(t)?t.geometry:null}),i.trackGraphicState(s),i.maskOccludee(t),D(e)];this._settings.visualElements.lineGraphics.outline.apply(e),e.attached=!0,this._visualElementHandle=R(o)}};function g(r){return r.geometry!=null&&r.geometry.type==="polyline"}const C=100;let m=class extends H{constructor(r){super(r),this._chartData=null,this._visualElements=[]}initialize(){const r=M(t=>{this._update(t)},C);this.addHandles([p(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),r,h),r])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_update(r){const{chartData:t}=r;if(t==null)return this.remove();if(!t.refined)return;const i=this._visualElements,e=t.lines.filter(n=>n.viewVisualizationEnabled),s=e.length;for(;i.length>s;)i.pop().destroy();const o=z().profileLinesStyle3D;for(;i.length<s;){const n=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.width-o.outlineSize,width:o.width,falloff:o.falloff,color:o.outlineColor,renderOccluded:o.renderOccluded,isDecoration:!0});i.push(n)}const a=r.spatialReference;for(let n=0;n<s;++n){const d=i[n],l=e[s-1-n];d.geometry=this._createLineGeometry(l,a),d.innerColor=L(P.toUnitRGBA(l.color))}}_createLineGeometry(r,t){const i=r.samples??[],e=i.length-1,s=[];let o=[];for(let a=0;a<=e;a++){const{x:n,y:d,z:l}=i[a];l!=null&&o.push([n,d,l]),a!==e&&l!=null||!o.length||(s.push(o),o=[])}return new k({paths:s,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};c([f()],m.prototype,"view",void 0),c([f()],m.prototype,"_chartData",void 0),m=c([b("esri.widgets.ElevationProfile.support.ProfileLines3D")],m);class fe{constructor(t,i){this._handles=new T,this._inputRepresentation=new x({view:t}),this._hoveredPoints=new V({view:t}),this._profileLines=new m({view:t}),this._handles.add([p(()=>i.viewModel.hoveredPoints,e=>this._hoveredPoints.update(e),h),p(()=>{const{state:e,editable:s,highlightEnabled:o,viewModel:a}=i,n=a.input;return n&&(n.commitProperty("geometry"),n.commitProperty("layer")),{input:n,state:e,editable:s,highlightEnabled:o}},e=>this._updateInputRepresentation(e),h),p(()=>i.viewModel.chartData,e=>this._profileLines.update(e),h),p(()=>{var e;return(e=i.viewModel.input)==null?void 0:e.geometry},()=>{this._profileLines.remove()},h)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:t,state:i,editable:e,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();i===v.Selected?o.showHighlight(t):i!==v.Created||e?o.remove():o.showReshaping(t)}}export{fe as ElevationProfileView3D};

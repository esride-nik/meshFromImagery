import{a5 as s,a9 as P,a6 as p,bA as B,h5 as V,cb as u,cd as I,kn as D,an as y,gs as R}from"./index-b516d057.js";import{x as S,T as z}from"./Features-637f842c.js";import{e as H,O as U,n as E,Q as A}from"./jsxFactory-92036771.js";import{e as j}from"./globalCss-94006b67.js";import{e as Q}from"./vmEvent-d773b6c5.js";import"./throttle-7bf02de9.js";import"./Feature-6b48db78.js";import"./Attachments-ef3101ea.js";import"./unitFormatUtils-67047561.js";import"./Cyclical-4c223a04.js";import"./AttachmentInfo-3d2302be.js";import"./AttachmentQuery-bede5a71.js";import"./featureUtils-73b624d6.js";import"./utils-1a995f8e.js";import"./basemapUtils-6ec10a55.js";import"./Basemap-8d62c69e.js";import"./loadAll-5e767cfa.js";import"./writeUtils-e226a8aa.js";import"./Heading-92f210ca.js";import"./widget-826a6ea9.js";import"./uriUtils-dead790b.js";import"./utils-6ca5af6f.js";import"./HeatmapColorStop-3fff4333.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./executeQueryJSON-eec0ecca.js";import"./query-351887b5.js";import"./pbfQueryUtils-b37a842c.js";import"./pbf-2651fe50.js";import"./OptimizedGeometry-196224d4.js";import"./OptimizedFeature-e90b69df.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./queryZScale-d7a48772.js";import"./featureConversionUtils-09cf00ff.js";import"./RelationshipQuery-2c9e4485.js";import"./TopFeaturesQuery-6d0bf5f5.js";import"./themeUtils-7dcf5b71.js";import"./FeatureLayer-c4c5819f.js";import"./jsonUtils-52514725.js";import"./DictionaryLoader-e327eff9.js";import"./Version-1f969b2a.js";import"./FieldsIndex-e8db657f.js";import"./UnknownTimeZone-a05df022.js";import"./heatmapUtils-7f42325f.js";import"./FeatureLayerBase-0746b503.js";import"./HeightModelInfo-b816d32b.js";import"./featureLayerUtils-16361d1f.js";import"./featureQueryAll-40af0622.js";import"./LayerFloorInfo-4234db4d.js";import"./serviceCapabilitiesUtils-42d4d20c.js";import"./editsZScale-e45bb69c.js";import"./APIKeyMixin-bfb00271.js";import"./EditBusLayer-caf9fed8.js";import"./uuid-709b6c67.js";import"./FeatureEffectLayer-1948d1a0.js";import"./FeatureEffect-c80bb16d.js";import"./FeatureFilter-55dd341e.js";import"./FeatureReductionLayer-443167bc.js";import"./clusterUtils-50a66940.js";import"./MD5-715f37cd.js";import"./FeatureReductionSelection-d84c375a.js";import"./LabelClass-c3c309a8.js";import"./labelUtils-b29175f3.js";import"./defaults-4faa92e6.js";import"./defaultsJSON-59981e75.js";import"./OrderedLayer-32293fe1.js";import"./FeatureTemplate-d1d1c7be.js";import"./FeatureType-f30c4b8b.js";import"./fieldProperties-8c831c84.js";import"./labelingInfo-aae625ac.js";import"./versionUtils-5892620e.js";import"./styleUtils-a3d96bf6.js";import"./FeatureRelationshipViewModel-9f00674c.js";import"./featureFormUtils-24147792.js";import"./resources-d4afed0c.js";import"./Spinner-2d11b064.js";import"./AnchorElementViewModel-8d35dd28.js";import"./ReactiveSet-7afb73d5.js";import"./LayerConstants-d3ac1b7a.js";import"./symbolUtils-b4f6caa2.js";import"./mat2df32-fb26a8c9.js";import"./mat2d-d4af8487.js";import"./webStyleSymbolUtils-4761c8f2.js";import"./devEnvironmentUtils-4eab2a99.js";import"./layerViewUtils-6ebe90f4.js";import"./actions-713d334d.js";import"./GoTo-4d856ce0.js";const g="esri-popup",b=`${g}--is-docked`,h={base:g,main:`${g}__main-container`,shadow:`${g}--shadow`,isDocked:b,isDockedTopLeft:`${b}-top-left`,isDockedTopCenter:`${b}-top-center`,isDockedTopRight:`${b}-top-right`,isDockedBottomLeft:`${b}-bottom-left`,isDockedBottomCenter:`${b}-bottom-center`,isDockedBottomRight:`${b}-bottom-right`,alignTopCenter:`${g}--aligned-top-center`,alignBottomCenter:`${g}--aligned-bottom-center`,alignTopLeft:`${g}--aligned-top-left`,alignBottomLeft:`${g}--aligned-bottom-left`,alignTopRight:`${g}--aligned-top-right`,alignBottomRight:`${g}--aligned-bottom-right`,pointer:`${g}__pointer`,pointerDirection:`${g}__pointer-direction`};let O=class extends S{constructor(t){super(t)}};O=s([P("esri.widgets.Popup.PopupViewModel")],O);const L=O;let w=class extends B{constructor(){super(...arguments),this.closeButton=!0,this.featureNavigation=!0}};s([p({type:Boolean,nonNullable:!0})],w.prototype,"closeButton",void 0),s([p({type:Boolean,nonNullable:!0})],w.prototype,"featureNavigation",void 0),w=s([P("esri.widgets.Features.PopupVisibleElements")],w);const N=w,$={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};let l=class extends U{constructor(t,e){super(t,e),this._dockAction=new V({id:"popup-dock-action"}),this._featuresWidget=new z({responsiveActionsEnabled:!0}),this._containerNode=null,this._mainContainerNode=null,this._pointerOffsetInPx=16,this.alignment="auto",this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.headingLevel=2,this.maxInlineActions=3,this.messages=null,this.spinnerEnabled=!0,this.viewModel=new L,this.visibleElements=new N}initialize(){this.addHandles([u(()=>{var t,e;return[(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.widthBreakpoint,this.dockEnabled]},()=>this._handleDockIcon(),{initial:!0}),u(()=>{var t,e;return[this.dockEnabled,(t=this.messages)==null?void 0:t.undock,(e=this.messages)==null?void 0:e.dock]},()=>this._handleDockEnabled(),{initial:!0}),u(()=>this.dockOptions,t=>{const{_dockAction:e}=this,i=this._featuresWidget.headerActions;i.remove(e),t.buttonEnabled&&i.add(e)},{initial:!0}),u(()=>{var t;return(t=this.viewModel)==null?void 0:t.screenLocation},()=>this._positionContainer()),u(()=>{var t;return[(t=this.viewModel)==null?void 0:t.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),u(()=>{var t,e,i,r,a,o,n;return[(t=this.viewModel)==null?void 0:t.screenLocation,(i=(e=this.viewModel)==null?void 0:e.view)==null?void 0:i.padding,(a=(r=this.viewModel)==null?void 0:r.view)==null?void 0:a.size,(o=this.viewModel)==null?void 0:o.active,(n=this.viewModel)==null?void 0:n.location,this.alignment]},()=>this.reposition()),u(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.size},(t,e)=>this._updateDockEnabledForViewSize(t,e)),u(()=>{var t;return(t=this.viewModel)==null?void 0:t.view},(t,e)=>this._viewChange(t,e)),u(()=>{var t,e;return(e=(t=this.viewModel)==null?void 0:t.view)==null?void 0:e.ready},(t,e)=>this._viewReadyChange(t??!1,e??!1)),u(()=>this.viewModel,()=>this._featuresWidget.viewModel=this.viewModel,{initial:!0}),u(()=>this._featureNavigationTop,t=>this._featuresWidget.featureNavigationTop=t,{initial:!0}),u(()=>this.headingLevel,t=>this._featuresWidget.headingLevel=t,{initial:!0}),u(()=>this.collapseEnabled,t=>this._featuresWidget.visibleElements.collapseButton=t,{initial:!0}),u(()=>this.collapsed,t=>this._featuresWidget.collapsed=t,{initial:!0}),u(()=>this.visibleElements.closeButton,t=>this._featuresWidget.visibleElements.closeButton=!!t,{initial:!0}),u(()=>this.spinnerEnabled,t=>this._featuresWidget.visibleElements.spinner=t,{initial:!0}),u(()=>this.visibleElements.featureNavigation,t=>this._featuresWidget.visibleElements.featureNavigation=!!t,{initial:!0}),I(()=>this._featuresWidget,"trigger-header-action",t=>{t.action===this._dockAction&&(this.dockEnabled=!this.dockEnabled)})])}destroy(){var t;this._dockAction.destroy(),(t=this._featuresWidget)==null||t.destroy()}get _featureNavigationTop(){const{currentAlignment:t,currentDockPosition:e}=this;return t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||e==="top-left"||e==="top-center"||e==="top-right"}get actions(){return this.viewModel.actions}set actions(t){this.viewModel.actions=t}get autoCloseEnabled(){return this.viewModel.autoCloseEnabled}set autoCloseEnabled(t){this.viewModel.autoCloseEnabled=t}get autoOpenEnabled(){return D(y.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled}set autoOpenEnabled(t){D(y.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=t}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(t){this.viewModel.defaultPopupTemplateEnabled=t}get content(){return this.viewModel.content}set content(t){this.viewModel.content=t}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||$}set dockOptions(t){var c,d;const e={...$},i=(d=(c=this.viewModel)==null?void 0:c.view)==null?void 0:d.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const a={...e,...t},o={...e.breakpoint,...r},{breakpoint:n}=a;typeof n=="object"?a.breakpoint={...o,...n}:n&&(a.breakpoint=o),this._set("dockOptions",a),this._setCurrentDockPosition(),this.reposition()}get featureCount(){return this.viewModel.featureCount}get featureMenuOpen(){return this.viewModel.featureMenuOpen}set featureMenuOpen(t){this.viewModel.featureMenuOpen=t}get features(){return this.viewModel.features}set features(t){this.viewModel.features=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get highlightEnabled(){return this.viewModel.highlightEnabled}set highlightEnabled(t){this.viewModel.highlightEnabled=t}get location(){return this.viewModel.location}set location(t){this.viewModel.location=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get promises(){return this.viewModel.promises}set promises(t){this.viewModel.promises=t}get selectedFeature(){return this.viewModel.selectedFeature}get selectedFeatureIndex(){return this.viewModel.selectedFeatureIndex}set selectedFeatureIndex(t){this.viewModel.selectedFeatureIndex=t}get selectedFeatureWidget(){return this._featuresWidget.selectedFeatureWidget}get title(){return this.viewModel.title}set title(t){this.viewModel.title=t}get updateLocationEnabled(){return this.viewModel.updateLocationEnabled}set updateLocationEnabled(t){this.viewModel.updateLocationEnabled=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}blur(){const{active:t}=this.viewModel;t||y.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}clear(){return this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(t,e){return this.viewModel.fetchFeatures(t,e)}focus(){const{active:t}=this.viewModel;t||y.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}next(){return this.viewModel.next()}open(t){const e=!!t&&!!t.featureMenuOpen,i={collapsed:!!t&&!!t.collapsed,featureMenuOpen:e};this.set(i),this.viewModel.open(t),this._shouldFocus(t)}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(t){return this.viewModel.triggerAction(t)}render(){var m,v,f,_;const{dockEnabled:t,currentAlignment:e,currentDockPosition:i}=this,{active:r}=this.viewModel,a=r&&t,o=r&&!t,n=(v=(m=this.selectedFeature)==null?void 0:m.layer)==null?void 0:v.title,c=(_=(f=this.selectedFeature)==null?void 0:f.layer)==null?void 0:_.id,d={[h.alignTopCenter]:e==="top-center",[h.alignBottomCenter]:e==="bottom-center",[h.alignTopLeft]:e==="top-left",[h.alignBottomLeft]:e==="bottom-left",[h.alignTopRight]:e==="top-right",[h.alignBottomRight]:e==="bottom-right",[h.isDocked]:a,[h.shadow]:o,[h.isDockedTopLeft]:i==="top-left",[h.isDockedTopCenter]:i==="top-center",[h.isDockedTopRight]:i==="top-right",[h.isDockedBottomLeft]:i==="bottom-left",[h.isDockedBottomCenter]:i==="bottom-center",[h.isDockedBottomRight]:i==="bottom-right"};return E("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(h.base,d),"data-layer-id":c,"data-layer-title":n,role:"presentation"},r?[this._renderMainContainer(),this._renderPointer()]:null)}_renderPointer(){return this.dockEnabled?null:E("div",{class:h.pointer,key:"popup-pointer",role:"presentation"},E("div",{class:this.classes(h.pointerDirection,h.shadow)}))}_renderMainContainer(){const{dockEnabled:t}=this,e={[h.shadow]:t};return E("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(h.main,j.widget,e)},this._featuresWidget.render())}async _shouldFocus(t){t!=null&&t.shouldFocus&&(await R(()=>{var e;return((e=this.viewModel)==null?void 0:e.active)===!0}),this.focus())}_isOutsideView(t){const{popupHeight:e,popupWidth:i,screenLocation:r,side:a,view:o}=t;if(isNaN(i)||isNaN(e)||!o||!r)return!1;const n=o.padding;return a==="right"&&r.x+i/2>o.width-n.right||a==="left"&&r.x-i/2<n.left||a==="top"&&r.y-e<n.top||a==="bottom"&&r.y+e>o.height-n.bottom}_calculateAutoAlignment(t){if(t!=="auto")return t;const{_pointerOffsetInPx:e,_containerNode:i,_mainContainerNode:r,viewModel:a}=this,{screenLocation:o,view:n}=a;if(o==null||!n||!i)return"top-center";function c(W){return parseInt(W.replaceAll(/[^-\d\.]/g,""),10)}const d=r?window.getComputedStyle(r,null):null,m=d?c(d.getPropertyValue("max-height")):0,v=d?c(d.getPropertyValue("height")):0,{height:f,width:_}=i.getBoundingClientRect(),k=_+e,M=Math.max(f,m,v)+e,x=this._isOutsideView({popupHeight:M,popupWidth:k,screenLocation:o,side:"right",view:n}),T=this._isOutsideView({popupHeight:M,popupWidth:k,screenLocation:o,side:"left",view:n}),C=this._isOutsideView({popupHeight:M,popupWidth:k,screenLocation:o,side:"top",view:n}),F=this._isOutsideView({popupHeight:M,popupWidth:k,screenLocation:o,side:"bottom",view:n});return T?C?"bottom-right":"top-right":x?C?"bottom-left":"top-left":C?F?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(t){return typeof t=="function"?t.call(this):t}_getCurrentAlignment(){const{alignment:t,dockEnabled:e}=this;return e||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(t)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(t){const e=["left","right"];return A(this.container)&&e.reverse(),t==null?void 0:t.replace(/leading/gi,e[0]).replaceAll(/trailing/gi,e[1])}_callDockPosition(t){return typeof t=="function"?t.call(this):t}_getDockPosition(){var t;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((t=this.dockOptions)==null?void 0:t.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_calculateAutoDockPosition(t){var n;if(t!=="auto")return t;const e=(n=this.viewModel)==null?void 0:n.view,i=A(this.container)?"top-left":"top-right";if(!e)return i;const r=e.padding||{left:0,right:0,top:0,bottom:0},a=e.width-r.left-r.right,{breakpoints:o}=e;return o&&a<=o.xsmall?"bottom-center":i}_getDockIcon(){const t=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(t){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}_handleDockIcon(){this._dockAction.icon=this._getDockIcon()}_handleDockEnabled(){var t,e;this._dockAction.title=this.dockEnabled?(t=this.messages)==null?void 0:t.undock:(e=this.messages)==null?void 0:e.dock}_setMainContainerNode(t){this._mainContainerNode=t}_positionContainer(t=this._containerNode){if(t&&(this._containerNode=t),!this._containerNode)return;const{screenLocation:e}=this.viewModel,{width:i}=this._containerNode.getBoundingClientRect(),r=this._calculatePositionStyle(e,i);r&&Object.assign(this._containerNode.style,r)}_calculateFullWidth(t){const{currentAlignment:e,_pointerOffsetInPx:i}=this;return e==="top-left"||e==="bottom-left"||e==="top-right"||e==="bottom-right"?t+i:t}_calculateAlignmentPosition(t,e,i,r){const{currentAlignment:a,_pointerOffsetInPx:o}=this;if(!i)return;const{padding:n}=i,c=r/2,d=i.height-e,m=i.width-t;return a==="bottom-center"?{top:e+o-n.top,left:t-c-n.left}:a==="top-left"?{bottom:d+o-n.bottom,right:m+o-n.right}:a==="bottom-left"?{top:e+o-n.top,right:m+o-n.right}:a==="top-right"?{bottom:d+o-n.bottom,left:t+o-n.left}:a==="bottom-right"?{top:e+o-n.top,left:t+o-n.left}:a==="top-center"?{bottom:d+o-n.bottom,left:t-c-n.left}:void 0}_calculatePositionStyle(t,e){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(t==null||!e)return;const a=this._calculateFullWidth(e),o=this._calculateAlignmentPosition(t.x,t.y,r,a);return o?{top:o.top!==void 0?`${o.top}px`:"auto",left:o.left!==void 0?`${o.left}px`:"auto",bottom:o.bottom!==void 0?`${o.bottom}px`:"auto",right:o.right!==void 0?`${o.right}px`:"auto"}:void 0}_viewChange(t,e){t&&e&&(this.close(),this.clear())}_viewReadyChange(t,e){t?this._wireUpView():e&&(this.close(),this.clear())}_wireUpView(){this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(t,e,i){const[r,a]=t,[o,n]=e,{width:c=0,height:d=0}=i??{};return r<=c&&o>c||r>c&&o<=c||a<=d&&n>d||a>d&&n<=d}_updateDockEnabledForViewSize(t,e){var m,v;if(!t||!e)return;const i=((v=(m=this.viewModel)==null?void 0:m.view)==null?void 0:v.padding)||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,a=i.top+i.bottom,o=[],n=[];o[0]=t[0]-r,o[1]=t[1]-a,n[0]=e[0]-r,n[1]=e[1]-a;const{dockOptions:c}=this,d=c.breakpoint;this._dockingThresholdCrossed(o,n,d)&&this._setDockEnabledForViewSize(c),this._setCurrentDockPosition()}_toggleScreenLocationEnabled(){const{dockEnabled:t,viewModel:e}=this;if(!e)return;const i=e.active&&!t;e.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(t){var c,d;const e=t.breakpoint,i=(d=(c=this.viewModel)==null?void 0:c.view)==null?void 0:d.ui;if(!i)return!1;const{width:r,height:a}=i;if(isNaN(r)||isNaN(a)||!e)return!1;const o=e.hasOwnProperty("width")&&r<=(e.width??0),n=e.hasOwnProperty("height")&&a<=(e.height??0);return o||n}_setDockEnabledForViewSize(t){t.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(t))}};s([p({readOnly:!0})],l.prototype,"_featureNavigationTop",null),s([p()],l.prototype,"actions",null),s([p()],l.prototype,"alignment",void 0),s([p()],l.prototype,"autoCloseEnabled",null),s([p()],l.prototype,"autoOpenEnabled",null),s([p()],l.prototype,"defaultPopupTemplateEnabled",null),s([p()],l.prototype,"content",null),s([p()],l.prototype,"collapsed",void 0),s([p()],l.prototype,"collapseEnabled",void 0),s([p({readOnly:!0})],l.prototype,"currentAlignment",null),s([p({readOnly:!0})],l.prototype,"currentDockPosition",null),s([p()],l.prototype,"dockOptions",null),s([p()],l.prototype,"dockEnabled",void 0),s([p({readOnly:!0})],l.prototype,"featureCount",null),s([p()],l.prototype,"featureMenuOpen",null),s([p()],l.prototype,"features",null),s([p()],l.prototype,"goToOverride",null),s([p()],l.prototype,"headingLevel",void 0),s([p()],l.prototype,"highlightEnabled",null),s([p()],l.prototype,"location",null),s([p()],l.prototype,"label",null),s([p()],l.prototype,"maxInlineActions",void 0),s([p(),H("esri/widgets/Popup/t9n/Popup")],l.prototype,"messages",void 0),s([p()],l.prototype,"promises",null),s([p({readOnly:!0})],l.prototype,"selectedFeature",null),s([p()],l.prototype,"selectedFeatureIndex",null),s([p({readOnly:!0})],l.prototype,"selectedFeatureWidget",null),s([p()],l.prototype,"spinnerEnabled",void 0),s([p()],l.prototype,"title",null),s([p()],l.prototype,"updateLocationEnabled",null),s([p()],l.prototype,"view",null),s([p({type:L}),Q(["triggerAction","trigger-action"])],l.prototype,"viewModel",void 0),s([p()],l.prototype,"visible",null),s([p({type:N,nonNullable:!0})],l.prototype,"visibleElements",void 0),l=s([P("esri.widgets.Popup")],l);const Pe=l;export{Pe as default};

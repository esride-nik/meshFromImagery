import{A as Yt,f6 as U,db as A,da as p,hW as xt,fv as Tt,d1 as Ot,l9 as tn,ft as nn,fq as it,d2 as en,la as on,lb as Pt,lc as an,ld as rn,f1 as cn,fx as Zt,b0 as dt,fZ as ln,d8 as wt,le as $,aW as L,lf as Z,gi as sn,a5 as Et}from"./index-b516d057.js";import{l as ft}from"./ViewingMode-5d7d590b.js";import{r as zt,t as un}from"./ShaderTechniqueConfiguration-2502462e.js";var It,Gt,St,ot={exports:{}};ot.exports,It=ot,Gt=function(){var n=Math.PI,t=Math.sin,e=Math.cos,i=Math.tan,l=Math.asin,a=Math.atan2,h=Math.acos,r=n/180,g=864e5,s=2440588,P=2451545,H={dec:0,ra:0};function R(o){return o.valueOf()/g-.5+s}function w(o){return new Date((o+.5-s)*g)}function E(o){return R(o)-P}var G=23.4397*r;function N(o,c){return a(t(o)*e(G)-i(c)*t(G),e(o))}function y(o,c){return l(t(c)*e(G)+e(c)*t(G)*t(o))}function M(o,c,u){return a(t(o),e(o)*t(c)-i(u)*e(c))}function T(o,c,u){return l(t(c)*t(u)+e(c)*e(u)*e(o))}function S(o,c){return r*(280.16+360.9856235*o)-c}function _(o){return r*(357.5291+.98560028*o)}function d(o){return r*(1.9148*t(o)+.02*t(2*o)+3e-4*t(3*o))}function ht(o,c){return o+c+102.9372*r+n}function mt(o,c){var u=_(o),f=ht(u,d(u));return c||(c={dec:0,ra:0}),c.dec=y(f,0),c.ra=N(f,0),c}var z={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(o,c,u,f){var b=r*-u,v=r*c,x=E(o),O=mt(x,H),I=S(x,b)-O.ra;return f||(f={azimuth:0,altitude:0}),f.azimuth=M(I,v,O.dec),f.altitude=T(I,v,O.dec),f}},F=[[-.83,"sunrise","sunset"]];z.addTime=function(o,c,u){F.push([o,c,u])};var gt=9e-4;function Kt(o,c){return Math.round(o-gt-c/(2*n))}function bt(o,c,u){return gt+(o+c)/(2*n)+u}function pt(o,c,u){return P+o+.0053*t(c)-.0069*t(2*u)}function Qt(o,c,u){return h((t(o)-t(c)*t(u))/(e(c)*e(u)))}function yt(o){var c=r*(134.963+13.064993*o),u=r*(93.272+13.22935*o),f=r*(218.316+13.176396*o)+6.289*r*t(c),b=5.128*r*t(u),v=385001-20905*e(c);return{ra:N(f,b),dec:y(f,b),dist:v}}return z.getTimes=function(o,c,u){var f=r*-u,b=r*c,v=Kt(E(o),f),x=bt(0,f,v),O=_(x),I=d(O),B=ht(O,I),J=y(B,0),C=pt(x,O,B);function Vt(Q){return pt(bt(Qt(Q,b,J),f,v),O,B)}function Xt(Q){var Mt=(t(Q)-t(b)*t(J))/(e(b)*e(J));return Mt<-1?z.PolarException.MIDNIGHT_SUN:Mt>1?z.PolarException.POLAR_NIGHT:z.PolarException.NORMAL}var W,vt,K,At,Nt,j={solarNoon:w(C),nadir:w(C-.5),polarException:z.PolarException.NORMAL};for(W=0,vt=F.length;W<vt;W+=1)Nt=C-((At=Vt((K=F[W])[0]*r))-C),j[K[1]]=w(Nt),j[K[2]]=w(At);return j.polarException=Xt(F[0][0]*r),j},z.getMoonPosition=function(o,c,u){var f=r*-u,b=r*c,v=E(o),x=yt(v),O=S(v,f)-x.ra,I=T(O,b,x.dec);return I+=.017*r/i(I+10.26*r/(I+5.1*r)),{azimuth:M(O,b,x.dec),altitude:I,distance:x.dist}},z.getMoonFraction=function(o){var c=E(o),u=mt(c),f=yt(c),b=149598e3,v=h(t(u.dec)*t(f.dec)+e(u.dec)*e(f.dec)*e(u.ra-f.ra)),x=a(b*t(v),f.dist-b*e(v));return(1+e(x))/2},z},(St=Gt())!==void 0&&(It.exports=St);const D=Yt(ot.exports),m={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};class k{constructor(t,e){this.direct=t,this.ambient=e}}function Mn(n,t,e,i,l,a){U(a.ambient.color,1,1,1),a.ambient.intensity=m.global.ambient,U(a.direct.color,1,1,1),a.direct.intensity=m.global.direct;const h=t[2],r=dt((Math.abs(h)-m.local.altitude)/(m.global.altitude-m.local.altitude),0,1);let g;if(a.globalFactor=r,n!=null&&(g=D.getTimes(n,t[1],t[0])),r<1){let s;if(n!=null)s=bn(n,g,i);else{const P=Jt(i);s={direct:{intensity:m.local.directAtNoon*P.direct,color:A(1,1,1)},ambient:{intensity:m.local.ambientAtNoon*P.ambient,color:A(1,1,1)},timeOfDay:"early afternoon"}}p(a.ambient.color,s.ambient.color,a.ambient.color,r),a.ambient.intensity=xt(s.ambient.intensity,a.ambient.intensity,r),p(a.direct.color,s.direct.color,a.direct.color,r),a.direct.intensity=xt(s.direct.intensity,a.direct.intensity,r),a.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,a.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}a.noonFactor=n!=null?gn(n,g):1,n!=null?Bt(n,t,e,a.direct.directionToLightSource):dn(l,e,a.direct.directionToLightSource)}function dn(n,t,e){t===ft.Global?Tt(tt,n.eye):U(tt,0,0,1),Ot(nt,n.viewForward,-1);const i=tn(nt,tt),l=Math.max(i-2*et,0),a=.85*l/(l+1),h=Math.max(et,i-et-a);nn(kt,-h,n.viewRight),it(e,nt,kt),en(e,e,Ot(pn,n.viewRight,yn)),Tt(e,e)}function Bt(n,t,e,i){const l=mn,a=on(hn);if(e===ft.Global)D.getPosition(n,0,0,l),U(i,0,0,-1),Pt(a,a,-l.azimuth),an(a,a,-l.altitude),it(i,i,a);else{const h=m.planarDirection,r=h.globalAngles,g=t[2];let s=(Math.abs(g)-h.localAltitude)/(h.globalAltitude-h.localAltitude);s=dt(s,0,1),s<1?(D.getPosition(n,t[1],t[0],l),l.azimuth=(1-s)*l.azimuth+s*r.azimuth,l.altitude=(1-s)*l.altitude+s*r.altitude):(l.azimuth=r.azimuth,l.altitude=r.altitude),U(i,0,-1,0),rn(a,a,-l.azimuth),Pt(a,a,-l.altitude),it(i,i,a)}}function xn(n,t){if(t===ft.Global)return!0;const e=m.planarDirection;return Math.abs(n)<e.localAltitude}function Tn(n,t,e,i,l){const a=n.getTime(),h=t.getTime()-a,r=Math.floor(h/e)+1,g=new Array(r);for(let s=0;s<r;++s)jt.setTime(a+e*s),g[s]=L(),Bt(jt,i,l,g[s]);return g}const fn=A(.5773502691896258,-.5773502691896258,.5773502691896258);class On{constructor(){this.ambient={color:A(1,1,1),intensity:.55},this.direct={color:A(1,1,1),intensity:.55,directionToLightSource:cn(fn)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const hn=Zt(),mn={azimuth:0,altitude:0};function gn(n,t){const e=n.valueOf();let i,l;t.polarException===D.PolarException.MIDNIGHT_SUN?(i=e-60*(n.getHours()+48)*60*1e3-60*n.getMinutes()*1e3,l=i+432e6):t.polarException===D.PolarException.POLAR_NIGHT?(i=e-2,l=e-1):(i=t.sunrise.valueOf(),l=t.sunset.valueOf());const a=i+(l-i)/2;return 1-dt(Math.abs(e-a)/432e5,0,1)}function Jt(n){switch(n){case"disabled":case"sunny":case"cloudy":return new k(1,1);case"rainy":return new k(.4,1.2);case"snowy":return new k(.5,1.3);case"foggy":return new k(.2,1.6)}}function Dt(n,t){const e=(n[0]+n[1]+n[2])/3;n[0]+=(e-n[0])*t,n[1]+=(e-n[1])*t,n[2]+=(e-n[2])*t}const V=A(.01,.01,.01),at=A(1,.6,.5),rt=A(1,.98,.98),Ht=A(1,1,1),X=A(.8,.8,1),ct=A(.8,.8,1),lt=A(.98,.98,1),$t=A(1,1,1),Y=Z(.01,m.local.ambientAtNight),st=Z(m.local.directAtTwilight,m.local.ambientAtTwilight),ut=Z(.9*m.local.directAtNoon,m.local.ambientAtNoon),Lt=Z(m.local.directAtNoon,m.local.ambientAtNoon),Rt=ut,_t=rt,Ut=lt,Ft=st,Ct=at,Wt=ct;function bn(n,t,e){const i=n.valueOf();let l,a;t.polarException===D.PolarException.MIDNIGHT_SUN?(l=i-60*(n.getHours()+48)*60*1e3-60*n.getMinutes()*1e3,a=l+432e6):t.polarException===D.PolarException.POLAR_NIGHT?(l=i-2,a=i-1):(l=t.sunrise.valueOf(),a=t.sunset.valueOf());const h=a-l,r=l+h/2,g=h/4,s=r-g,P=r+g,H=.06*h,R=l-H/2,w=l+H/2,E=a-H/2,G=a+H/2,N=sn(),y=L(),M=L();let T="";if(i<R||i>G)ln(N,Y),wt(y,V),wt(M,X),T="night";else if(i<w){const d=(i-R)/(w-R);$(N,Y,st,d),p(y,V,at,d),p(M,X,ct,d),T="sun rising"}else if(i<s){const d=(i-w)/(s-w);$(N,st,ut,d),p(y,at,rt,d),p(M,ct,lt,d),T="early morning"}else if(i<r){const d=(i-s)/(r-s);$(N,ut,Lt,d),p(y,rt,Ht,d),p(M,lt,$t,d),T="late morning"}else if(i<P){const d=(i-r)/(P-r);$(N,Lt,Rt,d),p(y,Ht,_t,d),p(M,$t,Ut,d),T="early afternoon"}else if(i<E){const d=(i-P)/(E-P);$(N,Rt,Ft,d),p(y,_t,Ct,d),p(M,Ut,Wt,d),T="late afternoon"}else if(i<G){const d=(i-E)/(G-E);$(N,Ft,Y,d),p(y,Ct,V,d),p(M,Wt,X,d),T="sun setting"}let S=0;switch(e){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(Dt(y,S),Dt(M,S));const _=Jt(e);return{direct:{intensity:N[0]*_.direct,color:y},ambient:{intensity:N[1]*_.ambient,color:M},timeOfDay:T}}const jt=new Date(0),kt=Zt(),tt=L(),nt=L(),pn=L(),et=.25,yn=.2;var q;(function(n){n[n.Gradient=0]="Gradient",n[n.Threshold=1]="Threshold",n[n.COUNT=2]="COUNT"})(q||(q={}));class qt extends un{constructor(){super(...arguments),this.visualization=q.Gradient,this.bandsEnabled=!1}}Et([zt({count:q.COUNT})],qt.prototype,"visualization",void 0),Et([zt()],qt.prototype,"bandsEnabled",void 0);export{On as E,dn as O,Mn as S,Tn as k,qt as r,q as t,D as u,xn as z};

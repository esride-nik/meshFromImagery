import{a5 as h,a9 as $,a6 as l,aP as P,b5 as v,ki as c,h7 as b}from"./index-b516d057.js";import{e as k,O as D,n as w}from"./jsxFactory-92036771.js";import{e as g}from"./globalCss-94006b67.js";import{p as F}from"./DatePicker-ccc9fd8a.js";let f=class extends F{constructor(e){super(e)}};f=h([$("esri.widgets.support.TimePickerViewModel")],f);const x=f,_="esri-time-picker",O={base:_,timePicker:`${_}__date-picker`,timePickerInput:`${_}__input`},I="t",S=new Set(["ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Tab"]);function y(e,t){return e!=null&&v(e.valueOf(),t).includes(" ")}let o=class extends D{constructor(e,t){super(e,t),this._activePart=null,this._activeTime=null,this.messages=null,this.timeZone=null,this.timeZoneName=null,this.viewModel=new x}get _dateTimeFormatOptions(){return{hour:"numeric",minute:"numeric",timeZone:this.timeZone??void 0,timeZoneName:this.timeZoneName??void 0}}get _dateTimeOptions(){return{locale:P(),numberingSystem:"latn",zone:this.timeZone||void 0}}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}render(){const e=this._activeTime||this.viewModel.value;return w("div",{class:this.classes(O.base,g.widget)},w("input",{afterUpdate:this._handleInputUpdate,"aria-label":this.messages.inputTitle,bind:this,class:this.classes(O.timePickerInput,g.input),onblur:this._handleInputBlur,onclick:this._handleInputClick,onfocus:this._handleInputFocus,oninput:this._handleInputKeydown,onkeydown:this._handleInputKeydown,onpaste:this._handleInputPaste,onwheel:this._handleInputWheel,value:v(e.valueOf(),this._dateTimeFormatOptions)}))}_handleInputBlur(){var e;(e=this._activeTime)!=null&&e.isValid&&(this.viewModel.value=this._activeTime.toJSDate()),this._activeTime=null,this._activePart=null}_handleInputUpdate(e){this._selectPart(e,this._activePart)}_selectPart(e,t){const s=this._activeTime;if(!s||!e)return;const a=v(s.valueOf(),this._dateTimeFormatOptions),i=0,r=a.indexOf(":");if(t==="hours")return void e.setSelectionRange(i,r);const n=r+1,u=n+2;if(t==="minutes")return void e.setSelectionRange(n,u);const d=u+1,p=a.length;t!=="meridiem"||e.setSelectionRange(d,p)}_handleInputFocus(e){this._activePart="hours",this._activeTime=c.fromJSDate(this.viewModel.value,{zone:this.timeZone||void 0}).startOf("minute"),this._selectPart(e.target,"hours")}_caretIndexToPartName(e){var i;const t=(i=this._activeTime)==null?void 0:i.toFormat(I,{locale:P(),numberingSystem:"latn"});if(!t)return null;const s=t.indexOf(":"),a=t.indexOf(" ");return e<=s?"hours":e>s&&e<=a?"minutes":"meridiem"}_handleInputKeydown(e){const{ctrlKey:t,metaKey:s,shiftKey:a}=e,i=b(e),r=this._activeTime,n=this._activePart,u=/\d/.test(i),d=/^a|p$/i.test(i),p=s||t;if((S.has(i)||u||n==="meridiem"&&d&&!p)&&r!=null){if(i==="ArrowLeft")this._activePart=this._prevPart();else if(i==="ArrowRight")this._activePart=this._nextPart();else if(i==="Tab"){const m=a?this._prevPart():this._nextPart();if(m===this._activePart)return;this._activePart=m}else if(i==="ArrowUp")this._shift("up",n);else if(i==="ArrowDown")this._shift("down",n);else if(u)this._setTime(r,n,Number(i));else if(d){const m=i.toLowerCase(),T=r.hour;(m==="a"&&T>=12||m==="p"&&T<12)&&this._shift("up",n)}e.preventDefault(),e.stopImmediatePropagation()}else p||(e.preventDefault(),e.stopImmediatePropagation())}_handleInputClick(e){const t=e.target;this._activePart=null,this.renderNow(),this._activePart=this._caretIndexToPartName(t.selectionStart??0)}_getOrderedParts(){return y(this._activeTime,this._dateTimeFormatOptions)?["hours","minutes","meridiem"]:["hours","minutes"]}_prevPart(){const e=this._getOrderedParts(),t=this._activePart?e.indexOf(this._activePart)-1:0;return e[Math.max(t,0)]}_nextPart(){const e=this._getOrderedParts(),t=this._activePart?e.indexOf(this._activePart)+1:0;return e[Math.min(t,e.length-1)]}_setTime(e,t,s){if(t==="hours"){const a=y(e,this._dateTimeFormatOptions)?12:24,i=""+e.hour%a,r=s,n=+`${i}${s}`;i.length===2||n>a?this._activeTime=e.set({hour:r}):n<=a&&(this._activeTime=e.set({hour:n}))}else if(t==="minutes"){const i=`${e.minute}`,r=s,n=+`${i}${s}`;i.length===2||n>59?this._activeTime=e.set({minute:r}):n<59&&(this._activeTime=e.set({minute:n}))}}_parseTime(e){if(!e)return null;let t=c.fromFormat(e,I,this._dateTimeOptions);return t.isValid?t:(t=c.fromISO(e,this._dateTimeOptions),t.isValid?t:(t=c.fromRFC2822(e,this._dateTimeOptions),t.isValid?t:(t=c.fromJSDate(new Date(e),this._dateTimeOptions),t.isValid?t:null)))}_handleInputPaste(e){var a;const t=(a=e.clipboardData)==null?void 0:a.getData("text/plain"),s=this._parseTime(t);s&&(this._activeTime=s),e.preventDefault(),e.stopImmediatePropagation()}_handleInputWheel(e){const t=e.deltaY<0?"up":"down";this._shift(t,this._activePart)}_shift(e,t){var r;if(!t)return;const s=e==="up"?"plus":"minus",a=t==="meridiem"?12:1,i=t==="hours"?"hour":t==="minutes"?"minute":"hours";this._activeTime=((r=this._activeTime)==null?void 0:r[s]({[i]:a}))??null}};h([l()],o.prototype,"_dateTimeFormatOptions",null),h([l()],o.prototype,"_dateTimeOptions",null),h([l(),k("esri/widgets/support/t9n/TimePicker")],o.prototype,"messages",void 0),h([l()],o.prototype,"timeZone",void 0),h([l()],o.prototype,"timeZoneName",void 0),h([l()],o.prototype,"value",null),h([l({type:x})],o.prototype,"viewModel",void 0),o=h([$("esri.widgets.support.TimePicker")],o);const K=o;export{K as T};

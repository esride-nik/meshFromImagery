import{g9 as Oe,kJ as Ot,_ as x,y as oe,ez as pe,br as je,ah as ht,di as ze,D as Ge,l6 as Lt,hW as pt,le as Tt,da as Ut,bh as qe,dN as ue,kj as Vt,jj as At,E as zt,al as Bt,kz as Nt,eN as Gt,rS as qt,a5 as o,a6 as r,a9 as R,bA as _e,cb as I,dr as ne,hQ as me,cn as Le,q as Zt,gj as he,gl as Be,bg as Ht,dA as Q,ce as dt,kR as Ft,B as jt,rT as Wt,rU as vt,cd as De,a$ as We,fX as Qt,n4 as Yt,fz as Xt,f6 as Jt,gC as Kt,V as Ne,eL as ei,cc as ti,b9 as z,ao as $e,dD as ii,dT as ni,eH as _t,iq as Qe,an as si,ep as oi,pL as ri,pK as ai,aS as li,k9 as ci,kp as Ye,h1 as ui,h3 as Xe,iL as hi}from"./index-b516d057.js";import{t as H}from"./memoize-3e55df82.js";import{i as pi,e as Ce,O as Se,r as Te,n as d,X as Re,I as di}from"./jsxFactory-92036771.js";import{f as vi,t as _i}from"./intersectorUtilsConversions-d05d75a3.js";import{e as mi}from"./defaultUnit-414db021.js";import{e as mt}from"./throttle-7bf02de9.js";import{i as fi,s as ft}from"./elevationInfoUtils-be36d866.js";import{d as gi}from"./Material-5f4156ac.js";import{y as yi,M as bi,b as wi,z as gt}from"./geodesicUtils-822c19ca.js";import{_ as Ci}from"./QueueProcessor-4b9d43d3.js";import{I as Si}from"./Scheduler-ff5943a4.js";import{n as Pi}from"./traversalUtils-bbdec2e9.js";import{n as Ei}from"./uuid-709b6c67.js";import{b as ki}from"./Ground-ed93a93a.js";import{GeometryDescriptor as yt}from"./ElevationQuery-4be4efe0.js";import{b as $i,t as xi}from"./Intersector-fa865806.js";import{a as Ii}from"./SketchViewModel-fedf7932.js";import{g as Je,U as Ke}from"./unitFormatUtils-67047561.js";import{n as Ri}from"./UnitSelect-52961079.js";import{e as Ve}from"./globalCss-94006b67.js";const $="esri-elevation-profile",S={widgetIcon:pi.elevationProfile,base:`${$}`,portrait:`${$}--portrait`,refined:`${$}--refined`,mainContainer:`${$}__main-container`,promptContainer:`${$}__prompt-container`,header:`${$}__header`,zoomOutButton:`${$}__zoom-out-button`,clearButton:`${$}__clear-button`,actionButton:`${$}__action-button`,sketchButton:`${$}__sketch-button`,sketchCancelButton:`${$}__sketch-cancel-button`,sketchDoneButton:`${$}__sketch-done-button`,selectButton:`${$}__select-button`,selectCancelButton:`${$}__select-cancel-button`,chartContainer:`${$}__chart-container`,chartSpinner:`${$}__chart-spinner`,chartSpinnerVisible:`${$}__chart-spinner--visible`,chartSpinnerSmall:`${$}__chart-spinner--small`,footer:`${$}__footer`},Mi={base:"esri-elevation-profile-legend"},K="esri-elevation-profile-legend-item",ee={base:K,disabled:`${K}--disabled`,expanded:`${K}--expanded`,colorIndicator:`${K}__color-indicator`,header:`${K}__header`,content:`${K}__content`,collapseToggle:`${K}__collapse-toggle`,label:`${K}__label`,checkbox:`${K}__checkbox`},ye="esri-elevation-profile-statistics",be={base:ye,statistic:`${ye}__statistic`,statisticLabel:`${ye}__statistic__label`,statisticValue:`${ye}__statistic__value`,slopeValue:`${ye}__slope-value`},xe="esri-elevation-profile-settings",Ie={base:`${xe}`,popoverContent:`${xe}__popover-content`,uniformChartScalingLabel:`${xe}__uniform-scaling-label`,uniformChartScalingCheckbox:`${xe}__uniform-scaling-checkbox`};var L,k;(function(e){e.Disabled="disabled",e.Ready="ready",e.Creating="creating",e.Created="created",e.Selecting="selecting",e.Selected="selected"})(L||(L={})),function(e){e.NoValidInput="no-valid-input",e.NoVisibleProfiles="no-visible-profiles",e.InvalidGeometry="invalid-geometry",e.TooComplex="too-complex",e.InvalidElevationInfo="invalid-elevation-info",e.UnknownError="unknown-error",e.RefinedButNoChartData="refined-but-no-chart-data",e.None="none"}(k||(k={}));let bt={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:bt.noDataValue,demResolution:"auto",maximumAutoTileRequests:150,ignoreInvisibleLayers:!0}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:Oe(10,"centimeters","meters"),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,portraitModePixelBreakpoint:400,profileLinesStyle3D:{width:3,outlineSize:0,falloff:0,outlineColor:Ot([1,1,1,0]),renderOccluded:gi.Opaque},hoveredPointsStyle:{size:14,borderStyle:"solid",borderWidth:3,borderColor:"#ffffff",boxShadow:"0px 0px 0px 5px rgba(255,255,255,0.2)"}};function N(){return bt}const Di=" â€• ",Oi={progress:1,hasZ:!1,samples:[],statistics:null,spatialReference:null},wt="ProfileGenerationError";var B;(function(e){e.TooComplex="too-complex",e.InvalidGeometry="invalid-geometry",e.InvalidElevationInfo="invalid-elevation-info",e.ElevationQueryError="elevation-query-error"})(B||(B={}));let ve=class extends Error{constructor(t){super("profile could not be generated",{cause:t}),this.type=wt}};function Li(e){return e.type===wt}async function Ti(e,t,i,n,s,a,l){let c,u,h;const p=e.spatialReference,v=p.isGeographic||p.isWebMercator;let f=0;if(!v){const{planarLength:b}=await x(()=>import("./geometryEngineAsync-5fa34d0d.js"),["assets/geometryEngineAsync-5fa34d0d.js","assets/index-b516d057.js","assets/index-b252abd2.css"]);oe(l),f=await b(e,"meters"),oe(l)}const _=1/pe(n);if(v||f>=s.geodesicDistanceThreshold){await je([{source:p,dest:n},{source:p,dest:ht.WGS84}],l);const b=Fi(e);c=yi([b],"meters")[0];const E=et(c,s);if(nt(e,c,E)>a)throw new ve(B.TooComplex);const m=tt(b,t,i);({densifiedPath:u,distances:h}=zi(m,E,_)),u=ze(u,n)}else{await je([{source:p,dest:n}],l),c=f;const b=et(c,s);if(nt(e,c,b)>a)throw new ve(B.TooComplex);const E=tt(e,t,i);({densifiedPath:u,distances:h}=Ai(E,b,_)),oe(l),u=ze(u,n)}return{densifiedPath:u,pathLength:c*_,distances:h}}function et(e,t){const i=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,i)}function tt(e,t,i){if(t==null)return it(e);const n=e.spatialReference,s=t.mode,a=t.offset??0;let l=null;switch(i.type){case"2d":l=Ui(e,s,a);break;case"3d":l=Vi(e,s,a,i)}return l==null?it(e):new Ge({hasZ:!0,hasM:!1,spatialReference:n,paths:Ct(e.paths,l)})}function Ui({hasZ:e},t,i){return t==="absolute-height"?e?([n,s,a])=>[n,s,a+i]:([n,s])=>[n,s,i]:null}function Vi({spatialReference:e,hasZ:t},i,n,{elevationProvider:s}){const a=(l,c,u,h)=>(s==null?void 0:s.getElevation(l,c,u,e,h))??0;switch(i){case"on-the-ground":return([l,c])=>[l,c,a(l,c,0,"ground")];case"absolute-height":return t?([l,c,u])=>[l,c,u+n]:([l,c])=>[l,c,n];case"relative-to-ground":return t?([l,c,u])=>[l,c,u+a(l,c,u,"ground")+n]:([l,c])=>[l,c,a(l,c,0,"ground")+n];case"relative-to-scene":return t?([l,c,u])=>[l,c,u+a(l,c,u,"scene")+n]:([l,c])=>[l,c,a(l,c,0,"scene")+n];default:return null}}function it(e){return e.hasZ?new Ge({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:Ct(e.paths,([t,i])=>[t,i])}):e}function Ct(e,t){const i=e.length,n=new Array(i);for(let s=0;s<i;++s){const a=e[s],l=a.length,c=new Array(a.length);n[s]=c;for(let u=0;u<l;++u)c[u]=t(a[u])}return n}function Ze(e){return Pe(e)&&e.paths.length>0&&e.paths.every(t=>t.length>=2)}function Pe(e){return e!=null&&e.type==="polyline"}function St(e,t,i,n,s){const{spatialReference:a,hasZ:l}=e,c={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:a,metersPerSR:pe(a)},u=[],h=[];let p=0;for(let v=0;v<e.paths.length;++v){const f=e.paths[v],_=new Array,b=new Array;let E=0;for(let m=1;m<f.length;++m){const C=f[m-1],T=f[m],D=n(c,C,T);let F;for(F=E;F<D.distance;F+=t)_.push(s(D,F)),b.push((p+F)*i);E=F-D.distance,p+=D.distance,_.push(T),b.push(p*i)}u[v]=_,h[v]=b}return{densifiedPath:new Ge({spatialReference:a,hasZ:l,paths:u}),distances:h}}function Ai(e,t,i){const{hasZ:n}=e;return St(e,t,i,Ni,n?Hi:Zi)}function zi(e,t,i){const{hasZ:n}=e;return St(e,t,i,Bi,n?qi:Gi)}function Bi(e,t,i){return e.distance=0,wi(e,t,i,e.spatialReference),e.from=t,e.to=i,e}function Ni(e,t,i){return e.from=t,e.to=i,e.distance=Lt(i,t)*e.metersPerSR,e}function Gi({from:e,azimuth:t,spatialReference:i},n){return gt([0,0],e,t,n,i)}function qi({from:e,to:t,azimuth:i,distance:n,spatialReference:s},a){const l=a/n,c=[0,0,pt(e[2],t[2],l)];return gt(c,e,i,a,s),c}function Zi({from:e,to:t,distance:i},n){return Tt([0,0],e,t,n/i)}function Hi({from:e,to:t,distance:i},n){return Ut([0,0,0],e,t,n/i)}function Fi(e){return bi(e.spatialReference)?e:ze(e,ht.WGS84)}function Pt(e){return e.paths.reduce((t,i)=>t+i.length,0)}function nt(e,t,i){return Pt(e)+Math.floor(t/i)+Math.max(0,e.paths.reduce(n=>1+n,0)-1)}function ji(e,t){const i=e.length;if(i===0)return null;const n=e[0],s=n.sampledZ;let a=s,l=s,c=0,u=0,h=null,p=null,v=s??0,f=0,_=0,b=s!=null?1:0,E=0,m=0;const C=pe(t),T=ue(t),D=N().minSlopeSampleDistance/C,F=2*D,Y=new st,j=new st,Ue=()=>{Dt(),Y.copy(j),j.reset()},Fe=(G,fe)=>{Ue(),G>0&&G-Y.start<=F&&(G=Y.start+D),j.restart(G,fe)},Dt=()=>{if(Y.isHole||j.isHole)return;const G=j.avgElevation-Y.avgElevation,fe=j.start-Y.start,ge=G*T,X=fe*C,J=Oe(Math.atan2(ge,X),"radians","degrees");J>0?(f+=J,h=se(h,J),E++):J<0&&(_-=J,p=se(p,-J),m++)};n.sampledZ!=null&&Fe(n.distance,n.sampledZ);for(let G=1;G<i;++G){const fe=e[G-1],ge=e[G],X=ge.sampledZ;if(X==null){j.isHole||Ue();continue}b++,v+=X,a=He(a,X),l=se(l,X),j.isHole||ge.distance-j.start>=D?Fe(ge.distance,X):j.insert(X);const J=fe.sampledZ;if(J!=null){const ke=X-J;ke>0?c+=ke:ke<0&&(u-=ke)}}return Ue(),b===0?null:{maxDistance:e[i-1].distance,minElevation:a,maxElevation:l,avgElevation:b===0?null:v/b,elevationGain:c,elevationLoss:u,maxPositiveSlope:h,maxNegativeSlope:p,avgPositiveSlope:E===0?null:f/E,avgNegativeSlope:m===0?null:_/m}}function Wi(e){const t=e.filter(qe),i=t.length;if(i===0)return null;const n=t[0];if(i===1)return n;let s=n.maxDistance,a=n.minElevation,l=n.maxElevation,c=n.maxPositiveSlope,u=n.maxNegativeSlope;for(let h=1;h<t.length;++h){const p=t[h];s=se(s,p.maxDistance),a=He(a,p.minElevation),l=se(l,p.maxElevation),c=se(c,p.maxPositiveSlope),u=se(u,p.maxNegativeSlope)}return{maxDistance:s,minElevation:a,maxElevation:l,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:c,maxNegativeSlope:u,avgPositiveSlope:null,avgNegativeSlope:null}}function Qi(e){let t=null,i=null,n=null;for(const s of e){if(s==null)continue;const{statistics:a,spatialReference:l}=s;if(a==null)continue;const c=pe(l);t=se(t,Ae(a.maxDistance,c));const u=ue(l);n=He(n,Ae(a.minElevation,u)),i=se(i,Ae(a.maxElevation,u))}return{minDistance:0,maxDistance:t??0,minElevation:n??0,maxElevation:i??0}}function He(e,t){return t==null?e:e!=null?Math.min(e,t):t}function se(e,t){return t==null?e:e!=null?Math.max(e,t):t}function Ae(e,t){return e!=null&&t!=null?e*t:null}let st=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,i){this._start=t,this._sampleCount=1,this._totalElevation=i}insert(t){++this._sampleCount,this._totalElevation+=t}};async function*Yi(e,t){const{view:i,geometry:n,elevationInfo:s,providers:a,options:l}=e,c=i.spatialReference;if(!c||n==null||!Ze(n))throw new ve(B.InvalidGeometry);const u=a.length;if(u===0)return null;const h=Math.round(l.maxTotalSamples/u);if(Pt(n)>h)throw new ve(B.TooComplex);const p=await Ti(n,s,i,c,l,h,t);let v=0;const f=new Array(u),_=new Array(u);for(let m=0;m<u;m++){const C=nn(p);f[m]=C,v+=C.samples.length;const T={...e,provider:a[m],result:C,densificationResult:p};_[m]=Xi(T,t)[Symbol.iterator]()}if(v>l.maxTotalSamples)throw new ve(B.TooComplex);const b=await Promise.all(_.map(m=>{const C=m.next();return C.done===!0?Promise.resolve(null):C.value}));oe(t);for(let m=0;m<u;m++)f[m]=b[m];yield f,await Vt(e.delayAfterPreview??N().delayAfterPreviewMillis,null,t.signal);const E=[];try{let m;do{m=!1;for(let C=0;C<u;C++){const T=_[C].next();T.done===!1&&(E.push({resultPromise:T.value,index:C}),m=!0)}}while(m)}finally{_.forEach(m=>{var C;return(C=m.return)==null?void 0:C.call(m)})}for(const{resultPromise:m,index:C}of E)f[C]=await m,oe(t),yield f;for(const m of f)m!=null&&(m.progress=1);yield f}function*Xi(e,t){const{densificationResult:i}=e,n={...e,abortOptions:t,densificationResult:i},s=Pi(0,n.result.samples.length),a=s.slice(0,n.provider.numSamplesForPreview);yield ot(n,a,!0);const l=At(s,n.provider.numSamplesPerChunk);for(const c of l)yield ot(n,c,!1)}async function ot({densificationResult:e,result:t,provider:i,queue:n,abortOptions:s,cache:a},l,c){const{densifiedPath:u,pathLength:h}=e,p=t.spatialReference,{samples:v}=t,f=[];for(let _=0;_<l.length;_++){const b=v[l[_]];f[_]=b.coordinate}try{return await n.push({geometry:new zt({spatialReference:p,points:f,hasZ:u.hasZ}),provider:i,indices:l,preview:c,result:t,queryOptions:{...N().defaultQueryOptions(),minDemResolution:Math.round(c?h/i.numSamplesForPreview:h/v.length),cache:a}},s),{...t}}catch(_){return Bt(_)?null:Oi}}function Ji(e){return new Ci({priority:Si.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async t=>{oe(t.queryOptions);try{await Ki(t)}catch(i){Nt(i)}}})}async function Ki({geometry:e,provider:t,indices:i,preview:n,result:s,queryOptions:a}){if(i.length===0)return;const l=(await rn(t,e,a)).geometry,{hasZ:c,points:u}=l,h=a.noDataValue,{samples:p}=s;for(let v=0;v<i.length;v++){const f=p[i[v]];if(f.isHole)continue;const _=c?u[v][2]:null;_===null||_===h?f.sampledZ=null:(s.hasZ=!0,f.sampledZ=_),f.sampled=!0}en(p),s.progress=n?0:s.progress+i.length/p.length,s.statistics=ji(s.samples,s.spatialReference)}function en(e){const t=e.length-1;let i=0;for(let n=1;n<=t;n++)(e[n].sampled||n===t)&&(tn(e,i,n),i=n)}function tn(e,t,i){if(i-t==1)return;const n=e[t],s=n.sampledZ,a=e[i],l=a.sampledZ;if(s==null||l==null){for(let h=t+1;h<i;h++)e[h].sampledZ=null;return}const c=n.distance,u=a.distance-c;for(let h=t+1;h<i;h++){const p=e[h],v=(p.distance-c)/u;p.sampledZ=pt(s,l,v)}}function nn({densifiedPath:e,distances:t}){const i=e.spatialReference,n=Gt(i),s=e.paths,a=s.length,l=[];let c=null,u=0;for(let h=0;h<a;h++){const p=s[h],v=p.length,f=t[h];for(let _=0;_<v;_++){const b=p[_],E=f[_];n&&(b[0]=qt(b[0],n.valid[0],n.valid[1])),c&&_===0&&sn(l,c,b,u,E),l.push(on(b,E)),c=b,u=E}}return{progress:0,samples:l,hasZ:!1,statistics:null,spatialReference:i}}function sn(e,t,i,n,s){e.push(rt(t,n)),e.push(rt(i,s))}function on(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function rt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function rn(e,t,i){try{return await e.queryElevation(t,i)}catch{throw new ve(B.ElevationQueryError)}}const at="line-change";let re=class extends _e{constructor(t){super(t),this._updateTask=null,this._paramsPerProfile=new Map,this._getUpdateParametersMemoized=H((i,n,s)=>({stationary:i,visibleProfiles:n,generationParameters:s})),this._getGenerationParametersMemoized=H((i,n,s,a,l,c,u)=>Pe(n)&&Ze(n)&&a!=null?{view:i,geometry:n,elevationInfo:s,options:c,queue:a,cache:l,slicePlane:u}:null),this._getElevationInfoMemoized=H((i,n)=>({mode:i,offset:n})),this._getOptionsMemoized=H((i,n,s)=>{const{densificationMaxSamples:a,maxTotalSamples:l}=N();return{geodesicDistanceThreshold:i,samplingDistance:n,densificationMaxSamples:Math.round(a/s),maxTotalSamples:l}}),this._updateThrottled=mt(i=>Be(this._update(i)),N().updateThrottleMillis)}initialize(){const t=this.viewModel;this.addHandles([I(()=>t.profiles.toArray(),i=>{this._abortUpdate(),this._paramsPerProfile.clear(),this.removeHandles(at),this.addHandles(i.map(n=>me([n.attach(this.viewModel),n.on("change",()=>{this._invalidateProfile(n)})])),at)},ne),this._updateThrottled,I(()=>this._updateParameters,this._updateThrottled,ne)])}destroy(){this._paramsPerProfile.clear()}get _updateParameters(){const{viewModel:t}=this,i=t.view;return this._getUpdateParametersMemoized(i==null||i.stationary,this.viewModel.visibleProfiles,this._generationParameters)}get _generationParameters(){const{view:t,input:i,queue:n,tileCache:s}=this.viewModel;return t!=null&&t.ready?this._getGenerationParametersMemoized(t,i==null?void 0:i.geometry,this._elevationInfo,n,s,this._options,t.type==="3d"?t.slicePlane:null):null}get _elevationInfo(){const t=this.viewModel.input,i=t?fi(t)?null:ft(t):null;return i!=null?this._getElevationInfoMemoized(i.mode,i.offset):null}get _options(){const t=this.viewModel,i=t.visibleProfiles.length;let n=t.minDemResolution??N().defaultDemResolution;return n=parseFloat(n.toFixed(2)),this._getOptionsMemoized(t.geodesicDistanceThreshold,n,i)}async _update({stationary:t,visibleProfiles:i,generationParameters:n}){this._abortUpdate(),t&&(n!=null?this._updateTask=Le(async s=>{this.viewModel.error=null;const a=i.filter(c=>!this._isProfileValid(c,n)),l=Yi({...n,providers:a},{signal:s});try{for await(const c of l){oe(s),this._clearInvalidResults(n);for(let u=0;u<a.length;u++)a[u].result=c[u]}for(const c of a)this._paramsPerProfile.set(c,n)}catch(c){Zt(c),this._abortUpdate(),this.viewModel.error=c,a.forEach(u=>{u.result=null})}}):this._clearResults())}_abortUpdate(){this._updateTask=he(this._updateTask)}_isProfileValid(t,i){return this._paramsPerProfile.has(t)&&this._paramsPerProfile.get(t)===i}_invalidateProfile(t){this._paramsPerProfile.delete(t),this._updateThrottled(this._updateParameters)}_clearInvalidResults(t){for(const i of this.viewModel.profiles.items)this._isProfileValid(i,t)||(i.result=null,this._paramsPerProfile.delete(i))}_clearResults(){for(const t of this.viewModel.profiles.items)t.result=null,this._paramsPerProfile.delete(t)}};o([r({nonNullable:!0})],re.prototype,"viewModel",void 0),o([r()],re.prototype,"_updateParameters",null),o([r()],re.prototype,"_generationParameters",null),o([r()],re.prototype,"_elevationInfo",null),o([r()],re.prototype,"_options",null),re=o([R("esri.widgets.ElevationProfile.ElevationProfileController")],re);function an(e,t){if(e==null||t==null)return null;const{samples:i,spatialReference:n}=e,{distance:s,elevation:a}=t,l=pe(n),c=ue(n),u=i.length,h=new Array(u);for(let p=0;p<u;++p){const v=i[p],f=v.sampledZ,_=v.coordinate;h[p]={x:_[0],y:_[1],z:f,distance:Et(v.distance,l,s),elevation:de(f,c,a)}}return h}function ln(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;const{distance:i,elevation:n}=t,{statistics:s,spatialReference:a}=e,l=pe(a),c=ue(a);return{maxDistance:Et(s.maxDistance,l,i),minElevation:de(s.minElevation,c,n),maxElevation:de(s.maxElevation,c,n),avgElevation:de(s.avgElevation,c,n),elevationGain:de(s.elevationGain,c,n),elevationLoss:de(s.elevationLoss,c,n),maxPositiveSlope:s.maxPositiveSlope,maxNegativeSlope:s.maxNegativeSlope,avgPositiveSlope:s.avgPositiveSlope,avgNegativeSlope:s.avgNegativeSlope}}function Et(e,t,i){return e==null?null:Oe(e*t,"meters",i)}function de(e,t,i){return e==null?null:Oe(e*t,"meters",i)}let P=class extends Ht.EventedAccessor{constructor(t){super(t),this.type=null,this.id=Ei(),this.title=null,this.color=new Q("#000000"),this.visible=!0,this._getSamplesMemoized=H((i,n)=>an(i,n)),this._getStatisticsMemoized=H((i,n)=>ln(i,n)),this.viewVisualizationEnabled=!0,this.result=null,this.effectiveUnits=null,this.numSamplesForPreview=30,this.numSamplesPerChunk=200,this.chartFillEnabled=!0,this.chartStrokeWidth=1.5,this.chartStrokeOffsetY=0,this._viewModel=null}get progress(){return this.result!=null&&this.visible?this.result.progress:0}get samples(){return this._getSamplesMemoized(this.result,this.effectiveUnits)}get statistics(){return this._getStatisticsMemoized(this.result,this.effectiveUnits)}get hoveredPoint(){var i;const t=(i=this._viewModel)==null?void 0:i.hoveredChartPosition;return t!=null?this._getPoint(t):null}get available(){return!0}get hasZ(){const t=this.result;return t!=null&&t.hasZ}get minDemResolution(){return N().defaultDemResolution}queryElevation(){throw new Error("not implemented")}attach(t){return this._viewModel=t,me([I(()=>t.effectiveUnits,i=>{this.effectiveUnits=i},ne),I(()=>[t.input],()=>this._onChange(),dt)])}toggleVisibility(t){this.visible=t===void 0?!this.visible:t}_onChange(){this.emit("change")}_getPoint(t){const{samples:i,result:n}=this;if(i==null||n==null)return null;const s=i.length;if(s===0)return null;const a=i[s-1].distance,l=Ft(i,t*a,p=>p.distance);if(l==null)return null;const{x:c,y:u,z:h}=l;return h==null?null:new jt({x:c,y:u,z:h,spatialReference:n.spatialReference})}};o([r({nonNullable:!0})],P.prototype,"id",void 0),o([r({nonNullable:!0})],P.prototype,"title",void 0),o([r({type:Q,nonNullable:!0})],P.prototype,"color",void 0),o([r({nonNullable:!0})],P.prototype,"visible",void 0),o([r({readOnly:!0})],P.prototype,"progress",null),o([r({readOnly:!0})],P.prototype,"samples",null),o([r({readOnly:!0})],P.prototype,"statistics",null),o([r()],P.prototype,"hoveredPoint",null),o([r()],P.prototype,"viewVisualizationEnabled",void 0),o([r()],P.prototype,"available",null),o([r()],P.prototype,"result",void 0),o([r()],P.prototype,"effectiveUnits",void 0),o([r()],P.prototype,"numSamplesForPreview",void 0),o([r()],P.prototype,"numSamplesPerChunk",void 0),o([r()],P.prototype,"chartFillEnabled",void 0),o([r()],P.prototype,"chartStrokeWidth",void 0),o([r()],P.prototype,"chartStrokeOffsetY",void 0),o([r({readOnly:!0})],P.prototype,"hasZ",null),o([r({readOnly:!0})],P.prototype,"minDemResolution",null),o([r()],P.prototype,"_viewModel",void 0),P=o([R("esri.widgets.ElevationProfile.ElevationProfileLine")],P);const Ee=P;function kt(e){if(e==null)return null;if(e instanceof ki)return $t(e);const t=e.tileInfo;if(t==null)return null;const i=Wt(t.lods);return i==null?null:i.resolution*pe(t.spatialReference)}function $t(e){if(e==null)return null;const t=e.layers.items.map(cn).filter(qe);return vt(t)??null}function cn(e){return e&&"tileInfo"in e?kt(e):null}let W=class extends Ee{constructor(t){super(t),this.type="ground",this.color=new Q("#ff7f00"),this.viewVisualizationEnabled=!0,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getQueryElevationDependencies=H((i,n)=>({ground:i,groundLayers:n}))}get available(){const t=this._ground;return t!=null&&t.layers.some(i=>i.visible)}get minDemResolution(){return $t(this._ground)}get _queryElevationDependencies(){return this._getQueryElevationDependencies(this._ground,this._groundLayers)}get _ground(){var t,i,n;return(n=(i=(t=this._viewModel)==null?void 0:t.view)==null?void 0:i.map)==null?void 0:n.ground}get _groundLayers(){var t,i;return((i=(t=this._ground)==null?void 0:t.layers)==null?void 0:i.toArray())??[]}async queryElevation(t,i){const n=this._queryElevationDependencies;if(n==null)throw new Error("ElevationProfileLineGround: no dependencies");const{ground:s}=n;if(s==null)throw new Error("No ground configured in the view");const a=await s.queryElevation(t,i),l=ue(t.spatialReference),c=ue(s.layers.at(0).spatialReference);if(l!==c){const u=a.geometry;u.points=u.points.map(([h,p,v])=>[h,p,v===i.noDataValue?v:v*c/l])}return a}attach(t){return me([super.attach(t),I(()=>this._queryElevationDependencies,()=>this._onChange())])}};o([r({type:Q,nonNullable:!0})],W.prototype,"color",void 0),o([r()],W.prototype,"viewVisualizationEnabled",void 0),o([r()],W.prototype,"available",null),o([r({readOnly:!0})],W.prototype,"minDemResolution",null),o([r()],W.prototype,"_queryElevationDependencies",null),o([r()],W.prototype,"_ground",null),o([r()],W.prototype,"_groundLayers",null),W=o([R("esri.widgets.ElevationProfile.ElevationProfileLineGround")],W);const xt=W;let te=class extends Ee{constructor(t){super(t),this.type="input",this.color=new Q("#00c8c8"),this.viewVisualizationEnabled=!1,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this.chartFillEnabled=!1,this.chartStrokeOffsetY=-1,this._getQueryElevationDependencies=H((i,n,s,a,l)=>i?{elevationInfo:i,visibleLayers:n,view:s,stationary:a,spatialReference:l}:null)}get queryElevationDependencies(){var i;const t=(i=this._viewModel)==null?void 0:i.view;return t==null?null:this._getQueryElevationDependencies(this._elevationInfo,this._visibleLayers,t,t.stationary,t.spatialReference)}get available(){var t;return!((t=this._viewModel)!=null&&t.inputIsSketched)}get _elevationInfo(){var i;const t=(i=this._viewModel)==null?void 0:i.input;return t?ft(t):null}get _visibleLayers(){var t,i,n,s;return((s=(n=(i=(t=this._viewModel)==null?void 0:t.view)==null?void 0:i.map)==null?void 0:n.allLayers)==null?void 0:s.filter(a=>a.visible).toArray())??[]}async queryElevation(t,{noDataValue:i,signal:n}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const{view:a,elevationInfo:l,spatialReference:c}=s;if(l.mode==="on-the-ground"&&a.type==="3d"&&c){const u=await yt.fromGeometry(t).project(c,n);if(!u)return{geometry:t,noDataValue:i};const h=a.elevationProvider;return u.coordinates.forEach(p=>{p.z=h.getElevation(p.x,p.y,0,c,"ground")??0}),{geometry:u.export(),noDataValue:i}}return{geometry:t,noDataValue:i}}attach(t){const i=()=>this._onChange();return me([super.attach(t),I(()=>this.queryElevationDependencies,i),De(()=>t.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};o([r({type:Q,nonNullable:!0})],te.prototype,"color",void 0),o([r()],te.prototype,"viewVisualizationEnabled",void 0),o([r()],te.prototype,"queryElevationDependencies",null),o([r()],te.prototype,"available",null),o([r()],te.prototype,"_elevationInfo",null),o([r()],te.prototype,"_visibleLayers",null),te=o([R("esri.widgets.ElevationProfile.ElevationProfileLineInput")],te);const un=te;let ae=class extends Ee{constructor(t){super(t),this.type="query",this.color=new Q("#db334a"),this.viewVisualizationEnabled=!0,this.source=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return kt(this.source)}get available(){const t=this.source;return!!t&&(t.visible==null||t.visible)&&(t.layers==null||t.layers.some(i=>i.visible))}queryElevation(t,i){if(!this.source)throw new Error("No source configured for the elevation profile line");return this.source.queryElevation(t,i)}attach(t){return me([super.attach(t),I(()=>this.source,()=>this._onChange(),dt)])}};o([r({type:Q,nonNullable:!0})],ae.prototype,"color",void 0),o([r()],ae.prototype,"viewVisualizationEnabled",void 0),o([r()],ae.prototype,"source",void 0),o([r({readOnly:!0})],ae.prototype,"minDemResolution",null),o([r()],ae.prototype,"available",null),ae=o([R("esri.widgets.ElevationProfile.ElevationProfileLineQuery")],ae);const hn=ae,pn=2e5;let M=class extends Ee{constructor(t){super(t),this.type="view",this.color=new Q("#cf4ccf"),this.viewVisualizationEnabled=!0,this.include=null,this.exclude=null,this.numSamplesForPreview=50,this.numSamplesPerChunk=25,this._getQueryElevationDependencies=H((i,n,s,a,l,c,u)=>({inputGraphicUid:i!=null?It(i):null,visibleLayers:n,maxIntersectionDistance:s,intersectOptions:a,view:l,stationary:c,spatialReference:u})),this._vecA=We(),this._vecB=We(),this._ray=Qt()}get minDemResolution(){var n,s,a;const t=(n=this._viewModel)==null?void 0:n.view;if(t==null||t.type!=="3d")return null;const i=(a=(s=t.pointsOfInterest)==null?void 0:s.focus)==null?void 0:a.renderLocation;return i?t.state.camera.computeRenderPixelSizeAt(i)*ue(t.spatialReference):null}get queryElevationDependencies(){var i;const t=this._view;return t?this._getQueryElevationDependencies((i=this._viewModel)==null?void 0:i.input,this._visibleLayers,this._maxIntersectionDistance,this._intersectOptions,t,t.stationary,t.spatialReference):null}get _visibleLayers(){var t,i,n;return((n=(i=(t=this._view)==null?void 0:t.map)==null?void 0:i.allLayers)==null?void 0:n.filter(s=>s.visible).toArray())??[]}get _intersectOptions(){const t=this._view;if(t==null||t.destroyed)return{};const i=t.externalToInternalIntersectOptions({include:this.include,exclude:this.exclude}),n=t.externalToInternalIntersectOptions({exclude:this._pointCloudLayers});return i.exclude=Yt(i.exclude,n.exclude),i}get _pointCloudLayers(){const t=this._view;return t==null?[]:t.allLayerViews.toArray().filter(i=>{var n;return((n=i.layer)==null?void 0:n.type)==="point-cloud"}).map(i=>i.layer)}get _view(){var i;const t=(i=this._viewModel)==null?void 0:i.view;return t!=null&&t.type==="3d"?t:null}get _maxIntersectionDistance(){const t=this._view;return t!=null&&t.renderCoordsHelper?Xt(t.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY}get _intersector(){const t=this._view;if(t==null)return null;const i=$i(t.state.viewingMode),n=i.options;return n.hud=!1,n.invisibleTerrain=!1,n.backfacesTerrain=!1,n.selectionMode=!1,n.store=xi.ALL,i}async queryElevation(t,{noDataValue:i,signal:n}){const s=this.queryElevationDependencies;if(s==null)throw new Error("ElevationProfileLineInput: no dependencies");const a=this._intersector;if(a==null)throw new Error("ElevationProfileLineInput: no view");const{intersectOptions:l,view:c,spatialReference:u}=s,h=c.renderCoordsHelper,p=c.sceneIntersectionHelper,v=this._vecA,f=this._vecA,_=this._vecB,b=this._ray;if(!u)return{geometry:t,noDataValue:i};const E=await yt.fromGeometry(t).project(u,n);if(!E)return{geometry:t,noDataValue:i};const m=E.coordinates,C=m.length;for(let T=0;T<C;++T){const D=m[T];Jt(_,D.x,D.y,D.z??0),h.toRenderCoords(_,u,_),h.setAltitude(v,pn,_);const F=Kt(v,_,b);p.computeIntersection(F,a,l);const Y=dn(s,a.results.all);Y?(Y.getIntersectionPoint(f),h.fromRenderCoords(f,f,u),D.z=f[2]):D.z=i}return{geometry:E.export(),noDataValue:i}}attach(t){const i=()=>this._onChange();return me([super.attach(t),I(()=>this.queryElevationDependencies,i),De(()=>t.elevationProvider,"elevation-change",i,{onListenerAdd:i,onListenerRemove:i})])}};function dn({view:e,inputGraphicUid:t,maxIntersectionDistance:i},n){for(const s of n){if(s.distanceInRenderSpace!=null&&s.distanceInRenderSpace>i)continue;const a=vi(s,e);if(a==null||It(a)!==t)return s}return null}function It(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}o([r({type:Q,nonNullable:!0})],M.prototype,"color",void 0),o([r()],M.prototype,"viewVisualizationEnabled",void 0),o([r()],M.prototype,"include",void 0),o([r()],M.prototype,"exclude",void 0),o([r({readOnly:!0})],M.prototype,"minDemResolution",null),o([r()],M.prototype,"queryElevationDependencies",null),o([r()],M.prototype,"_visibleLayers",null),o([r()],M.prototype,"_intersectOptions",null),o([r()],M.prototype,"_pointCloudLayers",null),o([r()],M.prototype,"_view",null),o([r()],M.prototype,"_maxIntersectionDistance",null),o([r()],M.prototype,"_intersector",null),M=o([R("esri.widgets.ElevationProfile.ElevationProfileLineView")],M);const vn=M,_n={base:Ee,key:"type",typeMap:{ground:xt,input:un,query:hn,view:vn},errorContext:"elevation-profile-line"},mn=Ne.ofType(_n);var y,V;function fn(e){return e==="2d"?new ii({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,4],lineDashEnding:"FullGap",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[0,0,0,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",width:1.5,color:[255,255,255,255]}]}}}):new ni({color:[0,0,0,0]})}(function(e){e.Ready="ready",e.Creating="creating",e.Reshaping="reshaping",e.ReshapingDisabled="rehsaping-disabled",e.Selecting="selecting",e.Selected="selected"})(y||(y={})),function(e){e.View="view",e.Main="main",e.Interaction="interaction"}(V||(V={}));let U=class extends _e{constructor(e){super(e),this.state=y.Ready,this._pendingStartOptions=null,this._previousInputInfo=null,this._shouldRemoveLastPoint=!1,this._sketchedGraphics=new WeakSet,this._creationToolPromise=null,this._updateToolPromise=null,this._updateDisabled=!1}initialize(){this.addHandles(I(()=>({view:this.tool.viewModel.view,visible:this.tool.visible}),({view:e,visible:t})=>{e!=null&&t?this._attach(e):this._detach()},ne),V.View)}destroy(){this._detach()}get canStopCreating(){const e=this._geometry,t=this._shouldRemoveLastPoint?3:2;return Pe(e)&&e.paths.length>0&&e.paths[0].length>=t}get _input(){return this.tool.viewModel.input}set _input(e){this.tool.viewModel.input=e}get _geometry(){var e;return(e=this._input)==null?void 0:e.geometry}get _visibleAndEditable(){return this.tool.visible&&this.tool.editable}get _view(){return this.tool.viewModel.view}get test(){return{sketchVM:this._sketchVM,toolPromise:Promise.all([this._creationToolPromise??Promise.resolve(),this._updateToolPromise??Promise.resolve()])}}start(e={mode:"sketch"}){if(!this.tool.editable)return;const t=this._view;if(t!=null&&t.ready)switch(this._pendingStartOptions=null,this._stopInteraction(),this._previousInputInfo==null&&this._storePreviousInput(this._input),this._setSketchedGraphic(null),e.mode){case"sketch":this._set("state",y.Creating),this._startCreationInteraction();break;case"select":this._set("state",y.Selecting),this._startSelectionInteraction()}else this._pendingStartOptions=e}stop(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._clearPreviousInput()}cancel(){this._pendingStartOptions=null,this._stopInteractionAndUpdate(),this._restorePreviousInput()}clear(){this._stopInteractionAndUpdate(),this._set("state",y.Ready),this._clearPreviousInput(),this._input=null,this._pendingStartOptions=null}isSketchedGraphic(e){return e!=null&&this._sketchedGraphics.has(e)}_attach(e){this._detach();const t={mode:e.type==="3d"?"relative-to-ground":"on-the-ground",offset:null};this._graphicsLayer=new ei({listMode:"hide",internal:!0,elevationInfo:t});const i=fn(e.type);this._sketchVM=new Ii({layer:this._graphicsLayer,view:e,defaultCreateOptions:{mode:"click",hasZ:!1},updateOnGraphicClick:!1,defaultUpdateOptions:{reshapeOptions:{shapeOperation:"none"},enableRotation:!1,enableScaling:!1,enableMoveAllGraphics:!1,enableZ:!1,multipleSelectionEnabled:!1,toggleToolOnClick:!1,tool:"reshape"},polylineSymbol:i,activeLineSymbol:i}),this.addHandles([ti(()=>e.ready,()=>{const n=this._pendingStartOptions;n&&this.start(n)},ne),I(()=>[this._input,this._visibleAndEditable],()=>this._update(),ne),I(()=>({map:e.map,graphicsLayer:this._graphicsLayer}),({map:n,graphicsLayer:s})=>{n!=null&&s!=null&&n.add(s),this._update()},ne)],V.Main)}_detach(){var i;this.removeHandles(V.Main),this._sketchVM=z(this._sketchVM),this._creationToolPromise=null,this._updateToolPromise=null;const e=(i=this._view)==null?void 0:i.map,t=this._graphicsLayer;e!=null&&t!=null&&e.remove(t),this._graphicsLayer=z(this._graphicsLayer),this._shouldRemoveLastPoint=!1,this._set("state",y.Ready)}_startCreationInteraction(){this._stopInteractionAndUpdate();const e=this._view,t=this._sketchVM;if(e==null||t==null)return;this._shouldRemoveLastPoint=!1;const i=t.on("create",s=>{var l;const a=s.graphic;switch(s.state){case"complete":this._shouldRemoveLastPoint=!1,this._setSketchedGraphic(a),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"cancel":this.cancel();break;case"active":this._setSketchedGraphic(a),((l=s.toolEventInfo)==null?void 0:l.type)==="cursor-update"&&(this._shouldRemoveLastPoint=!0);break;case"start":this._setSketchedGraphic(a)}}),n=()=>{var l;i.remove();const s=this.canStopCreating,a=(l=this._geometry)==null?void 0:l.clone();t.cancel(),this._creationToolPromise=null,a!=null&&s?this._shouldRemoveLastPoint&&this._setSketchedGraphic(new _t({geometry:gn(a)})):this._input=null};this.removeHandles(V.Interaction),this.addHandles($e(n),V.Interaction),this._creationToolPromise=Be(t.create("polyline"))}_startReshapeInteraction(){this._stopInteraction();const e=this._view,t=this._sketchVM;if(e==null||t==null)return;const i=t.on("update",a=>{const l=a.graphics[0];switch(a.state){case"complete":this._setSketchedGraphic(l),this._stopInteractionAndUpdate(),this._clearPreviousInput();break;case"active":case"start":this._setSketchedGraphic(l)}}),n=()=>{i.remove(),t.cancel(),this._updateToolPromise=null};this.removeHandles(V.Interaction),this.addHandles($e(n),V.Interaction);const s=this._input;s&&(s.visible=!0,this._updateToolPromise=Be(t.update(s,{tool:"reshape"})))}_startSelectionInteraction(){this._stopInteraction();const e=this._view;if(e==null)return;const t=e.cursor,i=$e(()=>e.cursor=t);e.cursor="crosshair",e.closePopup();let n=null;const s=$e(()=>he(n)),a=e.on("immediate-click",c=>{c.preventDefault(),c.stopPropagation(),he(n),n=Le(async u=>{const{results:h}=await e.hitTest(c);oe(u);const p=h.filter(v=>v.type==="graphic"&&v.graphic!=null).map(v=>v.graphic).find(v=>v.geometry!=null&&v.geometry.type==="polyline");p&&(this._input=p,this._clearPreviousInput(),this._stopInteractionAndUpdate())})}),l=e.on("key-down",c=>{c.key==="Escape"&&this.cancel()});this.removeHandles(V.Interaction),this.addHandles([a,l,s,i],V.Interaction),e.ready&&e.focus()}_stopInteraction(){this.removeHandles(V.Interaction)}_stopInteractionAndUpdate(){this.hasHandles(V.Interaction)&&(this._updateDisabled=!0,this._stopInteraction(),this._updateDisabled=!1,this._triggerUpdate())}_triggerUpdate(){this._set("state",y.Ready),this._update()}_update(){if(this._updateDisabled)return;const e=this.state;if(e!==y.Selecting){if(this._visibleAndEditable){if(e===y.Creating||e===y.Reshaping&&this.isSketchedGraphic(this._input))return}else this.cancel();this._set("state",this._getNextState()),this._updateVisuals()}else this.stop()}_getNextState(){return this._input==null?y.Ready:this.isSketchedGraphic(this._input)?this.state===y.Creating?y.Creating:this._visibleAndEditable?y.Reshaping:y.ReshapingDisabled:y.Selected}_updateVisuals(){switch(this.state){case y.Creating:break;case y.Reshaping:this._startReshapeInteraction();break;case y.ReshapingDisabled:{this._stopInteractionAndUpdate();const e=this._input;e!=null&&this.isSketchedGraphic(e)&&(e.visible=!1);break}case y.Ready:case y.Selected:this._stopInteractionAndUpdate();case y.Selecting:}this._updateSketchedGraphic()}_storePreviousInput(e){this._previousInputInfo={graphic:e}}_restorePreviousInput(){const e=this._previousInputInfo;e!=null&&(this._clearPreviousInput(),this._input=e.graphic,this._triggerUpdate())}_clearPreviousInput(){this._previousInputInfo=null}_updateSketchedGraphic(){const e=this._graphicsLayer;if(e==null)return;const t=e.graphics,i=this._input;if(i==null||!this.isSketchedGraphic(i))return void t.removeAll();if(t.indexOf(i)===-1)t.removeAll(),t.add(i);else if(t.length!==1){const n=t.filter(s=>s!==i);t.removeMany(n)}}_setSketchedGraphic(e){e!=null&&this._sketchedGraphics.add(e),this._input=e,this._updateSketchedGraphic()}};function gn(e){if(Pe(e)){const t=e.clone();return t.paths=[t.paths[0].slice(0,-1)],t}return e}o([r({nonNullable:!0})],U.prototype,"state",void 0),o([r({nonNullable:!0})],U.prototype,"tool",void 0),o([r()],U.prototype,"canStopCreating",null),o([r()],U.prototype,"_graphicsLayer",void 0),o([r()],U.prototype,"_sketchVM",void 0),o([r()],U.prototype,"_input",null),o([r()],U.prototype,"_geometry",null),o([r()],U.prototype,"_visibleAndEditable",null),o([r()],U.prototype,"_view",null),o([r()],U.prototype,"_shouldRemoveLastPoint",void 0),U=o([R("esri.widgets.ElevationProfile.ElevationProfileInteraction")],U);let Me=class extends _e{constructor(t){super(t),this._implementation=null,this._loadingTask=null}initialize(){this.addHandles(I(()=>{var t;return{tool:this.tool,view:this.tool.viewModel.view,visible:this.tool.visible&&!!((t=this.tool.viewModel.view)!=null&&t.ready)}},({tool:t,view:i,visible:n})=>{i!=null&&n?this._show(i,t):this._hide()},ne))}destroy(){this._hide()}_show(t,i){this._loadingTask=he(this._loadingTask),this._loadingTask=Le(async n=>{if(t.type==="2d"){const s=x(()=>import("./ElevationProfileView2D-ef15446a.js"),["assets/ElevationProfileView2D-ef15446a.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/HoveredPoints-5a66c77c.js","assets/AnchorElementViewModel-8d35dd28.js","assets/layerViewUtils-6ebe90f4.js","assets/memoize-3e55df82.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/Intersector-fa865806.js","assets/ViewingMode-5d7d590b.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/Intersector-2e1d9db3.js","assets/Intersector-a291e778.js","assets/defaultUnit-414db021.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/throttle-7bf02de9.js","assets/elevationInfoUtils-be36d866.js","assets/Material-5f4156ac.js","assets/interfaces-8918b36f.js","assets/geodesicUtils-822c19ca.js","assets/QueueProcessor-4b9d43d3.js","assets/signal-51ed66f5.js","assets/Scheduler-ff5943a4.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/traversalUtils-bbdec2e9.js","assets/Ground-ed93a93a.js","assets/loadAll-5e767cfa.js","assets/ElevationQuery-4be4efe0.js","assets/ElevationSamplerData-9f34f589.js","assets/SketchViewModel-fedf7932.js","assets/layerUtils-437666a3.js","assets/screenUtils-8dc4a7f9.js","assets/snappingUtils-93e84fbe.js","assets/dehydratedPoint-5a1dfed5.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/SketchTooltipOptions-cc43c059.js","assets/SnappingManager-aa70fdd4.js","assets/UpdatingHandles-7949a657.js","assets/geometry2dUtils-a99dcf3d.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/viewUtils-9f810d02.js","assets/hitTestSelectUtils-d512707e.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/UnitSelect-52961079.js","assets/globalCss-94006b67.js"]),a=(await Qe(s,n)).ElevationProfileView2D;this._implementation=new a(t,i)}else if(t.type==="3d"){const s=x(()=>import("./ElevationProfileView3D-428bb6f3.js"),["assets/ElevationProfileView3D-428bb6f3.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/HoveredPoints-5a66c77c.js","assets/AnchorElementViewModel-8d35dd28.js","assets/elevationInfoUtils-be36d866.js","assets/OutlineVisualElement-75d7e05b.js","assets/ExtendedLineVisualElement-451ab04d.js","assets/vec4f32-0d1b2306.js","assets/frustum-f9d53cdf.js","assets/EngineVisualElement-43f3e8cb.js","assets/RenderGeometry-5dbc1699.js","assets/vec3f32-bac7ea57.js","assets/DefaultTechniqueConfiguration-b4dbe32f.js","assets/requestImageUtils-b142708c.js","assets/enums-bdecffa2.js","assets/Texture-bcb6d63f.js","assets/contextUtils-81fda295.js","assets/interfaces-8918b36f.js","assets/Material-5f4156ac.js","assets/ViewingMode-5d7d590b.js","assets/FramebufferObject-123b7c8d.js","assets/ShaderTechniqueConfiguration-2502462e.js","assets/ElevationProvider-abb53936.js","assets/dehydratedPoint-5a1dfed5.js","assets/hydratedFeatures-2365c307.js","assets/weather-2eb64924.js","assets/RenderState-1d6218ee.js","assets/NestedMap-1b5db22e.js","assets/VertexElementDescriptor-2925c6af.js","assets/VertexArrayObject-d19dab8d.js","assets/Octree-7cea9440.js","assets/InterleavedLayout-d76b0d59.js","assets/types-1305598a.js","assets/OrderIndependentTransparency-755f7dcc.js","assets/floatRGBA-ca990bbb.js","assets/Intersector-2e1d9db3.js","assets/Intersector-fa865806.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/glUtil-ce5ee52b.js","assets/Scheduler-ff5943a4.js","assets/signal-51ed66f5.js","assets/debugFlags-9a30f077.js","assets/VisualElement-187372ae.js","assets/LaserlineVisualElement-c0026af2.js","assets/lineStippleUtils-0688e06c.js","assets/GraphicState-0d3046df.js","assets/layerViewUtils-6ebe90f4.js","assets/throttle-7bf02de9.js","assets/memoize-3e55df82.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/Intersector-a291e778.js","assets/defaultUnit-414db021.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/geodesicUtils-822c19ca.js","assets/QueueProcessor-4b9d43d3.js","assets/traversalUtils-bbdec2e9.js","assets/Ground-ed93a93a.js","assets/loadAll-5e767cfa.js","assets/ElevationQuery-4be4efe0.js","assets/ElevationSamplerData-9f34f589.js","assets/SketchViewModel-fedf7932.js","assets/layerUtils-437666a3.js","assets/screenUtils-8dc4a7f9.js","assets/snappingUtils-93e84fbe.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/SketchTooltipOptions-cc43c059.js","assets/SnappingManager-aa70fdd4.js","assets/UpdatingHandles-7949a657.js","assets/geometry2dUtils-a99dcf3d.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/viewUtils-9f810d02.js","assets/hitTestSelectUtils-d512707e.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/UnitSelect-52961079.js","assets/globalCss-94006b67.js"]),a=(await Qe(s,n)).ElevationProfileView3D;this._implementation=new a(t,i)}})}_hide(){this._loadingTask=he(this._loadingTask),this._implementation=z(this._implementation)}};o([r()],Me.prototype,"tool",void 0),Me=o([R("esri.widgets.ElevationProfile.support.ElevationProfileView")],Me);let ie=class extends _e{constructor(t){super(t),this.editable=!0,this.visible=!0,this.highlightEnabled=!0}initialize(){this.view=new Me({tool:this}),this.interaction=new U({tool:this})}destroy(){this.interaction.destroy(),this.view.destroy()}get state(){var i;switch((i=this.interaction)==null?void 0:i.state){case y.Ready:return L.Ready;case y.Creating:return L.Creating;case y.Selecting:return L.Selecting;case y.Selected:return L.Selected;case y.Reshaping:case y.ReshapingDisabled:return L.Created}}};o([r({nonNullable:!0})],ie.prototype,"viewModel",void 0),o([r()],ie.prototype,"view",void 0),o([r()],ie.prototype,"interaction",void 0),o([r()],ie.prototype,"editable",void 0),o([r()],ie.prototype,"visible",void 0),o([r()],ie.prototype,"highlightEnabled",void 0),ie=o([R("esri.widgets.ElevationProfile.ElevationProfileTool")],ie);let g=class extends _e{constructor(e){super(e),this.view=null,this.input=null,this._getEffectiveUnitsMemoized=H((t,i)=>({distance:t,elevation:i})),this.geodesicDistanceThreshold=1e5,this.hoveredChartPosition=null,this.uniformChartScaling=!1,this.defaultUnit=null,this.queue=null,this._currentTileCache=null,this.error=null,this._defaultProfileLineGround=new xt,this._userUnitOptions=null,this._userUnit=null,e!=null&&e.profiles||(this.profiles=new Ne([this._defaultProfileLineGround]))}initialize(){this.addHandles(I(()=>this.view,e=>{var n;if(e==null)return void si.getLogger(this).warnOnce("no view. Widget will be disabled until a view is provided.");this.removeHandles(lt);const t=e.type==="3d"?e.resourceController:void 0;(n=this.queue)==null||n.destroy(),this.queue=Ji(t==null?void 0:t.scheduler);const i=t==null?void 0:t.addUpdatingObject(this);i&&this.addHandles(i,lt)},ne)),this.tool=new ie({viewModel:this}),this._controller=new re({viewModel:this})}destroy(){this._defaultProfileLineGround=z(this._defaultProfileLineGround),this._controller=z(this._controller),this._currentTileCache=z(this._currentTileCache),this.tool=z(this.tool),this.queue=z(this.queue)}get profiles(){return this._get("profiles")}set profiles(e){const t=this._get("profiles"),i=e??new Ne;this._set("profiles",oi(i,t))}get state(){const e=this.view;return e!=null&&e.ready?this.tool.state:L.Disabled}get progress(){let e=0,t=0;for(const i of this.visibleProfiles)e++,t+=i.progress;return e>0?t/e:0}set unitOptions(e){this._userUnitOptions=e,this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))}get unitOptions(){return this._filteredOrAllUnits(this._userUnitOptions)}set unit(e){this._userUnit=e?this._findSelectableUnit(e,this._userUnit):null,this.notifyChange("unit")}get unit(){return this._userUnit?(this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit),this._userUnit):this._findSelectableUnit(this.defaultUnit)}get effectiveUnits(){const e=Qi(this.visibleProfiles.map(n=>n.result)),t=ri(e.maxDistance,"meters",this.unit),i=ai(e.maxElevation,"meters",this.unit);return this._getEffectiveUnitsMemoized(t,i)}get highlightEnabled(){return this.tool.highlightEnabled}set highlightEnabled(e){this.tool.highlightEnabled=e}get hasVertices(){var t;const e=(t=this.input)==null?void 0:t.geometry;return Pe(e)&&e.paths.reduce((i,n)=>i+n.length,0)>0}get hoveredPoints(){return this.input!=null&&this.visible&&this.tool.editable?this.visibleProfiles.map(e=>{const t=e.hoveredPoint;return t!=null?{hoveredPoint:t,color:e.color}:null}).filter(qe):[]}get statistics(){return Wi(this.visibleProfiles.map(e=>e.statistics))}get chartData(){if(this.input==null)return null;const{effectiveUnits:e,progress:t,statistics:i,visibleProfiles:n,uniformChartScaling:s}=this,a=n.filter(l=>l.hasZ).map(l=>({id:l.id,type:l.type,title:l.title,color:l.color,samples:l.samples,progress:l.progress,chartFillEnabled:l.chartFillEnabled,chartStrokeWidth:l.chartStrokeWidth,chartStrokeOffsetY:l.chartStrokeOffsetY,viewVisualizationEnabled:l.viewVisualizationEnabled}));return a.length===0?null:{lines:a,effectiveUnits:e,statistics:i,refined:t===1,dynamicElevationRange:n.some(l=>l.type==="view"),uniformScaling:s}}get visibleProfiles(){return this.profiles.toArray().filter(e=>e.available&&e.visible)}get minDemResolutions(){const e=[];for(const{minDemResolution:t}of this.visibleProfiles)t!=null&&e.push(t);return e}get minDemResolution(){return vt(this.minDemResolutions)}get errorState(){var t;const e=(t=this.input)==null?void 0:t.geometry;if(!Ze(e))return k.NoValidInput;if(this.error!=null){if(Li(this.error))switch(this.error.cause){case B.TooComplex:return k.TooComplex;case B.InvalidGeometry:return k.InvalidGeometry;case B.InvalidElevationInfo:return k.InvalidElevationInfo;case B.ElevationQueryError:return k.NoValidInput}return k.UnknownError}return this.visibleProfiles.length===0?k.NoVisibleProfiles:this.chartData==null&&this.progress===1?k.RefinedButNoChartData:k.None}get tileCache(){var t;this._currentTileCache=z(this._currentTileCache);const e=this.view;if(e!=null&&(e==null?void 0:e.type)==="3d"){const i=(t=e.basemapTerrain)==null?void 0:t.elevationQueryCache;if(i!=null)return i}return this._currentTileCache==null&&(this._currentTileCache=new _i(new li(20*ci.MEGABYTES))),this._currentTileCache}get visible(){return this.tool.visible}set visible(e){this.tool.visible=e}get inputIsSketched(){return this.tool.interaction.isSketchedGraphic(this.input)}get elevationProvider(){const e=this.view;return e!=null&&e.type==="3d"?e.elevationProvider:null}get updating(){var i;const{progress:e}=this,t=!!((i=this.queue)!=null&&i.updating);return e>0&&e<1||t}start(e){this.tool.interaction.start(e)}stop(){this.tool.interaction.stop()}cancel(){this.tool.interaction.cancel()}clear(){this.tool.interaction.clear()}_findSelectableUnit(e,t){const i=this.unitOptions;return e!=null&&i.includes(e)?e:t?this._findSelectableUnit(t):i[0]}_filteredOrAllUnits(e){const t=(e??[]).filter(i=>Ye.includes(i));return t.length===0?Ye.slice():t}};o([r()],g.prototype,"view",void 0),o([r({type:_t})],g.prototype,"input",void 0),o([r({type:mn,nonNullable:!0})],g.prototype,"profiles",null),o([r({readOnly:!0})],g.prototype,"state",null),o([r({readOnly:!0})],g.prototype,"progress",null),o([r()],g.prototype,"unitOptions",null),o([r()],g.prototype,"unit",null),o([r({readOnly:!0})],g.prototype,"effectiveUnits",null),o([r({type:Number})],g.prototype,"geodesicDistanceThreshold",void 0),o([r()],g.prototype,"hoveredChartPosition",void 0),o([r()],g.prototype,"uniformChartScaling",void 0),o([r()],g.prototype,"highlightEnabled",null),o([r({readOnly:!0})],g.prototype,"hoveredPoints",null),o([r({readOnly:!0})],g.prototype,"statistics",null),o([r()],g.prototype,"chartData",null),o([r()],g.prototype,"visibleProfiles",null),o([r()],g.prototype,"minDemResolutions",null),o([r({readOnly:!0})],g.prototype,"minDemResolution",null),o([r({readOnly:!0})],g.prototype,"errorState",null),o([r(mi)],g.prototype,"defaultUnit",void 0),o([r()],g.prototype,"queue",void 0),o([r()],g.prototype,"tileCache",null),o([r()],g.prototype,"tool",void 0),o([r()],g.prototype,"visible",null),o([r()],g.prototype,"error",void 0),o([r()],g.prototype,"inputIsSketched",null),o([r()],g.prototype,"elevationProvider",null),o([r()],g.prototype,"updating",null),o([r()],g.prototype,"_defaultProfileLineGround",void 0),o([r()],g.prototype,"_userUnitOptions",void 0),o([r()],g.prototype,"_controller",void 0),o([r()],g.prototype,"_userUnit",void 0),g=o([R("esri.widgets.ElevationProfile.ElevationProfileViewModel")],g);const lt=Symbol("updating-object"),Rt=g;let q=class extends _e{constructor(){super(...arguments),this.legend=!0,this.chart=!0,this.clearButton=!0,this.settingsButton=!0,this.sketchButton=!0,this.selectButton=!0,this.unitSelector=!0,this.uniformChartScalingToggle=!0}};o([r()],q.prototype,"legend",void 0),o([r()],q.prototype,"chart",void 0),o([r()],q.prototype,"clearButton",void 0),o([r()],q.prototype,"settingsButton",void 0),o([r()],q.prototype,"sketchButton",void 0),o([r()],q.prototype,"selectButton",void 0),o([r()],q.prototype,"unitSelector",void 0),o([r()],q.prototype,"uniformChartScalingToggle",void 0),q=o([R("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],q);const Mt=q,yn=100;let le=class extends Se{constructor(e,t){super(e,t),this._updateLayout=i=>{const n=i.parentElement,s=i.style.display;n==null||n.removeChild(i),document.body.appendChild(i),i.style.display="block";let a=80;for(const l of i.childNodes)l instanceof HTMLElement&&(a=Math.max(a,l.offsetWidth));document.body.removeChild(i),n==null||n.appendChild(i),i.style.display=s,i.style.setProperty("--max-width",`${a}px`)},this._updateLayoutThrottled=mt(this._updateLayout,yn)}loadDependencies(){return Te({icon:()=>x(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"])})}initialize(){this.addHandles(this._updateLayoutThrottled)}render(){return d("div",{afterCreate:this._updateLayout,afterUpdate:this._updateLayoutThrottled,bind:this,class:be.base},this._renderStatistics())}_renderStatistics(){var t;const e=(t=this._messages)==null?void 0:t.statistics;return e?[this._renderDistanceStatistic("maxDistance",e.maxDistance),this._renderElevationStatistic("elevationGain",e.gain),this._renderElevationStatistic("elevationLoss",e.loss),this._renderElevationStatistic("minElevation",e.minElevation),this._renderElevationStatistic("maxElevation",e.maxElevation),this._renderElevationStatistic("avgElevation",e.avgElevation),this._renderSlopeStatistic("maxPositiveSlope","maxNegativeSlope",e.maxSlope),this._renderSlopeStatistic("avgPositiveSlope","avgNegativeSlope",e.avgSlope)]:[]}_renderDistanceStatistic(e,t){const i=N().formatPrecision,n=this._renderValue(e,s=>{const a=this.effectiveUnits.distance;return Je(this._messagesUnits,s,a,i)});return this._renderStatistic(t,n)}_renderElevationStatistic(e,t){const i=N().formatPrecision,n=this._renderValue(e,s=>{const a=this.effectiveUnits.elevation;return Je(this._messagesUnits,s,a,i)});return this._renderStatistic(t,n)}_renderSlopeStatistic(e,t,i){const n=N().formatPrecision,s=d("div",{class:be.slopeValue,key:"slope-up"},d("calcite-icon",{icon:"arrow-up",scale:"s"}),this._renderValue(e,a=>Ke(a,"degrees","geographic","geographic",n)),d("calcite-icon",{icon:"arrow-down",scale:"s"}),this._renderValue(t,a=>Ke(a,"degrees","geographic","geographic",n)));return this._renderStatistic(i,s)}_renderStatistic(e,t){return d("div",{class:be.statistic},d("label",{class:be.statisticLabel},e),d("div",{class:be.statisticValue},t))}_renderValue(e,t){const i=this.line,n=i.progress===1?i.statistics:null,s=n==null?void 0:n[e];return s!=null?t(s):Di}};o([r()],le.prototype,"effectiveUnits",void 0),o([r()],le.prototype,"line",void 0),o([r(),Ce("esri/widgets/ElevationProfile/t9n/ElevationProfile")],le.prototype,"_messages",void 0),o([r(),Ce("esri/core/t9n/Units")],le.prototype,"_messagesUnits",void 0),le=o([R("esri.widgets.ElevationProfile.Statistics")],le);function ct(e,{profiles:t}){const i=e.title;if(i!=null)return i;switch(e.type){case"ground":return t.ground;case"input":return t.input;case"query":return t.query;case"view":return t.view;default:return""}}let Z=class extends Se{constructor(e,t){super(e,t),this.checkboxVisible=!0,this.expanded=!1}loadDependencies(){return Te({action:()=>x(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),checkbox:()=>x(()=>import("./calcite-checkbox-fef8d84f.js"),["assets/calcite-checkbox-fef8d84f.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),label:()=>x(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),tooltip:()=>x(()=>import("./calcite-tooltip-5cb74da1.js"),["assets/calcite-tooltip-5cb74da1.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"])})}initialize(){this._statistics=new le(this._statisticsProps),this.addHandles(I(()=>this._statisticsProps,e=>this._statistics.set(e)))}destroy(){this._statistics=z(this._statistics)}render(){const e=this.expanded;return d("div",{class:this.classes(ee.base,{[ee.disabled]:this.disabled,[ee.expanded]:e}),key:this},this._renderColorIndicator(),d("div",{class:ee.header,key:"header"},this._renderLabelWithCheckbox(),this._renderCollapseToggleButton()),e?d("div",{class:ee.content,key:"content"},this._statistics.render()):null)}get disabled(){return!this.line.available}get _statisticsProps(){return{line:this.line,effectiveUnits:this.effectiveUnits}}_renderColorIndicator(){return d("div",{class:ee.colorIndicator,key:"color-indicator",styles:{backgroundColor:this.line.color.toCss()}})}_renderCollapseToggleButton(){const{expanded:e,messages:t}=this,i=e?t.hideDetails:t.showDetails;return d("calcite-action",{appearance:"transparent",bind:this,class:ee.collapseToggle,"data-testid":"legend-toggle",icon:e?"chevron-up":"chevron-down",key:"collapse-toggle",onclick:this._onCollapseToggleClick,scale:"s",text:i})}_onCollapseToggleClick(){this.onExpandedToggle()}_renderLabelWithCheckbox(){const{line:e,checkboxVisible:t,disabled:i,messages:n}=this,s=`label-${e.id}`;return d("calcite-label",{class:ee.label,disabled:i,key:s,layout:"inline"},t?this._renderCheckbox(e.id):null,ct(e,n))}_renderCheckbox(e){const{disabled:t,line:i,messages:n}=this,s=i.visible,a=`${e}-checkbox`,l=s?n.hideProfile:n.showProfile,c=ui(l,{name:ct(i,n)});return d(Re,null,d("calcite-checkbox",{checked:s,class:ee.checkbox,disabled:t,id:a,key:"checkbox",onCalciteCheckboxChange:()=>i.toggleVisibility()}),d("calcite-tooltip",{overlayPositioning:"fixed",placement:"top",referenceElement:a},c))}};o([r()],Z.prototype,"checkboxVisible",void 0),o([r()],Z.prototype,"disabled",null),o([r({nonNullable:!0})],Z.prototype,"effectiveUnits",void 0),o([r()],Z.prototype,"expanded",void 0),o([r({nonNullable:!0})],Z.prototype,"line",void 0),o([r()],Z.prototype,"messages",void 0),o([r()],Z.prototype,"onExpandedToggle",void 0),o([r()],Z.prototype,"_statistics",void 0),Z=o([R("esri.widgets.ElevationProfile.LegendItem")],Z);let ce=class extends Se{constructor(){super(...arguments),this._expandedLine=null}render(){const{profiles:e,messages:t,effectiveUnits:i,_expandedLine:n}=this;return d("div",{class:Mi.base},e.map(s=>d(Z,{checkboxVisible:e.length>1,effectiveUnits:i,expanded:s===n,line:s,messages:t,onExpandedToggle:()=>this._onExpandedToggle(s)})))}_onExpandedToggle(e){this._expandedLine=e===this._expandedLine?null:e}};o([r()],ce.prototype,"effectiveUnits",void 0),o([r()],ce.prototype,"messages",void 0),o([r()],ce.prototype,"profiles",void 0),o([r()],ce.prototype,"_expandedLine",void 0),ce=o([R("esri.widgets.ElevationProfile.components.Legend")],ce);let A=class extends Se{constructor(){super(...arguments),this.messages=null,this._popover=null,this._popoverIsOpen=!1,this._onPopoverAfterCreate=e=>{this._popover=e},this._onUniformChartScalingChange=e=>{this.onUniformChartScalingChange(e.target.checked)}}loadDependencies(){return Te({action:()=>x(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),checkbox:()=>x(()=>import("./calcite-checkbox-fef8d84f.js"),["assets/calcite-checkbox-fef8d84f.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),label:()=>x(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),popover:()=>x(()=>import("./calcite-popover-c20a56ef.js"),["assets/calcite-popover-c20a56ef.js","assets/popover-33772892.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/Heading-2d7d203c.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/FloatingArrow-9e5c8eb0.js","assets/component-7281ffa6.js","assets/action-79a6733c.js","assets/interactive-39956fb6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),tooltip:()=>x(()=>import("./calcite-tooltip-5cb74da1.js"),["assets/calcite-tooltip-5cb74da1.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/FloatingArrow-9e5c8eb0.js"])})}initialize(){const e=()=>this._popover;this.addHandles([De(e,"calcitePopoverOpen",()=>this._popoverIsOpen=!0),De(e,"calcitePopoverClose",()=>this._popoverIsOpen=!1)])}render(){const{id:e,messages:t,visibleElements:i}=this,{unitSelector:n,uniformChartScalingToggle:s}=i;if(!t||!n&&!s)return d("div",{key:`${e}-empty`});const a=`${e}__action`,l=this._popoverIsOpen?t.hideSettings:t.showSettings;return d("div",{class:Ie.base,key:this},d("calcite-popover",{afterCreate:this._onPopoverAfterCreate,autoClose:!0,label:l,overlayPositioning:"fixed",placement:"bottom-end",referenceElement:a},this._renderPopoverContent()),d("calcite-action",{appearance:"transparent","data-testid":"settings-button",icon:"gear",id:a,label:l,scale:"s",text:l}))}_renderPopoverContent(){const{unitSelector:e,uniformChartScalingToggle:t}=this.visibleElements;return d("div",{class:Ie.popoverContent},e?this._renderUnitSelector():null,t?this._renderUniformChartScalingToggle():null)}_renderUnitSelector(){const{messages:e}=this;return d(Ri,{key:"unit-selector-label",options:this.unitOptions,selectLabel:(e==null?void 0:e.unitSelectLabel)??"",value:this.unit,onChange:this.onUnitChange})}_renderUniformChartScalingToggle(){const{messages:e}=this,t=this.uniformChartScaling,i=`${this.id}__uniform-chart-scaling-toggle`,n=(e==null?void 0:e[t?"uniformChartScalingDisable":"uniformChartScalingEnable"])??"";return d("calcite-label",{class:Ie.uniformChartScalingLabel,key:"uniform-chart-scaling-label",layout:"inline"},d("calcite-checkbox",{checked:t,class:Ie.uniformChartScalingCheckbox,id:i,onCalciteCheckboxChange:this._onUniformChartScalingChange}),d("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:i},n),e==null?void 0:e.uniformChartScalingLabel)}};o([r()],A.prototype,"messages",void 0),o([r()],A.prototype,"onUniformChartScalingChange",void 0),o([r()],A.prototype,"onUnitChange",void 0),o([r()],A.prototype,"uniformChartScaling",void 0),o([r()],A.prototype,"unit",void 0),o([r()],A.prototype,"unitOptions",void 0),o([r()],A.prototype,"visibleElements",void 0),o([r()],A.prototype,"_popover",void 0),o([r()],A.prototype,"_popoverIsOpen",void 0),A=o([R("esri.widgets.ElevationProfile.components.SettingsButton")],A);var O;(function(e){e.Sketch="sketch",e.SketchCancel="sketch-cancel",e.SketchDone="sketch-done",e.Select="select",e.SelectCancel="select-cancel"})(O||(O={}));const we=[{type:O.Select},{type:O.Sketch}],bn={[k.None]:null,[k.NoValidInput]:"noProfile",[k.NoVisibleProfiles]:"noProfile",[k.RefinedButNoChartData]:"noProfile",[k.TooComplex]:"tooComplex",[k.UnknownError]:"unknown",[k.InvalidGeometry]:"invalidGeometry",[k.InvalidElevationInfo]:"invalidElevationInfo"},ut=Symbol("resize-observer-handle");let w=class extends Se{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new Mt,this.iconClass=S.widgetIcon,this.icon=null,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._chartInitTask=null,this._chartIsRefined=!1,this._width=0,this._zoomOutButtonVisible=!1,this._getChartUpdateParamsMemoized=H((i,n,s,a)=>({chart:i,data:n,stationary:s,messages:a})),this._onZoomOutButtonClick=()=>{var i;(i=this._chart)==null||i.zoomOut()},this._onClearButtonClick=()=>{this.viewModel.clear()},e!=null&&e.viewModel||(this._defaultViewModel=new Rt({view:e==null?void 0:e.view}),this.viewModel=this._defaultViewModel)}loadDependencies(){return Te({action:()=>x(()=>import("./calcite-action-dcffc330.js"),["assets/calcite-action-dcffc330.js","assets/action-79a6733c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js"]),button:()=>x(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),loader:()=>x(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"])})}postInitialize(){this.addHandles([I(()=>({container:this._chartContainer,width:this._width}),({container:e,width:t})=>{this._destroyChart(),e!=null&&t>0&&this._initializeChart(e)},Xe),I(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),Xe)])}destroy(){this._destroyChart(),this._defaultViewModel!=null&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get input(){return this.viewModel.input}set input(e){this.viewModel.input=e}get profiles(){return this.viewModel.profiles}set profiles(e){this.viewModel.profiles=e}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(e){this.viewModel.unitOptions=e}get unit(){return this.viewModel.unit}set unit(e){this.viewModel.unit=e}get geodesicDistanceThreshold(){return this.viewModel.geodesicDistanceThreshold}set geodesicDistanceThreshold(e){this.viewModel.geodesicDistanceThreshold=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}get _portrait(){return this._width<N().portraitModePixelBreakpoint}get _chartUpdateParams(){const e=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,e==null||e.stationary,this._chartMessages)}get _chartMessages(){return{...this.messagesUnits,...this.messages}}get _profilesArray(){return this.profiles.toArray()}render(){const{viewModel:e,visible:t}=this;return d("div",{"aria-label":this.messages.widgetLabel,class:this.classes({[S.base]:t,[Ve.widget]:t,[Ve.panel]:t,[Ve.widgetDisabled]:t&&e.state==="disabled",[S.portrait]:this._portrait,[S.refined]:e.progress===1}),key:this},d("div",{afterCreate:this._onContentWrapperAfterCreate,afterRemoved:this._onContentWrapperRemoved,bind:this,key:"content-wrapper"},t?this._renderContentForState():null))}_renderContentForState(){switch(this.viewModel.state){case L.Ready:return this._renderContentForReadyState();case L.Selecting:return this._renderContentForSelectingState();case L.Creating:return this._renderContentForCreatingState();case L.Selected:return this._renderContentForSelectedState();case L.Created:return this._renderContentForCreatedState();case L.Disabled:return this._renderContentForReadyState()}}_renderContentForReadyState(){var s;const{sketchButton:e,selectButton:t}=this.visibleElements,i=this.messages;let n;return n=e&&t?i.readyPrompt:e?i.readyPromptCreateOnly:t?i.readyPromptSelectOnly:(s=i.errors)==null?void 0:s.noProfile,this._renderContent({prompt:n,chart:!1,actions:we})}_renderContentForSelectingState(){const e=this.view;if(e==null)return null;const t=this.messages[`selectingPrompt-${e.type}`];return this._renderContent({prompt:t,chart:!1,actions:[{type:O.SelectCancel}]})}_renderContentForCreatingState(){const{view:e,viewModel:t}=this;if(e==null)return null;const i=t.hasVertices?[{type:O.SketchCancel},{type:O.SketchDone,disabled:!t.tool.interaction.canStopCreating}]:[{type:O.Select},{type:O.Sketch,disabled:!0}];if(t.errorState===k.NoValidInput){const s=this.messages[`creatingPrompt-${e.type}`];return this._renderContent({chart:!1,actions:i,prompt:s})}const n=this._getErrorMessage();return n?this._renderContent({chart:!1,actions:i,prompt:n}):this._renderContent({chart:!0,actions:i})}_renderContentForSelectedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:we,prompt:e}):this._renderContent({chart:!0,actions:we})}_renderContentForCreatedState(){const e=this._getErrorMessage();return e?this._renderContent({chart:!1,actions:we,prompt:e}):this._renderContent({chart:!0,actions:we})}_getErrorMessage(){var t,i;const e=bn[this.viewModel.errorState];return e?(i=(t=this.messages)==null?void 0:t.errors)==null?void 0:i[e]:null}_renderContent(e){const t=e.prompt!=null?this._renderPrompt(e.prompt):e.chart&&this._renderChart(),{viewModel:i}=this,n=i.input!=null;return d(Re,null,d("header",{class:S.header,key:"header"},this._zoomOutButtonVisible?this._renderZoomOutButton():null,this.visibleElements.clearButton&&n?this._renderClearButton():null,this.visibleElements.settingsButton?d(A,{messages:this.messages,uniformChartScaling:i.uniformChartScaling,unit:i.unit,unitOptions:i.unitOptions,visibleElements:this.visibleElements,onUniformChartScalingChange:s=>i.uniformChartScaling=s,onUnitChange:s=>i.unit=s}):null),d("div",{class:S.mainContainer,key:"main-container"},t),this.visibleElements.legend?d(ce,{effectiveUnits:i.effectiveUnits,messages:this.messages,profiles:this._profilesArray}):null,this._renderActions(e))}_renderZoomOutButton(){return d("calcite-action",{appearance:"transparent",class:S.zoomOutButton,"data-testid":"zoom-out-button",icon:"magnifying-glass-minus",key:"zoom-out",onclick:this._onZoomOutButtonClick,scale:"s",text:this.messages.zoomOut})}_renderClearButton(){return d("calcite-action",{appearance:"transparent",class:S.clearButton,"data-testid":"clear-button",icon:"trash",key:"clear-profile",onclick:this._onClearButtonClick,scale:"s",text:this.messages.clearProfile})}_renderPrompt(e){return[d("div",{bind:this,class:S.promptContainer,key:"prompt-container"},d("p",null,e))]}_renderChart(){if(!this.visibleElements.chart)return d("div",{class:S.chartContainer,key:"empty-chart-container"});const e=this._chartIsRefined||this._canRenderChart();if(!e)return d(Re,null,this._renderSpinner({size:"large"}),d("div",{class:S.chartContainer,key:"chart-container-empty"}));const{chartData:t,progress:i}=this.viewModel;return d(Re,null,t!=null&&i>0&&i<1?this._renderSpinner({size:e?"small":"large"}):null,d("div",{afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved,bind:this,class:S.chartContainer,key:"chart-container"}))}_renderSpinner(e){const t=e.size==="small";return d("calcite-loader",{afterCreate:this._onSpinnerAfterCreate,class:this.classes(S.chartSpinner,t&&S.chartSpinnerSmall),exitAnimation:this._onSpinnerExit,inline:t,key:"spinner",label:"",scale:"s"})}_onSpinnerAfterCreate(e){requestAnimationFrame(()=>e.classList.add(S.chartSpinnerVisible))}_onSpinnerExit(e,t){e.classList.remove(S.chartSpinnerVisible),setTimeout(t,200)}_canRenderChart(){const e=this.viewModel.chartData;if(e==null)return!1;if(!this.viewModel.inputIsSketched)return e.refined;let t=0;for(const{samples:i}of e.lines)t+=i!=null?i.length:0;return e.refined||t<=N().largeChartSamples}_renderActions({actions:e}){const t=e.map(i=>{switch(i.type){case O.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:i,className:S.sketchButton,label:this.messages.sketchButtonLabel,onClick:this._onSketchButtonClick,primary:!0});case O.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:S.sketchCancelButton,label:this.messagesCommon.cancel,primary:!1});case O.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:i,onClick:this._onDoneButtonClick,className:S.sketchDoneButton,label:this.messagesCommon.done,primary:!0});case O.Select:return this.visibleElements.selectButton&&this._renderAction({action:i,onClick:this._onSelectButtonClick,className:S.selectButton,label:this.messages.selectButtonLabel,primary:!1});case O.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:i,onClick:this._onCancelButtonClick,className:S.selectCancelButton,label:this.messagesCommon.cancel,primary:!1})}}).filter(Boolean);return t.length?d("footer",{class:S.footer,key:"footer"},t):null}_renderAction({action:e,className:t,label:i,onClick:n,primary:s}){return d("calcite-button",{appearance:s?"solid":"outline-fill",bind:this,class:this.classes(S.actionButton,t),disabled:e.disabled,key:`action-${e.type}`,onclick:n},i)}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_onContentWrapperAfterCreate(e){const t=di(e,i=>{this._width=i.contentRect.width});this.addHandles(t,ut)}_onContentWrapperRemoved(){this.removeHandles(ut)}_updateChart(e){const{data:t,chart:i,messages:n,stationary:s}=e;i!=null&&n!=null&&s&&this._canRenderChart()&&(i.update(e),this._chartIsRefined=t!=null&&t.refined)}_onChartContainerAfterCreate(e){this._chartContainer=e}_onChartContainerRemoved(){this._chartContainer=null}_initializeChart(e){he(this._chartInitTask),this._chartInitTask=Le(async t=>{const{createChart:i}=await x(()=>import("./chartUtils-e91f77f3.js"),["assets/chartUtils-e91f77f3.js","assets/Responsive-41bba195.js","assets/Theme-016ad2b9.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/signal-51ed66f5.js","assets/unitFormatUtils-67047561.js","assets/Cyclical-4c223a04.js","assets/chartUtilsAm5-2f34c09b.js","assets/Tooltip-3e2bf68f.js","assets/DefaultTheme-ef2e8ff5.js","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/themeUtils-7dcf5b71.js","assets/LineSeries-edf0978b.js","assets/ColorSet-19b07c03.js","assets/Tick-52f438fc.js","assets/Button-d5e3d401.js","assets/memoize-3e55df82.js","assets/intersectorUtilsConversions-d05d75a3.js","assets/Intersector-fa865806.js","assets/ViewingMode-5d7d590b.js","assets/boundedPlane-1da2f094.js","assets/verticalOffsetUtils-e5214af9.js","assets/orientedBoundingBox-67c5cd22.js","assets/Intersector-2e1d9db3.js","assets/Intersector-a291e778.js","assets/defaultUnit-414db021.js","assets/getDefaultUnitForView-d1ffbf16.js","assets/throttle-7bf02de9.js","assets/elevationInfoUtils-be36d866.js","assets/Material-5f4156ac.js","assets/interfaces-8918b36f.js","assets/geodesicUtils-822c19ca.js","assets/QueueProcessor-4b9d43d3.js","assets/Scheduler-ff5943a4.js","assets/debugFlags-9a30f077.js","assets/RenderState-1d6218ee.js","assets/traversalUtils-bbdec2e9.js","assets/Ground-ed93a93a.js","assets/loadAll-5e767cfa.js","assets/ElevationQuery-4be4efe0.js","assets/ElevationSamplerData-9f34f589.js","assets/SketchViewModel-fedf7932.js","assets/layerUtils-437666a3.js","assets/screenUtils-8dc4a7f9.js","assets/snappingUtils-93e84fbe.js","assets/dehydratedPoint-5a1dfed5.js","assets/Query-071039d7.js","assets/FullTextSearch-12e0754c.js","assets/QuantizationParameters-f983cf8d.js","assets/SketchTooltipOptions-cc43c059.js","assets/SnappingManager-aa70fdd4.js","assets/UpdatingHandles-7949a657.js","assets/geometry2dUtils-a99dcf3d.js","assets/FeatureFilter-55dd341e.js","assets/floorFilterUtils-080a7cd2.js","assets/viewUtils-9f810d02.js","assets/hitTestSelectUtils-d512707e.js","assets/UnitSelect-52961079.js","assets/globalCss-94006b67.js"]);oe(t);const n=await i({container:e,abortOptions:{signal:t},onRangeChange:(s,a)=>{this._zoomOutButtonVisible=s!==1||a!==1},onCursorPositionChange:s=>{this.viewModel.hoveredChartPosition=s}});if(t.aborted)throw z(n),hi();this._chart=n,this._updateChart(this._chartUpdateParams)})}_destroyChart(){this._chartInitTask=he(this._chartInitTask),this._chart=z(this._chart),this._chartIsRefined=!1}};o([r({type:Rt})],w.prototype,"viewModel",void 0),o([r()],w.prototype,"view",null),o([r()],w.prototype,"input",null),o([r()],w.prototype,"profiles",null),o([r()],w.prototype,"unitOptions",null),o([r()],w.prototype,"unit",null),o([r()],w.prototype,"geodesicDistanceThreshold",null),o([r({type:Mt,nonNullable:!0})],w.prototype,"visibleElements",void 0),o([r()],w.prototype,"iconClass",void 0),o([r()],w.prototype,"icon",void 0),o([r()],w.prototype,"label",null),o([r()],w.prototype,"visible",null),o([r(),Ce("esri/widgets/ElevationProfile/t9n/ElevationProfile")],w.prototype,"messages",void 0),o([r(),Ce("esri/t9n/common")],w.prototype,"messagesCommon",void 0),o([r(),Ce("esri/core/t9n/Units")],w.prototype,"messagesUnits",void 0),o([r()],w.prototype,"_chartContainer",void 0),o([r()],w.prototype,"_chart",void 0),o([r()],w.prototype,"_chartInitTask",void 0),o([r()],w.prototype,"_chartIsRefined",void 0),o([r()],w.prototype,"_width",void 0),o([r()],w.prototype,"_portrait",null),o([r()],w.prototype,"_zoomOutButtonVisible",void 0),o([r()],w.prototype,"_chartUpdateParams",null),o([r()],w.prototype,"_chartMessages",null),o([r()],w.prototype,"_profilesArray",null),w=o([R("esri.widgets.ElevationProfile")],w);const wn=w,Jn=Object.freeze(Object.defineProperty({__proto__:null,default:wn},Symbol.toStringTag,{value:"Module"}));export{Jn as E,ct as e,N as n,Di as s,L as t};

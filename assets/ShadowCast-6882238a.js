import{a5 as i,a6 as s,dA as f,V as we,a9 as y,bA as L,kh as h,ep as De,gj as X,cn as te,cb as m,dr as v,gQ as se,ao as ie,kj as Oe,y as Y,b9 as U,qT as K,bh as Ve,gy as Ee,lT as ze,aW as Ae,qU as ne,kW as Me,aP as Re,_ as b,h1 as be,qV as Le,gk as Ie,fU as xe,b5 as He}from"./index-b516d057.js";import{L as fe}from"./Slider-50915901.js";import{i as Fe,n as r,g as Ue,e as N,O as W,r as q}from"./jsxFactory-92036771.js";import{a as Be}from"./earthUtils-ef4b5643.js";import{k as Ne,t as J}from"./ShadowCastVisualizeTechniqueConfiguration-4fcc4e25.js";import{e as re}from"./throttle-7bf02de9.js";import{n as We}from"./traversalUtils-bbdec2e9.js";import{n as B}from"./uuid-709b6c67.js";import{y as Ge}from"./Popover-ca6b0b13.js";import{C as je}from"./DatePicker-ccc9fd8a.js";import{e as R}from"./globalCss-94006b67.js";import{e as ae}from"./Heading-92f210ca.js";import{d as qe,f as Ke}from"./TimezonePicker-3b109513.js";import"./ViewingMode-5d7d590b.js";import"./ShaderTechniqueConfiguration-2502462e.js";import"./interfaces-8918b36f.js";import"./accessibleHandler-e91101b2.js";const w="esri-shadow-cast",k={base:w,widgetIcon:Fe.measureBuildingHeightShadow,timeRange:`${w}__time-range`,timeRangeIndicator:`${w}__time-range__indicator`,datePickerContainer:`${w}__date-picker-container`,visualization:`${w}__visualization`,visualizationSelect:`${w}__visualization__select`,visualizationConfigHidden:`${w}__visualization__config--hidden`},Qe=`${w}__label`,le=`${w}__threshold-config`,de={base:le,valueLabel:`${le}__value-label`},ce=`${w}__duration-config`,ue={base:ce,radioGroup:`${ce}__radio-group`},Ze=`${w}__discrete-config`,Je={base:Ze},he=`${w}__tooltip`,pe={base:he,content:`${he}__content`};var F;(function(e){e.Disabled="disabled",e.Ready="ready"})(F||(F={}));let I=class extends L{constructor(){super({}),this.color=new f([50,50,50,.7]),this.intervalOptions=new we([h(15,"minutes","milliseconds"),h(30,"minutes","milliseconds"),h(1,"hours","milliseconds"),h(2,"hours","milliseconds"),h(3,"hours","milliseconds")]),this.interval=this.intervalOptions.at(0)}set intervalOptions(t){this._set("intervalOptions",De(t,this._get("intervalOptions")))}};i([s({type:f})],I.prototype,"color",void 0),i([s()],I.prototype,"interval",void 0),i([s({type:we})],I.prototype,"intervalOptions",null),I=i([y("esri.widgets.ShadowCast.DiscreteOptions")],I);const Ce=I;var O;(function(e){e.Continuous="continuous",e.Hourly="hourly"})(O||(O={}));let j=class extends L{constructor(){super(...arguments),this.color=new f([0,0,255,.7]),this.mode=O.Continuous}};i([s({type:f})],j.prototype,"color",void 0),i([s()],j.prototype,"mode",void 0),j=i([y("esri.widgets.ShadowCast.DurationOptions")],j);const Te=j;var $;(function(e){e.PointerMove="pointer-move",e.Main="main"})($||($={}));const Xe=300;let C=class extends L{constructor(t){super(t),this._screenPoint=null,this._accumulatedShadowTime=null,this._shadowTimeTask=null,this._updateAccumulatedShadowTime=(o,n)=>{this._shadowTimeTask=X(this._shadowTimeTask),this._shadowTimeTask=te(async a=>{const{results:l,ground:c}=await o.hitTest(n);if(l.length===0&&!c.mapPoint)return void(this._accumulatedShadowTime=null);const T=await this.getDuration(n,a);this._accumulatedShadowTime=T})},this._throttledUpdateAccumulatedShadowTime=re(this._updateAccumulatedShadowTime,Xe)}initialize(){this.addHandles(m(()=>({enabled:this.enabled,view:this.view}),({enabled:t,view:o})=>{t&&o!=null?this._startTracking(o):this._stopTracking()},v))}get screenPoint(){return this.enabled?this._screenPoint:null}get accumulatedShadowTime(){return this.enabled?this._accumulatedShadowTime:null}get testData(){return{setThrottleDelay:t=>{this._throttledUpdateAccumulatedShadowTime.remove(),this._throttledUpdateAccumulatedShadowTime=re(this._updateAccumulatedShadowTime,t)}}}_startTracking(t){if(this.hasHandles($.Main))return;const o=()=>{this.hasHandles($.PointerMove)||this.addHandles(t.on("pointer-move",a=>{const l=se(a.x,a.y);this._screenPoint=l,this._throttledUpdateAccumulatedShadowTime(t,l)}),$.PointerMove)},n=()=>{this.removeHandles($.PointerMove),this._screenPoint=null,this._accumulatedShadowTime=null};this.addHandles([this._throttledUpdateAccumulatedShadowTime,t.on("pointer-enter",o),t.on("pointer-leave",n),t.on("pointer-down",n),t.on("pointer-drag",n),t.on("pointer-up",o),t.on("click",a=>{const l=se(a.x,a.y);this._screenPoint=l,this._updateAccumulatedShadowTime(t,l)}),ie(()=>{this._shadowTimeTask=X(this._shadowTimeTask)})],$.Main),o()}_stopTracking(){this.removeHandles($.Main)}};i([s()],C.prototype,"getDuration",void 0),i([s()],C.prototype,"view",void 0),i([s()],C.prototype,"enabled",void 0),i([s()],C.prototype,"screenPoint",null),i([s()],C.prototype,"accumulatedShadowTime",null),i([s()],C.prototype,"_screenPoint",void 0),i([s()],C.prototype,"_accumulatedShadowTime",void 0),i([s()],C.prototype,"_shadowTimeTask",void 0),C=i([y("esri.widgets.ShadowCast.ShadowTooltipViewModel")],C);var u;(function(e){e.Threshold="threshold",e.Duration="duration",e.Discrete="discrete"})(u||(u={}));u.Threshold,u.Duration,u.Discrete;let z=class extends L{constructor(){super(...arguments),this.color=new f([255,0,0,.7]),this.value=h(4,"hours","milliseconds"),this.minValue=0,this.maxValue=h(8,"hours","milliseconds")}};i([s({type:f})],z.prototype,"color",void 0),i([s()],z.prototype,"value",void 0),i([s()],z.prototype,"minValue",void 0),i([s()],z.prototype,"maxValue",void 0),z=i([y("esri.widgets.ShadowCast.ThresholdOptions")],z);const Pe=z,_e=[],Ye=Ae(),me=[],ve=255,et=h(1,"hours","milliseconds"),tt=500;let d=class extends L{constructor(e){super(e),this.view=null,this.tooltip=new C({getDuration:(t,o)=>this.getDuration(t,o)}),this.startTimeOfDay=h(10,"hours","milliseconds"),this.endTimeOfDay=h(16,"hours","milliseconds"),this.visualizationType=u.Threshold,this.thresholdOptions=new Pe,this.durationOptions=new Te,this.discreteOptions=new Ce,this._running=!0,this._stopPreviewingTask=null,this._forcePreview=!1,this._autoRestoreForcePreviewEnabled=!0,this._utcOffset=null,this.date=new Date}initialize(){this.addHandles([m(()=>({view:this.view,tooltipEnabled:this._tooltipEnabled}),({view:e,tooltipEnabled:t})=>{this.tooltip.view=e,this.tooltip.enabled=t},v),m(()=>this._forcePreviewDependencies,()=>{X(this._stopPreviewingTask),this._forcePreview=!0,this._autoRestoreForcePreviewEnabled&&(this._stopPreviewingTask=te(async e=>{await Oe(tt,e),Y(e),this._forcePreview=!1}))},v),m(()=>({renderer:this.renderer,parameters:this._visualizationParameters}),e=>G(e.renderer,e.parameters),v),m(()=>({renderer:this.renderer,parameters:{lightDirections:this._lightDirections}}),e=>G(e.renderer,e.parameters),v),m(()=>({renderer:this.renderer,parameters:{enabled:this._running}}),e=>G(e.renderer,e.parameters),v),m(()=>({renderer:this.renderer,parameters:{previewing:this._previewing}}),e=>G(e.renderer,e.parameters),v)])}destroy(){this.stop(),G(this.renderer,{enabled:!1}),U(this.tooltip)}get state(){return this.view!=null&&this.view.ready&&this._referencePosition!=null?F.Ready:F.Disabled}set date(e){const t=new Date(e);t.setHours(0,0,0,0),this._set("date",t)}get utcOffset(){return this._utcOffset??this._utcOffsetAuto}set utcOffset(e){this._utcOffset=e}get testData(){return{setAutoRestoreForcedPreviewEnabled:e=>{this._autoRestoreForcePreviewEnabled=e},setForcedPreview:e=>{this._forcePreview=e},isPreviewing:()=>this._previewing}}get _previewing(){const{view:e}=this;return(e==null?void 0:e.allLayerViews)==null||this._forcePreview||!e.stationary||e.allLayerViews.some(t=>ee(t)&&t.updating)}get _utcOffsetAuto(){const e=this._referencePosition;return e!=null?Be(e[0],!1):0}get _dateUTCOffset(){let e=this.date;return e=K(e,-e.getTimezoneOffset(),"minutes"),e=K(e,-this.utcOffset,"hours"),e}get _startDateTimeUTC(){return K(this._dateUTCOffset,this.startTimeOfDay)}get _endDateTimeUTC(){return K(this._dateUTCOffset,this.endTimeOfDay)}get _referencePosition(){var e,t;return(t=(e=this.view)==null?void 0:e.environmentManager)==null?void 0:t.referencePositionWGS84Comparable}get _interval(){const e=this._duration>0?Math.floor(this._duration/ve):ve,t=this.discreteOptions.interval;switch(this.visualizationType){case u.Threshold:case u.Duration:return e;case u.Discrete:return t>0?t:e}}get _sampleCount(){return this._lightDirections.length}get _duration(){return this.endTimeOfDay-this.startTimeOfDay}get _lightDirections(){const{view:e}=this;if(e==null)return _e;const t=e.viewingMode==="global"?Ye:this._referencePosition;if(t==null)return _e;const o=this._interval,n=Ne(this._startDateTimeUTC,this._endDateTimeUTC,o,t,e.state.viewingMode),a=n.length;me.length=0;const l=We(0,a,me),c=new Array(a);for(let T=0;T<a;++T)c[T]=n[l[T]];return c}get _tooltipEnabled(){return this.state===F.Ready&&this.visualizationType!==u.Discrete&&this._running&&!this._previewing}get _visualizationParameters(){if(!this._running)return null;switch(this.visualizationType){case u.Threshold:return this._thresholdVisualizationParameters;case u.Duration:return this._durationVisualizationParameters;case u.Discrete:return this._discreteVisualizationParameters}}get _thresholdVisualizationParameters(){const{value:e,color:t}=this.thresholdOptions,o=this._duration;return{visualization:J.Threshold,color:f.toUnitRGBA(t),threshold:o>0?e/this._duration:0}}get _durationVisualizationParameters(){const{color:e,mode:t}=this.durationOptions,o=this._duration,n=o>0&&t===O.Hourly?et/o:0;return{color:f.toUnitRGBA(e),visualization:J.Gradient,bandsEnabled:n>0,bandSize:n}}get _discreteVisualizationParameters(){return{color:f.toUnitRGBA(this.discreteOptions.color),visualization:J.Gradient,bandsEnabled:!1,bandSize:0}}get _forcePreviewDependencies(){const{view:e}=this;if(e==null)return null;const t=e.slicePlane,o=e.allLayerViews.toArray().filter(ee),n=o.map(p=>p.layer).filter(Ve),a=o.map(p=>p.visible),l=n.map(p=>p.visible),c=n.map(p=>p.opacity),T=n.filter(p=>"definitionExpression"in p).map(p=>p.definitionExpression),$e=o.filter(p=>"filter"in p).map(p=>p.filter);return{slicePlane:t,startDateUTC:this._startDateTimeUTC,endDateUTC:this._endDateTimeUTC,layerViewVisibilities:a,layerVisibilities:l,layerOpacities:c,filters:$e,definitionExpressions:T}}get renderer(){const{view:e}=this;if(e==null)return null;const t=e._stage;return t==null?null:t.renderer}start(){this.setRunning(!0)}stop(){this.setRunning(!1)}setRunning(e){this._running=e}async getDuration(e,t){const{view:o,renderer:n}=this;if(o==null||n==null)return 0;const a=o.state.camera.screenToRender(Ee(e.x,e.y),ze()),l=n.readAccumulatedShadow(a),c=this._sampleCount;return c===0?0:l*c*(this._duration/c)}};function G(e,t){e!=null&&t!=null&&e.setParameters({shadowCastOptions:t})}function ee(e){if(e.suspended)return!1;switch(e.type){case"building-scene-3d":case"csv-3d":case"elevation-3d":case"feature-3d":case"geojson-3d":case"graphics-3d":case"integrated-mesh-3d":case"ogc-feature-3d":case"route-3d":case"scene-layer-3d":case"scene-layer-graphics-3d":case"stream-3d":case"wms-3d":return!0;case"base-dynamic-3d":case"dimension-3d":case"imagery-3d":case"imagery-tile-3d":case"line-of-sight-3d":case"map-image-3d":case"point-cloud-3d":case"tile-3d":case"vector-tile-3d":case"voxel-3d":case"wfs-3d":case"wmts-3d":case"media-3d":default:return!1;case"group":return e.layerViews.toArray().some(t=>ee(t))}}i([s()],d.prototype,"state",null),i([s()],d.prototype,"view",void 0),i([s()],d.prototype,"tooltip",void 0),i([s({nonNullable:!0})],d.prototype,"date",null),i([s({nonNullable:!0})],d.prototype,"utcOffset",null),i([s({nonNullable:!0})],d.prototype,"startTimeOfDay",void 0),i([s({nonNullable:!0})],d.prototype,"endTimeOfDay",void 0),i([s({nonNullable:!0})],d.prototype,"visualizationType",void 0),i([s({type:Pe,nonNullable:!0})],d.prototype,"thresholdOptions",void 0),i([s({type:Te,nonNullable:!0})],d.prototype,"durationOptions",void 0),i([s({type:Ce,nonNullable:!0})],d.prototype,"discreteOptions",void 0),i([s()],d.prototype,"_running",void 0),i([s()],d.prototype,"_stopPreviewingTask",void 0),i([s()],d.prototype,"_forcePreview",void 0),i([s()],d.prototype,"_autoRestoreForcePreviewEnabled",void 0),i([s()],d.prototype,"_previewing",null),i([s()],d.prototype,"_utcOffset",void 0),i([s()],d.prototype,"_utcOffsetAuto",null),i([s()],d.prototype,"_dateUTCOffset",null),i([s()],d.prototype,"_startDateTimeUTC",null),i([s()],d.prototype,"_endDateTimeUTC",null),i([s()],d.prototype,"_referencePosition",null),i([s()],d.prototype,"_interval",null),i([s()],d.prototype,"_sampleCount",null),i([s()],d.prototype,"_duration",null),i([s()],d.prototype,"_lightDirections",null),i([s()],d.prototype,"_tooltipEnabled",null),i([s()],d.prototype,"_visualizationParameters",null),i([s()],d.prototype,"_thresholdVisualizationParameters",null),i([s()],d.prototype,"_durationVisualizationParameters",null),i([s()],d.prototype,"_discreteVisualizationParameters",null),i([s()],d.prototype,"_forcePreviewDependencies",null),i([s()],d.prototype,"renderer",null),d=i([y("esri.widgets.ShadowCast.ShadowCastViewModel")],d);const it=d;let P=class extends L{constructor(){super(...arguments),this.timeRangeSlider=!0,this.timezone=!0,this.datePicker=!0,this.visualizationOptions=!0,this.colorPicker=!0,this.tooltip=!0}};i([s()],P.prototype,"timeRangeSlider",void 0),i([s()],P.prototype,"timezone",void 0),i([s()],P.prototype,"datePicker",void 0),i([s()],P.prototype,"visualizationOptions",void 0),i([s()],P.prototype,"colorPicker",void 0),i([s()],P.prototype,"tooltip",void 0),P=i([y("esri.widgets.ShadowCast.ShadowCastVisibleElements")],P);const ke=P;function Se(e,t="milliseconds",o={}){const n={locale:ot(),numberingSystem:"latn"};let a;return a=e?ne.fromMillis(h(e,t,"milliseconds"),n).rescale():ne.fromObject({seconds:0},n),a.toHuman({listStyle:"narrow",unitDisplay:"long",...o})}function ot(){return Me()==="bs"?"hr":Re()}function Z(e,t){const{for:o,label:n,tabIndex:a,...l}=e;return r("div",{class:Ue(Qe,l==null?void 0:l.class),key:o,...l},r("calcite-label",{for:o,scale:"s",tabIndex:a},n),t)}const V="esri-color-picker",E={base:V,backgroundPattern:`${V}__bg-pattern`,toggleButton:`${V}__toggle-button`,popover:`${V}__popover`,opacitySliderContainer:`${V}__opacity-slider-container`,opacitySlider:`${V}__opacity-slider`,calciteColorPicker:`${V}__calcite-color-picker`};var D;(function(e){e.ColorPickerFocus="hex-input-poll-timeout",e.ButtonFocusTimeout="button-focus-timeout"})(D||(D={}));let g=class extends W{constructor(e,t){super(e,t),this.value=new f,this.alphaEnabled=!0,this._containerElement=null,this._popover=null,this._popoverElement=null,this._buttonElement=null,this._colorPickerCreated=!1}initialize(){this.addHandles(m(()=>({container:this._containerElement,value:this.value}),({container:e,value:t})=>{e==null||e.style.setProperty("--esri-color-picker-value",t.toCss(!0))},v))}loadDependencies(){return q({button:()=>b(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),"color-picker":()=>b(()=>import("./calcite-color-picker-412173a3.js"),["assets/calcite-color-picker-412173a3.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/color-picker-swatch-ebbf0614.js","assets/loadable-7d42c3de.js","assets/icon-c122f720.js","assets/observers-9c654f26.js","assets/input-number-9c00b0ee.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/locale-2cb18332.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/progress-2100df13.js","assets/math-d5d87794.js","assets/button-27a2f99e.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js","assets/tab-eb1be4ce.js","assets/tab-nav-0cd87cbd.js","assets/tab-title-34da98ef.js","assets/tabs-87ec1ac7.js","assets/throttle-e5413962.js","assets/debounce-7cc294e2.js"]),label:()=>b(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),slider:()=>b(()=>import("./calcite-slider-7adfa62e.js"),["assets/calcite-slider-7adfa62e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/math-d5d87794.js"])})}destroy(){this._destroyPopover(),this._buttonElement=null}render(){const e=this._messages,t=this._popover!=null&&this._popover.open?e.close:e.open;return r("div",{afterCreate:this._onContainerAfterCreate,bind:this,class:this.classes(E.base,this.class)},r("div",{class:E.backgroundPattern}),r("calcite-button",{afterCreate:this._onButtonAfterCreate,appearance:"transparent",bind:this,class:E.toggleButton,id:this.id,kind:"neutral",label:t,onclick:this._togglePopover,scale:"s",tabIndex:-1,title:t}))}_onContainerAfterCreate(e){this._containerElement=e}_onButtonAfterCreate(e){this._destroyPopover(),this._buttonElement=e,this._popover=new Ge({owner:this,anchorElement:e,placement:"bottom-start",renderContentFunction:this._renderPopoverContent})}_destroyPopover(){this.removeHandles(D.ColorPickerFocus),this._popover=U(this._popover),this._popoverElement=null}_renderPopoverContent(){const e=this.value,t=this._messages;return r("div",{afterCreate:this._onPopoverAfterCreate,bind:this,class:E.popover,onfocusout:this._onPopoverFocusOut,onkeydown:this._onPopoverKeyDown,tabIndex:-1},r("calcite-color-picker",{afterCreate:this._onColorPickerAfterCreate,afterRemoved:()=>this._colorPickerCreated=!1,bind:this,class:E.calciteColorPicker,hideChannels:!0,hideSaved:!0,scale:"m",value:this._colorPickerCreated?e.toCss():null,onCalciteColorPickerInput:this._onColorInput}),this.alphaEnabled?r("section",{class:E.opacitySliderContainer},r("calcite-label",{scale:"s"},t.opacity,r("calcite-slider",{bind:this,class:E.opacitySlider,labelHandles:!0,max:1,min:0,step:.01,value:e.a,onCalciteSliderInput:this._onOpacityChange}))):null)}_onColorInput(e){const t=e.target.value,o=typeof t=="string"?new f(t):new f;o.a=this.value.a,this._onChange(o)}_onOpacityChange(e){const t=this.value.clone();t.a=e.target.value,this._onChange(t)}_onChange(e){this.value=e,this.onChange!=null&&this.onChange(e)}_onColorPickerAfterCreate(e){this.removeHandles(D.ColorPickerFocus);const t=te(async o=>{e.componentOnReady&&await e.componentOnReady(),Y(o),this._colorPickerCreated=!0,await new Promise(n=>requestAnimationFrame(n)),Y(o),e.setFocus()});this.addHandles(ie(()=>{t.abort(),this._colorPickerCreated=!1}),D.ColorPickerFocus)}_togglePopover(e){this._popover!=null&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){const e=this._popover;e&&(e.open=!0)}_closePopover(){this.removeHandles(D.ColorPickerFocus);const e=this._popover;e&&(e.open=!1),this._setFocusOnButton()}_setFocusOnButton(){this.removeHandles(D.ButtonFocusTimeout),this.addHandles(st(()=>{var e;return(e=this._buttonElement)==null?void 0:e.setFocus()}),D.ButtonFocusTimeout)}_onPopoverAfterCreate(e){this._popoverElement=e}_onPopoverFocusOut(e){const t=this._popoverElement;if(t==null)return;const o=e.relatedTarget;o&&o instanceof Node&&(t.contains(o)||o===this._buttonElement||this._isAssociatedLabel(o))||this._closePopover()}_isAssociatedLabel(e){var n;const t=this.id,o=(n=e.tagName)==null?void 0:n.toLowerCase();return o==="calcite-label"&&e.for===t||o==="label"&&e.htmlFor===t}_onPopoverKeyDown(e){e.key!=="Escape"&&e.key!=="Enter"||(e.stopPropagation(),this._closePopover())}};function st(e,t){const o=setTimeout(e,t);return ie(()=>clearTimeout(o))}i([s()],g.prototype,"class",void 0),i([s()],g.prototype,"value",void 0),i([s()],g.prototype,"alphaEnabled",void 0),i([s()],g.prototype,"onChange",void 0),i([s()],g.prototype,"_containerElement",void 0),i([s()],g.prototype,"_popover",void 0),i([s()],g.prototype,"_popoverElement",void 0),i([s()],g.prototype,"_buttonElement",void 0),i([s(),N("esri/widgets/support/t9n/ColorPicker")],g.prototype,"_messages",void 0),i([s()],g.prototype,"_colorPickerCreated",void 0),g=i([y("esri.widgets.support.ColorPicker")],g);function oe(e){return r(Z,{for:e.id,label:e.label,tabIndex:-1},r(g,{id:e.id,value:e.value,onChange:e.onChange}))}let x=class extends W{constructor(t){super(t),this.colorPickerVisible=!0,this._selectId=`select-${B()}`,this._colorPickerId=`color-picker-${B()}`,this._onColorChange=o=>{this.options.color=o}}loadDependencies(){return q({label:()=>b(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),option:()=>b(()=>import("./calcite-option-7b8b2690.js"),["assets/calcite-option-7b8b2690.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),select:()=>b(()=>import("./calcite-select-84c557c7.js"),["assets/calcite-select-84c557c7.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"])})}render(){const t=this._messages.discrete,o=t.intervalLabel,{color:n,interval:a,intervalOptions:l}=this.options;return r("div",{class:Je.base},r(Z,{for:this._selectId,label:o},r("calcite-select",{bind:this,id:this._selectId,label:o,onCalciteSelectChange:this._onIntervalChange},l.toArray().map(c=>r("calcite-option",{key:c,selected:c===a,value:String(c)},Se(c))))),this.colorPickerVisible?r(oe,{id:this._colorPickerId,label:t.colorLabel,value:n,onChange:this._onColorChange}):null)}_onIntervalChange(t){var n;const o=parseInt((n=t.target.selectedOption)==null?void 0:n.value,10);Number.isFinite(o)&&(this.options.interval=o)}};i([s()],x.prototype,"options",void 0),i([s()],x.prototype,"colorPickerVisible",void 0),i([s(),N("esri/widgets/ShadowCast/t9n/ShadowCast")],x.prototype,"_messages",void 0),x=i([y("esri.widgets.ShadowCast.components.DiscreteConfigurator")],x);let H=class extends W{constructor(t){super(t),this.colorPickerVisible=!0,this._modeSelectorId=`mode-selector-${B()}`,this._colorPickerId=`color-picker-${B()}`,this._onColorChange=o=>{this.options.color=o},this._setContinuous=()=>{this.options.mode=O.Continuous},this._setHourly=()=>{this.options.mode=O.Hourly}}loadDependencies(){return q({button:()=>b(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),label:()=>b(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"])})}render(){const t=this._messages.duration,{color:o,mode:n}=this.options;return r("div",{class:ue.base},r(Z,{for:this._modeSelectorId,label:t.modeLabel},r("div",{class:ue.radioGroup},r(ge,{active:n===O.Continuous,label:t.continuousLabel,onclick:this._setContinuous}),r(ge,{active:n===O.Hourly,label:t.hourlyLabel,onclick:this._setHourly}))),this.colorPickerVisible?r(oe,{id:this._colorPickerId,label:t.colorLabel,value:o,onChange:this._onColorChange}):null)}};function ge({active:e,label:t,...o}){return r("calcite-button",{alignment:"center",appearance:e?"solid":"outline",scale:"s",width:"half",...o},t)}i([s()],H.prototype,"options",void 0),i([s()],H.prototype,"colorPickerVisible",void 0),i([s(),N("esri/widgets/ShadowCast/t9n/ShadowCast")],H.prototype,"_messages",void 0),H=i([y("esri.widgets.ShadowCast.components.DurationConfigurator")],H);const nt=h(1,"minutes","milliseconds"),ye=h(15,"minutes","milliseconds");let A=class extends W{constructor(e,t){super(e,t),this.accumulatedShadowTime=null,this._messages=null}render(){const e=this._formattedContent;return r("div",{class:pe.base},e?r("div",{class:pe.content},e):null)}get _formattedContent(){const e=this._messages,t=this.accumulatedShadowTime;if(e==null||t==null)return null;const o=Le(t,t<ye?nt:ye);return be(e.timeInShadow,{duration:Se(o)})}};i([s()],A.prototype,"accumulatedShadowTime",void 0),i([s()],A.prototype,"view",void 0),i([s(),N("esri/widgets/ShadowCast/t9n/ShadowCast")],A.prototype,"_messages",void 0),i([s({readOnly:!0})],A.prototype,"_formattedContent",null),A=i([y("esri.widgets.ShadowCast.components.ShadowTooltipContent")],A);let M=class extends L{constructor(e){super(e),this._updateHandle=null,this._contentContainer=this._createContainer()}initialize(){this.container.appendChild(this._contentContainer),this._contentWidget=new A({},this._contentContainer),this._updateHandle=m(()=>{const e=this._contentContainer,{screenPoint:t,accumulatedShadowTime:o}=this.viewModel.tooltip;return{contentContainer:e,screenPoint:t,accumulatedShadowTime:o}},e=>this._update(e),v)}destroy(){this._updateHandle=Ie(this._updateHandle),this._contentWidget=U(this._contentWidget),this.container.contains(this._contentContainer)&&this.container.removeChild(this._contentContainer)}get testData(){var e;return{displayedValue:this._contentContainer.style.display==="none"?null:(e=this._contentWidget.container)==null?void 0:e.innerText}}_update({contentContainer:e,screenPoint:t,accumulatedShadowTime:o}){const{style:n}=e;t!=null?(n.display="block",n.transform=`translate(${t.x}px, ${t.y}px)`,this._contentWidget.accumulatedShadowTime=o):n.display="none"}_createContainer(){const e=document.createElement("div"),{style:t}=e;return t.position="absolute",t.top="0",t.left="0",e}};i([s()],M.prototype,"viewModel",void 0),i([s()],M.prototype,"container",void 0),i([s()],M.prototype,"_contentContainer",void 0),i([s()],M.prototype,"_contentWidget",void 0),M=i([y("esri.widgets.ShadowCast.components.ShadowTooltip")],M);let S=class extends W{constructor(e){super(e),this.colorPickerVisible=!0,this._valueSliderId=`value-slider-${B()}`,this._colorPickerId=`color-picker-${B()}`,this._valueSlider=new fe({visibleElements:{labels:!1,rangeLabels:!1},steps:h(30,"minutes","milliseconds"),labelFormatFunction:(t,o)=>{const n=h(t,"milliseconds","hours");return o==="tick"?xe(n,{maximumFractionDigits:0}):""}}),this._onColorChange=t=>{this.options.color=t}}initialize(){const e=({value:t})=>{this.options.value=t};this.addHandles([m(()=>{const{value:t,minValue:o,maxValue:n}=this.options;return{value:t,minValue:o,maxValue:n}},({value:t,minValue:o,maxValue:n})=>{const a=this._valueSlider;a.min=o,a.max=n,a.values=[t];const l=n-o,c=Math.floor(h(l,"milliseconds","hours"));a.tickConfigs=[{mode:"count",values:2*c+1,labelsVisible:!1},{mode:"count",values:c+1,labelsVisible:!0}]},v),this._valueSlider.on("thumb-change",e),this._valueSlider.on("thumb-drag",e)])}loadDependencies(){return q({label:()=>b(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"])})}destroy(){this._valueSlider=U(this._valueSlider)}render(){const e=this._messages.threshold,{color:t}=this.options;return r("div",{class:de.base},r(Z,{class:de.valueLabel,for:this._valueSliderId,label:e.valueLabel},this._valueSlider.render()),this.colorPickerVisible?r(oe,{id:this._colorPickerId,label:e.colorLabel,value:t,onChange:this._onColorChange}):null)}get testData(){return{valueSlider:this._valueSlider}}};i([s()],S.prototype,"options",void 0),i([s()],S.prototype,"colorPickerVisible",void 0),i([s()],S.prototype,"testData",null),i([s()],S.prototype,"_valueSlider",void 0),i([s(),N("esri/widgets/ShadowCast/t9n/ShadowCast")],S.prototype,"_messages",void 0),S=i([y("esri.widgets.ShadowCast.components.ThresholdConfigurator")],S);var Q;(function(e){e.Slider="slider"})(Q||(Q={}));const rt={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},at=/(.*)\s(.*)/,lt={labelFormatFunction:Ke,min:0,max:1439,steps:15,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,t,o)=>{t.classList.add(R.primaryTick),o.classList.add(R.primaryTickLabel);const n=o.innerText.match(at);n&&(o.innerHTML=`${n[1]}<br><div class="${R.primaryTickAmPm}">${n[2]}</div>`)}},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,t)=>{t.classList.add(R.secondaryTick)}}]};let _=class extends W{constructor(e,t){super(e,t),this.viewModel=null,this.headingLevel=4,this.iconClass=k.widgetIcon,this.icon=null,this.visibleElements=new ke,this._defaultViewModel=null,this._timeSlider=new fe({...lt,container:document.createElement("div")}),this._tooltip=null,this._onTimezoneChange=o=>{this.viewModel.utcOffset=o},this._onDateChange=o=>{this.viewModel.date=o},e!=null&&e.viewModel||(this._defaultViewModel=new it({view:e==null?void 0:e.view}),this.viewModel=this._defaultViewModel)}initialize(){this.addHandles([m(()=>({viewModel:this.viewModel,slider:this._timeSlider}),e=>this._connectTimeSlider(e),v),m(()=>{var e;return{container:(e=this.view)==null?void 0:e.surface,viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip}},({container:e,viewModel:t,tooltipVisible:o})=>{this._tooltip=U(this._tooltip),e!=null&&o&&(this._tooltip=new M({viewModel:t,container:e}))},v),m(()=>({viewModel:this.viewModel,visible:this.visible}),({viewModel:e,visible:t})=>e.setRunning(t),v)])}destroy(){this._timeSlider=U(this._timeSlider),this._defaultViewModel!=null&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}loadDependencies(){return q({select:()=>b(()=>import("./calcite-select-84c557c7.js"),["assets/calcite-select-84c557c7.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),option:()=>b(()=>import("./calcite-option-7b8b2690.js"),["assets/calcite-option-7b8b2690.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"])})}render(){const{visibleElements:e,viewModel:t}=this,o=t.state===F.Disabled;return r("div",{class:this.classes(k.base,R.widget,R.panel,{[R.widgetDisabled]:o}),key:this},this._renderTimeRangeSection(),e.visualizationOptions?this._renderVisualizationOptionsSection():null)}get view(){var e;return(e=this.viewModel)==null?void 0:e.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get testData(){return{tooltip:this._tooltip}}_connectTimeSlider({viewModel:e,slider:t}){if(this.removeHandles(Q.Slider),t==null)return;const o=l=>h(l,"milliseconds","minutes"),n=l=>h(l,"minutes","milliseconds"),a=({index:l,value:c})=>{l===0?e.startTimeOfDay=n(c):e.endTimeOfDay=n(c)};this.addHandles([m(()=>[e.startTimeOfDay,e.endTimeOfDay],l=>{t.values=l.map(o)},v),t.on("thumb-change",a),t.on("thumb-drag",a),t.on("segment-drag",()=>{[e.startTimeOfDay,e.endTimeOfDay]=t.values.map(n)})],Q.Slider)}_renderTimeRangeSection(){const{visibleElements:e}=this;return e.timeRangeSlider||e.datePicker?r("section",{class:k.timeRange,key:"time-range"},r(ae,{level:this.headingLevel},this.messages.timeLabel),e.timeRangeSlider?this._renderTimeRange():null,e.datePicker?this._renderDatePicker():null):null}_renderTimeRange(){const{messages:e,viewModel:t,visibleElements:o}=this,{startTimeOfDay:n,endTimeOfDay:a}=t,[l,c]=[n,a].map(T=>He(new Date(T),rt));return[r("div",{class:k.timeRangeIndicator,key:"time-range-indicator"},be(e.timeRange,{start:l,end:c}),o.timezone?r(qe,{value:t.utcOffset,onChange:this._onTimezoneChange}):null),r("div",{afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved,bind:this,key:"time-slider-container"})]}_timeSliderContainerAfterCreate(e){var o;const t=(o=this._timeSlider)==null?void 0:o.container;t&&e.appendChild(t)}_timeSliderContainerAfterRemoved(e){var o;const t=(o=this._timeSlider)==null?void 0:o.container;t&&e.removeChild(t)}_renderDatePicker(){return r("div",{class:k.datePickerContainer,key:"date-picker"},r(je,{value:this.viewModel.date,onChange:this._onDateChange}))}_renderVisualizationOptionsSection(){const{headingLevel:e,messages:t,viewModel:o,visibleElements:n}=this,a=n.colorPicker,l=c=>this.classes(o.visualizationType===c?null:k.visualizationConfigHidden);return r("section",{class:k.visualization,key:"visualization"},r(ae,{level:e},t.visualizationLabel),this._renderVisualizationSelect(),r("div",{class:l(u.Threshold),key:"threshold-configurator"},r(S,{colorPickerVisible:a,options:o.thresholdOptions})),r("div",{class:l(u.Duration),key:"duration-configurator"},r(H,{colorPickerVisible:a,options:o.durationOptions})),r("div",{class:l(u.Discrete),key:"discrete-configurator"},r(x,{colorPickerVisible:a,options:o.discreteOptions})))}_renderVisualizationSelect(){const e=this.messages,t=this.viewModel.visualizationType;return r("calcite-select",{bind:this,class:k.visualizationSelect,key:"visualization-select",label:e.visualizationLabel,onCalciteSelectChange:this._onVisualizationTypeChange},[{type:u.Threshold,label:e.threshold.label},{type:u.Duration,label:e.duration.label},{type:u.Discrete,label:e.discrete.label}].map(({type:o,label:n})=>r("calcite-option",{selected:o===t,value:o},n)))}_onVisualizationTypeChange(e){var o;const t=(o=e.target.selectedOption)==null?void 0:o.value;this.viewModel.visualizationType=t??u.Threshold}};i([s()],_.prototype,"viewModel",void 0),i([s()],_.prototype,"view",null),i([s()],_.prototype,"headingLevel",void 0),i([s()],_.prototype,"iconClass",void 0),i([s()],_.prototype,"icon",void 0),i([s()],_.prototype,"label",null),i([s({type:ke,nonNullable:!0})],_.prototype,"visibleElements",void 0),i([s(),N("esri/widgets/ShadowCast/t9n/ShadowCast")],_.prototype,"messages",void 0),i([s()],_.prototype,"_defaultViewModel",void 0),i([s()],_.prototype,"_timeSlider",void 0),i([s()],_.prototype,"_tooltip",void 0),_=i([y("esri.widgets.ShadowCast")],_);const zt=_;export{zt as default};

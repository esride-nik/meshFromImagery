import{a5 as l,a6 as n,a9 as T,bA as A,cb as W,h3 as Z,eH as Y,_ as $,dZ as ee,bg as te,cj as V,cc as re,eW as se,nL as le}from"./index-b516d057.js";import{n as p,g as J,e as ie,O as ne,r as oe}from"./jsxFactory-92036771.js";import{h as K}from"./featureFormUtils-24147792.js";import{V as ae}from"./symbolUtils-b4f6caa2.js";import{e as de}from"./Heading-92f210ca.js";import{e as ue}from"./globalCss-94006b67.js";import{e as ce}from"./vmEvent-d773b6c5.js";var S;const pe="esri.widgets.FeatureTemplates.TemplateItem";let b=S=class extends A{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabled=!1,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(W(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},Z))}get description(){var e;return(e=this.template)==null?void 0:e.description}set description(e){this.template&&(this.template.description=e)}get label(){var e;return(e=this.template)==null?void 0:e.name}set label(e){this.template&&(this.template.name=e)}get id(){var e;return`${this.label??""}–${(e=this.layer)==null?void 0:e.id}`}get supportsUpload(){var e;return((e=this.layer)==null?void 0:e.type)==="scene"}clone(){const e=this.thumbnail!=null?this.thumbnail.cloneNode(!0):null,t=new S({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}static async fetchThumbnail(e,t){var i;const r=await me(e,t);if(r==null)return null;const s={maxSize:36};return((i=e.renderer)==null?void 0:i.type)==="dictionary"&&(s.fieldMap=e.renderer.fieldMap??void 0,s.feature={attributes:t.prototype.attributes??{}}),await ae(r,s)}};async function me(e,t){const{renderer:r}=e;if(r){const s=new Y({attributes:t.prototype.attributes}),i=await r.getSymbolAsync(s);if(i)return i}return he(e)}async function he(e){const{geometryType:t}=e,r=t==="point"||t==="multipoint"?await $(()=>import("./index-b516d057.js").then(s=>s.uG),["assets/index-b516d057.js","assets/index-b252abd2.css"]):t==="polyline"?await $(()=>import("./index-b516d057.js").then(s=>s.uE),["assets/index-b516d057.js","assets/index-b252abd2.css"]):t==="polygon"||t==="mesh"||t==="multipatch"?await $(()=>import("./index-b516d057.js").then(s=>s.uF),["assets/index-b516d057.js","assets/index-b252abd2.css"]):null;return r?new r.default:null}l([n()],b.prototype,"description",null),l([n()],b.prototype,"disabled",void 0),l([n()],b.prototype,"label",null),l([n()],b.prototype,"layer",void 0),l([n()],b.prototype,"template",void 0),l([n({readOnly:!0})],b.prototype,"thumbnail",void 0),l([n()],b.prototype,"id",null),l([n()],b.prototype,"supportsUpload",null),b=S=l([T(pe)],b);const x=b;let w=class extends ee(A){constructor(t){super(t),this.items=null,this.label=null}get id(){return this.label}findByTemplate(t){return this.items.find(r=>r.template===t)}};l([n()],w.prototype,"items",void 0),l([n()],w.prototype,"label",void 0),l([n()],w.prototype,"id",null),w=l([T("esri.widgets.FeatureTemplates.TemplateItemGroup")],w);const ye=w,j=e=>e==null||typeof e!="object"?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(t=>t.templates):[]];var C;const fe=({layer:e})=>({key:e,label:e.title??""}),be=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let h=C=class extends te.EventedAccessor{constructor(e){super(e),this._groupPool=new V(ye),this._itemPool=new V(x),this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null}initialize(){this._get("groupBy")||(this.groupBy="layer")}get _featureTemplatesByLayer(){if(!this.layers)return new Map;const e=new Map;for(const t of this.layers)if(t.type==="subtype-group")for(const r of t.sublayers)e.set(r,j(r));else e.set(t,j(t));return e}set groupBy(e){if(this._set("groupBy",e),typeof e!="function")switch(e){case"layer":this._groupByFunction=fe;break;case"geometry":this._groupByFunction=be;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}set layers(e){const t="layers";if(this.removeHandles(t),e){const r=()=>this.notifyChange("state");this.addHandles(e.map(s=>re(()=>s.loadStatus,r)),t)}this._set("layers",e)}get layers(){return this._get("layers")}get state(){const{layers:e}=this;return e&&e.length!==0?e.some(t=>t.loadStatus==="loading"||t.loadStatus==="not-loaded")?"loading":"ready":"disabled"}get numberOfFeatureTemplates(){return Array.from(this._featureTemplatesByLayer.values()).reduce((e,t)=>e+t.length,0)}get items(){var a,m,f;if(this.numberOfFeatureTemplates===0)return this._releasePreviousItems(),[];const e=this._featureTemplatesByLayer,t=[],r=this.filterFunction!=null?this.filterFunction:C._nullFilterFunction;for(const[d,c]of e)if(d.loaded||d.type==="subtype-sublayer"&&((a=d.parent)!=null&&a.loaded)){const o=(m=se(d))==null?void 0:m.operations;if(o!=null&&o.supportsEditing&&(o!=null&&o.supportsAdd))for(const y of c)t.push({layer:d,template:y,matchesFilter:r({label:y.name})})}if(this._groupByFunction==null){const d=t.filter(({matchesFilter:c})=>c).map(({template:c,layer:o})=>this._createItem(c,o));return this._releasePreviousItems(),d}const s=new Map;for(const d of t){const{template:c,layer:o}=d,y=this._groupByFunction({template:c,layer:o}),{key:_,label:v}=y.key!=null?y:C.nullGroupBy;s.has(_)||s.set(_,{label:v,templateItemInfos:[]}),(f=s.get(_))==null||f.templateItemInfos.push(d)}const i=[];for(const d of s.values()){const{label:c,templateItemInfos:o}=d,y=o.filter(({matchesFilter:v})=>v),_=r({label:c})?o:o.length>0?y:[];if(_.length>0){const v=_.map(({template:B,layer:L})=>this._createItem(B,L));i.push(this._createGroup(c,v))}}return i.length===1&&i[0].label===C.nullGroupBy.label?(this._releasePreviousItems(),i[0].items):(this._releasePreviousItems(),i)}refresh(){this.notifyChange("items")}select(e,{emit:t=!0}={}){const r=this.selectedItem,s=(e==null?void 0:e.clone())||null;this._set("selectedItem",s),t&&this.emit("select",{item:s,oldItem:r,template:(s==null?void 0:s.template)??null})}_createItem(e,t){var i;const r=this._itemPool.acquire(),s=((i=this.disabledItemFunction)==null?void 0:i.call(this,{template:e,layer:t}))??!1;return r.set({disabled:s,layer:t,template:e}),r}_createGroup(e,t){const r=this._groupPool.acquire();return r.set("label",e),r.items=t,r}_releasePreviousItems(){this._destroyItems(this._get("items"))}_destroyItems(e){e&&(e[0]instanceof x?e.forEach(t=>this._destroyItem(t)):e.forEach(t=>this._destroyGroup(t)))}_destroyGroup(e){e.items.forEach(t=>this._destroyItem(t)),e.items.length=0,this._groupPool.release(e)}_destroyItem(e){e.layer=null,e.template=null,this._itemPool.release(e)}_ensureGroupByObject(e){return typeof e=="string"?{key:e,label:e}:e}};h.nullGroupBy={key:Symbol(),label:"Other​"},h._nullFilterFunction=e=>!0,l([n()],h.prototype,"_featureTemplatesByLayer",null),l([n()],h.prototype,"_groupByFunction",void 0),l([n()],h.prototype,"disabled",void 0),l([n()],h.prototype,"disabledItemFunction",void 0),l([n()],h.prototype,"filterFunction",void 0),l([n()],h.prototype,"groupBy",null),l([n()],h.prototype,"layers",null),l([n()],h.prototype,"state",null),l([n({readOnly:!0})],h.prototype,"numberOfFeatureTemplates",null),l([n({readOnly:!0})],h.prototype,"items",null),l([n({readOnly:!0})],h.prototype,"selectedItem",void 0),h=C=l([T("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],h);const H=h,F="esri-item-list",E=`${F}__list-item`,g={base:F,filterContainerSticky:`${F}__filter-container--sticky`,group:`${F}__group`,groupHeader:`${F}__group__header`,item:E,itemDisabled:`${E}--disabled`,itemIcon:`${E}-icon`,itemContentEnd:`${E}-content-end`,noMatchesMessage:`${F}__no-matches-message`,scroller:`${F}__scroller`,scrollerEnabled:`${F}__scroller--enabled`},_e=4;function ge(e){const{disabled:t,filterText:r="",id:s,messages:i,onFilterChange:a,...m}=e;return p("div",{key:s},e.filterEnabled??1?Fe({disabled:t,filterText:r,id:s,messages:i,onFilterChange:a}):null,Ie({...m,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:r,messages:i}))}function ve(e){return!!e.items}function Ie(e){const{headingLevel:t,items:r,...s}=e;return r.length===0?p("div",{class:g.noMatchesMessage,key:"no-matches"},e.messages.noMatches):p("div",{class:J({[g.scroller]:!0,[g.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},r.map(i=>ve(i)?$e({...s,group:i,headingLevel:t}):Q({...s,grouped:!0,item:i})))}function Fe(e){const{disabled:t,messages:r,filterText:s,enableListScroll:i}=e;return p("div",{class:i?void 0:g.filterContainerSticky,key:"filter"},p("calcite-input",{disabled:t,placeholder:r.filterPlaceholder,type:"search",value:s,onCalciteInputInput:a=>{const m=a.currentTarget;e.onFilterChange&&e.onFilterChange(m.value)}}))}function Q(e){const{disabled:t,grouped:r,identify:s,item:i,onItemMouseEnter:a,onItemMouseLeave:m,onItemSelect:f,renderIcon:d,renderCustomItem:c,renderItemContent:o,renderItemContentEnd:y,renderItemLabel:_,renderItemDescription:v,selectedItem:B}=e,L=U(i,s),D=L===U(B,s),G=c==null?void 0:c(e);if(G)return G;const M=o==null?void 0:o(i),R=y==null?void 0:y(i),P=!(!i.disabled&&!t);return p("calcite-list-item",{afterUpdate:I=>{I.selected=D},"aria-level":r?"2":"",class:J({[g.item]:!0,[g.itemDisabled]:P}),"data-item":i,description:M?void 0:(v==null?void 0:v(i))??void 0,disabled:P,key:L,label:M?void 0:(_==null?void 0:_(i))??i.label??void 0,onmouseenter:I=>a==null?void 0:a(k(I)),onmouseleave:I=>m==null?void 0:m(k(I)),selected:D,tabIndex:P?-1:0,onCalciteListItemSelect:I=>{I.preventDefault(),f==null||f(k(I))}},p("div",{class:g.itemIcon,key:"content-start",slot:"content-start"},d==null?void 0:d(i)),M?p("div",{key:"content",slot:"content"},M):null,R?p("div",{class:g.itemContentEnd,key:"content-end",slot:"content-end"},R):null)}function U(e,t){return e?`${(t==null?void 0:t(e))||e.id}__${e.label}`:""}function k(e){return e.currentTarget["data-item"]}function $e(e){const{disabled:t,group:r,headingLevel:s=_e,selectionMode:i="none",renderCustomGroupContent:a,...m}=e,f=a==null?void 0:a(e);return p("div",{class:g.group,key:r.label??void 0},p(de,{class:g.groupHeader,level:s},r.label),f||p("calcite-list",{disabled:t,selectionAppearance:"border",selectionMode:i},r.items.map(d=>Q({...m,disabled:t,item:d,grouped:!0}))))}let O=class extends A{constructor(e){super(e),this.filter=!0}};l([n({type:Boolean,nonNullable:!0})],O.prototype,"filter",void 0),O=l([T("esri.widgets.FeatureTemplates.VisibleElements")],O);const X=O,z="esri-feature-templates",q={base:z,loader:`${z}__loader`};function we(e){return e.length>0&&K(e[0])}function Ce(e){return e.id}let u=class extends ne{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.selectionMode="none",this.viewModel=new H,this.visibleElements=new X,this.renderCustomItem=r=>null,this.renderCustomGroupContent=r=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=r=>null,this.renderItemContentEnd=r=>null,this._iconIntersectionObserver=new IntersectionObserver((r,s)=>{r.forEach(async i=>{if(i.isIntersecting){const a=i.target;if(Le(a))return void s.unobserve(a);const m=Te(a),{layer:f,template:d}=m;N(a,!0);const c=await x.fetchThumbnail(f,d).catch(()=>(N(a,!1),null));if(c==null)return;a.appendChild(c)}})}),this._renderItemIcon=r=>le(r.layer)?p("span",{"data-has-icon":!0,"data-item":r,key:"icon"},p("calcite-icon",{icon:"table"})):p("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":r,key:"icon"}),this._afterItemCreateOrUpdate=r=>{var s;(s=this._iconIntersectionObserver)==null||s.observe(r)},this._afterItemRemoved=r=>{var s;(s=this._iconIntersectionObserver)==null||s.unobserve(r)}}initialize(){const e=({label:t})=>!this.filterText||!!(t!=null&&t.toLowerCase().includes(this.filterText.toLowerCase()));this.addHandles(W(()=>this.viewModel,(t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)},Z))}destroy(){var e;(e=this._iconIntersectionObserver)==null||e.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return oe({icon:()=>$(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),input:()=>$(()=>import("./calcite-input-f0ebb300.js"),["assets/calcite-input-f0ebb300.js","assets/input-9795a695.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/progress-2100df13.js"]),list:()=>$(()=>import("./calcite-list-2b87684c.js"),["assets/calcite-list-2b87684c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/observers-9c654f26.js","assets/utils3-c1eb0197.js","assets/loadable-7d42c3de.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/input-9795a695.js","assets/form-60623048.js","assets/label2-0071fcd4.js","assets/component-7281ffa6.js","assets/progress-2100df13.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js","assets/scrim-41a5f26e.js"]),"list-item":()=>$(()=>import("./calcite-list-item-acd56289.js"),["assets/calcite-list-item-acd56289.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/utils3-c1eb0197.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/action-79a6733c.js","assets/guid-2347ca41.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/handle-d29406b2.js"]),notice:()=>$(()=>import("./calcite-notice-ae448cb5.js"),["assets/calcite-notice-ae448cb5.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/openCloseComponent-3fbda1cf.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"])})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:r,headingLevel:s,messages:i,viewModel:{items:a,numberOfFeatureTemplates:m,selectedItem:f,state:d}}=this,c=this.visibleElements.filter&&m>1;if(we(a)){const o=a.find(y=>y.label===H.nullGroupBy.label);o&&(o.label=i.other)}return p("div",{"aria-label":i.widgetLabel,class:this.classes(q.base,ue.widget)},d==="loading"?this._renderLoader():d==="ready"?p(ge,{disabled:e,enableListScroll:t,filterEnabled:c,filterText:r,headingLevel:s,id:this.id,identify:Ce,items:a,messages:{filterPlaceholder:i.filterPlaceholder,noItems:i.noItems,noMatches:i.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:f??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:o=>{this.filterText=o,this.viewModel.refresh()},onItemSelect:o=>!K(o)&&this.viewModel.select(o)}):null)}_renderLoader(){return p("div",{class:q.loader,key:"loader"})}};function Te(e){return e==null?void 0:e["data-item"]}function Le(e){return!!(e!=null&&e["data-has-icon"])}function N(e,t){e&&(e["data-has-icon"]=t)}l([n()],u.prototype,"disabled",null),l([n()],u.prototype,"enableListScroll",void 0),l([n()],u.prototype,"filterFunction",null),l([n()],u.prototype,"filterText",void 0),l([n()],u.prototype,"groupBy",null),l([n()],u.prototype,"headingLevel",void 0),l([n()],u.prototype,"label",null),l([n()],u.prototype,"layers",null),l([n(),ie("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],u.prototype,"messages",void 0),l([n({readOnly:!0})],u.prototype,"selectedItem",null),l([n()],u.prototype,"selectionMode",void 0),l([n(),ce("select")],u.prototype,"viewModel",void 0),l([n({type:X,nonNullable:!0})],u.prototype,"visibleElements",void 0),l([n()],u.prototype,"renderCustomItem",void 0),l([n()],u.prototype,"renderCustomGroupContent",void 0),l([n()],u.prototype,"renderItemLabel",void 0),l([n()],u.prototype,"renderItemDescription",void 0),l([n()],u.prototype,"renderItemContent",void 0),l([n()],u.prototype,"renderItemContentEnd",void 0),u=l([T("esri.widgets.FeatureTemplates")],u);const Me=u,De=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{De as F,Me as M,H as h,Q as m,ge as o,j as t};

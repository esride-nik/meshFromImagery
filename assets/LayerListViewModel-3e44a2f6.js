import{V as f,bg as g,cb as d,h3 as y,a5 as o,a6 as h,a9 as M}from"./index-b516d057.js";import{k as b}from"./ListItem-5ca108fc.js";import{y as I,i as V}from"./layerListUtils-a0f5e0ab.js";const a={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},E="hide",H=f.ofType(b);let l=class extends g.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new H,this.view=null}initialize(){this.addHandles([d(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready]},()=>this._viewHandles(),y),d(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],a.view)}destroy(){this.view=null,this.operationalItems.removeAll()}get state(){const{view:e}=this;return e!=null&&e.ready?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){var u,_;const r=e==null?void 0:e.layer;if(!r)return;const n=(_=(u=this.view)==null?void 0:u.map)==null?void 0:_.layers,m=t?I(t):n,c=i?I(i):n;if(!m||!c)return;const{operationalItems:p}=this,v=(t==null?void 0:t.children)||p,w=(i==null?void 0:i.children)||p,L=c.length-s;e.parent=i||null,v.includes(e)&&v.remove(e),m.includes(r)&&m.remove(r),w.includes(e)||w.add(e,L),c.includes(r)||c.add(r,L)}_createLayerViewHandles(e){this.removeHandles(a.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),a.layerViews)}_createMapLayerHandles(e){this.removeHandles(a.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),a.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s}=this;return new b({checkPublishStatusEnabled:s,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(e){if(e)return e.filter(t=>V(t)!==E)}_watchLayersListMode(e){this.removeHandles(a.layerListMode),e&&e.forEach(t=>{"listMode"in t&&this.addHandles(d(()=>t.listMode,()=>this._compileList()),a.layerListMode)})}_compileList(){var i,s;const e=(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.layers;this._watchLayersListMode(e);const t=this._getViewableLayers(e);t!=null&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.find(s=>s.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:t}=this,i=[];t.forEach(s=>{s&&e&&e.includes(s.layer)||i.push(s)}),t.removeMany(i)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,s)=>{const r=e.indexOf(i.layer),n=e.indexOf(s.layer);return r>n?-1:r<n?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([a.mapLayers,a.layerViews,a.viewLayers]),this._recompileList(),e&&e.ready&&this.addHandles([d(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.allLayers},t=>this._createMapLayerHandles(t),y),d(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},t=>this._createLayerViewHandles(t),y)],a.viewLayers)}};o([h()],l.prototype,"checkPublishStatusEnabled",void 0),o([h()],l.prototype,"listItemCreatedFunction",void 0),o([h({type:H})],l.prototype,"operationalItems",void 0),o([h({readOnly:!0})],l.prototype,"state",null),o([h()],l.prototype,"view",void 0),l=o([M("esri.widgets.LayerList.LayerListViewModel")],l);const C=l;export{C as y};

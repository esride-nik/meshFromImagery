import{a5 as u,a6 as d,a9 as A,bA as W,dY as et,U as tt,v as q,p as re,bh as ve,cs as nt,aC as it,s as be,X as st,dB as at,j as rt,eH as ze,e3 as ot,dm as lt,dw as ut,aK as oe,al as xe,bn as dt,cb as D,kn as k,an as j,h3 as pt,eW as Ee,hF as ct,bg as ht,b9 as Ie,aH as Re,aI as mt,lF as ft,gX as Te,gs as yt,_ as x,h1 as le,py as gt,gY as _t,gZ as vt,pz as $e,pA as ne,pB as ue,pC as de,pD as Ae,pE as bt,pF as Ct}from"./index-b516d057.js";import{e as ie,O as Ft,r as Vt,n as g}from"./jsxFactory-92036771.js";import{d as B,A as wt,_ as Ce,O as xt,c as K,j as Et,T as pe,b as It,E as Oe,f as ee,L as ke,k as Rt,y as ce,g as Le,C as Tt,S as $t,U as At}from"./featureFormUtils-24147792.js";import{h as Ke}from"./UpdatingHandles-7949a657.js";import{n as Me,y as Ot}from"./FeatureLayerBase-0746b503.js";import{o as kt}from"./editableLayers-856f2cb4.js";import{i as Lt,l as Mt,q as De}from"./FieldInput-8449e312.js";import{n as Se,b as Ne,m as he}from"./TimeOnly-879c5107.js";import{t as Dt}from"./ImmutableArray-ee1d0ce7.js";import St from"./FeatureLayer-c4c5819f.js";import{F as Nt}from"./FeatureRelationshipViewModel-9f00674c.js";import{J as jt}from"./featureUtils-73b624d6.js";import{e as je}from"./globalCss-94006b67.js";import{e as Gt,n as Pt}from"./Heading-92f210ca.js";import{e as Ut}from"./vmEvent-d773b6c5.js";const $="esri-feature-form",me=`${$}__group`,G=`${$}__input`,fe=`${$}__related-records`,F={base:$,form:`${$}__form`,formHeader:`${$}__form-header`,label:`${$}__label`,labelTextContent:`${$}__label-text-content`,fieldInput:`${G}`,inputRadio:`${G}--radio`,inputRadioGroup:`${G}--radio-group`,inputRadioLabel:`${G}--radio-label`,inputDisabled:`${G}--disabled`,inputSwitch:`${G}--switch`,inputInvalid:`${G}--invalid`,centeredButton:`${$}__centered-button`,description:`${$}__description-text`,listObserver:`${$}__list-observer`,relatedRecordsHeader:`${fe}_header`,relatedRecordsLabel:`${fe}_label`,relatedRecordsList:`${fe}_list`,dateInputContainer:`${`${$}__date`}-input-container`,group:me,groupSequential:`${me}--sequential`,groupActive:`${me}--active`};let U=class extends W{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.codedValue=null}};u([d()],U.prototype,"objectType",void 0),u([d()],U.prototype,"maxValue",void 0),u([d()],U.prototype,"minValue",void 0),u([d()],U.prototype,"codedValue",void 0),U=u([A("esri.layers.support.ContingentValue")],U);const I=U;let H=class extends W{constructor(t){super(t),this.isRetired=!1}};u([d()],H.prototype,"id",void 0),u([d()],H.prototype,"isRetired",void 0),u([d()],H.prototype,"subtype",void 0),u([d()],H.prototype,"values",void 0),H=u([A("esri.layers.support.Contingency")],H);const Ge=H;let X=class extends W{constructor(t){super(t)}};u([d()],X.prototype,"fieldGroup",void 0),u([d()],X.prototype,"type",void 0),X=u([A("esri.layers.support.ContingencyConstraintViolation")],X);const Pe=X;let Q=class extends W{constructor(e){super(e)}};u([d()],Q.prototype,"contingentValuesAllGroups",void 0),u([d()],Q.prototype,"contingentValuesByFieldGroup",void 0),Q=u([A("esri.layers.support.ContingentValuesResult")],Q);const Ht=Q;let Z=class extends W{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};u([d()],Z.prototype,"name",void 0),u([d()],Z.prototype,"fields",void 0),u([d()],Z.prototype,"isEditingRestrictive",void 0),u([d()],Z.prototype,"contingencies",void 0),Z=u([A("esri.layers.support.FieldGroup")],Z);const Fe=Z;var S;let N=S=class extends et(tt){constructor(e){super(e),this.request=q,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get subtypeFieldName(){const{layer:e}=this;return e.type==="subtype-group"?e.subtypeField:e.typeIdField}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(e.layerId===void 0)return null;const n=t.hasContingentValuesDefinition;if(n)return new S({layer:e}).load();if(n===void 0){const s=re(e.url);if(s==null)return null;const i=s.url.path;if((await S._staticFetchEnterpriseFeatureRoot(i)).supportsQueryDataElements){const a=e.layerId.toString(),r=await S._staticFetchEnterpriseFieldGroup(i,a);if(r){const o=r.map(l=>({name:l.name,isEditingRestrictive:l.isEditingRestrictive,fields:l.fieldNames.names.map(c=>e.fieldsIndex.normalizeFieldName(c))}));return new S({layer:e,fieldGroupDefinitions:o}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const n=Object.keys(e),s=[],i=[];for(const a of this.fieldGroups){const r=a.isEditingRestrictive?"error":"warning";if(t&&!a.fields.some(p=>t.includes(p)))continue;if(!a.fields.every(p=>n.includes(p))){i.push(new Pe({fieldGroup:a,type:r}));continue}let o=!1;const l=e[this.subtypeFieldName],c=a.contingencies.filter(p=>!(!p.isRetired&&p.subtype)||p.subtype.code===l);for(const p of c){let h=!0;for(const m in p.values){const f=p.values[m];if(f.objectType!=="any"){if(f.objectType==="null"){if(e[m]!=null){h=!1;break}}else if(f.objectType==="code"){if(e[m]!==f.codedValue.code){h=!1;break}}else if(f.objectType==="range"){const y=e[m];if(y<f.minValue||y>f.maxValue){h=!1;break}}}}if(h){o=!0;break}}o||s.push(new Pe({fieldGroup:a,type:r}))}return{invalid:s,incomplete:i}}getContingentValues(e,t,n=!1){const s=e[this.subtypeFieldName],i=s!=null,a={};let r=[];const o=this.fieldGroups.filter(l=>l.fields.includes(t));r.push(new I({objectType:"any"}));for(const l of o){let c=[];const p=l.contingencies.filter(f=>!(f.isRetired||f.subtype&&i&&f.subtype.code!==s));let h=!1;const m={};for(const f of p){let y,_=!0;for(const b in f.values){const C=f.values[b];if(t!==b){if(e[b]!==void 0&&C.objectType!=="any"){if(C.objectType==="null")e[b]!==null&&(_=!1);else if(C.objectType==="code")e[b]!==C.codedValue.code&&(_=!1);else if(C.objectType==="range"){const R=e[b];(R<C.minValue||R>C.maxValue)&&(_=!1)}}}else y=C,h=h||C.objectType==="range"}if(y&&_){if(y.objectType==="any"){c.length=0,c.push(y);break}const b=this._generateKey(y);m[b]||c.push(y),m[b]=!0}}h&&(c=this._joinRange(c)),a[l.name]=c,r=n?this._filterIntersection(r,c):[]}return o.length===1&&n&&(r=[]),new Ht({contingentValuesAllGroups:r,contingentValuesByFieldGroup:a})}_generateKey(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}_joinRange(e){let t,n;e.sort((i,a)=>i.objectType==="null"?-1:a.objectType==="null"?1:i.minValue-a.minValue);const s=[];for(const i of e)i.objectType!=="null"?t!=null&&n!=null?n<i.minValue?(s.push(new I({objectType:"range",minValue:t,maxValue:n})),t=i.minValue,n=i.maxValue):n<i.maxValue&&(n=i.maxValue):(t=i.minValue,n=i.maxValue):s.push(i);return s.push(new I({objectType:"range",minValue:t,maxValue:n})),s}_filterIntersection(e,t){var i,a;if(e.length===0||t.length===0)return[];if(e[0].objectType==="any")return t;if(t[0].objectType==="any")return e;const n=e[0].objectType==="range"||((i=e[1])==null?void 0:i.objectType)==="range",s=t[0].objectType==="range"||((a=t[1])==null?void 0:a.objectType)==="range";return n||s?this._intersectRanges(e,t):this._intersectValues(e,t)}_intersectRanges(e,t){const n=[];let s,i=0;for(const a of e)for(;i<t.length;i++){const r=t[i];if(a.objectType==="null"&&r.objectType==="null")n.push(new I({objectType:"null"}));else{if(a.objectType==="null")break;if(r.objectType==="null")continue}if(a.maxValue<r.minValue)break;if(a.maxValue===r.minValue){n.push(new I({objectType:"range",minValue:a.maxValue,maxValue:r.minValue}));break}if(!(a.minValue>r.maxValue))if(a.minValue!==r.maxValue){if(s=a.minValue>r.minValue?a.minValue:r.minValue,a.maxValue<r.maxValue){n.push(new I({objectType:"range",minValue:s,maxValue:a.maxValue}));break}n.push(new I({objectType:"range",minValue:s,maxValue:r.maxValue}))}else n.push(new I({objectType:"range",minValue:a.minValue,maxValue:r.maxValue}))}return n}_intersectValues(e,t){const n=[];for(const s of e)t.some(i=>{if(s.objectType===i.objectType)switch(s.objectType){case"any":case"null":return!0;case"code":return s.codedValue.code===i.codedValue.code&&s.codedValue.name===i.codedValue.name}return!1})&&n.push(s);return n}static async _staticFetchEnterpriseFeatureRoot(e,t){return q(e,{responseType:"json",query:{f:"json"},...t}).then(n=>n.data)}static async _staticFetchEnterpriseFieldGroup(e,t,n){return q(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(s=>{var i;return(i=s.data.layerDataElements)==null?void 0:i[0].dataElement.fieldGroups})}async _initializeContingentValues(e,t){const n=e??await this._fetchFieldGroupDefs(t);if(n.length===0)return void(this.fieldGroups=[]);const s=await this._fetchContingentValues(n,t);this.fieldGroups=s}async _fetchFieldGroupDefs(e){if(this.layer.layerId===void 0)return[];const t=this.layer.sourceJSON,n=this.layer.layerId.toString(),s=re(this.layer.url).url.path;return t.hasContingentValuesDefinition?(await this._fetchAGOLFieldGroup(s,n,e)).map(i=>({name:i.name,isEditingRestrictive:i.restrictive,fields:i.fields.map(a=>this.layer.fieldsIndex.normalizeFieldName(a))})):t.hasContingentValuesDefinition!==void 0?[]:this._fetchEnterpriseFeatureRoot(s,e).then(async i=>i.supportsQueryDataElements?(await this._fetchEnterpriseFieldGroup(s,n,e)).map(a=>({name:a.name,isEditingRestrictive:a.isEditingRestrictive,fields:a.fieldNames.names.map(r=>this.layer.fieldsIndex.normalizeFieldName(r))})):[])}async _fetchAGOLFieldGroup(e,t,n){return q(`${e}/${t}/fieldgroups`,{responseType:"json",query:{f:"json"},...n}).then(s=>s.data.fieldGroups)}async _fetchEnterpriseFieldGroup(e,t,n){return S._staticFetchEnterpriseFieldGroup(e,t,n)}async _fetchEnterpriseFeatureRoot(e,t){return S._staticFetchEnterpriseFeatureRoot(e,t)}async _fetchContingentValues(e,t){if(this.layer.layerId===void 0)return[];const n=this.layer.sourceJSON,s=this.layer.layerId.toString(),i=re(this.layer.url).url.path;if(n.hasContingentValuesDefinition){const r=await this._fetchAGOLContingentValues(i,s,t);return this._constructFieldGroupsAGOL(e,r)}const a=await this._fetchEnterpriseContingentValues(i,s,t);return this._constructFieldGroupsEnterprise(e,a)}_constructFieldGroupsAGOL(e,t){return e.map(n=>{const s=t.contingentValuesDefinition.fieldGroups.find(i=>i.name===n.name);if(s){let i=[];return i=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(n,t,s.subTypes):this._parseAGOLFieldGroup(n,t,s.contingentValues),new Fe({name:n.name,isEditingRestrictive:n.isEditingRestrictive,fields:n.fields,contingencies:i})}return null}).filter(ve)}_parseAGOLFieldGroupSubtype(e,t,n){let s=[];return n==null||n.forEach(i=>{const a=this._getSubtypeAGOL(i.name);s=s.concat(this._parseAGOLFieldGroup(e,t,i.contingentValues,a))}),s}_parseAGOLFieldGroup(e,t,n,s=null){const i=[];for(const a of n??[]){const r=this._parseAGOLContingency(a,e,t,s);i.push(r)}return i}_parseAGOLContingency(e,t,n,s){const i=e.id,a=!!e.retired&&e.retired===1,r={};for(let o=0,l=0;o<t.fields.length;o++){const c=t.fields[o],p=n.typeCodes[e.types[o]];if(p==="Code"){let h=e.values[l];l++;const m=this._getDomain(s,c),f=this.layer.getField(c);if((f==null?void 0:f.type)==="string"){const b=n.stringDicts.find(C=>C.domain===(m==null?void 0:m.name));b&&(h=b.entries[h])}const y=m==null?void 0:m.codedValues.find(b=>b.code===h),_=new I({codedValue:y,objectType:"code"});r[c]=_}else if(p==="Range"){const h=e.values[l];l++;const m=h.range[0],f=h.range[1],y=new I({minValue:m,maxValue:f,objectType:"range"});r[c]=y}else if(p==="Any"){const h=new I({objectType:"any"});r[c]=h}else{const h=new I({objectType:"null"});r[c]=h}}return new Ge({id:i,isRetired:a,subtype:s,values:r})}_constructFieldGroupsEnterprise(e,t){const n=t.fieldGroups;return e.map(s=>{const i=n.find(a=>a.name===s.name);if(i){const a=i.contingencies.map(r=>{const o=r.id,l=r.isRetired||!1,c=this._getSubtypeEnterprise(r.subtypeCode),p={};for(let h=0;h<s.fields.length;h++){const m=s.fields[h];let f=r.values[h];if(typeof f=="number"||typeof f=="string"){const y=this._getDomain(c,m),_=this.layer.getField(m);nt(_)?f=t.stringDictionary[f]:it(_)&&(f=new Date(`${f}+00:00`).getTime());const b=y==null?void 0:y.codedValues.find(R=>R.code===f),C=new I({codedValue:b,objectType:"code"});p[m]=C}else if(typeof f=="object"){const y=f.minValue,_=f.maxValue,b=new I({minValue:y,maxValue:_,objectType:"range"});p[m]=b}else if(f){const y=new I({objectType:"any"});p[m]=y}else{const y=new I({objectType:"null"});p[m]=y}}return new Ge({id:o,isRetired:l,subtype:c,values:p})});return new Fe({name:s.name,isEditingRestrictive:s.isEditingRestrictive,fields:s.fields,contingencies:a})}return null}).filter(ve)}async _fetchEnterpriseContingentValues(e,t,n){return q(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...n}).then(s=>{var i;return(i=s.data.contingentValueSets)==null?void 0:i[0]})}async _fetchAGOLContingentValues(e,t,n){return q(`${e}/${t}/contingentValues`,{responseType:"json",query:{f:"json"},...n}).then(s=>s.data)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const s=t.subtypes.find(i=>i.code===e);n=Me.fromJSON(s)}return n||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let n;if(t.subtypes){const s=t.subtypes.find(i=>i.name===e);n=Me.fromJSON(s)}return n||null}_findDomainByFieldName(e,t){const n=e.domains;if(n){const[s,i]=Object.entries(n).find(([a])=>a.trim().toLowerCase()===t.trim().toLowerCase())||[];return i||null}return null}_getDomain(e,t){const n=e?this._findDomainByFieldName(e,t):this.layer.getFieldDomain(t);return(n==null?void 0:n.type)==="inherited"?this.layer.getFieldDomain(t):n}};u([d({constructOnly:!0})],N.prototype,"layer",void 0),u([d({constructOnly:!0})],N.prototype,"request",void 0),u([d({type:[Fe]})],N.prototype,"fieldGroups",void 0),u([d({constructOnly:!0})],N.prototype,"fieldGroupDefinitions",void 0),u([d()],N.prototype,"subtypeFieldName",null),N=S=u([A("esri.layers.support.LayerContingentValuesCache")],N);const Zt=N;let te=null;function Bt(e,t,n,s={}){const i=t.elementType,a="value",r=i.type==="array"?[{name:a,type:i.type,elementType:i.elementType}]:i.type==="dictionary"?[{name:a,type:i.type,properties:i.properties}]:[{name:a,type:i.type}];return new Dt(e.map(o=>{const l={};return Ve(l,r,{[a]:o},n,s),l[a]}))}function Wt(e,t,n={}){const s=e instanceof ot?new St({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return t.constructFeatureSet(s,n.spatialReference,null,!0,n.lruCache,n.interceptor)}function qt(e,t,n={}){const{spatialReference:s,interceptor:i,lruCache:a}=n;return typeof e=="string"?t.createFeatureSetCollectionFromService(e,s,a,i):t.createFeatureSetCollectionFromMap(e,s,a,i)}function zt(e,t,n,s={}){const i={};return Ve(i,t.properties,e,n,s),new te.Dictionary(i)}function Ve(e,t,n,s,i={}){const a={};for(const r of Object.keys(n))a[r.toLowerCase()]=n[r];for(const r of t){const o=r.name.toLowerCase();if(i.variablesPreProcessed)e[o]=a[o];else switch(r.type){case"array":{const l=a[o];e[o]=l==null?null:Bt(l,r,s,i);break}case"feature":{const l=a[o];e[o]=l==null?null:te.Feature.createFromGraphic(l,i==null?void 0:i.timeZone);break}case"featureSet":{const l=a[o];e[o]=l==null?null:s?Wt(l,s,i):null;break}case"featureSetCollection":{const l=a[o];e[o]=l==null?null:s?qt(l,s,i):null;break}case"dictionary":{const l=a[o];e[o]=l==null?null:zt(l,r,s,i);break}case"date":{const l=a[o];e[o]=l?l instanceof he?l:i!=null&&i.timeZone?he.dateJSAndZoneToArcadeDate(l,i==null?void 0:i.timeZone):he.dateJSToArcadeDate(l):null;break}case"dateOnly":{const l=a[o];e[o]=l?l instanceof Ne?l:Ne.fromReader(l):null;break}case"time":{const l=a[o];e[o]=l?l instanceof Se?l:Se.fromReader(l):null;break}case"geometry":case"boolean":case"text":case"number":e[o]=a[o]}}}function Je(e,t){for(const n of e)t.push(n),n.type==="dictionary"&&Je(n.properties,t);return t}function Ue(e,t,n,s,i){const{spatialReference:a,interceptor:r,lruCache:o,console:l,abortSignal:c,timeZone:p,services:h={portal:rt.getDefault()}}=n,m={vars:{},spatialReference:a,interceptor:r,timeZone:p,lrucache:o,useAsync:i,services:h,console:l,abortSignal:c};return t&&Ve(m.vars,e.variables,t,s,n),m}function ae(e,t){switch(t.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{const n=(e.type,e),s="geometry"in n?n.geometry():null,i="readAttributes"in n?n.readAttributes():n.attributes;return new ze({geometry:s,attributes:i})}case"dictionary":{const n=e,s=n.attributes,i={};for(const a of Object.keys(s))i[a]=ae(n.field(a),t);return i}case"array":return("toArray"in e?e.toArray():e).map(n=>ae(n,t))}return e}const He={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"}]},Ze={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"}]},Be=new Map([["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"}]}],["popup",He],["popup-element",He],["feature-reduction-popup",Ze],["feature-reduction-popup-element",Ze],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"}]}]}]]);function Kt(e){const t=Be.get(e);if(!t){const n=Array.from(Be.keys()).map(s=>`'${s}'`).join(", ");throw new be("createArcadeProfile:invalid-profile-name",`Invalid profile name '${e}'. You must specify one of the following values: ${n}`)}return st(t)}async function Jt(e,t,n={}){te||(te=await at());const{arcade:s,arcadeUtils:i}=te,{loadScriptDependencies:a,referencesMember:r,scriptIsAsync:o}=s,l=Je(t.variables,[]),c=l.filter(E=>E.type==="featureSet"||E.type==="featureSetCollection").map(E=>E.name.toLowerCase()),p=s.parseScript(e,c);if(!p)throw new be("arcade:invalid-script","Unable to create SyntaxTree");const h=i.extractFieldNames(p),m=s.scriptTouchesGeometry(p),f=l.map(E=>E.name.toLowerCase()).filter(E=>r(p,E)),y=o(p,c);await a(p,y,c);const _={vars:{},spatialReference:null,useAsync:y};for(const E of f)_.vars[E]="any";const{lruCache:b}=n,C=s.compileScript(p,_),R=s.featureSetUtils(),{services:O}=n;return{execute:(E,J={})=>{if(y)throw new be("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const Y=C(Ue(t,E,{lruCache:b,...J},R,y));return J.rawOutput?Y:ae(Y,i)},executeAsync:async(E,J={})=>{const Y=await C(Ue(t,E,{lruCache:b,services:O,...J},R,y));return J.rawOutput?Y:ae(Y,i)},isAsync:y,variablesUsed:f,fieldsUsed:h,geometryUsed:m,syntaxTree:p}}var Ye;const Yt=Symbol("FormExpressionArcadeExecutor");let T=class extends W{constructor(t){super(t),this[Ye]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._stale=!1,this._updatingTracking=new Ke,this._executeAsyncDebounced=lt(async(n,s,i)=>{const a=await this.executor.executeAsync(n,{...s,abortSignal:i});return i.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=a,this._stale=!1,a)})}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(t,n){this._abortController=new AbortController;const s=this.executor.execute(t,{...n,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=s,s}async executeAsync(t,n){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(t,n??{},this._abortController.signal))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}};Ye=Yt,u([d()],T.prototype,"_lastEvaluatedValue",void 0),u([d()],T.prototype,"_stale",void 0),u([d()],T.prototype,"_updatingTracking",void 0),u([d({constructOnly:!0})],T.prototype,"executor",void 0),u([d()],T.prototype,"isAsync",null),u([d()],T.prototype,"fieldsUsed",null),u([d()],T.prototype,"syntaxTree",null),u([d()],T.prototype,"updating",null),u([d()],T.prototype,"stale",null),u([d()],T.prototype,"geometryUsed",null),u([d()],T.prototype,"variablesUsed",null),u([d()],T.prototype,"lastEvaluatedValue",null),T=u([A("esri.widgets.FeatureForm.FormExpressionArcadeExecutor")],T);const Xt=async(e,t)=>{const n=Kt("form-calculation"),s=await Jt(e,n,{});return t!=null&&t.fieldsIndex&&(s.fieldsUsed=ut(t.fieldsIndex,s.fieldsUsed)),new T({executor:s})},ye="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY",Qt="esri.widgets.FeatureForm.FormExpressionsManager";let L=class extends W{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _baseContext(){const{editType:e,layer:t,map:n,originalFeature:s,spatialReference:i,timeZone:a}=this.arcadeContextInfo,r=(t==null?void 0:t.type)==="feature"?t:(t==null?void 0:t.type)==="scene"&&t.associatedLayer!=null?t.associatedLayer:void 0;return[{$originalfeature:s,$editcontext:{editType:e},$layer:r,$featureset:r,$datastore:t==null?void 0:t.url,$map:n},{rawOutput:!0,spatialReference:i??void 0,timeZone:a}]}set feature(e){this._latestFieldValues={...e==null?void 0:e.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:n,feature:s}=this,i=new Set;for(const a of e)if(n[a]=s.getAttribute(a),t.has(a))for(const r of t.get(a))i.add(r);return this._evaluate([...i])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(ye))return this._evaluate([...this._fieldReferencesLookup.get(ye)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){var o;const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:n,preserveFieldValuesWhenHidden:s}=this,i=new Map(this.fieldInputs.map(l=>[l.name,l])),a=s===!1,r=new Map(n.map(l=>[l,new Array]));for(const l of n){for(const c of l.fieldsUsed){oe(e,c,()=>new Set).add(l);const p=i.get(c);[p==null?void 0:p.valueExpressionExecutor,p==null?void 0:p.editableExpressionExecutor,a?(o=p==null?void 0:p.group)==null?void 0:o.visibilityExpressionExecutor:null,a?p==null?void 0:p.visibilityExpressionExecutor:null].filter(h=>h!=null&&h!==l).forEach(h=>{r.get(h).push(l),oe(t,h,()=>new Set).add(p)})}l.geometryUsed&&oe(e,ye,()=>new Set).add(l)}return r}async _evaluate(e){const t=new Map,{_dependencyGraph:n,_fieldsAffectedLookup:s,_latestFieldValues:i}=this;for(const r of e)Xe(r,t,n);for(const[r,{resolver:o,dependencyPromises:l}]of t)Promise.all(l).then(async()=>{const[c,p]=this._makeContext(i);return r.executeAsync(c,p)}).then(()=>{if(s.has(r))for(const c of s.get(r))this._latestFieldValues[c.name]=c.value;o.resolve()},c=>{!c||xe(c)||We(c)||r.markStale(),o.reject(c)});const a=(await Promise.allSettled(Array.from(t.values(),({resolver:r})=>r.promise))).filter(r=>r.status==="rejected"&&!(xe(r.reason)||We(r.reason)));if(a.length>0)throw new AggregateError(a,"One or more expression executions failed")}_makeContext(e){const[t,n]=this._baseContext,s=this.feature.clone();return s.attributes=e,[{...t,$feature:s},n]}};u([d()],L.prototype,"_baseContext",null),u([d()],L.prototype,"feature",null),u([d({constructOnly:!0})],L.prototype,"preserveFieldValuesWhenHidden",void 0),u([d()],L.prototype,"executors",void 0),u([d()],L.prototype,"fieldInputs",void 0),u([d()],L.prototype,"arcadeContextInfo",void 0),L=u([A(Qt)],L);const Xe=(e,t,n)=>{if(t.has(e))return;const s=dt();t.set(e,{resolver:s,dependencyPromises:[]}),e.abort();const i=n.get(e);for(const a of i)Xe(a,t,n),t.get(a).dependencyPromises.push(s.promise)},We=e=>e&&typeof e=="object"&&"message"in e&&e.message==="Cancelled";let M=class extends Lt{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.type="group"}initialize(){this.addHandles([D(()=>[this.visible,this.inputs],([e])=>{const{inputs:t}=this,n=!!e&&void 0;for(const s of t)B(s)&&(s.required=n)},{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}set inputFields(e){k(j.getLogger(this),"inputFields",{replacement:"inputs",version:"4.27",warnOnce:!0}),this.inputs=e}get inputFields(){return k(j.getLogger(this),"inputFields",{replacement:"inputs",version:"4.27",warnOnce:!0}),this.inputs}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(t=>D(()=>t.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get label(){return this.element.label}set label(e){const{element:t}=this;t&&(t.label=e)}get open(){return this.initialState==="expanded"}set open(e){this._override("open",e)}get state(){return k(j.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open?"expanded":"collapsed"}set state(e){k(j.getLogger(this),"state",{replacement:"open",version:"4.28",warnOnce:!0}),this.open=e==="expanded"}get visible(){return this.evaluatedVisibilityExpression!==!1&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};u([d()],M.prototype,"initialState",null),u([d()],M.prototype,"inputs",null),u([d()],M.prototype,"label",null),u([d()],M.prototype,"open",null),u([d()],M.prototype,"type",void 0),u([d()],M.prototype,"visible",null),M=u([A("esri.widgets.FeatureForm.GroupInput")],M);const en=M,tn=3;let V=class extends Mt{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([D(()=>({feature:this.feature,element:this.element,layer:this.layer}),t=>this._createRelationshipVM(t),pt)])}destroy(){var e;(e=this._relationshipVM)==null||e.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,relationship:n}=this;if(!n||!this.loaded||!this.relatedLayerAllowsAdds)return!1;const{cardinality:s,role:i}=n;return!(s==="one-to-one"&&t>0)&&s!=="many-to-many"&&!(s==="one-to-many"&&i==="destination"&&t>0)&&e}get displayCount(){return this.element.displayCount??tn}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){var e;return((e=this._relationshipVM)==null?void 0:e.featureCount)??0}get loaded(){var e;return((e=this._relationshipVM)==null?void 0:e.state)!=="loading"}get map(){return this._get("map")}set map(e){var t;e&&((t=this._relationshipVM)==null||t.set("map",e)),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){var e;return(e=this._relationshipVM)==null?void 0:e.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){var r;const{_relationshipVM:e,timeZone:t}=this;if(!((r=e==null?void 0:e.relatedFeatures)!=null&&r.length)||!(e!=null&&e.relatedLayer))return[];const{itemDescriptionFieldName:n,relatedFeatures:s,relatedLayer:i}=e,a=i&&"formTemplate"in i&&i.formTemplate?i.formTemplate.title:void 0;return s.map(o=>{let l;if(n){const c=o.getAttribute(n),p=i.fieldsIndex.get(n);if(p){const h=wt({values:[c],fields:[p],timeZone:t??void 0})[n];h!=null&&(l=h.toString())}}return{feature:o,description:l,title:a?Ce({label:a,attributes:o.attributes,fieldsIndex:i.fieldsIndex,timeZone:t}):void 0}}).toArray()}get relatedLayer(){var e;return(e=this._relationshipVM)==null?void 0:e.relatedLayer}get relatedLayerIsTable(){var e;return!!((e=this.relatedLayer)!=null&&e.isTable)}get relatedLayerAllowsAdds(){var n;const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const t=Ee(e);return!!((n=t==null?void 0:t.operations)!=null&&n.supportsAdd)}get relatedLayerAllowsEdits(){var n;const{relatedLayer:e}=this;if(!e)return!1;const t=Ee(e);return!!((n=t==null?void 0:t.operations)!=null&&n.supportsEditing)}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){var t;(t=this._relationshipVM)==null||t.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return t!=="many-to-many"&&(this.evaluatedVisibilityExpression!=null?this.evaluatedVisibilityExpression:this.element!=null)}get updating(){var e,t;return((e=this._relationshipVM)==null?void 0:e.state)==="loading"||((t=this._relationshipVM)==null?void 0:t.state)==="querying"}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){var t;return(t=this._relationshipVM)==null?void 0:t.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){var c;const{feature:t,element:n,layer:s}=e;if((c=this._relationshipVM)==null||c.destroy(),!t||!n||!s)return;const{displayCount:i,map:a,orderByFields:r,relationshipId:o,showAllEnabled:l}=this;jt(s)&&(this._relationshipVM=new Nt({graphic:t,displayCount:i,layer:s,map:a,orderByFields:r,relationshipId:o,showAllEnabled:l}))}};u([d()],V.prototype,"_relationshipVM",void 0),u([d()],V.prototype,"canAddRelatedFeature",null),u([d()],V.prototype,"displayCount",null),u([d()],V.prototype,"displayType",null),u([d()],V.prototype,"editable",null),u([d()],V.prototype,"featureCount",null),u([d()],V.prototype,"group",void 0),u([d()],V.prototype,"loaded",null),u([d()],V.prototype,"map",null),u([d()],V.prototype,"orderByFields",null),u([d()],V.prototype,"originHasValidKey",null),u([d()],V.prototype,"relationship",null),u([d()],V.prototype,"relationshipId",null),u([d()],V.prototype,"relatedFeatureInfos",null),u([d()],V.prototype,"relatedLayer",null),u([d()],V.prototype,"relatedLayerIsTable",null),u([d()],V.prototype,"relatedLayerAllowsAdds",null),u([d()],V.prototype,"relatedLayerAllowsEdits",null),u([d()],V.prototype,"showAllEnabled",null),u([d()],V.prototype,"showAllActionVisible",null),u([d({readOnly:!0})],V.prototype,"type",void 0),u([d()],V.prototype,"visible",null),u([d()],V.prototype,"updating",null),V=u([A("esri.widgets.FeatureForm.RelationshipInput")],V);const nn=V,ge=new ze({attributes:{}}),sn=["editableExpression","requiredExpression","valueExpression","visibilityExpression"],an=["visibilityExpression"],rn=["editableExpression","visibilityExpression"],on="#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",z="#JSAPI_CONTINGENT_VALUE_ANY_HASH",ln="#JSAPI_CONTINGENT_VALUE_NULL_HASH",we="esri.widgets.FeatureForm.FeatureFormViewModel",se=j.getLogger(we);let v=class extends ct(ht.EventedAccessor){constructor(t){super(t),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=ge.clone(),this._initialFeature=ge.clone(),this._timeZone=null,this._updatingHandles=new Ke,this.arcadeEditType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.relatedRecordCallbacks=null,this.strict=!1}initialize(){const t=D(()=>{var i;return[this.layer,!!((i=this.layer)!=null&&i.loaded),this.formTemplate,this.feature,this.timeZone,this.arcadeEditType]},async([i,a])=>{i!=null&&(a?this._updatingHandles.addPromise(this._updateInputs()):i.load().catch(()=>{}))},{equals:([i,a,r,o,l,c],[p,h,m,f,y,_])=>i===p&&a===h&&r===m&&o===f&&l===y&&c===_,initial:!0}),n=D(()=>this._arcadeContextInfo,i=>{this._expressionsManager!=null&&(this._expressionsManager.arcadeContextInfo=i,this._updatingHandles.addPromise(this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())))}),s=D(()=>this.layer,i=>{const a=(i==null?void 0:i.type)==="subtype-sublayer"?i.parent:(i==null?void 0:i.type)==="feature"?i:null;a&&this.addResolvingPromise(Zt.createLoadedLayerContingentValuesCache(a).then(r=>{this._contingentValuesCache=r,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([t,n,s])}destroy(){var t;this.feature=null,this.layer=null,this._contingentValuesCache=Ie(this._contingentValuesCache),(t=this.highlightHelper)==null||t.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){var t,n;return new Map((n=(t=this.formTemplate)==null?void 0:t.expressionInfos)==null?void 0:n.map(s=>[s.name,s]))}get activeRelationshipInput(){return this.allRelationshipInputs.find(t=>t.relationshipId===this.relationshipId)}get _arcadeContextInfo(){const{_initialFeature:t,arcadeEditType:n,layer:s,map:i,spatialReference:a,timeZone:r}=this;return{layer:kt(s)?s:null,originalFeature:t,editType:n,map:i,spatialReference:a,timeZone:r}}get allFieldInputs(){return xt(this.inputs)}get allGroupInputs(){return this.inputs.filter(K)}get allRelationshipInputs(){return Et(this.inputs)}get _layerFieldsByName(){var t;return new Map((t=this.layer)==null?void 0:t.fields.map(n=>[n.name,n]))}get feature(){return this._get("feature")}set feature(t){this._featureClone=t?t.clone():ge.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),t?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(n=>n.feature=t)):(this.inputs.forEach(n=>n.destroy()),this.inputs.length=0),this.contingencyConstraintViolations.clear(),this._set("feature",t)}get fieldsWithContingentValues(){if(this._contingentValuesCache==null)return new Set;const t=this._contingentValuesCache.fieldGroups.flatMap(n=>n.fields);return new Set(t)}get fieldsWithInvalidCodedValue(){const t=this.allFieldInputs;return new Set(t.filter(n=>{const{name:s,domain:i,value:a}=n;if((i==null?void 0:i.type)==="coded-value"){const r=this.getFieldValueOptionsForField(s);return a!=null&&a!==""&&!r.flat().some(o=>o.value===a)}return!1}))}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(t){t===void 0?this._clearOverride("formTemplate"):this._override("formTemplate",t)}get formDescription(){const{formTemplate:t,layer:n}=this;return t!=null&&t.description&&n?Ce({label:t.description,attributes:this.getValues(),fieldsIndex:n.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:t,layer:n}=this;return t!=null&&t.title&&n?Ce({label:t.title,attributes:this.getValues(),fieldsIndex:n.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:t,formDescription:n,formTitle:s}=this;return!(t||!n&&!s)}set inputFields(t){k(se,"inputFields",{replacement:"FeatureFormViewModel.inputs",version:"4.27"}),this.inputs=t}get inputFields(){return k(se,"inputFields",{replacement:"FeatureFormViewModel.inputs",version:"4.27"}),this.inputs}get joinedContingentValues(){return this._joinContingentValues()}get layer(){var t;return(t=this.feature)!=null&&t.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(t){this._override("layer",t)}get relationshipId(){return this._get("relationshipId")}set relationshipId(t){const n=this.allRelationshipInputs;if(t!=null&&t===this.relationshipId||n.forEach(s=>s.showAllEnabled=!1),t!=null){const s=n.find(i=>i.relationshipId===t);s&&(s.showAllEnabled=!0)}this._set("relationshipId",t)}get spatialReference(){var t;return((t=this.layer)==null?void 0:t.spatialReference)??null}set spatialReference(t){this._override("spatialReference",t)}get state(){var t;return(t=this.layer)!=null&&t.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(t=>!t.valid).every(({submittable:t})=>t)}get timeZone(){const{layer:t}=this;if(t&&"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone)return Re;const n=t&&"preferredTimeZone"in t&&t.preferredTimeZone;return this._timeZone===mt?n||Re:this._timeZone||ft}set timeZone(t){this._timeZone=t}get updating(){return this._updatingHandles.updating}get valid(){const t=this.allFieldInputs;return t.length>0&&t.every(({valid:n})=>n)}get view(){return k(se,"view",{replacement:"FeatureForm.map",version:"4.27"}),this._get("view")}set view(t){k(se,"view",{replacement:"FeatureForm.map",version:"4.27"}),this._set("view",t),t!=null&&t.map&&(this.map=t.map)}findField(t){return this.allFieldInputs.find(n=>n.name===t)}getFieldValueOptionsForField(t,n){var r;const s=this.findField(t);if(!s)return[[],[]];const i=((r=s.domain)==null?void 0:r.type)==="coded-value"?s.domain.codedValues.map(({name:o,code:l})=>({name:o,value:l})):[],a=this.fieldsWithContingentValues.has(t)?this._getContingentValueOptionsForField(t,n):[];if(a.length>0){const o=new Set(a.map(l=>l.value));return[a,i.filter(l=>!o.has(l.value))]}return[i,[]]}getValue(t){const{_featureClone:n,layer:s}=this,i=!!(s!=null&&s.getField(t));return n.getAttribute(t)??(i?null:void 0)}setValue(t,n){const{_featureClone:s,strict:i}=this,a=this.findField(t);n=n===""?null:n,a&&s.getAttribute(t)!==n&&(a.value=n,i&&!a.valid||(this._afterValueChange(a),this._expressionsManager!=null&&this._updatingHandles.addPromise(this._expressionsManager.evaluateInvalidated([a.name]).finally(()=>this._afterExpressionsEvaluated()))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(t){this._initialFeature=t}submit(){const t=this.allFieldInputs,n=new Set(t.filter(a=>a.valid).map(({name:a})=>a)),s=t.filter(a=>!a.valid).map(({name:a})=>a),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[a,r]of this.contingencyConstraintViolations.entries())r.type==="error"&&(n.delete(a),s.push(a));this.emit("submit",{valid:[...n],invalid:s,values:i})}validateContingencyConstraints(t,n){const{_contingentValuesCache:s}=this,i=new Map;if(this.contingencyConstraintViolations=i,s==null)return[];const{invalid:a,incomplete:r}=s.validateContingencyConstraints(t),o=[...a,...n!=null&&n.includeIncompleteViolations?r:[]];for(const l of o)for(const c of l.fieldGroup.fields)i.set(c,l);return o}notifyFeatureGeometryChanged(){const{_expressionsManager:t,feature:n,_featureClone:s}=this;s.geometry=n.geometry,t!=null&&this._updatingHandles.addPromise(t.evaluateInvalidatedByGeometry().finally(()=>this._afterExpressionsEvaluated()))}_emitChangeEvent({name:t,valid:n,value:s}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:t,value:s,valid:n})}async _updateInputs(){this._stopExpressions();const{_featureClone:t,_initialFeature:n,arcadeEditType:s,formTemplate:i,inputs:a,layer:r,timeZone:o}=this;if(!r)return;const l={arcadeEditType:s,feature:t,initialFeature:n,layer:r,timeZone:o},c=a.slice(),p=i!=null&&i.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(c,i.elements,l):this._updateInputsUsingLayerFields(c,r==null?void 0:r.fields,l);this.inputs=p,await this._startExpressions()}async _updateInputsUsingFormElements(t,n,s){const i=new Map;for(const o of t)if(K(o)){i.set(o.element,o);for(const l of o.inputs)l.element&&i.set(l.element,l)}else o.element&&i.set(o.element,o);const a=new Map,r=this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:n.filter(qe),sharedInitializationProperties:s,group:null,newExpressionExecutorPromises:a});for(const[o,l]of i.entries())i.delete(o),l.destroy();return await Promise.all(Array.from(a.values())),r}_updateInputsUsingFormElementsRecursive(t){const{existingInputsByElement:n,updatedElements:s,sharedInitializationProperties:i,group:a,newExpressionExecutorPromises:r}=t,o=[];for(const l of s){const c=n.has(l),p=c?n.get(l):pe(l)?this._makeGroupInputFromElement(l,i):It(l)?this._makeFieldInputFromElement(l,i,a):Oe(l)?this._makeRelationshipInputFromElement(l,i,a):null;if(p){if(o.push(p),this._assignExpressionExecutors(p,l,r),c)if(n.delete(l),K(p)){const{feature:h,timeZone:m}=i;p.set({feature:h,timeZone:m})}else if(ee(p)){const h=this.relationshipId===l.relationshipId;p.set(i),p.set({map:this.map,showAllEnabled:h})}else p.set(i);if(pe(l)){const h=l.elements.filter(m=>qe(m));p.inputs=this._updateInputsUsingFormElementsRecursive({existingInputsByElement:n,updatedElements:h,sharedInitializationProperties:i,group:p,newExpressionExecutorPromises:r})}}}return o}_updateInputsUsingLayerFields(t,n,s){var h;if(!Array.isArray(n))return j.getLogger(this).warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const m of t)if(K(m)){for(const f of m.inputs)f.destroy();m.inputs.length=0,m.destroy()}else ee(m)?m.destroy():B(m)&&(m.element!==null?m.destroy():i.set(m.field,m));const a=[],{arcadeEditType:r,feature:o,initialFeature:l,layer:c,timeZone:p}=s;for(const m of n){const f=i.get(m)??new De({arcadeEditType:r,field:m,feature:o,initialFeature:l,layer:c,value:(o==null?void 0:o.getAttribute(m.name))??null,preservesValueWhenHidden:(h=this.formTemplate)==null?void 0:h.preserveFieldValuesWhenHidden,timeZone:p});a.push(f),i.delete(m)}for(const[m,f]of i.entries())i.delete(m),f.destroy();return a}_resetFieldInputValues(t){for(const n of this.allFieldInputs)n.value=t.getAttribute(n.name)}_makeFieldInputFromElement(t,n,s){var h;const{arcadeEditType:i,feature:a,initialFeature:r,layer:o,timeZone:l}=n,{fieldName:c}=t,p=c&&this._layerFieldsByName.get(c);return p?new De({arcadeEditType:i,element:t,field:p,value:(a==null?void 0:a.getAttribute(t.fieldName))??null,feature:a,initialFeature:r,layer:o,group:s,preservesValueWhenHidden:(h=this.formTemplate)==null?void 0:h.preserveFieldValuesWhenHidden,timeZone:l}):null}_makeGroupInputFromElement(t,n){const{feature:s,layer:i}=n;return new en({element:t,inputs:[],feature:s,layer:i})}_makeRelationshipInputFromElement(t,n,s=null){const{map:i}=this,{feature:a,layer:r,timeZone:o}=n;return new nn({element:t,feature:a,group:s,layer:r,map:i,timeZone:o})}_assignExpressionExecutors(t,n,s){var r;const i=pe(n)?an:Oe(n)?rn:sn,a=[];for(const o of i){const l=`${o}Executor`;if(t[l]){this._useExecutor(t[l]);continue}const c=n[o],{_expressionExecutorLookup:p}=this;if(c!=null&&c!==""){const h=((r=this._expressionInfosLookup.get(c))==null?void 0:r.expression)??c;if(p.has(h))t[l]=this._useExecutor(p.get(h));else if(s.has(h)){const m=s.get(h).then(f=>(t[l]=f,f));s.set(h,m)}else{const m=Xt(h,this.layer).then(f=>(t[l]=this._useExecutor(f),p.set(h,f),f));s.set(h,m)}}}return a}_createExpressionsManager(t){const{_arcadeContextInfo:n,_featureClone:s,allFieldInputs:i,formTemplate:a}=this;this._expressionsManager=new L({executors:t,feature:s,arcadeContextInfo:n,fieldInputs:i,preserveFieldValuesWhenHidden:(a==null?void 0:a.preserveFieldValuesWhenHidden)===!0})}async _startExpressions(){if(this._expressionExecutorsInUse.size===0)return;const t=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(t),await this._expressionsManager.evaluateAll().finally(()=>this._afterExpressionsEvaluated())}_stopExpressions(){this._expressionsManager=Ie(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(t){return this._expressionExecutorsInUse.add(t),t}_afterValueChange(t){var p;const{name:n,value:s}=t,{_featureClone:i,formTemplate:a,layer:r}=this;if(!r)return;const o=i.getAttribute(n);i.setAttribute(n,s);const{typeFieldName:l,types:c}=ke(r);if(n===l&&s!==o){if(r.type==="subtype-sublayer"){const m=(p=r.parent)==null?void 0:p.findSublayerForFeature(i);i.sourceLayer=this.feature.sourceLayer=m}const h=new Set;for(const m of c)if(m.domains&&typeof m.domains=="object")for(const f of Object.keys(m.domains))h.add(f);for(const m of h){const f=this.findField(m);f&&f.notifyChange("domain")}}if(a!=null){const{description:h,title:m}=a;m&&Te(m,n)&&this.notifyChange("formTitle"),h&&Te(h,n)&&this.notifyChange("formDescription")}this._emitChangeEvent(t)}_afterExpressionsEvaluated(){const{_featureClone:t}=this;for(const n of this.allFieldInputs)n.value!==t.getAttribute(n.name)&&this._afterValueChange(n)}_joinContingentValues(){const t=this._contingentValuesCache;if(t==null)return[];const{typeFieldName:n}=ke(this.layer),s=n?this.getValue(n):null,i=[];for(const o of t.fieldGroups){const{contingencies:l,fields:c,name:p}=o,h=[];for(const m of l)m.isRetired||m.subtype!=null&&m.subtype.code!==s||h.push({values:m.values});h.length>0&&i.push({name:p,fields:c,contingencies:h})}const[a,r]=this._generateJoinPlan(i);return[...a.flatMap(o=>this._joinFieldGroupContingencies(o)),...r.flatMap(o=>o.contingencies)]}_generateJoinPlan(t){const n=new Map,s=[],i=new Set;for(const c of t)for(const p of c.fields)if(n.has(p)){const h=n.get(p),m=c,f=[h.name,m.name].sort().join("|");if(i.has(f))continue;s.push([h,m]),i.add(f),n.set(p,m)}else n.set(p,c);const a=new Set(s.flat()),r=new Set(t);for(const c of a)r.delete(c);const o=new Map,l=new Map;for(const c of new Set(s.flat())){const p=Symbol(c.name);o.set(p,new Set([c])),l.set(c,p)}for(const[c,p]of s){const h=l.get(c),m=l.get(p);if(h===m)continue;const f=o.get(h),y=o.get(m);for(const _ of y)f.add(_),l.set(_,h);o.delete(m)}return[[...o.values()].map(c=>[...c]),[...r]]}_joinFieldGroupContingencies(t){var c,p;const n=t.slice(),s=n.shift();let i=n.shift(),a=this._generateJoinKey(s.fields,i.fields),r=new Set([...s.fields,...i.fields]),o=new Map;for(const h of s.contingencies){const[m]=this._hashContingency(h,a.codedValueFields,!0);o.has(m)?(c=o.get(m))==null||c.push(h):o.set(m,[h])}for(;n.length>0;){const h=new Map,m=n.shift(),f=this._generateJoinKey(r,m.fields);for(const y of i.contingencies){const[_,b]=this._hashContingency(y,a.codedValueFields),C=b?this._findMatchingContingenciesWithAnyHashMask(o,_):o.get(_);if(o.has(z)&&(C==null||C.push(...this._findMatchingContingenciesContainingAny(y,o.get(z),a.codedValueFields))),C!=null)for(const R of C){const O=a.rangeFields.length>0?this._joinContingenciesWithRangeDomains(R,y,a.rangeFields):this._joinContingencies(R,y);if(O==null)break;const[E]=this._hashContingency(O,f.codedValueFields,!0);h.has(E)?(p=h.get(E))==null||p.push(O):h.set(E,[O])}}o=h,i=m,a=f,r=new Set([...r,...i.fields])}const l=[];for(const h of i.contingencies){const[m,f]=this._hashContingency(h,a.codedValueFields),y=f?this._findMatchingContingenciesWithAnyHashMask(o,m):o.get(m);if(o.has(z)&&y.push(...this._findMatchingContingenciesContainingAny(h,o.get(z),a.codedValueFields)),y!=null)for(const _ of y){const b=a.rangeFields.length>0?this._joinContingenciesWithRangeDomains(_,h,a.rangeFields):this._joinContingencies(_,h);b!=null&&l.push(b)}}return l}_joinContingencies(t,n){const s={values:{...t.values,...n.values}};for(const[i,a]of Object.entries(s.values))a.objectType==="any"&&t.values[i]!=null&&(s.values[i]=t.values[i]);return s}_joinContingenciesWithRangeDomains(t,n,s){const i=this._joinContingencies(t,n);for(const a of s){const r=t.values[a],o=n.values[a],{leftIsNull:l,rightIsNull:c,bothAreNull:p,leftIsAny:h,rightIsAny:m,bothAreAny:f,leftIsRange:y,rightIsRange:_}=this._compareObjectTypes(r.objectType,o.objectType);if(p||f)continue;if(l&&m||c&&h){i.values[a]=new I({objectType:"null"});continue}if(l&&_||c&&y)return null;h?(r.minValue=-1/0,r.maxValue=1/0):m&&(o.minValue=-1/0,o.maxValue=1/0);const b=Math.max(r.minValue,o.minValue),C=Math.min(r.maxValue,o.maxValue);if(b>C)return null;i.values[a]=new I({objectType:"range",minValue:b,maxValue:C})}return i}_findMatchingContingenciesContainingAny(t,n,s){return n.filter(i=>s.every(a=>{var l,c;const r=i.values[a],o=t.values[a];return r.objectType==="any"||o.objectType==="any"||((l=r.codedValue)==null?void 0:l.code)===((c=o.codedValue)==null?void 0:c.code)}))}_findMatchingContingenciesWithAnyHashMask(t,n){const s=RegExp(`${n}$`),i=[];for(const[a,r]of t){if(a===z)break;s.test(a)&&i.push(...r)}return i}_generateJoinKey(t,n){var c;const s=Array.isArray(t)?new Set(t):t,i=Array.isArray(n)?new Set(n):n,a=s.size<i.size?s:i,r=a===s?i:s,o=new Set,l=new Set;for(const p of a)if(r.has(p)){const h=(c=this.layer)==null?void 0:c.getFieldDomain(p,{feature:this.feature});if(h==null)continue;switch(h.type){case"coded-value":o.add(p);break;case"range":l.add(p)}}return{codedValueFields:[...o],rangeFields:[...l]}}_contingencyIsValid(t,n){const s={};for(const{name:i,value:a}of this.allFieldInputs)this.fieldsWithContingentValues.has(i)&&a!=null&&i!==t&&(s[i]=a);return Object.entries(s).every(([i,a])=>!n.values.hasOwnProperty(i)||Rt(a,n.values[i]))}_getContingentValueOptionsForField(t,n){const s=this.joinedContingentValues.slice(),i=new Map,a={code:"",name:n??"No value"};for(const r of s){const o=r.values[t];if((o==null?void 0:o.objectType)==="code"||(o==null?void 0:o.objectType)==="null"){const{code:l,name:c}=o.codedValue&&o.objectType!=="null"?o.codedValue:a;!i.has(l)&&this._contingencyIsValid(t,r)&&i.set(l,{name:c,value:l})}}return[...i.values()]}_hashContingency(t,n,s=!1){var r;if(n.length<1)return[on,!1];const i=[];let a=!1;for(const o of n){const l=t.values[o];if(l.objectType==="any"){if(s)return[z,!0];a=!0,i.push(`${o}:.*`)}else l.objectType==="null"?i.push(`${o}:${ln}`):i.push(`${o}:${(r=l.codedValue)==null?void 0:r.code}`)}return[i.sort().join("&"),a]}_compareObjectTypes(t,n){return{leftIsNull:t==="null",rightIsNull:n==="null",bothAreNull:t==="null"&&n==="null",leftIsAny:t==="any",rightIsAny:n==="any",bothAreAny:t==="any"&&n==="any",leftIsRange:t==="range",rightIsRange:n==="range"}}};function qe(e){return e.type==="field"||e.type==="group"||e.type==="relationship"||(j.getLogger(we).warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}u([d()],v.prototype,"_expressionInfosLookup",null),u([d()],v.prototype,"_featureClone",void 0),u([d()],v.prototype,"_timeZone",void 0),u([d()],v.prototype,"activeRelationshipInput",null),u([d()],v.prototype,"_arcadeContextInfo",null),u([d()],v.prototype,"allFieldInputs",null),u([d()],v.prototype,"allGroupInputs",null),u([d()],v.prototype,"allRelationshipInputs",null),u([d()],v.prototype,"_layerFieldsByName",null),u([d()],v.prototype,"arcadeEditType",void 0),u([d()],v.prototype,"contingencyConstraintViolations",void 0),u([d()],v.prototype,"disabled",void 0),u([d()],v.prototype,"feature",null),u([d()],v.prototype,"fieldsWithContingentValues",null),u([d()],v.prototype,"fieldsWithInvalidCodedValue",null),u([d({type:Ot})],v.prototype,"formTemplate",null),u([d()],v.prototype,"formDescription",null),u([d()],v.prototype,"formTitle",null),u([d()],v.prototype,"formHeaderVisible",null),u([d()],v.prototype,"highlightHelper",void 0),u([d()],v.prototype,"inputs",void 0),u([d()],v.prototype,"inputFields",null),u([d()],v.prototype,"joinedContingentValues",null),u([d()],v.prototype,"layer",null),u([d()],v.prototype,"map",void 0),u([d()],v.prototype,"relatedRecordCallbacks",void 0),u([d()],v.prototype,"relationshipId",null),u([d()],v.prototype,"spatialReference",null),u([d()],v.prototype,"state",null),u([d()],v.prototype,"strict",void 0),u([d()],v.prototype,"submittable",null),u([d()],v.prototype,"timeZone",null),u([d()],v.prototype,"updating",null),u([d()],v.prototype,"valid",null),u([d()],v.prototype,"view",null),u([d()],v.prototype,"getValues",null),u([d()],v.prototype,"submit",null),v=u([A(we)],v);const un=v,P="data-field-name",Qe="esri.widgets.FeatureForm",_e=j.getLogger(Qe);let w=class extends Ft{constructor(e,t){super(e,t),this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(n=>{n.length&&n[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new un,this._onShowAllRelatedRecordsClick=n=>{const{feature:s,relatedRecordCallbacks:i}=this;s&&(i!=null&&i.showAllRelatedRecords)&&i.showAllRelatedRecords({parentFeature:s,relationshipId:n})},this._onAddRelatedRecordsClick=(n,s)=>{const{feature:i,relatedRecordCallbacks:a}=this;i&&(a!=null&&a.addRelatedRecord)&&a.addRelatedRecord({parentFeature:i,relatedLayer:s,relationshipId:n})},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([D(()=>this.feature,()=>{yt(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._inputsWithChanges.clear(),this._dateComponentMap.clear(),this._syncGroupInputStates(),this._focusedFieldName=(e==null?void 0:e.name)||null,this._attemptFocusOnNextRender=!0})}),D(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(n=>this._inputsWithChanges.add(n)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),D(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange())])}loadDependencies(){return Vt({block:()=>x(()=>import("./calcite-block-0b12426c.js"),["assets/calcite-block-0b12426c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/interactive-39956fb6.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/Heading-2d7d203c.js","assets/loadable-7d42c3de.js","assets/openCloseComponent-3fbda1cf.js","assets/action-79a6733c.js","assets/guid-2347ca41.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/action-menu-8419d112.js","assets/array-755a0ace.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/FloatingArrow-9e5c8eb0.js","assets/handle-d29406b2.js","assets/scrim-41a5f26e.js"]),button:()=>x(()=>import("./calcite-button-5457cec5.js"),["assets/calcite-button-5457cec5.js","assets/button-27a2f99e.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/component-7281ffa6.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js"]),combobox:()=>x(()=>import("./calcite-combobox-7d2cf661.js"),["assets/calcite-combobox-7d2cf661.js","assets/combobox-234207ac.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/floating-ui-a6c9d5df.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/openCloseComponent-3fbda1cf.js","assets/t9n-622f279b.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/chip-9ebcd4a3.js","assets/conditionalSlot-11b5e54d.js","assets/icon-c122f720.js"]),"combobox-item":()=>x(()=>import("./calcite-combobox-item-961b0328.js"),["assets/calcite-combobox-item-961b0328.js","assets/combobox-item-3b86c430.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/utils2-4f8e00b8.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),"combobox-item-group":()=>x(()=>import("./calcite-combobox-item-group-2ec33958.js"),["assets/calcite-combobox-item-group-2ec33958.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js","assets/utils2-4f8e00b8.js"]),icon:()=>x(()=>import("./calcite-icon-39deb8ae.js"),["assets/calcite-icon-39deb8ae.js","assets/icon-c122f720.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js"]),input:()=>x(()=>import("./calcite-input-f0ebb300.js"),["assets/calcite-input-f0ebb300.js","assets/input-9795a695.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/progress-2100df13.js"]),"input-date-picker":()=>x(()=>import("./calcite-input-date-picker-be6375cd.js"),["assets/calcite-input-date-picker-be6375cd.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/openCloseComponent-3fbda1cf.js","assets/t9n-622f279b.js","assets/Heading-2d7d203c.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/guid-2347ca41.js","assets/input-9795a695.js","assets/progress-2100df13.js"]),"input-message":()=>x(()=>import("./calcite-input-message-ce6b5be4.js"),["assets/calcite-input-message-ce6b5be4.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/icon-c122f720.js","assets/observers-9c654f26.js"]),"input-number":()=>x(()=>import("./calcite-input-number-0916b1b5.js"),["assets/calcite-input-number-0916b1b5.js","assets/input-number-9c00b0ee.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/progress-2100df13.js"]),"input-time-picker":()=>x(()=>import("./calcite-input-time-picker-b892fc00.js"),["assets/calcite-input-time-picker-b892fc00.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/observers-9c654f26.js","assets/Heading-2d7d203c.js","assets/t9n-622f279b.js","assets/math-d5d87794.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/openCloseComponent-3fbda1cf.js","assets/action-79a6733c.js","assets/loader-ea663d25.js","assets/input-9795a695.js","assets/progress-2100df13.js","assets/popover-33772892.js","assets/floating-ui-a6c9d5df.js","assets/debounce-7cc294e2.js","assets/FloatingArrow-9e5c8eb0.js"]),"input-time-zone":()=>x(()=>import("./calcite-input-time-zone-cdeb96ce.js"),["assets/calcite-input-time-zone-cdeb96ce.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/jsxFactory-92036771.js","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js","assets/interactive-39956fb6.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/form-60623048.js","assets/chip-9ebcd4a3.js","assets/conditionalSlot-11b5e54d.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/combobox-234207ac.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/floating-ui-a6c9d5df.js","assets/guid-2347ca41.js","assets/openCloseComponent-3fbda1cf.js","assets/utils2-4f8e00b8.js","assets/combobox-item-3b86c430.js"]),label:()=>x(()=>import("./calcite-label-4966fb24.js"),["assets/calcite-label-4966fb24.js","assets/label-fe92b4f9.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/label2-0071fcd4.js"]),list:()=>x(()=>import("./calcite-list-2b87684c.js"),["assets/calcite-list-2b87684c.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/observers-9c654f26.js","assets/utils3-c1eb0197.js","assets/loadable-7d42c3de.js","assets/filter2-4b1b51ca.js","assets/debounce-7cc294e2.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/icon-c122f720.js","assets/input-9795a695.js","assets/form-60623048.js","assets/label2-0071fcd4.js","assets/component-7281ffa6.js","assets/progress-2100df13.js","assets/loader-ea663d25.js","assets/guid-2347ca41.js","assets/scrim-41a5f26e.js"]),"list-item":()=>x(()=>import("./calcite-list-item-acd56289.js"),["assets/calcite-list-item-acd56289.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/interactive-39956fb6.js","assets/utils3-c1eb0197.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/t9n-622f279b.js","assets/loadable-7d42c3de.js","assets/action-79a6733c.js","assets/guid-2347ca41.js","assets/component-7281ffa6.js","assets/icon-c122f720.js","assets/loader-ea663d25.js","assets/handle-d29406b2.js"]),loader:()=>x(()=>import("./calcite-loader-7e936043.js"),["assets/calcite-loader-7e936043.js","assets/loader-ea663d25.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/guid-2347ca41.js"]),notice:()=>x(()=>import("./calcite-notice-ae448cb5.js"),["assets/calcite-notice-ae448cb5.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/conditionalSlot-11b5e54d.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/t9n-622f279b.js","assets/openCloseComponent-3fbda1cf.js","assets/component-7281ffa6.js","assets/icon-c122f720.js"]),"radio-button":()=>x(()=>import("./calcite-radio-button-9a0f442a.js"),["assets/calcite-radio-button-9a0f442a.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/array-755a0ace.js","assets/form-60623048.js","assets/guid-2347ca41.js","assets/interactive-39956fb6.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),"radio-button-group":()=>x(()=>import("./calcite-radio-button-group-92cfb8fc.js"),["assets/calcite-radio-button-group-92cfb8fc.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js"]),switch:()=>x(()=>import("./calcite-switch-d026b1cc.js"),["assets/calcite-switch-d026b1cc.js","assets/switch-bf0dca96.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/interactive-39956fb6.js","assets/key-c2c83cc7.js","assets/label2-0071fcd4.js","assets/loadable-7d42c3de.js"]),"text-area":()=>x(()=>import("./calcite-text-area-172484c0.js"),["assets/calcite-text-area-172484c0.js","assets/jsxFactory-92036771.js","assets/index-b516d057.js","assets/index-b252abd2.css","assets/uuid-709b6c67.js","assets/form-60623048.js","assets/label2-0071fcd4.js","assets/locale-2cb18332.js","assets/key-c2c83cc7.js","assets/observers-9c654f26.js","assets/loadable-7d42c3de.js","assets/t9n-622f279b.js","assets/interactive-39956fb6.js","assets/guid-2347ca41.js","assets/throttle-e5413962.js","assets/debounce-7cc294e2.js"])})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const e=this.relatedRecordCallbacks;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get relatedRecordCallbacks(){return this.viewModel.relatedRecordCallbacks}set relatedRecordCallbacks(e){this.viewModel.relatedRecordCallbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get view(){return k(_e,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view}set view(e){k(_e,"view",{replacement:"Use FeatureForm.map instead.",version:"4.27"}),this.viewModel.view=e}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return g("div",{class:this.classes(F.base,je.widget,je.panel)},e==="ready"?this._renderForm():null)}_renderForm(){return g("form",{class:F.form,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderHeader(),this._renderContent())}_renderHeader(){const e=this.viewModel;if(!e.formHeaderVisible)return;const t=e.formTitle!=null&&g(Gt,{key:"title",level:this.headingLevel},e.formTitle),n=e.formDescription!=null&&g("p",{class:F.description,key:"description"},e.formDescription);return g("div",{class:F.formHeader},t,n)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderActiveRelationshipInput(e.activeRelationshipInput):e.inputs.filter(ve).filter(t=>t.visible).map((t,n)=>K(t)?this._renderGroup(t,n):B(t)?this._renderLabeledField(t):ee(t)?this._renderRelationshipInput(t):void 0)}_renderActiveRelationshipInput(e){return this._renderRelationshipInput(e)}_renderDescriptionOrEmpty(e,t){return e==null?null:g("div",{class:this.classes(F.description),id:t},e)}_renderGroup(e,t){const{disabled:n,formTemplate:s,headingLevel:i}=this,{description:a,inputs:r,label:o,open:l}=e,c=r.filter(y=>y.visible),p=this.viewModel.findField(this._focusedFieldName),h=(p==null?void 0:p.group)===e,m=`${this.id}_group_${t}`,f=this.groupDisplay==="sequential";return g("calcite-block",{class:this.classes(F.group,f?F.groupSequential:null,h?F.groupActive:null,n?F.inputDisabled:null),collapsible:!0,"data-group":e,description:a||void 0,disabled:n,heading:`${o}`,headingLevel:s!=null&&s.title?Pt(i):i,id:m,key:m,open:l,onCalciteBlockToggle:({target:y})=>this._onGroupToggle(y,e)},c.map(y=>B(y)?this._renderLabeledField(y):ee(y)?this._renderRelationshipInput(y):void 0))}_getFocusableInput(e,t){const n=this.viewModel.allFieldInputs,s=e==="forward"?n:n.slice().reverse();let i;if(!t||ee(t))i=0;else if(K(t)){const a=t.inputs.find(B);i=a?s.indexOf(a):0}else{let a;if(ce(t)&&!t.group.open){const r=t.group.inputs.filter(B);a=e==="forward"?r[r.length-1]:r[0]}else a=t;i=s.indexOf(a)+1}for(let a=i;a<s.length;a++){const r=s[a];if(r.visible&&B(r))return r}return null}_renderLabeledField(e){var l;const{dataType:t,feature:n,label:s,layer:i,required:a}=e,r={"aria-label":a?le(this.messages.requiredFieldLabel,{name:s}):s,class:F.label,key:`${i.id}-${n.uid}-${e.name}`},o=[g("div",{class:F.labelTextContent,key:"labelTextContainer"},s,a?g("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),t!=="unsupported"?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return t==="date"&&((l=e.domain)==null?void 0:l.type)!=="coded-value"?g("label",{...r},o):g("calcite-label",{...r},o)}_renderFieldInput(e){const{dataType:t,domain:n,inputType:s,name:i}=e,a=this.getCommonInputProps(e);if((n==null?void 0:n.type)==="coded-value"){const r=this.viewModel.getFieldValueOptionsForField(i,this.messages.empty);return s!=="switch"||e.hasInvalidSwitchValue?s==="radio-buttons"?this._renderRadioButtonComponents(e,r.flat(),a):this._renderComboBoxComponent(e,r,a):this._renderSwitchComponent(e,a)}return s==="datetime-picker"||t==="date"?this._renderDateComponents(e,a):t==="number"?this._renderNumberComponent(e,a):this._renderStringComponent(e,a)}_renderStringComponent(e,t){return e.inputType==="text-area"?t.readOnly?g("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)}):g("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:n=>this._saveValueFromComponent(n.target)}):g("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:n=>this._saveValueFromComponent(n.target)})}_renderNumberComponent(e,t){return g("calcite-input-number",{...t,integer:gt(e.field),loading:e.updating,type:"number",onCalciteInputNumberInput:n=>this._saveValueFromComponent(n.target)})}_renderDateComponents(e,t){const{field:n}=e;switch(n.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,_t(n,t.value,{timeZone:this.timeZone,...vt(n)}))}}_renderDateOnlyFieldComponent(e,t){const{range:n,valid:s,value:i}=e,{class:a,key:r,readOnly:o}=t,{rawMax:l,rawMin:c}=n;return g("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!s,class:a,"data-date-part":"date","data-field-name":t[P],key:`${r}-date-input`,max:$e(l)?l:void 0,min:$e(c)?c:void 0,numberingSystem:ne,onblur:p=>{this._focusedFieldName=null,this._saveValueFromDateComponent(p.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:o,value:i!=null?`${i}`:void 0,onCalciteInputDatePickerChange:p=>this._saveValueFromDateComponent(p.target)})}_renderTimeOnlyFieldComponent(e,t){const{valid:n,value:s}=e,{class:i,key:a,readOnly:r}=t;return g("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,class:i,"data-date-part":"time","data-field-name":t[P],key:`${a}-time-input`,numberingSystem:ne,onblur:o=>{this._focusedFieldName=null,this._saveValueFromDateComponent(o.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:r,step:e.timeStep,value:s!=null?`${s}`:void 0,onCalciteInputTimePickerChange:o=>this._saveValueFromDateComponent(o.target)})}_renderTimestampOffsetFieldComponents(e,t){const{name:n,range:s,valid:i,value:a}=e,{class:r,key:o,readOnly:l}=t,{rawMax:c,rawMin:p}=s,h={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,numberingSystem:ne,overlayPositioning:"fixed",readOnly:l,[P]:n,onfocus:this._onComponentFocus},m=ue(c),f=ue(p),y=ue(a);return g("div",{class:F.dateInputContainer,key:`${o}-date-time-container`},g("calcite-input-date-picker",{...h,class:r,"data-date-part":"date",key:`${o}-date-input`,max:(m==null?void 0:m.date)??void 0,min:(f==null?void 0:f.date)??void 0,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:y.date??void 0,onCalciteInputDatePickerChange:_=>this._saveValueFromDateComponent(_.target)}),g("calcite-input-time-picker",{...h,class:r,"data-date-part":"time",key:`${o}-time-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},step:e.timeStep,value:y.time??void 0,onCalciteInputTimePickerChange:_=>this._saveValueFromDateComponent(_.target)}),e.includeTimeOffset?g("calcite-input-time-zone",{...h,class:r,"data-date-part":"timeZone",disabled:l,key:`${o}-timezone-input`,onblur:_=>{this._focusedFieldName=null,this._saveValueFromDateComponent(_.target)},value:y.timeZoneOffset??"0",onCalciteInputTimeZoneChange:_=>this._saveValueFromDateComponent(_.target)}):null)}_renderDateFieldComponents(e,t){const{includeTime:n,name:s,valid:i,value:a}=e,{class:r,key:o,max:l,min:c,readOnly:p}=t,{timeZone:h}=this,m={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,numberingSystem:ne,overlayPositioning:"fixed",readOnly:p,[P]:s,onfocus:this._onComponentFocus},f=de(a,h),y=de(l,h),_=de(c,h);return g("div",{class:F.dateInputContainer,key:`${o}-date-time-container`},g("calcite-input-date-picker",{...m,class:r,"data-date-part":"date",key:`${o}-date-input`,max:(y==null?void 0:y.date)??void 0,min:(_==null?void 0:_.date)??void 0,onblur:b=>{this._focusedFieldName=null,this._saveValueFromDateComponent(b.target)},value:f.date??void 0,onCalciteInputDatePickerChange:b=>this._saveValueFromDateComponent(b.target)}),n?g("calcite-input-time-picker",{...m,class:r,"data-date-part":"time",key:`${o}-time-input`,onblur:b=>{this._focusedFieldName=null,this._saveValueFromDateComponent(b.target)},step:1,value:f.time??void 0,onCalciteInputTimePickerChange:b=>this._saveValueFromDateComponent(b.target)}):null)}_renderReadOnlyComponent(e,t){const n=this.getCommonInputProps(e);return g("calcite-input",{...n,class:this.classes(F.fieldInput,F.inputDisabled),readOnly:!0,type:"text",value:t!=null?`${t}`:n.value})}_renderComboBoxComponent(e,t,n){const{value:s,name:i}=e,{messages:a,messagesTemplates:r,viewModel:o,_inputsWithChanges:l}=this,c=t.map(C=>C.map(({name:R,value:O})=>g("calcite-combobox-item",{key:`#${O}`,selected:s===O,textLabel:R,value:`${O}`}))),[p,h]=c;this.viewModel.fieldsWithInvalidCodedValue.has(e)&&h.unshift(g("calcite-combobox-item",{key:"incompatible-option",readOnly:!0,textLabel:`${e.value}`,value:`${e.value}`}));const m=h.length>0?[g("calcite-combobox-item-group",{key:"recommended",label:a.recommended},p),g("calcite-combobox-item-group",{key:"other",label:r.other},h)]:p,f=o.arcadeEditType==="INSERT",y=l.has(i),_=s==null&&(!f||y);if(e.showNoValueOptionEnabled){const C="",R=e.showNoValueLabel||a.empty;m.unshift(g("calcite-combobox-item",{key:"empty-option",selected:_,textLabel:a.empty,value:C},R))}const b=f&&e.showNoValueOptionEnabled&&!y?()=>{}:n.onblur;return g("calcite-combobox",{...n,allowCustomValues:!1,clearDisabled:!0,disabled:n.readOnly,onblur:b,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({target:C})=>{_&&C.selectedItems.length===0?this._ignoreDeselectionOfNoValueOption(C):this._saveValueFromComponent(C)}},m)}_renderRadioButtonComponents(e,t,n){const{name:s,value:i}=e,a=t.map(({name:r,value:o})=>this._renderRadioButtonComponent({key:r,label:r,name:s,value:o,selected:o===i,props:n}));if(e.showNoValueOptionEnabled){const r="",o=e.showNoValueLabel||this.messages.empty,l=i===r||i===null;a.unshift(this._renderRadioButtonComponent({key:"empty-option",label:o,name:s,value:r,selected:l,props:n}))}return g("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:F.inputRadioGroup,"data-field-name":n[P],key:`${n.key}-radio-group`,layout:"vertical",name:n.key,required:n.required},a)}_renderSwitchComponent(e,t){const{value:n}=e,s=!!Le(e.element,"switch")&&n===e.element.input.onValue;return g("calcite-switch",{...t,checked:s,class:F.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:i=>this._saveValueFromComponent(i.target)})}_renderRadioButtonComponent({key:e,name:t,value:n,selected:s,label:i,props:a}){return g("calcite-label",{class:F.inputRadioLabel,key:e,layout:"inline"},g("calcite-radio-button",{...a,afterCreate:void 0,afterUpdate:void 0,checked:s,class:F.inputRadio,disabled:a.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:n,onCalciteRadioButtonChange:({target:r})=>{r.checked&&this._saveValueFromComponent(r)}}),i)}_renderAuxiliaryText(e){const t=e.name,n=this._inputsWithChanges.has(t)&&!e.valid?Tt(e,this.messages,this.timeZone):this.viewModel.contingencyConstraintViolations.get(t)!=null?this.messages.validationErrors.valuesIncompatible:e.valueExpressionExecutor!=null&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return n!=null?g("calcite-input-message",{icon:!0,status:"invalid"},n):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){const{featureCount:t,relationshipId:n,showAllActionVisible:s}=e,{relatedRecordCallbacks:i}=this;if(!s||!(i!=null&&i.showAllRelatedRecords))return;const a=this.messages;return g("calcite-list-item",{description:le(a.totalCount,{count:t}),label:a.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(n)},g("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:n,relatedLayer:s}=e,{messages:i,relatedRecordCallbacks:a}=this;if(t&&(a!=null&&a.addRelatedRecord)&&s)return g("calcite-button",{alignment:"center",appearance:"outline-fill",class:F.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${n}-add-button`,onclick:()=>this._onAddRelatedRecordsClick(n,s),round:!0,scale:"s",width:"half"},e.relatedLayerIsTable?i.addRecord:i.addFeature)}_renderRelatedRecordListItem(e,t){const{feature:n,description:s,title:i}=e,{feature:a,relatedRecordCallbacks:r}=this,{highlightHelper:o}=this.viewModel,l=()=>{o==null||o.removeAll(),r!=null&&r.editRelatedRecord&&a&&r.editRelatedRecord({parentFeature:a,relationshipId:t,relatedFeature:n})},c=o?()=>o.add(n):void 0,p=o?()=>o.remove(n):void 0;return g("calcite-list-item",{bind:this,description:s,key:`${t}-${n.uid}`,label:i,onclick:l,onmouseenter:c,onmouseleave:p,value:i},g("calcite-icon",{icon:$t(n),scale:"m",slot:"content-start"}),g("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled||!e.editable)return;const{featureCount:t,relationshipId:n,showAllEnabled:s}=e,i=s?null:this._renderDescriptionOrEmpty(e.description),a=t>0?this._renderRelatedRecordsList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0;return g("calcite-label",{class:this.classes(F.label,F.relatedRecordsLabel),key:`relationship-${n}-container`},g("div",null,this._renderRelatedRecordsHeaderContainer(e),i,a),this._renderAddRelatedRecordButton(e))}_renderRelatedRecordsHeaderContainer(e){var n;const t=e.updating||!e.loaded;return g("div",{class:F.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},g("span",null,e.label),t?g("calcite-loader",{inline:!0,key:"loader",label:(n=this.messagesCommon)==null?void 0:n.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t}=e;return g("calcite-list",{class:F.relatedRecordsList},e.relatedFeatureInfos.map(n=>this._renderRelatedRecordListItem(n,t)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){var l,c,p;const{messages:t}=this,n=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,s=(l=e.relationship)==null?void 0:l.keyField,i=this.viewModel.findField(s),a=(c=e.layer)==null?void 0:c.fieldsIndex.get(s),r=(i==null?void 0:i.label)||(a==null?void 0:a.alias)||s,o=le(n,{relatedLayerName:(p=e.relatedLayer)==null?void 0:p.title,originKeyField:r});return g("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},g("div",{slot:"message"},o))}_renderNoRelatedRecordsNotice(){return g("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},g("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){var e;if((e=this.viewModel.activeRelationshipInput)!=null&&e.showAllEnabled)return g("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:F.listObserver,key:"feature-observer"})}getCommonInputProps(e){const{disabled:t}=this,{editable:n,hint:s,label:i,maxLength:a,minLength:r,name:o,range:{max:l,min:c},required:p,valid:h,value:m}=e,f=this._inputsWithChanges.has(o),y=!n||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":h?"false":"true",class:this.classes(F.fieldInput,y?F.inputDisabled:null,f&&!h?F.inputInvalid:null),key:o,label:i,max:l??void 0,min:c??void 0,maxLength:a>-1?a:void 0,minLength:r>-1?r:void 0,placeholder:s??void 0,readOnly:y,required:p,value:m==null?"":`${m}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[P]:o}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(P))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),n=e.dataset.datePart,s=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&e.value!=null){const i=e.value,a=new ResizeObserver(()=>{e.value=void 0,e.value=i,a.unobserve(e)});a.observe(e)}if(s!=null)switch(n){case"date":s.date=e;break;case"time":s.time=e;break;case"timeZone":s.timeZone=e}else this._dateComponentMap.set(t.name,{[n]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);At(t)&&e.value!=null&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,n=e.querySelector("calcite-radio-button"),s=t||n;s&&this._afterComponentCreateOrUpdate(s)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,n=this._getFieldInputFromHTMLElement(e),s=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&s===n&&(this._attemptFocusOnNextRender=!1,ce(n)&&(n.group.open=!0),e.setFocus())}_onComponentFocus(e){const t=e.target,n=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=n.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const t=this._getFieldInputFromHTMLElement(e),n=t.field.type,{name:s,range:i}=t,a=this._dateComponentMap.get(s);if(!a)return;let r=this.viewModel.getValue(s),o=null;n==="date-only"?o=e.value:n==="time-only"?(r=Ae(r),o=Ae(e.value)):o=n==="timestamp-offset"?e.value!=null?bt({dateComponent:a.date,timeComponent:a.time,timeZoneComponent:a.timeZone,oldValue:r}):null:e.value!=null?Ct({oldValue:r,dateComponent:a.date,timeComponent:a.time,timeZone:this.timeZone,max:i.max,min:i.min}):null,o!==null&&e.value?r!==o&&this._updateFieldValue(s,o):this._updateFieldValue(s,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e);this._updateFieldValue(t.name,this._parseValue(e))}_onComponentKeyDown({key:e,target:t}){const n=this._getFieldInputFromHTMLElement(t);e==="Enter"&&ce(n)&&!n.group.open&&(n.group.open=!0)}_updateFieldValue(e,t){if(this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),this.viewModel.fieldsWithContingentValues.has(e)){const n=Object.fromEntries(Object.entries(this.getValues()).filter(([s,i])=>i!=null));this.viewModel.validateContingencyConstraints(n)}}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),n=e.value;return Le(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:n==null||n===""?null:t.dataType==="number"?n==="-0"||n==="-0."||n==="-0,"?n:parseFloat(n):t.field.type==="date"?parseFloat(n):n}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:n}=e;n.length===0&&t&&"selected"in t?t.selected=!0:_e.warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){var n;e.open?(t.open=!0,this._focusedFieldName=((n=this._getFocusableInput("forward",t))==null?void 0:n.name)||null,this._attemptFocusOnNextRender=!0,this.groupDisplay==="sequential"&&this.viewModel.allGroupInputs.forEach(s=>{s!==t&&(s.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){e.key==="Enter"&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e==null||e.incrementPage()}_syncGroupInputStates(){if(this.groupDisplay!=="sequential")return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(n=>n.open);t.length===0?e[0].open=!0:t.length>1&&t.slice(1).forEach(n=>n.open=!1)}};u([d()],w.prototype,"_listObserverNode",void 0),u([d()],w.prototype,"_relatedRecordsEnabled",null),u([d()],w.prototype,"disabled",null),u([d()],w.prototype,"feature",null),u([d()],w.prototype,"formTemplate",null),u([d()],w.prototype,"groupDisplay",void 0),u([d()],w.prototype,"headingLevel",void 0),u([d()],w.prototype,"label",null),u([d()],w.prototype,"layer",null),u([d()],w.prototype,"map",null),u([d(),ie("esri/widgets/FeatureForm/t9n/FeatureForm")],w.prototype,"messages",void 0),u([d(),ie("esri/t9n/common")],w.prototype,"messagesCommon",void 0),u([d(),ie("esri/widgets/Feature/t9n/Feature")],w.prototype,"messagesFeature",void 0),u([d(),ie("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],w.prototype,"messagesTemplates",void 0),u([d()],w.prototype,"relatedRecordCallbacks",null),u([d()],w.prototype,"relationshipId",null),u([d()],w.prototype,"spatialReference",null),u([d()],w.prototype,"strict",null),u([d()],w.prototype,"timeZone",null),u([d()],w.prototype,"view",null),u([d(),Ut(["value-change","submit"])],w.prototype,"viewModel",void 0),w=u([A(Qe)],w);const dn=w,An=Object.freeze(Object.defineProperty({__proto__:null,default:dn},Symbol.toStringTag,{value:"Module"}));export{un as D,An as F,dn as H};

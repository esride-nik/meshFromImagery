import{h3 as c,cc as u,b9 as h,V as l,cb as d,a5 as o,a6 as s,a9 as y}from"./index-b516d057.js";import{l as g}from"./CollectionFlattener-193451da.js";import{m as f,c as b,C as O,T as _,j as I,S as v}from"./RouteInfo-fa5be8a1.js";import{O as w}from"./Stop-bb61a730.js";import{n as S}from"./LayerView3D-c03d44fc.js";import{O as V}from"./GraphicsProcessor-c903d185.js";import{l as G}from"./projectExtentUtils-15e84132.js";import{r as C}from"./EventedSet-680e6831.js";import{C as P}from"./RenderGeometry-5dbc1699.js";import{u as R}from"./LayerView-060b46d4.js";import"./heightModelInfoUtils-0dd2b6e4.js";import"./HeightModelInfo-b816d32b.js";import"./UpdatingHandles-7949a657.js";import"./hydratedFeatures-2365c307.js";import"./dehydratedPoint-5a1dfed5.js";import"./ElevationQuery-a3eaf0a0.js";import"./vec2f32-eaf29605.js";import"./InterleavedLayout-d76b0d59.js";import"./types-1305598a.js";import"./DefaultTechniqueConfiguration-b4dbe32f.js";import"./requestImageUtils-b142708c.js";import"./enums-bdecffa2.js";import"./Texture-bcb6d63f.js";import"./contextUtils-81fda295.js";import"./interfaces-8918b36f.js";import"./Material-5f4156ac.js";import"./ViewingMode-5d7d590b.js";import"./FramebufferObject-123b7c8d.js";import"./ShaderTechniqueConfiguration-2502462e.js";import"./ColorMaterial-bdf1f62a.js";import"./VerticalOffset.glsl-5743f98e.js";import"./OrderIndependentTransparency-755f7dcc.js";import"./dehydratedFeatures-2a3f0608.js";import"./quantizationUtils-17105106.js";import"./featureConversionUtils-09cf00ff.js";import"./OptimizedFeature-e90b69df.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./OptimizedGeometry-196224d4.js";import"./edgeUtils-6e4a97fb.js";import"./SnappingCandidate-970faec6.js";import"./ElevationProvider-abb53936.js";import"./objectResourceUtils-003803db.js";import"./devEnvironmentUtils-4eab2a99.js";import"./DefaultMaterial_COLOR_GAMMA-101ea40c.js";import"./Version-1f969b2a.js";import"./resourceUtils-1d03d2fe.js";import"./mat3f32-6c416b1c.js";import"./NestedMap-1b5db22e.js";import"./verticalOffsetUtils-e5214af9.js";import"./orientedBoundingBox-67c5cd22.js";import"./symbolColorUtils-3ca646c8.js";import"./RenderState-1d6218ee.js";import"./callExpressionWithFeature-36423058.js";import"./lineStippleUtils-0688e06c.js";import"./projectVectorToDehydratedPoint-e30a7ff8.js";import"./interfaces-1a80c8eb.js";import"./frustum-f9d53cdf.js";import"./webStyleSymbolUtils-4761c8f2.js";import"./glUtil-ce5ee52b.js";import"./VertexElementDescriptor-2925c6af.js";import"./Intersector-fa865806.js";import"./boundedPlane-1da2f094.js";import"./Octree-7cea9440.js";import"./Intersector-a291e778.js";import"./Scheduler-ff5943a4.js";import"./signal-51ed66f5.js";import"./debugFlags-9a30f077.js";import"./fontUtils-56b88a2f.js";import"./projectVectorToVector-56c29b20.js";import"./Query-071039d7.js";import"./FullTextSearch-12e0754c.js";import"./QuantizationParameters-f983cf8d.js";import"./Graphics3DObjectStates-511adea3.js";import"./jsonUtils-52514725.js";import"./DictionaryLoader-e327eff9.js";import"./FieldsIndex-e8db657f.js";import"./UnknownTimeZone-a05df022.js";import"./HeatmapColorStop-3fff4333.js";import"./heatmapUtils-7f42325f.js";import"./rendererConversion-b2429202.js";import"./basemapUtils-6ec10a55.js";import"./Basemap-8d62c69e.js";import"./loadAll-5e767cfa.js";import"./writeUtils-e226a8aa.js";import"./defaults-4faa92e6.js";import"./defaultsJSON-59981e75.js";import"./optimizedFeatureQueryEngineAdapter-1fecea41.js";import"./PooledRBush-fa11eac4.js";import"./quickselect-bc0541de.js";import"./screenUtils-8dc4a7f9.js";import"./popupUtils-e4ebc84a.js";import"./layerViewUtils-6ebe90f4.js";import"./geometryServiceUtils-3e048225.js";import"./project-1bd91657.js";import"./vec3f32-bac7ea57.js";import"./weather-2eb64924.js";import"./VertexArrayObject-d19dab8d.js";import"./floatRGBA-ca990bbb.js";import"./Intersector-2e1d9db3.js";function $(t){return t instanceof f||t instanceof b||t instanceof O||t instanceof _||t instanceof I||t instanceof v||t instanceof w}let e=class extends S(R){constructor(){super(...arguments),this.type="route-3d",this.loadedGraphics=new C,this._byObjectID=new Map,this.slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null}initialize(){this._set("processor",new V({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,t=>this._routeItemsChanged(t),c),this.addResolvingPromise(G(this).then(t=>this.fullExtentInLocalViewSpatialReference=t)),this.addHandles(u(()=>{var t,r;return(r=(t=this.view)==null?void 0:t.basemapTerrain)==null?void 0:r.ready},()=>()=>this.notifyChange("updating"),{once:!0}))}destroy(){var t;this._updatingHandles.removeAll(),this._set("processor",h(this.processor)),(t=this._get("_routeItems"))==null||t.destroy()}get _routeItems(){return new g({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.stops,this.layer.directionLines,this.layer.directionPoints,this.layer.routeInfo!=null?new l([this.layer.routeInfo]):null]})}_routeItemsChanged(t){if(t.removed.length){this.loadedGraphics.removeMany(t.removed.map(r=>{const i=this._byObjectID.get(r);return this._byObjectID.delete(r),i}));for(const r of t.removed)this.removeHandles(r)}if(t.added.length){this.loadedGraphics.addMany(t.added.map(r=>{const i=r.toGraphic();return this._byObjectID.set(r,i),i}));for(const r of t.added)this.addHandles([d(()=>r.geometry,(i,p)=>{this._updateGraphic(r,"geometry",i,p)}),d(()=>r.symbol,(i,p)=>{this._updateGraphic(r,"symbol",i,p)})],r)}}get legendEnabled(){var t;return this.canResume()&&!((t=this.processor)!=null&&t.frustumVisibilitySuspended)}getSuspendInfo(){var r,i;const t=super.getSuspendInfo();return t.outsideScaleRange=((r=this.processor)==null?void 0:r.scaleVisibilitySuspended)??!1,t.outsideOfView=((i=this.processor)==null?void 0:i.frustumVisibilitySuspended)??!1,t}async fetchPopupFeatures(t,r){return(r==null?void 0:r.clientGraphics)??[]}getHit(t){return this.processor.getHit(t)}whenGraphicBounds(t,r){return this.processor.whenGraphicBounds(t,r)}computeAttachmentOrigin(t,r){var i;return(i=this.processor)==null?void 0:i.computeAttachmentOrigin(t,r)}getSymbolLayerSize(t,r){return this.processor.getSymbolLayerSize(t,r)}async queryGraphics(){return new l(this.loadedGraphics.toArray())}maskOccludee(t){return this.processor.maskOccludee(t)}highlight(t){return $(t)&&(t=this._byObjectID.get(t)),this.processor.highlight(t)}get updatePolicy(){var t;return((t=this.processor)==null?void 0:t.graphicsCore.effectiveUpdatePolicy)||P.SYNC}canResume(){var t;return super.canResume()&&!((t=this.processor)!=null&&t.scaleVisibilitySuspended)}isUpdating(){var t,r,i;return!(!((t=this.processor)!=null&&t.updating)&&((i=(r=this.view)==null?void 0:r.basemapTerrain)!=null&&i.ready))}get performanceInfo(){var t,r;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:((t=this.processor)==null?void 0:t.elevationAlignment.updating)??!1,visibilityFrustum:!((r=this.processor)!=null&&r.frustumVisibilitySuspended)}}_updateGraphic(t,r,i,p){var m;const n=this._byObjectID.get(t);n[r]=i,a.graphic=n,a.property=r,a.oldValue=p,a.newValue=i,(m=this.processor)==null||m.graphicsCore.graphicUpdateHandler(a)}};o([s()],e.prototype,"_routeItems",null),o([s()],e.prototype,"loadedGraphics",void 0),o([s({readOnly:!0})],e.prototype,"legendEnabled",null),o([s()],e.prototype,"layer",void 0),o([s({readOnly:!0})],e.prototype,"processor",void 0),o([s({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0),e=o([y("esri.views.3d.layers.RouteLayerView3D")],e);const a={graphic:null,property:null,oldValue:null,newValue:null},vr=e;export{vr as default};

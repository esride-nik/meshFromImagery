import{d as W,c as $}from"./LineSeries-edf0978b.js";import{_ as le,b as he,x as ge,u as de,o as me,r as ce}from"./LineSeries-edf0978b.js";import{ao as j,m as D,A,as as K,s as Z,aw as z,ax as B,ad as O,ay as E,aM as J}from"./Theme-016ad2b9.js";import{iE as q}from"./index-b516d057.js";import{n as H}from"./Button-d5e3d401.js";import"./ColorSet-19b07c03.js";import"./DefaultTheme-ef2e8ff5.js";import"./Tick-52f438fc.js";class k extends W{constructor(){super(...arguments),Object.defineProperty(this,"_ph",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pw",{enumerable:!0,configurable:!0,writable:!0,value:0})}_makeGraphics(e,t){return this.makeColumn(t,e)}_makeFieldNames(){super._makeFieldNames();const e=this.get("xAxis"),t=this.get("yAxis"),i="CategoryAxis",s="ValueAxis";e.isType(i)&&(this.get("openCategoryXField")||(this._xOpenField=this._xField)),e.isType(s)&&(this.get("openValueXField")||(this._xOpenField=this._xField)),t.isType(i)&&(this.get("openCategoryYField")||(this._yOpenField=this._yField)),t.isType(s)&&(this.get("openValueYField")||(this._yOpenField=this._yField))}_prepareChildren(){super._prepareChildren();const e=this.get("xAxis"),t=this.get("yAxis"),i=this.dataItems.length,s=Math.max(0,this.startIndex()-2),a=Math.min(this.endIndex()+2,i-1);if(e.inited&&t.inited)for(let o=s;o<=a;o++){let n=this.dataItems[o];this._createGraphics(n)}}_updateChildren(){const e=this.chart;e&&(this._ph=e.plotContainer.height(),this._pw=e.plotContainer.width());const t=this.get("xAxis"),i=this.get("yAxis"),s=this.get("baseAxis"),a=this.columns.template;this.isDirty("fill")&&a.get("fill")==null&&a.set("fill",this.get("fill")),this.isDirty("stroke")&&a.get("stroke")==null&&a.set("stroke",this.get("stroke"));let o=0,n=0,r=0;D(s.series,h=>{if(h instanceof k){const x=h.get("stacked");x&&r==0&&n++,!x&&h.get("clustered")&&n++}h===this&&(o=n-1),r++}),this.get("clustered")||(o=0,n=1),n===0&&(n=1,o=0);const g=t.get("renderer"),c=i.get("renderer"),p="cellStartLocation",u="cellEndLocation",m=g.get(p,0),y=g.get(u,1),d=c.get(p,0),l=c.get(u,1);if(this._aLocationX0=m+o/n*(y-m),this._aLocationX1=m+(o+1)/n*(y-m),this._aLocationY0=d+o/n*(l-d),this._aLocationY1=d+(o+1)/n*(l-d),t.inited&&i.inited){if(this._axesDirty||this._valuesDirty||this._stackDirty||this.isDirty("vcx")||this.isDirty("vcy")||this._sizeDirty){const h=this.dataItems.length;let x=Math.max(0,this.startIndex()-2),M=Math.min(this.endIndex()+2,h-1);for(let _=0;_<x;_++)this._toggleColumn(this.dataItems[_],!1);let F=this.dataItems[x];for(let _=x;_<=M;_++){let T=this.dataItems[_];if(T.get("valueX")!=null&&T.get("valueY")!=null){if(F=T,_>0&&x>0)for(let X=_-1;X>=0;X--){let f=this.dataItems[X];if(f.get("valueX")!=null&&f.get("valueY")!=null){F=f;break}}break}this._toggleColumn(T,!1)}for(let _=x;_<=M;_++){let T=this.dataItems[_];this._updateGraphics(T,F),T.get("valueX")!=null&&T.get("valueY")!=null&&(F=T)}for(let _=M+1;_<h;_++)this._toggleColumn(this.dataItems[_],!1)}}else this._skipped=!0;this.updateLegendMarker(this.get("tooltipDataItem")),super._updateChildren()}_createGraphics(e){let t=e.get("graphics");if(!t){t=this._makeGraphics(this.columns,e),e.set("graphics",t),t._setDataItem(e);const i=e.get("legendDataItem");if(i){const s=i.get("markerRectangle");s&&s.setAll({fill:t.get("fill"),stroke:t.get("stroke")})}this.axisRanges.each(s=>{const a=s.container,o=e.get("rangeGraphics",[]);e.set("rangeGraphics",o);const n=this._makeGraphics(s.columns,e);o.push(n),n.setPrivate("list",s.columns),a.children.push(n)})}}_updateGraphics(e,t){let i=e.get("graphics");const s=this._xField,a=this._yField,o=e.get(s),n=e.get(a);if(o!=null&&n!=null){const r=this._xOpenField,g=this._yOpenField,c=this.get("locationX",e.get("locationX",.5)),p=this.get("locationY",e.get("locationY",.5)),u=this.get("openLocationX",e.get("openLocationX",c)),m=this.get("openLocationY",e.get("openLocationY",p)),y=i.get("width"),d=i.get("height"),l=this.get("stacked"),h=this.get("xAxis"),x=this.get("yAxis"),M=this.get("baseAxis"),F=h.get("start"),_=h.get("end"),T=x.get("start"),X=x.get("end");let f,C,v,w,Y=this.get("vcy",1),L=this.get("vcx",1),R=!1,G=!1;if(x.isType("CategoryAxis")&&h.isType("CategoryAxis")){let P=this._aLocationX0+u-.5,b=this._aLocationX1+c-.5;if(y instanceof O){let I=(b-P)*(1-y.value)/2;P+=I,b-=I}if(f=h.getDataItemPositionX(e,r,P,L),C=h.getDataItemPositionX(e,s,b,L),P=this._aLocationY0+m-.5,b=this._aLocationY1+p-.5,d instanceof O){let I=(b-P)*(1-d.value)/2;P+=I,b-=I}v=x.getDataItemPositionY(e,g,P,Y),w=x.getDataItemPositionY(e,a,b,Y),e.setRaw("point",{x:f+(C-f)/2,y:v+(w-v)/2})}else if(h===M){let P=this._aLocationX0+u-.5,b=this._aLocationX1+c-.5;if(y instanceof O){let I=(b-P)*(1-y.value)/2;P+=I,b-=I}if(f=h.getDataItemPositionX(e,r,P,L),C=h.getDataItemPositionX(e,s,b,L),v=x.getDataItemPositionY(e,a,p,Y),this._yOpenField!==this._yField)w=x.getDataItemPositionY(e,g,m,Y);else if(l){let I=e.get("stackToItemY");w=I?x.getDataItemPositionY(I,a,m,I.component.get("vcy")):x.basePosition()}else w=x.basePosition();e.setRaw("point",{x:f+(C-f)/2,y:v}),G=!0}else if(x===M){let P=this._aLocationY0+m-.5,b=this._aLocationY1+p-.5;if(d instanceof O){let I=(b-P)*(1-d.value)/2;P+=I,b-=I}if(v=x.getDataItemPositionY(e,g,P,Y),w=x.getDataItemPositionY(e,a,b,Y),C=h.getDataItemPositionX(e,s,c,L),this._xOpenField!==this._xField)f=h.getDataItemPositionX(e,r,u,L);else if(l){let I=e.get("stackToItemX");f=I?h.getDataItemPositionX(I,s,u,I.component.get("vcx")):h.basePosition()}else f=h.basePosition();R=!0,e.setRaw("point",{x:C,y:v+(w-v)/2})}this._updateSeriesGraphics(e,i,f,C,v,w,R,G),f<F&&C<F||f>_&&C>_||v<T&&w<=T||v>=X&&w>X||E(f)||E(v)?this._toggleColumn(e,!1):this._toggleColumn(e,!0);let V=e.get("rangeGraphics");V&&D(V,P=>{this._updateSeriesGraphics(e,P,f,C,v,w,R,G)}),this._applyGraphicsStates(e,t)}}_updateSeriesGraphics(e,t,i,s,a,o,n,r){const g=t.get("width"),c=t.get("height"),p=t.get("maxWidth"),u=t.get("maxHeight"),m=this.getPoint(i,a),y=this.getPoint(s,o),d=e.get("point");if(d){const l=this.getPoint(d.x,d.y);d.x=l.x+this._x,d.y=l.y+this._y}if(i=m.x,s=y.x,a=m.y,o=y.y,A(g)){const l=(s-i-g)/2;i+=l,s-=l}if(A(p)&&p<Math.abs(s-i)){const l=(s-i-p)/2;i+=l,s-=l}if(A(c)){const l=(o-a-c)/2;a+=l,o-=l}if(A(u)&&u<Math.abs(o-a)){const l=(o-a-u)/2;a+=l,o-=l}this.get("adjustBulletPosition")&&(n&&(s=Math.min(Math.max(0,s),this._pw),i=Math.min(Math.max(0,i),this._pw)),r&&(a=Math.min(Math.max(0,a),this._ph),o=Math.min(Math.max(0,o),this._ph))),e.setRaw("left",i),e.setRaw("right",s),e.setRaw("top",a),e.setRaw("bottom",o),t.setPrivate("width",s-i),t.setPrivate("height",o-a),t.set("x",i),t.set("y",o-(o-a))}_handleDataSetChange(){super._handleDataSetChange(),D(this._dataItems,e=>{this._toggleColumn(e,!1)})}_applyGraphicsStates(e,t){const i=e.get("graphics"),s=i.states.lookup("dropFromOpen"),a=i.states.lookup("riseFromOpen"),o=i.states.lookup("dropFromPrevious"),n=i.states.lookup("riseFromPrevious");if(s||o||a||n){const r=this.get("xAxis"),g=this.get("yAxis"),c=this.get("baseAxis");let p,u,m;c===r&&g.isType("ValueAxis")?(p=e.get(this._yOpenField),u=e.get(this._yField),m=t.get(this._yField)):c===g&&r.isType("ValueAxis")&&(p=e.get(this._xOpenField),u=e.get(this._xField),m=t.get(this._xField)),A(p)&&A(u)&&(u<p?s&&s.apply():a&&a.apply(),A(m)&&(u<m?o&&o.apply():n&&n.apply()))}}disposeDataItem(e){super.disposeDataItem(e);const t=e.get("graphics");t&&(this.columns.removeValue(t),t.dispose());const i=e.get("rangeGraphics");i&&D(i,s=>{const a=s.getPrivate("list");a&&a.removeValue(s),s.dispose()})}hideDataItem(e,t){const i=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return q(this,void 0,void 0,function*(){const s=[i.hideDataItem.call(this,e,t)],a=e.get("graphics");a&&s.push(a.hide(t));const o=e.get("rangeGraphics");o&&D(o,n=>{s.push(n.hide(t))}),yield Promise.all(s)})}_toggleColumn(e,t){const i=e.get("graphics");i&&i.setPrivate("visible",t);const s=e.get("rangeGraphics");s&&D(s,o=>{o.setPrivate("visible",t)});const a=e.bullets;a&&D(a,o=>{o.setPrivate("hidden",!t)})}showDataItem(e,t){const i=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return q(this,void 0,void 0,function*(){const s=[i.showDataItem.call(this,e,t)],a=e.get("graphics");a&&s.push(a.show(t));const o=e.get("rangeGraphics");o&&D(o,n=>{s.push(n.show(t))}),yield Promise.all(s)})}updateLegendMarker(e){let t=this.get("legendDataItem");if(this.get("useLastColorForLegendMarker")&&!e){const i=this.dataItems[this.endIndex()-1];i&&(e=i)}if(t){let i=this.columns.template;if(e){let a=e.get("graphics");a&&(i=a)}const s=t.get("markerRectangle");s&&(t.get("itemContainer").get("disabled")||D(J,a=>{s.set(a,i.get(a,this.get(a)))}))}}_getTooltipTarget(e){return this.get("seriesTooltipTarget")=="bullet"?super._getTooltipTarget(e):e.get("graphics")||this}}Object.defineProperty(k,"className",{enumerable:!0,configurable:!0,writable:!0,value:"BaseColumnSeries"}),Object.defineProperty(k,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:W.classNames.concat([k.className])});class N extends ${constructor(){super(...arguments),Object.defineProperty(this,"_frequency",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"_itemMap",{enumerable:!0,configurable:!0,writable:!0,value:{}})}_afterNew(){this._settings.themeTags=j(this._settings.themeTags,["axis"]),this.fields.push("category"),this.setPrivateRaw("name","category"),this.addTag("category"),super._afterNew()}_prepareChildren(){super._prepareChildren();const e=this.dataItems.length;let t=0;this._valuesDirty&&(this._itemMap={},D(this.dataItems,i=>{i.setRaw("index",t),this._itemMap[i.get("category")]=i,t++}),this.setPrivateRaw("maxZoomFactor",e)),this.setPrivateRaw("startIndex",Math.max(Math.round(this.get("start",0)*e),0)),this.setPrivateRaw("endIndex",Math.min(Math.round(this.get("end",1)*e),e)),(this._sizeDirty||this._valuesDirty||this.isDirty("start")||this.isDirty("end")||this.isPrivateDirty("endIndex")||this.isPrivateDirty("startIndex")||this.isPrivateDirty("width")||this.isPrivateDirty("height"))&&this.dataItems.length>0&&(this._handleRangeChange(),this._prepareAxisItems(),this._updateAxisRanges())}_handleRangeChange(){D(this.series,e=>{let t=this.dataItems[this.startIndex()].get("category"),i=this.dataItems[this.endIndex()-1].get("category"),s=e.get("baseAxis"),a=e.get("xAxis"),o=e.get("yAxis");if(a instanceof N&&o instanceof N)e._markDirtyAxes();else if(s===this){let n,r,g=o;if(a===s?(e.get("categoryXField")&&(n="categoryX"),e.get("openCategoryXField")&&(r="openCategoryX")):o===s&&(e.get("categoryYField")&&(n="categoryY"),e.get("openCategoryYField")&&(r="openCategoryY"),g=a),g.className=="ValueAxis"&&(n||r)){let c,p;for(let d=0,l=e.dataItems.length;d<l;d++){let h=e.dataItems[d];if(n&&h.get(n)===t){c=h;break}if(r&&h.get(r)===t){c=h;break}}for(let d=e.dataItems.length-1;d>=0;d--){let l=e.dataItems[d];if(n&&l.get(n)===i){p=l;break}if(r&&l.get(r)===i){p=l;break}}let u=0,m=e.dataItems.length;c&&(u=e.dataItems.indexOf(c)),p&&(m=e.dataItems.indexOf(p)+1),e.setPrivate("startIndex",u),e.setPrivate("endIndex",m);let y=!1;for(let d=u;d<m;d++){const l=e.dataItems[d];if(D(e.__valueXShowFields,h=>{l.get(h)!=null&&(y=!0)}),D(e.__valueYShowFields,h=>{l.get(h)!=null&&(y=!0)}),y)break}e.setPrivate("outOfSelection",!y)}e._markDirtyAxes()}})}_prepareAxisItems(){const e=this.get("renderer"),t=this.dataItems.length;let i=this.startIndex();i>0&&i--;let s=this.endIndex();s<t&&s++;let a=e.axisLength()/Math.max(e.get("minGridDistance"),1/Number.MAX_SAFE_INTEGER),o=Math.max(1,Math.min(t,Math.ceil((s-i)/a)));i=Math.floor(i/o)*o,this._frequency=o;for(let r=0;r<t;r++)this.dataItems[r].hide();let n=this.dataItems[i].get("index",0);for(let r=i;r<s;r+=o){let g=this.dataItems[r];this._createAssets(g,[]),g.isHidden()&&g.show(),this._prepareDataItem(g,n,o),n++}this._updateGhost()}_prepareDataItem(e,t,i){let s=this.get("renderer"),a=e.get("categoryLocation",0),o=e.get("endCategoryLocation",1),n=e.get("index");A(n)||(n=this.categoryToIndex(e.get("category")));let r,g=this.indexToPosition(n,a),c=e.get("endCategory");c?(r=this.categoryToIndex(c),A(r)||(r=n)):r=n;let p,u,m=this.indexToPosition(r,o);p=e.get("isRange")?r:n+this._frequency-1,u=this.indexToPosition(p,o),s.updateLabel(e.get("label"),g,m,i),s.updateGrid(e.get("grid"),g,m),s.updateTick(e.get("tick"),g,m,i),s.updateFill(e.get("axisFill"),g,u),this._processBullet(e),s.updateBullet(e.get("bullet"),g,m);const y=this.get("fillRule");y&&y(e,t)}startIndex(){let e=this.dataItems.length;return Math.min(Math.max(this.getPrivate("startIndex",0),0),e-1)}endIndex(){let e=this.dataItems.length;return Math.max(1,Math.min(this.getPrivate("endIndex",e),e))}baseValue(){}basePosition(){return 0}getX(e){let t=this._itemMap[e];return t?this._settings.renderer.positionToCoordinate(this.indexToPosition(t.get("index",0))):NaN}getY(e){let t=this._itemMap[e];return t?this._settings.renderer.positionToCoordinate(this.indexToPosition(t.get("index",0))):NaN}getDataItemPositionX(e,t,i,s){const a=e.get(t),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateX(e,t,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionX(e,t,i,s))}getDataItemPositionY(e,t,i,s){const a=e.get(t),o=this._itemMap[a];return o?this.indexToPosition(o.get("index",0),i):NaN}getDataItemCoordinateY(e,t,i,s){return this._settings.renderer.positionToCoordinate(this.getDataItemPositionY(e,t,i,s))}indexToPosition(e,t){A(t)||(t=.5);let i=this.dataItems.length,s=this.get("startLocation",0);i-=s,i-=1-this.get("endLocation",1);let a=(e+t-s)/i,o=this.dataItems[e];return o&&(a+=o.get("deltaPosition",0)),a}categoryToIndex(e){let t=this._itemMap[e];return t?t.get("index"):NaN}dataItemToPosition(e){return this.indexToPosition(e.get("index"))}roundAxisPosition(e,t){return e+=(.5-t)/this.dataItems.length,this.indexToPosition(this.axisPositionToIndex(e),t)}axisPositionToIndex(e){let t=this.dataItems.length;return K(Math.floor(e*t),0,t-1)}getTooltipText(e,t){const i=this.dataItems[this.axisPositionToIndex(e)];if(i){const s=i.get("label");if(s)return Z(s,this.get("tooltipText",""))}}_updateTooltipText(e,t){e._setDataItem(this.dataItems[this.axisPositionToIndex(t)]),e.label.text.markDirtyText()}getSeriesItem(e,t){if(this.dataItems.length>0){let i=this.getPrivate("name")+this.get("renderer").getPrivate("letter"),s=this.axisPositionToIndex(t),a=e.dataItems[s],o=this.dataItems[s],n=o.get("category");if(a&&o&&a.get(i)===n)return a;for(let r=0,g=e.dataItems.length;r<g;r++){let c=e.dataItems[r];if(c.get(i)===n)return c}}}zoomToIndexes(e,t,i){let s=this.dataItems.length;this.zoom(e/s,t/s,i)}zoomToCategories(e,t,i){this.zoomToIndexes(this.categoryToIndex(e),this.categoryToIndex(t)+1,i)}getCellWidthPosition(){return this._frequency/this.dataItems.length/(this.get("end",1)-this.get("start",0))}}Object.defineProperty(N,"className",{enumerable:!0,configurable:!0,writable:!0,value:"CategoryAxis"}),Object.defineProperty(N,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:$.classNames.concat([N.className])});class S extends k{constructor(){super(...arguments),Object.defineProperty(this,"columns",{enumerable:!0,configurable:!0,writable:!0,value:new z(B.new({}),()=>H._new(this._root,{position:"absolute",themeTags:j(this.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template]))})}makeColumn(e,t){const i=this.mainContainer.children.push(t.make());return i._setDataItem(e),t.push(i),i}_processAxisRange(e){super._processAxisRange(e),e.columns=new z(B.new({}),()=>H._new(this._root,{position:"absolute",themeTags:j(e.columns.template.get("themeTags",[]),["series","column"])},[this.columns.template,e.columns.template]))}}Object.defineProperty(S,"className",{enumerable:!0,configurable:!0,writable:!0,value:"ColumnSeries"}),Object.defineProperty(S,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:k.classNames.concat([S.className])});export{le as AxisRendererXAm5,he as AxisRendererYAm5,N as CategoryAxisAm5,S as ColumnSeriesAm5,ge as LineSeriesAm5,de as ValueAxisAm5,me as XYChartAm5,ce as XYCursorAm5};
